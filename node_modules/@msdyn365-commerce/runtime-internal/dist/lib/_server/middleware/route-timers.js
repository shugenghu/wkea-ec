/*!
 * Copyright (c) Microsoft Corporation.
 * All rights reserved. See LICENSE in the project root for license information.
 */
import { asSystemMetadata, LogLevel, StaticTelemetry } from '@msdyn365-commerce/telemetry-internal';
export const KEY_REQUESTRECEIVED = 'RequestReceived';
export const KEY_REQUESTENDED = 'RequestEnded';
const getElapsedTimeInMs = (startHrTime) => {
    const elapsedHrTime = process.hrtime(startHrTime);
    return elapsedHrTime[0] * 1000 + elapsedHrTime[1] / 1e6;
};
/**
 * This is route middleware to time each route
 */
export const requestRouteTimer = (req, res, next) => {
    const startTime = process.hrtime();
    if (req.route && req.route.path) {
        res.on('finish', () => {
            const elapsedMsTime = getElapsedTimeInMs(startTime);
            StaticTelemetry.log(LogLevel.Information, `{route} took {time}ms`, {
                values: [asSystemMetadata(req.route.path), asSystemMetadata(elapsedMsTime)]
            });
        });
    }
    next();
};
//# sourceMappingURL=route-timers.js.map