{"version":3,"file":"platformExternalStatics.js","sourceRoot":"","sources":["../../../src/_server/platformExternalStatics.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nexport const enum ExternalStaticType {\n    Script,\n    Style\n}\n\nexport interface IExternalStatic {\n    /**\n     * Is this script is required on page ?.\n     */\n    required?: boolean;\n    /**\n     * The script type\n     */\n    scriptType: ExternalStaticType;\n    /**\n     * Where the script lives - both a default (minified) & debug script sources\n     */\n    src: {\n        debug?: string;\n        production: string;\n    };\n    attributes?: {\n        [key: string]: string | undefined;\n    };\n    /**\n     * Should the base URL be mapped to this?\n     */\n    mapBaseUrl?: boolean;\n}\n// External Scripts Declarations\nconst BootstrapCSSVersion = `4.2.1`;\n\n// Can also be moved to registration if we need to\nconst ReactScript: IExternalStatic = {\n    src: {\n        debug: `static/js/react/react.development.js`,\n        production: `static/js/react/react.production.min.js`\n    },\n    scriptType: ExternalStaticType.Script,\n    mapBaseUrl: true,\n    required: true\n};\n\nconst ReactDOMScript: IExternalStatic = {\n    src: {\n        debug: `static/js/react-dom/react-dom.development.js`,\n        production: `static/js/react-dom/react-dom.production.min.js`\n    },\n    scriptType: ExternalStaticType.Script,\n    mapBaseUrl: true,\n    required: true\n};\n\nconst BootstrapStyle: IExternalStatic = {\n    src: {\n        debug: `https://stackpath.bootstrapcdn.com/bootstrap/${BootstrapCSSVersion}/css/bootstrap.css`,\n        production: `https://stackpath.bootstrapcdn.com/bootstrap/${BootstrapCSSVersion}/css/bootstrap.min.css`\n    },\n    scriptType: ExternalStaticType.Style,\n    attributes: {\n        crossOrigin: 'anonymous'\n    }\n};\n\n/**\n * Static per app lifetime of the platform external scripts\n */\nexport const platformExternalScripts: IExternalStatic[] = [ReactScript, ReactDOMScript, BootstrapStyle];\n\n/**\n * Private helper for mapping a dictionary of key/value pairs to HTML attributes\n * @param attributes attributes dictionary\n */\nconst attributeToHtmlAttribute = (attributes: { [key: string]: string | undefined } = {}) => {\n    return Object.keys(attributes)\n        .map((key: string) => {\n            return attributes[key] !== undefined ? `${key}=\"${attributes[key]}\"` : key;\n        })\n        .join(' ');\n};\n\n/**\n * Private helper to add preload attribute for required script\n * @param externalScripts external script object\n * @param preloadRequiredScripts add preload data attribute\n */\nconst addPreLoadAttributeToRequiredScripts = (externalScripts: IExternalStatic[], preloadRequiredScripts: boolean = false) => {\n    if (externalScripts) {\n        for (let i = 0; i < externalScripts.length; i++) {\n            const script = externalScripts[i];\n            if (preloadRequiredScripts && script.required) {\n                if (!script.attributes) {\n                    script.attributes = {};\n                }\n                script.attributes['data-preload'] = 'true';\n            } else if (script.attributes && script.attributes['data-preload']) {\n                delete script.attributes['data-preload'];\n            }\n        }\n    }\n};\n\n/**\n * Convert external script object to HTML tag string.\n *\n * @param externalScript external script object\n * @param isDebug Use debug URL for script if available\n */\nexport const externalStaticToHtmlTag = (baseUrl: string, externalScript: IExternalStatic, isDebug: boolean = false) => {\n    let result = ``;\n    const scriptSource = isDebug && externalScript.src.debug ? externalScript.src.debug : externalScript.src.production;\n\n    switch (externalScript.scriptType) {\n        case ExternalStaticType.Script:\n            result = `<script type=\"text/javascript\" src=\"${\n                externalScript.mapBaseUrl ? baseUrl : ''\n            }${scriptSource}\" ${attributeToHtmlAttribute(externalScript.attributes)} crossOrigin=\"anonymous\"></script>`;\n            break;\n        default:\n            // ExternalScriptType.Style\n            result = `<link rel=\"stylesheet\" href=\"${externalScript.mapBaseUrl ? baseUrl : ''}${scriptSource}\" ${attributeToHtmlAttribute(\n                externalScript.attributes\n            )}/>`;\n    }\n\n    return result;\n};\n\nconst _staticsCache = {};\n/**\n * Pre-processed strings\n */\nexport const getPlatformExternalStaticsAsStrings = (baseUrl: string, preloadRequiredScripts = false) => {\n    const cacheKey = `${baseUrl}-preloadrequiredscripts-${preloadRequiredScripts}`;\n    if (_staticsCache[cacheKey]) {\n        return _staticsCache[cacheKey];\n    }\n    const externals = {\n        scripts: platformExternalScripts.filter((script: IExternalStatic) => script.scriptType === ExternalStaticType.Script),\n        styles: platformExternalScripts.filter((script: IExternalStatic) => script.scriptType === ExternalStaticType.Style)\n    };\n\n    addPreLoadAttributeToRequiredScripts(externals.scripts, preloadRequiredScripts);\n\n    const result = {\n        debugScriptHtmlString: externals.scripts.map((kvp: IExternalStatic) => externalStaticToHtmlTag(baseUrl, kvp, true)).join(''),\n        productionScriptHtmlString: externals.scripts.map((kvp: IExternalStatic) => externalStaticToHtmlTag(baseUrl, kvp, false)).join(''),\n        debugStyleHtmlString: externals.styles.map((kvp: IExternalStatic) => externalStaticToHtmlTag(baseUrl, kvp, true)).join(''),\n        productionStyleHtmlString: externals.styles.map((kvp: IExternalStatic) => externalStaticToHtmlTag(baseUrl, kvp, false)).join('')\n    };\n    _staticsCache[cacheKey] = result;\n\n    return result;\n};\n"]}