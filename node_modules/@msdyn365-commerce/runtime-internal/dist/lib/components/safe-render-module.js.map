{"version":3,"file":"safe-render-module.js","sourceRoot":"","sources":["../../../src/components/safe-render-module.tsx"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n// tslint:disable:no-use-before-declare\nimport {\n    CoreContext,\n    IAddModuleSlot,\n    IAny,\n    IDictionary,\n    IGeneric,\n    IModule,\n    IModuleContract,\n    isAuthoringEditEnabled,\n    msdyn365Commerce,\n    SDK_FRAGMENT_NAME,\n    WithContext\n} from '@msdyn365-commerce/core-internal';\nimport {\n    asSystemMetadata,\n    EXCEPTION_MISSINGMODULECONFIG,\n    EXCEPTION_MODULERENDERFAIL,\n    EXCEPTION_NOMODULEBINDER,\n    EXCEPTION_UNREGISTEREDMODULEID,\n    InternalTelemetry,\n    ITelemetry,\n    LogLevel\n} from '@msdyn365-commerce/telemetry-internal';\nimport { get as _get, union } from 'lodash';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ReportChunks } from 'react-universal-component';\nimport { LAYOUT_MOUNT_POINT, MODULE_CONFIG_ERRORS_KEY, MODULE_LAYOUT_FIELD } from '../consts';\nimport { PageContext } from '../store/page-context';\nimport { AddControlMode, AddModuleControl } from './add-module-control';\nimport { AddModuleWrapper } from './add-module-wrapper';\nimport { ErrorModule, renderErrorOrPlaceHolderModules } from './error-module';\nimport { renderView } from './render-view';\n\ntype ErrorInfo = {\n    componentStack: string;\n};\n\nexport type TSafeRenderModuleState = {\n    error?: Error;\n    info?: ErrorInfo;\n    isRegistered?: boolean;\n    isConfigured?: boolean;\n    mounted?: boolean;\n};\n\n/**\n * Known types on the props\n */\nexport type TSafeRenderModuleProps = IGeneric<IAny> & {\n    telemetry: ITelemetry;\n    internalTelemetry: InternalTelemetry;\n};\n\n/**\n * Component to render module\n */\n@observer\nexport class SafeRenderModule extends React.Component<TSafeRenderModuleProps, TSafeRenderModuleState> {\n    // tslint:disable-next-line:no-any\n    private componentRef: React.RefObject<React.Component<{}, any>>;\n    private shouldDisplayErrors: boolean = false;\n    private isRenderAttrributeCalled: boolean = false;\n    private disableSSRErrorChecks?: boolean = false;\n\n    public static getDerivedStateFromError(error: Error): TSafeRenderModuleState {\n        return { error: error };\n    }\n\n    constructor(props: TSafeRenderModuleProps) {\n        super(props);\n\n        this.state = {\n            error: undefined,\n            info: undefined,\n            isConfigured: true,\n            isRegistered: true,\n            mounted: false\n        };\n        this.componentRef = React.createRef();\n        this.shouldDisplayErrors = props && props.context ? props.context.request.params.isDebug : true;\n\n        // If App Setting to disable server-side rendering error checks is true then instead of rendering each module\n        // separately and potentially containing each one in an error-boundary in case of an error,\n        // safe-render-module will instead render all modules together in one pass for improved performance.\n        this.disableSSRErrorChecks = props.context && props.app && props.app.platform && props.app.platform.disableServerSideErrorChecking;\n\n        // In the event that this is being rendered in editor or debug mode we will override this setting to render each individual module separately\n        // to catch module errors at the cost of performance\n        this.disableSSRErrorChecks =\n            this.disableSSRErrorChecks && !props.context.request.params.isDebug && !props.context.request.params.isEditor;\n\n        this.props.internalTelemetry.log(\n            LogLevel.Debug,\n            `Safe Render module constructor type-'{typeName}' with id-'{id} and is ${\n                this.disableSSRErrorChecks ? 'not ' : ''\n            }running in error check mode.'`,\n            {\n                values: [asSystemMetadata(this.props.typeName), asSystemMetadata(this.props.id)]\n            }\n        );\n    }\n\n    public componentDidMount(): void {\n        if (!this.state.mounted) {\n            this.setState({ mounted: true });\n        }\n\n        if (this.isRenderAttrributeCalled) {\n            return;\n        }\n\n        this._setErrorStates();\n        this._setDataAttributes();\n    }\n\n    public shouldComponentUpdate(nextProps: TSafeRenderModuleProps, nextState: TSafeRenderModuleState): boolean {\n        if (this._isEditorial()) {\n            if (nextState.error) {\n                this.props.store.requestCache.put(\n                    { typeName: MODULE_CONFIG_ERRORS_KEY, key: this.props.id },\n                    { item: [{ property: this.props.id, message: nextState.error.message }] }\n                );\n            }\n        }\n        return true;\n    }\n\n    public componentDidUpdate(): void {\n        if (this.isRenderAttrributeCalled) {\n            return;\n        }\n\n        this._setErrorStates();\n        this._setDataAttributes();\n    }\n\n    public componentDidCatch(error: Error, info: ErrorInfo): void {\n        this.setState({ error, info });\n    }\n\n    // tslint:disable-next-line:cyclomatic-complexity\n    public render(): JSX.Element | null {\n        const config = this.props.config;\n        const { internalTelemetry } = this.props;\n        internalTelemetry.log(LogLevel.Debug, `Safe Render module render type-'{typeName}' with id-'{id}'`, {\n            values: [asSystemMetadata(this.props.typeName), asSystemMetadata(this.props.id)]\n        });\n        const isMounted = this.state.mounted;\n        const mappedProps = mapStateToProps(this.props.store, this.props, isMounted);\n        const { id, typeName } = mappedProps && mappedProps.id ? mappedProps : this.props;\n        const configErrors = mappedProps.configErrors;\n\n        const Component = mappedProps.component as React.ComponentClass;\n        if (!Component) {\n            const message = internalTelemetry.stringFormat(EXCEPTION_UNREGISTEREDMODULEID, [id, typeName]);\n            internalTelemetry.log(LogLevel.Error, message);\n            return (\n                <ErrorModule\n                    errorType='unregistered'\n                    {...{ ...this.props, ...mappedProps }}\n                    error={new Error(message)}\n                    renderModuleAttributes={this.renderModuleAttributes}\n                    renderView={renderView}\n                />\n            );\n        }\n\n        const err = this.state.error || (configErrors && configErrors.length && new Error(configErrors.map(x => x.message).join(', ')));\n        if (err) {\n            const element = renderErrorOrPlaceHolderModules(\n                err,\n                internalTelemetry,\n                mappedProps,\n                this.state,\n                this.props,\n                this._isEditorial(),\n                this.renderModuleAttributes\n            );\n            if (element) {\n                return element;\n            }\n        }\n\n        if (process.env.CURRENT_ENVIRONMENT === 'node') {\n            if (config && config.hasOwnProperty('clientRender') && config.clientRender && !this._isEditorial()) {\n                return <React.Fragment />;\n            } else {\n                return this._doServerSideRender(mappedProps, Component, internalTelemetry);\n            }\n        } else if (!this.state.mounted && this.props.store.deferred(this.props.id)) {\n            // module needs two passes\n            return null;\n        } else if (config && config.hasOwnProperty('clientRender') && config.clientRender && !this._isEditorial()) {\n            if (this.state.mounted) {\n                return (\n                    <Component\n                        {...mappedProps}\n                        ref={this.componentRef}\n                        {...{ renderModuleAttributes: this.renderModuleAttributes, renderView: renderView }}\n                    />\n                );\n            } else {\n                return <React.Fragment />;\n            }\n        }\n\n        return (\n            <Component\n                {...mappedProps}\n                ref={this.componentRef}\n                {...{ renderModuleAttributes: this.renderModuleAttributes, renderView: renderView }}\n            />\n        );\n    }\n\n    private renderModuleAttributes = (props: IGeneric<IAny>): IDictionary<string> => {\n        this.isRenderAttrributeCalled = true;\n\n        if (!props || !props.id) {\n            return {};\n        }\n\n        // Construct telemetry attributes for module\n        const telemetryId: string = props.friendlyName || props.id;\n        const telemetryAttributes: IDictionary<string> =\n            this.props.internalTelemetry && this.props.internalTelemetry.setTelemetryAttribute\n                ? this.props.internalTelemetry.setTelemetryAttribute(telemetryId)\n                : {};\n\n        const moduleAttributes: IDictionary<string> = { 'data-m-t': props.typeName, ...telemetryAttributes };\n        if (this.shouldDisplayErrors || this._isEditorial()) {\n            moduleAttributes['data-i'] = this._setDataInfoAttribute(props);\n        }\n\n        if (props.platform && typeof props.platform === 'object') {\n            Object.keys(props.platform).forEach(key => {\n                moduleAttributes[`data-m-${key}`] = props.platform[key];\n            });\n        }\n\n        // If a module is associated with an experiment, add this attribtue to track when to activate the experiment\n        if (props.context.request && props.context.request.experiments?.moduleIdToExperimentIdMap) {\n            if (props.context.request.experiments.moduleIdToExperimentIdMap[props.id]) {\n                moduleAttributes[`data-exp`] = `id:${props.context.request.experiments.moduleIdToExperimentIdMap[props.id]}`;\n            }\n        }\n        // In editor scenario, Authoring will update the module layout by sending us updates on\n        // the MODULE_LAYOUT_FIELD in the config object\n        if (this._isEditorial() && props.config && props.config[MODULE_LAYOUT_FIELD]) {\n            moduleAttributes[`data-m-layout`] = props.config[MODULE_LAYOUT_FIELD];\n        }\n\n        return moduleAttributes;\n    };\n\n    /**\n     * Set the data info attribute to be added to the modules\n     * @param props The module props.\n     */\n    private _setDataInfoAttribute(props: IGeneric<IAny>): string {\n        const dataInfo = [`id:${props.id}`];\n        props.slotId && dataInfo.push(`s:${props.slotId}`);\n        props.parentId && dataInfo.push(`p:${props.parentId}`);\n        props.typeName && dataInfo.push(`t:${props.typeName}`);\n        props.friendlyName && dataInfo.push(`fn:${props.friendlyName}`);\n        // @ts-ignore\n        const moduleBinder = msdyn365Commerce.moduleBinder(props.typeName);\n        if (moduleBinder) {\n            moduleBinder.$type && dataInfo.push(`mt:${moduleBinder.$type}`);\n        }\n        props.errorType && dataInfo.push(`e:${props.errorType}`);\n        return `{${dataInfo.join(',')}}`;\n    }\n\n    /**\n     * isEditor\n     * Determines if request is coming from the editor\n     */\n    private _isEditorial(): boolean {\n        return _get(this.props, ['context', 'request', 'params', 'isEditor'], false);\n    }\n\n    /**\n     * Creates data info string to be used by cms e.g '{id:prop-id,s:content,p:parent-id}'\n     */\n    private _generateDataInfo(): string {\n        const dataInfo = [`id:${this.props.id}`];\n        this.props.slotId && dataInfo.push(`s:${this.props.slotId}`);\n        this.props.parentId && dataInfo.push(`p:${this.props.parentId}`);\n        this.props.typeName && dataInfo.push(`t:${this.props.typeName}`);\n        this.props.friendlyName && dataInfo.push(`fn:${this.props.friendlyName}`);\n        // @ts-ignore\n        const moduleBinder = msdyn365Commerce.moduleBinder(this.props.typeName);\n        if (moduleBinder) {\n            moduleBinder.$type && dataInfo.push(`mt:${moduleBinder.$type}`);\n        }\n\n        // Error scenarios\n        // 1. Empty module\n        // 2. Unregistered module\n        // 3. Generic error\n        !this.state.isConfigured && dataInfo.push('e:empty');\n        !this.state.isRegistered && dataInfo.push('e:unregistered');\n        this.state.error && dataInfo.push('e:error');\n\n        return `{${dataInfo.join(',')}}`;\n    }\n\n    /**\n     * Conducts the server side render and returns the result.\n     * If disable SSR Error Checking flag is turned on, the React Element is returned immediately,\n     * otherwise the render result is calculated using renderToString to catch errors\n     * and defer modules (used for editor and debug scenarios)\n     */\n    // tslint:disable-next-line: no-any\n    private _doServerSideRender(\n        // tslint:disable-next-line: no-any\n        mappedProps: any,\n        // tslint:disable-next-line: no-any\n        Component: React.ComponentClass<{}, any>,\n        internalTelemetry: InternalTelemetry\n    ): JSX.Element {\n        let renderHtmlString: string;\n        const renderHtml = (\n            <CoreContext.Provider value={this.props.context}>\n                <ReportChunks report={this.props.addChunk}>\n                    <Component {...mappedProps} {...{ renderModuleAttributes: this.renderModuleAttributes, renderView: renderView }} />\n                </ReportChunks>\n            </CoreContext.Provider>\n        );\n        if (this.disableSSRErrorChecks) {\n            // In non editorial or non debug mode and if app setting to disable server side error checking is turned on\n            // return the JSX directly without computing the render result to save time and compute cost\n            return renderHtml;\n        } else {\n            try {\n                // tslint:disable-next-line:no-require-imports\n                renderHtmlString = require('react-dom/server').renderToString(renderHtml);\n                if (!renderHtmlString.length) {\n                    // module returned null\n                    this.props.store.markModuleAsDeferred(this.props.id);\n                }\n            } catch (e) {\n                internalTelemetry.log(LogLevel.Error, `Safe Render module Failed to render type-'{typeName}' with id-'{id}'`, {\n                    exception: e,\n                    values: [asSystemMetadata(this.props.typeName), asSystemMetadata(this.props.id)]\n                });\n                return (\n                    <ErrorModule\n                        {...mappedProps}\n                        errorType='error'\n                        error={e}\n                        message={e && e.stack}\n                        renderModuleAttributes={this.renderModuleAttributes}\n                        renderView={renderView}\n                    />\n                );\n            }\n            // tslint:disable:react-no-dangerous-html -- intentionally set inner html\n            return React.createElement(SDK_FRAGMENT_NAME, { key: this.props.id, dangerouslySetInnerHTML: { __html: renderHtmlString } });\n        }\n    }\n\n    /**\n     * Assignes data-i and data-t attributes to child component if isEditor is enabled\n     */\n    private _setDataAttributes(): void {\n        let refNode;\n        if (this._isEditorial()) {\n            // If type name only exists on the props then this module is not registered.\n            if (this.state.error || !this.state.isRegistered || !this.state.isConfigured) {\n                refNode = document.getElementById(this.props.id);\n            } else if (this.componentRef.current) {\n                refNode = this.props.root\n                    ? document.getElementById(LAYOUT_MOUNT_POINT)\n                    : (ReactDOM.findDOMNode(this.componentRef.current) as Element);\n            }\n        }\n\n        if (refNode && typeof refNode.setAttribute === 'function') {\n            refNode.setAttribute('data-i', this._generateDataInfo());\n        }\n    }\n\n    private _setErrorStates(): void {\n        const isMounted = this.state.mounted;\n        const mappedProps = mapStateToProps(this.props.store, this.props, isMounted);\n\n        // Registration check\n        const isRegistered = !!mappedProps.component;\n        if (isRegistered !== this.state.isRegistered) {\n            this.setState({ ...this.state, isRegistered: isRegistered });\n            return;\n        }\n\n        // Configuration check\n        const isConfigured = !(mappedProps.configErrors && mappedProps.configErrors.length > 0);\n        if (isConfigured !== this.state.isConfigured) {\n            this.setState({ ...this.state, isConfigured: isConfigured });\n            return;\n        }\n    }\n}\n\nexport const getRenderSlotComponent = (\n    parentProps: IGeneric<IAny>,\n    moduleConfigs: IModuleContract[],\n    slotId: string,\n    addSiblingIndices?: number[],\n    isMounted?: boolean\n): React.ReactNode[] => {\n    if (!moduleConfigs) {\n        return [];\n    }\n\n    const canAddAtIndex = (index: number) => {\n        return addSiblingIndices ? addSiblingIndices.indexOf(index + 1) >= 0 : false;\n    };\n    // if addSiblingIndices is not undefined, we add the AddModuleControl components between each module; but in hidden state if index value isnt provider\n    // this prevents re-rendering of the module when the AddModuleControl components are enabled/disabled\n    // in preview mode, addSiblingIndices will be undefined and we will only render the modules\n    return moduleConfigs.map((moduleConfig: IModuleContract, index: number) => {\n        return addSiblingIndices && isMounted ? (\n            <AddModuleWrapper\n                safeRenderProps={{\n                    key: moduleConfig.id,\n                    ...moduleConfig,\n                    parentId: parentProps.id,\n                    slotId: slotId,\n                    store: parentProps.store,\n                    addChunk: parentProps.addChunk\n                }}\n                addModuleProps={{\n                    moduleId: parentProps.id,\n                    index: index + 1,\n                    enabled: canAddAtIndex(index),\n                    slotId: slotId,\n                    mode: AddControlMode.Sibling\n                }}\n            />\n        ) : (\n            <SafeRenderModuleWithContext\n                key={moduleConfig.id}\n                {...moduleConfig}\n                parentId={parentProps.id}\n                slotId={slotId}\n                store={parentProps.store}\n                addChunk={parentProps.addChunk}\n            />\n        );\n    });\n};\n\n/**\n * Maps the application state to the modules props\n * @param state The application state\n * @param ownProps The props for the specific module\n */\nconst mapStateToProps = (store: PageContext, props: TSafeRenderModuleProps, isMounted?: boolean): IModule<IGeneric<IAny>> => {\n    try {\n        const { internalTelemetry } = props;\n        const moduleConfig = getModuleConfig(store, props.id);\n        if (!moduleConfig) {\n            internalTelemetry.log(\n                LogLevel.Error,\n                internalTelemetry.stringFormat(EXCEPTION_MISSINGMODULECONFIG, [props.id, props.typeName])\n            );\n            return {} as IModule<IGeneric<IAny>>;\n        }\n\n        // TODO - following statements introducing side effect in render method (props should not change in render). Please take a look after public preview\n        // Pull value out of stuff that came from cache (doing this gives us reactivity via MobX)\n        Object.keys(moduleConfig.data).forEach(key => {\n            if (moduleConfig.data[key] && moduleConfig.data[key].Item) {\n                moduleConfig.data[key] = moduleConfig.data[key].Item;\n            }\n        });\n\n        // @ts-ignore\n        const moduleBinder = msdyn365Commerce.moduleBinder(moduleConfig.typeName);\n        if (!moduleBinder) {\n            internalTelemetry.log(LogLevel.Error, EXCEPTION_NOMODULEBINDER, { values: [asSystemMetadata(moduleConfig.typeName)] });\n            return {} as IModule<IGeneric<IAny>>;\n        }\n        const enableAddModuleControls = isAuthoringEditEnabled(store.requestContext);\n        return {\n            ...props,\n            ...moduleConfig,\n            component: moduleBinder.component,\n            slots: enableAddModuleControls ? getSlotDictionary(props, moduleConfig.slotsForAddModule, isMounted) : getSlotDictionary(props)\n        };\n    } catch (e) {\n        props.internalTelemetry.log(LogLevel.Error, props.internalTelemetry.stringFormat(EXCEPTION_MODULERENDERFAIL, [props.id]), {\n            exception: e\n        });\n        return {} as IModule<IGeneric<IAny>>;\n    }\n};\n\nconst getModuleConfig = (store: PageContext, moduleId: string): IModule => {\n    return store.modules(moduleId);\n};\n\nconst getSlotDictionary = (\n    props: IGeneric<IAny>,\n    slotsForAddModule?: IAddModuleSlot[],\n    isMounted?: boolean\n): IDictionary<React.ReactNode[]> => {\n    const slotDictionary: IDictionary<React.ReactNode[]> = {};\n    const { modules } = props;\n    const slotsWithAddModuleControls = (slotsForAddModule || []).filter(a => !a.index && a.slotName);\n    const addSiblingIndexDictionary: { [key: string]: number[] } = {};\n    (slotsForAddModule || [])\n        .filter(a => a.index && !a.slotName)\n        .forEach(a => {\n            addSiblingIndexDictionary[a.slotId] = a.index || [];\n        });\n    // removes placeholder 'click here to configure' modules\n    // tslint:disable-next-line:no-any\n    const getNonPlaceholderModules = (mods: any[]) => {\n        return mods.filter(a => a.typeName !== 'place-holder-for-container-preview');\n    };\n    if (modules) {\n        Object.keys(modules).forEach((key: string) => {\n            slotDictionary[key] = getRenderSlotComponent(\n                props,\n                getNonPlaceholderModules(modules[key]),\n                key,\n                slotsForAddModule ? addSiblingIndexDictionary[key] || [] : undefined,\n                isMounted\n            );\n        });\n    }\n    slotsWithAddModuleControls.forEach((slot: IAddModuleSlot) => {\n        if (isMounted && (!modules || !modules[slot.slotId] || getNonPlaceholderModules(modules[slot.slotId]).length === 0)) {\n            slotDictionary[slot.slotId] = [\n                // tslint:disable-next-line:jsx-wrap-multiline\n                <AddModuleControl\n                    key={`${props.id}.${slot}`}\n                    moduleId={props.id}\n                    enabled={true}\n                    slotId={slot.slotId}\n                    parentId={props.parentId}\n                    slotName={slot.slotName}\n                    mode={AddControlMode.EmptySlot}\n                />\n            ];\n        }\n    });\n    return slotDictionary;\n};\n\nconst SafeRenderModuleWithContext = WithContext(SafeRenderModule);\nexport default SafeRenderModuleWithContext;\n"]}