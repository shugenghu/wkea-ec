{"version":3,"file":"add-module-control.js","sourceRoot":"","sources":["../../../src/components/add-module-control.tsx"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\nimport { ICacheItem } from '@msdyn365-commerce/cache-internal';\nimport React from 'react';\nimport { getRenderingHelper } from '../utils/helpers';\n\nexport type IAddModuleProps = {\n    moduleId: string;\n    slotId: string;\n    enabled: boolean;\n    mode: AddControlMode;\n    index?: number;\n    slotName?: string;\n    parentId?: string;\n};\n\nexport enum AddControlMode {\n    EmptySlot,\n    Sibling\n}\nexport interface IAddModuleState {\n    moduleId: string;\n}\n\n/**\n * Editable field component, containing all the logic for inline editable properties in editorial preview\n * Current support: text, image\n */\nexport class AddModuleControl extends React.Component<IAddModuleProps, IAddModuleState> {\n    public constructor(props: IAddModuleProps) {\n        super(props);\n        this.state = {\n            moduleId: props.moduleId\n        };\n    }\n    public render(): JSX.Element | null {\n        if (!this.props.enabled) {\n            return null;\n        }\n        const localizedStrings = {\n            insertModule:\n                this.getLocalizedStringsfromTools('insertModule') !== ''\n                    ? this.getLocalizedStringsfromTools('insertModule')\n                    : 'Insert module',\n            insertFragment:\n                this.getLocalizedStringsfromTools('insertFragment') !== ''\n                    ? this.getLocalizedStringsfromTools('insertFragment')\n                    : 'Insert fragment',\n            moveNotAllowed:\n                this.getLocalizedStringsfromTools('moveNotAllowed') !== ''\n                    ? this.getLocalizedStringsfromTools('moveNotAllowed')\n                    : 'Move not allowed'\n        };\n\n        const button = (tooltip: string) => {\n            return (\n                <div\n                    title={tooltip}\n                    aria-label={tooltip}\n                    className='add-module-button'\n                    role='button'\n                    id={this.getAddButtonId()}\n                    onClick={this.toggleMenuDisplay}\n                    onKeyDown={this.onKeyPressMenu}\n                    tabIndex={0}\n                >\n                    <div className='add-module-icon'>\n                        <svg viewBox='0 0 2048 2048'>\n                            <path className='ms-add-module-icon' d='M1963 939v85h-939v939h-85v-939H0v-85h939V0h85v939h939z' />\n                        </svg>\n                    </div>\n                    <div className='add-button-group' id={this.getAddButtonMenuId()}>\n                        <button onClick={this.addModule} tabIndex={0} onKeyDown={this.onKeyPressAddModule}>\n                            {localizedStrings.insertModule}\n                        </button>\n                        <button onClick={this.addFragment} tabIndex={0} onKeyDown={this.onKeyPressAddFragment}>\n                            {localizedStrings.insertFragment}\n                        </button>\n                    </div>\n                </div>\n            );\n        };\n        if (this.props.mode === AddControlMode.Sibling) {\n            return (\n                <div className='add-sibling'>\n                    <div className='add-ruler' />\n                    <div className='add-sibling-inner'>{button(`Add a module to ${this.props.slotName || this.props.slotId}`)}</div>\n                    <div className='add-ruler' />\n                </div>\n            );\n        } else {\n            const parentData = this.props.parentId ? `,p:${this.props.parentId}` : '';\n            return (\n                <div className='add-container' data-i={`{id:${this.props.moduleId},s:${this.props.slotId},t:empty-slot${parentData}}`}>\n                    <div className='add-container-inner'>\n                        <div className='default-buttons'>{button(`Configure ${this.props.slotName || this.props.slotId}`)}</div>\n                        <div className='placeholder-drop'>\n                            <div className='placeholder-drop-icon'>\n                                <div className='ondrop-module placeholder-drop-icon-bg'>\n                                    <svg viewBox='0 0 2048 2048'>\n                                        <path\n                                            className='ms-drop-module-slot-icon'\n                                            d='M768 1664h128v128H768v-128zm256 0h128v128h-128v-128zm-512 0h128v128H512v-128zm1152-896h-128V640h128v128zm256-384v1664H256v-640H0V0h731l384 384h805zm-1152 0h165L768 219v165zm256 896V512H640V128H128v1152h896zm768-768h-640v896H640v128H512v-128H384v512h1408V512zm-384 1280h-128v-128h128v128zm256 0h-128v-128h128v128zm0-768h-128V896h128v128zm-256-256h-128V640h128v128zm256 512h-128v-128h128v128zm0 256h-128v-128h128v128z'\n                                        />\n                                    </svg>\n                                </div>\n                                <div className='ondrop-fragment placeholder-drop-icon-bg'>\n                                    <svg viewBox='0 0 2048 2048'>\n                                        <path\n                                            className='ms-drop-module-slot-icon'\n                                            d='M768 1664h128v128H768v-128zm256 0h128v128h-128v-128zm-512 0h128v128H512v-128zm1152-896h-128V640h128v128zm256-384v1664H256v-640H0V0h731l384 384h805zm-1152 0h165L768 219v165zm256 896V512H640V128H128v1152h896zm768-768h-640v896H640v128H512v-128H384v512h1408V512zm-384 1280h-128v-128h128v128zm256 0h-128v-128h128v128zm0-768h-128V896h128v128zm-256-256h-128V640h128v128zm256 512h-128v-128h128v128zm0 256h-128v-128h128v128z'\n                                        />\n                                    </svg>\n                                </div>\n                                <div className='ondrop-error placeholder-drop-icon-error-bg'>\n                                    <svg viewBox='0 0 2048 2048'>\n                                        <path\n                                            className='ms-add-module-error-icon'\n                                            d='M960 0q132 0 255 34t229 97 194 150 150 194 97 230 35 255q0 133-34 255t-97 229-150 194-194 150-230 97-255 35q-133 0-255-34t-229-97-194-150-150-194-97-230T0 960q0-132 34-255t97-229 150-194 194-150 230-97T960 0zm576 1024V896H384v128h1152z'\n                                        />\n                                    </svg>\n                                </div>\n                            </div>\n                            <span className='ondrop-module'>{localizedStrings.insertModule}</span>\n                            <span className='ondrop-fragment'>{localizedStrings.insertFragment}</span>\n                            <span className='ondrop-error'>{localizedStrings.moveNotAllowed}</span>\n                        </div>\n                    </div>\n                </div>\n            );\n        }\n    }\n\n    public toggleMenuDisplay = () => {\n        const button = document.getElementById(this.getAddButtonId());\n        const menu = document.getElementById(this.getAddButtonMenuId());\n        if (button && menu) {\n            if (menu.style.display === 'block') {\n                menu.style.display = 'none';\n            } else {\n                menu.style.display = 'block';\n            }\n        }\n    };\n\n    public hideMenuDisplay = () => {\n        const button = document.getElementById(this.getAddButtonId());\n        const menu = document.getElementById(this.getAddButtonMenuId());\n        if (button && menu) {\n            menu.style.display = 'none';\n        }\n    };\n\n    public getAddButtonId = () => {\n        return this.props.index\n            ? `add-${this.props.moduleId}-${this.props.slotId}-${this.props.index}`\n            : `add-${this.props.moduleId}-${this.props.slotId}`;\n    };\n\n    public onKeyPressMenu = (event: React.KeyboardEvent) => {\n        if (event.key === 'Enter') {\n            this.toggleMenuDisplay();\n        } else if (event.key === 'Escape') {\n            this.hideMenuDisplay();\n        }\n    };\n\n    public onKeyPressAddModule = (event: React.KeyboardEvent) => {\n        if (event.key === 'Enter') {\n            this.addModule();\n        } else if (event.key === 'Escape') {\n            this.hideMenuDisplay();\n        }\n    };\n\n    public onKeyPressAddFragment = (event: React.KeyboardEvent) => {\n        if (event.key === 'Enter') {\n            this.addFragment();\n        } else if (event.key === 'Escape') {\n            this.hideMenuDisplay();\n        }\n    };\n\n    public getAddButtonMenuId = () => {\n        return this.props.index\n            ? `add-menu-${this.props.moduleId}-${this.props.slotId}-${this.props.index}`\n            : `add-menu-${this.props.moduleId}-${this.props.slotId}`;\n    };\n\n    public addModule = () => {\n        this.toggleMenuDisplay();\n        const helper = getRenderingHelper();\n        if (helper) {\n            helper.addModule(this.props.moduleId, this.props.slotId, this.props.index || 0);\n        }\n    };\n\n    public addFragment = () => {\n        this.toggleMenuDisplay();\n        const helper = getRenderingHelper();\n        if (helper) {\n            helper.addFragment(this.props.moduleId, this.props.slotId, this.props.index || 0);\n        }\n    };\n\n    public getLocalizedStringsfromTools = (stringName: string): string => {\n        const helper = getRenderingHelper();\n        if (helper && typeof helper.getLocalizedString === 'function') {\n            return helper.getLocalizedString(stringName);\n        }\n        return '';\n    };\n}\n"]}