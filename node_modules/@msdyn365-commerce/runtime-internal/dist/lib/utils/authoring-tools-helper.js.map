{"version":3,"file":"authoring-tools-helper.js","sourceRoot":"","sources":["../../../src/utils/authoring-tools-helper.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n// tslint:disable: no-any\nimport { ICache } from '@msdyn365-commerce/cache-internal';\nimport {\n    CoreContext,\n    IActionContext,\n    IAddModuleSlot,\n    IConfigError,\n    ICoreContext,\n    IImageSettings,\n    IModuleContract,\n    IPartnerThemeSettings,\n    IRenderingHelper,\n    onDrag as _onDrag,\n    PROPERTY_INIT,\n    removePlaceholder as _removePlaceholder,\n    setDraggable as _setDraggable\n} from '@msdyn365-commerce/core-internal';\nimport { IDictionary, IProductList } from '@msdyn365-commerce/retail-proxy';\nimport { generateEventNameHash, InternalTelemetry, Telemetry } from '@msdyn365-commerce/telemetry-internal';\nimport { cloneDeep as _cloneDeep, get as _get, isEqual as _isEqual, pullAt as _pullAt, remove as _remove, set as _set } from 'lodash';\nimport { toJS } from 'mobx';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { SafeRenderModule } from '../components/safe-render-module';\nimport {\n    LAYOUT_MOUNT_POINT,\n    MODULE_ACTION_KEY,\n    MODULE_CACHE_KEY,\n    MODULE_CONFIG_ERRORS_KEY,\n    MODULE_CONFIG_KEY,\n    MODULE_DATA_KEY,\n    MSDYN365_WYSIWYG_CANADDMODULE,\n    MSDYN365_WYSIWYG_DISABLED_PROPS\n} from '../consts';\nimport { loadData } from '../data/load-data';\nimport { IProductListMetaData } from '../hydrators/hydrator-action-inputs';\nimport { hydrateProductList } from '../hydrators/product-list-hydrator';\nimport { disableChildModules, findModule } from '../store/authoring-edit-helper';\nimport { PageContext } from '../store/page-context';\nimport {\n    constructVideoInformation,\n    constructViewportInformationForImage,\n    deleteCacheEntriesForModuleId,\n    getPropertyFromDataIAttribute,\n    IImageData,\n    IVideoData,\n    moveArrayItem,\n    resolveTypesInConfig\n} from './authoring-tools-helper-utils';\nimport { getFlattenedListOfModulesForFragment } from './get-modules-flat-list';\n\ndeclare var window: ClientWindow;\n\ninterface IModuleContent {\n    data?: unknown;\n    config?: unknown;\n    friendlyName: string;\n    configErrors?: IConfigError[];\n}\n\nenum MODULE_OPERATION {\n    Find,\n    Remove,\n    Add,\n    Move\n}\n\ninterface IExpEventName {\n    eventIdName: string;\n    eventIdHash: string;\n}\n\ninterface IModuleOperationInfo {\n    moduleSlotName?: string;\n    moduleToAdd?: any;\n    newIndex?: number;\n    deleteAfterFind?: boolean;\n}\n\n/**\n * Provides the CMS tooling a way to update the CMS content\n */\nexport class AuthoringToolsHelper {\n    // helper class on site builder which SDK can call for information/context about site builder\n    public renderingHelper: IRenderingHelper | undefined;\n    private cache: ICache;\n    private readonly actionContext: IActionContext;\n    private readonly themeSettings: IPartnerThemeSettings;\n    private coreContext: ICoreContext;\n    private pageContext: PageContext;\n    private moduleTelemetry: Telemetry;\n    private didFindModule: boolean = false;\n    private foundModule: any;\n    private enableAuthoringRemoveAndAddModule: boolean = false;\n\n    constructor(\n        actionContext: IActionContext,\n        themeSettings: IPartnerThemeSettings,\n        coreContext: ICoreContext,\n        pageContext: PageContext,\n        moduleTelemetry: Telemetry\n    ) {\n        this.cache = pageContext.requestCache;\n        this.actionContext = actionContext;\n        this.themeSettings = themeSettings;\n        this.coreContext = coreContext;\n        this.pageContext = pageContext;\n        this.moduleTelemetry = moduleTelemetry;\n        this.enableAuthoringRemoveAndAddModule =\n            coreContext.request.features && coreContext.request.features.enableAuthoringRemoveAndAddModule;\n    }\n\n    public initRenderingHelper(renderingHelper: IRenderingHelper): void {\n        this.renderingHelper = renderingHelper;\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.updateModule(\n     *  \"HELLO-WORLD__0\",\n     *  {\n     *     \"data\": {\n     *          \"myTitle\": {\"$type\":\"heading\",\"_id\":\"xekqxgmtadc\", \"text\":\"Hello World Heading\"},\n     *          \"myText\": {\"$type\":\"simpleText\",\"_id\":\"hkd849ztr3x\", \"text\":\"Hello............\"}\n     *      },\n     *     \"config\": {\n     *          showText: \"test 123\"\n     *     },\n     *     \"configErrors\": []\n     * })\n     */\n    public updateModule(moduleId: string, content: IModuleContent): boolean {\n        if (!moduleId || !moduleId.length) {\n            // TODO: Log to telemetry\n            return false;\n        }\n\n        if (!content || (!content.data && !content.config)) {\n            return false;\n        }\n\n        let updated: boolean = false;\n        if (content.data) {\n            updated = this.cache.put({ typeName: MODULE_DATA_KEY, key: moduleId }, { item: content.data });\n        }\n\n        if (content.config) {\n            updated = this.cache.put({ typeName: MODULE_CONFIG_KEY, key: moduleId }, { item: content.config }) || updated;\n        }\n\n        if (content.configErrors) {\n            updated = this.cache.put({ typeName: MODULE_CONFIG_ERRORS_KEY, key: moduleId }, { item: content.configErrors });\n        }\n\n        return updated;\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.updateModuleConfig(\n     *  \"HELLO-WORLD__0\",\n     *  {\n     *          showText: \"test 123\"\n     * })\n     */\n    public updateModuleConfig(moduleId: string, config: unknown, configErrors: IConfigError[]): boolean {\n        if (!moduleId || !moduleId.length || !config || !configErrors) {\n            // TODO: Log to telemetry\n            console.log('configErrors is a required argument to updateModuleConfig');\n            return false;\n        }\n        // In case of errors, first update module config errors so that the module does not try to render\n        // In the case of no errors, put the valid config object in first so that module does render\n        if (configErrors.length > 0) {\n            this.updateModuleConfigErrors(moduleId, configErrors);\n            return this.cache.put({ typeName: MODULE_CONFIG_KEY, key: moduleId }, { item: config });\n        } else {\n            this.cache.put({ typeName: MODULE_CONFIG_KEY, key: moduleId }, { item: config });\n            return this.updateModuleConfigErrors(moduleId, configErrors);\n        }\n    }\n\n    public updateModuleClassName(\n        moduleId: string,\n        propertyName: string,\n        oldValue: string,\n        newValue: string,\n        configErrors: IConfigError[]\n    ): boolean {\n        if (!moduleId || !moduleId.length || !propertyName || !configErrors) {\n            return false;\n        }\n\n        const moduleConfig = this.cache.get<object>({ typeName: MODULE_CONFIG_KEY, key: moduleId });\n        if (!moduleConfig) {\n            return false;\n        }\n        let moduleConfigItem = moduleConfig.item;\n        if (!moduleConfigItem) {\n            moduleConfigItem = {};\n        }\n\n        const className: string = _get(moduleConfigItem, 'className', '');\n        const classNameParts: string[] = className.split(' ');\n\n        let oldPropertyKeyValue = `${propertyName}__${oldValue}`;\n        let newPropertyKeyValue = `${propertyName}__${newValue}`;\n        // If property is class name root, set the old and new property keys to the old and new class name root values.\n        // Otherwise, leave it as <propertyName>__<value> and update the config item property.\n        if (propertyName === 'className') {\n            oldPropertyKeyValue = oldValue;\n            newPropertyKeyValue = newValue;\n        } else {\n            _set(moduleConfigItem, propertyName, newValue);\n        }\n\n        // If new value is set, replace the old <propertyName>__<value> pair with the new one.\n        // Otherwise, push the new <propertyName>__<value> pair to the end of class name.\n        if (newValue) {\n            const partIdx = classNameParts.findIndex(part => part.includes(oldPropertyKeyValue));\n            if (partIdx >= 0) {\n                classNameParts[partIdx] = newPropertyKeyValue;\n            } else {\n                classNameParts.push(newPropertyKeyValue);\n            }\n        } else {\n            // If new value is not set, remove old <propertyName>__<value> pair from class name.\n            _remove(classNameParts, part => part.includes(oldPropertyKeyValue));\n        }\n\n        // Update class name according to all its parts.\n        _set(moduleConfigItem, 'className', classNameParts.join(' '));\n\n        return this.updateModuleConfig(moduleId, moduleConfigItem, configErrors);\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.updateModuleConfigErrors(\n     *  \"HELLO-WORLD__0\",\n     *  [{\n     *          message: \"heading_text is not configured\",\n     *          property: \"heading_text\"\n     *  }])\n     */\n    public updateModuleConfigErrors(moduleId: string, configErrors: IConfigError[]): boolean {\n        if (!moduleId || !moduleId.length) {\n            // TODO: Log to telemetry\n            return false;\n        }\n\n        return this.cache.put({ typeName: MODULE_CONFIG_ERRORS_KEY, key: moduleId }, { item: configErrors });\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.updateModuleImage(\n     *  \"HELLO-WORLD__0\",\n     *  \"['images', '0', 'primaryImage'\"],\n     *   {\n     *       \"source\": \"https://image-url-here\",\n     *       \"altText\": \"alt-text\",\n     *       \"$type\": \"image\",\n     *       \"imageQuality\": 80\n     *       \"title\": \"image title\"\n     *  }, []);\n     */\n    public updateModuleImage(moduleId: string, pathToField: string[], imageData: IImageData, configErrors: IConfigError[] = []): boolean {\n        if (!moduleId || !moduleId.length) {\n            return false;\n        }\n\n        const moduleConfig = this.cache.get<object>({ typeName: MODULE_CONFIG_KEY, key: moduleId });\n        // @ts-ignore typename exists on the cache entry for module\n        const moduleType = this.cache.get<object>({ typeName: MODULE_CACHE_KEY, key: moduleId })?.item?.typeName;\n        if (!moduleConfig) {\n            return false;\n        }\n        let moduleConfigItem = toJS(moduleConfig.item);\n        if (!moduleConfigItem) {\n            moduleConfigItem = {};\n        }\n\n        // @ts-ignore - this is known property that tools will set for the module layout\n        const moduleLayout = moduleConfig.item?.msdyn365__moduleLayout;\n        // Construct the viewport image settings information using the current theme and module\n        const viewportInfo = constructViewportInformationForImage(\n            moduleType,\n            moduleLayout,\n            pathToField,\n            imageData.imageQuality,\n            this.themeSettings,\n            imageData.focalRegion,\n            imageData.cropRegions,\n            imageData.format\n        ).viewports;\n\n        _set(moduleConfigItem, pathToField, {\n            src: imageData.source,\n            $type: imageData.$type,\n            altText: imageData.altText,\n            title: imageData.title,\n            imageSettings: {\n                quality: imageData.imageQuality,\n                viewports: viewportInfo\n            }\n        });\n\n        return this.updateModuleConfig(moduleId, moduleConfigItem, configErrors);\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.updateModuleVideo(\n     *  \"HELLO-WORLD__0\",\n     *  \"['videos', '0', 'primaryVideo'\"],\n     *   {\n     *       binaryReferences: [\n     *           {\n     *           $type: 'videoBinaryReference',\n     *           alias: '1001',\n     *           contentType: 'video/mp4',\n     *           extension: '.mp4',\n     *           sourceHref: 'https://streaming-west-prod.cms.commerce.dynamics.com/0c38a35a-159e-4603-9ad6-82b721f07274/1dc55c98-7d32-4ab8-9be9-5da298b4ce81.mp4',\n     *           format: '1001',\n     *           clientHref: 'https://streaming-west-prod.cms.commerce.dynamics.com/0c38a35a-159e-4603-9ad6-82b721f07274/1dc55c98-7d32-4ab8-9be9-5da298b4ce81.mp4'\n     *           },\n     *       title: 'Homepage video',\n     *       fileName: '7e181ddf-1d45-497c-ba99-d17af574_650.mp4',\n     *       playtime: 13,\n     *       thumbnail: {\n     *           $type: 'image',\n     *           source: 'https://cms-ppe-imageresizer-mr.trafficmanager.net/cms/api/phpjqgrmtp/imageFileData/MAkOl',\n     *           title: 'Homepage video Thumbnail',\n     *           imageQuality: 70,\n     *       },\n     *       interactiveTriggersEnabled: false\n     *       }, []);\n     */\n    public updateModuleVideo(moduleId: string, pathToField: string[], videoData: IVideoData, configErrors: IConfigError[] = []): boolean {\n        if (!moduleId || !moduleId.length) {\n            return false;\n        }\n\n        const moduleConfig = this.cache.get<object>({ typeName: MODULE_CONFIG_KEY, key: moduleId });\n        if (!moduleConfig) {\n            return false;\n        }\n        let moduleConfigItem = toJS(moduleConfig.item);\n        if (!moduleConfigItem) {\n            moduleConfigItem = {};\n        }\n\n        // Construct the viewport image settings information using the current theme and module\n        const video = constructVideoInformation(videoData, moduleId);\n\n        _set(moduleConfigItem, pathToField, video);\n\n        return this.updateModuleConfig(moduleId, moduleConfigItem, configErrors);\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.updateModuleProductCollection(\n     *  \"HELLO-WORLD__0\",\n     *  \"['productCollection', 'products'\"],\n     *   {\n     *       \"listType\": \"recommendation\",\n     *       \"recommendationListId\": \"fbt\"\n     *  });\n     */\n    public async updateModuleProductCollection(\n        moduleId: string,\n        pathToField: string[],\n        listMetadata: IProductListMetaData,\n        configErrors: IConfigError[] = []\n    ): Promise<boolean> {\n        if (!moduleId || !moduleId.length) {\n            return false;\n        }\n\n        const moduleConfig = this.cache.get<object>({ typeName: MODULE_CONFIG_KEY, key: moduleId });\n        if (!moduleConfig) {\n            return false;\n        }\n        let moduleConfigItem = toJS(moduleConfig.item);\n        if (!moduleConfigItem) {\n            moduleConfigItem = {};\n        }\n\n        await hydrateProductList(listMetadata, this.actionContext);\n        if (!(<IProductList>(<unknown>listMetadata)).products) {\n            return false;\n        }\n\n        _set(moduleConfigItem, pathToField, listMetadata);\n        return this.updateModuleConfig(moduleId, moduleConfigItem, configErrors);\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.removeModule(\"HELLO-WORLD__0\", []);\n     * window._msdyn365.authoringHelper.removeModule(\"DEFAULT-CONTAINER__0\", [\"HERO__0\", \"HERO__1\"]);\n     */\n    public removeModule(moduleId: string, childrenIds: string[], removeFromPageFragment: boolean = false): boolean {\n        const pageRoot = this._checkForFeatureFlagAndGetPageRoot(removeFromPageFragment);\n        if (!pageRoot) {\n            return false;\n        }\n\n        // Remove module from the pageRoot\n        this._findModule(pageRoot, moduleId, MODULE_OPERATION.Remove, {});\n\n        // Remove module and its children from _moduleList\n        // @ts-ignore _moduleList is a private property of pageContext\n        this.pageContext._moduleList = this.pageContext._moduleList.filter(obj => {\n            return obj.id !== moduleId && childrenIds.indexOf(obj.id) === -1;\n        });\n\n        deleteCacheEntriesForModuleId(moduleId, this.cache);\n\n        for (let i = 0; i < childrenIds.length; i++) {\n            deleteCacheEntriesForModuleId(childrenIds[i], this.cache);\n        }\n        return this._renderPage(moduleId);\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.moveModule(\"HELLO-WORLD__0\", \"DEFAULT-CONTAINER__0\", 0);\n     *\n     * If slot name is not provided the module will be moved within its current slot and cannot be moved to a new parent\n     */\n    public moveModule(\n        moduleId: string,\n        parentId: string,\n        newIndex: number,\n        moduleSlotName?: string,\n        moveFromPageFragment: boolean = false\n    ): boolean {\n        const pageRoot = this._checkForFeatureFlagAndGetPageRoot(moveFromPageFragment);\n        if (!pageRoot) {\n            return false;\n        }\n\n        // If no slot name is provided move the module within its own slot\n        if (!moduleSlotName) {\n            this._findModule(pageRoot, moduleId, MODULE_OPERATION.Move, { newIndex: newIndex });\n        } else {\n            // Find and grab reference to the module that is supposed to be moved\n            this._findModule(pageRoot, moduleId, MODULE_OPERATION.Find, { deleteAfterFind: true });\n            const moduleToMove = this.foundModule;\n\n            if (!moduleToMove) {\n                console.log(`Unable to find module with id ${moduleId} in page structure. Aborting move.`);\n                return false;\n            }\n\n            // Now find and grab a reference to the parent to which this module should be moved to\n            this._findModule(pageRoot, parentId, MODULE_OPERATION.Find, {});\n            const parentModule = this.foundModule;\n\n            if (!parentModule) {\n                console.log(`Unable to find parent module with id ${parentId} in page structure. Aborting move.`);\n                return false;\n            }\n            // Move module to new parent\n            // If the slot doesn't exist, create it\n            if (!parentModule.modules || !parentModule.modules[moduleSlotName]) {\n                _set(parentModule, ['modules', moduleSlotName], []);\n            }\n            moveArrayItem(parentModule.modules[moduleSlotName], newIndex, moduleToMove);\n        }\n\n        try {\n            return this._renderPage(moduleId);\n        } catch (err) {\n            console.log(`Uncaught error when moving module ${moduleId}`);\n            console.log(err);\n            return false;\n        }\n    }\n\n    /**\n     * Helper function used to sync the placeholder between rendering and tools in drag/drop scenarios\n     * @param parentId module id where the module/container needs to be dropped\n     * @param index index position for the module drop\n     * @param slotId slot id where the module/container needs to be dropped\n     */\n    public onDrag(parentId: string, index: number, slotId: string, moduleId?: string): void {\n        _onDrag(parentId, index, slotId, moduleId);\n    }\n\n    /**\n     * Helper function used to set modules as draggable in drag/drop scenarios.\n     * @param sourceModuleId The module to be set as draggable.\n     */\n    public setDraggable(sourceModuleId: string): void {\n        _setDraggable(sourceModuleId, LAYOUT_MOUNT_POINT);\n    }\n\n    /**\n     * Helper function used to remove the placeholder between rendering and tools in drag/drop scenarios\n     */\n    public removePlaceholder(): void {\n        _removePlaceholder();\n    }\n\n    /**\n     * usage: _msdyn365.authoringHelper.addModule('hero', 'hero__2', 'primaryArea__0', {config:{moduleConfig: 'config value'}});\n     */\n    public async addModule(\n        moduleType: string,\n        moduleId: string,\n        parentId: string,\n        content: IModuleContent,\n        moduleSlotName: string = 'content',\n        addIndex?: number,\n        addFromPageFragment: boolean = false,\n        imagePaths?: string[][]\n    ): Promise<boolean> {\n        if (content.config && typeof content.config === 'object' && imagePaths && imagePaths.length > 0) {\n            this._setImageSettingsForDefaultImage(content.config, moduleType, imagePaths);\n        }\n        // Construct the module object that needs to be added\n        const moduleToAdd: IModuleContract = {\n            typeName: moduleType,\n            id: moduleId,\n            modules: undefined,\n            config: content.config,\n            data: {},\n            dataActions: [],\n            friendlyName: content.friendlyName,\n            configErrors: content.configErrors\n        };\n        return this._addModuleFragment(moduleId, parentId, moduleToAdd, false, moduleSlotName, addIndex, addFromPageFragment);\n    }\n\n    public async addFragment(\n        fragmentId: string,\n        parentId: string,\n        pageFragment: IModuleContract,\n        moduleSlotName: string = 'content',\n        addIndex?: number,\n        addFromPageFragment: boolean = false\n    ): Promise<boolean> {\n        return this._addModuleFragment(fragmentId, parentId, pageFragment, true, moduleSlotName, addIndex, addFromPageFragment);\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.updateModuleData(\n     *  \"HELLO-WORLD__0\",\n     *  {\n     *      \"myTitle\": {\"$type\":\"heading\",\"_id\":\"xekqxgmtadc\", \"text\":\"Hello World Heading\"},\n     *      \"myText\": {\"$type\":\"simpleText\",\"_id\":\"hkd849ztr3x\", \"text\":\"Hello............\"}\n     *  })\n     */\n    public updateModuleData(moduleId: string, data: unknown): boolean {\n        if (!moduleId || !moduleId.length || !data) {\n            // TODO: Log to telemetry\n            return false;\n        }\n\n        return this.cache.put({ typeName: MODULE_DATA_KEY, key: moduleId }, { item: data });\n    }\n\n    public updateDisabledProperties(moduleName: string, disabledProperties: string[], isFragment?: boolean): void {\n        const cacheKey = { typeName: MSDYN365_WYSIWYG_DISABLED_PROPS, key: moduleName };\n        if (_isEqual(this.cache.getValue(cacheKey), disabledProperties)) {\n            // skip re-render if the module already has disabled properties\n            return;\n        }\n\n        this.cache.put(cacheKey, { item: disabledProperties });\n\n        // In case of fragment, disable all child modules\n        if (!!isFragment) {\n            const currentModule = findModule(moduleName, this.pageContext.pageRoot);\n            if (currentModule) {\n                disableChildModules(currentModule, this.cache);\n            }\n        }\n    }\n\n    /**\n     * Helper function used to update the slots available in a container to add modules\n     * @param moduleId module id thats being updated\n     * @param addSlots lists of slots in the module where modules can be added\n     */\n    public updateAddModuleProperties(moduleId: string, addSlots: IAddModuleSlot[]): void {\n        this.cache.put({ typeName: MSDYN365_WYSIWYG_CANADDMODULE, key: moduleId }, { item: addSlots });\n    }\n\n    public getDisabledProperties(moduleName: string): string[] {\n        return this.cache.getValue<string[]>({ typeName: MSDYN365_WYSIWYG_DISABLED_PROPS, key: moduleName }) || [];\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.getModuleConfig(\"HELLO-WORLD__0\");\n     */\n    public getModuleConfig(moduleId: string): unknown {\n        if (!moduleId || !moduleId.length) {\n            // TODO: Log to telemetry\n            return null;\n        }\n\n        const config = this.cache.get({ typeName: MODULE_CONFIG_KEY, key: moduleId });\n\n        if (config && config.item) {\n            return toJS(config.item);\n        }\n\n        return null;\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.getModuleConfigErrors(\"HELLO-WORLD__0\");\n     */\n    public getModuleConfigErrors(moduleId: string): IConfigError[] | null {\n        if (!moduleId || !moduleId.length) {\n            // TODO: Log to telemetry\n            return null;\n        }\n\n        const configErrors = this.cache.get<IConfigError[]>({ typeName: MODULE_CONFIG_ERRORS_KEY, key: moduleId });\n\n        if (configErrors && configErrors.item) {\n            return toJS(configErrors.item);\n        }\n\n        return null;\n    }\n\n    /**\n     * usage:\n     * window._msdyn365.authoringHelper.getModuleData(\"HELLO-WORLD__0\");\n     */\n    public getModuleData(moduleId: string): unknown {\n        if (!moduleId || !moduleId.length) {\n            // TODO: Log to telemetry\n            return null;\n        }\n\n        const data = this.cache.get({ typeName: MODULE_DATA_KEY, key: moduleId });\n\n        if (data && data.item) {\n            return toJS(data.item);\n        }\n\n        return null;\n    }\n\n    /**\n     * This function is deprecated please use the updated function\n     * getExperimentEventHashesForModule\n     * @deprecated\n     * @param moduleId\n     */\n    public getExperimentEventIdsForModule(moduleId: string): IDictionary<string[]> {\n        const plainEventIds: IDictionary<string[]> = {};\n        const eventNameToHashes = this.getExperimentEventHashesForModule(moduleId);\n        Object.keys(eventNameToHashes).forEach((key: string) => {\n            plainEventIds[key] = eventNameToHashes[key].map((value: IExpEventName) => value.eventIdName);\n        });\n        return plainEventIds;\n    }\n\n    /**\n     * Returns mapping of moduleId to an array of objects containing exp event name (\n     * and the SHA-256 hash of its friendly name (used for the actual track event calls)\n     * @param moduleId\n     */\n    public getExperimentEventHashesForModule(moduleId: string): IDictionary<IExpEventName[]> {\n        const moduleIdToEventIds: IDictionary<IExpEventName[]> = {};\n        const moduleIds = [moduleId];\n\n        // Find the element in the DOM\n        const parentElement = document.querySelector(`[data-i*=\"id:${moduleId}\"]`);\n        if (!parentElement) {\n            console.warn(`Unable to find module ${moduleId} on the page`);\n            return moduleIdToEventIds;\n        }\n        // Determine if there are any children modules and those to the list to search for experiment event ids\n        parentElement.querySelectorAll(`[data-i*=\"id:\"]`).forEach((moduleElement: Element) => {\n            const dataIAttribute = moduleElement.getAttribute('data-i');\n            if (dataIAttribute) {\n                const childModuleId = getPropertyFromDataIAttribute(dataIAttribute, 'id');\n                if (childModuleId) {\n                    moduleIds.push(childModuleId);\n                }\n            }\n        });\n        for (let i = 0; i < moduleIds.length; i++) {\n            const currentModuleId = moduleIds[i];\n            // Selects a module with module id that has the data-exp-event-id attribute on its element or on one of its child elements\n            const selector = `[data-i*=\"id:${currentModuleId},\"][data-exp-event-id],[data-i*=\"id:${currentModuleId},\"] [data-exp-event-id]`;\n            const elements = document.querySelectorAll(selector);\n\n            const expEventIds: IExpEventName[] = [];\n            for (let j = 0; j < elements.length; j++) {\n                const element: Element = elements[j];\n                const eventId = element.getAttribute('data-exp-event-id');\n                if (eventId) {\n                    const hash = generateEventNameHash(eventId);\n                    expEventIds.push({ eventIdName: eventId, eventIdHash: hash });\n                }\n            }\n            moduleIdToEventIds[currentModuleId] = expEventIds;\n        }\n        return moduleIdToEventIds;\n    }\n\n    private _checkForFeatureFlagAndGetPageRoot(addFromPageFragment: boolean = false): IModuleContract[] | undefined {\n        if (!this.enableAuthoringRemoveAndAddModule) {\n            console.log(\n                `Authoring helper functionality for add/remove/move module is turned off. Please turn on 'enableAuthoringRemoveAndAddModule' feature to use this API`\n            );\n            return undefined;\n        }\n\n        const pageRoot = this._getPageRoot(addFromPageFragment);\n\n        if (!pageRoot) {\n            return undefined;\n        }\n        return pageRoot;\n    }\n\n    private _getPageRoot(addFromPageFragment: boolean = false): IModuleContract[] | undefined {\n        const pageRoot = this.pageContext.pageRoot;\n        if (pageRoot) {\n            const body = pageRoot.modules?.body;\n            if (!body && addFromPageFragment) {\n                return [pageRoot];\n            }\n            return body;\n        }\n    }\n\n    /**\n     * Renders the page again with the updated page structure\n     */\n    private _renderPage(moduleId: string): boolean {\n        // Used to generate unique keys so that even reused module ID will still trigger re-render\n        const uniqueTime = new Date().getTime();\n        // Get the page structure to pass on to SafeRenderModule\n        const pageRoot = <any>this.pageContext.pageRoot;\n        const body = pageRoot.modules && pageRoot.modules.body;\n        const props = body && body.length > 0 ? body[0] : pageRoot;\n        // Re-hydrate page with new page structure\n        ReactDOM.hydrate(\n            React.createElement(\n                CoreContext.Provider,\n                { value: this.coreContext },\n                React.createElement(SafeRenderModule, {\n                    ...props,\n                    context: this.coreContext,\n                    key: `${moduleId}:${uniqueTime}`,\n                    telemetry: this.moduleTelemetry,\n                    internalTelemetry: window._msdyn365.telemetry,\n                    store: this.pageContext\n                })\n            ),\n            document.getElementById(LAYOUT_MOUNT_POINT)\n        );\n        return true;\n    }\n\n    private _findModule(obj: unknown, moduleId: string, method: MODULE_OPERATION, options: IModuleOperationInfo): void {\n        this.didFindModule = false;\n        this.foundModule = undefined;\n        this._findModuleHelper(obj, moduleId, method, options);\n    }\n\n    // Recurses through the pageRoot structure to find and either remove the module and all of its children\n    // or add a module depending on whether addModule is passed in\n    private _findModuleHelper(obj: unknown, moduleId: string, method: MODULE_OPERATION, options: IModuleOperationInfo): void {\n        if (!obj || this.didFindModule) {\n            return;\n        }\n        if (Array.isArray(obj)) {\n            for (let i = 0; i < obj.length; i++) {\n                if (obj[i].id && obj[i].id === moduleId) {\n                    // Remove module scenario\n                    if (method === MODULE_OPERATION.Remove) {\n                        _pullAt(obj, i);\n                        // Add/Move module scenario\n                    } else if (method === MODULE_OPERATION.Add) {\n                        this._processAddModule(obj[i], options);\n                        // Find module scenario\n                    } else if (method === MODULE_OPERATION.Find) {\n                        // If delete after find is set, remove the element\n                        if (options.deleteAfterFind) {\n                            this.foundModule = _cloneDeep(obj[i]);\n                            _pullAt(obj, i);\n                        } else {\n                            this.foundModule = obj[i];\n                        }\n                    } else if (method === MODULE_OPERATION.Move && options.newIndex !== undefined) {\n                        // Moves a module within its own slot\n                        const itemToMove = _pullAt(obj, i);\n                        moveArrayItem(obj, options.newIndex, itemToMove[0]);\n                    }\n                    this.didFindModule = true;\n                    return;\n                }\n                this._findModuleHelper(obj[i], moduleId, method, options);\n            }\n        } else if (typeof obj === 'object' && obj) {\n            const children = Object.keys(obj);\n            if (children.length > 0) {\n                for (let i = 0; i < children.length; i++) {\n                    this._findModuleHelper(obj[children[i]], moduleId, method, options);\n                }\n            }\n        }\n    }\n\n    private _processAddModule(parentModule: any, options: IModuleOperationInfo): void {\n        if (!options.moduleSlotName) {\n            options.moduleSlotName = 'content';\n        }\n        if (!parentModule.modules || !parentModule.modules[options.moduleSlotName]) {\n            parentModule.modules = {};\n            parentModule.modules[options.moduleSlotName] = [];\n        }\n        if (options.newIndex) {\n            parentModule.modules[options.moduleSlotName].splice(options.newIndex, 0, options.moduleToAdd);\n        } else {\n            parentModule.modules[options.moduleSlotName].push(options.moduleToAdd);\n        }\n        this.foundModule = parentModule;\n    }\n\n    private async _addModuleFragment(\n        fragmentId: string,\n        parentId: string,\n        pageFragment: IModuleContract,\n        isFragmentType: boolean,\n        moduleSlotName: string = 'content',\n        addIndex?: number,\n        addFromPageFragment: boolean = false\n    ): Promise<boolean> {\n        const pageRoot = this._checkForFeatureFlagAndGetPageRoot(addFromPageFragment);\n        if (!pageRoot) {\n            return false;\n        }\n\n        // Get flattened list of modules\n        // If adding a fragment type pass along the fragment id to prepend this id to every module id inside the fragment to avoid any cache collisions\n        // with existing modules on the page\n        const flatListModules = getFlattenedListOfModulesForFragment(pageFragment, isFragmentType ? fragmentId : '');\n\n        // Invoke the helper function to find the parent module and add the module(s) to the page structure\n        this._findModule(pageRoot, parentId, MODULE_OPERATION.Add, {\n            moduleSlotName: moduleSlotName,\n            moduleToAdd: pageFragment,\n            newIndex: addIndex\n        });\n\n        if (!this.foundModule) {\n            throw new Error(`Unable to find parent module with id ${parentId}`);\n        }\n\n        // Add items to the cache for the new module(s)\n        for (let i = 0; i < flatListModules.length; i++) {\n            const curModule = flatListModules[i];\n            this.cache.put({ typeName: MODULE_CACHE_KEY, key: curModule.id }, { item: { id: curModule.id, typeName: curModule.typeName } });\n            // @ts-ignore - this is known property that tools will set for the module layout\n            const moduleLayout = curModule.config?.msdyn365__moduleLayout;\n            resolveTypesInConfig(<any>curModule.config, curModule.id, curModule.typeName, moduleLayout, this.themeSettings);\n            this.cache.put({ typeName: MODULE_CONFIG_KEY, key: curModule.id }, { item: curModule.config || {} });\n            this.cache.put({ typeName: MODULE_CONFIG_ERRORS_KEY, key: curModule.id }, { item: curModule.configErrors || [] });\n        }\n\n        // Load any data actions that the new modules(s) are dependent on\n        try {\n            await loadData(\n                flatListModules,\n                this.pageContext.requestContext,\n                <InternalTelemetry>window._msdyn365.telemetry,\n                this.moduleTelemetry,\n                this.cache,\n                null\n            );\n\n            // @ts-ignore - Ignoring complaint that _moduleList is a private property of pageContext\n            this.pageContext._moduleList.push(...flatListModules);\n\n            // Put results of the data action into the cache for the module(s) that are being added\n            for (let i = 0; i < flatListModules.length; i++) {\n                const curModule = flatListModules[i];\n                this.cache.put({ typeName: MODULE_DATA_KEY, key: curModule.id }, { item: curModule.data });\n                this.cache.put({ typeName: MODULE_ACTION_KEY, key: curModule.id }, { item: curModule.dataActions });\n            }\n\n            // Finally, call render to render the new modules in context of the parent module\n            try {\n                return this._renderPage(fragmentId);\n            } catch (err) {\n                console.log(`Uncaught error when adding module/fragment: ${fragmentId}`);\n                console.log(err);\n                return false;\n            }\n        } catch (err) {\n            console.log(`Error running load data when adding module/fragment: ${fragmentId}`);\n            console.log(err);\n            return false;\n        }\n    }\n\n    private _setImageSettingsForDefaultImage(moduleConfig: object | null, moduleType: string, imagePaths: string[][]): void {\n        // @ts-ignore\n        if (!moduleConfig || !moduleConfig.msdyn365__moduleLayout || !this.pageContext.requestContext.features.enableDefaultPlaceholder) {\n            return;\n        }\n        imagePaths.forEach(pathArray => {\n            const imageSettingPathArray = pathArray.concat('imageSettings');\n            const imageSettings: IImageSettings = _get(moduleConfig, imageSettingPathArray);\n            // if there is no viewPort, add viewport.\n            if (!imageSettings || !imageSettings.viewports) {\n                // @ts-ignore\n                const moduleLayout = moduleConfig.msdyn365__moduleLayout;\n                const viewportInfo = constructViewportInformationForImage(\n                    moduleType,\n                    moduleLayout,\n                    pathArray,\n                    undefined,\n                    this.themeSettings\n                ).viewports;\n\n                // disable this because imageSettings could be undefined.\n                // tslint:disable-next-line:prefer-object-spread\n                const newImageSettings = Object.assign({ viewports: viewportInfo }, imageSettings);\n                _set(moduleConfig, imageSettingPathArray, newImageSettings);\n            }\n        });\n    }\n}\n"]}