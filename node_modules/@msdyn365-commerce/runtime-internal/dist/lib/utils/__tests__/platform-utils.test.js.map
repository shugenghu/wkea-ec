{"version":3,"file":"platform-utils.test.js","sourceRoot":"","sources":["../../../../src/utils/__tests__/platform-utils.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\nimport { buildMockRequest } from '@msdyn365-commerce/core';\nimport { buildMockTelemetry, msdyn365Commerce } from '@msdyn365-commerce/core-internal';\nimport * as CategoryDataActions from '@msdyn365-commerce/retail-proxy/dist/DataActions/CategoriesDataActions.g';\nimport * as ProductDataActions from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport 'jest';\nimport { NextFunction } from 'jest-express/lib/next';\nimport { Request } from 'jest-express/lib/request';\nimport { Response } from 'jest-express/lib/response';\nimport { loadFeatureFlags, setCorsHeaders, setResponseHeaders, validateRouteAndChannelConfig } from '../platform-utils';\nconst noop = () => null;\n\ndescribe('platform utilities', () => {\n    describe('Validate Routes', () => {\n        afterEach(() => {\n            jest.restoreAllMocks();\n        });\n\n        describe('pdp', () => {\n            it('Should return 404 if no product is found in url', async () => {\n                // @ts-ignore\n                msdyn365Commerce.getAppCache = jest.fn(null);\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest({ urlTokens: { pageType: 'product' } }));\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(mockRes.status).toBeCalledWith(404);\n                expect(next).not.toHaveBeenCalled();\n            });\n            it('Should return 500 if the data action throws', async () => {\n                const getProduct = jest.spyOn(ProductDataActions, 'getByIdAsync');\n                // @ts-ignore\n                getProduct.mockRejectedValue();\n                // @ts-ignore\n                msdyn365Commerce.getAppCache = jest.fn(null);\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest({ urlTokens: { recordId: 5, pageType: 'product' } }));\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(getProduct).toHaveBeenCalled();\n                expect(mockRes.status).toBeCalledWith(500);\n                expect(next).not.toHaveBeenCalled();\n            });\n            it('Should return 404 if no product is found on the server', async () => {\n                const getProduct = jest.spyOn(ProductDataActions, 'getByIdAsync');\n                // @ts-ignore\n                getProduct.mockResolvedValue([]);\n                // @ts-ignore\n                msdyn365Commerce.getAppCache = jest.fn(null);\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest({ urlTokens: { recordId: 5, pageType: 'product' } }));\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(getProduct).toHaveBeenCalled();\n                expect(mockRes.status).toBeCalledWith(404);\n                expect(next).not.toHaveBeenCalled();\n            });\n        });\n        describe('category', () => {\n            it('Should return 404 if no category is found in url', async () => {\n                // @ts-ignore\n                msdyn365Commerce.getAppCache = jest.fn(null);\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest({ urlTokens: { pageType: 'category' } }));\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(mockRes.status).toBeCalledWith(404);\n                expect(next).not.toHaveBeenCalled();\n            });\n            it('Should return 500 if the data action throws', async () => {\n                const getCategories = jest.spyOn(CategoryDataActions, 'getCategoriesAsync');\n                // @ts-ignore\n                getCategories.mockRejectedValue();\n                // @ts-ignore\n                msdyn365Commerce.getAppCache = jest.fn(null);\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest({ urlTokens: { recordId: 5, pageType: 'category' } }));\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(getCategories).toHaveBeenCalled();\n                expect(mockRes.status).toBeCalledWith(500);\n                expect(next).not.toHaveBeenCalled();\n            });\n            it('Should return 404 if no category is found on the server', async () => {\n                const getCategories = jest.spyOn(CategoryDataActions, 'getCategoriesAsync');\n                // @ts-ignore\n                getCategories.mockResolvedValue([]);\n                // @ts-ignore\n                msdyn365Commerce.getAppCache = jest.fn(null);\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest({ urlTokens: { recordId: 5, pageType: 'category' } }));\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(getCategories).toHaveBeenCalled();\n                expect(mockRes.status).toBeCalledWith(404);\n                expect(next).not.toHaveBeenCalled();\n            });\n        });\n        describe('list', () => {\n            it('Should return 404 if no list is found', async () => {\n                // @ts-ignore\n                msdyn365Commerce.getAppCache = jest.fn(null);\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest({ urlTokens: { pageType: 'list' }, pageData: { list: 'invalid' } }));\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(mockRes.status).toBeCalledWith(404);\n                expect(next).not.toHaveBeenCalled();\n            });\n        });\n        describe('invalid', () => {\n            it('should pass through when page type is unknown', async () => {\n                jest.setTimeout(10000);\n                // @ts-ignore\n                msdyn365Commerce.getAppCache = jest.fn(null);\n                const getProduct = jest.spyOn(ProductDataActions, 'getByIdAsync');\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest({ urlTokens: { pageType: 'invalid' } }));\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(next).toHaveBeenCalled();\n                expect(getProduct).not.toHaveBeenCalled();\n            });\n            it('should pass through when page type is not defined', async () => {\n                const getProduct = jest.spyOn(ProductDataActions, 'getByIdAsync');\n                const mockReq: Request = new Request();\n                const mockRes: Response = new Response();\n\n                // @ts-ignore\n                mockRes.setLocals('requestContext', buildMockRequest());\n                // @ts-ignore\n                mockRes.setLocals('telemetry', buildMockTelemetry());\n                // @ts-ignore\n                const next: NextFunction = jest.fn();\n                // @ts-ignore\n                await validateRouteAndChannelConfig(mockReq, mockRes, next);\n                expect(next).toHaveBeenCalled();\n                expect(getProduct).not.toHaveBeenCalled();\n            });\n        });\n    });\n\n    describe('Set Cors Headers', () => {\n        it('Should not set access control headers if flights are not loaded', done => {\n            const setHeader = jest.fn();\n            const mockRes = {\n                locals: {},\n                setHeader\n            };\n            // @ts-ignore\n            setCorsHeaders({}, mockRes, () => {\n                expect(setHeader).not.toHaveBeenCalledWith('Access-Control-Allow-Origin', '*');\n                expect(setHeader).not.toHaveBeenCalledWith('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');\n                expect(setHeader).not.toHaveBeenCalledWith('Access-Control-Allow-Headers', 'X-Requested-With,content-type');\n                expect(setHeader).not.toHaveBeenCalledWith('Access-Control-Allow-Credentials', 'true');\n                done();\n            });\n        });\n        it('Should not set access control headers if allowAllCors is false', done => {\n            const setHeader = jest.fn();\n            const mockRes = {\n                locals: {\n                    features: {\n                        allowAllCors: false\n                    }\n                },\n                setHeader\n            };\n            // @ts-ignore\n            setCorsHeaders({}, mockRes, () => {\n                expect(setHeader).not.toHaveBeenCalledWith('Access-Control-Allow-Origin', '*');\n                expect(setHeader).not.toHaveBeenCalledWith('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');\n                expect(setHeader).not.toHaveBeenCalledWith('Access-Control-Allow-Headers', 'X-Requested-With,content-type');\n                expect(setHeader).not.toHaveBeenCalledWith('Access-Control-Allow-Credentials', 'true');\n                done();\n            });\n        });\n        it('Should set access control headers if allowAllCors is true', done => {\n            const setHeader = jest.fn();\n            const mockRes = {\n                locals: {\n                    features: {\n                        allowAllCors: true\n                    }\n                },\n                setHeader\n            };\n            // @ts-ignore\n            setCorsHeaders({}, mockRes, () => {\n                expect(setHeader).toHaveBeenCalledWith('Access-Control-Allow-Origin', '*');\n                expect(setHeader).toHaveBeenCalledWith('Access-Control-Allow-Methods', 'GET, POST, OPTIONS, PUT, PATCH, DELETE');\n                expect(setHeader).toHaveBeenCalledWith('Access-Control-Allow-Headers', 'X-Requested-With,content-type');\n                expect(setHeader).toHaveBeenCalledWith('Access-Control-Allow-Credentials', 'true');\n                done();\n            });\n        });\n    });\n\n    describe('Set Response Headers', () => {\n        const oldEnv = process.env;\n        beforeEach(() => {\n            jest.resetModules();\n            // shallow copy\n            process.env = { ...oldEnv };\n        });\n\n        afterAll(() => {\n            process.env = oldEnv;\n        });\n\n        it('Should not set cache control if process is in production mode', done => {\n            const setHeader = jest.fn();\n            const mockRes = {\n                setHeader\n            };\n            process.env.NODE_ENV = 'production';\n            // @ts-ignore\n            setResponseHeaders({}, mockRes, () => {\n                expect(setHeader).not.toHaveBeenCalledWith('Cache-Control', 'max-age=1');\n                done();\n            });\n        });\n\n        it('Should set cache control if process is in development mode', done => {\n            const setHeader = jest.fn();\n            const mockRes = {\n                setHeader\n            };\n            process.env.NODE_ENV = 'development';\n            // @ts-ignore\n            setResponseHeaders({}, mockRes, () => {\n                expect(setHeader).toHaveBeenCalledWith('Cache-Control', 'max-age=1');\n                done();\n            });\n        });\n    });\n\n    describe('Load Feature Flags', () => {\n        it('Should set features to an empty object if they are not specified', done => {\n            const mockReq = {\n                body: {}\n            };\n            const mockRes = {\n                locals: {}\n            };\n            // @ts-ignore\n            loadFeatureFlags(mockReq, mockRes, () => {\n                // @ts-ignore\n                expect(mockRes.locals.features).toMatchObject({});\n                done();\n            });\n        });\n\n        it('SHould set features to the rendering context features', done => {\n            const mockReq = {\n                body: {\n                    renderingContext: {\n                        features: {\n                            special_feature_one: true\n                        }\n                    }\n                }\n            };\n            const mockRes = {\n                locals: {}\n            };\n            // @ts-ignore\n            loadFeatureFlags(mockReq, mockRes, () => {\n                // @ts-ignore\n                expect(mockRes.locals.features).toMatchObject({ special_feature_one: true });\n                done();\n            });\n        });\n\n        it('Should set the page response from the request body', done => {\n            const mockReq = {\n                body: {\n                    pageValue: 1235\n                }\n            };\n            const mockRes = {\n                locals: {}\n            };\n            // @ts-ignore\n            loadFeatureFlags(mockReq, mockRes, () => {\n                // @ts-ignore\n                expect(mockRes.locals.pageResponse).toMatchObject({ pageValue: 1235 });\n                done();\n            });\n        });\n    });\n});\n"]}