{"version":3,"file":"module-registration.local.test.js","sourceRoot":"","sources":["../../../src/__tests__/module-registration.local.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport { safeFileExists } from '@msdyn365-commerce/utilities-internal';\nimport * as fs from 'fs-extra';\nimport 'jest';\nimport path from 'path';\n\njest.mock('../module-registration/module-registration-model');\njest.unmock('../module-registration/module-registration');\nconst mockedUtilities = require.requireActual('@msdyn365-commerce/utilities-internal');\nmockedUtilities.getSupportedNamespaces = () => ['@msdyn365-commerce-modules', '@msdyn365-commerce-partners'];\n\njest.mock('../module-registration/module-registration-model', mockedUtilities);\n\ndescribe('Module Registration Tests (Local Modules)', () => {\n    /**\n     * THIS TEST CASE MUST NOT BE IGNORED/SKIPPED UNDER ANY CIRCUMSTANCES\n     *\n     * Valdiates installed modules to be included in build registration output. Test compares the build registration\n     * output against a snapshot file in __mocks__/snapshot/module-registration.js. In case if you need to change\n     * build-registration code, please update snapshot as well, Under no circumstances this test case can be ignored.\n     */\n\n    beforeAll(async () => {\n        const model = require.requireMock('../module-registration/module-registration-model');\n        const helper = require.requireActual('../module-registration/module-registration');\n        helper.msdyn365ModuleGlobPattern = jest.fn(() => model.DEFINITION.fromLocalModule);\n        helper.msdyn365ModuleDataDefinitionGlobPattern = jest.fn(() => model.localModuleDataDefinitionPathPattern);\n        await helper.generateModuleRegistration(true);\n        await helper.generateViewRegistration();\n    });\n\n    // tslint:disable-next-line:no-any\n    it('validate local modules registration', async (done: any) => {\n        const modulesRegistrationFile = path.resolve(process.cwd(), 'lib/module-registration.local.js');\n        expect(await safeFileExists(modulesRegistrationFile)).not.toBe(undefined);\n        const registrationOutput = fs.readFileSync(path.resolve(modulesRegistrationFile));\n        expect(registrationOutput && registrationOutput.toString()).toMatchSnapshot();\n\n        const viewRegistrationFile = path.resolve(process.cwd(), 'lib/view-registration.js');\n        expect(await safeFileExists(viewRegistrationFile)).not.toBe(undefined);\n        const viewRegistrationOutput = fs.readFileSync(path.resolve(viewRegistrationFile));\n        expect(viewRegistrationOutput && viewRegistrationOutput.toString()).toMatchSnapshot();\n        done();\n    });\n\n    // tslint:disable-next-line:no-any\n    it('validate module registration when there are no definition and data definition files', async (done: any) => {\n        // const model = require.requireMock('../module-registration-model');\n        const helper = require.requireActual('../module-registration/module-registration');\n        helper.msdyn365ModuleGlobPattern = jest.fn(() => '');\n        helper.msdyn365ModuleDataDefinitionGlobPattern = jest.fn(() => '');\n        const result = await helper.generateModuleRegistration(true);\n        expect(result).toEqual([true]);\n        done();\n    });\n});\n"]}