"use strict";
/*******************************************************************************
 * Copyright (c) Microsoft Corporation.
 * All rights reserved. See LICENSE in the project root for license information.
 *******************************************************************************/
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var utilities_internal_1 = require("@msdyn365-commerce/utilities-internal");
var chalk_1 = tslib_1.__importDefault(require("chalk"));
var jsonschema_1 = require("jsonschema");
var path_1 = require("path");
var packageJsonSchemaPath = path_1.resolve(__dirname, '../schemas/valid-package-json.schema.json');
exports.validateDependencies = function (partnerPackageJson) {
    var packageJsonSchema = utilities_internal_1.safeReadJsonSync(packageJsonSchemaPath);
    var partnerJson = utilities_internal_1.safeReadJsonSync(path_1.resolve(partnerPackageJson));
    var validator = new jsonschema_1.Validator();
    if (!partnerJson) {
        console.error(chalk_1.default.red("[ERROR]: Invalid package artifact " + partnerPackageJson));
        return false;
    }
    try {
        var validationResult = utilities_internal_1.runSchemaValidationWithNestedError(validator, partnerJson, packageJsonSchema);
        if (validationResult.errors.length) {
            console.error(chalk_1.default.red("[ERROR]: Package.json does not match package.json schema"));
            validationResult.errors.forEach(function (error) {
                console.error(chalk_1.default.red("[SCHEMA ERROR]: " + error));
            });
            return false;
        }
    }
    catch (e) {
        console.error(chalk_1.default.red("[ERROR]: Unknown validation error " + e));
        return false;
    }
    return true;
};
//# sourceMappingURL=validate-dependencies.js.map