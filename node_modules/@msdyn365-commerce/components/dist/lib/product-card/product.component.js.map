{"version":3,"file":"product.component.js","sourceRoot":"./src/","sources":["product-card/product.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import { getProductPageUrlSync } from '@msdyn365-commerce-modules/retail-actions';\nimport { format, getPayloadObject, getTelemetryAttributes, ITelemetryContent, onTelemetryClick } from '@msdyn365-commerce-modules/utilities';\nimport { IComponent, IComponentProps, ICoreContext, IGridSettings, IImageData, IImageSettings, Image, msdyn365Commerce } from '@msdyn365-commerce/core';\nimport { ProductPrice, ProductSearchResult } from '@msdyn365-commerce/retail-proxy';\nimport React from 'react';\nimport { PriceComponent, RatingComponent } from '../index';\n\nexport interface IProductComponentProps extends IComponentProps<{ product?: ProductSearchResult }> {\n    className?: string;\n    imageSettings?: IImageSettings;\n    savingsText?: string;\n    freePriceText?: string;\n    originalPriceText?: string;\n    currentPriceText?: string;\n    ratingAriaLabel?: string;\n    allowBack?: boolean;\n    telemetryContent?: ITelemetryContent;\n}\n\nexport interface IProductComponent extends IComponent<IProductComponentProps> { }\n\nconst PriceComponentActions = {\n};\n\nconst ProductCard: React.FC<IProductComponentProps> = ({\n    data,\n    context,\n    imageSettings,\n    savingsText,\n    freePriceText,\n    originalPriceText,\n    currentPriceText,\n    ratingAriaLabel,\n    allowBack,\n    typeName,\n    id,\n    telemetryContent\n}) => {\n    const product = data.product;\n    if (!product) {\n        return null;\n    }\n\n    let productUrl = getProductPageUrlSync(product.Name || '', product.RecordId, context && context.actionContext, undefined);\n    if(allowBack) {\n        productUrl = updateProductUrl(productUrl, context);\n    }\n\n    // Construct telemetry attribute to render\n    const payLoad = getPayloadObject('click', telemetryContent!, '', product.RecordId.toString());\n\n    const attribute = getTelemetryAttributes(telemetryContent!, payLoad);\n\n    return (\n        <a href={productUrl} onClick={onTelemetryClick(telemetryContent!, payLoad, product.Name!)} aria-label={renderLabel(product.Name, context.cultureFormatter.formatCurrency(product.Price), product.AverageRating, ratingAriaLabel)} className='msc-product' {...attribute}>\n            <div className='msc-product__image'>\n            {renderProductPlacementImage(imageSettings, context.request.gridSettings, product.PrimaryImageUrl, product.Name)}\n            </div>\n            <div className='msc-product__details'>\n                <h4 className='msc-product__title'>{product.Name}</h4>\n                {renderPrice(context, typeName, id, product.BasePrice, product.Price, savingsText, freePriceText, originalPriceText, currentPriceText)}\n                {renderDescription(product.Description)}\n                {!context.app.config.hideRating && renderRating(context, typeName, id, product.AverageRating, product.TotalRatings, ratingAriaLabel)}\n            </div>\n        </a>\n    );\n};\n\nfunction renderLabel(name?: string, price?: string, rating?: number, ratingAriaLabel?: string): string {\n    name = name || '';\n    price = price || '';\n    return (`${name} ${price} ${getRatingAriaLabel(rating, ratingAriaLabel)}`);\n}\n\nfunction renderDescription(description?: string): JSX.Element | null {\n    return <p className='msc-product__text'>{description}</p>;\n}\n\nfunction getRatingAriaLabel(rating?: number, ratingAriaLabel?: string): string {\n    if (rating && ratingAriaLabel) {\n    const roundedRating = rating.toFixed(2);\n    return format(ratingAriaLabel || '', roundedRating, '5');\n    }\n    return '';\n}\n\nfunction updateProductUrl(productUrl: string, context:ICoreContext): string {\n    const srcUrl = new URL(productUrl, context.request.apiSettings.baseUrl);\n    const queryString = `back=true` ;\n    if (srcUrl.search) {\n            srcUrl.search += `&${queryString}`;\n        } else {\n            srcUrl.search += queryString;\n        }\n\n    const updatedUrl = new URL(srcUrl.href);\n    return updatedUrl.pathname + srcUrl.search;\n}\n\nfunction renderRating(context: ICoreContext, typeName: string, id: string, avgRating?: number, totalRatings?: number, ariaLabel?: string): JSX.Element | null {\n    if (!avgRating) {\n        return null;\n    }\n\n    const numRatings = totalRatings && totalRatings.toString() || undefined;\n    const ratingAriaLabel = getRatingAriaLabel(avgRating, ariaLabel);\n\n    return (\n        <RatingComponent\n            context={context}\n            id={id}\n            typeName={typeName}\n            avgRating={avgRating}\n            ratingCount={numRatings}\n            readOnly={true}\n            ariaLabel={ratingAriaLabel}\n            data={{}}\n        />\n    );\n}\n\nfunction renderPrice(context: ICoreContext, typeName: string, id: string, basePrice?: number, adjustedPrice?: number, savingsText?: string, freePriceText?: string, originalPriceText?: string, currentPriceText?: string): JSX.Element | null {\n    const price: ProductPrice = {\n        BasePrice: basePrice,\n        AdjustedPrice: adjustedPrice,\n        CustomerContextualPrice: adjustedPrice\n    };\n\n    return (\n        <PriceComponent\n            context={context}\n            id={id}\n            typeName={typeName}\n            data={{ price: price }}\n            savingsText={savingsText}\n            freePriceText={freePriceText}\n            originalPriceText={originalPriceText}\n        />\n    );\n}\n\nfunction renderProductPlacementImage(imageSettings?: IImageSettings, gridSettings?: IGridSettings, imageUrl?: string, altText?: string): JSX.Element | null {\n    if (!imageUrl || !gridSettings || !imageSettings) {\n        return null;\n    }\n    const img: IImageData = {\n        src: imageUrl,\n        altText: altText ? altText : ''\n    };\n    const imageProps = {\n        gridSettings: gridSettings,\n        imageSettings: imageSettings\n    };\n    return (\n        <Image {...img} {...imageProps} loadFailureBehavior='empty' />\n    );\n}\n\n// @ts-ignore\nexport const ProductComponent: React.FunctionComponent<IProductComponentProps> = msdyn365Commerce.createComponent<IProductComponent>(\n    'Product',\n    { component: ProductCard, ...PriceComponentActions }\n);"]}