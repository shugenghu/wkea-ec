{"version":3,"file":"promocode.test.js","sourceRoot":"./src/","sources":["promocode/promocode.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import { buildMockCoreContext } from '@msdyn365-commerce/core';\nimport { mount, render } from 'enzyme';\nimport * as React from 'react';\nimport { PromoCodeComponent } from './promocode.component'\n\n/*\n1. Renders correctly with promo-code\n2. Renders correctly without promo-code\n3. applies promo-code correctly\n4. removed promo-code correctly\n*/\n\ndescribe('Promo code', () => {\n    const mockCoreContext = buildMockCoreContext({});\n    const flushPromises = () => new Promise(setImmediate);\n\n    it('renders correctly with promo-code', () => {\n        const cart = {\n            cart:{\n                Id: '1234',\n                CartLines: [\n                    {\n                        LineId: '1234'\n                    },\n                    {\n                        LineId: '2345'\n                    }\n                ],\n                Coupons:[\n                    {\n                        Code: 'WeeklyAd'\n                    },\n                    {\n                        Code: 'Take20'\n                    }\n                ]\n            }\n        };\n        const promoCode = render(\n            (\n                <PromoCodeComponent\n                    // @ts-ignore partial mock\n                    cart={cart}\n                    promoCodeHeadingText={'Promo code'}\n                    removePromoAriaLabelFormat={'{0} {1}'}\n                    promoPlaceholderText={'Enter promo code'}\n                    promoCodeApplyButtonText={'Apply'}\n                    collapseTimeOut={350}\n                    removePromoText={'Remove'}\n                    id='id'\n                    typeName='PromoCode'\n                    context={mockCoreContext}\n                />));\n        expect(promoCode).toMatchSnapshot();\n    });\n\n    it('renders correctly without promo-code', () => {\n        const cart = {\n            cart:{\n                Id: '1234',\n                CartLines: [\n                    {\n                        LineId: '1234'\n                    },\n                    {\n                        LineId: '2345'\n                    }\n                ]\n            }\n        };\n        const promoCode = render(\n            (\n                <PromoCodeComponent\n                    // @ts-ignore partial mock\n                    cart={cart}\n                    promoCodeHeadingText={'Promo code'}\n                    removePromoAriaLabelFormat={'{0} {1}'}\n                    promoPlaceholderText={'Enter promo code'}\n                    promoCodeApplyButtonText={'Apply'}\n                    collapseTimeOut={350}\n                    removePromoText={'Remove'}\n                    id='id'\n                    typeName='PromoCode'\n                    context={mockCoreContext}\n                />));\n        expect(promoCode).toMatchSnapshot();\n    });\n\n    it('applies promo code correctly when it is not applied on cart', () => {\n        const spyAddPromoCode = jest.fn().mockImplementation(() => Promise.resolve({}));\n        const cart = {\n            cart:{\n                Id: '1234',\n                CartLines: [\n                    {\n                        LineId: '1234'\n                    },\n                    {\n                        LineId: '2345'\n                    }\n                ]\n            },\n            addPromoCode: spyAddPromoCode\n        };\n        const promoCode = mount(\n            (\n                <PromoCodeComponent\n                    // @ts-ignore partial mock\n                    cart={cart}\n                    promoCodeHeadingText={'Promo code'}\n                    removePromoAriaLabelFormat={'{0} {1}'}\n                    promoPlaceholderText={'Enter promo code'}\n                    promoCodeApplyButtonText={'Apply'}\n                    collapseTimeOut={350}\n                    removePromoText={'Remove'}\n                    id='id'\n                    typeName='PromoCode'\n                    context={mockCoreContext}\n                />));\n        promoCode.find('.msc-promo-code__input-box').simulate('change', { target: { value: 'WeeklyAd' }});\n        promoCode.find('.msc-promo-code__apply-btn').first().simulate('click');\n        expect(spyAddPromoCode).toHaveBeenCalled();\n        promoCode.unmount();\n    });\n\n    it('throws error when already applied promo code correctly', async () => {\n        const spyAddPromoCode = jest.fn().mockImplementation(() => Promise.resolve({status: 'FAILED', substatus: 'ALREADYADDED'}));\n        const cart = {\n            cart:{\n                Id: '1234',\n                CartLines: [\n                    {\n                        LineId: '1234'\n                    },\n                    {\n                        LineId: '2345'\n                    }\n                ],\n                Coupons:[\n                    {\n                        Code: 'weeklyad'\n                    }\n                ]\n            },\n            addPromoCode: spyAddPromoCode\n        };\n        const promoCode = mount(\n            (\n                <PromoCodeComponent\n                    // @ts-ignore partial mock\n                    cart={cart}\n                    promoCodeHeadingText={'Promo code'}\n                    removePromoAriaLabelFormat={'{0} {1}'}\n                    promoPlaceholderText={'Enter promo code'}\n                    promoCodeApplyButtonText={'Apply'}\n                    duplicatePromoCodeErrorText='duplicate'\n                    collapseTimeOut={350}\n                    removePromoText={'Remove'}\n                    id='id'\n                    typeName='PromoCode'\n                    context={mockCoreContext}\n                />));\n        promoCode.find('.msc-promo-code__input-box').simulate('change', { target: { value: 'weeklyad' }});\n        promoCode.find('.msc-promo-code__apply-btn').first().simulate('click');\n        expect(spyAddPromoCode).toHaveBeenCalled();\n        await flushPromises();\n        const error = promoCode.find('p');\n        expect(error.text()).toBe('duplicate');\n        promoCode.unmount();\n    });\n\n    it('removes promo-code when clicked on remove button', () => {\n        const spyRemovePromoCodes = jest.fn().mockImplementation(() => Promise.resolve({}));\n        const cart = {\n            cart:{\n                Id: '1234',\n                CartLines: [\n                    {\n                        LineId: '1234',\n                        DiscountLines: [\n                            {\n                                DiscountCode: 'weeklyad',\n                                DiscountCost: 10\n                            }\n                        ]\n                    },\n                    {\n                        LineId: '2345'\n                    }\n                ],\n                Coupons:[\n                    {\n                        Code: 'weeklyad'\n                    }\n                ]\n            },\n            removePromoCodes: spyRemovePromoCodes\n        };\n        const promoCode = mount(\n            (\n                <PromoCodeComponent\n                    // @ts-ignore partial mock\n                    cart={cart}\n                    promoCodeHeadingText={'Promo code'}\n                    removePromoAriaLabelFormat={'{0} {1}'}\n                    promoPlaceholderText={'Enter promo code'}\n                    promoCodeApplyButtonText={'Apply'}\n                    collapseTimeOut={350}\n                    removePromoText={'Remove'}\n                    id='id'\n                    typeName='PromoCode'\n                    context={mockCoreContext}\n                />));\n        promoCode.find('.msc-promo-code__input-box').simulate('change', { target: { value: 'weeklyad' }});\n        promoCode.find('.msc-promo-code__line__btn-remove').first().simulate('click');\n        expect(spyRemovePromoCodes).toHaveBeenCalled();\n        promoCode.unmount();\n    });\n});"]}