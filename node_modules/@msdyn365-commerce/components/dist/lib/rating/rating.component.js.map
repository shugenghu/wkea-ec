{"version":3,"file":"rating.component.js","sourceRoot":"./src/","sources":["rating/rating.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { IComponent, IComponentProps, msdyn365Commerce } from '@msdyn365-commerce/core';\n\nexport interface IRatingComponentProps extends IComponentProps<{}> {\n    readOnly: boolean;\n    ariaLabel: string;\n    avgRating: number;\n    ratingCount?: string;\n    initialRating?: number;\n    hideCount?: boolean;\n    className?: string;\n    onChange?(value: number): void;\n}\nexport interface IRatingComponent extends IComponent<IRatingComponentProps> {\n    onSliderChanged(): (event: React.ChangeEvent<HTMLInputElement>, props: IRatingComponentProps, setRating: (rating: IRatingState) => void) => void;\n    onMouseOver(): (event: React.MouseEvent<HTMLElement>, rating: IRatingState, setRating: (rating: IRatingState) => void) => void;\n    onClick(): (event: React.MouseEvent<HTMLElement>,  props: IRatingComponentProps, setRating: (rating: IRatingState) => void) => void;\n    onMouseLeave(): (event: React.MouseEvent, rating: IRatingState, setRating: (rating: IRatingState) => void) => void;\n}\n\ninterface IRatingState {\n    rating: number;\n    lastSelectedRating: number;\n}\n\nconst roundUpMin: number = 0.75;\nconst roundMidMin: number  = 0.25;\nconst maxRating: number = 5;\n\nconst RatingComponentActions = {\n    onSliderChanged(event: React.ChangeEvent<HTMLInputElement>, props: IRatingComponentProps, setRating: (rating: IRatingState) => void): void {\n        const value = parseInt(event.target.value, 10);\n        setRating({rating: value, lastSelectedRating: value});\n\n        if (props.onChange) {\n            props.onChange(value);\n        }\n    },\n    onMouseLeave(_event: React.MouseEvent, rating: IRatingState, setRating: (rating: IRatingState) => void): void {\n        setRating({rating: rating.lastSelectedRating, lastSelectedRating: rating.lastSelectedRating});\n\n    },\n    onMouseOver(event: React.MouseEvent<HTMLElement>, rating: IRatingState, setRating: (rating: IRatingState) => void): void {\n        setRating({rating: getIndex(event), lastSelectedRating: rating.lastSelectedRating});\n    },\n    onClick(event: React.MouseEvent<HTMLElement>,  props: IRatingComponentProps, setRating: (rating: IRatingState) => void): void {\n        if (!props.readOnly) {\n            const index = getIndex(event);\n            setRating({rating: index, lastSelectedRating: index});\n\n            if (props.onChange) {\n                props.onChange(index);\n            }\n        }\n    }\n};\n\nconst Rating: React.FC<IRatingComponentProps> = (props: IRatingComponentProps) => {\n    const initialRating = props.readOnly ? props.avgRating : props.initialRating || 0;\n    const [rating, setRating] = useState({rating: initialRating, lastSelectedRating: initialRating});\n    useEffect(\n        () => {\n            const newRating = props.readOnly ? props.avgRating : props.initialRating || 0;\n            setRating({rating: newRating, lastSelectedRating: newRating});\n        },\n        [props]\n    );\n    const onChange = (event: React.ChangeEvent<HTMLInputElement>) => RatingComponentActions.onSliderChanged(event, props, setRating);\n    const onMouseLeave = (event: React.MouseEvent) => RatingComponentActions.onMouseLeave(event, rating, setRating);\n    const onMouseOver = (event: React.MouseEvent<HTMLElement>) => RatingComponentActions.onMouseOver(event, rating, setRating);\n    const onClick = (event: React.MouseEvent<HTMLElement>) => RatingComponentActions.onClick(event, props, setRating);\n\n    return (\n        <div className={`msc-rating  ${rating.rating > 0 ? 'msc-no-ratings' : ''} ${props.className ? props.className : ''}`}>\n            {starControl(props.readOnly, rating.rating, props.ariaLabel, onChange)}\n            <div aria-hidden={true} onMouseLeave={props.readOnly ? undefined : onMouseLeave} className='msc-rating__group'>\n                {renderStars(rating.rating, props, onMouseOver, onClick)}\n            </div>\n            { props.ratingCount && <output tabIndex={-1} aria-hidden={true} className='msc-rating__count'> {props.typeName === 'reviews-list' ? `${props.avgRating} / 5 (${props.ratingCount})`: props.ratingCount} </output> }\n        </div>\n    );\n};\n\n// Set default props\nRating.defaultProps = {\n    avgRating: 0\n} as Partial<IRatingComponentProps>;\n\nconst starControl = (readOnly: boolean, currentRating: number, ariaLabel: string, onChange: (event: React.ChangeEvent<HTMLInputElement>) => void): JSX.Element => {\n    if (readOnly) {\n        return <div className='msc-rating__range sr-only'>{ariaLabel}</div>;\n    }\n\n    return (\n        <input\n            type='range'\n            className='msc-rating__range'\n            min={0}\n            max={5}\n            step={1}\n            value={currentRating}\n            aria-valuemax={5}\n            aria-valuemin={0}\n            aria-valuenow={currentRating}\n            onChange={onChange}\n            aria-label={ariaLabel}\n        />\n    );\n};\n\nconst renderStars = (rating: number, props: IRatingComponentProps, mouseOver: (event: React.MouseEvent<HTMLElement>) => void,  onClick: (event: React.MouseEvent<HTMLElement>) => void): JSX.Element[] => {\n    const floor = Math.floor(rating);\n    const remainder  = rating - floor;\n    const filled = remainder < roundUpMin ? floor : floor + 1;\n    const half =  roundMidMin <= remainder && remainder < roundUpMin? filled + 1 : 0;\n    const stars = [];\n\n    for (let i = 1; i <= maxRating; i++) {\n        const glyphClass = filled >= i ? 'msc-rating__star' : half === i ? 'msc-rating__half-star' : 'msc-rating__empty-star'!;\n        stars.push(<span className={glyphClass} data-index={i} key={i} onMouseOver={props.readOnly ? undefined : mouseOver} onClick={onClick} role='presentation'/>);\n    }\n\n    return stars;\n};\n\nconst getIndex = (event: React.MouseEvent<HTMLElement>): number => {\n    const target = event.target as HTMLElement;\n    return parseInt(target.getAttribute('data-index')!, 10);\n};\n\n// @ts-ignore\nexport const RatingComponent: React.FunctionComponent<IRatingComponentProps> = msdyn365Commerce.createComponent<IRatingComponent>(\n    'Rating',\n    { component: Rating, ...RatingComponentActions }\n);"]}