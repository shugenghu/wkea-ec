{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/es.promise.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import classname from'classnames';import get from'lodash/get';import{action,observable,reaction}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{withModuleState}from'@msdyn365-commerce-modules/checkout-utilities';import{Button,getTelemetryObject,Waiting}from'@msdyn365-commerce-modules/utilities';import{PriceComponent}from'@msdyn365-commerce/components';import{getDeliveryOptionsAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';import DescriptionComponent from'./components/checkout-delivery-options.description';import ErrorMessageComponent from'./components/checkout-delivery-options.error-message';import ErrorTitleComponent from'./components/checkout-delivery-options.error-title';import RadioButtonComponent from'./components/checkout-delivery-options.radio-button';let CheckoutDeliveryOptions=class CheckoutDeliveryOptions extends React.Component{constructor(props){super(props);this.selectedItemId='';this.deliveryOptions=[];this.isLoading=false;this.init=async()=>{this.props.moduleState.init({onEdit:this.onEdit,onCancel:this.onCancel,onSubmit:this.onSubmit,status:this.canShip()?'updating':'disabled'});this.cartDeliveryMode=this.getSavedDeliveryOption();await this.loadDeliveryOptions();};this.canShip=()=>{return this.getCartLinesForShipping().length>0;};this.isDeliveryModeExists=deliveryMode=>{if(deliveryMode){if(this.deliveryOptions.find(deliveryOption=>deliveryOption.Code===deliveryMode)){return true;}}return false;};this.getDeliveryOptionSelected=()=>{const selectedItem=this.deliveryOptions.find(deliveryOption=>deliveryOption.Code===this.selectedItemId);if(!selectedItem){this.props.context.telemetry.error('Checkout delivery options content is empty, module wont render');return null;}const{id,typeName,context}=this.props;const{priceFree}=this.props.resources;const price=get(selectedItem,'ShippingChargeAmount',0);return{DeliveryOption:{className:'ms-checkout-delivery-options__option-selected'},description:/*#__PURE__*/React.createElement(DescriptionComponent,Object.assign({},{description:selectedItem.Description})),price:/*#__PURE__*/React.createElement(PriceComponent,{id:id,typeName:typeName,context:context,className:'ms-checkout-delivery-options__price',data:{price:{CustomerContextualPrice:price}},freePriceText:priceFree})};};this.getErrorMessage=()=>{const{errorMessageTitle}=this.props.resources;return{CheckoutDeliveryOptionsError:{tag:'span',className:'ms-address-form__error',role:'alert','aria-live':'assertive'},title:/*#__PURE__*/React.createElement(ErrorTitleComponent,Object.assign({},{title:errorMessageTitle})),message:/*#__PURE__*/React.createElement(ErrorMessageComponent,Object.assign({},{message:this.errorMessage}))};};this.getDeliveryOptionList=()=>{const count=this.deliveryOptions.length;const{priceFree}=this.props.resources;const{id,typeName,context}=this.props;return this.deliveryOptions.map((deliveryOption,index)=>{return{DeliveryOption:{className:'ms-checkout-delivery-options__option'},code:deliveryOption.Code||'',radioButton:/*#__PURE__*/React.createElement(RadioButtonComponent,Object.assign({},{isChecked:deliveryOption.Code===this.selectedItemId,value:deliveryOption.Code,ariaSetSize:count,ariaPosInSet:index+1,ariaLabel:\"\".concat(deliveryOption.Description,\" \").concat(priceFree),onChange:this.onDeliveryOptionChange,telemetryContent:this.telemetryContent})),description:/*#__PURE__*/React.createElement(DescriptionComponent,Object.assign({},{description:deliveryOption.Description})),price:/*#__PURE__*/React.createElement(PriceComponent,{id:id,typeName:typeName,context:context,className:'ms-checkout-delivery-options__price',data:{price:{CustomerContextualPrice:get(deliveryOption,'ShippingChargeAmount',0)}},freePriceText:priceFree})};});};this.getSaveButton=()=>{const{saveBtnLabel='Save'}=this.props.resources;return/*#__PURE__*/React.createElement(Button,{className:'ms-checkout-delivery-options__btn-save',title:saveBtnLabel,color:'primary',disabled:!this.selectedItemId,onClick:this.onSave},saveBtnLabel);};this.getEditButton=()=>{const{editBtnLabel='Change'}=this.props.resources;return/*#__PURE__*/React.createElement(Button,{className:'ms-checkout-delivery-options__btn-edit',title:editBtnLabel,color:'primary',onClick:this.onEdit},editBtnLabel);};this.getCancelButton=()=>{const{cancelBtnLabel='Cancel'}=this.props.resources;return/*#__PURE__*/React.createElement(Button,{className:'ms-checkout-delivery-options__btn-cancel',title:cancelBtnLabel,color:'secondary',onClick:this.onCancel},cancelBtnLabel);};this.setError=errorMessage=>{this.props.telemetry.error(errorMessage);this.props.moduleState.setHasError(true);this.props.moduleState.onUpdating();this.errorMessage=errorMessage;};this.clearError=()=>{this.props.moduleState.setHasError(false);this.errorMessage=undefined;};this.onSave=()=>{this.onSubmit();};this.onEdit=()=>{this.onUpdating();};this.onSubmit=()=>{this.updateCartDeliverySpecification(this.selectedItemId);};this.onCancel=()=>{const savedDeliveryOption=this.getSavedDeliveryOption();if(savedDeliveryOption){this.selectedItemId=savedDeliveryOption;this.onReady();}else{this.onUpdating();}};this.getSavedDeliveryOption=()=>{const cartLinesForShipping=this.getCartLinesForShipping();return cartLinesForShipping[0]&&cartLinesForShipping[0].DeliveryMode;};this.updateCartDeliverySpecification=async deliveryModeId=>{if(deliveryModeId.trim()===''){return;}const{resources}=this.props;const checkoutState=this.props.data.checkout.result;const updateCartDeliverySpecificationInput={deliveryModeId:deliveryModeId,shippingAddress:checkoutState.shippingAddress};this.clearError();this.onPending();await checkoutState.checkoutCart.updateCartDeliverySpecification(updateCartDeliverySpecificationInput).then(response=>{if(response.status==='FAILED'){this.setError(resources.genericErrorMessage);}else{this.onReady();this.props.moduleState.setIsCancellable(true);}}).catch(()=>{this.setError(resources.genericErrorMessage);});};this.getCartLinesForShipping=()=>{const{request}=this.props.context;const pickupDeliveryModeCode=request&&request.channel&&request.channel.PickupDeliveryModeCode;return(this.props.data.checkout.result&&this.props.data.checkout.result.checkoutCart.cart.CartLines||[]).filter(cartLine=>cartLine.DeliveryMode&&cartLine.DeliveryMode!==''?cartLine.DeliveryMode!==pickupDeliveryModeCode:cartLine);};this.getDeliveryOptions=async shippingAddress=>{var _this$props$data$chec;if(!this.props.data.checkout.result){return;}const{context,resources,config}=this.props;const cartState=(_this$props$data$chec=this.props.data.checkout.result)===null||_this$props$data$chec===void 0?void 0:_this$props$data$chec.checkoutCart;const cartId=cartState.cart.Id;if(context){this.isLoading=true;this.deliveryOptions=[];this.selectedItemId='';this.clearError();try{let originalDeliveryMode='';const shippingCartLines=this.getCartLinesForShipping();const hasShippingDeliveryLines=shippingCartLines&&shippingCartLines.length>0&&shippingCartLines[0].DeliveryMode;if(hasShippingDeliveryLines){originalDeliveryMode=shippingCartLines[0].DeliveryMode||'';const cart=cartState.cart;await cartState.clearCartLinesDeliveryInformation({cart});}let deliveryOptionFilter;switch(config.filterDeliveryModeOption){case\"none\":deliveryOptionFilter=0;break;case\"filterOutNonCarrierDeliveryMode\":deliveryOptionFilter=1;break;default:deliveryOptionFilter=1;}const response=await getDeliveryOptionsAsync({callerContext:context.actionContext,queryResultSettings:{}},cartId,shippingAddress,[],deliveryOptionFilter);if(hasShippingDeliveryLines){await this.updateCartDeliverySpecification(originalDeliveryMode);}if(response&&response.length){this.deliveryOptions=response;}}catch(error){this.setError(resources.genericErrorMessage);}if(this.deliveryOptions.length===0){this.setError(resources.deliveryOptionsNotFound);}else{var _this$props$data$chec2;if(this.cartDeliveryMode&&this.isDeliveryModeExists(this.cartDeliveryMode)&&!((_this$props$data$chec2=this.props.data.checkout.result)!==null&&_this$props$data$chec2!==void 0&&_this$props$data$chec2.checkoutCart.cart.ShippingAddress)){this.selectedItemId=this.cartDeliveryMode;this.cartDeliveryMode=undefined;this.onReady();}else{this.onUpdating();this.selectedItemId=this.deliveryOptions.length>0?this.deliveryOptions[0].Code||'':'';}}this.isLoading=false;}};this.loadDeliveryOptions=async()=>{const shippingAddress=this.props.data.checkout.result&&this.props.data.checkout.result.shippingAddress;if(this.canShip()&&shippingAddress){await this.getDeliveryOptions(shippingAddress);}};this.onDeliveryOptionChange=event=>{const deliveryModeId=event.currentTarget.value;this.selectedItemId=deliveryModeId;};this.onReady=()=>{this.props.moduleState.onReady();};this.onUpdating=()=>{this.props.moduleState.onUpdating();};this.onPending=()=>{this.props.moduleState.onPending();};this.telemetryContent=getTelemetryObject(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);}async componentDidMount(){this.props.data.checkout.then(async()=>{await this.init();});reaction(()=>this.props.data.checkout.result&&this.props.data.checkout.result.shippingAddress,async()=>{await this.loadDeliveryOptions();this.props.moduleState.setIsCancellable(false);});}render(){if(!this.canShip()){this.props.context.telemetry.error('Checkout delivery options content is empty, module wont render');return null;}const{moduleState:{isReady,isUpdating,hasError}}=this.props;const isError=!this.isLoading&&hasError;const isShowList=!this.isLoading&&!hasError&&isUpdating;const isShowSelected=!this.isLoading&&!hasError&&isReady;const viewProps=_objectSpread(_objectSpread({},this.props),{},{onDeliveryOptionChange:this.onDeliveryOptionChange,selectedItemId:this.selectedItemId,deliveryOptionsData:this.deliveryOptions,isLoading:this.isLoading,errorMessageData:this.errorMessage,viewState:{isLoading:this.isLoading,isError:isError,isShowList:isShowList,isShowSelected:isShowSelected,isShowSaveButton:isShowList&&!this.props.moduleState.hasExternalSubmitGroup,isShowEditButton:isShowSelected&&!this.props.moduleState.hasExternalSubmitGroup,isShowCancelButton:isShowList&&!this.props.moduleState.hasExternalSubmitGroup&&!!this.getSavedDeliveryOption()},CheckoutDeliveryOptions:{moduleProps:this.props,className:classname('ms-checkout-delivery-options',this.props.config.className)},deliveryOptions:{DeliveryOptionsList:{className:'ms-checkout-delivery-options__list'},list:this.getDeliveryOptionList()},deliveryOptionSelected:this.getDeliveryOptionSelected(),errorMessage:this.getErrorMessage(),waiting:/*#__PURE__*/React.createElement(Waiting,null),saveButton:this.getSaveButton(),editButton:this.getEditButton(),cancelButton:this.getCancelButton(),onSave:this.onSave,onEdit:this.onEdit,onCancel:this.onCancel});return this.props.renderView(viewProps);}};__decorate([observable],CheckoutDeliveryOptions.prototype,\"selectedItemId\",void 0);__decorate([observable],CheckoutDeliveryOptions.prototype,\"deliveryOptions\",void 0);__decorate([observable],CheckoutDeliveryOptions.prototype,\"isLoading\",void 0);__decorate([observable],CheckoutDeliveryOptions.prototype,\"errorMessage\",void 0);__decorate([action],CheckoutDeliveryOptions.prototype,\"init\",void 0);CheckoutDeliveryOptions=__decorate([withModuleState,observer],CheckoutDeliveryOptions);export default CheckoutDeliveryOptions;","map":{"version":3,"sources":["modules/checkout-delivery-options/checkout-delivery-options.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classname from 'classnames';\nimport get from 'lodash/get';\nimport { action, observable, reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport { IModuleStateProps, withModuleState } from '@msdyn365-commerce-modules/checkout-utilities';\nimport { Button, getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, Waiting } from '@msdyn365-commerce-modules/utilities';\nimport { PriceComponent } from '@msdyn365-commerce/components';\nimport { ICheckoutState } from '@msdyn365-commerce/global-state';\nimport { Cart, FilterDeliveryModeOption } from '@msdyn365-commerce/retail-proxy';\nimport {\n    getDeliveryOptionsAsync\n} from '@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';\nimport {\n    Address, CartLine, DeliveryOption\n} from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\n\nimport { ICheckoutDeliveryOptionsData } from './checkout-delivery-options.data';\nimport { filterDeliveryModeOption, ICheckoutDeliveryOptionsProps } from './checkout-delivery-options.props.autogenerated';\nimport DescriptionComponent from './components/checkout-delivery-options.description';\nimport ErrorMessageComponent from './components/checkout-delivery-options.error-message';\nimport ErrorTitleComponent from './components/checkout-delivery-options.error-title';\nimport RadioButtonComponent from './components/checkout-delivery-options.radio-button';\n\nexport interface ICheckoutDeliveryOptionsModuleProps extends ICheckoutDeliveryOptionsProps<ICheckoutDeliveryOptionsData>, IModuleStateProps { }\n\nexport interface ICheckoutDeliveryOption {\n    DeliveryOption: INodeProps;\n    description?: React.ReactNode;\n    price?: React.ReactNode;\n}\n\nexport interface ICheckoutDeliveryOptionEdit extends ICheckoutDeliveryOption {\n    code: string;\n    radioButton?: React.ReactNode;\n}\n\nexport interface ICheckoutDeliveryOptionsList {\n    DeliveryOptionsList: INodeProps;\n    list: ICheckoutDeliveryOptionEdit[];\n}\n\nexport interface ICheckoutDeliveryOptionsError {\n    Error: INodeProps;\n    title: React.ReactNode;\n    message: React.ReactNode;\n}\n\nexport interface ICheckoutDeliveryOptionsViewState {\n    isLoading: boolean;\n    isError: boolean;\n    isShowList: boolean;\n    isShowSelected: boolean;\n    isShowSaveButton: boolean;\n    isShowEditButton: boolean;\n    isShowCancelButton: boolean;\n}\n\nexport interface ICheckoutDeliveryOptionsViewProps extends ICheckoutDeliveryOptionsProps<{}> {\n    CheckoutDeliveryOptions: IModuleProps;\n    selectedItemId: string;\n    deliveryOptionsData: DeliveryOption[];\n    isLoading: boolean;\n    errorMessageData: string;\n    viewState: ICheckoutDeliveryOptionsViewState;\n    deliveryOptions?: ICheckoutDeliveryOptionsList;\n    deliveryOptionSelected?: ICheckoutDeliveryOption;\n    errorMessage?: ICheckoutDeliveryOptionsError;\n    waiting?: React.ReactNode;\n    saveButton?: React.ReactNode;\n    editButton?: React.ReactNode;\n    cancelButton?: React.ReactNode;\n    onDeliveryOptionChange(event: React.ChangeEvent<HTMLInputElement>): void;\n    onSave(): void;\n    onEdit(): void;\n    onCancel(): void;\n}\n\n/**\n *\n * CheckoutDeliveryOptions component\n * @extends {React.Component<ICheckoutDeliveryOptionsProps<ICheckoutDeliveryOptionsData>>}\n */\n// @ts-ignore\n@withModuleState\n@observer\nclass CheckoutDeliveryOptions extends React.Component<ICheckoutDeliveryOptionsModuleProps> {\n    @observable private selectedItemId: string = '';\n    @observable private deliveryOptions: DeliveryOption[] = [];\n    @observable private isLoading: boolean = false;\n    @observable private errorMessage?: string;\n    private cartDeliveryMode?: string;\n    private telemetryContent?: ITelemetryContent;\n\n    constructor(props: ICheckoutDeliveryOptionsModuleProps) {\n        super(props);\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public async componentDidMount(): Promise<void> {\n        this.props.data.checkout.then(async () => {\n            await this.init();\n        });\n\n        // @ts-ignore: Compiler not reconizing condition check for function params\n        reaction(\n            () => this.props.data.checkout.result && this.props.data.checkout.result.shippingAddress,\n            async () => {\n                await this.loadDeliveryOptions();\n                this.props.moduleState.setIsCancellable(false);\n            }\n        );\n    }\n\n    public render(): JSX.Element | null {\n        if (!this.canShip()) {\n            this.props.context.telemetry.error('Checkout delivery options content is empty, module wont render');\n            return null;\n        }\n\n        const {\n            moduleState: { isReady, isUpdating, hasError }\n        } = this.props;\n        const isError = !this.isLoading && hasError;\n        const isShowList = !this.isLoading && !hasError && isUpdating;\n        const isShowSelected = !this.isLoading && !hasError && isReady;\n\n        const viewProps = {\n            ...this.props,\n            onDeliveryOptionChange: this.onDeliveryOptionChange,\n            selectedItemId: this.selectedItemId,\n            deliveryOptionsData: this.deliveryOptions,\n            isLoading: this.isLoading,\n            errorMessageData: this.errorMessage,\n            viewState: {\n                isLoading: this.isLoading,\n                isError: isError,\n                isShowList: isShowList,\n                isShowSelected: isShowSelected,\n                isShowSaveButton: isShowList && !this.props.moduleState.hasExternalSubmitGroup,\n                isShowEditButton: isShowSelected && !this.props.moduleState.hasExternalSubmitGroup,\n                isShowCancelButton: isShowList && !this.props.moduleState.hasExternalSubmitGroup && !!this.getSavedDeliveryOption()\n            },\n            CheckoutDeliveryOptions: {\n                moduleProps: this.props,\n                className: classname('ms-checkout-delivery-options', this.props.config.className)\n            },\n            deliveryOptions: {\n                // @ts-ignore\n                DeliveryOptionsList: { className: 'ms-checkout-delivery-options__list' },\n                list: this.getDeliveryOptionList()\n            },\n            deliveryOptionSelected: this.getDeliveryOptionSelected(),\n            errorMessage: this.getErrorMessage(),\n            waiting: <Waiting />,\n            saveButton: this.getSaveButton(),\n            editButton: this.getEditButton(),\n            cancelButton: this.getCancelButton(),\n            onSave: this.onSave,\n            onEdit: this.onEdit,\n            onCancel: this.onCancel\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    @action\n    private init = async (): Promise<void> => {\n        this.props.moduleState.init({\n            onEdit: this.onEdit,\n            onCancel: this.onCancel,\n            onSubmit: this.onSubmit,\n            status: this.canShip() ? 'updating' : 'disabled'\n        });\n\n        this.cartDeliveryMode = this.getSavedDeliveryOption();\n\n        await this.loadDeliveryOptions();\n    };\n\n    private canShip = (): boolean => {\n        return this.getCartLinesForShipping().length > 0;\n    };\n\n    private isDeliveryModeExists = (deliveryMode: string | undefined): boolean => {\n        if (deliveryMode) {\n            if (this.deliveryOptions.find(deliveryOption => deliveryOption.Code === deliveryMode)) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    private getDeliveryOptionSelected = (): ICheckoutDeliveryOption | null => {\n        const selectedItem = this.deliveryOptions.find(deliveryOption => deliveryOption.Code === this.selectedItemId);\n        if (!selectedItem) {\n            this.props.context.telemetry.error('Checkout delivery options content is empty, module wont render');\n            return null;\n        }\n\n        const { id, typeName, context } = this.props;\n        const { priceFree } = this.props.resources;\n        const price = get(selectedItem, 'ShippingChargeAmount', 0);\n\n        // @ts-ignore\n        return {\n            // @ts-ignore\n            DeliveryOption: { className: 'ms-checkout-delivery-options__option-selected' },\n            description: <DescriptionComponent {...{ description: selectedItem.Description }} />,\n            price: <PriceComponent id={id} typeName={typeName} context={context} className='ms-checkout-delivery-options__price' data={{ price: { CustomerContextualPrice: price } }} freePriceText={priceFree} />\n        };\n    };\n\n    private getErrorMessage = (): ICheckoutDeliveryOptionsError => {\n        const { errorMessageTitle } = this.props.resources;\n        return {\n            // @ts-ignore\n            CheckoutDeliveryOptionsError: { tag: 'span', className: 'ms-address-form__error', role: 'alert', 'aria-live': 'assertive' },\n            title: <ErrorTitleComponent {...{ title: errorMessageTitle }} />,\n            message: <ErrorMessageComponent {...{ message: this.errorMessage }} />\n        };\n    };\n\n    private getDeliveryOptionList = (): ICheckoutDeliveryOptionEdit[] => {\n        const count = this.deliveryOptions.length;\n        const { priceFree } = this.props.resources;\n        const { id, typeName, context } = this.props;\n\n        // @ts-ignore\n        return this.deliveryOptions.map((deliveryOption: DeliveryOption, index: number) => {\n            return {\n                // @ts-ignore\n                DeliveryOption: { className: 'ms-checkout-delivery-options__option' },\n                code: deliveryOption.Code || '',\n                radioButton: (\n                    <RadioButtonComponent\n                        {\n                        ...{\n                            isChecked: deliveryOption.Code === this.selectedItemId,\n                            value: deliveryOption.Code,\n                            ariaSetSize: count,\n                            ariaPosInSet: index + 1,\n                            ariaLabel: `${deliveryOption.Description} ${priceFree}`,\n                            onChange: this.onDeliveryOptionChange,\n                            telemetryContent: this.telemetryContent\n                        }\n                        }\n                    />\n                ),\n                description: (\n                    <DescriptionComponent\n                        {\n                        ...{\n                            description: deliveryOption.Description\n                        }\n                        }\n                    />\n                ),\n                price: (\n                    <PriceComponent\n                        id={id}\n                        typeName={typeName}\n                        context={context}\n                        className='ms-checkout-delivery-options__price'\n                        data={{ price: { CustomerContextualPrice: get(deliveryOption, 'ShippingChargeAmount', 0) } }}\n                        freePriceText={priceFree}\n                    />\n                )\n            };\n        });\n    };\n\n    private getSaveButton = (): React.ReactNode => {\n        const { saveBtnLabel = 'Save' } = this.props.resources;\n        return (\n            <Button\n                className='ms-checkout-delivery-options__btn-save'\n                title={saveBtnLabel}\n                color='primary'\n                disabled={!this.selectedItemId}\n                onClick={this.onSave}\n            >\n                {saveBtnLabel}\n            </Button>\n        );\n    };\n\n    private getEditButton = (): React.ReactNode => {\n        const { editBtnLabel = 'Change' } = this.props.resources;\n        return (\n            <Button\n                className='ms-checkout-delivery-options__btn-edit'\n                title={editBtnLabel}\n                color='primary'\n                onClick={this.onEdit}\n            >\n                {editBtnLabel}\n            </Button>\n        );\n    };\n\n    private getCancelButton = (): React.ReactNode => {\n        const { cancelBtnLabel = 'Cancel' } = this.props.resources;\n        return (\n            <Button\n                className='ms-checkout-delivery-options__btn-cancel'\n                title={cancelBtnLabel}\n                color='secondary'\n                onClick={this.onCancel}\n            >\n                {cancelBtnLabel}\n            </Button>\n        );\n    };\n\n    private setError = (errorMessage: string): void => {\n        this.props.telemetry.error(errorMessage);\n        this.props.moduleState.setHasError(true);\n        this.props.moduleState.onUpdating();\n        this.errorMessage = errorMessage;\n    };\n\n    private clearError = (): void => {\n        this.props.moduleState.setHasError(false);\n        this.errorMessage = undefined;\n    };\n\n    private onSave = (): void => {\n        this.onSubmit();\n    };\n\n    private onEdit = (): void => {\n        this.onUpdating();\n    };\n\n    private onSubmit = (): void => {\n        // tslint:disable-next-line:no-floating-promises\n        this.updateCartDeliverySpecification(this.selectedItemId);\n    };\n\n    private onCancel = (): void => {\n        // Reset to the saved value\n        const savedDeliveryOption = this.getSavedDeliveryOption();\n        if (savedDeliveryOption) {\n            this.selectedItemId = savedDeliveryOption;\n            this.onReady();\n        } else {\n            this.onUpdating();\n        }\n    };\n\n    private getSavedDeliveryOption = (): string | undefined => {\n        const cartLinesForShipping = this.getCartLinesForShipping();\n        return cartLinesForShipping[0] && cartLinesForShipping[0].DeliveryMode;\n    };\n\n    private updateCartDeliverySpecification = async (deliveryModeId: string): Promise<void> => {\n        if (deliveryModeId.trim() === '') {\n            return;\n        }\n\n        const { resources } = this.props;\n        const checkoutState = this.props.data.checkout.result as ICheckoutState;\n        const updateCartDeliverySpecificationInput = {\n            deliveryModeId: deliveryModeId,\n            shippingAddress: checkoutState.shippingAddress\n        };\n\n        this.clearError();\n        this.onPending();\n\n        await checkoutState.checkoutCart.updateCartDeliverySpecification(updateCartDeliverySpecificationInput)\n            .then((response) => {\n                if (response.status === 'FAILED') {\n                    this.setError(resources.genericErrorMessage);\n                } else {\n                    this.onReady();\n                    this.props.moduleState.setIsCancellable(true);\n                }\n            })\n            .catch(\n                () => {\n                    this.setError(resources.genericErrorMessage);\n                }\n            );\n    };\n\n    private getCartLinesForShipping = (): CartLine[] => {\n        const { request } = this.props.context;\n        const pickupDeliveryModeCode = request && request.channel && request.channel.PickupDeliveryModeCode;\n\n        return ((this.props.data.checkout.result && this.props.data.checkout.result.checkoutCart.cart.CartLines) || []).filter(\n            cartLine => (cartLine.DeliveryMode && cartLine.DeliveryMode !== '') ? cartLine.DeliveryMode !== pickupDeliveryModeCode : cartLine\n        );\n    };\n\n    private getDeliveryOptions = async (shippingAddress: Address): Promise<void> => {\n        if (!this.props.data.checkout.result) {\n            return;\n        }\n\n        const { context, resources, config } = this.props;\n        const cartState = this.props.data.checkout.result?.checkoutCart;\n        const cartId = (cartState.cart as Cart).Id;\n        if (context) {\n            this.isLoading = true;\n            this.deliveryOptions = [];\n            this.selectedItemId = '';\n            this.clearError();\n\n            try {\n\n                let originalDeliveryMode: string = '';\n                const shippingCartLines = this.getCartLinesForShipping();\n                const hasShippingDeliveryLines = (shippingCartLines && shippingCartLines.length > 0 && shippingCartLines[0].DeliveryMode);\n                if (hasShippingDeliveryLines) {\n\n                    // first store the delivery mode, so that we can restore the shipping information.\n                    originalDeliveryMode = shippingCartLines[0].DeliveryMode || '';\n\n                    // clear the delivery information on retail server, so GetDeliveryOptions charge calculation works correctly\n                    const cart = cartState.cart;\n                    await cartState.clearCartLinesDeliveryInformation({ cart });\n                }\n\n                // TODO: Check if we can move this getDeliveryOptions to checkout state\n                let deliveryOptionFilter: FilterDeliveryModeOption;\n                switch (config.filterDeliveryModeOption) {\n                    case filterDeliveryModeOption.none:\n                        deliveryOptionFilter = FilterDeliveryModeOption.None;\n                        break;\n                    case filterDeliveryModeOption.filterOutNonCarrierDeliveryMode:\n                        deliveryOptionFilter = FilterDeliveryModeOption.FilterOutNonCarrierDeliveryMode;\n                        break;\n                    default:\n                        deliveryOptionFilter = FilterDeliveryModeOption.FilterOutNonCarrierDeliveryMode;\n                }\n                const response = await getDeliveryOptionsAsync({ callerContext: context.actionContext, queryResultSettings: {} }, cartId, shippingAddress, [], deliveryOptionFilter);\n\n                if (hasShippingDeliveryLines) {\n                    await this.updateCartDeliverySpecification(originalDeliveryMode);\n                }\n\n                if (response && response.length) {\n                    this.deliveryOptions = response;\n                }\n            } catch (error) {\n                this.setError(resources.genericErrorMessage);\n            }\n\n            if (this.deliveryOptions.length === 0) {\n                this.setError(resources.deliveryOptionsNotFound);\n            } else {\n                if (this.cartDeliveryMode && this.isDeliveryModeExists(this.cartDeliveryMode) && !this.props.data.checkout.result?.checkoutCart.cart.ShippingAddress) {\n                    this.selectedItemId = this.cartDeliveryMode;\n                    this.cartDeliveryMode = undefined;\n                    this.onReady();\n                } else {\n                    this.onUpdating();\n                    this.selectedItemId = this.deliveryOptions.length > 0 ? this.deliveryOptions[0].Code || '' : ''; // By default, select first delivery\n                }\n            }\n\n            this.isLoading = false;\n        }\n    };\n\n    private loadDeliveryOptions = async (): Promise<void> => {\n        const shippingAddress = this.props.data.checkout.result && this.props.data.checkout.result.shippingAddress;\n\n        if (this.canShip() && shippingAddress) {\n            await this.getDeliveryOptions(shippingAddress);\n        }\n    };\n\n    private onDeliveryOptionChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const deliveryModeId = event.currentTarget.value;\n        this.selectedItemId = deliveryModeId;\n    };\n\n    private onReady = () => {\n        this.props.moduleState.onReady();\n    };\n\n    private onUpdating = () => {\n        this.props.moduleState.onUpdating();\n    };\n\n    private onPending = () => {\n        this.props.moduleState.onPending();\n    };\n}\n\nexport default CheckoutDeliveryOptions;"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}