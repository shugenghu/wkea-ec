{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{getOrgUnitLocationsByAreaAsync,getStoreHoursAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/OrgUnitsDataActions.g';/**\r\n * Get selected variant action input class\r\n */export class GetOrgUnitLocationsByAreaInput{constructor(_Latitude,_Longitude,_Radius,_DistanceUnitValue,_IgnoreLocation){this.getCacheKey=()=>\"GetOrgUnitLocationsByAreaInput\";this.getCacheObjectType=()=>'GetOrgUnitLocationsByAreaInput';this.dataCacheType=()=>'none';this.Latitude=_Latitude;this.Longitude=_Longitude;this.Radius=_Radius;this.DistanceUnitValue=_DistanceUnitValue;this.IgnoreLocation=_IgnoreLocation;}}/**\r\n * CreateInput method for the getSelectedVariant data action\r\n * @param inputData The input data passed to the createInput method\r\n */export const createGetOrgUnitLocationsByAreaInput=inputData=>{return new GetOrgUnitLocationsByAreaInput();};/**\r\n * Action method for the getSelectedVariant data action\r\n * @param input The action input class\r\n * @param ctx The action context\r\n */export async function getOrgUnitLocationsByArea(input,ctx){if((input.Radius===undefined||!input.Latitude||!input.Longitude)&&!input.IgnoreLocation){// No valid location we want to return empty array so module can show no locations message\nreturn[];}const searchArea={Latitude:input.Latitude,Longitude:input.Longitude,Radius:input.Radius,DistanceUnitValue:input.DistanceUnitValue||0// 0 is miles\n};return getOrgUnitLocationsByAreaAsync({callerContext:ctx},searchArea).then(stores=>{const locationPromiseList=stores.map(store=>_getLocationWithHours(store,ctx));return Promise.all(locationPromiseList);}).catch(error=>{ctx.trace('[GetOrgUnitLocationsByArea] error getting Locations');ctx.trace(error.message);ctx.telemetry.error(error.message);ctx.telemetry.debug(\"[GetOrgUnitLocationsByArea] error getting Locations\");return[];});}/**\r\n * Action method that obtains the store information\r\n * @param orgUnitLocation The org unit location\r\n * @param storeMap a map that contains store information group by the inventory location id\r\n * @param ctx The action context\r\n */async function _getLocationWithHours(orgUnitLocation,ctx){if(!orgUnitLocation||!orgUnitLocation.OrgUnitNumber){return{OrgUnitAvailability:undefined};}return getStoreHoursAsync({callerContext:ctx},orgUnitLocation.OrgUnitNumber).then(hours=>{const availability={OrgUnitLocation:orgUnitLocation};if(hours&&!(hours instanceof Error)){return{OrgUnitAvailability:availability,StoreHours:hours};}return{OrgUnitAvailability:availability};}).catch(error=>{ctx.trace('[GetFullAvailableInventoryNearby] error getting availability with hours');ctx.trace(error.message);ctx.telemetry.exception(error);ctx.telemetry.debug(\"[GetFullAvailableInventoryNearby] error getting availability with hours\");return{OrgUnitAvailability:{}};});}/**\r\n * The complete getOrgUnitLocationsByArea data action\r\n */export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/get-store-location-information',action:getOrgUnitLocationsByArea,input:createGetOrgUnitLocationsByAreaInput});","map":{"version":3,"sources":["../../src/get-store-location-information.ts"],"names":[],"mappings":"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","sourcesContent":["import { CacheType, createObservableDataAction, IAction, IActionContext, IActionInput, IAny, ICreateActionContext, IGeneric } from '@msdyn365-commerce/core';\nimport { OrgUnitAvailability, OrgUnitLocation, SearchArea, StoreHours } from '@msdyn365-commerce/retail-proxy';\nimport { getOrgUnitLocationsByAreaAsync, getStoreHoursAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/OrgUnitsDataActions.g';\nimport { IFullOrgUnitAvailability } from './utilities/full-org-unit-availability';\n\n/**\n * Get selected variant action input class\n */\nexport class GetOrgUnitLocationsByAreaInput implements IActionInput {\n    public Latitude?: number;\n    public Longitude?: number;\n    public Radius?: number;\n    public DistanceUnitValue?: number;\n    public IgnoreLocation?: boolean;\n\n    constructor(_Latitude?: number, _Longitude?: number, _Radius?: number, _DistanceUnitValue?: number, _IgnoreLocation?: boolean) {\n        this.Latitude = _Latitude;\n        this.Longitude = _Longitude;\n        this.Radius = _Radius;\n        this.DistanceUnitValue = _DistanceUnitValue;\n        this.IgnoreLocation = _IgnoreLocation;\n    }\n\n    public getCacheKey = () => `GetOrgUnitLocationsByAreaInput`;\n    public getCacheObjectType = () => 'GetOrgUnitLocationsByAreaInput';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * CreateInput method for the getSelectedVariant data action\n * @param inputData The input data passed to the createInput method\n */\nexport const createGetOrgUnitLocationsByAreaInput = (inputData: ICreateActionContext<IGeneric<IAny>>): GetOrgUnitLocationsByAreaInput => {\n    return new GetOrgUnitLocationsByAreaInput();\n};\n\n/**\n * Action method for the getSelectedVariant data action\n * @param input The action input class\n * @param ctx The action context\n */\nexport async function getOrgUnitLocationsByArea(\n    input: GetOrgUnitLocationsByAreaInput,\n    ctx: IActionContext\n): Promise<IFullOrgUnitAvailability[] | undefined> {\n\n    if ((input.Radius === undefined || !input.Latitude || !input.Longitude) && !input.IgnoreLocation) {\n        // No valid location we want to return empty array so module can show no locations message\n        return [];\n    }\n\n    const searchArea: SearchArea = {\n        Latitude: input.Latitude,\n        Longitude: input.Longitude,\n        Radius: input.Radius,\n        DistanceUnitValue: input.DistanceUnitValue || 0 // 0 is miles\n    };\n\n    return getOrgUnitLocationsByAreaAsync({ callerContext: ctx }, searchArea)\n        .then((stores: OrgUnitLocation[]) => {\n            const locationPromiseList = stores.map(store => _getLocationWithHours(store, ctx));\n            return Promise.all(locationPromiseList);\n        })\n        .catch((error: Error) => {\n            ctx.trace('[GetOrgUnitLocationsByArea] error getting Locations');\n            ctx.trace(error.message);\n            ctx.telemetry.error(error.message);\n            ctx.telemetry.debug(`[GetOrgUnitLocationsByArea] error getting Locations`);\n            return [];\n        });\n}\n\n/**\n * Action method that obtains the store information\n * @param orgUnitLocation The org unit location\n * @param storeMap a map that contains store information group by the inventory location id\n * @param ctx The action context\n */\nasync function _getLocationWithHours(\n    orgUnitLocation: OrgUnitLocation,\n    ctx: IActionContext): Promise<IFullOrgUnitAvailability> {\n    if (!orgUnitLocation || !orgUnitLocation.OrgUnitNumber) {\n        return { OrgUnitAvailability: undefined };\n    }\n\n    return getStoreHoursAsync({ callerContext: ctx }, orgUnitLocation.OrgUnitNumber)\n        .then((hours: StoreHours) => {\n\n            const availability: OrgUnitAvailability = {\n                OrgUnitLocation: orgUnitLocation\n            };\n\n            if (hours && !(hours instanceof Error)) {\n                return { OrgUnitAvailability: availability, StoreHours: hours };\n            }\n\n            return { OrgUnitAvailability: availability };\n        })\n        .catch((error: Error) => {\n            ctx.trace('[GetFullAvailableInventoryNearby] error getting availability with hours');\n            ctx.trace(error.message);\n            ctx.telemetry.exception(error);\n            ctx.telemetry.debug(`[GetFullAvailableInventoryNearby] error getting availability with hours`);\n            return { OrgUnitAvailability: {} };\n        });\n}\n\n/**\n * The complete getOrgUnitLocationsByArea data action\n */\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-store-location-information',\n    action: <IAction<IFullOrgUnitAvailability[] | undefined>>getOrgUnitLocationsByArea,\n    input: createGetOrgUnitLocationsByAreaInput\n});"],"sourceRoot":""},"metadata":{},"sourceType":"module"}