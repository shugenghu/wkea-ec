{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import{getPaginatedOrderTemplateLinesAction,GetPaginatedOrderTemplateLinesInput}from'./get-paginated-order-template-lines';import{createObservableDataAction}from'@msdyn365-commerce/core';import{getCartState}from'@msdyn365-commerce/global-state';import{addCartLinesAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';/**\r\n *  Input class for the AddOrderTemplateToCart data action.\r\n */export class AddOrderTemplateToCartInput{constructor(orderTemplateId){this.getCacheKey=()=>'AddOrderTemplateToCartInput';this.getCacheObjectType=()=>'AddOrderTemplateToCartInput';this.dataCacheType=()=>'none';this.orderTemplateId=orderTemplateId;}}/**\r\n * createInput method for the AddOrderTemplateToCart method.\r\n * @param {ICreateActionContext} inputData The input data passed to the createInput method.\r\n * @param {string} orderTemplateId The id of template.\r\n */export const addOrderTemplateToCartInput=(inputData,orderTemplateId)=>{const{requestContext}=inputData;if(!requestContext.user.isAuthenticated){throw new Error('Unable to create order template. User is not authenticated.');}return new AddOrderTemplateToCartInput(orderTemplateId);};/**\r\n * The action method for the AddOrderTemplateToCart data action.\r\n * @param {AddOrderTemplateToCartInput} input The action input.\r\n * @param {IActionContext} ctx The action context.\r\n */export async function addOrderTemplateToCartAction(input,context){const cartState=await getCartState(context);const chunkCount=1000;const queryResultSettings={Paging:{Top:chunkCount,Skip:0}};const getPaginatedOrderTemplateLinesInput=new GetPaginatedOrderTemplateLinesInput(input.orderTemplateId,queryResultSettings);let orderTemplateLines=await getPaginatedOrderTemplateLinesAction(getPaginatedOrderTemplateLinesInput,context);let addedCartLines=[];for(let skip=chunkCount;orderTemplateLines.lines.length!==0;skip+=chunkCount){const cartLines=orderTemplateLines.lines.map(productLine=>{var _productLine$fullProd;// tslint:disable-next-line:no-unnecessary-local-variable\nconst cartLine={ItemId:(_productLine$fullProd=productLine.fullProduct)===null||_productLine$fullProd===void 0?void 0:_productLine$fullProd.ProductDetails.ItemId,ProductId:productLine.productListLine.ProductId,Quantity:productLine.productListLine.Quantity,TrackingId:'',UnitOfMeasureSymbol:productLine.productListLine.UnitOfMeasure};return cartLine;});await addCartLinesAsync({callerContext:context},cartState.cart.Id,cartLines,cartState.cart.Version).catch(error=>{context.telemetry.trace(error);context.telemetry.trace('Unable to add order template to cart.');throw error;});addedCartLines=addedCartLines.concat(cartLines);getPaginatedOrderTemplateLinesInput.queryResultSettings.Paging.Skip=skip;orderTemplateLines=await getPaginatedOrderTemplateLinesAction(getPaginatedOrderTemplateLinesInput,context);}await cartState.refreshCart({});return addedCartLines;}/**\r\n * The AddOrderTemplateToCart Data Action.\r\n * Returns created order template.\r\n */export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/order-templates/add-order-template-to-cart',action:addOrderTemplateToCartAction,input:addOrderTemplateToCartInput});","map":{"version":3,"sources":["../../../src/order-templates/add-order-template-to-cart.ts"],"names":[],"mappings":"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","sourcesContent":["import { getPaginatedOrderTemplateLinesAction, GetPaginatedOrderTemplateLinesInput } from './get-paginated-order-template-lines'\nimport {\n    CacheType,\n    createObservableDataAction,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICreateActionContext\n} from '@msdyn365-commerce/core';\nimport { getCartState } from '@msdyn365-commerce/global-state';\nimport { CartLine, QueryResultSettings } from '@msdyn365-commerce/retail-proxy';\nimport { addCartLinesAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';\n\n/**\n *  Input class for the AddOrderTemplateToCart data action.\n */\nexport class AddOrderTemplateToCartInput implements IActionInput {\n    public readonly orderTemplateId: string;\n\n    constructor(orderTemplateId: string) {\n        this.orderTemplateId = orderTemplateId;\n    }\n\n    public getCacheKey = () => 'AddOrderTemplateToCartInput';\n    public getCacheObjectType = () => 'AddOrderTemplateToCartInput';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * createInput method for the AddOrderTemplateToCart method.\n * @param {ICreateActionContext} inputData The input data passed to the createInput method.\n * @param {string} orderTemplateId The id of template.\n */\nexport const addOrderTemplateToCartInput = (inputData: ICreateActionContext, orderTemplateId: string): AddOrderTemplateToCartInput => {\n    const { requestContext } = inputData;\n    if (!requestContext.user.isAuthenticated) {\n        throw new Error('Unable to create order template. User is not authenticated.');\n    }\n    return new AddOrderTemplateToCartInput(orderTemplateId);\n};\n\n/**\n * The action method for the AddOrderTemplateToCart data action.\n * @param {AddOrderTemplateToCartInput} input The action input.\n * @param {IActionContext} ctx The action context.\n */\nexport async function addOrderTemplateToCartAction(input: AddOrderTemplateToCartInput, context: IActionContext): Promise<CartLine[]> {\n    const cartState = await getCartState(context);\n    const chunkCount = 1000;\n    const queryResultSettings: QueryResultSettings = {\n        Paging: {\n            Top: chunkCount,\n            Skip: 0\n        }\n    };\n    const getPaginatedOrderTemplateLinesInput = new GetPaginatedOrderTemplateLinesInput(input.orderTemplateId, queryResultSettings);\n    let orderTemplateLines = await getPaginatedOrderTemplateLinesAction(getPaginatedOrderTemplateLinesInput, context);\n    let addedCartLines: CartLine[] = [];\n    for (let skip = chunkCount; orderTemplateLines.lines.length !== 0; skip += chunkCount) {\n        const cartLines: CartLine[] = orderTemplateLines.lines.map(productLine => {\n            // tslint:disable-next-line:no-unnecessary-local-variable\n            const cartLine: CartLine = {\n                ItemId: productLine.fullProduct?.ProductDetails.ItemId,\n                ProductId: productLine.productListLine.ProductId,\n                Quantity: productLine.productListLine.Quantity,\n                TrackingId: '',\n                UnitOfMeasureSymbol: productLine.productListLine.UnitOfMeasure\n            };\n            return cartLine;\n        });\n        await addCartLinesAsync({ callerContext: context }, cartState.cart.Id, cartLines, cartState.cart.Version!).catch(error => {\n            context.telemetry.trace(error);\n            context.telemetry.trace('Unable to add order template to cart.');\n            throw error;\n        });\n        addedCartLines = addedCartLines.concat(cartLines);\n        getPaginatedOrderTemplateLinesInput.queryResultSettings.Paging!.Skip = skip;\n        orderTemplateLines = await getPaginatedOrderTemplateLinesAction(getPaginatedOrderTemplateLinesInput, context);\n    }\n    await cartState.refreshCart({});\n    return addedCartLines;\n}\n\n/**\n * The AddOrderTemplateToCart Data Action.\n * Returns created order template.\n */\nexport default createObservableDataAction<CartLine[]>({\n    id: '@msdyn365-commerce-modules/retail-actions/order-templates/add-order-template-to-cart',\n    action: <IAction<CartLine[]>>addOrderTemplateToCartAction,\n    input: addOrderTemplateToCartInput\n});"],"sourceRoot":""},"metadata":{},"sourceType":"module"}