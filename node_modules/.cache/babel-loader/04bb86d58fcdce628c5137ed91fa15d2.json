{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{createRefineSearchByCategoryInput}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import{retailAction}from'@msdyn365-commerce/retail-proxy/dist/retail-action';import{QueryResultSettingsProxy}from'./utilities/QueryResultSettingsProxy';import{buildCacheKey}from'./utilities/utils';/**\r\n * Action Input class for the refineSearchByCategory data action\r\n */export var RefineSearchByCriteriaInput=function RefineSearchByCriteriaInput(queryResultSettingsProxy,apiSettings,categoryId,channelId,refinementCriteria,catalogId){var _this=this;_classCallCheck(this,RefineSearchByCriteriaInput);this.getCacheKey=function(){return buildCacheKey(\"RefineSearchByCriteriaInputCache\",_this.apiSettings);};this.getCacheObjectType=function(){return'RefineSearchByCriteriaInput';};this.dataCacheType=function(){return'request';};this.categoryId=categoryId;this.channelId=channelId;this.refinementCriteria=refinementCriteria||[];this.queryResultSettingsProxy=queryResultSettingsProxy;this.catalogId=catalogId||0;this.apiSettings=apiSettings;};/**\r\n * createInput method for the refineSearchByCategory data action\r\n */export var createInput=function createInput(inputData){var refinementCriteria=inputData.config&&inputData.config.refinementCriteria;if(inputData&&inputData.requestContext&&inputData.requestContext.query&&inputData.requestContext.query.categoryId){return createRefineSearchByCategoryInput(QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings,+inputData.requestContext.apiSettings.channelId,inputData.config?Number(inputData.config.catalogId):0,+inputData.requestContext.query.categoryId,!Array.isArray(refinementCriteria)?[]:refinementCriteria.map(function(refinementCriterion){return refinementCriterion;}));}throw new Error('Please specify categoryId, refinerId, and refinerSourceValue query string in request.');};/**\r\n * The RefineSearchByCategory data action\r\n * Uses categoryId query string parameter to call the RefinerSearchByCategory\r\n * RetailServer API to get information about products\r\n */export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/regin-search-by-category',action:retailAction,input:createInput});","map":{"version":3,"sources":["../../src/refine-search-by-category.ts"],"names":[],"mappings":"uEACA,OACI,0BADJ,KAKO,yBALP,CAQA,OAAS,iCAAT,KAAkD,wEAAlD,CACA,OAAS,YAAT,KAA6B,oDAA7B,CACA,OAAS,wBAAT,KAAyC,sCAAzC,CACA,OAAS,aAAT,KAA8B,mBAA9B,CAEA;;AAEG,GACH,UAAa,CAAA,2BAAb,CAQI,qCACI,wBADJ,CAEI,WAFJ,CAGI,UAHJ,CAII,SAJJ,CAKI,kBALJ,CAMI,SANJ,CAMsB,kEAUf,KAAA,WAAA,CAAc,iBAAM,CAAA,aAAa,oCAAqC,KAAI,CAAC,WAA1C,CAAnB,EAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,6BAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,SAAjB,EAAhB,CAVH,KAAK,UAAL,CAAkB,UAAlB,CACA,KAAK,SAAL,CAAiB,SAAjB,CACA,KAAK,kBAAL,CAA0B,kBAAkB,EAAI,EAAhD,CACA,KAAK,wBAAL,CAAgC,wBAAhC,CACA,KAAK,SAAL,CAAiB,SAAS,EAAI,CAA9B,CACA,KAAK,WAAL,CAAmB,WAAnB,CACH,CAtBL,CA6BA;;AAEG,GACH,MAAO,IAAM,CAAA,WAAW,CAAG,QAAd,CAAA,WAAc,CAAC,SAAD,CAAkE,CACzF,GAAM,CAAA,kBAAkB,CAAG,SAAS,CAAC,MAAV,EAAoB,SAAS,CAAC,MAAV,CAAiB,kBAAhE,CAEA,GAAI,SAAS,EAAI,SAAS,CAAC,cAAvB,EAAyC,SAAS,CAAC,cAAV,CAAyB,KAAlE,EAA2E,SAAS,CAAC,cAAV,CAAyB,KAAzB,CAA+B,UAA9G,CAA0H,CACtH,MAAO,CAAA,iCAAiC,CACpC,wBAAwB,CAAC,aAAzB,CAAuC,SAAvC,EAAkD,mBADd,CAEpC,CAAC,SAAS,CAAC,cAAV,CAAyB,WAAzB,CAAqC,SAFF,CAGpC,SAAS,CAAC,MAAV,CAAmB,MAAM,CAAC,SAAS,CAAC,MAAV,CAAiB,SAAlB,CAAzB,CAAwD,CAHpB,CAIpC,CAAC,SAAS,CAAC,cAAV,CAAyB,KAAzB,CAA+B,UAJI,CAKpC,CAAC,KAAK,CAAC,OAAN,CAAc,kBAAd,CAAD,CAAqC,EAArC,CAA0C,kBAAkB,CAAC,GAAnB,CAAuB,SAAC,mBAAD,QAA8C,CAAA,mBAA9C,EAAvB,CALN,CAAxC,CAOH,CAED,KAAM,IAAI,CAAA,KAAJ,CAAU,uFAAV,CAAN,CACH,CAdM,CAgBP;;;;AAIG,GACH,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,oEADkC,CAEtC,MAAM,CAAkC,YAFF,CAGtC,KAAK,CAAE,WAH+B,CAAD,CAAzC","sourcesContent":["import { CacheType, IAction, IActionInput, ICommerceApiSettings } from '@msdyn365-commerce/core';\nimport {\n    createObservableDataAction,\n    IAny,\n    ICreateActionContext,\n    IGeneric\n} from '@msdyn365-commerce/core';\nimport { ProductRefinerValue, ProductSearchResult } from '@msdyn365-commerce/retail-proxy';\n\nimport { createRefineSearchByCategoryInput } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { retailAction } from '@msdyn365-commerce/retail-proxy/dist/retail-action';\nimport { QueryResultSettingsProxy } from './utilities/QueryResultSettingsProxy';\nimport { buildCacheKey } from './utilities/utils';\n\n/**\n * Action Input class for the refineSearchByCategory data action\n */\nexport class RefineSearchByCriteriaInput implements IActionInput {\n    public readonly categoryId?: number;\n    public readonly channelId?: number;\n    public readonly refinementCriteria: ProductRefinerValue[];\n    public readonly catalogId: number;\n    public readonly queryResultSettingsProxy: QueryResultSettingsProxy;\n    private apiSettings: ICommerceApiSettings;\n\n    constructor(\n        queryResultSettingsProxy: QueryResultSettingsProxy,\n        apiSettings: ICommerceApiSettings,\n        categoryId?: number,\n        channelId?: number,\n        refinementCriteria?: ProductRefinerValue[],\n        catalogId?: number\n    ) {\n        this.categoryId = categoryId;\n        this.channelId = channelId;\n        this.refinementCriteria = refinementCriteria || [];\n        this.queryResultSettingsProxy = queryResultSettingsProxy;\n        this.catalogId = catalogId || 0;\n        this.apiSettings = apiSettings;\n    }\n\n    public getCacheKey = () => buildCacheKey(`RefineSearchByCriteriaInputCache`, this.apiSettings);\n    public getCacheObjectType = () => 'RefineSearchByCriteriaInput';\n    public dataCacheType = (): CacheType => 'request';\n}\n\n/**\n * createInput method for the refineSearchByCategory data action\n */\nexport const createInput = (inputData: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    const refinementCriteria = inputData.config && inputData.config.refinementCriteria;\n\n    if (inputData && inputData.requestContext && inputData.requestContext.query && inputData.requestContext.query.categoryId) {\n        return createRefineSearchByCategoryInput(\n            QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings,\n            +inputData.requestContext.apiSettings.channelId,\n            inputData.config ? Number(inputData.config.catalogId) : 0,\n            +inputData.requestContext.query.categoryId,\n            !Array.isArray(refinementCriteria) ? [] : refinementCriteria.map((refinementCriterion: ProductRefinerValue) => refinementCriterion)\n        );\n    }\n\n    throw new Error('Please specify categoryId, refinerId, and refinerSourceValue query string in request.');\n};\n\n/**\n * The RefineSearchByCategory data action\n * Uses categoryId query string parameter to call the RefinerSearchByCategory\n * RetailServer API to get information about products\n */\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/regin-search-by-category',\n    action: <IAction<ProductSearchResult[]>>retailAction,\n    input: createInput\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}