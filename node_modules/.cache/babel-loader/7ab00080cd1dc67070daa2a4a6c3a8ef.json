{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/es.regexp.constructor.js\";import\"core-js/modules/es.regexp.to-string.js\";import\"core-js/modules/es.string.ends-with.js\";import\"core-js/modules/es.string.replace.js\";import\"core-js/modules/es.string.split.js\";import\"core-js/modules/es.string.starts-with.js\";import React from'react';import{getRnrAuthEndpointId,getRnrPartnerId}from'@msdyn365-commerce-modules/retail-actions';import{Alert,Button,getPayloadObject,getTelemetryAttributes,Modal,ModalBody,ModalFooter,ModalHeader,TelemetryConstant}from'@msdyn365-commerce-modules/utilities';import{RatingComponent}from'@msdyn365-commerce/components';import{getUrlSync}from'@msdyn365-commerce/core';import{GetUserReviewInput}from'../actions/inputs/get-user-review-input';import{SubmitUserReviewInput}from'../actions/inputs/submit-user-review-input';import submitUserReview from'../actions/submit-user-review';export const ReviewModal=props=>{const onClickSubmit=()=>{return onSubmit(props);};const payLoad=getPayloadObject('click',props.telemetryContent,TelemetryConstant.SubmitReview);const submitButtonAttribute=getTelemetryAttributes(props.telemetryContent,payLoad);payLoad.contentAction.etext=TelemetryConstant.Cancel;const cancelButtonAttribute=getTelemetryAttributes(props.telemetryContent,payLoad);return{modal:{tag:Modal,className:'ms-review-modal',toggle:props.onModalToggle,applicationNode:'renderPage',isOpen:props.isOpen,returnFocusRef:props.returnRef},modalHeader:modalHeaderNode(props),modalFooter:{tag:ModalFooter,className:'ms-review-modal-footer'},modalBody:{tag:ModalBody,className:'ms-review-modal-body'},cancelButton:/*#__PURE__*/React.createElement(Button,Object.assign({className:'ms-review-modal-cancel',onClick:props.onModalToggle},submitButtonAttribute),props.resources.discardReviewButtonText),submitButton:/*#__PURE__*/React.createElement(Button,Object.assign({className:'ms-review-modal-submit',onClick:onClickSubmit},cancelButtonAttribute,{disabled:submitDisabled(props)}),props.resources.submitReviewButtonText),rating:ratingsInput(props),ratingLabel:ratingsLabel(props),titleInput:titleInput(props),titleLabel:titleLabel(props),textInput:textInput(props),textLabel:textLabel(props),privacyPolicyUrl:privacyPolicyLink(props),form:{tag:'form',className:'ms-review-modal-form',autoComplete:'off'},inputRow:{tag:'div',className:'ms-review-modal-row',autoComplete:'off'},error:/*#__PURE__*/React.createElement(Alert,{className:'ms-review-modal-error',isOpen:props.hasError,color:'danger'},props.resources.errorMessageText)};};const modalHeaderNode=props=>{return/*#__PURE__*/React.createElement(ModalHeader,{toggle:props.onModalToggle,className:'ms-review-modal-header'},props.userReview&&props.userReview.reviewId?props.resources.editReviewModalTitle:props.resources.writeReviewModalTitle);};const submitDisabled=props=>{return!props.rating||!stripWhiteSpacesFromString(props.reviewText)||!stripWhiteSpacesFromString(props.reviewTitle);};const ratingsInput=props=>{return/*#__PURE__*/React.createElement(RatingComponent,{readOnly:false,avgRating:0,ariaLabel:props.resources.selectRatingAriaLabel,initialRating:props.rating,context:props.context,id:props.parentId,typeName:props.parentType,data:{},key:'ratings',onChange:props.onRatingChange});};const ratingsLabel=props=>{return/*#__PURE__*/React.createElement(\"label\",{className:'ms-review-modal-rating-label',key:'ratingsLabel'},props.resources.selectRatingLabel,\"*\");};const titleInput=props=>{const maxLength=props.context.app.config.reviewTitleMaxLength;return/*#__PURE__*/React.createElement(\"input\",{maxLength:maxLength,id:\"reviewTitle-\".concat(props.renderContextId),onChange:props.onTitleChange,value:props.reviewTitle,\"aria-required\":'true',className:'ms-review-modal-title'});};const titleLabel=props=>{return/*#__PURE__*/React.createElement(\"label\",{className:'ms-review-modal-title-label',htmlFor:\"reviewTitle-\".concat(props.renderContextId)},props.resources.reviewTitleLabel);};const reviewTextWidth=50;const textInput=props=>{const maxLength=props.context.app.config.reviewTextMaxLength;return/*#__PURE__*/React.createElement(\"textarea\",{maxLength:maxLength,className:'ms-review-modal-text',id:\"reviewTextArea-\".concat(props.renderContextId),onChange:props.onTextChange,rows:maxLength/reviewTextWidth,value:props.reviewText,\"aria-required\":'true'});};const textLabel=props=>{return/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"reviewTextArea-\".concat(props.renderContextId),className:'ms-review-modal-text-label'},props.resources.reviewTextLabel);};const privacyPolicyLink=props=>{const policyTextBlocks=props.resources.privacyPolicyTextFormat.split('{0}');const isSeparatorAtStart=props.resources.privacyPolicyTextFormat.startsWith('{0}');const isSeparatorAtEnd=props.resources.privacyPolicyTextFormat.endsWith('{0}');const privacyPolicyUrl=getUrlSync('rnrPrivacyPolicy',props.context.actionContext);const payLoad=getPayloadObject('click',props.telemetryContent,TelemetryConstant.PrivacyPolicy);const privacyPolicyAttribute=getTelemetryAttributes(props.telemetryContent,payLoad);return/*#__PURE__*/React.createElement(\"p\",{className:'ms-review-modal-policy'},isSeparatorAtStart?'':policyTextBlocks[0],/*#__PURE__*/React.createElement(\"a\",Object.assign({href:privacyPolicyUrl,target:'_blank',className:'msc-link'},privacyPolicyAttribute),props.resources.privacyPolicyTitle),isSeparatorAtEnd?'':isSeparatorAtStart?policyTextBlocks[0]:policyTextBlocks[1]);};const onSubmit=props=>{if(props.product){submitReview(props.product,props.reviewTitle,props.reviewText,props.rating,props.context,props.userReview,props.onReviewComplete);}};const stripWhiteSpacesFromString=text=>{return text.replace(new RegExp('\\\\r?\\\\n|\\\\r+','g'),' ').replace(new RegExp('\\\\s+','g'),' ').trim();};export const submitReview=(product,title,text,rating,context,userReview,onReviewSubmission)=>{const{request}=context;const{user}=request;if(user&&request){const input=new SubmitUserReviewInput(product.RecordId.toString(),getRnrPartnerId(context.actionContext),request.apiSettings.channelId.toString(),request.locale,{productName:product&&product.Name,rating:rating,reviewText:stripWhiteSpacesFromString(text),title:stripWhiteSpacesFromString(title),userEmail:user.emailAddress,userName:user.name},request.user.token,getRnrAuthEndpointId(context.actionContext));submitUserReview(input,context.actionContext).then(reviewId=>{const review=!!reviewId?{rating:rating,title:stripWhiteSpacesFromString(title),reviewText:stripWhiteSpacesFromString(text),submittedDateTime:new Date(),helpfulPositive:userReview?userReview.helpfulPositive:0,helpfulNegative:userReview?userReview.helpfulNegative:0,reviewId:reviewId,userName:request.user.firstName||request.user.name}:userReview;const getReviewInput=new GetUserReviewInput(input.productId,input.tenantId,input.authorization,input.serviceEndpoint);context.actionContext.update(getReviewInput,review);if(onReviewSubmission){onReviewSubmission(!!reviewId);}}).catch(()=>{const productId=product.RecordId;context.telemetry.error(\"Failed to submit review for product with recordId: \".concat(productId));context.telemetry.debug(\"Failed to submit review for product with recordId: \".concat(productId));if(onReviewSubmission){onReviewSubmission(false);}});}};","map":{"version":3,"sources":["common/review-modal.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport { getRnrAuthEndpointId, getRnrPartnerId } from '@msdyn365-commerce-modules/retail-actions';\nimport {\n    Alert, Button, getPayloadObject, getTelemetryAttributes, INodeProps, ITelemetryContent, Modal, ModalBody, ModalFooter, ModalHeader, TelemetryConstant\n} from '@msdyn365-commerce-modules/utilities';\nimport { Review } from '@msdyn365-commerce/commerce-entities';\nimport { RatingComponent } from '@msdyn365-commerce/components';\nimport { getUrlSync, IAny, ICoreContext, IGeneric } from '@msdyn365-commerce/core';\nimport { SimpleProduct } from '@msdyn365-commerce/retail-proxy';\n\nimport { GetUserReviewInput } from '../actions/inputs/get-user-review-input';\nimport { SubmitUserReviewInput } from '../actions/inputs/submit-user-review-input';\nimport submitUserReview from '../actions/submit-user-review';\n\nexport interface IReviewModalProps {\n    userReview?: Review;\n    product?: SimpleProduct;\n    renderContextId: string;\n    resources: IReviewModalResources;\n    context:  ICoreContext<IGeneric<IAny>>;\n    parentId: string;\n    parentType: string;\n    isOpen: boolean;\n    rating: number;\n    reviewTitle: string;\n    reviewText: string;\n    returnRef: React.RefObject<HTMLButtonElement> | undefined;\n    hasError: boolean;\n    telemetryContent?: ITelemetryContent;\n    onModalToggle():void;\n    onTitleChange(event: React.ChangeEvent<HTMLInputElement>):void;\n    onTextChange(event: React.ChangeEvent<HTMLTextAreaElement>):void;\n    onRatingChange(value: number):void;\n    onReviewComplete?(isSuccess: boolean):void;\n}\n\nexport interface IReviewModalResources {\n    selectRatingAriaLabel: string;\n    selectRatingLabel: string;\n    reviewTitleLabel: string;\n    reviewTextLabel: string;\n    privacyPolicyTitle: string;\n    privacyPolicyTextFormat: string;\n    writeReviewModalTitle: string;\n    editReviewModalTitle: string;\n    submitReviewButtonText: string;\n    discardReviewButtonText: string;\n    errorMessageText: string;\n}\n\nexport interface IReviewModalViewProps {\n    modal: INodeProps;\n    modalHeader: React.ReactElement;\n    modalFooter: INodeProps;\n    modalBody: INodeProps;\n    cancelButton: React.ReactElement;\n    submitButton: React.ReactElement;\n    rating: React.ReactElement;\n    ratingLabel: React.ReactElement;\n    titleInput: React.ReactElement;\n    titleLabel: React.ReactElement;\n    textInput: React.ReactElement;\n    textLabel: React.ReactElement;\n    privacyPolicyUrl: React.ReactElement;\n    form: INodeProps;\n    inputRow: INodeProps;\n    error: React.ReactElement;\n}\n\n/**\n * CartLineItems component\n */\n\nexport const ReviewModal = (props: IReviewModalProps):IReviewModalViewProps  => {\n    const onClickSubmit = () => {return onSubmit(props);};\n    const payLoad = getPayloadObject('click', props.telemetryContent!, TelemetryConstant.SubmitReview);\n    const submitButtonAttribute = getTelemetryAttributes(props.telemetryContent!, payLoad);\n    payLoad.contentAction.etext = TelemetryConstant.Cancel;\n    const cancelButtonAttribute = getTelemetryAttributes(props.telemetryContent!, payLoad);\n    return {\n        modal: {tag: Modal, className: 'ms-review-modal', toggle: props.onModalToggle, applicationNode: 'renderPage', isOpen: props.isOpen, returnFocusRef: props.returnRef},\n        modalHeader: modalHeaderNode(props),\n        modalFooter: {tag: ModalFooter, className: 'ms-review-modal-footer'},\n        modalBody: {tag: ModalBody, className: 'ms-review-modal-body'},\n        cancelButton: <Button className='ms-review-modal-cancel' onClick={props.onModalToggle} {...submitButtonAttribute} >{props.resources.discardReviewButtonText}</Button>,\n        submitButton: <Button className='ms-review-modal-submit' onClick={onClickSubmit} {...cancelButtonAttribute} disabled={submitDisabled(props)}>{props.resources.submitReviewButtonText}</Button>,\n        rating: ratingsInput(props),\n        ratingLabel: ratingsLabel(props),\n        titleInput: titleInput(props),\n        titleLabel: titleLabel(props),\n        textInput: textInput(props),\n        textLabel: textLabel(props),\n        privacyPolicyUrl: privacyPolicyLink(props),\n        form: {tag: 'form', className: 'ms-review-modal-form', autoComplete: 'off'},\n        inputRow: {tag: 'div', className: 'ms-review-modal-row', autoComplete: 'off'},\n        error: <Alert className='ms-review-modal-error' isOpen={props.hasError} color='danger'>{props.resources.errorMessageText}</Alert>\n    };\n};\n\nconst modalHeaderNode = (props: IReviewModalProps) => {\n    return (\n        <ModalHeader toggle={props.onModalToggle} className='ms-review-modal-header'>\n            { props.userReview && props.userReview.reviewId ? props.resources.editReviewModalTitle : props.resources.writeReviewModalTitle }\n        </ModalHeader>\n    );\n};\n\nconst submitDisabled = (props: IReviewModalProps) => {\n    return !props.rating || !stripWhiteSpacesFromString(props.reviewText) || !stripWhiteSpacesFromString(props.reviewTitle);\n};\n\nconst ratingsInput = (props: IReviewModalProps) => {\n    return (\n        <RatingComponent\n            readOnly={false}\n            avgRating={0}\n            ariaLabel={props.resources.selectRatingAriaLabel}\n            initialRating={props.rating}\n            context={props.context}\n            id={props.parentId}\n            typeName={props.parentType}\n            data={{}}\n            key='ratings'\n            onChange={props.onRatingChange}\n        />\n    );\n};\n\nconst ratingsLabel = (props: IReviewModalProps) => {\n    return <label className='ms-review-modal-rating-label' key='ratingsLabel'>{props.resources.selectRatingLabel}*</label>;\n};\n\nconst titleInput = (props: IReviewModalProps) => {\n    const maxLength = props.context.app.config.reviewTitleMaxLength;\n\n    return (\n        <input\n            maxLength={maxLength}\n            id={`reviewTitle-${props.renderContextId}`}\n            onChange={props.onTitleChange}\n            value={props.reviewTitle}\n            aria-required='true'\n            className='ms-review-modal-title'\n        />\n    );\n};\n\nconst titleLabel = (props: IReviewModalProps) => {\n    return <label className='ms-review-modal-title-label' htmlFor={`reviewTitle-${props.renderContextId}`}>{props.resources.reviewTitleLabel}</label>;\n};\n\nconst reviewTextWidth: number = 50;\n\nconst textInput = (props: IReviewModalProps) => {\n    const maxLength = props.context.app.config.reviewTextMaxLength;\n    return (\n        <textarea\n            maxLength={maxLength}\n            className='ms-review-modal-text'\n            id={`reviewTextArea-${props.renderContextId}`}\n            onChange={props.onTextChange}\n            rows={maxLength / reviewTextWidth}\n            value={props.reviewText}\n            aria-required='true'\n        />\n    );\n};\n\nconst textLabel = (props: IReviewModalProps) => {\n    return <label htmlFor={`reviewTextArea-${props.renderContextId}`} className='ms-review-modal-text-label'>{props.resources.reviewTextLabel}</label>;\n};\n\nconst privacyPolicyLink = (props: IReviewModalProps) => {\n    const policyTextBlocks = props.resources.privacyPolicyTextFormat.split('{0}');\n    const isSeparatorAtStart = props.resources.privacyPolicyTextFormat.startsWith('{0}');\n    const isSeparatorAtEnd = props.resources.privacyPolicyTextFormat.endsWith('{0}');\n    const privacyPolicyUrl = getUrlSync('rnrPrivacyPolicy', props.context.actionContext);\n    const payLoad = getPayloadObject('click', props.telemetryContent!, TelemetryConstant.PrivacyPolicy);\n    const privacyPolicyAttribute = getTelemetryAttributes(props.telemetryContent!, payLoad);\n\n    return (\n        <p className='ms-review-modal-policy'>\n            {isSeparatorAtStart ? '' : policyTextBlocks[0]}\n            <a href={privacyPolicyUrl} target='_blank' className='msc-link' {...privacyPolicyAttribute}>{props.resources.privacyPolicyTitle}</a>\n            {isSeparatorAtEnd ? '' : isSeparatorAtStart ? policyTextBlocks[0] : policyTextBlocks[1] }\n        </p>\n    );\n};\n\nconst onSubmit = (props: IReviewModalProps): void => {\n    if (props.product) {\n        submitReview(props.product, props.reviewTitle, props.reviewText, props.rating, props.context, props.userReview, props.onReviewComplete);\n    }\n};\n\n/**\n * This method strips content of extra white spaces\n * @param text The text to be stripped of extra white spaces\n */\nconst stripWhiteSpacesFromString = (text: string): string => {\n    return text\n        .replace(new RegExp('\\\\r?\\\\n|\\\\r+', 'g'), ' ')\n        .replace(new RegExp('\\\\s+', 'g'), ' ')\n        .trim();\n};\n\nexport const submitReview = (product: SimpleProduct, title: string, text: string, rating: number, context: ICoreContext, userReview?: Review, onReviewSubmission?: (isSuccessful: boolean) => void) => {\n    const { request } = context;\n    const { user } = request;\n    if (user && request) {\n        const input = new SubmitUserReviewInput(\n            product.RecordId.toString(),\n            getRnrPartnerId(context.actionContext),\n            request.apiSettings.channelId.toString(),\n            request.locale,\n            {\n                productName: product && product.Name,\n                rating: rating,\n                reviewText: stripWhiteSpacesFromString(text),\n                title: stripWhiteSpacesFromString(title),\n                userEmail: user.emailAddress,\n                userName: user.name\n            },\n            request.user.token,\n            getRnrAuthEndpointId(context.actionContext)\n        );\n\n        submitUserReview(input, context.actionContext).then(reviewId => {\n            const review = !!reviewId ? {\n                rating: rating,\n                title: stripWhiteSpacesFromString(title),\n                reviewText: stripWhiteSpacesFromString(text),\n                submittedDateTime: new Date(),\n                helpfulPositive: userReview ? userReview.helpfulPositive : 0,\n                helpfulNegative: userReview ? userReview.helpfulNegative : 0,\n                reviewId: reviewId,\n                userName: request.user.firstName || request.user.name\n            } : userReview;\n\n            const getReviewInput = new GetUserReviewInput(input.productId!, input.tenantId, input.authorization, input.serviceEndpoint);\n            context.actionContext.update(getReviewInput, review);\n\n            if (onReviewSubmission) {\n                onReviewSubmission(!!reviewId);\n            }\n        }).catch(() => {\n            const productId = product.RecordId;\n            context.telemetry.error(`Failed to submit review for product with recordId: ${productId}`);\n            context.telemetry.debug(`Failed to submit review for product with recordId: ${productId}`);\n            if (onReviewSubmission) {\n                onReviewSubmission(false);\n            }\n        });\n    }\n};"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}