{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{getByCustomerAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CommerceListsDataActions.g';import{FullProductInput,getFullProducts,getProductDetailsCriteriaFromActionInput}from'./index';/**\r\n * Input class for getActiveWishlistItems data action\r\n */export var ActiveWishlistInput=function ActiveWishlistInput(){_classCallCheck(this,ActiveWishlistInput);this.getCacheKey=function(){return\"ActiveWishlistItems\";};this.getCacheObjectType=function(){return'ActiveWishlistItems';};this.dataCacheType=function(){return'none';};};var createInput=function createInput(inputData){return new ActiveWishlistInput();};/**\r\n * Calls the Retail API and returns a CommerceList object based on the passed GetCartInput\r\n */export function getActiveWishlistItems(_x,_x2){return _getActiveWishlistItems.apply(this,arguments);}function _getActiveWishlistItems(){_getActiveWishlistItems=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var wishlists,productInputs;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(input){_context.next=2;break;}throw new Error('[getActiveWishlistItems]No valid Input was provided, failing');case 2:if(!ctx.requestContext.user.isAuthenticated){_context.next=18;break;}_context.next=5;return getByCustomerAsync({callerContext:ctx,queryResultSettings:{}},null);case 5:wishlists=_context.sent;if(!(wishlists&&wishlists.length>0)){_context.next=16;break;}productInputs=[];if(wishlists[0].CommerceListLines){wishlists[0].CommerceListLines.forEach(function(commerceListLine){if(commerceListLine.ProductId){productInputs.push(new FullProductInput(commerceListLine.ProductId,ctx.requestContext.apiSettings,getProductDetailsCriteriaFromActionInput(ctx)));}});}if(!(productInputs.length>0)){_context.next=13;break;}return _context.abrupt(\"return\",getFullProducts(productInputs,ctx).then(function(products){if(products){return products;}else{return[];}})[\"catch\"](function(error){ctx.trace(error);ctx.telemetry.exception(error);ctx.telemetry.debug(\"[getActiveWishlistItems]Unable to hydrate cart with product information\");throw new Error('[getActiveWishlistItems]Unable to hydrate cart with product information');}));case 13:ctx.trace('No productIds found for wishlist');case 14:_context.next=18;break;case 16:ctx.trace('[getActiveWishlistItems]Not able to get wishlists for the customer');return _context.abrupt(\"return\",[]);case 18:ctx.trace('[getActiveWishlistItems]User token not found for wishlists');return _context.abrupt(\"return\",[]);case 20:case\"end\":return _context.stop();}}},_callee);}));return _getActiveWishlistItems.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/get-items-in-wishlist',action:getActiveWishlistItems,input:createInput});","map":{"version":3,"sources":["../../src/get-items-in-wishlist.ts"],"names":[],"mappings":"8MACA,OAAoB,0BAApB,KAAmH,yBAAnH,CAGA,OAAS,kBAAT,KAAmC,6EAAnC,CACA,OAAS,gBAAT,CAA2B,eAA3B,CAA4C,wCAA5C,KAA4F,SAA5F,CAEA;;AAEG,GACH,UAAa,CAAA,mBAAb,CAAA,8BAAA,2CACW,KAAA,WAAA,CAAc,wCAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,qBAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,MAAjB,EAAhB,CACV,CAJD,CAMA,GAAM,CAAA,WAAW,CAAG,QAAd,CAAA,WAAc,CAAC,SAAD,CAAoC,CACpD,MAAO,IAAI,CAAA,mBAAJ,EAAP,CACH,CAFD,CAIA;;AAEG,GACH,eAAsB,CAAA,sBAAtB,+D,mHAAO,iBAAsC,KAAtC,CAAkE,GAAlE,iJAEE,KAFF,8BAGO,IAAI,CAAA,KAAJ,CAAU,8DAAV,CAHP,YAMA,GAAG,CAAC,cAAJ,CAAmB,IAAnB,CAAwB,eANxB,gDAOyB,CAAA,kBAAkB,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAsB,mBAAmB,CAAE,EAA3C,CAAD,CAAkD,IAAlD,CAP3C,QAOO,SAPP,oBASI,SAAS,EAAI,SAAS,CAAC,MAAV,CAAmB,CATpC,2BAUW,aAVX,CAU+C,EAV/C,CAWK,GAAG,SAAS,CAAC,CAAD,CAAT,CAAa,iBAAhB,CAAmC,CAC/B,SAAS,CAAC,CAAD,CAAT,CAAa,iBAAb,CAA+B,OAA/B,CAAuC,SAAC,gBAAD,CAAuC,CAC1E,GAAG,gBAAgB,CAAC,SAApB,CAA+B,CAC3B,aAAa,CAAC,IAAd,CAAmB,GAAI,CAAA,gBAAJ,CAAqB,gBAAgB,CAAC,SAAtC,CAAiD,GAAG,CAAC,cAAJ,CAAmB,WAApE,CAAiF,wCAAwC,CAAC,GAAD,CAAzH,CAAnB,EACH,CACJ,CAJD,EAKH,CAjBN,KAmBQ,aAAa,CAAC,MAAd,CAAuB,CAnB/B,2DAoBgB,eAAe,CAAC,aAAD,CAAgB,GAAhB,CAAf,CACF,IADE,CACG,SAAA,QAAQ,CAAG,CACb,GAAI,QAAJ,CAAc,CACV,MAAO,CAAA,QAAP,CACH,CAFD,IAEO,CACH,MAAsB,EAAtB,CACH,CACJ,CAPE,WAQI,SAAA,KAAK,CAAG,CACX,GAAG,CAAC,KAAJ,CAAU,KAAV,EACA,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,GAAG,CAAC,SAAJ,CAAc,KAAd,4EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,yEAAV,CAAN,CACH,CAbE,CApBhB,UAmCS,GAAG,CAAC,KAAJ,CAAU,kCAAV,EAnCT,uCAsCK,GAAG,CAAC,KAAJ,CAAU,oEAAV,EAtCL,gCAuC2B,EAvC3B,UA0CH,GAAG,CAAC,KAAJ,CAAU,4DAAV,EA1CG,gCA2CmB,EA3CnB,yD,yDA8CP,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,iEADkC,CAEtC,MAAM,CAA0B,sBAFM,CAGtC,KAAK,CAAE,WAH+B,CAAD,CAAzC","sourcesContent":["import { FullProduct } from '@msdyn365-commerce/commerce-entities';\nimport { CacheType, createObservableDataAction, IAction, IActionContext, IActionInput, ICreateActionContext } from '@msdyn365-commerce/core';\nimport { CommerceListLine } from '@msdyn365-commerce/retail-proxy';\n\nimport { getByCustomerAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/CommerceListsDataActions.g';\nimport { FullProductInput, getFullProducts, getProductDetailsCriteriaFromActionInput } from './index';\n\n/**\n * Input class for getActiveWishlistItems data action\n */\nexport class ActiveWishlistInput implements IActionInput {\n    public getCacheKey = () => `ActiveWishlistItems`;\n    public getCacheObjectType = () => 'ActiveWishlistItems';\n    public dataCacheType = (): CacheType => 'none';\n}\n\nconst createInput = (inputData: ICreateActionContext) => {\n    return new ActiveWishlistInput();\n};\n\n/**\n * Calls the Retail API and returns a CommerceList object based on the passed GetCartInput\n */\nexport async function getActiveWishlistItems(input: ActiveWishlistInput, ctx: IActionContext): Promise<FullProduct[]> {\n    // If no cart ID is provided in input, we need to create a cart object\n    if (!input) {\n        throw new Error('[getActiveWishlistItems]No valid Input was provided, failing');\n    }\n\n    if(ctx.requestContext.user.isAuthenticated) {\n        const wishlists = await getByCustomerAsync({ callerContext: ctx, queryResultSettings: {} }, null);\n\n        if(wishlists && wishlists.length > 0) {\n            const productInputs: FullProductInput[] = [];\n            if(wishlists[0].CommerceListLines) {\n                wishlists[0].CommerceListLines.forEach((commerceListLine: CommerceListLine) => {\n                    if(commerceListLine.ProductId) {\n                        productInputs.push(new FullProductInput(commerceListLine.ProductId, ctx.requestContext.apiSettings, getProductDetailsCriteriaFromActionInput(ctx)));\n                    }\n                });\n            }\n\n            if(productInputs.length > 0) {\n                return getFullProducts(productInputs, ctx)\n                    .then(products => {\n                        if (products) {\n                            return products;\n                        } else {\n                            return <FullProduct[]>[];\n                        }\n                    })\n                    .catch(error => {\n                        ctx.trace(error);\n                        ctx.telemetry.exception(error);\n                        ctx.telemetry.debug(`[getActiveWishlistItems]Unable to hydrate cart with product information`);\n                        throw new Error('[getActiveWishlistItems]Unable to hydrate cart with product information');\n                    });\n            } else {\n                ctx.trace('No productIds found for wishlist');\n            }\n        } else {\n            ctx.trace('[getActiveWishlistItems]Not able to get wishlists for the customer');\n            return <FullProduct[]>[];\n        }\n    }\n    ctx.trace('[getActiveWishlistItems]User token not found for wishlists');\n    return <FullProduct[]>[];\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-items-in-wishlist',\n    action: <IAction<FullProduct[]>>getActiveWishlistItems,\n    input: createInput\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}