{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import classnames from'classnames';import React,{useState}from'react';import{buildWishlistLine,getCustomer,GetCustomerInput}from'@msdyn365-commerce-modules/retail-actions';import{Alert,UncontrolledTooltip}from'@msdyn365-commerce-modules/utilities';import{msdyn365Commerce}from'@msdyn365-commerce/core';import{AsyncResult}from'@msdyn365-commerce/retail-proxy';import{addLinesAsync,createCommerceListAsync,createGetByCustomerInput,removeLinesAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CommerceListsDataActions.g';const onClick=async(_event,props,state)=>{const{user}=props.context.request;let{product}=props.data;if(state.waiting){return;}if(!user.isAuthenticated&&user.signInUrl&&window){window.location.assign(user.signInUrl);return;}state.setWaiting(true);if(!(props.getSelectedProduct===undefined)){product=(await props.getSelectedProduct)||props.data.product;}await(doesProductExistInWishlist(product,props)?removeFromWishlist(product,props,state):addToWishlist(product,props,state));state.setWaiting(false);};const onDismiss=state=>{state.setContent({color:'success',showAlert:false});};const AddToWishlistComponentActions={onClick:onClick,onDismiss:onDismiss};const AddToWishlist=props=>{const[waiting,setWaiting]=useState(false);const[canRemove,setCanRemove]=useState(doesProductExistInWishlist(props.data.product,props));const[content,setContent]=useState({});const state={waiting,canRemove,content,setWaiting,setCanRemove,setContent};React.useEffect(()=>{setCanRemove(doesProductExistInWishlist(props.data.product,props));},[props]);const{removeFromWishlistButtonText,addToWishlistButtonText,showStatusMessage,showRemoveButton,showButtonText,className,disabled,showButtonTooltip,tooltipPosition}=props;const onClickHandler=event=>{return AddToWishlistComponentActions.onClick(event,props,state);};const onDismissHandler=()=>{return AddToWishlistComponentActions.onDismiss(state);};const ariaLabel=state.canRemove?removeFromWishlistButtonText:addToWishlistButtonText;const addToWishlistRef=/*#__PURE__*/React.createRef();const removeFromWishlistRef=/*#__PURE__*/React.createRef();const showMessage=showStatusMessage!==undefined?showStatusMessage:true;const showButton=showRemoveButton!==undefined?showRemoveButton:true;const showTooltip=showButtonTooltip!==undefined?showButtonTooltip:true;const tooltipPos=showButtonTooltip!==undefined?tooltipPosition:'right';if(state.canRemove&&!showButton){return null;}return/*#__PURE__*/React.createElement(React.Fragment,null,showButtonText?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"button\",{className:classnames('msc-add-to-wishlist',className,state.waiting?'msc-add-to-wishlist__waiting':'',state.canRemove?'msc-add-to-wishlist__removing':''),\"aria-label\":ariaLabel,onClick:onClickHandler,disabled:disabled,ref:addToWishlistRef},ariaLabel),showTooltip&&/*#__PURE__*/React.createElement(UncontrolledTooltip,{placement:tooltipPos,trigger:'hover focus',target:addToWishlistRef},ariaLabel)):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"button\",{className:classnames('msc-add-to-wishlist',className,state.waiting?'msc-add-to-wishlist__waiting':'',state.canRemove?'msc-add-to-wishlist__removing':''),\"aria-label\":ariaLabel,onClick:onClickHandler,disabled:disabled,ref:removeFromWishlistRef}),showTooltip&&/*#__PURE__*/React.createElement(UncontrolledTooltip,{placement:tooltipPos,trigger:'hover focus',target:addToWishlistRef},ariaLabel)),state.content.showAlert&&showMessage?/*#__PURE__*/React.createElement(\"div\",{className:'ms-wishlist-items__product-status'},/*#__PURE__*/React.createElement(Alert,{color:state.content.color,isOpen:state.content.showAlert,toggle:onDismissHandler},state.content.wishlistTextMessage)):'');};const doesProductExistInWishlist=(product,props)=>{const{wishlists}=props.data;if(!wishlists||!wishlists[0]){return false;}const{CommerceListLines}=wishlists[0];if(!CommerceListLines||CommerceListLines.length===0){return false;}for(const wishlistItem of CommerceListLines){if(wishlistItem.ProductId===product.RecordId){return true;}}return false;};const propogateSuccess=(props,result)=>{const{onSuccess,cartline}=props;if(onSuccess){cartline?onSuccess(result,props.cartline):onSuccess(result);}};const propogateError=(props,result)=>{const{onError}=props;if(onError){onError(result);}};const addToWishlist=async(product,props,state)=>{const{canAddMasterProduct,context}=props;if(product.Dimensions&&!canAddMasterProduct){const missingDimensions=product.Dimensions.filter(dimension=>!(dimension.DimensionValue&&dimension.DimensionValue.Value));if(missingDimensions.length>0){propogateError(props,{status:'MISSINGDIMENSION',missingDimensions:missingDimensions});return AsyncResult.resolve();}}if(context.request.user.isAuthenticated){if(!props.data.wishlists||props.data.wishlists.length===0){const wishlistName=props.nameOfWishlist;const customer=await getCustomerAccount(props);if(customer&&customer.AccountNumber){const listData={CustomerId:customer.AccountNumber,Name:wishlistName,CommerceListTypeValue:1,Id:0};try{const commerceList=await createCommerceListAsync({callerContext:context.actionContext},listData);return callAddWishlistLine(props,state,commerceList.Id,product.RecordId);}catch(error){if(context.telemetry){context.telemetry.warning(error);context.telemetry.debug('Unable to create a wishlist');}propogateError(props,{status:'FAILED'});}}else{context.telemetry.debug('Customer account number missing');}}else{return callAddWishlistLine(props,state,props.data.wishlists[0].Id,product.RecordId);}}return AsyncResult.resolve();};const callAddWishlistLine=async(props,state,wishlistId,productId)=>{const{context}=props;try{const customer=await getCustomerAccount(props);if(customer&&customer.AccountNumber){const createdCommerceList=await addLinesAsync({callerContext:context.actionContext},wishlistId,[buildWishlistLine(productId,customer.AccountNumber,wishlistId)]);context.actionContext.update(createGetByCustomerInput({},null),[createdCommerceList]);if(context.telemetry){context.telemetry.debug(\"Added item to the wishlist \".concat(createdCommerceList));}state.setCanRemove(true);state.setContent({color:'success',showAlert:true,wishlistTextMessage:props.addToWishlistMessage?props.addToWishlistMessage:'Added to your wishlist'});propogateSuccess(props,{status:'ADDED'});}else{context.telemetry.debug(\"Customer Account number missing\");}}catch(error){if(context.telemetry){context.telemetry.warning(error);context.telemetry.debug(\"Unable to add item to wishlist \".concat(error));}state.setContent({color:'danger',showAlert:true,wishlistTextMessage:props.addItemToWishlistError});propogateError(props,{status:'FAILED'});}};const removeFromWishlist=async(product,props,state)=>{const{context,data,removedFromWishlistMessage,removeItemFromWishlistError}=props;const{wishlists}=data;const{actionContext,telemetry}=context;if(context.request.user.isAuthenticated){if(wishlists&&wishlists[0]){const wishlistLine=wishlists[0].CommerceListLines.find(line=>line.ProductId===product.RecordId);if(wishlistLine){try{const customer=await getCustomerAccount(props);const commerceList=await removeLinesAsync({callerContext:actionContext},wishlists[0].Id,[wishlistLine]);if(customer){context.actionContext.update(createGetByCustomerInput({},null),[commerceList]);}else{telemetry.debug('Customer Account Number missing');}if(telemetry){telemetry.debug(\"[WishlistButton] \".concat(product.RecordId,\" removed from Wishlist \").concat(commerceList.Id));}state.setCanRemove(false);state.setContent({color:'success',showAlert:true,wishlistTextMessage:removedFromWishlistMessage?removedFromWishlistMessage:\"Removed item from the wishlist\"});propogateSuccess(props,{status:'REMOVED'});}catch(error){if(telemetry){telemetry.warning(error);telemetry.debug('[WishlistButton] Error removing item from the wishlist');}state.setContent({color:'danger',wishlistTextMessage:removeItemFromWishlistError});propogateError(props,{status:'FAILED'});}}}else{if(telemetry){telemetry.debug('[WishlistButton] Can\\'t remove from wishlist since no wishlist exisits OR there is no product data');}}}return AsyncResult.resolve();};const getCustomerAccount=props=>{const{context}=props;const customerInput=new GetCustomerInput(context.actionContext.requestContext.apiSettings);return getCustomer(customerInput,context.actionContext);};export const AddToWishlistComponent=msdyn365Commerce.createComponent('AddToWishlist',_objectSpread({component:AddToWishlist},AddToWishlistComponentActions));","map":{"version":3,"sources":["add-to-wishlist/add-to-wishlist.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import classnames from 'classnames';\nimport * as Popper from 'popper.js';\nimport React, { useState } from 'react';\n\nimport { buildWishlistLine, getCustomer, GetCustomerInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { Alert, UncontrolledTooltip } from '@msdyn365-commerce-modules/utilities';\nimport { IComponent, IComponentProps, msdyn365Commerce } from '@msdyn365-commerce/core';\nimport { AsyncResult, CartLine, CommerceList, Customer, ProductDimension, SimpleProduct } from '@msdyn365-commerce/retail-proxy';\nimport {\n    addLinesAsync, createCommerceListAsync, createGetByCustomerInput, removeLinesAsync\n} from '@msdyn365-commerce/retail-proxy/dist/DataActions/CommerceListsDataActions.g';\n\nexport interface IAddToWishlistComponentProps extends IComponentProps<IAddtoWishlistData> {\n    className?: string;\n    addToWishlistButtonText: string;\n    removeFromWishlistButtonText: string;\n    nameOfWishlist: string;\n\n    addToWishlistMessage?: string;\n    removedFromWishlistMessage?: string;\n    addItemToWishlistError?: string;\n    removeItemFromWishlistError?: string;\n\n    showButtonText?: boolean;\n    showButtonTooltip?: boolean;\n    tooltipPosition?: Popper.Placement;\n    showStatusMessage?: boolean;\n    showRemoveButton?: boolean;\n    disabled?: boolean;\n    cartline?: CartLine;\n    canAddMasterProduct?: boolean;\n\n    getSelectedProduct?: Promise<SimpleProduct | null>;\n\n    onSuccess?(result: IWishlistActionSuccessResult, cartline?: CartLine): void;\n    onError?(result: IWishlistActionErrorResult): void;\n}\n\nexport interface IWishlistActionSuccessResult {\n    status: 'ADDED' | 'REMOVED';\n}\n\nexport interface IWishlistActionErrorResult {\n    status: 'FAILED' | 'MISSINGDIMENSION';\n\n    missingDimensions?: ProductDimension[];\n}\n\ninterface IAddToWishlistStateManager {\n    waiting: boolean;\n    canRemove: boolean;\n    content: IAddtoWishlistContentState;\n\n    setWaiting(newWaiting: boolean): void;\n    setContent(newContent: IAddtoWishlistContentState): void;\n    setCanRemove(newCanRemove: boolean): void;\n}\n\ninterface IAddtoWishlistContentState {\n    showAlert?: boolean;\n    wishlistTextMessage?: string;\n    color?: string;\n}\n\ninterface IAddtoWishlistData {\n    wishlists?: CommerceList[];\n    product: SimpleProduct;\n}\n\nexport interface IAddtoWishlistComponent extends IComponent<IAddToWishlistComponentProps> {\n    onClick(): (event: React.MouseEvent<HTMLElement>, props: IAddToWishlistComponentProps, state: IAddToWishlistStateManager) => void;\n}\n\nconst onClick = async (_event: React.MouseEvent<HTMLElement>, props: IAddToWishlistComponentProps, state: IAddToWishlistStateManager): Promise<void> => {\n    const { user } = props.context.request;\n    let { product } = props.data;\n\n    if (state.waiting) {\n        return;\n    }\n\n    if (!user.isAuthenticated && user.signInUrl && window) {\n        window.location.assign(user.signInUrl);\n\n        return;\n    }\n\n    state.setWaiting(true);\n    if(!(props.getSelectedProduct === undefined)) {\n        product = (await props.getSelectedProduct) || props.data.product;\n    }\n\n    await (doesProductExistInWishlist(product, props) ? removeFromWishlist(product, props, state) : addToWishlist(product, props, state));\n    state.setWaiting(false);\n};\n\nconst onDismiss = (state: IAddToWishlistStateManager): void => {\n    state.setContent({ color:'success', showAlert: false });\n};\n\nconst AddToWishlistComponentActions = {\n    onClick: onClick,\n    onDismiss: onDismiss\n};\n\nconst AddToWishlist: React.FC<IAddToWishlistComponentProps> = (props: IAddToWishlistComponentProps) => {\n    const [waiting, setWaiting] = useState(false);\n    const [canRemove, setCanRemove] = useState(doesProductExistInWishlist(props.data.product, props));\n    const [content, setContent] = useState({});\n    const state: IAddToWishlistStateManager = {\n        waiting,\n        canRemove,\n        content,\n\n        setWaiting,\n        setCanRemove,\n        setContent\n    };\n\n    React.useEffect(\n        () => {\n            setCanRemove(doesProductExistInWishlist(props.data.product, props));\n        },\n        [props]\n    );\n\n    const { removeFromWishlistButtonText, addToWishlistButtonText, showStatusMessage, showRemoveButton, showButtonText, className, disabled, showButtonTooltip, tooltipPosition } = props;\n\n    const onClickHandler = (event: React.MouseEvent<HTMLElement>) => { return AddToWishlistComponentActions.onClick(event, props, state); };\n    const onDismissHandler = () => { return AddToWishlistComponentActions.onDismiss(state); };\n    const ariaLabel = state.canRemove ? removeFromWishlistButtonText : addToWishlistButtonText;\n    const addToWishlistRef: React.RefObject<HTMLButtonElement> = React.createRef();\n    const removeFromWishlistRef: React.RefObject<HTMLButtonElement> = React.createRef();\n    const showMessage = showStatusMessage !== undefined ? showStatusMessage: true;\n    const showButton = showRemoveButton !== undefined ? showRemoveButton: true;\n    const showTooltip = showButtonTooltip !== undefined ? showButtonTooltip: true;\n    const tooltipPos = showButtonTooltip !== undefined ? tooltipPosition: 'right';\n\n    if (state.canRemove && !showButton) {\n        return null;\n    }\n\n    return (\n        <React.Fragment>\n            {\n                showButtonText ? (\n                    <>\n                        <button\n                            className={classnames('msc-add-to-wishlist', className, state.waiting ? 'msc-add-to-wishlist__waiting' : '', state.canRemove ? 'msc-add-to-wishlist__removing' : '')}\n                            aria-label={ariaLabel}\n                            onClick={onClickHandler}\n                            disabled={disabled}\n                            ref={addToWishlistRef}\n                        >\n                            {ariaLabel}\n                        </button>\n                        {\n                            showTooltip && <UncontrolledTooltip placement={tooltipPos} trigger={'hover focus'} target={addToWishlistRef}>{ariaLabel}</UncontrolledTooltip>\n                        }\n                    </>\n                ):(\n                    <>\n                        <button\n                            className={classnames('msc-add-to-wishlist', className, state.waiting ? 'msc-add-to-wishlist__waiting' : '', state.canRemove ? 'msc-add-to-wishlist__removing' : '')}\n                            aria-label={ariaLabel}\n                            onClick={onClickHandler}\n                            disabled={disabled}\n                            ref={removeFromWishlistRef}\n                        />\n                        {\n                            showTooltip && <UncontrolledTooltip placement={tooltipPos} trigger={'hover focus'} target={addToWishlistRef}>{ariaLabel}</UncontrolledTooltip>\n                        }\n                    </>\n                )\n            }\n            {\n                state.content.showAlert && showMessage ?\n                <div className='ms-wishlist-items__product-status'>\n                    <Alert color={ state.content.color } isOpen={ state.content.showAlert } toggle={ onDismissHandler }>\n                        { state.content.wishlistTextMessage }\n                    </Alert>\n                </div> :\n                ''\n            }\n        </React.Fragment>\n    );\n};\n\nconst doesProductExistInWishlist = (product: SimpleProduct, props: IAddToWishlistComponentProps): boolean => {\n    const { wishlists } = props.data;\n\n    if (!wishlists || !wishlists[0]) {\n        return false;\n    }\n\n    const { CommerceListLines } = wishlists[0];\n\n    if (!CommerceListLines || CommerceListLines.length === 0) {\n        return false;\n    }\n\n    for (const wishlistItem of CommerceListLines) {\n        if (wishlistItem.ProductId === product.RecordId) {\n            return true;\n        }\n    }\n\n    return false;\n};\n\nconst propogateSuccess = (props: IAddToWishlistComponentProps, result: IWishlistActionSuccessResult): void => {\n    const { onSuccess, cartline } = props;\n\n    if (onSuccess) {\n        cartline ? onSuccess(result, props.cartline) : onSuccess(result);\n    }\n};\n\nconst propogateError = (props: IAddToWishlistComponentProps, result: IWishlistActionErrorResult): void => {\n    const { onError } = props;\n\n    if (onError) {\n        onError(result);\n    }\n};\n\nconst addToWishlist = async (product: SimpleProduct, props: IAddToWishlistComponentProps, state: IAddToWishlistStateManager): Promise<void> => {\n    const { canAddMasterProduct, context } = props;\n\n    if (product.Dimensions && !canAddMasterProduct) {\n        const missingDimensions = product.Dimensions.filter(dimension => !(dimension.DimensionValue && dimension.DimensionValue.Value));\n\n        if (missingDimensions.length > 0) {\n            // At least one dimension with no value exists on the product, won't be able to add to cart\n            propogateError(props, { status: 'MISSINGDIMENSION', missingDimensions: missingDimensions });\n\n            return AsyncResult.resolve();\n        }\n    }\n\n    if(context.request.user.isAuthenticated) {\n        if (!props.data.wishlists || props.data.wishlists.length === 0) {\n            const wishlistName = props.nameOfWishlist;\n            const customer = await getCustomerAccount(props);\n            if (customer && customer.AccountNumber) {\n            const listData: CommerceList = {\n                CustomerId: customer.AccountNumber,\n                Name: wishlistName,\n                // This is the type value specifically for a wishlist\n                CommerceListTypeValue: 1,\n                Id: 0\n            };\n\n            try {\n                const commerceList = await createCommerceListAsync({ callerContext: context.actionContext }, listData);\n                return callAddWishlistLine(props, state, commerceList.Id, product.RecordId);\n            } catch (error) {\n                if (context.telemetry) {\n                    context.telemetry.warning(error);\n                    context.telemetry.debug('Unable to create a wishlist');\n                }\n                propogateError(props, { status: 'FAILED' });\n            }\n        } else {\n            context.telemetry.debug('Customer account number missing');\n        }\n        } else {\n            return callAddWishlistLine(props, state, props.data.wishlists[0].Id, product.RecordId);\n        }\n    }\n\n    return AsyncResult.resolve();\n};\n\nconst callAddWishlistLine = async (props: IAddToWishlistComponentProps, state: IAddToWishlistStateManager, wishlistId: number, productId: number): Promise<void> => {\n    const { context } = props;\n\n    try {\n        const customer = await getCustomerAccount(props);\n        if (customer && customer.AccountNumber) {\n        const createdCommerceList = await addLinesAsync({ callerContext: context.actionContext }, wishlistId, [buildWishlistLine(productId, customer.AccountNumber, wishlistId)]);\n        context.actionContext.update(createGetByCustomerInput({}, null), [createdCommerceList]);\n        if (context.telemetry) {\n            context.telemetry.debug(`Added item to the wishlist ${createdCommerceList}`);\n        }\n        state.setCanRemove(true);\n        state.setContent({\n            color: 'success',\n            showAlert: true, wishlistTextMessage: props.addToWishlistMessage ? props.addToWishlistMessage : 'Added to your wishlist'\n        });\n        propogateSuccess(props, { status: 'ADDED' });\n        } else {\n            context.telemetry.debug(`Customer Account number missing`);\n        }\n    } catch (error) {\n        if (context.telemetry) {\n            context.telemetry.warning(error);\n            context.telemetry.debug(`Unable to add item to wishlist ${error}`);\n        }\n\n        state.setContent({\n            color: 'danger',\n            showAlert: true, wishlistTextMessage: props.addItemToWishlistError\n        });\n        propogateError(props, { status: 'FAILED' });\n    }\n};\n\nconst removeFromWishlist = async (product: SimpleProduct, props: IAddToWishlistComponentProps, state: IAddToWishlistStateManager): Promise<void> => {\n    const { context, data, removedFromWishlistMessage, removeItemFromWishlistError } = props;\n    const { wishlists } = data;\n    const { actionContext, telemetry } = context;\n    // TODO Please fix customeraccount number null once Bug https://msdyneng.visualstudio.com/FinOps/_workitems/edit/481375 gets fixed.\n    if(context.request.user.isAuthenticated) {\n        if (wishlists && wishlists[0]) {\n            const wishlistLine = wishlists[0].CommerceListLines!.find(line => line.ProductId === product.RecordId);\n\n            if (wishlistLine) {\n                try {\n                    const customer = await getCustomerAccount(props);\n                    const commerceList = await removeLinesAsync({ callerContext: actionContext }, wishlists[0].Id, [wishlistLine]);\n                    if (customer) {\n                        context.actionContext.update(createGetByCustomerInput({}, null), [commerceList]);\n                    } else {\n                        telemetry.debug('Customer Account Number missing');\n                    }\n\n                    if (telemetry) {\n                        telemetry.debug(`[WishlistButton] ${product.RecordId} removed from Wishlist ${commerceList.Id}`);\n                    }\n                    state.setCanRemove(false);\n                    state.setContent({\n                        color: 'success',\n                        showAlert: true, wishlistTextMessage: removedFromWishlistMessage ? removedFromWishlistMessage : `Removed item from the wishlist`\n                    });\n                    propogateSuccess(props, { status: 'REMOVED' });\n                } catch (error) {\n                    if (telemetry) {\n                        telemetry.warning(error);\n                        telemetry.debug('[WishlistButton] Error removing item from the wishlist');\n                    }\n\n                    state.setContent({\n                        color: 'danger',\n                        wishlistTextMessage: removeItemFromWishlistError\n                    });\n                    propogateError(props, { status: 'FAILED' });\n                }\n            }\n        } else {\n            if (telemetry) {\n                telemetry.debug('[WishlistButton] Can\\'t remove from wishlist since no wishlist exisits OR there is no product data');\n            }\n        }\n}\n\n    return AsyncResult.resolve();\n};\n\nconst getCustomerAccount = (props: IAddToWishlistComponentProps):AsyncResult<Customer> => {\n    const { context } = props;\n    const customerInput = new GetCustomerInput(context.actionContext.requestContext.apiSettings);\n    return getCustomer(customerInput, context.actionContext);\n};\n\n// @ts-ignore\nexport const AddToWishlistComponent: React.FunctionComponent<IAddToWishlistComponentProps> = msdyn365Commerce.createComponent<IAddtoWishlistComponent>(\n    'AddToWishlist',\n    { component: AddToWishlist, ...AddToWishlistComponentActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}