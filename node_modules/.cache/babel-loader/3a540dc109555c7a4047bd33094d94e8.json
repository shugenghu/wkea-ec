{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{getOrderTemplates,GetOrderTemplatesInput,QueryResultSettingsProxy}from'..';import{getPaginatedOrderTemplateLinesAction,GetPaginatedOrderTemplateLinesInput}from'..';import{OrderTemplate}from'../utilities/order-templates';/**\r\n *  Input class for the GetOrderTemplates data action\r\n */export var GetFullOrderTemplateInput=function GetFullOrderTemplateInput(orderTemplateId,queryResultSettings){var _this=this;_classCallCheck(this,GetFullOrderTemplateInput);this.getCacheKey=function(){return\"GetFullOrderTemplate|\".concat(_this.orderTemplateId);};this.getCacheObjectType=function(){return'GetFullOrderTemplate';};this.dataCacheType=function(){return'none';};this.orderTemplateId=orderTemplateId;this.queryResultSettings=queryResultSettings;};/**\r\n * createInput method for the GetOrderTemplate method\r\n * @param inputData The input data passed to the createInput method.\r\n */export var createGetFullOrderTemplateInput=function createGetFullOrderTemplateInput(inputData,orderTemplateId){var requestContext=inputData.requestContext;if(!requestContext.user.isAuthenticated){throw new Error('Unable to get full order templates. User is not authenticated.');}var queryResultSettings=QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings;queryResultSettings.count=true;return new GetFullOrderTemplateInput(orderTemplateId,queryResultSettings);};/**\r\n * The action method for the GetFullOrderTemplate data action\r\n * @param input The action input\r\n * @param ctx The action context\r\n */export function getFullOrderTemplateAction(_x,_x2){return _getFullOrderTemplateAction.apply(this,arguments);}/**\r\n * The GetFullOrderTemplate Data Action\r\n * Returns order templates\r\n */function _getFullOrderTemplateAction(){_getFullOrderTemplateAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var inputParams,productLists,inputLines,linesState;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(ctx.requestContext.user.isAuthenticated){_context.next=2;break;}throw new Error('Unable to get full order template. User is not authenticated.');case 2:inputParams=new GetOrderTemplatesInput(input.orderTemplateId);_context.next=5;return getOrderTemplates(inputParams,ctx);case 5:productLists=_context.sent;if(!(!productLists||productLists.length!==1)){_context.next=8;break;}throw new Error('Unable to get full order template. Order template was not found.');case 8:inputLines=new GetPaginatedOrderTemplateLinesInput(productLists[0].Id,input.queryResultSettings);_context.next=11;return getPaginatedOrderTemplateLinesAction(inputLines,ctx);case 11:linesState=_context.sent;return _context.abrupt(\"return\",new OrderTemplate(productLists[0],linesState.lines,linesState.totalCount));case 13:case\"end\":return _context.stop();}}},_callee);}));return _getFullOrderTemplateAction.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/order-templates/get-full-order-template',action:getFullOrderTemplateAction,input:createGetFullOrderTemplateInput});","map":{"version":3,"sources":["../../../src/order-templates/get-full-order-template.ts"],"names":[],"mappings":"8MAAA,OACI,0BADJ,KAKgC,yBALhC,CAQA,OAAS,iBAAT,CAA4B,sBAA5B,CAAoD,wBAApD,KAAoF,IAApF,CACA,OAAS,oCAAT,CAA+C,mCAA/C,KAA0F,IAA1F,CACA,OAAS,aAAT,KAA8B,8BAA9B,CAEA;;AAEG,GACH,UAAa,CAAA,yBAAb,CAII,mCAAY,eAAZ,CAAqC,mBAArC,CAA8E,gEAKvE,KAAA,WAAA,CAAc,gDAA8B,KAAI,CAAC,eAAnC,GAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,sBAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,MAAjB,EAAhB,CANH,KAAK,eAAL,CAAuB,eAAvB,CACA,KAAK,mBAAL,CAA2B,mBAA3B,CACH,CAPL,CAcA;;;AAGG,GACH,MAAO,IAAM,CAAA,+BAA+B,CAAG,QAAlC,CAAA,+BAAkC,CAAC,SAAD,CAAkC,eAAlC,CAAwF,IAC3H,CAAA,cAD2H,CACxG,SADwG,CAC3H,cAD2H,CAEnI,GAAI,CAAC,cAAc,CAAC,IAAf,CAAoB,eAAzB,CAA0C,CACtC,KAAM,IAAI,CAAA,KAAJ,CAAU,gEAAV,CAAN,CACH,CACD,GAAM,CAAA,mBAAmB,CAAyB,wBAAwB,CAAC,aAAzB,CAAuC,SAAvC,EAAkD,mBAApG,CACA,mBAAmB,CAAC,KAApB,CAA4B,IAA5B,CAEA,MAAO,IAAI,CAAA,yBAAJ,CAA8B,eAA9B,CAA+C,mBAA/C,CAAP,CACH,CATM,CAWP;;;;AAIG,GACH,eAAsB,CAAA,0BAAtB,mEAiBA;;;AAGG,G,2HApBI,iBAA0C,KAA1C,CAA4E,GAA5E,wKACE,GAAG,CAAC,cAAJ,CAAmB,IAAnB,CAAwB,eAD1B,8BAEO,IAAI,CAAA,KAAJ,CAAU,+DAAV,CAFP,QAKG,WALH,CAKiB,GAAI,CAAA,sBAAJ,CAA2B,KAAK,CAAC,eAAjC,CALjB,uBAMuC,CAAA,iBAAiB,CAAC,WAAD,CAAc,GAAd,CANxD,QAMG,YANH,oBAQC,CAAC,YAAD,EAAiB,YAAY,CAAC,MAAb,GAAwB,CAR1C,+BASO,IAAI,CAAA,KAAJ,CAAU,kEAAV,CATP,QAYG,UAZH,CAYgB,GAAI,CAAA,mCAAJ,CAAwC,YAAY,CAAC,CAAD,CAAZ,CAAgB,EAAxD,CAA4D,KAAK,CAAC,mBAAlE,CAZhB,wBAasB,CAAA,oCAAoC,CAAC,UAAD,CAAa,GAAb,CAb1D,SAaG,UAbH,+CAcI,GAAI,CAAA,aAAJ,CAAkB,YAAY,CAAC,CAAD,CAA9B,CAAmC,UAAU,CAAC,KAA9C,CAAqD,UAAU,CAAC,UAAhE,CAdJ,yD,6DAqBP,cAAe,CAAA,0BAA0B,CAAgB,CACrD,EAAE,CAAE,mFADiD,CAErD,MAAM,CAA0B,0BAFqB,CAGrD,KAAK,CAAE,+BAH8C,CAAhB,CAAzC","sourcesContent":["import { CacheType,\n    createObservableDataAction,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICreateActionContext } from '@msdyn365-commerce/core';\nimport { IQueryResultSettings } from '@msdyn365-commerce/retail-proxy';\nimport { ProductList } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { getOrderTemplates, GetOrderTemplatesInput, QueryResultSettingsProxy } from '..';\nimport { getPaginatedOrderTemplateLinesAction, GetPaginatedOrderTemplateLinesInput } from '..';\nimport { OrderTemplate } from '../utilities/order-templates';\n\n/**\n *  Input class for the GetOrderTemplates data action\n */\nexport class GetFullOrderTemplateInput implements IActionInput {\n    public orderTemplateId: string;\n    public queryResultSettings: IQueryResultSettings;\n\n    constructor(orderTemplateId: string, queryResultSettings: IQueryResultSettings) {\n        this.orderTemplateId = orderTemplateId;\n        this.queryResultSettings = queryResultSettings;\n    }\n\n    public getCacheKey = () => `GetFullOrderTemplate|${this.orderTemplateId}`;\n    public getCacheObjectType = () => 'GetFullOrderTemplate';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * createInput method for the GetOrderTemplate method\n * @param inputData The input data passed to the createInput method.\n */\nexport const createGetFullOrderTemplateInput = (inputData: ICreateActionContext, orderTemplateId: string): GetFullOrderTemplateInput => {\n    const { requestContext } = inputData;\n    if (!requestContext.user.isAuthenticated) {\n        throw new Error('Unable to get full order templates. User is not authenticated.');\n    }\n    const queryResultSettings: IQueryResultSettings = QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings;\n    queryResultSettings.count = true;\n\n    return new GetFullOrderTemplateInput(orderTemplateId, queryResultSettings);\n};\n\n/**\n * The action method for the GetFullOrderTemplate data action\n * @param input The action input\n * @param ctx The action context\n */\nexport async function getFullOrderTemplateAction(input: GetFullOrderTemplateInput, ctx: IActionContext): Promise<OrderTemplate> {\n    if (!ctx.requestContext.user.isAuthenticated) {\n        throw new Error('Unable to get full order template. User is not authenticated.');\n    }\n\n    const inputParams = new GetOrderTemplatesInput(input.orderTemplateId);\n    const productLists: ProductList[] = await getOrderTemplates(inputParams, ctx);\n\n    if (!productLists || productLists.length !== 1) {\n        throw new Error('Unable to get full order template. Order template was not found.');\n    }\n\n    const inputLines = new GetPaginatedOrderTemplateLinesInput(productLists[0].Id, input.queryResultSettings);\n    const linesState = await getPaginatedOrderTemplateLinesAction(inputLines, ctx);\n    return new OrderTemplate(productLists[0], linesState.lines, linesState.totalCount);\n}\n\n/**\n * The GetFullOrderTemplate Data Action\n * Returns order templates\n */\nexport default createObservableDataAction<OrderTemplate>({\n    id: '@msdyn365-commerce-modules/retail-actions/order-templates/get-full-order-template',\n    action: <IAction<OrderTemplate>>getFullOrderTemplateAction,\n    input: createGetFullOrderTemplateInput\n});"],"sourceRoot":""},"metadata":{},"sourceType":"module"}