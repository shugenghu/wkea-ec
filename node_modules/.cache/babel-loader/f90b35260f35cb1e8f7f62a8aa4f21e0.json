{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{getByCustomerAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CommerceListsDataActions.g';import{FullProductInput,getFullProducts,getProductDetailsCriteriaFromActionInput}from'./index';/**\r\n * Input class for getActiveWishlistItems data action\r\n */export class ActiveWishlistInput{constructor(){this.getCacheKey=()=>\"ActiveWishlistItems\";this.getCacheObjectType=()=>'ActiveWishlistItems';this.dataCacheType=()=>'none';}}const createInput=inputData=>{return new ActiveWishlistInput();};/**\r\n * Calls the Retail API and returns a CommerceList object based on the passed GetCartInput\r\n */export async function getActiveWishlistItems(input,ctx){// If no cart ID is provided in input, we need to create a cart object\nif(!input){throw new Error('[getActiveWishlistItems]No valid Input was provided, failing');}if(ctx.requestContext.user.isAuthenticated){const wishlists=await getByCustomerAsync({callerContext:ctx,queryResultSettings:{}},null);if(wishlists&&wishlists.length>0){const productInputs=[];if(wishlists[0].CommerceListLines){wishlists[0].CommerceListLines.forEach(commerceListLine=>{if(commerceListLine.ProductId){productInputs.push(new FullProductInput(commerceListLine.ProductId,ctx.requestContext.apiSettings,getProductDetailsCriteriaFromActionInput(ctx)));}});}if(productInputs.length>0){return getFullProducts(productInputs,ctx).then(products=>{if(products){return products;}else{return[];}}).catch(error=>{ctx.trace(error);ctx.telemetry.exception(error);ctx.telemetry.debug(\"[getActiveWishlistItems]Unable to hydrate cart with product information\");throw new Error('[getActiveWishlistItems]Unable to hydrate cart with product information');});}else{ctx.trace('No productIds found for wishlist');}}else{ctx.trace('[getActiveWishlistItems]Not able to get wishlists for the customer');return[];}}ctx.trace('[getActiveWishlistItems]User token not found for wishlists');return[];}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/get-items-in-wishlist',action:getActiveWishlistItems,input:createInput});","map":{"version":3,"sources":["../../src/get-items-in-wishlist.ts"],"names":[],"mappings":"8FACA,OAAoB,0BAApB,KAAmH,yBAAnH,CAGA,OAAS,kBAAT,KAAmC,6EAAnC,CACA,OAAS,gBAAT,CAA2B,eAA3B,CAA4C,wCAA5C,KAA4F,SAA5F,CAEA;;AAEG,GACH,MAAM,MAAO,CAAA,mBAAmB,CAAhC,WAAA,EAAA,CACW,KAAA,WAAA,CAAc,yBAAd,CACA,KAAA,kBAAA,CAAqB,IAAM,qBAA3B,CACA,KAAA,aAAA,CAAgB,IAAiB,MAAjC,CACV,CAJ+B,CAMhC,KAAM,CAAA,WAAW,CAAI,SAAD,EAAoC,CACpD,MAAO,IAAI,CAAA,mBAAJ,EAAP,CACH,CAFD,CAIA;;AAEG,GACH,MAAO,eAAe,CAAA,sBAAf,CAAsC,KAAtC,CAAkE,GAAlE,CAAqF,CACxF;AACA,GAAI,CAAC,KAAL,CAAY,CACR,KAAM,IAAI,CAAA,KAAJ,CAAU,8DAAV,CAAN,CACH,CAED,GAAG,GAAG,CAAC,cAAJ,CAAmB,IAAnB,CAAwB,eAA3B,CAA4C,CACxC,KAAM,CAAA,SAAS,CAAG,KAAM,CAAA,kBAAkB,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAsB,mBAAmB,CAAE,EAA3C,CAAD,CAAkD,IAAlD,CAA1C,CAEA,GAAG,SAAS,EAAI,SAAS,CAAC,MAAV,CAAmB,CAAnC,CAAsC,CAClC,KAAM,CAAA,aAAa,CAAuB,EAA1C,CACA,GAAG,SAAS,CAAC,CAAD,CAAT,CAAa,iBAAhB,CAAmC,CAC/B,SAAS,CAAC,CAAD,CAAT,CAAa,iBAAb,CAA+B,OAA/B,CAAwC,gBAAD,EAAuC,CAC1E,GAAG,gBAAgB,CAAC,SAApB,CAA+B,CAC3B,aAAa,CAAC,IAAd,CAAmB,GAAI,CAAA,gBAAJ,CAAqB,gBAAgB,CAAC,SAAtC,CAAiD,GAAG,CAAC,cAAJ,CAAmB,WAApE,CAAiF,wCAAwC,CAAC,GAAD,CAAzH,CAAnB,EACH,CACJ,CAJD,EAKH,CAED,GAAG,aAAa,CAAC,MAAd,CAAuB,CAA1B,CAA6B,CACzB,MAAO,CAAA,eAAe,CAAC,aAAD,CAAgB,GAAhB,CAAf,CACF,IADE,CACG,QAAQ,EAAG,CACb,GAAI,QAAJ,CAAc,CACV,MAAO,CAAA,QAAP,CACH,CAFD,IAEO,CACH,MAAsB,EAAtB,CACH,CACJ,CAPE,EAQF,KARE,CAQI,KAAK,EAAG,CACX,GAAG,CAAC,KAAJ,CAAU,KAAV,EACA,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,GAAG,CAAC,SAAJ,CAAc,KAAd,4EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,yEAAV,CAAN,CACH,CAbE,CAAP,CAcH,CAfD,IAeO,CACH,GAAG,CAAC,KAAJ,CAAU,kCAAV,EACH,CACJ,CA5BD,IA4BO,CACH,GAAG,CAAC,KAAJ,CAAU,oEAAV,EACA,MAAsB,EAAtB,CACH,CACJ,CACD,GAAG,CAAC,KAAJ,CAAU,4DAAV,EACA,MAAsB,EAAtB,CACH,CAED,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,iEADkC,CAEtC,MAAM,CAA0B,sBAFM,CAGtC,KAAK,CAAE,WAH+B,CAAD,CAAzC","sourcesContent":["import { FullProduct } from '@msdyn365-commerce/commerce-entities';\nimport { CacheType, createObservableDataAction, IAction, IActionContext, IActionInput, ICreateActionContext } from '@msdyn365-commerce/core';\nimport { CommerceListLine } from '@msdyn365-commerce/retail-proxy';\n\nimport { getByCustomerAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/CommerceListsDataActions.g';\nimport { FullProductInput, getFullProducts, getProductDetailsCriteriaFromActionInput } from './index';\n\n/**\n * Input class for getActiveWishlistItems data action\n */\nexport class ActiveWishlistInput implements IActionInput {\n    public getCacheKey = () => `ActiveWishlistItems`;\n    public getCacheObjectType = () => 'ActiveWishlistItems';\n    public dataCacheType = (): CacheType => 'none';\n}\n\nconst createInput = (inputData: ICreateActionContext) => {\n    return new ActiveWishlistInput();\n};\n\n/**\n * Calls the Retail API and returns a CommerceList object based on the passed GetCartInput\n */\nexport async function getActiveWishlistItems(input: ActiveWishlistInput, ctx: IActionContext): Promise<FullProduct[]> {\n    // If no cart ID is provided in input, we need to create a cart object\n    if (!input) {\n        throw new Error('[getActiveWishlistItems]No valid Input was provided, failing');\n    }\n\n    if(ctx.requestContext.user.isAuthenticated) {\n        const wishlists = await getByCustomerAsync({ callerContext: ctx, queryResultSettings: {} }, null);\n\n        if(wishlists && wishlists.length > 0) {\n            const productInputs: FullProductInput[] = [];\n            if(wishlists[0].CommerceListLines) {\n                wishlists[0].CommerceListLines.forEach((commerceListLine: CommerceListLine) => {\n                    if(commerceListLine.ProductId) {\n                        productInputs.push(new FullProductInput(commerceListLine.ProductId, ctx.requestContext.apiSettings, getProductDetailsCriteriaFromActionInput(ctx)));\n                    }\n                });\n            }\n\n            if(productInputs.length > 0) {\n                return getFullProducts(productInputs, ctx)\n                    .then(products => {\n                        if (products) {\n                            return products;\n                        } else {\n                            return <FullProduct[]>[];\n                        }\n                    })\n                    .catch(error => {\n                        ctx.trace(error);\n                        ctx.telemetry.exception(error);\n                        ctx.telemetry.debug(`[getActiveWishlistItems]Unable to hydrate cart with product information`);\n                        throw new Error('[getActiveWishlistItems]Unable to hydrate cart with product information');\n                    });\n            } else {\n                ctx.trace('No productIds found for wishlist');\n            }\n        } else {\n            ctx.trace('[getActiveWishlistItems]Not able to get wishlists for the customer');\n            return <FullProduct[]>[];\n        }\n    }\n    ctx.trace('[getActiveWishlistItems]User token not found for wishlists');\n    return <FullProduct[]>[];\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-items-in-wishlist',\n    action: <IAction<FullProduct[]>>getActiveWishlistItems,\n    input: createInput\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}