{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{buildCacheKeyWithUrlTokens,CurrentCategoryInput,getCategoryUrl,getCurrentCategory}from'@msdyn365-commerce-modules/retail-actions';import{createObservableDataAction,getFriendlyName}from'@msdyn365-commerce/core';export var CategoryPageSummaryInput=function CategoryPageSummaryInput(config,requestContext){var _this=this;_classCallCheck(this,CategoryPageSummaryInput);this.getCacheObjectType=function(){return'CategoryPageSummary';};this.getCacheKey=function(){return buildCacheKeyWithUrlTokens('CategoryPageSummary',_this.requestContext);};this.dataCacheType=function(){return'request';};this.config=config||{};this.requestContext=requestContext;};var createGetCurrentCategoryInput=function createGetCurrentCategoryInput(inputData){if(inputData&&inputData.requestContext){return new CurrentCategoryInput(inputData.requestContext);}throw new Error('Please specify categoryId query string in request.');};var action=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,context){var config,currentCategory,categoryUrl,localName,neutralizedName,canonicalDomain;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config=input.config;_context.prev=1;_context.next=4;return getCurrentCategory(createGetCurrentCategoryInput(context),context);case 4:currentCategory=_context.sent;_context.next=9;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);case 9:if(!currentCategory){_context.next=14;break;}try{localName=getFriendlyName(context.requestContext.locale,currentCategory.NameTranslations);neutralizedName=currentCategory.NeutralizedName||currentCategory.Name;currentCategory.Name=localName;currentCategory.NeutralizedName=neutralizedName;categoryUrl=getCategoryUrl(currentCategory);canonicalDomain=context.requestContext.canonicalDomain;if(categoryUrl&&canonicalDomain){categoryUrl=\"https://\".concat(canonicalDomain).concat(categoryUrl);}else{categoryUrl=undefined;}}catch(e){categoryUrl=undefined;}return _context.abrupt(\"return\",{title:currentCategory.Name,sharingImageUrl:currentCategory.OfflineImage,canonicalUrl:categoryUrl,faviconUrl:config&&config.faviconUrl});case 14:if(!config){_context.next=18;break;}return _context.abrupt(\"return\",{title:config.title,sharingImageUrl:config.sharingImage&&config.sharingImage.src,faviconUrl:config&&config.faviconUrl});case 18:return _context.abrupt(\"return\",{});case 19:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return function action(_x,_x2){return _ref.apply(this,arguments);};}();export default createObservableDataAction({id:'@msdyn365-commerce-modules/page-summary/category-page-summary',action:action,input:function input(args){return new CategoryPageSummaryInput(args.config,args.requestContext);}});","map":{"version":3,"sources":["modules/category-page-summary/category-page-summary.action.ts"],"names":[],"mappings":"8MAAA,OAAS,0BAAT,CAAqC,oBAArC,CAA2D,cAA3D,CAA2E,kBAA3E,KAAqG,2CAArG,CACA,OAEI,0BAFJ,CAGI,eAHJ,KASO,yBATP,CAcA,UAAa,CAAA,wBAAb,CAII,kCAAY,MAAZ,CAA+C,cAA/C,CAA8E,+DAKvE,KAAA,kBAAA,CAAqB,iBAAc,qBAAd,EAArB,CACA,KAAA,WAAA,CAAc,iBAAc,CAAA,0BAA0B,CAAC,qBAAD,CAAwB,KAAI,CAAC,cAA7B,CAAxC,EAAd,CACA,KAAA,aAAA,CAAgB,iBAAiB,SAAjB,EAAhB,CANH,KAAK,MAAL,CAAc,MAAM,EAAI,EAAxB,CACA,KAAK,cAAL,CAAsB,cAAtB,CACH,CAPL,CAcA,GAAM,CAAA,6BAA6B,CAAG,QAAhC,CAAA,6BAAgC,CAAC,SAAD,CAAoD,CACtF,GAAI,SAAS,EAAI,SAAS,CAAC,cAA3B,CAA2C,CACvC,MAAO,IAAI,CAAA,oBAAJ,CAAyB,SAAS,CAAC,cAAnC,CAAP,CACH,CAED,KAAM,IAAI,CAAA,KAAJ,CAAU,oDAAV,CAAN,CACH,CAND,CAQA,GAAM,CAAA,MAAM,0FAAG,iBAAO,KAAP,CAAwC,OAAxC,mMACH,MADG,CACQ,KADR,CACH,MADG,uCAIiB,CAAA,kBAAkB,CAAC,6BAA6B,CAAC,OAAD,CAA9B,CAAyC,OAAzC,CAJnC,QAIP,eAJO,wGAQP,eARO,0BAUP,GAAI,CAEM,SAFN,CAEkB,eAAe,CAAC,OAAO,CAAC,cAAR,CAAuB,MAAxB,CAAgC,eAAe,CAAC,gBAAhD,CAFjC,CAGM,eAHN,CAGwB,eAAe,CAAC,eAAhB,EAAmC,eAAe,CAAC,IAH3E,CAIA,eAAe,CAAC,IAAhB,CAAuB,SAAvB,CACA,eAAe,CAAC,eAAhB,CAAkC,eAAlC,CACA,WAAW,CAAG,cAAc,CAAC,eAAD,CAA5B,CAEM,eARN,CAQwB,OAAO,CAAC,cAAR,CAAuB,eAR/C,CASA,GAAI,WAAW,EAAI,eAAnB,CAAoC,CAChC,WAAW,mBAAc,eAAd,SAAgC,WAAhC,CAAX,CACH,CAFD,IAEO,CACH,WAAW,CAAG,SAAd,CACH,CACJ,CAAC,MAAO,CAAP,CAAU,CACR,WAAW,CAAG,SAAd,CACH,CA1BM,gCA2BA,CACH,KAAK,CAAE,eAAe,CAAC,IADpB,CAEH,eAAe,CAAE,eAAe,CAAC,YAF9B,CAGH,YAAY,CAAE,WAHX,CAIH,UAAU,CAAE,MAAM,EAAI,MAAM,CAAC,UAJ1B,CA3BA,cAkCA,MAlCA,0DAmCA,CACH,KAAK,CAAE,MAAM,CAAC,KADX,CAEH,eAAe,CAAE,MAAM,CAAC,YAAP,EAAuB,MAAM,CAAC,YAAP,CAAoB,GAFzD,CAGH,UAAU,CAAE,MAAM,EAAI,MAAM,CAAC,UAH1B,CAnCA,0CAyCA,EAzCA,sEAAH,kBAAN,CAAA,MAAM,gDAAZ,CA6CA,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,+DADkC,CAEtC,MAAM,CAA6B,MAFG,CAGtC,KAAK,CAAE,eAAC,IAAD,CAA+B,CAClC,MAAO,IAAI,CAAA,wBAAJ,CAAwD,IAAI,CAAC,MAA7D,CAAqE,IAAI,CAAC,cAA1E,CAAP,CACH,CALqC,CAAD,CAAzC","sourcesContent":["import { buildCacheKeyWithUrlTokens, CurrentCategoryInput, getCategoryUrl, getCurrentCategory } from '@msdyn365-commerce-modules/retail-actions';\nimport {\n    CacheType,\n    createObservableDataAction,\n    getFriendlyName,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICreateActionContext,\n    IRequestContext\n} from '@msdyn365-commerce/core';\nimport { IDefaultPageSummaryConfig } from '../default-page-summary/default-page-summary.props.autogenerated';\nimport { IPageSummaryData } from '../IPageSummaryData';\n\n/** Category Page Summary Input */\nexport class CategoryPageSummaryInput implements IActionInput {\n    public requestContext: IRequestContext;\n    public config: IDefaultPageSummaryConfig;\n\n    constructor(config: IDefaultPageSummaryConfig, requestContext: IRequestContext) {\n        this.config = config || {};\n        this.requestContext = requestContext;\n    }\n\n    public getCacheObjectType = (): string => 'CategoryPageSummary';\n    public getCacheKey = (): string => buildCacheKeyWithUrlTokens('CategoryPageSummary', this.requestContext);\n    public dataCacheType = (): CacheType => 'request';\n}\n\nconst createGetCurrentCategoryInput = (inputData: IActionContext): CurrentCategoryInput => {\n    if (inputData && inputData.requestContext) {\n        return new CurrentCategoryInput(inputData.requestContext);\n    }\n\n    throw new Error('Please specify categoryId query string in request.');\n};\n\nconst action = async (input: CategoryPageSummaryInput, context: IActionContext): Promise<IPageSummaryData> => {\n    const { config } = input;\n    let currentCategory;\n    try {\n        currentCategory = await getCurrentCategory(createGetCurrentCategoryInput(context), context);\n    } catch (e) {\n        // Do nothing, if the action fails fallback to values defined in data\n    }\n    if (currentCategory) {\n        let categoryUrl: string | undefined;\n        try {\n            // reset category's name neutralizedName\n            const localName = getFriendlyName(context.requestContext.locale, currentCategory.NameTranslations);\n            const neutralizedName = currentCategory.NeutralizedName || currentCategory.Name;\n            currentCategory.Name = localName;\n            currentCategory.NeutralizedName = neutralizedName;\n            categoryUrl = getCategoryUrl(currentCategory);\n            // @ts-ignore - TODO: property exits in new version of SDK. Remove once released.\n            const canonicalDomain = context.requestContext.canonicalDomain;\n            if (categoryUrl && canonicalDomain) {\n                categoryUrl = `https://${canonicalDomain}${categoryUrl}`;\n            } else {\n                categoryUrl = undefined;\n            }\n        } catch (e) {\n            categoryUrl = undefined;\n        }\n        return {\n            title: currentCategory.Name,\n            sharingImageUrl: currentCategory.OfflineImage,\n            canonicalUrl: categoryUrl,\n            faviconUrl: config && config.faviconUrl\n        };\n        // If the action fails fallback to values defined from data\n    } else if (config) {\n        return {\n            title: config.title,\n            sharingImageUrl: config.sharingImage && config.sharingImage.src,\n            faviconUrl: config && config.faviconUrl\n        };\n    } else {\n        return {};\n    }\n};\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/page-summary/category-page-summary',\n    action: <IAction<IPageSummaryData>>action,\n    input: (args: ICreateActionContext) => {\n        return new CategoryPageSummaryInput(<IDefaultPageSummaryConfig>args.config, args.requestContext);\n    }\n});\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}