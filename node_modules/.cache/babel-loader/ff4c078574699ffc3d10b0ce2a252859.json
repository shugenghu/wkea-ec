{"ast":null,"code":"import\"core-js/modules/es.array.reduce.js\";import\"core-js/modules/es.promise.js\";import\"core-js/modules/es.regexp.to-string.js\";/*!\r\n * Copyright (c) Microsoft Corporation.\r\n * All rights reserved. See LICENSE in the project root for license information.\r\n */import{createObservableDataAction}from'@msdyn365-commerce/core';import{getByIdsAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import{getProductImageUrls}from'../utils/product-list-utils';const buildCacheKey=(base,apiSettings)=>{return\"\".concat(base,\"-chanId:\").concat(apiSettings.channelId,\"-catId:\").concat(apiSettings.catalogId);};/**\r\n * Product Input\r\n */export class ProductInput{constructor(productId,apiSettings){this.getCacheKey=()=>buildCacheKey(\"RecordId-\".concat(this.productId.toString()),this.apiSettings);this.getCacheObjectType=()=>'SimpleProduct';this.dataCacheType=()=>'application';this.apiSettings=apiSettings;this.productId=+productId;this.channelId=apiSettings.channelId;}}/**\r\n * Calls the Retail API and returns the product based on the passed ProductInput\r\n */export async function getSimpleProductsAction(inputs,ctx){if(!inputs||!Array.isArray(inputs)||inputs.length===0){ctx.trace('[getSimpleProductsAction] Invalid or empty inputs passed.');return[];}const productIdMapping={};const productIds=inputs.map((input,idx)=>{productIdMapping[input.productId]=idx;return input.productId;});return getByIdsAsync({callerContext:ctx},inputs[0].channelId,productIds).then(products=>{if(!products){return[];}const mappedProducts=getProductImageUrls(products,ctx.requestContext.apiSettings).reduce((memo,product)=>{if(!product){return memo;}const idx=productIdMapping[product.RecordId];memo[idx]=product;return memo;},[]);// NOTE: <ZAFINE> This is not an ideal fix, but will resolve all current issues\nreturn inputs.map(input=>{const foundProduct=mappedProducts.find(product=>product&&product.RecordId===input.productId);return foundProduct||{};});});}export default createObservableDataAction({action:getSimpleProductsAction,id:'@msdyn365-commerce/get-simple-products',isBatched:true});","map":{"version":3,"sources":["../../../src/hydrators/get-simple-products.ts"],"names":[],"mappings":"gIAAA;;;AAGG,GAEH,OAEI,0BAFJ,KAQO,yBARP,CASA,OAAS,aAAT,KAA8B,wEAA9B,CAGA,OAAS,mBAAT,KAAoC,6BAApC,CAEA,KAAM,CAAA,aAAa,CAAG,CAAC,IAAD,CAAe,WAAf,GAA4D,CAC9E,gBAAU,IAAV,oBAAyB,WAAW,CAAC,SAArC,mBAAwD,WAAW,CAAC,SAApE,EACH,CAFD,CAIA;;AAEG,GACH,MAAM,MAAO,CAAA,YAAY,CAKrB,WAAA,CAAY,SAAZ,CAAwC,WAAxC,CAAyE,CAMlE,KAAA,WAAA,CAAc,IAAM,aAAa,oBAAa,KAAK,SAAL,CAAe,QAAf,EAAb,EAA0C,KAAK,WAA/C,CAAjC,CACA,KAAA,kBAAA,CAAqB,IAAM,eAA3B,CACA,KAAA,aAAA,CAAgB,IAAiB,aAAjC,CAPH,KAAK,WAAL,CAAmB,WAAnB,CACA,KAAK,SAAL,CAAiB,CAAC,SAAlB,CACA,KAAK,SAAL,CAAiB,WAAW,CAAC,SAA7B,CACH,CAToB,CAgBzB;;AAEG,GACH,MAAO,eAAe,CAAA,uBAAf,CAAuC,MAAvC,CAA+D,GAA/D,CAAkF,CACrF,GAAI,CAAC,MAAD,EAAW,CAAC,KAAK,CAAC,OAAN,CAAc,MAAd,CAAZ,EAAqC,MAAM,CAAC,MAAP,GAAkB,CAA3D,CAA8D,CAC1D,GAAG,CAAC,KAAJ,CAAU,2DAAV,EACA,MAAO,EAAP,CACH,CAED,KAAM,CAAA,gBAAgB,CAAwB,EAA9C,CACA,KAAM,CAAA,UAAU,CAAG,MAAM,CAAC,GAAP,CAAW,CAAC,KAAD,CAAQ,GAAR,GAAe,CACzC,gBAAgB,CAAC,KAAK,CAAC,SAAP,CAAhB,CAAoC,GAApC,CACA,MAAO,CAAA,KAAK,CAAC,SAAb,CACH,CAHkB,CAAnB,CAKA,MAAO,CAAA,aAAa,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,MAAM,CAAC,CAAD,CAAN,CAAU,SAAnC,CAA8C,UAA9C,CAAb,CAAuE,IAAvE,CAA4E,QAAQ,EAAG,CAC1F,GAAI,CAAC,QAAL,CAAe,CACX,MAAO,EAAP,CACH,CACD,KAAM,CAAA,cAAc,CAAqB,mBAAmB,CAAC,QAAD,CAAW,GAAG,CAAC,cAAJ,CAAmB,WAA9B,CAAnB,CAA+D,MAA/D,CACrC,CAAC,IAAD,CAAwB,OAAxB,GAA8D,CAC1D,GAAI,CAAC,OAAL,CAAc,CACV,MAAO,CAAA,IAAP,CACH,CACD,KAAM,CAAA,GAAG,CAAG,gBAAgB,CAAC,OAAO,CAAC,QAAT,CAA5B,CACA,IAAI,CAAC,GAAD,CAAJ,CAAY,OAAZ,CACA,MAAO,CAAA,IAAP,CACH,CARoC,CASrC,EATqC,CAAzC,CAYA;AACA,MAAO,CAAA,MAAM,CAAC,GAAP,CAAW,KAAK,EAAG,CACtB,KAAM,CAAA,YAAY,CAAG,cAAc,CAAC,IAAf,CAAoB,OAAO,EAAI,OAAO,EAAI,OAAO,CAAC,QAAR,GAAqB,KAAK,CAAC,SAArE,CAArB,CACA,MAAO,CAAA,YAAY,EAAmB,EAAtC,CACH,CAHM,CAAP,CAIH,CArBM,CAAP,CAsBH,CAED,cAAe,CAAA,0BAA0B,CAAC,CACtC,MAAM,CAA4B,uBADI,CAEtC,EAAE,CAAE,wCAFkC,CAGtC,SAAS,CAAE,IAH2B,CAAD,CAAzC","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport {\n    CacheType,\n    createObservableDataAction,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICommerceApiSettings,\n    IDictionary\n} from '@msdyn365-commerce/core';\nimport { getByIdsAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\n\nimport { getProductImageUrls } from '../utils/product-list-utils';\n\nconst buildCacheKey = (base: string, apiSettings: ICommerceApiSettings): string => {\n    return `${base}-chanId:${apiSettings.channelId}-catId:${apiSettings.catalogId}`;\n};\n\n/**\n * Product Input\n */\nexport class ProductInput implements IActionInput {\n    public productId: number;\n    public channelId: number;\n    private apiSettings: ICommerceApiSettings;\n\n    constructor(productId: number | string, apiSettings: ICommerceApiSettings) {\n        this.apiSettings = apiSettings;\n        this.productId = +productId;\n        this.channelId = apiSettings.channelId;\n    }\n\n    public getCacheKey = () => buildCacheKey(`RecordId-${this.productId.toString()}`, this.apiSettings);\n    public getCacheObjectType = () => 'SimpleProduct';\n    public dataCacheType = (): CacheType => 'application';\n}\n\n/**\n * Calls the Retail API and returns the product based on the passed ProductInput\n */\nexport async function getSimpleProductsAction(inputs: ProductInput[], ctx: IActionContext): Promise<SimpleProduct[]> {\n    if (!inputs || !Array.isArray(inputs) || inputs.length === 0) {\n        ctx.trace('[getSimpleProductsAction] Invalid or empty inputs passed.');\n        return [];\n    }\n\n    const productIdMapping: IDictionary<number> = {};\n    const productIds = inputs.map((input, idx) => {\n        productIdMapping[input.productId] = idx;\n        return input.productId;\n    });\n\n    return getByIdsAsync({ callerContext: ctx }, inputs[0].channelId, productIds).then(products => {\n        if (!products) {\n            return [];\n        }\n        const mappedProducts = (<SimpleProduct[]>getProductImageUrls(products, ctx.requestContext.apiSettings)).reduce(\n            (memo: SimpleProduct[], product: SimpleProduct | undefined) => {\n                if (!product) {\n                    return memo;\n                }\n                const idx = productIdMapping[product.RecordId];\n                memo[idx] = product;\n                return memo;\n            },\n            []\n        );\n\n        // NOTE: <ZAFINE> This is not an ideal fix, but will resolve all current issues\n        return inputs.map(input => {\n            const foundProduct = mappedProducts.find(product => product && product.RecordId === input.productId);\n            return foundProduct || <SimpleProduct>{};\n        });\n    });\n}\n\nexport default createObservableDataAction({\n    action: <IAction<SimpleProduct[]>>getSimpleProductsAction,\n    id: '@msdyn365-commerce/get-simple-products',\n    isBatched: true\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}