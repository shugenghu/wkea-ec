{"ast":null,"code":"import _typeof from\"@babel/runtime/helpers/esm/typeof\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import{getCategoryUrl}from'@msdyn365-commerce-modules/retail-actions';import{addThrottledEvent}from'@msdyn365-commerce-modules/utilities';import{isEmptyOrNullObject}from'@msdyn365-commerce/core';import classnames from'classnames';import{computed,observable}from'mobx';import*as React from'react';var NavigationMenu=/*#__PURE__*/function(_React$PureComponent){_inherits(NavigationMenu,_React$PureComponent);var _super=_createSuper(NavigationMenu);function NavigationMenu(props){var _this;_classCallCheck(this,NavigationMenu);_this=_super.call(this,props);_this.isRetail=true;_this.isCMS=true;_this._setNavigationSource=function(sourceType){switch(sourceType){case\"retailServerOnly\":_this.isRetail=true;_this.isCMS=false;break;case\"cmsOnly\":_this.isRetail=false;_this.isCMS=true;break;case\"all\":_this.isRetail=true;_this.isCMS=true;break;default:}};_this._updateViewport=_this._updateViewport.bind(_assertThisInitialized(_this));_this.viewport=props.context.request&&props.context.request.device&&props.context.request.device.Type==='Mobile'?'xs':'lg';_this._setNavigationSource(_this.props.config&&_this.props.config.navigationMenuSource);_this.state={isMobile:_this.isMobile};_this.menuItemList=[];return _this;}_createClass(NavigationMenu,[{key:\"componentDidMount\",value:function componentDidMount(){this.resizeThrottledEventHandler=window&&addThrottledEvent(window,'resize',this._updateViewport);this._updateViewport();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){window&&window.removeEventListener('resize',this.resizeThrottledEventHandler,false);}},{key:\"render\",value:function render(){this.menuItemList=this._mapData();if(isEmptyOrNullObject(this.props.data)){this.props.telemetry.error('Navigatiomenu returned null');return null;}var defaultImageSettings={viewports:{xs:{q:\"w=224&h=300&m=6\",w:0,h:0},xl:{q:\"w=224&h=300&m=6\",w:0,h:0}},lazyload:true};var viewProps=_objectSpread(_objectSpread(_objectSpread({},this.props),this.state),{},{imageSettings:defaultImageSettings,gridSettings:this.props.context.request.gridSettings,Navigation:{moduleProps:this.props,className:classnames('ms-nav',this.props.config.className,this.state.isMobile?'mobile-vp':'desktop-vp'),tag:'nav',role:'navigation','aria-label':this.props.resources.menuAriaLabel},MenuList:{className:'ms-nav__list',tag:'ul',role:'menu'},ListItem:{className:'ms-nav__list__item',role:'presentation',tag:'li'},showCategoryImage:this.props.config.displayCategoryImage||false,Link:{tag:'a',className:'ms-nav__list__item__link',role:'menuitem'},DivContainer:{tag:'div',className:'ms-nav__feature',role:'menu'},ImageDivContainer:{tag:'div',className:'category-image',role:'menu'},Button:{className:'ms-nav__list__item__button',tag:'button',role:'menuitem',onClick:this.props},ImageContainer:{className:'ms-nav__list__item__image'},Span:{className:'ms-nav__list__item__span',tag:'span'},MobileDescriptionContainer:{className:'ms-nav__list__mobile__container'},MobileBackButton:{className:'ms-nav__list__mobile__container__button',tag:'button','aria-label':this.props.resources.backButtonAriaLabel,onClick:this.props},MobileDescriptionLabel:{className:'ms-nav__list__mobile__container__span',tag:'span'},isMobileView:this.state.isMobile,menuItemData:this.menuItemList,className:classnames('ms-nav',this.props.config.className)});return this.props.renderView(viewProps);}},{key:\"_mapData\",value:function _mapData(){var _this2=this;var _this$props=this.props,data=_this$props.data,config=_this$props.config;var mergedData=[];if(this.isRetail&&data&&data.categories&&data.categories.result&&data.categories.result.length>0){data.categories.result.map(function(item){return mergedData.push(_this2._constructMenuItemData(item,undefined,true));});}if(this.isCMS&&config.cmsNavItems&&config.cmsNavItems.length>0){config.cmsNavItems.map(function(item,idx){return mergedData.push(_this2._constructMenuItemData(undefined,item,false,idx+1));});}return mergedData;}},{key:\"_constructMenuItemData\",value:function _constructMenuItemData(retailItem,cmsItem,isRetail,idx){var locale=this.props.context&&this.props.context.request&&this.props.context.request.locale?this.props.context.request.locale:'en-us';var imageSouce=retailItem&&retailItem.Images&&retailItem.Images[0].Uri?retailItem.Images[0].Uri:'empty';if(isRetail){return{id:NavigationMenu.RSItemIdInit++,linkText:NavigationMenu.getFriendlyName(locale,retailItem&&retailItem.NameTranslations)||'',linkURL:retailItem&&retailItem.Url,imageSource:imageSouce,subMenu:this._getNestedChildren(retailItem,imageSouce)};}else{return{id:NavigationMenu.CMSItemIdInit++,linkText:cmsItem&&cmsItem.linkText||'',linkURL:cmsItem&&cmsItem.linkUrl&&cmsItem.linkUrl.destinationUrl||'',imageDestinationURL:cmsItem&&cmsItem.imageLink&&cmsItem.imageLink.destinationUrl||'',imageSource:cmsItem&&cmsItem.image&&cmsItem.image.src||'',subMenu:this._getCMSNestedChildren(cmsItem)};}}},{key:\"_getNestedChildren\",value:function _getNestedChildren(category,imageSourceUrl){var _this3=this;var nestedChildren=[];if(!category||!category.Children||!category.Children.length){return[];}nestedChildren.push({linkText:this.props.resources.allCategoryMenuText,imageSource:imageSourceUrl,linkURL:getCategoryUrl(category,this.props.context,{})});category.Children.map(function(item){nestedChildren.push(_this3._constructMenuItemData(item,undefined,true));});return nestedChildren;}},{key:\"_getCMSNestedChildren\",value:function _getCMSNestedChildren(category){var _this4=this;var nestedChildren=[];if(!category||!category.subMenus||!category.subMenus.length){return[];}category.subMenus.map(function(item,idx){nestedChildren.push(_this4._constructMenuItemData(undefined,item,false,idx));});return nestedChildren;}},{key:\"_updateViewport\",value:function _updateViewport(){this.viewport=this._getViewport();this.setState({isMobile:this.isMobile});}},{key:\"_getViewport\",value:function _getViewport(){var context=this.props.context;if(context.request&&context.request.device&&context.request.device.Type==='Mobile'){return'xs';}if((typeof window===\"undefined\"?\"undefined\":_typeof(window))!==undefined&&window.innerWidth){var gridSettings=context.request.gridSettings;if(gridSettings){if(gridSettings.xs&&window.innerWidth<=gridSettings.xs.w){return'xs';}else if(gridSettings.sm&&window.innerWidth<=gridSettings.sm.w){return'sm';}else if(gridSettings.md&&window.innerWidth<=gridSettings.md.w){return'md';}else if(gridSettings.lg&&window.innerWidth<=gridSettings.lg.w){return'lg';}else{return'xl';}}}return'xs';}},{key:\"isMobile\",get:function get(){return this.viewport==='xs'||this.viewport==='sm';}}],[{key:\"getFriendlyName\",value:function getFriendlyName(locale,nameTranslations){var nameTranslation;if(locale&&nameTranslations&&nameTranslations.length>0){nameTranslation=nameTranslations.find(function(item){return item.Language.toLowerCase()===locale.toLowerCase();});}return nameTranslation&&nameTranslation.Text;}}]);return NavigationMenu;}(React.PureComponent);NavigationMenu.CMSItemIdInit=1000;NavigationMenu.RSItemIdInit=5000;__decorate([observable],NavigationMenu.prototype,\"viewport\",void 0);__decorate([computed],NavigationMenu.prototype,\"isMobile\",null);export default NavigationMenu;","map":{"version":3,"sources":["modules/navigation-menu/navigation-menu.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getCategoryUrl } from '@msdyn365-commerce-modules/retail-actions';\nimport { addThrottledEvent, IModuleProps,  INodeProps } from '@msdyn365-commerce-modules/utilities';\nimport { CategoryHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { IActionContext, IGridSettings, IImageSettings, isEmptyOrNullObject} from '@msdyn365-commerce/core';\nimport { TextValueTranslation } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport { computed, observable } from 'mobx';\nimport * as React from 'react';\nimport { IMenuItemData, INavigationMenuData } from './navigation-menu.data';\nimport { ICmsNavItemsData, INavigationMenuProps, ISubMenusData, navigationMenuSource } from './navigation-menu.props.autogenerated';\n\nexport interface  INavigationMenuViewProps extends INavigationMenuProps<INavigationMenuData> {\n    className: string;\n    menuItemData: IMenuItemData[];\n    Navigation: IModuleProps;\n    MenuList: INodeProps;\n    ListItem: INodeProps;\n    Link: INodeProps;\n    Button: INodeProps;\n    Span: INodeProps;\n    ImageContainer:INodeProps;\n    MobileDescriptionContainer:INodeProps;\n    MobileBackButton:INodeProps;\n    MobileDescriptionLabel:INodeProps;\n    imageSettings: IImageSettings;\n    gridSettings: IGridSettings;\n    isMobileView: boolean;\n    DivContainer?:INodeProps;\n    ImageDivContainer?:INodeProps;\n    showCategoryImage?:boolean;\n}\n\nexport type GridSize = 'xs' | 'sm' | 'md' | 'lg' | 'xl';\n\nexport interface INavigationMenuState {\n    isMobile: boolean;\n}\n\n/**\n *\n * NavigationMenu component\n * @extends {React.PureComponent<INavigationMenuProps<INavigationMenuData>>}\n */\nclass NavigationMenu extends React.PureComponent<INavigationMenuProps<INavigationMenuData>, INavigationMenuState> {\n    private static CMSItemIdInit: number = 1000;\n    private static RSItemIdInit: number = 5000;\n    private resizeThrottledEventHandler?: (event: Event) => void;\n    private menuItemList: IMenuItemData[];\n    private isRetail: boolean = true;\n    private isCMS: boolean = true;\n    @observable\n    private viewport: GridSize;\n    public static getFriendlyName(locale: string, nameTranslations?: TextValueTranslation[]): string | undefined {\n        let nameTranslation: TextValueTranslation | undefined;\n        if (locale && nameTranslations && nameTranslations.length > 0) {\n            nameTranslation = nameTranslations.find(item => item.Language!.toLowerCase() === locale.toLowerCase());\n        }\n\n        return nameTranslation && nameTranslation.Text;\n    }\n\n    constructor(props: INavigationMenuProps<INavigationMenuData>) {\n        super(props);\n        this._updateViewport = this._updateViewport.bind(this);\n        this.viewport = props.context.request && props.context.request.device && props.context.request.device.Type === 'Mobile' ? 'xs' : 'lg';\n        this._setNavigationSource(this.props.config && this.props.config.navigationMenuSource);\n        this.state = {isMobile: this.isMobile};\n        this.menuItemList = [];\n    }\n\n    @computed get isMobile(): boolean {\n        return (this.viewport === 'xs' || this.viewport === 'sm');\n    }\n\n    public componentDidMount(): void {\n        this.resizeThrottledEventHandler =\n        window && addThrottledEvent(window, 'resize', this._updateViewport as EventListener);\n        this._updateViewport();\n    }\n\n    public componentWillUnmount(): void {\n        window && window.removeEventListener('resize', this.resizeThrottledEventHandler!, false);\n    }\n\n    public render(): JSX.Element | null {\n        this.menuItemList =  this._mapData();\n        if (isEmptyOrNullObject(this.props.data)) {\n            this.props.telemetry.error('Navigatiomenu returned null');\n            return null;\n        }\n\n        const defaultImageSettings: IImageSettings = {\n            viewports: {\n                xs: { q: `w=224&h=300&m=6`, w: 0, h: 0 },\n                xl: { q: `w=224&h=300&m=6`, w: 0, h: 0 }\n            },\n            lazyload: true\n        };\n\n        const viewProps = {\n            ...this.props,\n            ...this.state,\n            imageSettings: defaultImageSettings,\n            gridSettings: this.props.context.request.gridSettings,\n            Navigation: {\n                moduleProps: this.props,\n                className: classnames('ms-nav', this.props.config.className, this.state.isMobile ? 'mobile-vp' : 'desktop-vp'),\n                tag:'nav',\n                role:'navigation',\n                'aria-label': this.props.resources.menuAriaLabel\n            },\n            MenuList: {\n                className: 'ms-nav__list',\n                tag:'ul',\n                role: 'menu'\n            },\n            ListItem: {\n                className: 'ms-nav__list__item',\n                role: 'presentation',\n                tag:'li'\n            },\n            showCategoryImage:this.props.config.displayCategoryImage||false,\n            Link: {\n                tag: 'a',\n                className: 'ms-nav__list__item__link',\n                role: 'menuitem'\n            },\n            DivContainer:\n            {\n                tag: 'div',\n                className:'ms-nav__feature',\n                role:'menu'\n            },\n            ImageDivContainer:\n            {\n                tag:'div',\n                className:'category-image',\n                role:'menu'\n            },\n            Button: {\n                className: 'ms-nav__list__item__button',\n                tag:'button',\n                role:'menuitem',\n                onClick:this.props\n            },\n            ImageContainer: {\n                className: 'ms-nav__list__item__image'\n            },\n            Span: {\n                className: 'ms-nav__list__item__span',\n                tag:'span'\n            },\n            MobileDescriptionContainer: {\n                className: 'ms-nav__list__mobile__container'\n            },\n            MobileBackButton: {\n                className: 'ms-nav__list__mobile__container__button',\n                tag:'button',\n                'aria-label': this.props.resources.backButtonAriaLabel,\n                onClick:this.props\n            },\n            MobileDescriptionLabel: {\n                className: 'ms-nav__list__mobile__container__span',\n                tag:'span'\n            },\n            isMobileView: this.state.isMobile,\n            menuItemData: this.menuItemList,\n            className: classnames('ms-nav', this.props.config.className)\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private _mapData(): IMenuItemData[] {\n        const { data, config } = this.props;\n        const mergedData: IMenuItemData[] = [];\n        if (this.isRetail && data && data.categories && data.categories.result && data.categories.result.length > 0) {\n            data.categories.result.map((item: CategoryHierarchy) => (\n                mergedData.push(this._constructMenuItemData(item, undefined, true))\n            ));\n        }\n\n        if (this.isCMS && config.cmsNavItems &&  config.cmsNavItems.length > 0) {\n            config.cmsNavItems.map((item: ICmsNavItemsData, idx: number) => (\n                mergedData.push(this._constructMenuItemData(undefined, item, false, idx+1))\n            ));\n        }\n        return mergedData;\n    }\n\n    // tslint:disable-next-line: cyclomatic-complexity\n    private _constructMenuItemData(retailItem?: CategoryHierarchy, cmsItem?: ICmsNavItemsData, isRetail?: boolean, idx?: number): IMenuItemData {\n        const locale = this.props.context && this.props.context.request && this.props.context.request.locale ? this.props.context.request.locale : 'en-us';\n        const imageSouce  = retailItem && retailItem.Images && retailItem.Images[0].Uri ? retailItem.Images[0].Uri: 'empty';\n        if (isRetail) {\n            return {\n                id: NavigationMenu.RSItemIdInit++,\n                linkText: NavigationMenu.getFriendlyName(locale, retailItem && retailItem.NameTranslations) || '',\n                linkURL: retailItem && retailItem.Url,\n                imageSource: imageSouce,\n                subMenu: this._getNestedChildren(retailItem,imageSouce)\n            } as IMenuItemData;\n        } else {\n            return {\n                id: NavigationMenu.CMSItemIdInit++,\n                linkText: cmsItem && cmsItem.linkText || '',\n                linkURL: cmsItem && cmsItem.linkUrl && cmsItem.linkUrl.destinationUrl || '',\n                imageDestinationURL: cmsItem && cmsItem.imageLink && cmsItem.imageLink.destinationUrl || '',\n                imageSource: cmsItem && cmsItem.image && cmsItem.image.src || '',\n                subMenu: this._getCMSNestedChildren(cmsItem)\n            } as IMenuItemData;\n        }\n    }\n\n    private _getNestedChildren(category?: CategoryHierarchy,imageSourceUrl?:string): IMenuItemData[] {\n        const nestedChildren: IMenuItemData[] = [];\n        if (!category || !category.Children || !category.Children.length) {\n            return [];\n        }\n        nestedChildren.push({linkText: this.props.resources.allCategoryMenuText,imageSource:imageSourceUrl,linkURL: getCategoryUrl(category, this.props.context as unknown as IActionContext, {}) });\n        category.Children.map((item: CategoryHierarchy) => {\n            nestedChildren.push(this._constructMenuItemData(item, undefined, true));\n        });\n        return nestedChildren;\n    }\n\n    private _getCMSNestedChildren(category?: ICmsNavItemsData): IMenuItemData[] {\n        const nestedChildren: IMenuItemData[] = [];\n\n        if (!category || !category.subMenus || !category.subMenus.length) {\n            return [];\n        }\n\n        category.subMenus.map((item: ISubMenusData, idx: number) => {\n            nestedChildren.push(this._constructMenuItemData(undefined, item, false, idx));\n        });\n        return nestedChildren;\n    }\n\n    private _setNavigationSource = (sourceType?: navigationMenuSource): void => {\n        switch(sourceType) {\n            case navigationMenuSource.retailServerOnly:\n                this.isRetail = true;\n                this.isCMS = false;\n                break;\n            case navigationMenuSource.cmsOnly:\n                this.isRetail = false;\n                this.isCMS = true;\n                break;\n            case navigationMenuSource.all:\n                this.isRetail = true;\n                this.isCMS = true;\n                break;\n            default:\n        }\n    }\n\n    private _updateViewport(): void {\n        this.viewport = this._getViewport();\n        this.setState({ isMobile: this.isMobile });\n    }\n\n    private _getViewport(): GridSize {\n        const { context } = this.props;\n\n        // always render in mobile viewport on a mobile device\n        if (context.request && context.request.device && context.request.device.Type === 'Mobile') {\n            return 'xs';\n        }\n\n        if (typeof window !== undefined && window.innerWidth) {\n            const gridSettings = context.request.gridSettings;\n            if (gridSettings) {\n                if (gridSettings.xs && window.innerWidth <= gridSettings.xs.w) {\n                    return 'xs';\n                } else if (gridSettings.sm && window.innerWidth <= gridSettings.sm.w) {\n                    return 'sm';\n                } else if (gridSettings.md && window.innerWidth <= gridSettings.md.w) {\n                    return 'md';\n                } else if (gridSettings.lg && window.innerWidth <= gridSettings.lg.w) {\n                    return 'lg';\n                } else {\n                    return 'xl';\n                }\n            }\n        }\n\n        return 'xs';\n    }\n}\n\nexport default NavigationMenu;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}