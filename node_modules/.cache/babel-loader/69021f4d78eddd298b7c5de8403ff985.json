{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import classname from'classnames';import{action,computed,observable,reaction,when}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{withModuleState}from'@msdyn365-commerce-modules/checkout-utilities';import{Button,getTelemetryObject}from'@msdyn365-commerce-modules/utilities';import*as MsDyn365 from'@msdyn365-commerce/core';import CheckboxComponent from'./components/checkout-terms-and-conditions.check-box';import ErrorMessageComponent from'./components/checkout-terms-and-conditions.error-message';import ErrorTitleComponent from'./components/checkout-terms-and-conditions.error-title';var CheckoutTermsAndConditions=/*#__PURE__*/function(_React$Component){_inherits(CheckoutTermsAndConditions,_React$Component);var _super=_createSuper(CheckoutTermsAndConditions);function CheckoutTermsAndConditions(props){var _this;_classCallCheck(this,CheckoutTermsAndConditions);_this=_super.call(this,props);_this.isTermsAccepted=true;_this.getTermsAndConditions=function(){var _this$props=_this.props,isReady=_this$props.moduleState.isReady,_this$props$config=_this$props.config,showCheckbox=_this$props$config.showCheckbox,description=_this$props$config.description;var isDisabled=isReady&&!_this.isAutoSave;var isTermsAndConditionAccepted=_this.isTermsAccepted;return{termsAndConditionAcceptance:{className:'ms-checkout-terms-and-conditions__container'},checkBox:showCheckbox&&/*#__PURE__*/React.createElement(CheckboxComponent,Object.assign({},{isChecked:isTermsAndConditionAccepted,disabled:isDisabled,onChange:_this.onChange,id:_this.props.id,telemetryContent:_this.telemetryContent})),description:/*#__PURE__*/React.createElement(MsDyn365.RichTextComponent,{text:description})};};_this.init=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _data$checkout$result;var _this$props2,data,showCheckbox;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props2=_this.props,data=_this$props2.data,showCheckbox=_this$props2.config.showCheckbox;if(!((_data$checkout$result=data.checkout.result)!==null&&_data$checkout$result!==void 0&&_data$checkout$result.isTermsAndConditionAccepted||!showCheckbox)){_context.next=7;break;}_context.next=4;return _this.updateTermsAndConditionsAcceptance(true);case 4:_this.isTermsAccepted=true;_context.next=11;break;case 7:if(!showCheckbox){_context.next=11;break;}_context.next=10;return _this.updateTermsAndConditionsAcceptance(false);case 10:_this.isTermsAccepted=false;case 11:_this.props.moduleState.init({onEdit:_this.onEdit,onCancel:_this.onCancel,onSubmit:_this.onSubmit,status:_this.isTermsAccepted?'ready':'updating'});case 12:case\"end\":return _context.stop();}}},_callee);}));_this.getErrorMessage=function(){var errorMessageTitle=_this.props.resources.errorMessageTitle;return{error:{tag:'div',className:'ms-checkout-terms-and-conditions__error',role:'alert','aria-live':'assertive'},title:/*#__PURE__*/React.createElement(ErrorTitleComponent,Object.assign({},{title:errorMessageTitle})),message:/*#__PURE__*/React.createElement(ErrorMessageComponent,Object.assign({},{message:_this.errorMessage}))};};_this.getCancelButton=function(){var _this$props$resources=_this.props.resources,_this$props$resources2=_this$props$resources.cancelBtnLabel,cancelBtnLabel=_this$props$resources2===void 0?'Cancel':_this$props$resources2,cancelBtnAriaLabel=_this$props$resources.cancelBtnAriaLabel;return/*#__PURE__*/React.createElement(Button,{className:'ms-checkout-terms-and-conditions__button-cancel',title:cancelBtnLabel,\"aria-label\":cancelBtnAriaLabel,color:'secondary',onClick:_this.onCancel},cancelBtnLabel);};_this.getSaveButton=function(){var _this$props$resources3=_this.props.resources,_this$props$resources4=_this$props$resources3.saveBtnLabel,saveBtnLabel=_this$props$resources4===void 0?'Save':_this$props$resources4,saveBtnAriaLabel=_this$props$resources3.saveBtnAriaLabel;return/*#__PURE__*/React.createElement(Button,{className:'ms-checkout-terms-and-conditions__button-save',title:saveBtnLabel,\"aria-label\":saveBtnAriaLabel,color:'primary',onClick:_this.onSubmit},saveBtnLabel);};_this.getEditButton=function(){var _this$props$resources5=_this.props.resources,_this$props$resources6=_this$props$resources5.editBtnLabel,editBtnLabel=_this$props$resources6===void 0?'Change':_this$props$resources6,editBtnAriaLabel=_this$props$resources5.editBtnAriaLabel;return/*#__PURE__*/React.createElement(Button,{className:'ms-checkout-terms-and-conditions__button-edit',title:editBtnLabel,\"aria-label\":editBtnAriaLabel,color:'primary',onClick:_this.onEdit},editBtnLabel);};_this.onEdit=function(){_this.onUpdating();};_this.onSubmit=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(_this.isTermsAccepted){_context2.next=10;break;}if(!_this.isAutoSave){_context2.next=6;break;}_context2.next=4;return _this.updateTermsAndConditionsAcceptance(_this.isTermsAccepted);case 4:_context2.next=8;break;case 6:_this.setError(_this.props.resources.errorMessage);_this.props.moduleState.setHasError(true);case 8:_context2.next=14;break;case 10:_this.clearError();_context2.next=13;return _this.updateTermsAndConditionsAcceptance(_this.isTermsAccepted);case 13:_this.props.moduleState.onReady();case 14:case\"end\":return _context2.stop();}}},_callee2);}));_this.onUpdating=function(){_this.props.moduleState.onUpdating();};_this.setError=function(errorMessage){_this.props.telemetry.error(errorMessage);_this.props.moduleState.setHasError(true);_this.props.moduleState.onUpdating();_this.errorMessage=errorMessage;};_this.onCancel=function(){if(!_this.props.data.checkout.result){return;}var isTermsAccepted=_this.props.data.checkout.result.isTermsAndConditionAccepted;if(!isTermsAccepted){_this.props.moduleState.onUpdating();return;}else{_this.isTermsAccepted=true;_this.props.moduleState.setHasError(false);_this.props.moduleState.onReady();}};_this.updateTermsAndConditionsAcceptance=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(isTermsAccepted){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!_this.props.data.checkout.result){_context3.next=3;break;}_context3.next=3;return _this.props.data.checkout.result.updateTermsAndConditionsAcceptance({newIsTermsAndConditionAccepted:isTermsAccepted});case 3:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref3.apply(this,arguments);};}();_this.clearError=function(){_this.props.moduleState.setHasError(false);_this.errorMessage=undefined;};_this.onChange=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event){var checked;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:checked=event.target.checked;_this.isTermsAccepted=checked;if(!_this.isAutoSave){_context4.next=5;break;}_context4.next=5;return _this.onSubmit();case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x2){return _ref4.apply(this,arguments);};}();_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);return _this;}_createClass(CheckoutTermsAndConditions,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var _this2=this;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:when(function(){return _this2.isDataReady;},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _this2.init();case 2:case\"end\":return _context5.stop();}}},_callee5);})));reaction(function(){return _this2.props.data.checkout.result&&_this2.props.data.checkout.result.isTermsAndConditionAccepted;},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _this2$props$data$che;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_this2.isTermsAccepted=((_this2$props$data$che=_this2.props.data.checkout.result)===null||_this2$props$data$che===void 0?void 0:_this2$props$data$che.isTermsAndConditionAccepted)||_this2.defaultTermsAndConditionAcceptedValue;case 1:case\"end\":return _context6.stop();}}},_callee6);})));case 2:case\"end\":return _context7.stop();}}},_callee7);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this$props$data$chec;var _this$props3=this.props,_this$props3$moduleSt=_this$props3.moduleState,isReady=_this$props3$moduleSt.isReady,hasError=_this$props3$moduleSt.hasError,className=_this$props3.config.className;var isTermsAndConditionAccepted=(_this$props$data$chec=this.props.data.checkout.result)===null||_this$props$data$chec===void 0?void 0:_this$props$data$chec.isTermsAndConditionAccepted;var isError=hasError;var isShowContent=!isReady;var isShowSelected=!hasError&&isReady;var viewProps=_objectSpread(_objectSpread(_objectSpread({},this.props),this.state),{},{isTermsAccepted:this.isTermsAccepted,errorMessageData:this.errorMessage,viewState:{isError:isError,isShowSaveButton:isShowContent&&this.isShowButtons,isShowEditButton:isShowSelected&&this.isShowButtons,isShowCancelButton:isShowContent&&this.isShowButtons&&isTermsAndConditionAccepted},checkoutTermsAndConditions:{moduleProps:this.props,className:classname('ms-checkout-terms-and-conditions',className)},termsAndConditionsContent:this.getTermsAndConditions(),errorMessage:this.getErrorMessage(),saveButton:this.getSaveButton(),editButton:this.getEditButton(),cancelButton:this.getCancelButton(),onSave:this.onSubmit,onEdit:this.onEdit,onCancel:this.onCancel,onChange:this.onChange});return this.props.renderView(viewProps);}},{key:\"isDataReady\",get:function get(){return(this.props.data.checkout.result&&this.props.data.checkout.status)==='SUCCESS';}},{key:\"isShowButtons\",get:function get(){var showControlButtons=this.props.config.showControlButtons;return!this.props.moduleState.hasExternalSubmitGroup&&(showControlButtons||false);}},{key:\"isAutoSave\",get:function get(){var showControlButtons=this.props.config.showControlButtons;return!this.props.moduleState.hasExternalSubmitGroup&&!showControlButtons;}},{key:\"defaultTermsAndConditionAcceptedValue\",get:function get(){var showCheckbox=this.props.config.showCheckbox;return showCheckbox?false:true;}}]);return CheckoutTermsAndConditions;}(React.Component);__decorate([observable],CheckoutTermsAndConditions.prototype,\"isTermsAccepted\",void 0);__decorate([observable],CheckoutTermsAndConditions.prototype,\"errorMessage\",void 0);__decorate([computed],CheckoutTermsAndConditions.prototype,\"isDataReady\",null);__decorate([computed],CheckoutTermsAndConditions.prototype,\"isShowButtons\",null);__decorate([computed],CheckoutTermsAndConditions.prototype,\"isAutoSave\",null);__decorate([computed],CheckoutTermsAndConditions.prototype,\"defaultTermsAndConditionAcceptedValue\",null);__decorate([action],CheckoutTermsAndConditions.prototype,\"init\",void 0);CheckoutTermsAndConditions=__decorate([withModuleState,observer],CheckoutTermsAndConditions);export default CheckoutTermsAndConditions;","map":{"version":3,"sources":["modules/checkout-terms-and-conditions/checkout-terms-and-conditions.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classname from 'classnames';\nimport { action, computed, observable, reaction, when } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport { IModuleStateProps, withModuleState } from '@msdyn365-commerce-modules/checkout-utilities';\nimport { Button, getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport * as MsDyn365 from '@msdyn365-commerce/core';\n\nimport { ICheckoutTermsAndConditionsData } from './checkout-terms-and-conditions.data';\nimport {\n    ICheckoutTermsAndConditionsProps\n} from './checkout-terms-and-conditions.props.autogenerated';\nimport CheckboxComponent from './components/checkout-terms-and-conditions.check-box';\nimport ErrorMessageComponent from './components/checkout-terms-and-conditions.error-message';\nimport ErrorTitleComponent from './components/checkout-terms-and-conditions.error-title';\n\nexport interface ICheckoutTermsAndConditionsModuleProps extends ICheckoutTermsAndConditionsProps<ICheckoutTermsAndConditionsData>, IModuleStateProps { }\n\nexport interface ICheckoutTermsAndConditions {\n    termsAndConditionAcceptance: INodeProps;\n    checkBox: React.ReactNode;\n    description: React.ReactNode;\n}\n\nexport interface ICheckoutTermsAndConditionsError {\n    error: INodeProps;\n    title: React.ReactNode;\n    message: React.ReactNode;\n}\n\nexport interface ICheckoutTermsAndConditionsViewState {\n    isError: boolean;\n    isShowSaveButton: boolean;\n    isShowEditButton: boolean;\n    isShowCancelButton: boolean;\n}\n\nexport interface ICheckoutTermsAndConditionsViewProps extends ICheckoutTermsAndConditionsProps<{}> {\n    checkoutTermsAndConditions: IModuleProps;\n    isTermsAccepted: boolean;\n    errorMessageData: string;\n    viewState: ICheckoutTermsAndConditionsViewState;\n    termsAndConditionsContent: ICheckoutTermsAndConditions;\n    errorMessage?: ICheckoutTermsAndConditionsError;\n    saveButton?: React.ReactNode;\n    editButton?: React.ReactNode;\n    cancelButton?: React.ReactNode;\n    onChange(event: React.ChangeEvent<HTMLInputElement>): void;\n    onSave(): void;\n    onEdit(): void;\n    onCancel(): void;\n}\n\n/**\n *\n * CheckoutTermsAndConditions component\n * @extends {React.Component<ICheckoutTermsAndConditionsProps<ICheckoutTermsAndConditionsData>>}\n */\n// @ts-ignore\n@withModuleState\n@observer\nclass CheckoutTermsAndConditions extends React.Component<ICheckoutTermsAndConditionsModuleProps> {\n    private telemetryContent: ITelemetryContent;\n    @observable private isTermsAccepted: boolean = true;\n    @observable private errorMessage?: string;\n\n    constructor(props: ICheckoutTermsAndConditionsModuleProps) {\n        super(props);\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    @computed get isDataReady(): boolean {\n        return (this.props.data.checkout.result && this.props.data.checkout.status) === 'SUCCESS';\n    }\n\n    @computed get isShowButtons(): boolean {\n        const { showControlButtons } = this.props.config;\n        return !this.props.moduleState.hasExternalSubmitGroup && (showControlButtons || false);\n    }\n\n    @computed get isAutoSave(): boolean {\n        const { showControlButtons } = this.props.config;\n        return !this.props.moduleState.hasExternalSubmitGroup && !showControlButtons;\n    }\n\n    @computed get defaultTermsAndConditionAcceptedValue(): boolean {\n        const { showCheckbox } = this.props.config;\n        return showCheckbox ? false : true;\n    }\n\n    public async componentDidMount(): Promise<void> {\n        // @ts-ignore: Compiler not reconizing condition check for function params\n        when(\n            () => this.isDataReady,\n            async () => {\n                await this.init();\n            }\n        );\n\n        reaction(\n            () => this.props.data.checkout.result && this.props.data.checkout.result.isTermsAndConditionAccepted,\n            async () => {\n                this.isTermsAccepted = this.props.data.checkout.result?.isTermsAndConditionAccepted || this.defaultTermsAndConditionAcceptedValue;\n            }\n        );\n    }\n\n    public render(): JSX.Element | null {\n        const {\n            moduleState: { isReady, hasError },\n            config: { className }\n        } = this.props;\n        const isTermsAndConditionAccepted = this.props.data.checkout.result?.isTermsAndConditionAccepted;\n        const isError = hasError;\n        const isShowContent = !isReady;\n        const isShowSelected = !hasError && isReady;\n\n        const viewProps = {\n            ...this.props,\n            ...this.state,\n            isTermsAccepted: this.isTermsAccepted,\n            errorMessageData: this.errorMessage,\n            viewState: {\n                isError: isError,\n                isShowSaveButton: isShowContent && this.isShowButtons,\n                isShowEditButton: isShowSelected && this.isShowButtons,\n                isShowCancelButton: isShowContent && this.isShowButtons && isTermsAndConditionAccepted,\n            },\n            checkoutTermsAndConditions: {\n                moduleProps: this.props,\n                className: classname('ms-checkout-terms-and-conditions', className)\n            },\n            termsAndConditionsContent: this.getTermsAndConditions(),\n            errorMessage: this.getErrorMessage(),\n            saveButton: this.getSaveButton(),\n            editButton: this.getEditButton(),\n            cancelButton: this.getCancelButton(),\n            onSave: this.onSubmit,\n            onEdit: this.onEdit,\n            onCancel: this.onCancel,\n            onChange: this.onChange\n        };\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private getTermsAndConditions = (): ICheckoutTermsAndConditions => {\n        const {\n            moduleState: { isReady },\n            config: { showCheckbox, description }\n        } = this.props;\n        const isDisabled = isReady && !this.isAutoSave;\n        const isTermsAndConditionAccepted = this.isTermsAccepted;\n\n        return {\n            termsAndConditionAcceptance: { className: 'ms-checkout-terms-and-conditions__container' },\n            checkBox: showCheckbox && <CheckboxComponent {...{ isChecked: isTermsAndConditionAccepted, disabled: isDisabled, onChange: this.onChange, id: this.props.id, telemetryContent: this.telemetryContent }} />,\n            description: <MsDyn365.RichTextComponent text={description} />\n        };\n    }\n\n    @action\n    private init = async (): Promise<void> => {\n        const {\n            data,\n            config: { showCheckbox }\n        } = this.props;\n\n        if (data.checkout.result?.isTermsAndConditionAccepted || !showCheckbox) {\n            await this.updateTermsAndConditionsAcceptance(true);\n            this.isTermsAccepted = true;\n        } else if (showCheckbox) {\n            await this.updateTermsAndConditionsAcceptance(false);\n            this.isTermsAccepted = false;\n        }\n\n        this.props.moduleState.init({\n            onEdit: this.onEdit,\n            onCancel: this.onCancel,\n            onSubmit: this.onSubmit,\n            status: this.isTermsAccepted ? 'ready' : 'updating'\n        });\n    };\n\n    private getErrorMessage = (): ICheckoutTermsAndConditionsError => {\n        const { errorMessageTitle } = this.props.resources;\n        return {\n            error: { tag: 'div', className: 'ms-checkout-terms-and-conditions__error', role: 'alert', 'aria-live': 'assertive' },\n            title: <ErrorTitleComponent {...{ title: errorMessageTitle }} />,\n            message: <ErrorMessageComponent {...{ message: this.errorMessage }} />\n        };\n    };\n\n    private getCancelButton = (): React.ReactNode => {\n        const { cancelBtnLabel = 'Cancel', cancelBtnAriaLabel } = this.props.resources;\n        return (\n            <Button\n                className='ms-checkout-terms-and-conditions__button-cancel'\n                title={cancelBtnLabel}\n                aria-label={cancelBtnAriaLabel}\n                color='secondary'\n                onClick={this.onCancel}\n            >\n                {cancelBtnLabel}\n            </Button>\n        );\n    };\n\n    private getSaveButton = (): React.ReactNode => {\n        const { saveBtnLabel = 'Save', saveBtnAriaLabel } = this.props.resources;\n        return (\n            <Button\n                className='ms-checkout-terms-and-conditions__button-save'\n                title={saveBtnLabel}\n                aria-label={saveBtnAriaLabel}\n                color='primary'\n                onClick={this.onSubmit}\n            >\n                {saveBtnLabel}\n            </Button>\n        );\n    };\n\n    private getEditButton = (): React.ReactNode => {\n        const { editBtnLabel = 'Change', editBtnAriaLabel } = this.props.resources;\n        return (\n            <Button\n                className='ms-checkout-terms-and-conditions__button-edit'\n                title={editBtnLabel}\n                aria-label={editBtnAriaLabel}\n                color='primary'\n                onClick={this.onEdit}\n            >\n                {editBtnLabel}\n            </Button>\n        );\n    };\n\n    private onEdit = (): void => {\n        this.onUpdating();\n    };\n\n    private onSubmit = async (): Promise<void> => {\n        if (!this.isTermsAccepted) {\n            if (this.isAutoSave) {\n                await this.updateTermsAndConditionsAcceptance(this.isTermsAccepted);\n            } else {\n                this.setError(this.props.resources.errorMessage);\n                this.props.moduleState.setHasError(true);\n            }\n        } else {\n            this.clearError();\n            await this.updateTermsAndConditionsAcceptance(this.isTermsAccepted);\n            this.props.moduleState.onReady();\n        }\n    };\n\n    private onUpdating = () => {\n        this.props.moduleState.onUpdating();\n    };\n\n    private setError = (errorMessage: string): void => {\n        this.props.telemetry.error(errorMessage);\n        this.props.moduleState.setHasError(true);\n        this.props.moduleState.onUpdating();\n        this.errorMessage = errorMessage;\n    };\n\n    private onCancel = (): void => {\n        // Reset to the saved value\n        if (!this.props.data.checkout.result) {\n            return;\n        }\n\n        const isTermsAccepted = this.props.data.checkout.result.isTermsAndConditionAccepted;\n        if (!isTermsAccepted) {\n            // It has no saved email, set to status updating and request user to fill the email form\n            this.props.moduleState.onUpdating();\n            return;\n        } else {\n            // It has saved email, set to status ready\n            this.isTermsAccepted = true;\n            this.props.moduleState.setHasError(false);\n            this.props.moduleState.onReady();\n        }\n    };\n\n    private updateTermsAndConditionsAcceptance = async (isTermsAccepted: boolean): Promise<void> => {\n        if (this.props.data.checkout.result) {\n            await this.props.data.checkout.result.updateTermsAndConditionsAcceptance({ newIsTermsAndConditionAccepted: isTermsAccepted });\n        }\n    };\n\n    private clearError = (): void => {\n        this.props.moduleState.setHasError(false);\n        this.errorMessage = undefined;\n    };\n\n    private onChange = async (event: React.ChangeEvent<HTMLInputElement>) => {\n        const checked = event.target.checked;\n        this.isTermsAccepted = checked;\n        if (this.isAutoSave) {\n            await this.onSubmit();\n        }\n    };\n\n}\n\nexport default CheckoutTermsAndConditions;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}