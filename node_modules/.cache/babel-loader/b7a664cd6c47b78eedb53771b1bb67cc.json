{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{getDimensionsForSelectedVariant,GetDimensionsForSelectedVariantInput,getFallbackImageUrl,getPriceForSelectedVariant,getProductAvailabilitiesForSelectedVariant,getSelectedVariant,PriceForSelectedVariantInput,ProductAvailabilitiesForSelectedVariantInput,SelectedVariantInput}from'@msdyn365-commerce-modules/retail-actions';import{Button}from'@msdyn365-commerce-modules/utilities';import{Image}from'@msdyn365-commerce/core';import classnames from'classnames';import React from'react';import{Dropdown}from'.';import OrderTemplateQuantity from'../common/order-template-quantity';export var ProductConfiguration=/*#__PURE__*/function(_React$Component){_inherits(ProductConfiguration,_React$Component);var _super=_createSuper(ProductConfiguration);function ProductConfiguration(props){var _this;_classCallCheck(this,ProductConfiguration);_this=_super.call(this,props);_this._addToTemplateHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this.setState({isBusy:true,showAddConfirmation:false,showAddError:false});_this.props.addToTemplateHandler(_objectSpread({},_this.state)).then(function(status){if(status.ProductListId){_this.setState({isBusy:false,showAddConfirmation:true});}})[\"catch\"](function(error){_this.setState({isBusy:false,showAddError:true});_this.props.context.telemetry.error('Error adding item to order template');});case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this._onQuantityChange=function(newValue){_this.setState({quantity:newValue,totalPrice:newValue*_this.props.product.Price});};_this._onDimensionChanged=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(selection){var _this$props,product,dimensions,context,actionContext,channelId,mappedDimensions,variantProduct,dimensionInput,variantDimensions,availabilityInput,newAvailableQuantity,priceInput,productPrice;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.setState({isBusy:false,showAddConfirmation:false,showAddError:false,buttonDisabled:true});_this$props=_this.props,product=_this$props.product,dimensions=_this$props.dimensions,context=_this$props.context;actionContext=context.actionContext,channelId=context.request.apiSettings.channelId;mappedDimensions=dimensions===null||dimensions===void 0?void 0:dimensions.map(function(dimension){var _dimension$DimensionV;return{DimensionTypeValue:dimension.DimensionTypeValue,DimensionValue:(_dimension$DimensionV=dimension.DimensionValues)===null||_dimension$DimensionV===void 0?void 0:_dimension$DimensionV.find(function(value){return value.RecordId===+selection.selectId;}),ExtensionProperties:dimension.ExtensionProperties};}).filter(function(dimension){return dimension&&dimension.DimensionValue;});mappedDimensions.forEach(function(dimension){_this.state.selectedDimensions[dimension.DimensionTypeValue]=dimension.DimensionValue;});_context2.next=7;return getSelectedVariant(new SelectedVariantInput(product.MasterProductId?product.MasterProductId:product.RecordId,channelId,mappedDimensions),actionContext);case 7:variantProduct=_context2.sent;if(variantProduct){_context2.next=11;break;}_this.props.context.telemetry.error(\"Error retrieving variant product for product \".concat(product.MasterProductId?product.MasterProductId:product.RecordId));return _context2.abrupt(\"return\");case 11:dimensionInput=new GetDimensionsForSelectedVariantInput(variantProduct.RecordId,channelId,mappedDimensions);_context2.next=14;return getDimensionsForSelectedVariant(dimensionInput,actionContext);case 14:variantDimensions=_context2.sent;if(variantDimensions){_context2.next=19;break;}_this.props.context.telemetry.error('Error retrieving dimensions for reconfigured product variant');_this.setState({buttonDisabled:false});return _context2.abrupt(\"return\");case 19:availabilityInput=new ProductAvailabilitiesForSelectedVariantInput(product.MasterProductId?product.MasterProductId:product.RecordId,channelId);_context2.next=22;return getProductAvailabilitiesForSelectedVariant(availabilityInput,actionContext);case 22:newAvailableQuantity=_context2.sent;priceInput=new PriceForSelectedVariantInput(product.RecordId,channelId);_context2.next=26;return getPriceForSelectedVariant(priceInput,actionContext);case 26:productPrice=_context2.sent;if(productPrice){_context2.next=31;break;}_this.props.context.telemetry.error('Error retrieving price for reconfigured product variant');_this.setState({buttonDisabled:false});return _context2.abrupt(\"return\");case 31:_this.setState({buttonDisabled:false,productAvailableQuantity:newAvailableQuantity&&newAvailableQuantity[0]||undefined,unitPrice:+(productPrice.BasePrice||product.Price),dimensions:variantDimensions,product:variantProduct});case 32:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this._getDropdownName=function(dimensionType,resources){switch(dimensionType){case 1:return resources.productDimensionTypeColor;case 2:return resources.productDimensionTypeConfiguration;case 3:return resources.productDimensionTypeSize;case 4:return resources.productDimensionTypeStyle;default:return'';}};_this.state={quantity:1,unitPrice:props.product.Price,totalPrice:props.product.Price,product:props.product,dimensions:props.dimensions,selectedDimensions:{},buttonDisabled:false,showAddConfirmation:false,showAddError:false};_this.selectedDimensions=props.dimensions.reduce(function(result,d){result[\"\".concat(d.DimensionTypeValue)]=d.DimensionValues[0].Value;return result;},{});return _this;}_createClass(ProductConfiguration,[{key:\"render\",value:function render(){var _this$props2=this.props,_this$props2$context=_this$props2.context,apiSettings=_this$props2$context.actionContext.requestContext.apiSettings,gridSettings=_this$props2$context.request.gridSettings,_this$props2$resource=_this$props2.resources,addItemToTemplateText=_this$props2$resource.addItemToTemplateText,addLineProductUnitPricePrefix=_this$props2$resource.addLineProductUnitPricePrefix,decrementButtonAriaLabel=_this$props2$resource.decrementButtonAriaLabel,incrementButtonAriaLabel=_this$props2$resource.incrementButtonAriaLabel,quantitySelectLabel=_this$props2$resource.quantitySelectLabel,addLineProductUnitOfMeasurePrefix=_this$props2$resource.addLineProductUnitOfMeasurePrefix,addToTemplateConfirmation=_this$props2$resource.addToTemplateConfirmation,addToTemplateError=_this$props2$resource.addToTemplateError,totalPriceLabel=_this$props2$resource.totalPriceLabel,imageSettings=_this$props2.imageSettings,highlightSearchTerm=_this$props2.highlightSearchTerm;var _this$state=this.state,buttonDisabled=_this$state.buttonDisabled,product=_this$state.product,quantity=_this$state.quantity,unitPrice=_this$state.unitPrice,totalPrice=_this$state.totalPrice,showAddConfirmation=_this$state.showAddConfirmation,showAddError=_this$state.showAddError;var confirmationMessage=addToTemplateConfirmation.replace('{count}',this.state.quantity.toString()).replace('{productAndDimensions}',\"\".concat(this.state.product.Name,\", \").concat(Object.values(this.selectedDimensions).join(', ')));return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product-config'},/*#__PURE__*/React.createElement(Image,{src:(product===null||product===void 0?void 0:product.PrimaryImageUrl)||'',fallBackSrc:getFallbackImageUrl(product===null||product===void 0?void 0:product.ItemId,apiSettings)||'',className:'thumbnail',imageSettings:imageSettings,gridSettings:gridSettings,loadFailureBehavior:'empty'}),/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product__attributes'},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product__id'},product===null||product===void 0?void 0:product.RecordId),/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product__name'},highlightSearchTerm((product===null||product===void 0?void 0:product.Name)||'')),/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product__unit-price'},addLineProductUnitPricePrefix,\" \",this._formatPrice(unitPrice)),/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product__uom'},addLineProductUnitOfMeasurePrefix,\" \",product===null||product===void 0?void 0:product.DefaultUnitOfMeasure)),/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product-config__dimensions'},this._getDimensionsNodes())),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:'quantity-container'},/*#__PURE__*/React.createElement(\"div\",null,quantitySelectLabel),/*#__PURE__*/React.createElement(OrderTemplateQuantity,{id:'msc-add-line-to-template__product-config__quantity',currentCount:quantity,onChange:this._onQuantityChange,inputQuantityAriaLabel:'Press to increment quantity by 1',max:Number.MAX_VALUE,decrementButtonAriaLabel:decrementButtonAriaLabel,incrementButtonAriaLabel:incrementButtonAriaLabel})),/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product__total-price'},totalPriceLabel,\" \",this._formatPrice(totalPrice)))),showAddConfirmation&&/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__add-success msc-alert-success msc-alert'},/*#__PURE__*/React.createElement(\"span\",{\"aria-hidden\":'true'}),confirmationMessage),showAddError&&/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__add-error msc-alert-danger msc-alert'},/*#__PURE__*/React.createElement(\"span\",{className:'msi-exclamation-triangle',\"aria-hidden\":'true'}),addToTemplateError),/*#__PURE__*/React.createElement(Button,{className:classnames('msc-add-line-to-template__add-configured-product-button',{'is-busy':this.state.isBusy}),\"aria-label\":addItemToTemplateText,onClick:this._addToTemplateHandler,disabled:buttonDisabled},addItemToTemplateText));}},{key:\"_getDimensionsNodes\",value:function _getDimensionsNodes(){var _this2=this;var dimensions=this.state.dimensions;var resources=this.props.resources;return dimensions===null||dimensions===void 0?void 0:dimensions.map(function(dimension){var DimensionValues=dimension.DimensionValues,DimensionTypeValue=dimension.DimensionTypeValue;var mapDimensions=function mapDimensions(value){return{id:value.RecordId,value:value.Value||''};};var dropdownList=DimensionValues?DimensionValues.map(mapDimensions):[];return/*#__PURE__*/React.createElement(\"div\",{key:DimensionTypeValue},/*#__PURE__*/React.createElement(\"div\",null,_this2._getDropdownName(DimensionTypeValue,resources)),/*#__PURE__*/React.createElement(Dropdown,{dropdownId:DimensionTypeValue,dropdownName:_this2._getDropdownName(DimensionTypeValue,resources),dropdownList:dropdownList,onChange:_this2._onDimensionChanged}));});}},{key:\"_formatPrice\",value:function _formatPrice(price){var _this$props$context$c=this.props.context.cultureFormatter,formatCurrency=_this$props$context$c.formatCurrency,currencyCode=_this$props$context$c.currencyCode;return formatCurrency(price.toFixed(2),currencyCode);}}]);return ProductConfiguration;}(React.Component);","map":{"version":3,"sources":["modules/order-template/components/add-line/product-configuration.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n    getDimensionsForSelectedVariant,\n    GetDimensionsForSelectedVariantInput,\n    getFallbackImageUrl,\n    getPriceForSelectedVariant,\n    getProductAvailabilitiesForSelectedVariant,\n    getSelectedVariant,\n    IProductInventoryInformation,\n    PriceForSelectedVariantInput,\n    ProductAvailabilitiesForSelectedVariantInput,\n    SelectedVariantInput\n } from '@msdyn365-commerce-modules/retail-actions';\nimport { Button, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport { ProductDimensionFull } from '@msdyn365-commerce/commerce-entities';\nimport { IImageSettings, Image } from '@msdyn365-commerce/core';\nimport { ProductDimensionValue, ProductListLine } from '@msdyn365-commerce/retail-proxy';\nimport { SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport classnames from 'classnames';\nimport React from 'react';\nimport { Dropdown, IAddLineToTemplateProps, IAddLineToTemplateResources, IDropdownItemProps, IDropdownOnSelection } from '.';\nimport OrderTemplateQuantity from '../common/order-template-quantity';\n\nexport interface IProductCnnfigurationProps extends IAddLineToTemplateProps {\n    product: SimpleProduct;\n    dimensions: ProductDimensionFull[];\n    imageSettings: IImageSettings;\n    telemetryContent?: ITelemetryContent;\n    addToTemplateHandler(params: IProductConfigurationState): Promise<ProductListLine>;\n    highlightSearchTerm(name: string): React.ReactNode;\n}\n\nexport interface IProductConfigurationState {\n    quantity: number;\n    unitPrice: number;\n    totalPrice: number;\n    product: SimpleProduct;\n    dimensions: ProductDimensionFull[];\n    selectedDimensions: {};\n    productAvailableQuantity?: IProductInventoryInformation;\n    buttonDisabled: boolean;\n    showAddConfirmation: boolean;\n    showAddError: boolean;\n    isBusy: boolean;\n}\n\n/**\n * Configure selected product for addition to order template\n */\nexport class ProductConfiguration extends React.Component<IProductCnnfigurationProps, IProductConfigurationState> {\n    private selectedDimensions: {};\n\n    constructor(props: IProductCnnfigurationProps) {\n        super(props);\n\n        this.state = {\n            quantity: 1,\n            unitPrice: props.product.Price,\n            totalPrice: props.product.Price,\n            product: props.product,\n            dimensions: props.dimensions,\n            selectedDimensions: {},\n            buttonDisabled: false,\n            showAddConfirmation: false,\n            showAddError: false\n        } as IProductConfigurationState;\n\n        this.selectedDimensions = props.dimensions.reduce((result, d) => {\n            result[`${d.DimensionTypeValue}`] = d.DimensionValues![0].Value;\n            return result;\n        },                                                {});\n    }\n\n    public render(): JSX.Element {\n        const {\n            context: {\n                actionContext: {\n                    requestContext: { apiSettings }\n                },\n                request: { gridSettings }\n             },\n             resources: {\n                addItemToTemplateText,\n                addLineProductUnitPricePrefix,\n                decrementButtonAriaLabel,\n                incrementButtonAriaLabel,\n                quantitySelectLabel,\n                addLineProductUnitOfMeasurePrefix,\n                addToTemplateConfirmation,\n                addToTemplateError,\n                totalPriceLabel\n            },\n            imageSettings,\n            highlightSearchTerm\n        } = this.props;\n        const { buttonDisabled, product, quantity, unitPrice, totalPrice, showAddConfirmation, showAddError } = this.state;\n\n        const confirmationMessage = addToTemplateConfirmation\n            .replace('{count}', this.state.quantity.toString())\n            .replace('{productAndDimensions}', `${this.state.product.Name}, ${Object.values(this.selectedDimensions).join(', ')}`);\n\n        return (\n            <>\n                <div className='msc-add-line-to-template__product-config'>\n                    <Image\n                        src={product?.PrimaryImageUrl || ''}\n                        fallBackSrc={\n                            getFallbackImageUrl(product?.ItemId, apiSettings) || ''\n                        }\n                        className={'thumbnail'}\n                        imageSettings={imageSettings}\n                        gridSettings={gridSettings!}\n                        loadFailureBehavior='empty'\n                    />\n                    <div className='msc-add-line-to-template__product__attributes'>\n                        <div>\n                            <div className='msc-add-line-to-template__product__id'>{product?.RecordId}</div>\n                            <div className='msc-add-line-to-template__product__name'>{highlightSearchTerm(product?.Name || '')}</div>\n                            <div className='msc-add-line-to-template__product__unit-price'>{addLineProductUnitPricePrefix} {this._formatPrice(unitPrice)}</div>\n                            <div className='msc-add-line-to-template__product__uom'>{addLineProductUnitOfMeasurePrefix} {product?.DefaultUnitOfMeasure}</div>\n                        </div>\n                        <div className='msc-add-line-to-template__product-config__dimensions'>\n                            {this._getDimensionsNodes()}\n                        </div>\n                    </div>\n                    <div>\n                        <div className='quantity-container'>\n                            <div>{quantitySelectLabel}</div>\n                            <OrderTemplateQuantity\n                                id={'msc-add-line-to-template__product-config__quantity'}\n                                currentCount={quantity}\n                                onChange={this._onQuantityChange}\n                                inputQuantityAriaLabel='Press to increment quantity by 1'\n                                max={Number.MAX_VALUE}\n                                decrementButtonAriaLabel={decrementButtonAriaLabel}\n                                incrementButtonAriaLabel={incrementButtonAriaLabel}\n                            />\n                        </div>\n                        <div className='msc-add-line-to-template__product__total-price'>{totalPriceLabel} {this._formatPrice(totalPrice)}</div>\n                    </div>\n                </div>\n                {showAddConfirmation && <div className='msc-add-line-to-template__add-success msc-alert-success msc-alert'><span aria-hidden='true'/>{confirmationMessage}</div>}\n                {showAddError && <div className='msc-add-line-to-template__add-error msc-alert-danger msc-alert'><span className='msi-exclamation-triangle' aria-hidden='true'/>{addToTemplateError}</div>}\n                    <Button\n                        className={classnames('msc-add-line-to-template__add-configured-product-button', { 'is-busy': this.state.isBusy })}\n                        aria-label={addItemToTemplateText}\n                        onClick={this._addToTemplateHandler}\n                        disabled={buttonDisabled}\n                    >\n                        {addItemToTemplateText}\n                    </Button>\n            </>\n        );\n    }\n\n    private _getDimensionsNodes(): React.ReactElement[] {\n        const { dimensions } = this.state;\n        const { resources } = this.props;\n\n        return dimensions?.map((dimension: ProductDimensionFull) => {\n            const { DimensionValues, DimensionTypeValue } = dimension;\n            const mapDimensions = (value: ProductDimensionValue): IDropdownItemProps => ({\n                id: value.RecordId,\n                value: value.Value || ''\n            });\n            const dropdownList: IDropdownItemProps[] = DimensionValues ? DimensionValues.map<IDropdownItemProps>(mapDimensions) : [];\n\n            return (\n                <div key={DimensionTypeValue}>\n                    <div>{this._getDropdownName(DimensionTypeValue, resources)}</div>\n                    <Dropdown\n                        dropdownId={DimensionTypeValue}\n                        dropdownName={this._getDropdownName(DimensionTypeValue, resources)}\n                        dropdownList={dropdownList}\n                        onChange={this._onDimensionChanged}\n                    />\n                </div>\n            );\n        });\n    }\n\n    private _addToTemplateHandler = async (event: React.MouseEvent<HTMLButtonElement, MouseEvent>) => {\n        // hide confirmation when adding multiple items\n        this.setState({\n            isBusy: true,\n            showAddConfirmation: false,\n            showAddError: false\n        });\n\n        this.props.addToTemplateHandler({...this.state})\n            .then(status => {\n                // validate against the existance of a ProductListId\n                if (status.ProductListId) {\n                    this.setState({\n                        isBusy: false,\n                        showAddConfirmation: true\n                    });\n                }\n            }).catch(error => {\n                this.setState({\n                    isBusy: false,\n                    showAddError: true\n                });\n                this.props.context.telemetry.error('Error adding item to order template');\n            });\n    };\n\n    private _onQuantityChange = (newValue: number) => {\n        this.setState({\n            quantity: newValue,\n            totalPrice: newValue * this.props.product.Price\n        });\n    }\n\n    // rehydrate the selected variants price, available dimensions & sizes\n    private _onDimensionChanged = async (selection: IDropdownOnSelection): Promise<void> => {\n        this.setState({\n            isBusy: false,\n            showAddConfirmation: false,\n            showAddError: false,\n            buttonDisabled: true\n        });\n\n        const { product, dimensions, context } = this.props;\n        const {\n            actionContext,\n            request: { apiSettings: { channelId } }\n        } = context;\n\n        const mappedDimensions = dimensions?.map(dimension => {\n            return {\n                DimensionTypeValue: dimension.DimensionTypeValue,\n                DimensionValue: dimension.DimensionValues?.find(value => value.RecordId === +selection.selectId),\n                ExtensionProperties: dimension.ExtensionProperties\n            };\n        }).filter(dimension => {\n            return dimension && dimension.DimensionValue;\n        });\n\n        mappedDimensions.forEach(dimension => {\n            this.state.selectedDimensions[dimension.DimensionTypeValue] = dimension.DimensionValue;\n        });\n\n        const variantProduct = (await getSelectedVariant(\n            new SelectedVariantInput(\n                product.MasterProductId ? product.MasterProductId : product.RecordId,\n                channelId,\n                mappedDimensions\n            ),\n            actionContext\n        ));\n\n        if (!variantProduct) {\n            this.props.context.telemetry.error(`Error retrieving variant product for product ${product.MasterProductId ? product.MasterProductId : product.RecordId}`);\n            return;\n        }\n\n        const dimensionInput = new GetDimensionsForSelectedVariantInput(\n            variantProduct.RecordId,\n            channelId,\n            mappedDimensions\n        );\n        const variantDimensions = await getDimensionsForSelectedVariant(dimensionInput, actionContext);\n\n        if (!variantDimensions) {\n            this.props.context.telemetry.error('Error retrieving dimensions for reconfigured product variant');\n            this.setState({\n                buttonDisabled: false\n            });\n            return;\n        }\n\n        const availabilityInput = new ProductAvailabilitiesForSelectedVariantInput(\n            product.MasterProductId ? product.MasterProductId : product.RecordId,\n            channelId\n        );\n        // @TODO sync UX quantity w/ actual availibility\n        const newAvailableQuantity = await getProductAvailabilitiesForSelectedVariant(availabilityInput, actionContext);\n        const priceInput = new PriceForSelectedVariantInput(product.RecordId, channelId);\n        const productPrice = await getPriceForSelectedVariant(priceInput, actionContext);\n\n        if (!productPrice) {\n            this.props.context.telemetry.error('Error retrieving price for reconfigured product variant');\n            this.setState({\n                buttonDisabled: false\n            });\n            return;\n        }\n\n        this.setState({\n            buttonDisabled: false,\n            productAvailableQuantity: newAvailableQuantity && newAvailableQuantity[0] || undefined,\n            unitPrice: +(productPrice.BasePrice || product.Price),\n            dimensions: variantDimensions,\n            product: variantProduct\n        });\n    }\n\n    private _getDropdownName = (dimensionType: number, resources: IAddLineToTemplateResources): string => {\n        switch (dimensionType) {\n            case 1: // Color\n                return resources.productDimensionTypeColor;\n            case 2: // Configuration\n                return resources.productDimensionTypeConfiguration;\n            case 3: // Size\n                return resources.productDimensionTypeSize;\n            case 4: // Style\n                return resources.productDimensionTypeStyle;\n            default:\n                return '';\n        }\n    };\n\n    private _formatPrice(price: number): string {\n        const {\n            context: {\n                cultureFormatter: {\n                    formatCurrency,\n                    // @ts-ignore\n                    currencyCode\n                }\n            }\n        } = this.props;\n\n        return formatCurrency(price.toFixed(2), currencyCode);\n    }\n}"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}