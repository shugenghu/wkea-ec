{"ast":null,"code":"import _objectWithoutProperties from\"@babel/runtime/helpers/esm/objectWithoutProperties\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{getPayloadObject,getTelemetryAttributes}from'@msdyn365-commerce-modules/utilities';import{RatingComponent}from'@msdyn365-commerce/components';import*as React from'react';var RefineItem=/*#__PURE__*/function(_React$Component){_inherits(RefineItem,_React$Component);var _super=_createSuper(RefineItem);function RefineItem(props){var _this;_classCallCheck(this,RefineItem);_this=_super.call(this,props);_this._onClick=function(e){e.preventDefault();var _this$props=_this.props,parentProductRefinerHierarchy=_this$props.parentProductRefinerHierarchy,productRefinerValue=_this$props.productRefinerValue,selectedRefinementCriterion=_this$props.selectedRefinementCriterion;if(productRefinerValue){_this.props.onToggle({parentProductRefinerHierarchy:parentProductRefinerHierarchy,productRefinerValue:productRefinerValue,isSelecting:!selectedRefinementCriterion});setTimeout(function(){_this.anchorType.current&&_this.anchorType.current.focus();},0);}};_this._onClick=_this._onClick.bind(_assertThisInitialized(_this));_this.state={isChecked:!!_this.props.selectedRefinementCriterion};_this.anchorType=/*#__PURE__*/React.createRef();_this.payLoad=getPayloadObject('click',_this.props.telemetryContent,'');return _this;}_createClass(RefineItem,[{key:\"render\",value:function render(){var _this$props2=this.props,isDisabled=_this$props2.isDisabled,refineItemCommonProps=_this$props2.refineItemCommonProps,parentProductRefinerHierarchy=_this$props2.parentProductRefinerHierarchy,productRefinerValue=_this$props2.productRefinerValue,selectedRefinementCriterion=_this$props2.selectedRefinementCriterion,index=_this$props2.index,children=_this$props2.children,onToggle=_this$props2.onToggle,context=_this$props2.context,telemetryContent=_this$props2.telemetryContent,attrs=_objectWithoutProperties(_this$props2,[\"isDisabled\",\"refineItemCommonProps\",\"parentProductRefinerHierarchy\",\"productRefinerValue\",\"selectedRefinementCriterion\",\"index\",\"children\",\"onToggle\",\"context\",\"telemetryContent\"]);if(!productRefinerValue){refineItemCommonProps.telemetry.error('[refine-item] Cannot render refineItem without productRefinerValue');return undefined;}if(!productRefinerValue.LeftValueBoundString){refineItemCommonProps.telemetry.warning(\"[refine-item]  RefineItem without LeftValueBoundString: \".concat(JSON.stringify(productRefinerValue)));}var isSingleSelect=parentProductRefinerHierarchy.RefinerTypeValue===0;var itemTypeClassName=isSingleSelect?'single-select':'multi-select';itemTypeClassName=\"ms-refine-submenu-item \".concat(itemTypeClassName);var inputType=isSingleSelect?'radio':'checkbox';itemTypeClassName=!!selectedRefinementCriterion?\"\".concat(itemTypeClassName,\"-checked\"):itemTypeClassName;if(parentProductRefinerHierarchy.SourceValue===4){if(productRefinerValue.LeftValueBoundString){this.payLoad.contentAction.etext=productRefinerValue.LeftValueBoundLocalizedString;var attribute=getTelemetryAttributes(telemetryContent,this.payLoad);return/*#__PURE__*/React.createElement(\"li\",{className:'ms-refine-submenu-item',role:'radio',\"aria-checked\":'false',id:\"\".concat(parentProductRefinerHierarchy.KeyName,\"_\").concat(index),\"aria-label\":\"\".concat(parentProductRefinerHierarchy.KeyName,\"_\").concat(index)},/*#__PURE__*/React.createElement(\"a\",Object.assign({href:this._getRefinerUrl(),\"aria-label\":\"\".concat(parentProductRefinerHierarchy.KeyName,\"_\").concat(productRefinerValue.LeftValueBoundLocalizedString),onClick:this._onClick},attribute),/*#__PURE__*/React.createElement(RatingComponent,{avgRating:parseInt(productRefinerValue.LeftValueBoundString,10),ratingCount:productRefinerValue.LeftValueBoundLocalizedString?productRefinerValue.LeftValueBoundLocalizedString:productRefinerValue.LeftValueBoundString,hideCount:false,readOnly:true,ariaLabel:'',context:context,id:this.props.moduleId,typeName:this.props.moduleTypeName,data:{}}),/*#__PURE__*/React.createElement(\"span\",{className:'refine-submenu-item__rating'},productRefinerValue.Count!==undefined&&\"(\".concat(productRefinerValue.Count,\")\"))));}else{return undefined;}}else{this.payLoad.contentAction.etext=productRefinerValue.LeftValueBoundLocalizedString||productRefinerValue.LeftValueBoundString;var _attribute=getTelemetryAttributes(telemetryContent,this.payLoad);return/*#__PURE__*/React.createElement(\"li\",{className:'ms-refine-submenu-item',id:\"\".concat(parentProductRefinerHierarchy.KeyName,\"_\").concat(index)},/*#__PURE__*/React.createElement(\"a\",Object.assign({key:!!selectedRefinementCriterion?'true':'false',ref:this.anchorType,href:this._getRefinerUrl(),tabIndex:0,onClick:this._onClick,className:itemTypeClassName,role:inputType,\"aria-checked\":!!selectedRefinementCriterion},_attribute,attrs),/*#__PURE__*/React.createElement(\"span\",{className:'ms-refine-submenu-item__label'},productRefinerValue.LeftValueBoundLocalizedString||productRefinerValue.LeftValueBoundString,productRefinerValue.Count!==undefined&&\" (\".concat(productRefinerValue.Count,\")\"))));}}},{key:\"_getRefinerUrl\",value:function _getRefinerUrl(){var _this$props3=this.props,urlBuilder=_this$props3.urlBuilder,parentProductRefinerHierarchy=_this$props3.parentProductRefinerHierarchy,productRefinerValue=_this$props3.productRefinerValue,selectedRefinementCriterion=_this$props3.selectedRefinementCriterion;if(productRefinerValue){return urlBuilder({parentProductRefinerHierarchy:parentProductRefinerHierarchy,productRefinerValue:productRefinerValue,isSelecting:!selectedRefinementCriterion});}return'';}}]);return RefineItem;}(React.Component);export{RefineItem as default};","map":{"version":3,"sources":["modules/search-result-container/components/refine-item.tsx"],"names":[],"mappings":"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","sourcesContent":["import { getPayloadObject, getTelemetryAttributes, IPayLoad, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport { IProductRefinerHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { RatingComponent } from '@msdyn365-commerce/components';\nimport { ICoreContext } from '@msdyn365-commerce/core';\nimport { ProductRefinerValue } from '@msdyn365-commerce/retail-proxy';\nimport * as React from 'react';\nimport { IRefineItemToggleNotification } from './refine-item-toggle-notification';\nimport { IRefineItemCommonProps } from './refine-item.props.common';\nimport { ProductRefinerSource, ProductRefinerTypeValue } from './utilities';\n\n/**\n * RefineItem properties\n */\nexport interface IRefineItemProps {\n\n    parentProductRefinerHierarchy: IProductRefinerHierarchy;\n    productRefinerValue: ProductRefinerValue;\n    selectedRefinementCriterion: ProductRefinerValue | undefined;\n    refineItemCommonProps: IRefineItemCommonProps;\n    isDisabled: boolean;\n    context: ICoreContext;\n    moduleId: string;\n    moduleTypeName: string;\n    index?: number;\n    /** The telemetry content */\n    telemetryContent?: ITelemetryContent;\n    onToggle(notfication: Readonly<IRefineItemToggleNotification>): void;\n    urlBuilder(refiner: IRefineItemToggleNotification): string;\n}\n\n/**\n * Refine item state\n */\nexport interface IRefineItemState extends React.ComponentState {\n    isChecked: boolean;\n    renderingError?: object;\n}\n\n/**\n * Single-select and multi-select refine item component (controlled by RefineSubmenu)\n */\nexport default class RefineItem extends React.Component<IRefineItemProps, IRefineItemState> {\n    private anchorType: React.RefObject<HTMLAnchorElement>;\n    private payLoad: IPayLoad;\n\n    constructor(props: IRefineItemProps) {\n        super(props);\n        this._onClick = this._onClick.bind(this);\n        this.state = {\n            isChecked: !!this.props.selectedRefinementCriterion\n        };\n        this.anchorType = React.createRef();\n        this.payLoad = getPayloadObject('click', this.props.telemetryContent!, '');\n    }\n\n    public render(): JSX.Element | undefined {\n        const {\n            isDisabled,\n            refineItemCommonProps,\n            parentProductRefinerHierarchy,\n            productRefinerValue,\n            selectedRefinementCriterion,\n            index,\n            children,\n            onToggle,\n            context,\n            telemetryContent,\n            ...attrs\n        } = this.props;\n        if (!productRefinerValue) {\n            refineItemCommonProps.telemetry.error('[refine-item] Cannot render refineItem without productRefinerValue');\n            return undefined;\n        }\n        if (!productRefinerValue.LeftValueBoundString) {\n            refineItemCommonProps.telemetry.warning(`[refine-item]  RefineItem without LeftValueBoundString: ${JSON.stringify(productRefinerValue)}`);\n        }\n        const isSingleSelect = parentProductRefinerHierarchy.RefinerTypeValue === ProductRefinerTypeValue.Single;\n        let itemTypeClassName = isSingleSelect ? 'single-select' : 'multi-select';\n        itemTypeClassName = `ms-refine-submenu-item ${itemTypeClassName}`;\n        const inputType = isSingleSelect ? 'radio' : 'checkbox';\n        itemTypeClassName = !!selectedRefinementCriterion ? `${itemTypeClassName}-checked` : itemTypeClassName;\n        if (parentProductRefinerHierarchy.SourceValue === ProductRefinerSource.Rating) {\n            if (productRefinerValue.LeftValueBoundString) {\n                this.payLoad.contentAction.etext = productRefinerValue.LeftValueBoundLocalizedString;\n                const attribute = getTelemetryAttributes(telemetryContent!, this.payLoad);\n                return (\n                    <li\n                        className='ms-refine-submenu-item'\n                        role='radio'\n                        aria-checked='false'\n                        id={`${parentProductRefinerHierarchy.KeyName! }_${index}`}\n                        aria-label={`${parentProductRefinerHierarchy.KeyName!}_${index}`}\n                    >\n                        <a\n                            href={this._getRefinerUrl()}\n                            aria-label={`${parentProductRefinerHierarchy.KeyName!}_${productRefinerValue.LeftValueBoundLocalizedString}`}\n                            onClick={this._onClick}\n                            {...attribute}\n                        >\n                            <RatingComponent\n                                avgRating={parseInt(productRefinerValue.LeftValueBoundString, 10)}\n                                ratingCount={productRefinerValue.LeftValueBoundLocalizedString ? productRefinerValue.LeftValueBoundLocalizedString : productRefinerValue.LeftValueBoundString}\n                                hideCount={false}\n                                readOnly={true}\n                                ariaLabel=''\n                                context={context}\n                                id={this.props.moduleId}\n                                typeName={this.props.moduleTypeName}\n                                data={{}}\n                            />\n                            <span className='refine-submenu-item__rating'>{productRefinerValue.Count !== undefined && `(${productRefinerValue.Count})`}</span>\n                        </a>\n                    </li>\n                );\n            } else {\n                return undefined;\n            }\n        } else {\n            this.payLoad.contentAction.etext = productRefinerValue.LeftValueBoundLocalizedString || productRefinerValue.LeftValueBoundString;\n            const attribute = getTelemetryAttributes(telemetryContent!, this.payLoad);\n            return (\n                <li className='ms-refine-submenu-item' id={`${parentProductRefinerHierarchy.KeyName!}_${index}`}>\n                    <a\n                        key={!!selectedRefinementCriterion ? 'true' : 'false'}\n                        ref={this.anchorType}\n                        href={this._getRefinerUrl()}\n                        tabIndex={0}\n                        onClick={this._onClick}\n                        className={itemTypeClassName}\n                        role={inputType}\n                        aria-checked={!!selectedRefinementCriterion}\n                        {...attribute}\n                        {...attrs}\n                    >\n                        <span className='ms-refine-submenu-item__label'>\n                            {productRefinerValue.LeftValueBoundLocalizedString || productRefinerValue.LeftValueBoundString}\n                            {productRefinerValue.Count !== undefined && ` (${productRefinerValue.Count})`}\n                        </span>\n                    </a>\n                </li>\n            );\n        }\n    }\n\n    private _getRefinerUrl(): string {\n        const { urlBuilder, parentProductRefinerHierarchy, productRefinerValue, selectedRefinementCriterion } = this.props;\n\n        if (productRefinerValue) {\n            return urlBuilder({\n                parentProductRefinerHierarchy: parentProductRefinerHierarchy,\n                productRefinerValue: productRefinerValue,\n                isSelecting: !selectedRefinementCriterion\n            });\n        }\n\n        return '';\n    }\n\n    private _onClick = (e: React.MouseEvent<HTMLAnchorElement | HTMLInputElement>): void => {\n        e.preventDefault();\n\n        const { parentProductRefinerHierarchy, productRefinerValue, selectedRefinementCriterion } = this.props;\n        if (productRefinerValue) {\n            this.props.onToggle({\n                parentProductRefinerHierarchy: parentProductRefinerHierarchy,\n                productRefinerValue: productRefinerValue,\n                isSelecting: !selectedRefinementCriterion\n            });\n\n            setTimeout(\n                () => {\n                    this.anchorType.current && this.anchorType.current.focus();\n                },\n                0\n            );\n        }\n    }\n}"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}