{"ast":null,"code":"import\"core-js/modules/es.regexp.to-string.js\";import\"core-js/modules/es.string.search.js\";import\"core-js/modules/es.string.split.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import\"core-js/modules/web.url.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import*as MsDyn365 from'@msdyn365-commerce/core';import classnames from'classnames';import{observer}from'mobx-react';import*as React from'react';import{createTabStateInput}from'../../data-actions/tab-state-data-action';import{getContentID,TabItemType}from'../tab-item/tab-item';let Tab=class Tab extends React.Component{constructor(props){super(props);this.tabIndexQuery='activeTab';this.handleHeadingChange=event=>this.props.config.heading.text=event.target.value;this._onClick=(index,id)=>e=>{const activeTabState={activeContentIndex:index,tabId:id};this.props.context.actionContext.update(createTabStateInput(activeTabState),activeTabState);this.setState({currentTabIndex:index});const requestContext=this.props.context.request;const newUrl=this._setGetParameter(requestContext,this.tabIndexQuery,\"\".concat(this.props.id,\":\").concat(String(index+1)));requestContext&&window.history.pushState({path:newUrl},'',newUrl);};this._onKeyDown=(index,id)=>e=>{debugger;if(e.keyCode===13){const activeTabState={activeContentIndex:index,tabId:id};this.props.context.actionContext.update(createTabStateInput(activeTabState),activeTabState);this.setState({currentTabIndex:index});const requestContext=this.props.context.request;const newUrl=this._setGetParameter(requestContext,this.tabIndexQuery,\"\".concat(this.props.id,\":\").concat(String(index+1)));requestContext&&window.history.pushState({path:newUrl},'',newUrl);}if(e.keyCode===39||e.keyCode===37){const{slots}=this.props;const slotLength=slots&&slots.tabItems&&slots.tabItems.length||0;if(e.keyCode===39){if(index+1===slotLength){index=-1;}const activeTabState={activeContentIndex:index+1,tabId:id};this.props.context.actionContext.update(createTabStateInput(activeTabState),activeTabState);this.setState({currentTabIndex:index+1});const requestContext=this.props.context.request;const newUrl=this._setGetParameter(requestContext,this.tabIndexQuery,\"\".concat(this.props.id,\":\").concat(String(index+2)));requestContext&&window.history.pushState({path:newUrl},'',newUrl);}else if(e.keyCode===37){if(index===0){index=slotLength;}const activeTabState={activeContentIndex:index-1,tabId:id};this.props.context.actionContext.update(createTabStateInput(activeTabState),activeTabState);this.setState({currentTabIndex:index-1});const requestContext=this.props.context.request;const newUrl=this._setGetParameter(requestContext,this.tabIndexQuery,\"\".concat(this.props.id,\":\").concat(String(index)));requestContext&&window.history.pushState({path:newUrl},'',newUrl);}}};const{defaultTabIndex}=this.props.config;const{slots}=this.props;const slotLength=slots&&slots.tabItems&&slots.tabItems.length||0;let initialIndex=defaultTabIndex&&defaultTabIndex<=slotLength&&defaultTabIndex>0?defaultTabIndex-1:0;const queryString=this.props.context&&this.props.context.request&&this.props.context.request.query&&this.props.context.request.query.activeTab||'';let queryTabIndex=0;if(queryString.indexOf(':')>0){const arr=queryString.split(':');const moduleId=arr[0];if(moduleId===this.props.id){queryTabIndex=parseInt(arr[1],10);}}initialIndex=queryTabIndex>0&&queryTabIndex<=slotLength?queryTabIndex-1:initialIndex;this.state={currentTabIndex:initialIndex};this._getTabHeader=this._getTabHeader.bind(this);this._getTabContent=this._getTabContent.bind(this);this._onClick=this._onClick.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._setGetParameter=this._setGetParameter.bind(this);this.activeLink=null;}render(){const{slots}=this.props;const{heading,className}=this.props.config;const headingComponent=heading&&/*#__PURE__*/React.createElement(MsDyn365.Text,{className:'ms-tab-header-section__heading',tag:heading.tag||'h2',text:heading.text,editProps:{onEdit:this.handleHeadingChange,requestContext:this.props.context.request}});const slotLength=slots&&slots.tabItems&&slots.tabItems.length||0;const tabViewProps=_objectSpread(_objectSpread({},this.props),{},{TabContainer:{moduleProps:this.props,className:classnames('ms-tab',className)},headerSection:{className:'ms-tab-header-section'},tabsSection:{className:'ms-tab-tabs-section',tag:'ul',role:'tablist'},heading:headingComponent,config:this.props&&this.props.config,tabItemContainer:{tag:'div',className:'ms-tab-content-section'},tabContents:slotLength>0&&slots.tabItems.map((item,index)=>this._getTabContent(item,index)),tabHeaders:slotLength>0&&slots.tabItems.map((item,index)=>this._getTabHeader(item,index))});return this.props.renderView(tabViewProps);}componentDidUpdate(){const{data}=this.props;const dataActionTabId=data&&data.activeTabState&&data.activeTabState.result&&data.activeTabState.result.tabId;if(dataActionTabId){if(this.props.id===dataActionTabId){this.activeLink&&this.activeLink.focus();}}else{const queryString=this.props.context&&this.props.context.request&&this.props.context.request.query&&this.props.context.request.query.activeTab||'';if(queryString.indexOf(':')>0){const arr=queryString.split(':');const moduleId=arr[0];if(moduleId===this.props.id){this.activeLink&&this.activeLink.focus();}}}}_getTabHeader(item,index){const{data}=this.props;const activeContentIndex=data&&data.activeTabState&&data.activeTabState.result&&data.activeTabState.result.activeContentIndex;const dataActionTabId=data&&data.activeTabState&&data.activeTabState.result&&data.activeTabState.result.tabId;const selected=activeContentIndex!==undefined&&dataActionTabId===this.props.id?activeContentIndex===index:this.state.currentTabIndex===index;const contentID=getContentID(index,this.props.id);return/*#__PURE__*/React.createElement(\"li\",{key:index,className:'ms-tab-tabs-section-li',tabIndex:selected?0:-1,onClick:this._onClick(index,this.props.id),onKeyDown:this._onKeyDown(index,this.props.id),ref:link=>{if(index===this.state.currentTabIndex){this.activeLink=link;}},\"aria-controls\":contentID,\"aria-selected\":selected,role:'tab'},/*#__PURE__*/React.createElement(React.Fragment,{key:index},/*#__PURE__*/React.cloneElement(item,{tabItemType:TabItemType.TabHeader,isSelected:index===this.state.currentTabIndex,itemIndex:index,tabId:this.props.id})));}_getTabContent(item,index){return/*#__PURE__*/React.createElement(React.Fragment,{key:index},/*#__PURE__*/React.cloneElement(item,{tabItemType:TabItemType.TabContent,isSelected:index===this.state.currentTabIndex,itemIndex:index,tabId:this.props.id}));}_setGetParameter(requestContext,paramName,paramValue){let url;if(MsDyn365.msdyn365Commerce.isBrowser){url=new URL(window.location.href);}else{url=new URL(requestContext.url.requestUrl.href);}const params=new window.URLSearchParams(url.search);params.set(paramName,paramValue);url.search=decodeURIComponent(params.toString());return url.toString();}};Tab=__decorate([observer],Tab);export default Tab;","map":{"version":3,"sources":["modules/tab/tab.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IModuleProps, INodeProps, NodeTag } from '@msdyn365-commerce-modules/utilities';\nimport * as MsDyn365 from '@msdyn365-commerce/core';\nimport classnames from 'classnames';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { createTabStateInput } from '../../data-actions/tab-state-data-action';\nimport { getContentID, TabItemType } from '../tab-item/tab-item';\nimport { ITabData } from './tab.data';\nimport { ITabProps } from './tab.props.autogenerated';\n\n/**\n *\n * Tab component\n * @extends {React.PureComponent<ITabProps<ITabData>>}\n */\n\nexport interface ICallToActionProps {\n  link: INodeProps[];\n}\n\nexport interface ITabViewProps extends ITabProps<{}> {\n  heading?: React.ReactNode;\n  TabContainer: IModuleProps;\n  headerSection: INodeProps;\n  tabHeaderSection: INodeProps;\n  tabsSection: INodeProps;\n  tabItemContainer: INodeProps;\n  tabHeaders: React.ReactNode;\n  tabContents: React.ReactNode;\n}\n\nexport interface ITabViewStates {\n  currentTabIndex: number;\n}\n/**\n *\n * Tab component\n * @extends {React.Component<ITabProps<ITabData>>}\n */\n@observer\nclass Tab extends React.Component<ITabProps<ITabData>, ITabViewStates> {\n  public readonly tabIndexQuery: string = 'activeTab';\n  private activeLink: HTMLLIElement | null;\n\n  constructor(props: ITabProps<ITabData>) {\n    super(props);\n    const { defaultTabIndex } = this.props.config;\n    const { slots } = this.props;\n    const slotLength = slots && slots.tabItems && slots.tabItems.length || 0;\n    let initialIndex = defaultTabIndex && defaultTabIndex <= slotLength && defaultTabIndex > 0 ? defaultTabIndex - 1 : 0;\n    const queryString: string = this.props.context && this.props.context.request && this.props.context.request.query && this.props.context.request.query.activeTab || '';\n    let queryTabIndex: number = 0;\n    if (queryString.indexOf(':') > 0) {\n      const arr = queryString.split(':');\n      const moduleId = arr[0];\n      if (moduleId === this.props.id) {\n        queryTabIndex = parseInt(arr[1], 10);\n      }\n    }\n    initialIndex = queryTabIndex > 0 && queryTabIndex <= slotLength ? queryTabIndex - 1 : initialIndex;\n    this.state = { currentTabIndex: initialIndex };\n\n    this._getTabHeader = this._getTabHeader.bind(this);\n    this._getTabContent = this._getTabContent.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this._onKeyDown = this._onKeyDown.bind(this);\n    this._setGetParameter = this._setGetParameter.bind(this);\n    this.activeLink = null;\n  }\n  public render(): JSX.Element {\n    const { slots } = this.props;\n    const { heading, className } = this.props.config;\n\n    const headingComponent = heading && (\n      <MsDyn365.Text\n        className='ms-tab-header-section__heading'\n        tag={heading.tag || 'h2'}\n        text={heading.text}\n        editProps={{ onEdit: this.handleHeadingChange, requestContext: this.props.context.request }}\n      />\n    );\n    const slotLength = slots && slots.tabItems && slots.tabItems.length || 0;\n    // const queryTabIndex = this.props.context && this.props.context.request && this.props.context.request.query && +this.props.context.request.query.activeTabIndex || 0;\n    // let activeIndex = defaultTabIndex && defaultTabIndex <= slotLength && defaultTabIndex > 0 ? defaultTabIndex - 1 : 0;\n    // activeIndex = queryTabIndex > 0 && queryTabIndex <= slotLength ? queryTabIndex - 1 : activeIndex;\n\n    const tabViewProps = {\n      ...this.props,\n      TabContainer: {\n        moduleProps: this.props,\n        className: classnames('ms-tab', className)\n      },\n      headerSection: { className: 'ms-tab-header-section' },\n      tabsSection: { className: 'ms-tab-tabs-section', tag: 'ul' as NodeTag, role: 'tablist' },\n      heading: headingComponent,\n      config: this.props && this.props.config,\n      tabItemContainer: {\n        tag: 'div' as NodeTag,\n        className: 'ms-tab-content-section',\n      },\n      tabContents: slotLength > 0 && slots.tabItems.map((item: React.ReactNode, index: number) => this._getTabContent(item, index)),\n      tabHeaders: slotLength > 0 && slots.tabItems.map((item: React.ReactNode, index: number) => this._getTabHeader(item, index)),\n    };\n    return this.props.renderView(tabViewProps) as React.ReactElement;\n  }\n\n  public handleHeadingChange = (event: MsDyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n\n  public componentDidUpdate(): void {\n    const { data } = this.props;\n    const dataActionTabId = data && data.activeTabState && data.activeTabState.result && data.activeTabState.result.tabId;\n    if (dataActionTabId) {\n      if (this.props.id === dataActionTabId) {\n        this.activeLink && this.activeLink.focus();\n      }\n    } else {\n      const queryString: string = this.props.context && this.props.context.request && this.props.context.request.query && this.props.context.request.query.activeTab || '';\n      if (queryString.indexOf(':') > 0) {\n        const arr = queryString.split(':');\n        const moduleId = arr[0];\n        if (moduleId === this.props.id) {\n          this.activeLink && this.activeLink.focus();\n        }\n      }\n    }\n  }\n\n  private _getTabHeader(item: React.ReactNode, index: number): React.ReactNode {\n    const { data } = this.props;\n    const activeContentIndex = data && data.activeTabState && data.activeTabState.result && data.activeTabState.result.activeContentIndex;\n    const dataActionTabId = data && data.activeTabState && data.activeTabState.result && data.activeTabState.result.tabId;\n    const selected = activeContentIndex !== undefined && dataActionTabId === this.props.id ? activeContentIndex === index : this.state.currentTabIndex === index;\n    const contentID = getContentID(index, this.props.id);\n\n    return (\n      <li\n        key={index}\n        className='ms-tab-tabs-section-li'\n        tabIndex={selected ? 0 : -1}\n        onClick={this._onClick(index, this.props.id)}\n        onKeyDown={this._onKeyDown(index, this.props.id)}\n        // tslint:disable-next-line:react-this-binding-issue\n        ref={link => { if (index === this.state.currentTabIndex) { this.activeLink = link; } }}\n        aria-controls={contentID}\n        aria-selected={selected}\n        role='tab'\n      >\n        <React.Fragment key={index}>\n          {React.cloneElement(item as React.ReactElement, { tabItemType: TabItemType.TabHeader, isSelected: index === this.state.currentTabIndex, itemIndex: index, tabId: this.props.id })}\n        </React.Fragment>\n      </li>\n    );\n  }\n\n  private _onClick = (index: number, id: string) => (e: React.MouseEvent<HTMLLIElement>) => {\n    const activeTabState = { activeContentIndex: index, tabId: id };\n    this.props.context.actionContext.update(createTabStateInput(activeTabState), activeTabState);\n    this.setState({ currentTabIndex: index });\n    // Update query paramter\n    const requestContext = this.props.context.request;\n    const newUrl = this._setGetParameter(requestContext, this.tabIndexQuery, `${this.props.id}:${String(index + 1)}`);\n    requestContext && window.history.pushState({ path: newUrl }, '', newUrl);\n  }\n\n  private _onKeyDown = (index: number, id: string) => (e: React.KeyboardEvent<HTMLLIElement>) => {\n    debugger;\n    if (e.keyCode === 13) {\n      const activeTabState = { activeContentIndex: index, tabId: id };\n      this.props.context.actionContext.update(createTabStateInput(activeTabState), activeTabState);\n      this.setState({ currentTabIndex: index });\n      // Update query paramter\n      const requestContext = this.props.context.request;\n      const newUrl = this._setGetParameter(requestContext, this.tabIndexQuery, `${this.props.id}:${String(index + 1)}`);\n      requestContext && window.history.pushState({ path: newUrl }, '', newUrl);\n    }\n\n    if (e.keyCode === 39 || e.keyCode === 37) {\n      const { slots } = this.props;\n      const slotLength = slots && slots.tabItems && slots.tabItems.length || 0;\n\n      if (e.keyCode === 39) {\n\n        // If we're at the end, go to the start\n        if (index + 1 === slotLength) {\n          index = -1;\n        }\n        const activeTabState = { activeContentIndex: index + 1, tabId: id };\n        this.props.context.actionContext.update(createTabStateInput(activeTabState), activeTabState);\n        this.setState({ currentTabIndex: index + 1 });\n        // Update query paramter\n        const requestContext = this.props.context.request;\n        const newUrl = this._setGetParameter(requestContext, this.tabIndexQuery, `${this.props.id}:${String(index + 2)}`);\n        requestContext && window.history.pushState({ path: newUrl }, '', newUrl);\n\n        // Move left\n      } else if (e.keyCode === 37) {\n        // If we're at the start, move to the end\n        if (index === 0) {\n          index = slotLength;\n        }\n        const activeTabState = { activeContentIndex: index - 1, tabId: id };\n        this.props.context.actionContext.update(createTabStateInput(activeTabState), activeTabState);\n        this.setState({ currentTabIndex: index - 1 });\n        // Update query paramter\n        const requestContext = this.props.context.request;\n        const newUrl = this._setGetParameter(requestContext, this.tabIndexQuery, `${this.props.id}:${String(index)}`);\n        requestContext && window.history.pushState({ path: newUrl }, '', newUrl);\n      }\n    }\n  }\n\n  private _getTabContent(item: React.ReactNode, index: number): React.ReactNode {\n    return (\n      <React.Fragment key={index}>\n        {React.cloneElement(item as React.ReactElement, { tabItemType: TabItemType.TabContent, isSelected: index === this.state.currentTabIndex, itemIndex: index, tabId: this.props.id })}\n      </React.Fragment>\n    );\n  }\n\n  private _setGetParameter(requestContext: MsDyn365.IRequestContext, paramName: string, paramValue: string): string {\n    let url;\n\n    if (MsDyn365.msdyn365Commerce.isBrowser) {\n      url = new URL(window.location.href);\n    } else {\n      url = new URL(requestContext.url.requestUrl.href);\n    }\n\n    const params = new window.URLSearchParams(url.search);\n    params.set(paramName, paramValue);\n    url.search = decodeURIComponent(params.toString());\n    return url.toString();\n  }\n}\n\nexport default Tab;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}