{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import{generateImageUrl}from'@msdyn365-commerce-modules/retail-actions';import{createObservableDataAction}from'@msdyn365-commerce/core';import{getSearchSuggestionsAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/StoreOperationsDataActions.g';export class AutoSuggestInput{constructor(searchText,top,suggestionType,hitPrefix,hitSuffix){this.getCacheKey=()=>\"AutoSuggestSearchSuggestions\";this.getCacheObjectType=()=>'AutoSuggestSearchSuggestions';this.dataCacheType=()=>'none';this.searchQuery=searchText;this.topResultsCount=top;this.suggestionType=suggestionType;this.hitPrefix=hitPrefix;this.hitSuffix=hitSuffix;}}const createInput=inputData=>{return new AutoSuggestInput();};export async function getSearchSuggestionsAction(input,ctx){if(!input||!input.searchQuery){throw new Error('[getSearchSuggestionsAction]No valid Input was provided, failing');}const autosuggest={};const autoSuggestPromises=[_getAutoSuggest(input,autosuggest,ctx)];return Promise.all(autoSuggestPromises).then(()=>{return autosuggest;});}async function _getAutoSuggest(input,autosuggest,ctx){const searchCriteria={ProductSearchCriteria:{SearchCondition:input.searchQuery&&input.searchQuery.length>0?input.searchQuery:'',Context:{ChannelId:+ctx.requestContext.apiSettings.channelId,CatalogId:+ctx.requestContext.apiSettings.catalogId}},HitPrefix:input.hitPrefix,HitSuffix:input.hitSuffix,SuggestionType:input.suggestionType};const searchSuggestions=await getSearchSuggestionsAsync({callerContext:ctx,queryResultSettings:{Paging:{Top:input.topResultsCount}}},searchCriteria);if(searchSuggestions&&searchSuggestions.length>0){searchSuggestions.map(item=>item.ImageUrl=item.ImageUrl?generateImageUrl(item.ImageUrl,ctx.requestContext.apiSettings):'');autosuggest.AllSearchResults=searchSuggestions;}else{ctx.telemetry.error(\"[getSearchSuggestionsAction] unable to get availabilites for search with suggestion type \".concat(searchCriteria.SuggestionType));}}export default createObservableDataAction({id:'@msdyn365-commerce-modules/search/get-auto-suggest-suggestions',action:getSearchSuggestionsAction,input:createInput});","map":{"version":3,"sources":["modules/search/actions/get-auto-suggest-suggestions.ts"],"names":[],"mappings":"8FAAA,OAAS,gBAAT,KAAiC,2CAAjC,CAEA,OACe,0BADf,KAGO,yBAHP,CAKA,OACI,yBADJ,KAEO,+EAFP,CAeA,MAAM,MAAO,CAAA,gBAAgB,CAOzB,WAAA,CAAY,UAAZ,CAAiC,GAAjC,CAA+C,cAA/C,CAAwE,SAAxE,CAA4F,SAA5F,CAA8G,CAQvG,KAAA,WAAA,CAAc,kCAAd,CACA,KAAA,kBAAA,CAAqB,IAAM,8BAA3B,CACA,KAAA,aAAA,CAAgB,IAAiB,MAAjC,CATH,KAAK,WAAL,CAAmB,UAAnB,CACA,KAAK,eAAL,CAAuB,GAAvB,CACA,KAAK,cAAL,CAAsB,cAAtB,CACA,KAAK,SAAL,CAAiB,SAAjB,CACA,KAAK,SAAL,CAAiB,SAAjB,CACH,CAbwB,CAoB7B,KAAM,CAAA,WAAW,CAAI,SAAD,EAAoC,CACpD,MAAO,IAAI,CAAA,gBAAJ,EAAP,CACH,CAFD,CAOA,MAAO,eAAe,CAAA,0BAAf,CAA0C,KAA1C,CAAmE,GAAnE,CAAsF,CAEzF,GAAI,CAAC,KAAD,EAAU,CAAC,KAAK,CAAC,WAArB,CAAkC,CAC9B,KAAM,IAAI,CAAA,KAAJ,CAAU,kEAAV,CAAN,CACH,CAED,KAAM,CAAA,WAAW,CAAoB,EAArC,CAEA,KAAM,CAAA,mBAAmB,CAAG,CACxB,eAAe,CAAC,KAAD,CAAQ,WAAR,CAAqB,GAArB,CADS,CAA5B,CAGA,MAAO,CAAA,OAAO,CAAC,GAAR,CAAY,mBAAZ,EAAiC,IAAjC,CAAsC,IAAK,CAC9C,MAAO,CAAA,WAAP,CACH,CAFM,CAAP,CAGH,CAED,cAAe,CAAA,eAAf,CACI,KADJ,CAEI,WAFJ,CAGI,GAHJ,CAGuB,CAEnB,KAAM,CAAA,cAAc,CAA6B,CAC7C,qBAAqB,CAAE,CACnB,eAAe,CAAE,KAAK,CAAC,WAAN,EAAqB,KAAK,CAAC,WAAN,CAAkB,MAAlB,CAA2B,CAAhD,CAAoD,KAAK,CAAC,WAA1D,CAAwE,EADtE,CAEnB,OAAO,CAAE,CACL,SAAS,CAAE,CAAC,GAAG,CAAC,cAAJ,CAAmB,WAAnB,CAA+B,SADtC,CAEL,SAAS,CAAE,CAAC,GAAG,CAAC,cAAJ,CAAmB,WAAnB,CAA+B,SAFtC,CAFU,CADsB,CAQ7C,SAAS,CAAE,KAAK,CAAC,SAR4B,CAS7C,SAAS,CAAE,KAAK,CAAC,SAT4B,CAU7C,cAAc,CAAE,KAAK,CAAC,cAVuB,CAAjD,CAaA,KAAM,CAAA,iBAAiB,CAAG,KAAM,CAAA,yBAAyB,CACrD,CAAE,aAAa,CAAE,GAAjB,CAAsB,mBAAmB,CAAE,CAAE,MAAM,CAAE,CAAE,GAAG,CAAE,KAAK,CAAC,eAAb,CAAV,CAA3C,CADqD,CAErD,cAFqD,CAAzD,CAKA,GAAI,iBAAiB,EAAI,iBAAiB,CAAC,MAAlB,CAA2B,CAApD,CAAuD,CAEnD,iBAAiB,CAAC,GAAlB,CACK,IAAD,EACK,IAAI,CAAC,QAAL,CAAgB,IAAI,CAAC,QAAL,CAAgB,gBAAgB,CAAC,IAAI,CAAC,QAAN,CAAgB,GAAG,CAAC,cAAJ,CAAmB,WAAnC,CAAhC,CAAkF,EAF3G,EAKA,WAAW,CAAC,gBAAZ,CAA+B,iBAA/B,CACH,CARD,IAQO,CACH,GAAG,CAAC,SAAJ,CAAc,KAAd,oGAAgH,cAAc,CAAC,cAA/H,GACH,CACJ,CAED,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,gEADkC,CAEtC,MAAM,CAA4B,0BAFI,CAGtC,KAAK,CAAE,WAH+B,CAAD,CAAzC","sourcesContent":["import { generateImageUrl } from '@msdyn365-commerce-modules/retail-actions';\nimport { Autosuggestions } from '@msdyn365-commerce/commerce-entities';\nimport {\n    CacheType, createObservableDataAction, IAction, IActionContext, IActionInput,\n    ICreateActionContext\n} from '@msdyn365-commerce/core';\nimport { SearchSuggestion, SearchSuggestionCriteria } from '@msdyn365-commerce/retail-proxy';\nimport {\n    getSearchSuggestionsAsync\n} from '@msdyn365-commerce/retail-proxy/dist/DataActions/StoreOperationsDataActions.g';\n\n// @ts-ignore\nexport const enum SuggestionType {\n    Category = 'ScopedCategory',\n    Keyword = 'Keyword',\n    Product = 'Product',\n    None = 'None'\n}\n\n/**\n * Input class for auto suggest search input\n */\nexport class AutoSuggestInput implements IActionInput {\n    public searchQuery?: string;\n    public topResultsCount?: number;\n    public suggestionType?: string;\n    public hitPrefix?: string;\n    public hitSuffix?: string;\n\n    constructor(searchText?: string, top?: number, suggestionType?: string, hitPrefix?: string, hitSuffix?: string) {\n        this.searchQuery = searchText;\n        this.topResultsCount = top;\n        this.suggestionType = suggestionType;\n        this.hitPrefix = hitPrefix;\n        this.hitSuffix = hitSuffix;\n    }\n\n    public getCacheKey = () => `AutoSuggestSearchSuggestions`;\n    public getCacheObjectType = () => 'AutoSuggestSearchSuggestions';\n    public dataCacheType = (): CacheType => 'none';\n}\n\nconst createInput = (inputData: ICreateActionContext) => {\n    return new AutoSuggestInput();\n};\n\n/**\n * Calls the Retail API and returns a auto-suggest suggestions\n */\nexport async function getSearchSuggestionsAction(input: AutoSuggestInput, ctx: IActionContext): Promise<Autosuggestions | null> {\n    // If no input is provided fail out\n    if (!input || !input.searchQuery) {\n        throw new Error('[getSearchSuggestionsAction]No valid Input was provided, failing');\n    }\n\n    const autosuggest: Autosuggestions = {};\n\n    const autoSuggestPromises = [\n        _getAutoSuggest(input, autosuggest, ctx),\n    ];\n    return Promise.all(autoSuggestPromises).then(() => {\n        return autosuggest;\n    });\n}\n\nasync function _getAutoSuggest(\n    input: AutoSuggestInput,\n    autosuggest: Autosuggestions,\n    ctx: IActionContext\n): Promise<void> {\n    const searchCriteria: SearchSuggestionCriteria = {\n        ProductSearchCriteria: {\n            SearchCondition: input.searchQuery && input.searchQuery.length > 0 ? input.searchQuery : '',\n            Context: {\n                ChannelId: +ctx.requestContext.apiSettings.channelId,\n                CatalogId: +ctx.requestContext.apiSettings.catalogId\n            }\n        },\n        HitPrefix: input.hitPrefix,\n        HitSuffix: input.hitSuffix,\n        SuggestionType: input.suggestionType\n    };\n\n    const searchSuggestions = await getSearchSuggestionsAsync(\n        { callerContext: ctx, queryResultSettings: { Paging: { Top: input.topResultsCount } } },\n        searchCriteria\n    );\n\n    if (searchSuggestions && searchSuggestions.length > 0) {\n        // Generate image url\n        searchSuggestions.map(\n            (item: SearchSuggestion) =>\n                (item.ImageUrl = item.ImageUrl ? generateImageUrl(item.ImageUrl, ctx.requestContext.apiSettings) : '')\n        );\n\n        autosuggest.AllSearchResults = searchSuggestions;\n    } else {\n        ctx.telemetry.error(`[getSearchSuggestionsAction] unable to get availabilites for search with suggestion type ${searchCriteria.SuggestionType}`);\n    }\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/search/get-auto-suggest-suggestions',\n    action: <IAction<Autosuggestions>>getSearchSuggestionsAction,\n    input: createInput\n});\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}