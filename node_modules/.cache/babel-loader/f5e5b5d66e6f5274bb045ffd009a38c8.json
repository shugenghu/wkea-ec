{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/es.promise.js\";import*as React from'react';import{Heading,Popup}from'@msdyn365-commerce-modules/utilities';import{getUrlSync}from'@msdyn365-commerce/core';import{PriceComponent}from'@msdyn365-commerce/components';import{getConfigureErrors,getGenericError}from'../utilities/error-utilities';import{BuyboxErrorBlock}from'./index';export function getBuyboxFindInStore(props,state,callbacks){var _data$product,_data$productPrice,_data$storeSelectorSt,_data$cart,_data$deliveryOptions,_props$data$product,_props$data$productPr;const{data,slots:{storeSelector},resources:{priceFree,originalPriceText,currentPriceText,findInStoreHeaderText,findInStoreDescriptionText,findInStoreLinkText,buyBoxGoToCartText,buyBoxContinueShoppingText,buyBoxSingleItemText,buyBoxMultiLineItemFormatText,buyBoxHeaderMessageText},context:{request:{channel:{PickupDeliveryModeCode}={PickupDeliveryModeCode:undefined}}}}=props;const product=data===null||data===void 0?void 0:(_data$product=data.product)===null||_data$product===void 0?void 0:_data$product.result;const price=data===null||data===void 0?void 0:(_data$productPrice=data.productPrice)===null||_data$productPrice===void 0?void 0:_data$productPrice.result;const storeSelectorStateManager=data===null||data===void 0?void 0:(_data$storeSelectorSt=data.storeSelectorStateManager)===null||_data$storeSelectorSt===void 0?void 0:_data$storeSelectorSt.result;const cart=data===null||data===void 0?void 0:(_data$cart=data.cart)===null||_data$cart===void 0?void 0:_data$cart.result;const deliveryOptions=data===null||data===void 0?void 0:(_data$deliveryOptions=data.deliveryOptions)===null||_data$deliveryOptions===void 0?void 0:_data$deliveryOptions.result;const{errorState:{configureErrors,quantityError,otherError,errorHost},modalOpen,quantity}=state;const onClick=()=>findInStoreOnClick(props,state,callbacks);if(!product||!storeSelectorStateManager||storeSelector.length===0){return undefined;}if(!deliveryOptions||!deliveryOptions.DeliveryOptions||!PickupDeliveryModeCode||!deliveryOptions.DeliveryOptions.find(option=>option.Code===PickupDeliveryModeCode)){return undefined;}const dialogStrings={goToCartText:buyBoxGoToCartText,continueShoppingText:buyBoxContinueShoppingText,headerItemOneText:buyBoxSingleItemText,headerItemFormatText:buyBoxMultiLineItemFormatText,headerMessageText:buyBoxHeaderMessageText,freePriceText:priceFree,originalPriceText:originalPriceText,currentPriceText:currentPriceText};const priceComponent=price?/*#__PURE__*/React.createElement(PriceComponent,{data:{price:price},context:props.context,id:props.id,typeName:props.typeName,freePriceText:dialogStrings.freePriceText,originalPriceText:dialogStrings.originalPriceText,currentPriceText:dialogStrings.currentPriceText}):'';const defaultImageSettings={viewports:{xs:{q:\"w=240&h=240&m=6\",w:0,h:0},lg:{q:\"w=240&h=240&m=6\",w:0,h:0},xl:{q:\"w=240&h=240&m=6\",w:0,h:0}},lazyload:true};const popupProps={context:props.context,className:'ms-buybox',id:props.id,typeName:props.typeName,data:{product:(_props$data$product=props.data.product)===null||_props$data$product===void 0?void 0:_props$data$product.result,price:(_props$data$productPr=props.data.productPrice)===null||_props$data$productPr===void 0?void 0:_props$data$productPr.result},dialogStrings:dialogStrings,imageSettings:defaultImageSettings,gridSettings:props.context.request.gridSettings,productQuantity:quantity,priceComponent:priceComponent,navigationUrl:getUrlSync('cart',props.context.actionContext),modalOpen:modalOpen,setModalOpen:callbacks.changeModalOpen};const renderModalPopup=/*#__PURE__*/React.createElement(Popup,Object.assign({},popupProps));return{ContainerProps:{className:'ms-buybox__find-in-store'},storeSelector:storeSelector[0],openFindInStoreDialog:onClick,heading:/*#__PURE__*/React.createElement(Heading,{className:'ms-buybox__find-in-store-heading',headingTag:'h4',text:findInStoreHeaderText}),description:/*#__PURE__*/React.createElement(\"p\",{className:'ms-buybox__find-in-store-description'},findInStoreDescriptionText),errors:/*#__PURE__*/React.createElement(BuyboxErrorBlock,{configureErrors:configureErrors,quantityError:quantityError,otherError:otherError,resources:props.resources,showError:errorHost==='FINDINSTORE'}),button:/*#__PURE__*/React.createElement(\"button\",{className:'ms-buybox__find-in-store-button',onClick:onClick,color:'secondary',\"aria-label\":findInStoreLinkText,disabled:cart===undefined},findInStoreLinkText),modal:renderModalPopup};}async function findInStoreOnClick(props,state,callbacks){const{data:{storeSelectorStateManager:{result:storeSelectorStateManager},cart:{result:cart},productAvailableQuantity:{result:productAvailableQuantity}},resources,context}=props;const{selectedProduct,quantity}=state;let dataProduct=props.data.product.result;if(selectedProduct){dataProduct=(await selectedProduct)||dataProduct;}if(!dataProduct||!storeSelectorStateManager){return;}const product=dataProduct;const missingDimensions=product.Dimensions&&product.Dimensions.filter(dimension=>!(dimension.DimensionValue&&dimension.DimensionValue.Value));if(missingDimensions&&missingDimensions.length>0){if(callbacks.updateErrorState){callbacks.updateErrorState({errorHost:'FINDINSTORE',configureErrors:getConfigureErrors(missingDimensions,resources)});}}else{storeSelectorStateManager.openDialog({product,onLocationSelected:orgUnitLocation=>{var _props$context,_props$context$app,_props$context$app$co;if(!cart){return Promise.resolve();}const behavior=(_props$context=props.context)===null||_props$context===void 0?void 0:(_props$context$app=_props$context.app)===null||_props$context$app===void 0?void 0:(_props$context$app$co=_props$context$app.config)===null||_props$context$app$co===void 0?void 0:_props$context$app$co.addToCartBehavior;return cart.addProductToCart({product:product,count:quantity,location:orgUnitLocation}).then(result=>{if(result.status==='FAILED'&&result.substatus==='MAXQUANTITY'){callbacks.changeModalOpen(false);const productAvailability=state.productAvailableQuantity?state.productAvailableQuantity.ProductAvailableQuantity:productAvailableQuantity&&productAvailableQuantity.length?productAvailableQuantity[0].ProductAvailableQuantity:undefined;const failureResult={failureReason:'CARTACTIONFAILED',cartActionResult:{status:result.status,substatus:result.substatus}};callbacks.updateErrorState({errorHost:'ADDTOCART',configureErrors:{},otherError:getGenericError(failureResult,cart,resources,context,product,productAvailability,orgUnitLocation)});}else{if(behavior===undefined||behavior==='goToCart'){const navigationUrl=getUrlSync('cart',context.actionContext);if(result.status==='SUCCESS'&&navigationUrl){window.location.assign(navigationUrl);}}else if(behavior==='showModal'){callbacks.updateErrorState({configureErrors:{}});callbacks.changeModalOpen(true);}}}).catch(error=>{if(props.telemetry){props.telemetry.exception(error);props.telemetry.debug('Unable to add product to cart');}return;});}}).catch(error=>{if(props.telemetry){props.telemetry.error(error.message);props.telemetry.debug('Unable to find in store');}return;});}return;}","map":{"version":3,"sources":["modules/buybox/components/buybox-find-in-store.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\n\nimport { Heading, INodeProps, IPopupProps, Popup } from '@msdyn365-commerce-modules/utilities';\nimport { getUrlSync, IImageSettings } from '@msdyn365-commerce/core';\nimport { ProductDimension } from '@msdyn365-commerce/retail-proxy';\n\nimport { IAddToCartFailureResult, PriceComponent } from '@msdyn365-commerce/components';\nimport { IBuyboxCallbacks, IBuyboxData, IBuyboxProps, IBuyboxState } from '../../../index';\nimport { getConfigureErrors, getGenericError } from '../utilities/error-utilities';\nimport { BuyboxErrorBlock } from './index';\n\nexport interface IFindInStoreFailureResult {\n    missingDimensions?: ProductDimension[];\n}\n\nexport interface IBuyboxFindInStoreViewProps {\n    storeSelector?: React.ReactNode;\n    heading?: React.ReactNode;\n    description?: React.ReactNode;\n    errors?: React.ReactNode;\n    button?: React.ReactNode;\n\n    modal?: React.ReactNode;\n\n    ContainerProps: INodeProps;\n\n    openFindInStoreDialog(): Promise<void>;\n}\n\n// tslint:disable-next-line:max-func-body-length\nexport function getBuyboxFindInStore(props: IBuyboxProps<IBuyboxData>, state: IBuyboxState, callbacks: IBuyboxCallbacks): IBuyboxFindInStoreViewProps | undefined {\n    const {\n        data,\n        slots: {\n            storeSelector\n        },\n        resources : {\n            priceFree,\n            originalPriceText,\n            currentPriceText,\n            findInStoreHeaderText,\n            findInStoreDescriptionText,\n            findInStoreLinkText,\n            buyBoxGoToCartText,\n            buyBoxContinueShoppingText,\n            buyBoxSingleItemText,\n            buyBoxMultiLineItemFormatText,\n            buyBoxHeaderMessageText\n        },\n        context: {\n            request: {\n                channel: {\n                    PickupDeliveryModeCode\n                } = { PickupDeliveryModeCode: undefined }\n            }\n        }\n    } = props;\n\n    const product = data?.product?.result;\n    const price = data?.productPrice?.result;\n    const storeSelectorStateManager = data?.storeSelectorStateManager?.result;\n    const cart = data?.cart?.result;\n    const deliveryOptions = data?.deliveryOptions?.result;\n\n    const\n    {\n        errorState: {\n            configureErrors,\n            quantityError,\n            otherError,\n            errorHost\n        },\n        modalOpen,\n        quantity\n    } = state;\n\n    const onClick = () => findInStoreOnClick(props, state, callbacks);\n\n    if (!product || !storeSelectorStateManager || storeSelector.length === 0) {\n        return undefined;\n    }\n\n    // If no delivery options present on the product, or none of the delivery options\n    // match the PickupDeliveryModeCode, that means the item cannot be used for BOPIS\n    if (!deliveryOptions ||\n        !deliveryOptions.DeliveryOptions ||\n        !PickupDeliveryModeCode ||\n        !deliveryOptions.DeliveryOptions.find(option => option.Code === PickupDeliveryModeCode)) {\n            return undefined;\n    }\n\n    const dialogStrings = {\n        goToCartText: buyBoxGoToCartText,\n        continueShoppingText: buyBoxContinueShoppingText,\n        headerItemOneText: buyBoxSingleItemText,\n        headerItemFormatText: buyBoxMultiLineItemFormatText,\n        headerMessageText: buyBoxHeaderMessageText,\n        freePriceText: priceFree,\n        originalPriceText: originalPriceText,\n        currentPriceText: currentPriceText\n    };\n\n    const priceComponent = price ? (\n        <PriceComponent\n            data={{price: price}}\n            context={props.context}\n            id={props.id}\n            typeName={props.typeName}\n            freePriceText={dialogStrings.freePriceText}\n            originalPriceText={dialogStrings.originalPriceText}\n            currentPriceText={dialogStrings.currentPriceText}\n        />) : '';\n\n    const defaultImageSettings: IImageSettings = {\n        viewports: {\n            xs: { q: `w=240&h=240&m=6`, w: 0, h: 0 },\n            lg: { q: `w=240&h=240&m=6`, w: 0, h: 0 },\n            xl: { q: `w=240&h=240&m=6`, w: 0, h: 0 }\n        },\n        lazyload: true\n    };\n\n    const popupProps: IPopupProps = {\n        context: props.context,\n        className: 'ms-buybox',\n        id: props.id,\n        typeName: props.typeName,\n        data: {product: props.data.product?.result, price: props.data.productPrice?.result},\n        dialogStrings: dialogStrings,\n        imageSettings: defaultImageSettings,\n        gridSettings: props.context.request.gridSettings,\n        productQuantity: quantity,\n        priceComponent: priceComponent,\n        navigationUrl: getUrlSync('cart', props.context.actionContext),\n        modalOpen: modalOpen,\n        setModalOpen: callbacks.changeModalOpen\n    };\n    const renderModalPopup = <Popup {...popupProps} />;\n\n    return {\n        ContainerProps: {\n            className: 'ms-buybox__find-in-store'\n        },\n\n        storeSelector: storeSelector[0],\n\n        openFindInStoreDialog: onClick,\n\n        heading: (\n            <Heading\n                className='ms-buybox__find-in-store-heading'\n                headingTag='h4'\n                text={findInStoreHeaderText}\n            />\n        ),\n\n        description: (\n            <p className='ms-buybox__find-in-store-description'>\n                {findInStoreDescriptionText}\n            </p>\n        ),\n\n        errors: (\n            <BuyboxErrorBlock\n                configureErrors={configureErrors}\n                quantityError={quantityError}\n                otherError={otherError}\n                resources={props.resources}\n                showError={errorHost === 'FINDINSTORE'}\n            />\n        ),\n\n        button: (\n            <button\n                className='ms-buybox__find-in-store-button'\n                onClick={onClick}\n                color='secondary'\n                aria-label={findInStoreLinkText}\n                disabled={cart === undefined}\n            >\n                {findInStoreLinkText}\n            </button>\n        ),\n\n        modal: renderModalPopup\n    };\n}\n\nasync function findInStoreOnClick(props: IBuyboxProps<IBuyboxData>, state: IBuyboxState, callbacks: IBuyboxCallbacks): Promise<void> {\n    const {\n        data: {\n            storeSelectorStateManager: {result: storeSelectorStateManager },\n            cart: {result: cart },\n            productAvailableQuantity: { result: productAvailableQuantity}\n        },\n        resources,\n        context\n    } = props;\n\n    const {\n        selectedProduct,\n        quantity\n    } = state;\n\n    let dataProduct = props.data.product.result;\n\n    if (selectedProduct) {\n        dataProduct = (await selectedProduct) || dataProduct;\n    }\n\n    if (!dataProduct || !storeSelectorStateManager) {\n        return;\n    }\n\n    const product = dataProduct;\n\n    const missingDimensions = product.Dimensions && product.Dimensions.filter(dimension => !(dimension.DimensionValue && dimension.DimensionValue.Value));\n\n    if (missingDimensions && missingDimensions.length > 0) {\n        if (callbacks.updateErrorState) {\n            callbacks.updateErrorState(\n                {\n                    errorHost: 'FINDINSTORE',\n                    configureErrors: getConfigureErrors(missingDimensions, resources),\n                }\n            );\n        }\n    } else {\n        storeSelectorStateManager.openDialog({\n            product,\n            onLocationSelected: orgUnitLocation => {\n                if (!cart) {\n                    return Promise.resolve();\n                }\n\n                const behavior = props.context?.app?.config?.addToCartBehavior;\n\n                return cart.addProductToCart({product: product, count: quantity, location: orgUnitLocation})\n                    .then(result => {\n                        if (result.status === 'FAILED' && result.substatus === 'MAXQUANTITY') {\n                            callbacks.changeModalOpen(false);\n\n                            const productAvailability = state.productAvailableQuantity ?\n                                state.productAvailableQuantity.ProductAvailableQuantity :\n                                    productAvailableQuantity && productAvailableQuantity.length?\n                                    productAvailableQuantity[0].ProductAvailableQuantity: undefined;\n\n                            const failureResult: IAddToCartFailureResult = {failureReason: 'CARTACTIONFAILED', cartActionResult: {status: result.status, substatus: result.substatus}};\n                            callbacks.updateErrorState({\n                                errorHost: 'ADDTOCART',\n                                configureErrors: {},\n                                otherError: getGenericError(failureResult, cart, resources, context, product, productAvailability, orgUnitLocation)\n                            });\n                        } else {\n                            if((behavior === undefined || behavior === 'goToCart')) {\n                                const navigationUrl = getUrlSync('cart', context.actionContext);\n\n                                if (result.status === 'SUCCESS' && navigationUrl) {\n                                    window.location.assign(navigationUrl);\n                                }\n                            } else if (behavior === 'showModal') {\n                                callbacks.updateErrorState({\n                                    configureErrors: {}\n                                });\n                                callbacks.changeModalOpen(true);\n                            }\n                        }\n                    }).catch((error: Error) => {\n                        if (props.telemetry) {\n                            props.telemetry.exception(error);\n                            props.telemetry.debug('Unable to add product to cart');\n                        }\n                        return;\n                    });\n                }\n        }).catch((error: Error) => {\n            if (props.telemetry) {\n                props.telemetry.error(error.message);\n                props.telemetry.debug('Unable to find in store');\n            }\n            return;\n        });\n    }\n\n    return;\n}"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}