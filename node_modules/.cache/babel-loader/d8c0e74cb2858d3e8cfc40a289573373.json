{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{BaseCollectionInput,createBaseCollectionInput}from'./base-collection-action';import{getProductRefinerHierarchy}from'./get-product-refiner-hierarchy';export class RefinersByCollectionInput extends BaseCollectionInput{constructor(){super(...arguments);this.getCacheObjectType=()=>'ProductRefiner';this.dataCacheType=()=>{if(this.pageType!=='Category'||this.refiners&&this.refiners.length>0||this.queryResultSettings&&this.queryResultSettings.Sorting&&this.queryResultSettings.Sorting.Columns&&this.queryResultSettings.Sorting.Columns.length>0){return'request';}else{return'application';}};}}const createInput=args=>{return createBaseCollectionInput(args,RefinersByCollectionInput);};async function action(input,ctx){let searchProductId;if(input.pageType==='Category'){if(input.category){return getProductRefinerHierarchy({CategoryIds:[input.category],Context:{ChannelId:input.apiSettings.channelId,CatalogId:input.apiSettings.catalogId}},input.queryResultSettings,ctx);}else{throw new Error('[GetRefinersForCollection]Category Page Detected, but no global categoryId found');}}else{if(input.searchText&&ctx.requestContext.query&&ctx.requestContext.query.q){return getProductRefinerHierarchy({SearchCondition:input.searchText,Context:{ChannelId:input.apiSettings.channelId,CatalogId:input.apiSettings.catalogId}},input.queryResultSettings,ctx);}else{if(input.searchText&&ctx.requestContext.query&&ctx.requestContext.query.productId){searchProductId=Number(input.searchText);if(Number.isNaN(searchProductId)){throw new Error('Failed to cast search product id into a number.');}else{return getProductRefinerHierarchy({Context:{ChannelId:input.apiSettings.channelId,CatalogId:input.apiSettings.catalogId},RecommendationListId:'looks',Ids:[searchProductId||0]},input.queryResultSettings,ctx);}}else{throw new Error('[GetFullProductsForCollection]Search Page Detected, but no q= or productId= query parameter found');}}}}export default createObservableDataAction({id:'@msdyn365-commerce-modules/search-result-container/get-refiners-for-collection',action:action,input:createInput});","map":{"version":3,"sources":["modules/search-result-container/actions/get-refiners-for-collection.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IProductRefinerHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { createObservableDataAction, IAction, IActionContext, IActionInput, ICreateActionContext } from '@msdyn365-commerce/core';\nimport { BaseCollectionInput, createBaseCollectionInput } from './base-collection-action';\nimport { getProductRefinerHierarchy } from './get-product-refiner-hierarchy';\n\n/**\n * Refiners-by-Collection Input action\n */\nexport class RefinersByCollectionInput extends BaseCollectionInput implements IActionInput {\n    public getCacheObjectType = () => 'ProductRefiner';\n    public dataCacheType = () => {\n        if (\n            this.pageType !== 'Category' ||\n            (this.refiners && this.refiners.length > 0) ||\n            (this.queryResultSettings && this.queryResultSettings.Sorting && this.queryResultSettings.Sorting.Columns && this.queryResultSettings.Sorting.Columns.length > 0)\n        ) {\n            return 'request';\n        } else {\n            return 'application';\n        }\n    }\n}\n\n/**\n * Create input method which creates an ActionInput for fetching list page refiners\n */\nconst createInput = (args: ICreateActionContext): IActionInput => {\n    return createBaseCollectionInput(args, RefinersByCollectionInput);\n};\n\n/**\n * Action method which fetches refiners for the given list page\n */\nasync function action(input:RefinersByCollectionInput, ctx: IActionContext): Promise<IProductRefinerHierarchy[]> {\n    let searchProductId;\n    if(input.pageType === 'Category') {\n        if(input.category) {\n            return getProductRefinerHierarchy(\n                {\n                    CategoryIds:[input.category],\n                    Context:  {\n                        ChannelId: input.apiSettings.channelId,\n                        CatalogId: input.apiSettings.catalogId\n                    }\n                },\n                input.queryResultSettings,\n                ctx);\n        } else {\n            throw new Error('[GetRefinersForCollection]Category Page Detected, but no global categoryId found');\n        }\n    } else {\n        if (input.searchText && (ctx.requestContext.query && ctx.requestContext.query.q)) {\n            return getProductRefinerHierarchy(\n                {\n                    SearchCondition: input.searchText,\n                    Context:  {\n                        ChannelId: input.apiSettings.channelId,\n                        CatalogId: input.apiSettings.catalogId\n                    }\n                },\n                input.queryResultSettings,\n                ctx);\n            } else {\n                if (input.searchText && (ctx.requestContext.query && ctx.requestContext.query.productId)) {\n                    searchProductId = Number(input.searchText);\n                    if (Number.isNaN(searchProductId)) {\n                        throw new Error('Failed to cast search product id into a number.');\n                    } else {\n                        return getProductRefinerHierarchy(\n                            {\n                                Context:  {\n                                    ChannelId: input.apiSettings.channelId,\n                                    CatalogId: input.apiSettings.catalogId\n                                },\n                                RecommendationListId: 'looks',\n                                Ids: [searchProductId || 0]\n                            },\n                            input.queryResultSettings,\n                            ctx);\n                    }\n                } else {\n                    throw new Error(\n                        '[GetFullProductsForCollection]Search Page Detected, but no q= or productId= query parameter found'\n                    );\n                }\n            }\n    }\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/search-result-container/get-refiners-for-collection',\n    action: <IAction<IProductRefinerHierarchy[]>>action,\n    input: createInput\n});"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}