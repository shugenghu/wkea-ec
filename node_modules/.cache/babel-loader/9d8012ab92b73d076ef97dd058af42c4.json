{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import classnames from'classnames';import React,{useState}from'react';import{addItemToOrderTemplate,AddItemToOrderTemplateInput,getPriceForSelectedVariant,PriceForSelectedVariantInput,updateOrderTemplateAction,UpdateOrderTemplateInput}from'@msdyn365-commerce-modules/retail-actions';import{Alert,UncontrolledTooltip}from'@msdyn365-commerce-modules/utilities';import{msdyn365Commerce}from'@msdyn365-commerce/core';import{AsyncResult}from'@msdyn365-commerce/retail-proxy';import{AddToOrderTemplateDialog}from'../add-to-order-template-dialog/add-to-order-template-dialog.component';import{DuplicateItemsWhenAddingToOrderTemplateDialog}from'../duplicate-items-when-adding-to-order-template-dialog/duplicate-items-when-adding-to-order-template-dialog.component';import{ItemAddedToOrderTemplateDialog}from'../item-added-to-order-template-dialog/item-added-to-order-template-dialog.component';var onClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_event,props,state,openModal){var user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:user=props.context.request.user;if(!state.waiting){_context.next=3;break;}return _context.abrupt(\"return\");case 3:if(!(!user.isAuthenticated&&user.signInUrl&&window)){_context.next=6;break;}window.location.assign(user.signInUrl);return _context.abrupt(\"return\");case 6:addToOrderTemplate(props,openModal);state.setWaiting(false);case 8:case\"end\":return _context.stop();}}},_callee);}));return function onClick(_x,_x2,_x3,_x4){return _ref.apply(this,arguments);};}();var onDismiss=function onDismiss(state){state.setContent({color:'success',showAlert:false});};var AddToOrderTemplateComponentActions={onClick:onClick,onDismiss:onDismiss};var hasProductInOrderTemplates=function hasProductInOrderTemplates(productToFind){return false;};var AddToOrderTemplate=function AddToOrderTemplate(props){var _props$data$customerI;if(!((_props$data$customerI=props.data.customerInformation)!==null&&_props$data$customerI!==void 0&&_props$data$customerI.IsB2b)){return null;}var _useState=useState(false),_useState2=_slicedToArray(_useState,2),waiting=_useState2[0],setWaiting=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),content=_useState4[0],setContent=_useState4[1];var state={waiting:waiting,content:content,setWaiting:setWaiting,setContent:setContent};var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),addToOrderTemplateModalOpen=_useState6[0],setAddToOrderTemplateModalOpen=_useState6[1];var _useState7=useState(undefined),_useState8=_slicedToArray(_useState7,2),chosenOrderTemplateId=_useState8[0],setChosenOrderTemplateId=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),productPrice=_useState10[0],setProductPrice=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),itemAddedToOrderTemplateDialogOpen=_useState12[0],setItemAddedToOrderTemplateDialogOpen=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),duplicateItemsWhenAddingToOrderTemplateDialogOpen=_useState14[0],setDuplicateItemsWhenAddingToOrderTemplateDialogOpen=_useState14[1];var executeAddItemToOrderTemplate=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(orderTemplate){var input;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setChosenOrderTemplateId(orderTemplate.Id);input=new AddItemToOrderTemplateInput(orderTemplate.Id,props.data.product.RecordId,props.data.quantity,props.data.product.DefaultUnitOfMeasure||'ea');_context3.next=4;return addItemToOrderTemplate(input,props.context.actionContext).then(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(result){var retrievedProductPrice;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getPriceForSelectedVariant(new PriceForSelectedVariantInput(props.data.product.RecordId,props.context.actionContext.requestContext.apiSettings.channelId,props.data.product),props.context.actionContext);case 2:retrievedProductPrice=_context2.sent;setProductPrice(retrievedProductPrice);setAddToOrderTemplateModalOpen(false);setTimeout(function(){setItemAddedToOrderTemplateDialogOpen(true);},500);case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x6){return _ref3.apply(this,arguments);};}())[\"catch\"](function(result){var _result$error;if(((_result$error=result.error)===null||_result$error===void 0?void 0:_result$error.name)!=='Microsoft_Dynamics_Commerce_Runtime_DuplicateObject'){return AsyncResult.reject(result);}setAddToOrderTemplateModalOpen(false);setTimeout(function(){setDuplicateItemsWhenAddingToOrderTemplateDialogOpen(true);},500);return AsyncResult.resolve();});case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function executeAddItemToOrderTemplate(_x5){return _ref2.apply(this,arguments);};}();var onDuplicateDialogCancel=function onDuplicateDialogCancel(){setDuplicateItemsWhenAddingToOrderTemplateDialogOpen(false);setTimeout(function(){setAddToOrderTemplateModalOpen(true);},500);};var overrideQuantity=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var input,retrievedProductPrice;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:input=new UpdateOrderTemplateInput(chosenOrderTemplateId,props.data.product.RecordId,props.data.quantity,props.data.product.DefaultUnitOfMeasure||'ea');_context4.next=3;return updateOrderTemplateAction(input,props.context.actionContext);case 3:_context4.next=5;return getPriceForSelectedVariant(new PriceForSelectedVariantInput(props.data.product.RecordId,props.context.actionContext.requestContext.apiSettings.channelId,props.data.product),props.context.actionContext);case 5:retrievedProductPrice=_context4.sent;setProductPrice(retrievedProductPrice);setDuplicateItemsWhenAddingToOrderTemplateDialogOpen(false);setTimeout(function(){setItemAddedToOrderTemplateDialogOpen(true);},500);case 9:case\"end\":return _context4.stop();}}},_callee4);}));return function overrideQuantity(){return _ref4.apply(this,arguments);};}();var addToOrderTemplateButtonText=props.addToOrderTemplateButtonText,showStatusMessage=props.showStatusMessage,showButtonText=props.showButtonText,className=props.className,disabled=props.disabled,showButtonTooltip=props.showButtonTooltip,tooltipPosition=props.tooltipPosition,addToOrderTemplateDialogResources=props.addToOrderTemplateDialogResources,createOrderTemplateDialogResources=props.createOrderTemplateDialogResources;var onDismissHandler=function onDismissHandler(){return AddToOrderTemplateComponentActions.onDismiss(state);};var ariaLabel=addToOrderTemplateButtonText;var addToOrderTemplateRef=/*#__PURE__*/React.createRef();var showMessage=showStatusMessage!==undefined?showStatusMessage:true;var showTooltip=showButtonTooltip!==undefined?showButtonTooltip:true;var tooltipPos=showButtonTooltip!==undefined?tooltipPosition:'top-end';var dialogData={orderTemplates:props.data.orderTemplates};var onClickHandler=function onClickHandler(event){return AddToOrderTemplateComponentActions.onClick(event,props,state,setAddToOrderTemplateModalOpen);};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"button\",{className:classnames(className,hasProductInOrderTemplates(props.data.product)?'msc-add-to-order-template-icon__added':'msc-add-to-order-template-icon',state.waiting?'msc-add-to-order-template-icon__waiting':''),\"aria-label\":ariaLabel,onClick:onClickHandler,disabled:disabled,ref:addToOrderTemplateRef},showButtonText?ariaLabel:''),showTooltip&&/*#__PURE__*/React.createElement(UncontrolledTooltip,{placement:tooltipPos,trigger:'hover focus',target:addToOrderTemplateRef},ariaLabel)),state.content.showAlert&&showMessage?/*#__PURE__*/React.createElement(\"div\",{className:'ms-order-template-items__product-status'},/*#__PURE__*/React.createElement(Alert,{color:state.content.color,isOpen:state.content.showAlert,toggle:onDismissHandler},state.content.orderTemplateTextMessage)):'',/*#__PURE__*/React.createElement(AddToOrderTemplateDialog,{className:'msc-add-to-order-template-dialog',modalOpen:addToOrderTemplateModalOpen,setModalOpen:setAddToOrderTemplateModalOpen,context:props.context,id:props.id,typeName:props.typeName,data:dialogData,addToOrderTemplateDialogResources:addToOrderTemplateDialogResources,createOrderTemplateDialogResources:createOrderTemplateDialogResources,onOrderTemplateSelected:executeAddItemToOrderTemplate}),chosenOrderTemplateId&&productPrice&&/*#__PURE__*/React.createElement(ItemAddedToOrderTemplateDialog,{className:'msc-item-added-to-order-template-dialog',id:props.id,typeName:props.typeName,context:props.context,dialogStrings:props.itemAddedToOrderTemplateDialogResources,data:{product:props.data.product,quantity:props.data.quantity,orderTemplateId:chosenOrderTemplateId,productPrice:productPrice},modalOpen:itemAddedToOrderTemplateDialogOpen}),/*#__PURE__*/React.createElement(DuplicateItemsWhenAddingToOrderTemplateDialog,{className:'msc-duplicate-items-when-adding-to-order-template-dialog',id:props.id,typeName:props.typeName,context:props.context,dialogStrings:props.duplicateItemsWhenAddingToOrderTemplateDialogResources,data:{},modalOpen:duplicateItemsWhenAddingToOrderTemplateDialogOpen,executeOverrideQuantity:overrideQuantity,onCancel:onDuplicateDialogCancel}));};var addToOrderTemplate=function addToOrderTemplate(props,openModal){var canAddMasterProduct=props.canAddMasterProduct;if(props.data.product.Dimensions&&!canAddMasterProduct){var missingDimensions=props.data.product.Dimensions.filter(function(dimension){return!(dimension.DimensionValue&&dimension.DimensionValue.Value);});if(missingDimensions.length>0){propagateError(props,{status:'MISSING_DIMENSION',missingDimensions:missingDimensions});return;}}openModal(true);return;};var propagateError=function propagateError(props,result){var onError=props.onError;if(onError){onError(result);}};export var AddToOrderTemplateComponent=msdyn365Commerce.createComponent('AddToOrderTemplate',_objectSpread({component:AddToOrderTemplate},AddToOrderTemplateComponentActions));","map":{"version":3,"sources":["order-template/add-to-order-template/add-to-order-template.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import classnames from 'classnames';\nimport * as Popper from 'popper.js';\nimport React, { useState } from 'react';\n\nimport {\n    addItemToOrderTemplate, AddItemToOrderTemplateInput,\n    getPriceForSelectedVariant, PriceForSelectedVariantInput,\n    updateOrderTemplateAction, UpdateOrderTemplateInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { OrderTemplate } from '@msdyn365-commerce-modules/retail-actions';\nimport { Alert, UncontrolledTooltip } from '@msdyn365-commerce-modules/utilities';\nimport { IComponent, IComponentProps, msdyn365Commerce } from '@msdyn365-commerce/core';\nimport { AsyncResult, Customer, ProductDimension, ProductList, ProductPrice, SimpleProduct } from '@msdyn365-commerce/retail-proxy';\nimport { AddToOrderTemplateDialog, IAddToOrderTemplateDialogData, IAddToOrderTemplateDialogResources } from '../add-to-order-template-dialog/add-to-order-template-dialog.component';\nimport { DuplicateItemsWhenAddingToOrderTemplateDialog, IDuplicateItemsWhenAddingToOrderTemplateDialogResources } from '../duplicate-items-when-adding-to-order-template-dialog/duplicate-items-when-adding-to-order-template-dialog.component';\nimport { IItemAddedToOrderTemplateDialogResources, ItemAddedToOrderTemplateDialog } from '../item-added-to-order-template-dialog/item-added-to-order-template-dialog.component';\nimport { IOrderTemplateNameDialogResources } from '../order-template-name-dialog/order-template-name-dialog.component';\n\nexport interface IAddToOrderTemplateComponentProps extends IComponentProps<IAddToOrderTemplateData> {\n    className?: string;\n\n    addToOrderTemplateDialogResources: IAddToOrderTemplateDialogResources;\n    createOrderTemplateDialogResources: IOrderTemplateNameDialogResources;\n    itemAddedToOrderTemplateDialogResources: IItemAddedToOrderTemplateDialogResources;\n    duplicateItemsWhenAddingToOrderTemplateDialogResources: IDuplicateItemsWhenAddingToOrderTemplateDialogResources;\n\n    addToOrderTemplateButtonText: string;\n\n    addToOrderTemplateMessage?: string;\n    addItemToOrderTemplateError?: string;\n\n    showButtonText?: boolean;\n    showButtonTooltip?: boolean;\n    tooltipPosition?: Popper.Placement;\n    showStatusMessage?: boolean;\n    disabled?: boolean;\n    canAddMasterProduct?: boolean;\n\n    onSuccess?(): void;\n    onError?(result: IOrderTemplateActionErrorResult): void;\n}\n\nexport interface IOrderTemplateActionErrorResult {\n    status: 'FAILED' | 'MISSING_DIMENSION';\n\n    missingDimensions?: ProductDimension[];\n}\n\ninterface IAddToOrderTemplateStateManager {\n    waiting: boolean;\n    content: IAddToOrderTemplateContentState;\n\n    setWaiting(newWaiting: boolean): void;\n    setContent(newContent: IAddToOrderTemplateContentState): void;\n}\n\ninterface IAddToOrderTemplateContentState {\n    showAlert?: boolean;\n    orderTemplateTextMessage?: string;\n    color?: string;\n}\n\ninterface IAddToOrderTemplateData {\n    orderTemplates: OrderTemplate[];\n\n    product: SimpleProduct;\n    quantity: number;\n\n    customerInformation?: Customer;\n}\n\nexport interface IAddToOrderTemplateComponent extends IComponent<IAddToOrderTemplateComponentProps> {\n    onClick(): (event: React.MouseEvent<HTMLElement>, props: IAddToOrderTemplateComponentProps, state: IAddToOrderTemplateStateManager) => void;\n}\n\nconst onClick = async (\n    _event: React.MouseEvent<HTMLElement>,\n    props: IAddToOrderTemplateComponentProps,\n    state: IAddToOrderTemplateStateManager,\n    openModal: (opened: boolean) => void): Promise<void> => {\n\n    const { user } = props.context.request;\n\n    if (state.waiting) {\n        return;\n    }\n\n    if (!user.isAuthenticated && user.signInUrl && window) {\n        window.location.assign(user.signInUrl);\n        return;\n    }\n\n    addToOrderTemplate(props, openModal);\n    state.setWaiting(false);\n};\n\nconst onDismiss = (state: IAddToOrderTemplateStateManager): void => {\n    state.setContent({ color: 'success', showAlert: false });\n};\n\nconst AddToOrderTemplateComponentActions = {\n    onClick: onClick,\n    onDismiss: onDismiss\n};\n\nconst hasProductInOrderTemplates = (productToFind: SimpleProduct) => {\n    /*\n    TODO: Currently API does not support filtering by products.\n    await getProductListLinesAsync(context, '',)\n    return orderTemplates.filter(orderTemplate =>\n        orderTemplate.orderTemplateLines.filter(\n            product => product.productListLine.ProductId === productToFind.RecordId).length !== 0).length !== 0;\n    */\n   return false;\n};\n\n// tslint:disable-next-line:max-func-body-length\nconst AddToOrderTemplate: React.FC<IAddToOrderTemplateComponentProps> = (props: IAddToOrderTemplateComponentProps) => {\n    if (!props.data.customerInformation?.IsB2b) {\n        return null;\n    }\n\n    const [waiting, setWaiting] = useState(false);\n    const [content, setContent] = useState({});\n    const state: IAddToOrderTemplateStateManager = {\n        waiting,\n        content,\n\n        setWaiting,\n        setContent\n    };\n\n    const [addToOrderTemplateModalOpen, setAddToOrderTemplateModalOpen] = useState(false);\n\n    const [chosenOrderTemplateId, setChosenOrderTemplateId] = useState<string | undefined>(undefined);\n    const [productPrice, setProductPrice] = useState<ProductPrice | null>(null);\n    const [itemAddedToOrderTemplateDialogOpen, setItemAddedToOrderTemplateDialogOpen] = useState(false);\n    const [duplicateItemsWhenAddingToOrderTemplateDialogOpen, setDuplicateItemsWhenAddingToOrderTemplateDialogOpen] = useState(false);\n\n    const executeAddItemToOrderTemplate = async (orderTemplate: ProductList) => {\n        setChosenOrderTemplateId(orderTemplate.Id);\n\n        const input = new AddItemToOrderTemplateInput(\n            orderTemplate.Id,\n            props.data.product.RecordId,\n            props.data.quantity,\n            props.data.product.DefaultUnitOfMeasure || 'ea');\n\n        await addItemToOrderTemplate(input, props.context.actionContext).then(async result => {\n            const retrievedProductPrice = await getPriceForSelectedVariant(\n                new PriceForSelectedVariantInput(\n                    props.data.product.RecordId,\n                    props.context.actionContext.requestContext.apiSettings.channelId,\n                    props.data.product),\n                props.context.actionContext);\n            setProductPrice(retrievedProductPrice);\n            setAddToOrderTemplateModalOpen(false);\n            setTimeout(() => {\n                setItemAddedToOrderTemplateDialogOpen(true);\n            }, 500); // tslint:disable-line:align\n        }).catch(result => {\n            if (result.error?.name !== 'Microsoft_Dynamics_Commerce_Runtime_DuplicateObject') {\n                return AsyncResult.reject(result);\n            }\n            setAddToOrderTemplateModalOpen(false);\n            setTimeout(() => {\n                setDuplicateItemsWhenAddingToOrderTemplateDialogOpen(true);\n            }, 500); // tslint:disable-line:align\n            return AsyncResult.resolve();\n        });\n    };\n\n    const onDuplicateDialogCancel = () => {\n        setDuplicateItemsWhenAddingToOrderTemplateDialogOpen(false);\n        setTimeout(() => {\n            setAddToOrderTemplateModalOpen(true);\n        }, 500); // tslint:disable-line:align\n    };\n\n    const overrideQuantity = async () => {\n        const input = new UpdateOrderTemplateInput(\n            chosenOrderTemplateId!,\n            props.data.product.RecordId,\n            props.data.quantity,\n            props.data.product.DefaultUnitOfMeasure || 'ea');\n        await updateOrderTemplateAction(input, props.context.actionContext);\n\n        const retrievedProductPrice = await getPriceForSelectedVariant(\n            new PriceForSelectedVariantInput(\n                props.data.product.RecordId,\n                props.context.actionContext.requestContext.apiSettings.channelId,\n                props.data.product),\n            props.context.actionContext);\n        setProductPrice(retrievedProductPrice);\n        setDuplicateItemsWhenAddingToOrderTemplateDialogOpen(false);\n        setTimeout(() => {\n            setItemAddedToOrderTemplateDialogOpen(true);\n        }, 500); // tslint:disable-line:align\n    };\n\n    const { addToOrderTemplateButtonText, showStatusMessage, showButtonText,\n        className, disabled, showButtonTooltip, tooltipPosition,\n        addToOrderTemplateDialogResources, createOrderTemplateDialogResources\n    } = props;\n\n    const onDismissHandler = () => { return AddToOrderTemplateComponentActions.onDismiss(state); };\n    const ariaLabel = addToOrderTemplateButtonText;\n    const addToOrderTemplateRef: React.RefObject<HTMLButtonElement> = React.createRef();\n    const showMessage = showStatusMessage !== undefined ? showStatusMessage: true;\n    const showTooltip = showButtonTooltip !== undefined ? showButtonTooltip: true;\n    const tooltipPos = showButtonTooltip !== undefined ? tooltipPosition: 'top-end';\n\n    const dialogData: IAddToOrderTemplateDialogData = {\n        orderTemplates: props.data.orderTemplates\n    };\n\n    const onClickHandler = (event: React.MouseEvent<HTMLElement>) => { return AddToOrderTemplateComponentActions.onClick(event, props, state, setAddToOrderTemplateModalOpen); };\n\n    return (\n        <React.Fragment>\n            {\n                <>\n                    <button\n                        className={classnames(\n                            className,\n                            hasProductInOrderTemplates(props.data.product) ? 'msc-add-to-order-template-icon__added' : 'msc-add-to-order-template-icon' ,\n                            state.waiting ? 'msc-add-to-order-template-icon__waiting' : '')}\n                        aria-label={ariaLabel}\n                        onClick={onClickHandler}\n                        disabled={disabled}\n                        ref={addToOrderTemplateRef}\n                    >\n                        {showButtonText ? ariaLabel : ''}\n                    </button>\n                    {\n                        showTooltip && <UncontrolledTooltip placement={tooltipPos} trigger={'hover focus'} target={addToOrderTemplateRef}>{ariaLabel}</UncontrolledTooltip>\n                    }\n                </>\n            }\n            {\n                state.content.showAlert && showMessage ?\n                <div className='ms-order-template-items__product-status'>\n                    <Alert color={ state.content.color } isOpen={ state.content.showAlert } toggle={ onDismissHandler }>\n                        { state.content.orderTemplateTextMessage }\n                    </Alert>\n                </div> :\n                ''\n            }\n            <AddToOrderTemplateDialog\n                className={'msc-add-to-order-template-dialog'}\n                modalOpen={addToOrderTemplateModalOpen}\n                setModalOpen={setAddToOrderTemplateModalOpen}\n                context={props.context}\n                id={props.id}\n                typeName={props.typeName}\n                data={dialogData}\n                addToOrderTemplateDialogResources={addToOrderTemplateDialogResources}\n                createOrderTemplateDialogResources={createOrderTemplateDialogResources}\n                onOrderTemplateSelected={executeAddItemToOrderTemplate}\n            />\n            {\n                chosenOrderTemplateId && productPrice && <ItemAddedToOrderTemplateDialog\n                    className={'msc-item-added-to-order-template-dialog'}\n                    id={props.id}\n                    typeName={props.typeName}\n                    context={props.context}\n                    dialogStrings={props.itemAddedToOrderTemplateDialogResources}\n                    data={{\n                        product: props.data.product,\n                        quantity: props.data.quantity,\n                        orderTemplateId: chosenOrderTemplateId,\n                        productPrice: productPrice\n                    }}\n                    modalOpen={itemAddedToOrderTemplateDialogOpen}\n                />\n            }\n            <DuplicateItemsWhenAddingToOrderTemplateDialog\n                className={'msc-duplicate-items-when-adding-to-order-template-dialog'}\n                id={props.id}\n                typeName={props.typeName}\n                context={props.context}\n                dialogStrings={props.duplicateItemsWhenAddingToOrderTemplateDialogResources}\n                data={{}}\n                modalOpen={duplicateItemsWhenAddingToOrderTemplateDialogOpen}\n                executeOverrideQuantity={overrideQuantity}\n                onCancel={onDuplicateDialogCancel}\n            />\n        </React.Fragment>\n    );\n};\n\nconst addToOrderTemplate = (\n    props: IAddToOrderTemplateComponentProps,\n    openModal: (opened: boolean) => void): void => {\n    const { canAddMasterProduct } = props;\n\n    if (props.data.product.Dimensions && !canAddMasterProduct) {\n        const missingDimensions = props.data.product.Dimensions.filter(dimension => !(dimension.DimensionValue && dimension.DimensionValue.Value));\n\n        if (missingDimensions.length > 0) {\n            // At least one dimension with no value exists on the product, won't be able to proceed.\n            propagateError(props, { status: 'MISSING_DIMENSION', missingDimensions: missingDimensions });\n            return;\n        }\n    }\n\n    openModal(true);\n    return;\n};\n\nconst propagateError = (props: IAddToOrderTemplateComponentProps, result: IOrderTemplateActionErrorResult): void => {\n    const { onError } = props;\n\n    if (onError) {\n        onError(result);\n    }\n};\n\n// @ts-ignore\nexport const AddToOrderTemplateComponent: React.FunctionComponent<IAddToOrderTemplateComponentProps> = msdyn365Commerce.createComponent<IAddToOrderTemplateComponent>(\n    'AddToOrderTemplate',\n    { component: AddToOrderTemplate, ...AddToOrderTemplateComponentActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}