{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import{Button,getTelemetryObject}from'@msdyn365-commerce-modules/utilities';import*as Msdyn365 from'@msdyn365-commerce/core';import classname from'classnames';import get from'lodash/get';import{computed}from'mobx';import*as React from'react';import{getGroups}from'../../common/get-groups';import{getOrderInfomationInput,getOrderInformation}from'../../common/get-order-information';import{getSalesLines,getSalesLinesInput}from'../../common/get-sales-lines';import LabelComponent from'../../common/label';import{getTenderIdOperationIdMap}from'../../common/utilities';import{getOrderDetailsHelp}from'./components/get-help';import{getOrderDetailsOrderSummary}from'./components/get-order-summary';import{getOrderDetailsPaymentMethods}from'./components/get-payment-methods';export*from'../../common/get-groups';export*from'../../common/get-order-information';export*from'../../common/get-sales-line';export*from'../../common/get-sales-lines';export*from'../../common/utilities';export*from'./components/get-help';export*from'./components/get-order-summary';export*from'./components/get-payment-methods';class OrderDetails extends React.PureComponent{constructor(props){super(props);this.moduleName='ms-order-details';this.handleOrderDetailsHeadingChange=event=>this.props.config.heading.text=event.target.value;this.telemetryContent=getTelemetryObject(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);}get isCurrentChannel(){if(!this.order){return false;}return this.order.ChannelId===get(this.props,'context.request.apiSettings.channelId');}get isDataReady(){return get(this.props,'data.orderHydration.status')==='SUCCESS';}get hasError(){return get(this.props,'data.orderHydration.status')==='FAILED';}get order(){return get(this.props,'data.orderHydration.result.salesOrder');}get products(){return get(this.props,'data.orderHydration.result.products')||[];}get priceContext(){const{id,typeName,context,telemetry,resources:{freePriceText}}=this.props;return{id,typeName,context,telemetry,freePriceText};}get earnedPoints(){const loyaltyCard=this.props.data.loyaltyCard.result;if(loyaltyCard&&loyaltyCard.RewardPoints&&this.order){const pointPrograms=loyaltyCard.RewardPoints.map(point=>point.RewardPointId);const rewardLines=this.order.LoyaltyRewardPointLines||[];let total=0;rewardLines.forEach(line=>{if((line.RewardPointAmountQuantity||0)>0&&pointPrograms.indexOf(line.RewardPointId)>-1){total+=line.RewardPointAmountQuantity;}});return total;}return 0;}get orderSummaryProps(){var _this$order;if(!this.order){return;}const{request}=this.props.context;const pickupDeliveryModeCode=request&&request.channel&&request.channel.PickupDeliveryModeCode;const orderDetailsLines=(_this$order=this.order)===null||_this$order===void 0?void 0:_this$order.SalesLines;const canShip=orderDetailsLines===null||orderDetailsLines===void 0?void 0:orderDetailsLines.some(orderDetailsLine=>orderDetailsLine.DeliveryMode&&orderDetailsLine.DeliveryMode!==''?orderDetailsLine.DeliveryMode!==pickupDeliveryModeCode:orderDetailsLine);const{resources:{orderSummaryHeading,orderSummaryItemsTotalLabel,orderSummaryShippingFeeLabel,orderSummaryTaxLabel,orderSummaryGrandTotalLabel,pointsEarnedLabel}}=this.props;return{order:this.order,earnedPoints:this.earnedPoints,priceContext:this.priceContext,resource:{orderSummaryHeading,orderSummaryItemsTotalLabel,orderSummaryShippingFeeLabel,orderSummaryTaxLabel,pointsEarnedLabel,orderSummaryGrandTotalLabel},canShip:canShip};}get paymentMethodsProps(){const tenderTypes=this.props.data.tenderTypes.result;if(!this.order||!this.order.TenderLines||!tenderTypes){return;}const locale=get(this.props,'context.request.locale')||'en-US';const{resources:{paymentMethodsTitle,creditCardEndingLabel,giftCardEndingLabel,amountCoveredLabel,cashUsedLabel,loyaltyCardUsedLabel,customerAccountUsedLabel}}=this.props;return{priceContext:this.priceContext,tenderLines:this.order.TenderLines,tenderIdOperationIdMap:getTenderIdOperationIdMap(tenderTypes),locale,resource:{paymentMethodsTitle,creditCardEndingLabel,giftCardEndingLabel,amountCoveredLabel,cashUsedLabel,loyaltyCardUsedLabel,customerAccountUsedLabel}};}render(){const{resources:{noSalesOrderDetailsText,genericErrorMessage,needHelpLabel,helpLineNumberLabel,loadingLabel,backToShopping,orderItemLabel,orderItemsLabel,helpLineContactAriaLabel},config:{heading,contactNumber,showChannelInfo}}=this.props;const showAddress=this.props.config.addressOptions!==undefined&&this.props.config.addressOptions===\"showAddressWithSingleLine\"||this.props.config.addressOptions===\"showAddressWithMultiplelines\";const showFullAddress=this.props.config.addressOptions!==undefined&&this.props.config.addressOptions===\"showAddressWithMultiplelines\";const moduleProps={moduleProps:this.props,className:classname('ms-order-details',this.props.config.className)};const backToShoppingUrl=Msdyn365.getUrlSync('home',this.props.context.actionContext)||'';const channelIdentities=this.props.data.channels.result&&this.props.data.channels.result.channelIdentities;const orgUnitLocations=this.props.data.orgUnitLocations.result&&this.props.data.orgUnitLocations.result.orgUnitLocations;let viewProps=_objectSpread(_objectSpread({},this.props),{},{moduleProps,heading:heading&&/*#__PURE__*/React.createElement(Msdyn365.Text,Object.assign({},heading,{className:'ms-order-details__heading',text:heading.text,tag:heading.tag||'h2',editProps:{onEdit:this.handleOrderDetailsHeadingChange,requestContext:this.props.context.request}})),backToShoppingLink:backToShoppingUrl&&/*#__PURE__*/React.createElement(Button,{className:'ms-order-details__btn-keep-shopping',href:backToShoppingUrl},backToShopping),footerProps:{className:'ms-order-details__footer'}});if(this.hasError){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-details__alert',label:genericErrorMessage})});return this.props.renderView(viewProps);}if(!this.isDataReady){viewProps=_objectSpread(_objectSpread({},viewProps),{},{loading:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-details__loading',label:loadingLabel})});return this.props.renderView(viewProps);}if(!this.order){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-details__alert',label:noSalesOrderDetailsText})});return this.props.renderView(viewProps);}const salesLinesInput=getSalesLinesInput(this.props,this.moduleName,this.order,this.products,this.priceContext,showFullAddress,this.telemetryContent);const salesLines=salesLinesInput&&getSalesLines(salesLinesInput);const orderInfomationInput=this.order&&getOrderInfomationInput(this.props,this.moduleName,this.order,this.priceContext,channelIdentities,orgUnitLocations,showChannelInfo);const orderInfomation=orderInfomationInput&&getOrderInformation(orderInfomationInput);viewProps=_objectSpread(_objectSpread({},viewProps),{},{salesOrder:this.order,orderInfomation,salesLines,groups:salesLines?getGroups({moduleName:this.moduleName,salesLines,resources:{orderItemLabel,orderItemsLabel},showAddress}):undefined,orderSummary:this.orderSummaryProps?getOrderDetailsOrderSummary(this.orderSummaryProps):undefined,payment:this.paymentMethodsProps?getOrderDetailsPaymentMethods(this.paymentMethodsProps):undefined,help:contactNumber?getOrderDetailsHelp({needHelpLabel,helpLineNumberLabel,contactNumber,helpLineContactAriaLabel,telemetryContent:this.telemetryContent}):undefined});return this.props.renderView(viewProps);}}__decorate([computed],OrderDetails.prototype,\"isCurrentChannel\",null);__decorate([computed],OrderDetails.prototype,\"isDataReady\",null);__decorate([computed],OrderDetails.prototype,\"hasError\",null);__decorate([computed],OrderDetails.prototype,\"order\",null);__decorate([computed],OrderDetails.prototype,\"products\",null);__decorate([computed],OrderDetails.prototype,\"priceContext\",null);__decorate([computed],OrderDetails.prototype,\"earnedPoints\",null);__decorate([computed],OrderDetails.prototype,\"orderSummaryProps\",null);__decorate([computed],OrderDetails.prototype,\"paymentMethodsProps\",null);export default OrderDetails;","map":{"version":3,"sources":["modules/order-details/order-details.tsx"],"names":[],"mappings":"q+BAIA,OAAS,MAAT,CAAiB,kBAAjB,KAAwF,sCAAxF,CACA,MAAO,GAAK,CAAA,QAAZ,KAA0B,yBAA1B,CAEA,MAAO,CAAA,SAAP,KAAsB,YAAtB,CACA,MAAO,CAAA,GAAP,KAAgB,YAAhB,CACA,OAAS,QAAT,KAAyB,MAAzB,CACA,MAAO,GAAK,CAAA,KAAZ,KAAuB,OAAvB,CAEA,OAAS,SAAT,KAAmC,yBAAnC,CACA,OAAS,uBAAT,CAAkC,mBAAlC,KAAgF,oCAAhF,CAEA,OAAS,aAAT,CAAwB,kBAAxB,KAAkD,8BAAlD,CACA,MAAO,CAAA,cAAP,KAA2B,oBAA3B,CACA,OAAS,yBAAT,KAAyD,wBAAzD,CAEA,OAAS,mBAAT,KAAoC,uBAApC,CACA,OAAS,2BAAT,KAA4C,gCAA5C,CACA,OAAS,6BAAT,KAA8C,kCAA9C,CAGA,WAAc,yBAAd,CACA,WAAc,oCAAd,CACA,WAAc,6BAAd,CACA,WAAc,8BAAd,CACA,WAAc,wBAAd,CACA,WAAc,uBAAd,CACA,WAAc,gCAAd,CACA,WAAc,kCAAd,CAuBA,KAAM,CAAA,YAAN,QAA2B,CAAA,KAAK,CAAC,aAAoD,CA6HjF,WAAA,CAAY,KAAZ,CAAwD,CACpD,MAAM,KAAN,EA7HI,KAAA,UAAA,CAAqB,kBAArB,CA+ND,KAAA,+BAAA,CAAmC,KAAD,EAA0C,KAAK,KAAL,CAAW,MAAX,CAAkB,OAAlB,CAA2B,IAA3B,CAAkC,KAAK,CAAC,MAAN,CAAa,KAA3H,CAjGH,KAAK,gBAAL,CAAwB,kBAAkB,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,iBAA5B,CAAgD,KAAK,KAAL,CAAW,YAA3D,CAAyE,KAAK,KAAL,CAAW,SAApF,CAA1C,CACH,CA5HS,GAAI,CAAA,gBAAJ,EAAoB,CAC1B,GAAI,CAAC,KAAK,KAAV,CAAiB,CACb,MAAO,MAAP,CACH,CACD,MAAO,MAAK,KAAL,CAAW,SAAX,GAAyB,GAAG,CAAC,KAAK,KAAN,CAAa,uCAAb,CAAnC,CACH,CAES,GAAI,CAAA,WAAJ,EAAe,CACrB,MAAO,CAAA,GAAG,CAAC,KAAK,KAAN,CAAa,4BAAb,CAAH,GAAkD,SAAzD,CACH,CAES,GAAI,CAAA,QAAJ,EAAY,CAClB,MAAO,CAAA,GAAG,CAAC,KAAK,KAAN,CAAa,4BAAb,CAAH,GAAkD,QAAzD,CACH,CAES,GAAI,CAAA,KAAJ,EAAS,CACf,MAAO,CAAA,GAAG,CAAC,KAAK,KAAN,CAAa,uCAAb,CAAV,CACH,CAES,GAAI,CAAA,QAAJ,EAAY,CAClB,MAAO,CAAA,GAAG,CAAC,KAAK,KAAN,CAAa,qCAAb,CAAH,EAA0D,EAAjE,CACH,CAES,GAAI,CAAA,YAAJ,EAAgB,CACtB,KAAM,CACF,EADE,CAEF,QAFE,CAGF,OAHE,CAIF,SAJE,CAKF,SAAS,CAAE,CAAE,aAAF,CALT,EAMF,KAAK,KANT,CAOA,MAAO,CACH,EADG,CAEH,QAFG,CAGH,OAHG,CAIH,SAJG,CAKH,aALG,CAAP,CAOH,CAES,GAAI,CAAA,YAAJ,EAAgB,CACtB,KAAM,CAAA,WAAW,CAAG,KAAK,KAAL,CAAW,IAAX,CAAgB,WAAhB,CAA4B,MAAhD,CACA,GAAI,WAAW,EAAI,WAAW,CAAC,YAA3B,EAA2C,KAAK,KAApD,CAA2D,CACvD,KAAM,CAAA,aAAa,CAAG,WAAW,CAAC,YAAZ,CAAyB,GAAzB,CAA6B,KAAK,EAAI,KAAK,CAAC,aAA5C,CAAtB,CACA,KAAM,CAAA,WAAW,CAAG,KAAK,KAAL,CAAW,uBAAX,EAAsC,EAA1D,CACA,GAAI,CAAA,KAAK,CAAG,CAAZ,CACA,WAAW,CAAC,OAAZ,CAAoB,IAAI,EAAG,CACvB,GAAI,CAAC,IAAI,CAAC,yBAAL,EAAkC,CAAnC,EAAwC,CAAxC,EAA6C,aAAa,CAAC,OAAd,CAAsB,IAAI,CAAC,aAA3B,EAA4C,CAAC,CAA9F,CAAiG,CAC7F,KAAK,EAAI,IAAI,CAAC,yBAAd,CACH,CACJ,CAJD,EAKA,MAAO,CAAA,KAAP,CACH,CACD,MAAO,EAAP,CACH,CAES,GAAI,CAAA,iBAAJ,EAAqB,iBAC3B,GAAI,CAAC,KAAK,KAAV,CAAiB,CACb,OACH,CACD,KAAM,CAAE,OAAF,EAAc,KAAK,KAAL,CAAW,OAA/B,CACA,KAAM,CAAA,sBAAsB,CAAG,OAAO,EAAI,OAAO,CAAC,OAAnB,EAA8B,OAAO,CAAC,OAAR,CAAgB,sBAA7E,CACA,KAAM,CAAA,iBAAiB,cAAI,KAAK,KAAT,sCAAI,YAAY,UAAvC,CACA,KAAM,CAAA,OAAO,CAAG,iBAAH,SAAG,iBAAH,iBAAG,iBAAiB,CAAE,IAAnB,CAAwB,gBAAgB,EAAK,gBAAgB,CAAC,YAAjB,EAAiC,gBAAgB,CAAC,YAAjB,GAAkC,EAApE,CAA0E,gBAAgB,CAAC,YAAjB,GAAkC,sBAA5G,CAAqI,gBAAjL,CAAhB,CAEA,KAAM,CACF,SAAS,CAAE,CAAE,mBAAF,CAAuB,2BAAvB,CAAoD,4BAApD,CAAkF,oBAAlF,CAAwG,2BAAxG,CAAqI,iBAArI,CADT,EAEF,KAAK,KAFT,CAGA,MAAO,CACH,KAAK,CAAE,KAAK,KADT,CAEH,YAAY,CAAE,KAAK,YAFhB,CAGH,YAAY,CAAE,KAAK,YAHhB,CAIH,QAAQ,CAAE,CACN,mBADM,CAEN,2BAFM,CAGN,4BAHM,CAIN,oBAJM,CAKN,iBALM,CAMN,2BANM,CAJP,CAYH,OAAO,CAAE,OAZN,CAAP,CAcH,CAES,GAAI,CAAA,mBAAJ,EAAuB,CAC7B,KAAM,CAAA,WAAW,CAAG,KAAK,KAAL,CAAW,IAAX,CAAgB,WAAhB,CAA4B,MAAhD,CACA,GAAI,CAAC,KAAK,KAAN,EAAe,CAAC,KAAK,KAAL,CAAW,WAA3B,EAA0C,CAAC,WAA/C,CAA4D,CACxD,OACH,CAED,KAAM,CAAA,MAAM,CAAG,GAAG,CAAC,KAAK,KAAN,CAAa,wBAAb,CAAH,EAA6C,OAA5D,CAEA,KAAM,CACF,SAAS,CAAE,CACP,mBADO,CAEP,qBAFO,CAGP,mBAHO,CAIP,kBAJO,CAKP,aALO,CAMP,oBANO,CAOP,wBAPO,CADT,EAUF,KAAK,KAVT,CAYA,MAAO,CACH,YAAY,CAAE,KAAK,YADhB,CAEH,WAAW,CAAE,KAAK,KAAL,CAAW,WAFrB,CAGH,sBAAsB,CAAE,yBAAyB,CAAC,WAAD,CAH9C,CAIH,MAJG,CAKH,QAAQ,CAAE,CACN,mBADM,CAEN,qBAFM,CAGN,mBAHM,CAIN,kBAJM,CAKN,aALM,CAMN,oBANM,CAON,wBAPM,CALP,CAAP,CAeH,CAOM,MAAM,EAAA,CACT,KAAM,CACF,SAAS,CAAE,CACP,uBADO,CAEP,mBAFO,CAGP,aAHO,CAIP,mBAJO,CAKP,YALO,CAMP,cANO,CAOP,cAPO,CAQP,eARO,CASP,wBATO,CADT,CAYF,MAAM,CAAE,CAAE,OAAF,CAAW,aAAX,CAA0B,eAA1B,CAZN,EAaF,KAAK,KAbT,CAeA,KAAM,CAAA,WAAW,CAAG,KAAK,KAAL,CAAW,MAAX,CAAkB,cAAlB,GAAqC,SAArC,EAAkD,KAAK,KAAL,CAAW,MAAX,CAAkB,cAAlB,GAAgC,2BAAlF,EAAmI,KAAK,KAAL,CAAW,MAAX,CAAkB,cAAlB,GAAgC,8BAAvL,CACA,KAAM,CAAA,eAAe,CAAG,KAAK,KAAL,CAAW,MAAX,CAAkB,cAAlB,GAAqC,SAArC,EAAkD,KAAK,KAAL,CAAW,MAAX,CAAkB,cAAlB,GAAgC,8BAA1G,CACA,KAAM,CAAA,WAAW,CAAG,CAAE,WAAW,CAAE,KAAK,KAApB,CAA2B,SAAS,CAAE,SAAS,CAAC,kBAAD,CAAqB,KAAK,KAAL,CAAW,MAAX,CAAkB,SAAvC,CAA/C,CAApB,CACA,KAAM,CAAA,iBAAiB,CAAG,QAAQ,CAAC,UAAT,CAAoB,MAApB,CAA4B,KAAK,KAAL,CAAW,OAAX,CAAmB,aAA/C,GAAiE,EAA3F,CACA,KAAM,CAAA,iBAAiB,CAAG,KAAK,KAAL,CAAW,IAAX,CAAgB,QAAhB,CAAyB,MAAzB,EAAmC,KAAK,KAAL,CAAW,IAAX,CAAgB,QAAhB,CAAyB,MAAzB,CAAgC,iBAA7F,CACA,KAAM,CAAA,gBAAgB,CAAG,KAAK,KAAL,CAAW,IAAX,CAAgB,gBAAhB,CAAiC,MAAjC,EAA2C,KAAK,KAAL,CAAW,IAAX,CAAgB,gBAAhB,CAAiC,MAAjC,CAAwC,gBAA5G,CAEA,GAAI,CAAA,SAAS,gCACN,KAAK,KADC,MAET,WAFS,CAGT,OAAO,CAAE,OAAO,eAChB,KAAA,CAAA,aAAA,CAAC,QAAQ,CAAC,IAAV,CAAc,MAAA,CAAA,MAAA,CAAA,EAAA,CACN,OADM,CACC,CACX,SAAS,CAAC,2BADC,CAEX,IAAI,CAAE,OAAO,CAAC,IAFH,CAGX,GAAG,CAAE,OAAO,CAAC,GAAR,EAAe,IAHT,CAIX,SAAS,CAAE,CAAE,MAAM,CAAE,KAAK,+BAAf,CAAgD,cAAc,CAAE,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnF,CAJA,CADD,CAAd,CAJS,CAYT,kBAAkB,CAAE,iBAAiB,eACjC,KAAA,CAAA,aAAA,CAAC,MAAD,CAAO,CAAC,SAAS,CAAC,qCAAX,CAAiD,IAAI,CAAE,iBAAvD,CAAP,CACK,cADL,CAbK,CAiBT,WAAW,CAAE,CAAE,SAAS,CAAE,0BAAb,CAjBJ,EAAb,CAoBA,GAAI,KAAK,QAAT,CAAmB,CACf,SAAS,gCACF,SADE,MAEL,KAAK,cAAE,KAAA,CAAA,aAAA,CAAC,cAAD,CAAe,CAAC,SAAS,CAAC,yBAAX,CAAqC,KAAK,CAAE,mBAA5C,CAAf,CAFF,EAAT,CAIA,MAAO,MAAK,KAAL,CAAW,UAAX,CAAsB,SAAtB,CAAP,CACH,CAED,GAAI,CAAC,KAAK,WAAV,CAAuB,CACnB,SAAS,gCACF,SADE,MAEL,OAAO,cAAE,KAAA,CAAA,aAAA,CAAC,cAAD,CAAe,CAAC,SAAS,CAAC,2BAAX,CAAuC,KAAK,CAAE,YAA9C,CAAf,CAFJ,EAAT,CAIA,MAAO,MAAK,KAAL,CAAW,UAAX,CAAsB,SAAtB,CAAP,CACH,CAED,GAAI,CAAC,KAAK,KAAV,CAAiB,CACb,SAAS,gCACF,SADE,MAEL,KAAK,cAAE,KAAA,CAAA,aAAA,CAAC,cAAD,CAAe,CAAC,SAAS,CAAC,yBAAX,CAAqC,KAAK,CAAE,uBAA5C,CAAf,CAFF,EAAT,CAIA,MAAO,MAAK,KAAL,CAAW,UAAX,CAAsB,SAAtB,CAAP,CACH,CAED,KAAM,CAAA,eAAe,CAAG,kBAAkB,CAAC,KAAK,KAAN,CAAa,KAAK,UAAlB,CAA8B,KAAK,KAAnC,CAA0C,KAAK,QAA/C,CAAyD,KAAK,YAA9D,CAA4E,eAA5E,CAA6F,KAAK,gBAAlG,CAA1C,CACA,KAAM,CAAA,UAAU,CAAG,eAAe,EAAI,aAAa,CAAC,eAAD,CAAnD,CAEA,KAAM,CAAA,oBAAoB,CAAG,KAAK,KAAL,EAAc,uBAAuB,CAAC,KAAK,KAAN,CAAa,KAAK,UAAlB,CAA8B,KAAK,KAAnC,CAA0C,KAAK,YAA/C,CAA6D,iBAA7D,CAAgF,gBAAhF,CAAkG,eAAlG,CAAlE,CACA,KAAM,CAAA,eAAe,CAAG,oBAAoB,EAAI,mBAAmB,CAAC,oBAAD,CAAnE,CAEA,SAAS,gCACF,SADE,MAEL,UAAU,CAAE,KAAK,KAFZ,CAGL,eAHK,CAIL,UAJK,CAKL,MAAM,CAAE,UAAU,CACZ,SAAS,CAAC,CACR,UAAU,CAAE,KAAK,UADT,CAER,UAFQ,CAGR,SAAS,CAAE,CAAE,cAAF,CAAkB,eAAlB,CAHH,CAIR,WAJQ,CAAD,CADG,CAOZ,SAZD,CAaL,YAAY,CAAE,KAAK,iBAAL,CAAyB,2BAA2B,CAAC,KAAK,iBAAN,CAApD,CAA+E,SAbxF,CAcL,OAAO,CAAE,KAAK,mBAAL,CAA2B,6BAA6B,CAAC,KAAK,mBAAN,CAAxD,CAAqF,SAdzF,CAeL,IAAI,CAAE,aAAa,CAAG,mBAAmB,CAAC,CAAE,aAAF,CAAiB,mBAAjB,CAAsC,aAAtC,CAAqD,wBAArD,CAA+E,gBAAgB,CAAE,KAAK,gBAAtG,CAAD,CAAtB,CAAmJ,SAfjK,EAAT,CAkBA,MAAO,MAAK,KAAL,CAAW,UAAX,CAAsB,SAAtB,CAAP,CACH,CA9NgF,CAIvE,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,kBAAA,CAKT,IALS,CAAA,CAOA,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,aAAA,CAET,IAFS,CAAA,CAIA,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,UAAA,CAET,IAFS,CAAA,CAIA,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,OAAA,CAET,IAFS,CAAA,CAIA,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,UAAA,CAET,IAFS,CAAA,CAIA,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,cAAA,CAeT,IAfS,CAAA,CAiBA,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,cAAA,CAcT,IAdS,CAAA,CAgBA,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,mBAAA,CA0BT,IA1BS,CAAA,CA4BA,UAAA,CAAA,CAAT,QAAS,CAAA,C,sBAAA,C,qBAAA,CAmCT,IAnCS,CAAA,CA2Id,cAAe,CAAA,YAAf","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Button, getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport { SalesOrder, SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport classname from 'classnames';\nimport get from 'lodash/get';\nimport { computed } from 'mobx';\nimport * as React from 'react';\nimport { IGetOrderSummaryInput, IHelp, IOrderSummary, IPaymentMethods, IPaymentMethodsInput  } from '../../common';\nimport { getGroups, IGroups } from '../../common/get-groups';\nimport { getOrderInfomationInput, getOrderInformation, IOrderInformation } from '../../common/get-order-information';\nimport { ISalesLine } from '../../common/get-sales-line';\nimport { getSalesLines, getSalesLinesInput } from '../../common/get-sales-lines';\nimport LabelComponent from '../../common/label';\nimport { getTenderIdOperationIdMap, IPriceContext } from '../../common/utilities';\nimport { IOrderDetailsData, IOrderDetailsProps } from './../..';\nimport { getOrderDetailsHelp } from './components/get-help';\nimport { getOrderDetailsOrderSummary } from './components/get-order-summary';\nimport { getOrderDetailsPaymentMethods } from './components/get-payment-methods';\nimport { addressOptions } from './order-details.props.autogenerated';\n\nexport * from '../../common/get-groups';\nexport * from '../../common/get-order-information';\nexport * from '../../common/get-sales-line';\nexport * from '../../common/get-sales-lines';\nexport * from '../../common/utilities';\nexport * from './components/get-help';\nexport * from './components/get-order-summary';\nexport * from './components/get-payment-methods';\n\nexport interface IOrderDetailsViewProps extends IOrderDetailsProps<IOrderDetailsData> {\n    moduleProps: IModuleProps;\n    salesOrder?: SalesOrder;\n    footerProps?: INodeProps;\n    alert?: React.ReactNode;\n    loading?: React.ReactNode;\n    heading: React.ReactNode;\n    backToShoppingLink?: React.ReactNode;\n    orderInfomation?: IOrderInformation;\n    salesLines?: ISalesLine[];\n    groups?: IGroups;\n    orderSummary?: IOrderSummary;\n    payment?: IPaymentMethods;\n    help?: IHelp;\n}\n\n/**\n *\n * OrderDetails component\n * @extends {React.PureComponent<IOrderDetailsProps<IOrderDetailsData>>}\n */\nclass OrderDetails extends React.PureComponent<IOrderDetailsProps<IOrderDetailsData>> {\n    private moduleName: string = 'ms-order-details';\n    private telemetryContent: ITelemetryContent;\n\n    @computed get isCurrentChannel(): boolean {\n        if (!this.order) {\n            return false;\n        }\n        return this.order.ChannelId === get(this.props, 'context.request.apiSettings.channelId');\n    }\n\n    @computed get isDataReady(): boolean {\n        return get(this.props, 'data.orderHydration.status') === 'SUCCESS';\n    }\n\n    @computed get hasError(): boolean {\n        return get(this.props, 'data.orderHydration.status') === 'FAILED';\n    }\n\n    @computed get order(): SalesOrder | undefined {\n        return get(this.props, 'data.orderHydration.result.salesOrder');\n    }\n\n    @computed get products(): SimpleProduct[] {\n        return get(this.props, 'data.orderHydration.result.products') || [];\n    }\n\n    @computed get priceContext(): IPriceContext {\n        const {\n            id,\n            typeName,\n            context,\n            telemetry,\n            resources: { freePriceText }\n        } = this.props;\n        return {\n            id,\n            typeName,\n            context,\n            telemetry,\n            freePriceText\n        };\n    }\n\n    @computed get earnedPoints(): number {\n        const loyaltyCard = this.props.data.loyaltyCard.result;\n        if (loyaltyCard && loyaltyCard.RewardPoints && this.order) {\n            const pointPrograms = loyaltyCard.RewardPoints.map(point => point.RewardPointId);\n            const rewardLines = this.order.LoyaltyRewardPointLines || [];\n            let total = 0;\n            rewardLines.forEach(line => {\n                if ((line.RewardPointAmountQuantity || 0) > 0 && pointPrograms.indexOf(line.RewardPointId) > -1) {\n                    total += line.RewardPointAmountQuantity!;\n                }\n            });\n            return total;\n        }\n        return 0;\n    }\n\n    @computed get orderSummaryProps(): IGetOrderSummaryInput | undefined {\n        if (!this.order) {\n            return;\n        }\n        const { request } = this.props.context;\n        const pickupDeliveryModeCode = request && request.channel && request.channel.PickupDeliveryModeCode;\n        const orderDetailsLines =  this.order?.SalesLines;\n        const canShip = orderDetailsLines?.some(orderDetailsLine => (orderDetailsLine.DeliveryMode && orderDetailsLine.DeliveryMode !== '') ? orderDetailsLine.DeliveryMode !== pickupDeliveryModeCode : orderDetailsLine);\n\n        const {\n            resources: { orderSummaryHeading, orderSummaryItemsTotalLabel, orderSummaryShippingFeeLabel, orderSummaryTaxLabel, orderSummaryGrandTotalLabel, pointsEarnedLabel }\n        } = this.props;\n        return {\n            order: this.order,\n            earnedPoints: this.earnedPoints,\n            priceContext: this.priceContext,\n            resource: {\n                orderSummaryHeading,\n                orderSummaryItemsTotalLabel,\n                orderSummaryShippingFeeLabel,\n                orderSummaryTaxLabel,\n                pointsEarnedLabel,\n                orderSummaryGrandTotalLabel\n            },\n            canShip: canShip\n        };\n    }\n\n    @computed get paymentMethodsProps(): IPaymentMethodsInput | undefined {\n        const tenderTypes = this.props.data.tenderTypes.result;\n        if (!this.order || !this.order.TenderLines || !tenderTypes) {\n            return;\n        }\n\n        const locale = get(this.props, 'context.request.locale') || 'en-US';\n\n        const {\n            resources: {\n                paymentMethodsTitle,\n                creditCardEndingLabel,\n                giftCardEndingLabel,\n                amountCoveredLabel,\n                cashUsedLabel,\n                loyaltyCardUsedLabel,\n                customerAccountUsedLabel\n            }\n        } = this.props;\n\n        return {\n            priceContext: this.priceContext,\n            tenderLines: this.order.TenderLines,\n            tenderIdOperationIdMap: getTenderIdOperationIdMap(tenderTypes),\n            locale,\n            resource: {\n                paymentMethodsTitle,\n                creditCardEndingLabel,\n                giftCardEndingLabel,\n                amountCoveredLabel,\n                cashUsedLabel,\n                loyaltyCardUsedLabel,\n                customerAccountUsedLabel\n            }\n        };\n    }\n\n    constructor(props: IOrderDetailsProps<IOrderDetailsData>) {\n        super(props);\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public render(): JSX.Element {\n        const {\n            resources: {\n                noSalesOrderDetailsText,\n                genericErrorMessage,\n                needHelpLabel,\n                helpLineNumberLabel,\n                loadingLabel,\n                backToShopping,\n                orderItemLabel,\n                orderItemsLabel,\n                helpLineContactAriaLabel,\n            },\n            config: { heading, contactNumber, showChannelInfo }\n        } = this.props;\n\n        const showAddress = this.props.config.addressOptions !== undefined && this.props.config.addressOptions === addressOptions.showAddressWithSingleLine || this.props.config.addressOptions === addressOptions.showAddressWithMultiplelines;\n        const showFullAddress = this.props.config.addressOptions !== undefined && this.props.config.addressOptions === addressOptions.showAddressWithMultiplelines;\n        const moduleProps = { moduleProps: this.props, className: classname('ms-order-details', this.props.config.className) };\n        const backToShoppingUrl = Msdyn365.getUrlSync('home', this.props.context.actionContext) || '';\n        const channelIdentities = this.props.data.channels.result && this.props.data.channels.result.channelIdentities;\n        const orgUnitLocations = this.props.data.orgUnitLocations.result && this.props.data.orgUnitLocations.result.orgUnitLocations;\n\n        let viewProps: IOrderDetailsViewProps = {\n            ...this.props,\n            moduleProps,\n            heading: heading && (\n            <Msdyn365.Text\n                {...heading}\n                className='ms-order-details__heading'\n                text={heading.text}\n                tag={heading.tag || 'h2'}\n                editProps={{ onEdit: this.handleOrderDetailsHeadingChange, requestContext: this.props.context.request }}\n            />\n            ),\n            backToShoppingLink: backToShoppingUrl && (\n                <Button className='ms-order-details__btn-keep-shopping' href={backToShoppingUrl}>\n                    {backToShopping}\n                </Button>\n            ),\n            footerProps: { className: 'ms-order-details__footer' }\n        };\n\n        if (this.hasError) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-details__alert' label={genericErrorMessage} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!this.isDataReady) {\n            viewProps = {\n                ...viewProps,\n                loading: <LabelComponent className='ms-order-details__loading' label={loadingLabel} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!this.order) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-details__alert' label={noSalesOrderDetailsText} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        const salesLinesInput = getSalesLinesInput(this.props, this.moduleName, this.order, this.products, this.priceContext, showFullAddress, this.telemetryContent);\n        const salesLines = salesLinesInput && getSalesLines(salesLinesInput);\n\n        const orderInfomationInput = this.order && getOrderInfomationInput(this.props, this.moduleName, this.order, this.priceContext, channelIdentities, orgUnitLocations, showChannelInfo);\n        const orderInfomation = orderInfomationInput && getOrderInformation(orderInfomationInput);\n\n        viewProps = {\n            ...viewProps,\n            salesOrder: this.order,\n            orderInfomation,\n            salesLines,\n            groups: salesLines\n                ? getGroups({\n                    moduleName: this.moduleName,\n                    salesLines,\n                    resources: { orderItemLabel, orderItemsLabel },\n                    showAddress\n                })\n                : undefined,\n            orderSummary: this.orderSummaryProps ? getOrderDetailsOrderSummary(this.orderSummaryProps) : undefined,\n            payment: this.paymentMethodsProps ? getOrderDetailsPaymentMethods(this.paymentMethodsProps) : undefined,\n            help: contactNumber ? getOrderDetailsHelp({ needHelpLabel, helpLineNumberLabel, contactNumber, helpLineContactAriaLabel, telemetryContent: this.telemetryContent }) : undefined\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleOrderDetailsHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n}\n\nexport default OrderDetails;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}