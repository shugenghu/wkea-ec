{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import{getRnrAuthEndpointId,getRnrEndpointId,getRnrPartnerId,getSelectedProductIdFromActionInput}from'@msdyn365-commerce-modules/retail-actions';import{format,getTelemetryObject,LabeledDropdown}from'@msdyn365-commerce-modules/utilities';import{RatingComponent}from'@msdyn365-commerce/components';import*as Msdyn365 from'@msdyn365-commerce/core';import classname from'classnames';import{reaction}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{getReviewsForGivenProduct}from'../../actions/get-product-reviews';import{GetProductReviewsInput}from'../../actions/inputs/get-product-reviews-input';import{ReportReviewConcernInput}from'../../actions/inputs/report-review-concern-input';import{SubmitHelpfulnessVoteInput}from'../../actions/inputs/submit-helpfulness-vote-input';import reportReviewConcern from'../../actions/report-review-concern';import submitHelpfulnessVote from'../../actions/submit-helpfulness-vote';import{ReviewModal,submitReview}from'../../common/review-modal';import{PageControls,ReviewCount}from'./components/components';import{ReportReviewModal}from'./components/report-review-modal';import{ReviewCard}from'./components/review-card';let ReviewsList=class ReviewsList extends React.Component{constructor(props){super(props);this.sortByDropdownOptions=[{key:'MostHelpful',value:this.props.resources.mostHelpfulSortOptionText},{key:'MostRecent',value:this.props.resources.mostRecentSortOptionText},{key:'HighestRating',value:this.props.resources.highestRatedSortOptionText},{key:'LowestRating',value:this.props.resources.lowestRatedSortOptionText}];this.filterByDropdownOptions=[{key:'1;2;3;4;5',value:this.props.resources.allRatinsFilterByOptionText},{key:'5',value:this.props.resources.fiveStarFilterByOptionText},{key:'4',value:this.props.resources.fourStarFilterByOptionText},{key:'3',value:this.props.resources.threeStarFilterByOptionText},{key:'2',value:this.props.resources.twoStarFilterByOptionText},{key:'1',value:this.props.resources.oneStarFilterByOptionText}];this.handleHeadingChange=event=>this.props.config.heading.text=event.target.value;this._userReview=()=>{const userReview=this.props.data.userReview.result;return userReview&&this._reviewCard(userReview,true);};this._reviewCards=reviewList=>{const userReview=this.props.data.userReview.result;const reviewElements=[];for(const review of reviewList){if(!review.isTakenDown&&review.isPublished&&userReview?review.reviewId!==userReview.reviewId:true){reviewElements.push(this._reviewCard(review,false));}}return reviewElements;};this._reviewCard=(review,userReview)=>{return ReviewCard({review:review,resources:_objectSpread({},this.props.resources),context:this.props.context,isUserReview:userReview,parentId:this.props.id,parentType:this.props.typeName,reportedReviews:this.state.reportedReviews,returnRef:this._userReportModalToggle,reportedReviewId:this.state.reportingReviewId,toggleWriteReviewModal:this._toggleReviewModal,toggleReportReviewModal:this._onReportModalOpen,updateReviewHelpfulness:this.updateReviewHelpfulnessVote,votedReviews:this.state.votedReviews});};this._userReviewModal=()=>{return ReviewModal({userReview:this.props.data.userReview.result,product:this.props.data.product.result,resources:_objectSpread({},this.props.resources),context:this.props.context,parentId:this.props.id,parentType:this.props.typeName,isOpen:this.state.isReviewModalOpen,rating:this.state.userReviewRating,reviewTitle:this.state.userReviewTitle,reviewText:this.state.userReviewText,onModalToggle:this._toggleReviewModal,onTitleChange:this._onTitleChange,onTextChange:this._onTextChange,onRatingChange:this._onRatingChange,onReviewComplete:this._onReviewComplete,renderContextId:'writeReview-list',returnRef:this._userReviewModalToggle,hasError:this.state.hasReviewError});};this._onTitleChange=event=>{this.reviewsListCallbacks.updateReviewTitle(event.target.value);};this._onTextChange=event=>{this.reviewsListCallbacks.updateReviewText(event.target.value);};this._onRatingChange=value=>{this.reviewsListCallbacks.updateRating(value);};this._toggleReviewModal=()=>{const userReview=this.props.data.userReview.result;if(this.state.isReviewModalOpen){this.setState({isReviewModalOpen:false,hasReviewError:false});}else{this.setState({isReviewModalOpen:true,userReviewText:userReview.reviewText,userReviewTitle:userReview.title,userReviewRating:userReview.rating});}};this._onReviewComplete=isSuccess=>{if(isSuccess){this.setState({isReviewModalOpen:false,hasReviewError:false});}else{this.setState({hasReviewError:true});}};this._reportReviewModal=()=>{return ReportReviewModal({resources:_objectSpread({},this.props.resources),context:this.props.context,isOpen:this.state.isReportModalOpen,returnRef:this._userReportModalToggle,reportedKey:this.state.reportedKey,onModalToggle:this._onReportModalClose,onRadioChange:this._onRadioChange,reportReview:this._reportReview,hasError:this.state.hasReportError,telemetryContent:this.telemetryContent});};this._onReportModalOpen=reviewId=>{this.setState({isReportModalOpen:true,reportingReviewId:reviewId,reported:false,reportedKey:\"8\"});};this._onReportModalClose=()=>{this.setState({isReportModalOpen:false,hasReportError:false});};this._onRadioChange=event=>{this.setState({reportedKey:event.currentTarget.getAttribute('data-key')||''});};this._reportReviewCallback=(reviewId,reportedKey)=>{reportReviewConcern(new ReportReviewConcernInput(reviewId,getRnrPartnerId(this.props.context.actionContext),this.props.context.request.locale,reportedKey,this.getUserToken(this.props.context.request),getRnrAuthEndpointId(this.props.context.actionContext)),this.props.context.actionContext).then(_value=>{const reportedReview=this.state.reportedReviews;reportedReview.push(reviewId);this.setState({reported:true,reportedReviews:reportedReview,hasReportError:false});}).catch(_value=>{this.setState({hasReportError:true});});};this._reportReview=()=>{this._reportReviewCallback(this.state.reportingReviewId,this.state.reportedKey);};this.updateSortByDropdown=async notification=>{await this.updateReviews(0,notification.selectedOption,this.state.selectedFilterByOption,1,this.state.isFilterApplied);};this.updateFilterByDropdown=async notification=>{await this.updateReviews(0,this.state.selectedSortByOption,notification.selectedOption,1,true);};this.updateReviews=async(skipItems,selectedSortByOption,selectedFilterByOption,currentPage,isFilterApplied)=>{const productId=getSelectedProductIdFromActionInput(this.props.context.actionContext);if(productId===undefined){return;}const result=await getReviewsForGivenProduct(new GetProductReviewsInput(productId,getRnrPartnerId(this.props.context.actionContext),this.props.context.request.locale,getRnrEndpointId(this.props.context.actionContext),selectedSortByOption.key,selectedFilterByOption.key,skipItems<0?0:skipItems),this.props.context.actionContext);if(result&&result.items&&result.pagingInfo&&result.pagingInfo.totalItems!==undefined){this.setState({currentPage:currentPage,listOfReviews:result.items,selectedSortByOption,selectedFilterByOption,reviewsCount:result.pagingInfo.totalItems,isFilterApplied:isFilterApplied});}};this._updateVoteUi=(reviewId,isHelpful)=>{let alreadyExists=false;let list=this.state.votedReviews.map(review=>{if(review.reviewId===reviewId){review.approved=isHelpful;alreadyExists=true;}return review;});if(!alreadyExists){list=list.concat({reviewId:reviewId,approved:isHelpful});}this.setState({votedReviews:list});};this.updateReviewHelpfulnessVote=(reviewId,isHelpful)=>{submitHelpfulnessVote(new SubmitHelpfulnessVoteInput(reviewId,getRnrPartnerId(this.props.context.actionContext),this.props.context.request.locale,isHelpful,this.getUserToken(this.props.context.request),getRnrAuthEndpointId(this.props.context.actionContext)),this.props.context.actionContext).then(()=>{this._updateVoteUi(reviewId,isHelpful);});};this.getUserToken=context=>{return context&&context.user&&context.user.token;};this.reviewsListCallbacks={updateReviewTitle:title=>{this.setState({userReviewTitle:title});},updateReviewText:text=>{this.setState({userReviewText:text});},updateRating:rating=>{this.setState({userReviewRating:rating});},onReviewSubmitted:isSuccessful=>{if(isSuccessful){this.setState({isReviewModalOpen:false,hasReviewError:false});}else{this.setState({hasReviewError:true});}},submitReview:submitReview,toggleModal:this._toggleReviewModal,updateReviewHelpfulnessVote:this.updateReviewHelpfulnessVote,toggleReportModal:reviewId=>{this.state.isReportModalOpen?this._onReportModalOpen(reviewId):this._onReportModalClose();},reportReview:this._reportReviewCallback,updateFilterByDropdown:this.updateFilterByDropdown,updateSortByDropdown:this.updateSortByDropdown,updateReviews:this.updateReviews};const{userReview:{result:userReview}}=this.props.data;this.state={skipItems:0,reviewsCount:0,listOfReviews:[],currentPage:1,showSpinner:false,isFilterApplied:false,selectedSortByOption:this.sortByDropdownOptions[0],selectedFilterByOption:this.filterByDropdownOptions[0],userReviewRating:userReview?userReview.rating:0,userReviewText:userReview?userReview.reviewText:'',userReviewTitle:userReview?userReview.title:'',isReviewModalOpen:false,hasReviewError:false,isReportModalOpen:false,hasReportError:false,reported:false,reportedKey:\"8\",reportingReviewId:'',reportedReviews:[],votedReviews:[]};this._userReviewModalToggle=/*#__PURE__*/React.createRef();this._userReportModalToggle=/*#__PURE__*/React.createRef();this.telemetryContent=getTelemetryObject(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);}componentDidMount(){this.props.data.reviewsList.then(reviewsList=>{if(reviewsList&&reviewsList.pagingInfo&&reviewsList.pagingInfo.totalItems&&reviewsList.items&&reviewsList.items.length>0){this.setState({listOfReviews:reviewsList.items,reviewsCount:reviewsList.pagingInfo.totalItems});}});reaction(()=>this.props.data.ratingsReviewsState.result&&this.props.data.ratingsReviewsState.result.filterKey,async filterKey=>{const filterKeyValue=Number(filterKey);const dropdownItemsCount=this.filterByDropdownOptions.length;if(!!filterKey&&!isNaN(filterKeyValue)&&filterKeyValue<dropdownItemsCount){const filterByOption=this.filterByDropdownOptions.find(option=>option.key===filterKey);if(!filterByOption){this.props.telemetry.warning(\"[reviews-list] cannot find filter with key \".concat(filterKey));}else{await this.updateReviews(0,this.state.selectedSortByOption,filterByOption,1,true);const selectedIndex=dropdownItemsCount-filterKeyValue;this.setState({selectedFilterByOption:this.filterByDropdownOptions[selectedIndex]});}}});}render(){const{className,heading,reviewsShownOnEachPage}=this.props.config;const{currentPage,reviewsCount,selectedFilterByOption,selectedSortByOption}=this.state;const{ratingsSummary:{result:ratingsSummary}}=this.props.data;const resources=this.props.resources;const completeClass=classname('ms-reviews-list',className);const viewProps=_objectSpread(_objectSpread({},this.props),{},{state:this.state,className:completeClass,moduleProps:{moduleProps:this.props,className:completeClass},callbacks:this.reviewsListCallbacks,reviewModal:this._userReviewModal(),reportReviewModal:this._reportReviewModal(),filterByDropdown:/*#__PURE__*/React.createElement(LabeledDropdown,{labelText:resources.filterByDropdownText,dropdownId:'reviewsListFilterBy',dropdownOptions:this.filterByDropdownOptions,selectedOption:selectedFilterByOption,onSelectOption:this.updateFilterByDropdown,controlledByParent:true}),sortByDropdown:/*#__PURE__*/React.createElement(LabeledDropdown,{labelText:resources.sortByDropdownText,dropdownId:'reviewsListSortBy',dropdownOptions:this.sortByDropdownOptions,selectedOption:selectedSortByOption,onSelectOption:this.updateSortByDropdown}),averageRating:ratingsSummary&&/*#__PURE__*/React.createElement(RatingComponent,{avgRating:ratingsSummary.averageRating||0,readOnly:true,ariaLabel:format(resources.averageRatingAriaLabel,ratingsSummary.averageRating,'5'),ratingCount:\"\".concat(ratingsSummary.reviewsCount),data:{},context:this.props.context,id:this.props.id,typeName:this.props.typeName}),reviewCount:/*#__PURE__*/React.createElement(ReviewCount,{resources:_objectSpread({},this.props.resources),currentPage:currentPage,reviewsCount:reviewsCount,reviewsShownOnEachPage:reviewsShownOnEachPage}),refineReviewsProps:{className:'ms-reviews-list__refiners'},reviewsListProps:{className:'ms-reviews-list__reviews'},reviewCards:this._reviewCards(this.state.listOfReviews),userReview:this._userReview(),pageControls:/*#__PURE__*/React.createElement(PageControls,{resources:_objectSpread({},this.props.resources),currentPage:currentPage,reviewsShownOnEachPage:reviewsShownOnEachPage,selectedSortByOption:selectedSortByOption,selectedFilterByOption:selectedFilterByOption,updateReviews:this.updateReviews,reviewsCount:reviewsCount,telemetryContent:this.telemetryContent}),noReviewsMessage:/*#__PURE__*/React.createElement(\"span\",{className:'ms-reviews-list__empty-message',\"aria-live\":'polite'},resources.noReviewsMessage),noReviewsWithFilterMessage:/*#__PURE__*/React.createElement(\"span\",{className:'ms-reviews-list__filter-message',\"aria-live\":'polite'},resources.noReviewsWithSelectedFilterMessage),heading:heading&&/*#__PURE__*/React.createElement(Msdyn365.Text,{className:'ms-reviews-list__heading',tag:heading.tag||'h2',text:heading.text,editProps:{onEdit:this.handleHeadingChange,requestContext:this.props.context.request}}),sortByOptions:this.sortByDropdownOptions,filterByOptions:this.filterByDropdownOptions});return this.props.renderView(viewProps);}};ReviewsList=__decorate([observer],ReviewsList);export default ReviewsList;","map":{"version":3,"sources":["modules/reviews-list/reviews-list.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getRnrAuthEndpointId, getRnrEndpointId, getRnrPartnerId, getSelectedProductIdFromActionInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { format, getTelemetryObject, ILabeledDropdownOnChangeNotification, ILabeledDropdownOption, IModuleProps, INodeProps, ITelemetryContent, LabeledDropdown } from '@msdyn365-commerce-modules/utilities';\nimport { Review } from '@msdyn365-commerce/commerce-entities';\nimport { RatingComponent } from '@msdyn365-commerce/components';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport { SimpleProduct } from '@msdyn365-commerce/retail-proxy';\nimport classname from 'classnames';\nimport { reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { getReviewsForGivenProduct } from '../../actions/get-product-reviews';\nimport { GetProductReviewsInput } from '../../actions/inputs/get-product-reviews-input';\nimport { ReportReviewConcernInput, ReviewConcernCategory } from '../../actions/inputs/report-review-concern-input';\nimport { SubmitHelpfulnessVoteInput } from '../../actions/inputs/submit-helpfulness-vote-input';\nimport reportReviewConcern from '../../actions/report-review-concern';\nimport submitHelpfulnessVote from '../../actions/submit-helpfulness-vote';\nimport { IReviewModalViewProps, ReviewModal, submitReview } from '../../common/review-modal';\nimport { IRnrKeyValuePair, IRnrOrderByKeyValuePair } from '../../common/rnrInterface';\nimport { PageControls, ReviewCount } from './components/components';\nimport { IReportReviewModalViewProps, ReportReviewModal } from './components/report-review-modal';\nimport { IReviewCardViewProps, ReviewCard } from './components/review-card';\nimport { IReviewsListData } from './reviews-list.data';\nimport { IReviewsListProps } from './reviews-list.props.autogenerated';\n\nexport interface IReviewsListState {\n    skipItems: number;\n    listOfReviews: Review[];\n    currentPage: number;\n    reviewsCount: number;\n    showSpinner: boolean;\n    isFilterApplied: boolean;\n    selectedSortByOption: ILabeledDropdownOption;\n    selectedFilterByOption: ILabeledDropdownOption;\n    userReviewRating: number;\n    userReviewTitle: string;\n    userReviewText: string;\n    isReviewModalOpen: boolean;\n    hasReviewError: boolean;\n    isReportModalOpen: boolean;\n    hasReportError: boolean;\n    reportingReviewId: string;\n    reportedKey: string;\n    reported: boolean;\n    reportedReviews: string[];\n    votedReviews: {reviewId: string; approved: boolean}[];\n}\n\nexport interface IReviewsListCallbacks {\n    toggleModal(): void;\n    updateReviewTitle(title: string): void;\n    updateReviewText(text: string): void;\n    updateRating(rating: number): void;\n    onReviewSubmitted(isSuccessful: boolean): void;\n    submitReview(product: SimpleProduct, title: string, text: string, rating: number, context: Msdyn365.ICoreContext, userReview?: Review, onReviewSubmission?: (isSuccessful: boolean) => void): void;\n    updateReviewHelpfulnessVote(reviewId: string, isHelpful: boolean): void;\n    toggleReportModal(reviewId: string): void;\n    reportReview(reviewId: string, reportedKey: string): void;\n    updateSortByDropdown(notification: ILabeledDropdownOnChangeNotification): void;\n    updateFilterByDropdown(notification: ILabeledDropdownOnChangeNotification): void;\n    updateReviews(skipItems: number, selectedSortByOption: ILabeledDropdownOption, selectedFilterByOption: ILabeledDropdownOption, currentPage: number, isFilterApplied: boolean): void;\n}\n\nexport interface IReviewsListViewProps extends IReviewsListProps<IReviewsListData> {\n    state: IReviewsListState;\n    className: string;\n    callbacks: IReviewsListCallbacks;\n    moduleProps: IModuleProps;\n    reviewModal: IReviewModalViewProps;\n    reportReviewModal: IReportReviewModalViewProps;\n    sortByDropdown: React.ReactNode;\n    filterByDropdown: React.ReactNode;\n    averageRating: React.ReactNode;\n    reviewCount: React.ReactElement;\n    refineReviewsProps: INodeProps;\n    reviewsListProps: INodeProps;\n    reviewCards: IReviewCardViewProps[];\n    userReview?: IReviewCardViewProps;\n    pageControls: React.ReactNode;\n    noReviewsMessage: React.ReactElement;\n    noReviewsWithFilterMessage: React.ReactElement;\n    heading: React.ReactNode;\n    sortByOptions: IRnrOrderByKeyValuePair[];\n    filterByOptions: IRnrOrderByKeyValuePair[];\n}\n\n/**\n *\n * ReviewsList component\n * @extends {React.Component<IReviewsListProps<IReviewsListData>, IReviewsListState>}\n */\n@observer\nclass ReviewsList extends React.Component<IReviewsListProps<IReviewsListData>, IReviewsListState> {\n    public sortByDropdownOptions: IRnrOrderByKeyValuePair[] = [\n        { key: 'MostHelpful', value: this.props.resources.mostHelpfulSortOptionText },\n        { key: 'MostRecent', value: this.props.resources.mostRecentSortOptionText },\n        { key: 'HighestRating', value: this.props.resources.highestRatedSortOptionText },\n        { key: 'LowestRating', value: this.props.resources.lowestRatedSortOptionText }\n    ];\n\n    public filterByDropdownOptions: IRnrKeyValuePair[] = [\n        { key: '1;2;3;4;5', value: this.props.resources.allRatinsFilterByOptionText },\n        { key: '5', value: this.props.resources.fiveStarFilterByOptionText },\n        { key: '4', value: this.props.resources.fourStarFilterByOptionText },\n        { key: '3', value: this.props.resources.threeStarFilterByOptionText },\n        { key: '2', value: this.props.resources.twoStarFilterByOptionText },\n        { key: '1', value: this.props.resources.oneStarFilterByOptionText }\n    ];\n\n    private _userReviewModalToggle: React.RefObject<HTMLButtonElement>;\n    private _userReportModalToggle: React.RefObject<HTMLButtonElement>;\n    private telemetryContent?: ITelemetryContent;\n\n    constructor(props: IReviewsListProps<IReviewsListData>) {\n        super(props);\n        const {userReview: {result: userReview}} = this.props.data;\n\n        this.state = {\n            skipItems: 0,\n            reviewsCount: 0,\n            listOfReviews: [],\n            currentPage: 1,\n            showSpinner: false,\n            isFilterApplied: false,\n            selectedSortByOption: this.sortByDropdownOptions[0],\n            selectedFilterByOption: this.filterByDropdownOptions[0],\n            userReviewRating: userReview ? userReview.rating : 0,\n            userReviewText: userReview ? userReview.reviewText : '',\n            userReviewTitle: userReview ? userReview.title : '',\n            isReviewModalOpen: false,\n            hasReviewError: false,\n            isReportModalOpen: false,\n            hasReportError: false,\n            reported: false,\n            reportedKey: ReviewConcernCategory.SpamAdvertising,\n            reportingReviewId: '',\n            reportedReviews: [],\n            votedReviews: []\n        };\n\n        this._userReviewModalToggle = React.createRef<HTMLButtonElement>();\n        this._userReportModalToggle = React.createRef<HTMLButtonElement>();\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public componentDidMount(): void {\n        this.props.data.reviewsList.then((reviewsList) => {\n            if (\n                reviewsList &&\n                reviewsList.pagingInfo &&\n                reviewsList.pagingInfo.totalItems &&\n                reviewsList.items &&\n                reviewsList.items.length > 0\n            ) {\n                this.setState({\n                    listOfReviews: reviewsList.items,\n                    reviewsCount: reviewsList.pagingInfo.totalItems,\n                });\n            }\n        });\n\n        reaction(\n            () => this.props.data.ratingsReviewsState.result && this.props.data.ratingsReviewsState.result.filterKey,\n            async (filterKey: string | undefined) => {\n                const filterKeyValue = Number(filterKey);\n                const dropdownItemsCount = this.filterByDropdownOptions.length;\n                if (\n                    !!filterKey &&\n                    !isNaN(filterKeyValue) &&\n                    filterKeyValue < dropdownItemsCount\n                ) {\n                    const filterByOption = this.filterByDropdownOptions.find((option: IRnrKeyValuePair) => option.key === filterKey);\n                    if (!filterByOption) {\n                        this.props.telemetry.warning(`[reviews-list] cannot find filter with key ${filterKey}`);\n                    } else {\n                        await this.updateReviews(0, this.state.selectedSortByOption, filterByOption, 1, true);\n                        const selectedIndex = dropdownItemsCount - filterKeyValue;\n                        this.setState({\n                            selectedFilterByOption: this.filterByDropdownOptions[selectedIndex]\n                        });\n                    }\n                }\n            }\n        );\n    }\n\n    public render(): JSX.Element | null {\n        const {className, heading, reviewsShownOnEachPage} = this.props.config;\n        const {currentPage, reviewsCount, selectedFilterByOption, selectedSortByOption } = this.state;\n        const { ratingsSummary: { result: ratingsSummary } } = this.props.data;\n        const resources = this.props.resources;\n        const completeClass = classname('ms-reviews-list', className);\n        const viewProps: IReviewsListViewProps = {\n            ...this.props,\n            state: this.state,\n            className: completeClass,\n            moduleProps: {\n                moduleProps: this.props,\n                className: completeClass\n            },\n            callbacks: this.reviewsListCallbacks,\n            reviewModal: this._userReviewModal(),\n            reportReviewModal: this._reportReviewModal(),\n            filterByDropdown: (\n                                <LabeledDropdown\n                                    labelText={resources.filterByDropdownText}\n                                    dropdownId='reviewsListFilterBy'\n                                    dropdownOptions={this.filterByDropdownOptions}\n                                    selectedOption={selectedFilterByOption}\n                                    onSelectOption={this.updateFilterByDropdown}\n                                    controlledByParent={true}\n                                />\n            ),\n            sortByDropdown: <LabeledDropdown labelText={resources.sortByDropdownText} dropdownId='reviewsListSortBy' dropdownOptions={this.sortByDropdownOptions} selectedOption={selectedSortByOption} onSelectOption={this.updateSortByDropdown}/>,\n            averageRating: ratingsSummary && (\n                <RatingComponent\n                    avgRating={ratingsSummary.averageRating || 0}\n                    readOnly={true}\n                    ariaLabel={format(resources.averageRatingAriaLabel, ratingsSummary.averageRating, '5')}\n                    ratingCount={`${ratingsSummary.reviewsCount}`}\n                    data={{}}\n                    context={this.props.context}\n                    id={this.props.id}\n                    typeName={this.props.typeName}\n                />\n            ),\n            reviewCount: <ReviewCount resources={{...this.props.resources}} currentPage={currentPage} reviewsCount={reviewsCount} reviewsShownOnEachPage={reviewsShownOnEachPage}/>,\n            refineReviewsProps: {className: 'ms-reviews-list__refiners'},\n            reviewsListProps: {className: 'ms-reviews-list__reviews'},\n            reviewCards: this._reviewCards(this.state.listOfReviews),\n            userReview: this._userReview(),\n            pageControls: (\n                        <PageControls\n                            resources={{...this.props.resources}}\n                            currentPage={currentPage}\n                            reviewsShownOnEachPage={reviewsShownOnEachPage}\n                            selectedSortByOption={selectedSortByOption}\n                            selectedFilterByOption={selectedFilterByOption}\n                            updateReviews={this.updateReviews}\n                            reviewsCount={reviewsCount}\n                            telemetryContent={this.telemetryContent}\n                        />),\n            noReviewsMessage: <span className='ms-reviews-list__empty-message' aria-live='polite'>{resources.noReviewsMessage}</span>,\n            noReviewsWithFilterMessage: <span className='ms-reviews-list__filter-message' aria-live='polite'>{resources.noReviewsWithSelectedFilterMessage}</span>,\n            heading: heading && (\n                <Msdyn365.Text\n                    className='ms-reviews-list__heading'\n                    tag={heading.tag || 'h2'}\n                    text={heading.text}\n                    editProps={{onEdit:this.handleHeadingChange, requestContext: this.props.context.request}}\n                />\n            ),\n            sortByOptions: this.sortByDropdownOptions,\n            filterByOptions: this.filterByDropdownOptions\n        } as IReviewsListViewProps;\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n\n    private _userReview = () => {\n        const userReview = this.props.data.userReview.result;\n\n        return userReview && this._reviewCard(userReview, true);\n    }\n\n    private _reviewCards = (reviewList: Review[]) => {\n        const userReview = this.props.data.userReview.result;\n        const reviewElements: IReviewCardViewProps[] = [];\n\n        for (const review of reviewList) {\n            if (!review.isTakenDown && review.isPublished && userReview ? review.reviewId !== userReview.reviewId : true) {\n                reviewElements.push(this._reviewCard(review, false));\n            }\n        }\n        return reviewElements;\n    };\n\n    private _reviewCard = (review: Review, userReview: boolean): IReviewCardViewProps => {\n        return ReviewCard({\n            review: review,\n            resources: {...this.props.resources},\n            context:  this.props.context,\n            isUserReview: userReview,\n            parentId: this.props.id,\n            parentType: this.props.typeName,\n            reportedReviews: this.state.reportedReviews,\n            returnRef: this._userReportModalToggle,\n            reportedReviewId: this.state.reportingReviewId,\n            toggleWriteReviewModal: this._toggleReviewModal,\n            toggleReportReviewModal: this._onReportModalOpen,\n            updateReviewHelpfulness: this.updateReviewHelpfulnessVote,\n            votedReviews: this.state.votedReviews\n        });\n    }\n\n    private _userReviewModal = (): IReviewModalViewProps => {\n        return ReviewModal({\n            userReview: this.props.data.userReview.result,\n            product: this.props.data.product.result,\n            resources: {...this.props.resources},\n            context: this.props.context,\n            parentId: this.props.id,\n            parentType: this.props.typeName,\n            isOpen: this.state.isReviewModalOpen,\n            rating: this.state.userReviewRating,\n            reviewTitle: this.state.userReviewTitle,\n            reviewText: this.state.userReviewText,\n            onModalToggle: this._toggleReviewModal,\n            onTitleChange: this._onTitleChange,\n            onTextChange: this._onTextChange,\n            onRatingChange: this._onRatingChange,\n            onReviewComplete: this._onReviewComplete,\n            renderContextId: 'writeReview-list',\n            returnRef: this._userReviewModalToggle,\n            hasError: this.state.hasReviewError\n        });\n    }\n\n    private _onTitleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n        this.reviewsListCallbacks.updateReviewTitle(event.target.value);\n    }\n\n    private _onTextChange = (event: React.ChangeEvent<HTMLTextAreaElement>): void => {\n        this.reviewsListCallbacks.updateReviewText(event.target.value);\n    }\n\n    private _onRatingChange = (value: number): void => {\n        this.reviewsListCallbacks.updateRating(value);\n    }\n\n    private _toggleReviewModal = (): void => {\n        const userReview = this.props.data.userReview.result;\n        if (this.state.isReviewModalOpen) {\n            this.setState({isReviewModalOpen: false, hasReviewError: false});\n\n        } else {\n            this.setState({\n                isReviewModalOpen: true,\n                userReviewText: userReview!.reviewText,\n                userReviewTitle: userReview!.title,\n                userReviewRating: userReview!.rating\n            });\n        }\n    }\n\n    private _onReviewComplete = (isSuccess: boolean): void => {\n        if (isSuccess) {\n            this.setState({isReviewModalOpen: false, hasReviewError: false});\n        } else {\n            this.setState({hasReviewError: true});\n        }\n    }\n\n    private _reportReviewModal = () => {\n        return ReportReviewModal({\n            resources: {...this.props.resources},\n            context:  this.props.context,\n            isOpen: this.state.isReportModalOpen,\n            returnRef: this._userReportModalToggle,\n            reportedKey: this.state.reportedKey,\n            onModalToggle: this._onReportModalClose,\n            onRadioChange: this._onRadioChange,\n            reportReview: this._reportReview,\n            hasError: this.state.hasReportError,\n            telemetryContent: this.telemetryContent\n        });\n    }\n\n    private _onReportModalOpen = (reviewId: string) => {\n        this.setState({isReportModalOpen: true, reportingReviewId: reviewId, reported: false, reportedKey: ReviewConcernCategory.SpamAdvertising});\n    }\n\n    private _onReportModalClose = () => {\n        this.setState({isReportModalOpen: false, hasReportError: false});\n    }\n\n    private _onRadioChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        this.setState({reportedKey: event.currentTarget.getAttribute('data-key') || ''});\n    }\n\n    private _reportReviewCallback = (reviewId: string, reportedKey: string) => {\n        reportReviewConcern(\n            new ReportReviewConcernInput(\n                reviewId,\n                getRnrPartnerId(this.props.context.actionContext),\n                this.props.context.request.locale,\n                reportedKey,\n                this.getUserToken(this.props.context.request),\n                getRnrAuthEndpointId(this.props.context.actionContext)\n            ),\n            this.props.context.actionContext\n        ).then(_value => {\n            const reportedReview = this.state.reportedReviews;\n            reportedReview.push(reviewId);\n            this.setState({reported: true, reportedReviews: reportedReview, hasReportError: false});\n        }).catch(_value => {\n            this.setState({hasReportError: true});\n        });\n    }\n\n    private _reportReview = () => {\n        this._reportReviewCallback(this.state.reportingReviewId, this.state.reportedKey);\n    }\n\n    private updateSortByDropdown = async (notification: ILabeledDropdownOnChangeNotification) => {\n        await this.updateReviews(0, notification.selectedOption, this.state.selectedFilterByOption, 1, this.state.isFilterApplied);\n    };\n\n    private updateFilterByDropdown = async (notification: ILabeledDropdownOnChangeNotification) => {\n        await this.updateReviews(0, this.state.selectedSortByOption, notification.selectedOption, 1, true);\n    };\n\n    private updateReviews = async (\n        skipItems: number | 0,\n        selectedSortByOption: ILabeledDropdownOption,\n        selectedFilterByOption: ILabeledDropdownOption,\n        currentPage: number,\n        isFilterApplied: boolean\n    ) => {\n        // @ts-ignore\n        const productId = getSelectedProductIdFromActionInput(this.props.context.actionContext);\n        if (productId === undefined) {\n            return;\n        }\n        const result = await getReviewsForGivenProduct(\n            // Task #211227597 Remove this hardcoded values.\n            new GetProductReviewsInput(\n                productId,\n                getRnrPartnerId(this.props.context.actionContext),\n                this.props.context.request.locale,\n                getRnrEndpointId(this.props.context.actionContext),\n                selectedSortByOption.key,\n                selectedFilterByOption.key,\n                skipItems < 0 ? 0 : skipItems\n            ),\n            this.props.context.actionContext\n        );\n        if (result && result.items && result.pagingInfo && result.pagingInfo.totalItems !== undefined) {\n            this.setState({\n                currentPage: currentPage,\n                listOfReviews: result.items,\n                selectedSortByOption,\n                selectedFilterByOption,\n                reviewsCount: result.pagingInfo.totalItems,\n                isFilterApplied: isFilterApplied\n            });\n        }\n    };\n\n    private _updateVoteUi = (reviewId: string, isHelpful: boolean): void => {\n        let alreadyExists = false;\n        let list = this.state.votedReviews.map((review) => {\n            if(review.reviewId === reviewId) {\n                review.approved = isHelpful;\n                alreadyExists = true;\n            }\n            return review;\n        });\n\n        if (!alreadyExists) {\n            list = list.concat({reviewId: reviewId, approved: isHelpful});\n        }\n\n        this.setState({votedReviews: list});\n    }\n\n    private updateReviewHelpfulnessVote = (reviewId: string, isHelpful: boolean): void => {\n        submitHelpfulnessVote(\n            new SubmitHelpfulnessVoteInput(\n                reviewId,\n                getRnrPartnerId(this.props.context.actionContext),\n                this.props.context.request.locale,\n                isHelpful,\n                this.getUserToken(this.props.context.request),\n                getRnrAuthEndpointId(this.props.context.actionContext)\n            ),\n            this.props.context.actionContext\n        ).then(() => {\n            this._updateVoteUi(reviewId, isHelpful);\n        });\n    };\n\n    private getUserToken = (context: Msdyn365.IRequestContext): string => {\n        return context && context.user && context.user.token;\n    };\n\n    // tslint:disable-next-line\n    private reviewsListCallbacks: IReviewsListCallbacks = {\n        updateReviewTitle: (title: string): void => {\n            this.setState({userReviewTitle: title});\n        },\n        updateReviewText: (text: string): void => {\n            this.setState({userReviewText: text});\n        },\n        updateRating: (rating: number): void => {\n            this.setState({userReviewRating: rating});\n        },\n        onReviewSubmitted: (isSuccessful: boolean): void => {\n            if (isSuccessful) {\n                this.setState({isReviewModalOpen: false, hasReviewError: false});\n            } else {\n                this.setState({hasReviewError: true});\n            }\n        },\n        submitReview: submitReview,\n        toggleModal: this._toggleReviewModal,\n        updateReviewHelpfulnessVote: this.updateReviewHelpfulnessVote,\n        toggleReportModal: (reviewId: string): void => {\n            this.state.isReportModalOpen? this._onReportModalOpen(reviewId) : this._onReportModalClose();\n        },\n        reportReview: this._reportReviewCallback,\n        updateFilterByDropdown: this.updateFilterByDropdown,\n        updateSortByDropdown: this.updateSortByDropdown,\n        updateReviews: this.updateReviews\n    };\n}\n\nexport default ReviewsList;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}