{"ast":null,"code":"import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{useEffect,useState}from'react';import{msdyn365Commerce}from'@msdyn365-commerce/core';const roundUpMin=0.75;const roundMidMin=0.25;const maxRating=5;const RatingComponentActions={onSliderChanged(event,props,setRating){const value=parseInt(event.target.value,10);setRating({rating:value,lastSelectedRating:value});if(props.onChange){props.onChange(value);}},onMouseLeave(_event,rating,setRating){setRating({rating:rating.lastSelectedRating,lastSelectedRating:rating.lastSelectedRating});},onMouseOver(event,rating,setRating){setRating({rating:getIndex(event),lastSelectedRating:rating.lastSelectedRating});},onClick(event,props,setRating){if(!props.readOnly){const index=getIndex(event);setRating({rating:index,lastSelectedRating:index});if(props.onChange){props.onChange(index);}}}};const Rating=props=>{const initialRating=props.readOnly?props.avgRating:props.initialRating||0;const[rating,setRating]=useState({rating:initialRating,lastSelectedRating:initialRating});useEffect(()=>{const newRating=props.readOnly?props.avgRating:props.initialRating||0;setRating({rating:newRating,lastSelectedRating:newRating});},[props]);const onChange=event=>RatingComponentActions.onSliderChanged(event,props,setRating);const onMouseLeave=event=>RatingComponentActions.onMouseLeave(event,rating,setRating);const onMouseOver=event=>RatingComponentActions.onMouseOver(event,rating,setRating);const onClick=event=>RatingComponentActions.onClick(event,props,setRating);return/*#__PURE__*/React.createElement(\"div\",{className:\"msc-rating  \".concat(rating.rating>0?'msc-no-ratings':'',\" \").concat(props.className?props.className:'')},starControl(props.readOnly,rating.rating,props.ariaLabel,onChange),/*#__PURE__*/React.createElement(\"div\",{\"aria-hidden\":true,onMouseLeave:props.readOnly?undefined:onMouseLeave,className:'msc-rating__group'},renderStars(rating.rating,props,onMouseOver,onClick)),props.ratingCount&&/*#__PURE__*/React.createElement(\"output\",{tabIndex:-1,\"aria-hidden\":true,className:'msc-rating__count'},\" \",props.typeName==='reviews-list'?\"\".concat(props.avgRating,\" / 5 (\").concat(props.ratingCount,\")\"):props.ratingCount,\" \"));};Rating.defaultProps={avgRating:0};const starControl=(readOnly,currentRating,ariaLabel,onChange)=>{if(readOnly){return/*#__PURE__*/React.createElement(\"div\",{className:'msc-rating__range sr-only'},ariaLabel);}return/*#__PURE__*/React.createElement(\"input\",{type:'range',className:'msc-rating__range',min:0,max:5,step:1,value:currentRating,\"aria-valuemax\":5,\"aria-valuemin\":0,\"aria-valuenow\":currentRating,onChange:onChange,\"aria-label\":ariaLabel});};const renderStars=(rating,props,mouseOver,onClick)=>{const floor=Math.floor(rating);const remainder=rating-floor;const filled=remainder<roundUpMin?floor:floor+1;const half=roundMidMin<=remainder&&remainder<roundUpMin?filled+1:0;const stars=[];for(let i=1;i<=maxRating;i++){const glyphClass=filled>=i?'msc-rating__star':half===i?'msc-rating__half-star':'msc-rating__empty-star';stars.push(/*#__PURE__*/React.createElement(\"span\",{className:glyphClass,\"data-index\":i,key:i,onMouseOver:props.readOnly?undefined:mouseOver,onClick:onClick,role:'presentation'}));}return stars;};const getIndex=event=>{const target=event.target;return parseInt(target.getAttribute('data-index'),10);};export const RatingComponent=msdyn365Commerce.createComponent('Rating',_objectSpread({component:Rating},RatingComponentActions));","map":{"version":3,"sources":["rating/rating.component.tsx"],"names":[],"mappings":"25BAAA,MAAO,CAAA,KAAP,EAAgB,SAAhB,CAA2B,QAA3B,KAA2C,OAA3C,CAEA,OAAsC,gBAAtC,KAA8D,yBAA9D,CAwBA,KAAM,CAAA,UAAU,CAAW,IAA3B,CACA,KAAM,CAAA,WAAW,CAAY,IAA7B,CACA,KAAM,CAAA,SAAS,CAAW,CAA1B,CAEA,KAAM,CAAA,sBAAsB,CAAG,CAC3B,eAAe,CAAC,KAAD,CAA6C,KAA7C,CAA2E,SAA3E,CAAoH,CAC/H,KAAM,CAAA,KAAK,CAAG,QAAQ,CAAC,KAAK,CAAC,MAAN,CAAa,KAAd,CAAqB,EAArB,CAAtB,CACA,SAAS,CAAC,CAAC,MAAM,CAAE,KAAT,CAAgB,kBAAkB,CAAE,KAApC,CAAD,CAAT,CAEA,GAAI,KAAK,CAAC,QAAV,CAAoB,CAChB,KAAK,CAAC,QAAN,CAAe,KAAf,EACH,CACJ,CAR0B,CAS3B,YAAY,CAAC,MAAD,CAA2B,MAA3B,CAAiD,SAAjD,CAA0F,CAClG,SAAS,CAAC,CAAC,MAAM,CAAE,MAAM,CAAC,kBAAhB,CAAoC,kBAAkB,CAAE,MAAM,CAAC,kBAA/D,CAAD,CAAT,CAEH,CAZ0B,CAa3B,WAAW,CAAC,KAAD,CAAuC,MAAvC,CAA6D,SAA7D,CAAsG,CAC7G,SAAS,CAAC,CAAC,MAAM,CAAE,QAAQ,CAAC,KAAD,CAAjB,CAA0B,kBAAkB,CAAE,MAAM,CAAC,kBAArD,CAAD,CAAT,CACH,CAf0B,CAgB3B,OAAO,CAAC,KAAD,CAAwC,KAAxC,CAAsE,SAAtE,CAA+G,CAClH,GAAI,CAAC,KAAK,CAAC,QAAX,CAAqB,CACjB,KAAM,CAAA,KAAK,CAAG,QAAQ,CAAC,KAAD,CAAtB,CACA,SAAS,CAAC,CAAC,MAAM,CAAE,KAAT,CAAgB,kBAAkB,CAAE,KAApC,CAAD,CAAT,CAEA,GAAI,KAAK,CAAC,QAAV,CAAoB,CAChB,KAAK,CAAC,QAAN,CAAe,KAAf,EACH,CACJ,CACJ,CAzB0B,CAA/B,CA4BA,KAAM,CAAA,MAAM,CAAqC,KAAD,EAAiC,CAC7E,KAAM,CAAA,aAAa,CAAG,KAAK,CAAC,QAAN,CAAiB,KAAK,CAAC,SAAvB,CAAmC,KAAK,CAAC,aAAN,EAAuB,CAAhF,CACA,KAAM,CAAC,MAAD,CAAS,SAAT,EAAsB,QAAQ,CAAC,CAAC,MAAM,CAAE,aAAT,CAAwB,kBAAkB,CAAE,aAA5C,CAAD,CAApC,CACA,SAAS,CACL,IAAK,CACD,KAAM,CAAA,SAAS,CAAG,KAAK,CAAC,QAAN,CAAiB,KAAK,CAAC,SAAvB,CAAmC,KAAK,CAAC,aAAN,EAAuB,CAA5E,CACA,SAAS,CAAC,CAAC,MAAM,CAAE,SAAT,CAAoB,kBAAkB,CAAE,SAAxC,CAAD,CAAT,CACH,CAJI,CAKL,CAAC,KAAD,CALK,CAAT,CAOA,KAAM,CAAA,QAAQ,CAAI,KAAD,EAAgD,sBAAsB,CAAC,eAAvB,CAAuC,KAAvC,CAA8C,KAA9C,CAAqD,SAArD,CAAjE,CACA,KAAM,CAAA,YAAY,CAAI,KAAD,EAA6B,sBAAsB,CAAC,YAAvB,CAAoC,KAApC,CAA2C,MAA3C,CAAmD,SAAnD,CAAlD,CACA,KAAM,CAAA,WAAW,CAAI,KAAD,EAA0C,sBAAsB,CAAC,WAAvB,CAAmC,KAAnC,CAA0C,MAA1C,CAAkD,SAAlD,CAA9D,CACA,KAAM,CAAA,OAAO,CAAI,KAAD,EAA0C,sBAAsB,CAAC,OAAvB,CAA+B,KAA/B,CAAsC,KAAtC,CAA6C,SAA7C,CAA1D,CAEA,mBACI,KAAA,CAAA,aAAA,CAAA,KAAA,CAAA,CAAK,SAAS,uBAAiB,MAAM,CAAC,MAAP,CAAgB,CAAhB,CAAoB,gBAApB,CAAuC,EAAxD,aAA8D,KAAK,CAAC,SAAN,CAAkB,KAAK,CAAC,SAAxB,CAAoC,EAAlG,CAAd,CAAA,CACK,WAAW,CAAC,KAAK,CAAC,QAAP,CAAiB,MAAM,CAAC,MAAxB,CAAgC,KAAK,CAAC,SAAtC,CAAiD,QAAjD,CADhB,cAEI,KAAA,CAAA,aAAA,CAAA,KAAA,CAAA,CAAA,cAAkB,IAAlB,CAAwB,YAAY,CAAE,KAAK,CAAC,QAAN,CAAiB,SAAjB,CAA6B,YAAnE,CAAiF,SAAS,CAAC,mBAA3F,CAAA,CACK,WAAW,CAAC,MAAM,CAAC,MAAR,CAAgB,KAAhB,CAAuB,WAAvB,CAAoC,OAApC,CADhB,CAFJ,CAKM,KAAK,CAAC,WAAN,eAAqB,KAAA,CAAA,aAAA,CAAA,QAAA,CAAA,CAAQ,QAAQ,CAAE,CAAC,CAAnB,CAAoB,cAAe,IAAnC,CAAyC,SAAS,CAAC,mBAAnD,CAAA,C,GAAA,CAAyE,KAAK,CAAC,QAAN,GAAmB,cAAnB,WAAuC,KAAK,CAAC,SAA7C,kBAA+D,KAAK,CAAC,WAArE,MAAqF,KAAK,CAAC,WAApK,CAA0L,GAA1L,CAL3B,CADJ,CASH,CAxBD,CA2BA,MAAM,CAAC,YAAP,CAAsB,CAClB,SAAS,CAAE,CADO,CAAtB,CAIA,KAAM,CAAA,WAAW,CAAG,CAAC,QAAD,CAAoB,aAApB,CAA2C,SAA3C,CAA8D,QAA9D,GAA6I,CAC7J,GAAI,QAAJ,CAAc,CACV,mBAAO,KAAA,CAAA,aAAA,CAAA,KAAA,CAAA,CAAK,SAAS,CAAC,2BAAf,CAAA,CAA4C,SAA5C,CAAP,CACH,CAED,mBACI,KAAA,CAAA,aAAA,CAAA,OAAA,CAAA,CACI,IAAI,CAAC,OADT,CAEI,SAAS,CAAC,mBAFd,CAGI,GAAG,CAAE,CAHT,CAII,GAAG,CAAE,CAJT,CAKI,IAAI,CAAE,CALV,CAMI,KAAK,CAAE,aANX,CAMwB,gBACL,CAPnB,CAOoB,gBACD,CARnB,CAQoB,gBACD,aATnB,CAUI,QAAQ,CAAE,QAVd,CAUsB,aACN,SAXhB,CAAA,CADJ,CAeH,CApBD,CAsBA,KAAM,CAAA,WAAW,CAAG,CAAC,MAAD,CAAiB,KAAjB,CAA+C,SAA/C,CAA2G,OAA3G,GAAqL,CACrM,KAAM,CAAA,KAAK,CAAG,IAAI,CAAC,KAAL,CAAW,MAAX,CAAd,CACA,KAAM,CAAA,SAAS,CAAI,MAAM,CAAG,KAA5B,CACA,KAAM,CAAA,MAAM,CAAG,SAAS,CAAG,UAAZ,CAAyB,KAAzB,CAAiC,KAAK,CAAG,CAAxD,CACA,KAAM,CAAA,IAAI,CAAI,WAAW,EAAI,SAAf,EAA4B,SAAS,CAAG,UAAxC,CAAoD,MAAM,CAAG,CAA7D,CAAiE,CAA/E,CACA,KAAM,CAAA,KAAK,CAAG,EAAd,CAEA,IAAK,GAAI,CAAA,CAAC,CAAG,CAAb,CAAgB,CAAC,EAAI,SAArB,CAAgC,CAAC,EAAjC,CAAqC,CACjC,KAAM,CAAA,UAAU,CAAG,MAAM,EAAI,CAAV,CAAc,kBAAd,CAAmC,IAAI,GAAK,CAAT,CAAa,uBAAb,CAAuC,wBAA7F,CACA,KAAK,CAAC,IAAN,cAAW,KAAA,CAAA,aAAA,CAAA,MAAA,CAAA,CAAM,SAAS,CAAE,UAAjB,CAA2B,aAAc,CAAzC,CAA4C,GAAG,CAAE,CAAjD,CAAoD,WAAW,CAAE,KAAK,CAAC,QAAN,CAAiB,SAAjB,CAA6B,SAA9F,CAAyG,OAAO,CAAE,OAAlH,CAA2H,IAAI,CAAC,cAAhI,CAAA,CAAX,EACH,CAED,MAAO,CAAA,KAAP,CACH,CAbD,CAeA,KAAM,CAAA,QAAQ,CAAI,KAAD,EAAiD,CAC9D,KAAM,CAAA,MAAM,CAAG,KAAK,CAAC,MAArB,CACA,MAAO,CAAA,QAAQ,CAAC,MAAM,CAAC,YAAP,CAAoB,YAApB,CAAD,CAAqC,EAArC,CAAf,CACH,CAHD,CAMA,MAAO,MAAM,CAAA,eAAe,CAAmD,gBAAgB,CAAC,eAAjB,CAC3E,QAD2E,gBAEzE,SAAS,CAAE,MAF8D,EAEnD,sBAFmD,EAAxE","sourcesContent":["import React, { useEffect, useState } from 'react';\n\nimport { IComponent, IComponentProps, msdyn365Commerce } from '@msdyn365-commerce/core';\n\nexport interface IRatingComponentProps extends IComponentProps<{}> {\n    readOnly: boolean;\n    ariaLabel: string;\n    avgRating: number;\n    ratingCount?: string;\n    initialRating?: number;\n    hideCount?: boolean;\n    className?: string;\n    onChange?(value: number): void;\n}\nexport interface IRatingComponent extends IComponent<IRatingComponentProps> {\n    onSliderChanged(): (event: React.ChangeEvent<HTMLInputElement>, props: IRatingComponentProps, setRating: (rating: IRatingState) => void) => void;\n    onMouseOver(): (event: React.MouseEvent<HTMLElement>, rating: IRatingState, setRating: (rating: IRatingState) => void) => void;\n    onClick(): (event: React.MouseEvent<HTMLElement>,  props: IRatingComponentProps, setRating: (rating: IRatingState) => void) => void;\n    onMouseLeave(): (event: React.MouseEvent, rating: IRatingState, setRating: (rating: IRatingState) => void) => void;\n}\n\ninterface IRatingState {\n    rating: number;\n    lastSelectedRating: number;\n}\n\nconst roundUpMin: number = 0.75;\nconst roundMidMin: number  = 0.25;\nconst maxRating: number = 5;\n\nconst RatingComponentActions = {\n    onSliderChanged(event: React.ChangeEvent<HTMLInputElement>, props: IRatingComponentProps, setRating: (rating: IRatingState) => void): void {\n        const value = parseInt(event.target.value, 10);\n        setRating({rating: value, lastSelectedRating: value});\n\n        if (props.onChange) {\n            props.onChange(value);\n        }\n    },\n    onMouseLeave(_event: React.MouseEvent, rating: IRatingState, setRating: (rating: IRatingState) => void): void {\n        setRating({rating: rating.lastSelectedRating, lastSelectedRating: rating.lastSelectedRating});\n\n    },\n    onMouseOver(event: React.MouseEvent<HTMLElement>, rating: IRatingState, setRating: (rating: IRatingState) => void): void {\n        setRating({rating: getIndex(event), lastSelectedRating: rating.lastSelectedRating});\n    },\n    onClick(event: React.MouseEvent<HTMLElement>,  props: IRatingComponentProps, setRating: (rating: IRatingState) => void): void {\n        if (!props.readOnly) {\n            const index = getIndex(event);\n            setRating({rating: index, lastSelectedRating: index});\n\n            if (props.onChange) {\n                props.onChange(index);\n            }\n        }\n    }\n};\n\nconst Rating: React.FC<IRatingComponentProps> = (props: IRatingComponentProps) => {\n    const initialRating = props.readOnly ? props.avgRating : props.initialRating || 0;\n    const [rating, setRating] = useState({rating: initialRating, lastSelectedRating: initialRating});\n    useEffect(\n        () => {\n            const newRating = props.readOnly ? props.avgRating : props.initialRating || 0;\n            setRating({rating: newRating, lastSelectedRating: newRating});\n        },\n        [props]\n    );\n    const onChange = (event: React.ChangeEvent<HTMLInputElement>) => RatingComponentActions.onSliderChanged(event, props, setRating);\n    const onMouseLeave = (event: React.MouseEvent) => RatingComponentActions.onMouseLeave(event, rating, setRating);\n    const onMouseOver = (event: React.MouseEvent<HTMLElement>) => RatingComponentActions.onMouseOver(event, rating, setRating);\n    const onClick = (event: React.MouseEvent<HTMLElement>) => RatingComponentActions.onClick(event, props, setRating);\n\n    return (\n        <div className={`msc-rating  ${rating.rating > 0 ? 'msc-no-ratings' : ''} ${props.className ? props.className : ''}`}>\n            {starControl(props.readOnly, rating.rating, props.ariaLabel, onChange)}\n            <div aria-hidden={true} onMouseLeave={props.readOnly ? undefined : onMouseLeave} className='msc-rating__group'>\n                {renderStars(rating.rating, props, onMouseOver, onClick)}\n            </div>\n            { props.ratingCount && <output tabIndex={-1} aria-hidden={true} className='msc-rating__count'> {props.typeName === 'reviews-list' ? `${props.avgRating} / 5 (${props.ratingCount})`: props.ratingCount} </output> }\n        </div>\n    );\n};\n\n// Set default props\nRating.defaultProps = {\n    avgRating: 0\n} as Partial<IRatingComponentProps>;\n\nconst starControl = (readOnly: boolean, currentRating: number, ariaLabel: string, onChange: (event: React.ChangeEvent<HTMLInputElement>) => void): JSX.Element => {\n    if (readOnly) {\n        return <div className='msc-rating__range sr-only'>{ariaLabel}</div>;\n    }\n\n    return (\n        <input\n            type='range'\n            className='msc-rating__range'\n            min={0}\n            max={5}\n            step={1}\n            value={currentRating}\n            aria-valuemax={5}\n            aria-valuemin={0}\n            aria-valuenow={currentRating}\n            onChange={onChange}\n            aria-label={ariaLabel}\n        />\n    );\n};\n\nconst renderStars = (rating: number, props: IRatingComponentProps, mouseOver: (event: React.MouseEvent<HTMLElement>) => void,  onClick: (event: React.MouseEvent<HTMLElement>) => void): JSX.Element[] => {\n    const floor = Math.floor(rating);\n    const remainder  = rating - floor;\n    const filled = remainder < roundUpMin ? floor : floor + 1;\n    const half =  roundMidMin <= remainder && remainder < roundUpMin? filled + 1 : 0;\n    const stars = [];\n\n    for (let i = 1; i <= maxRating; i++) {\n        const glyphClass = filled >= i ? 'msc-rating__star' : half === i ? 'msc-rating__half-star' : 'msc-rating__empty-star'!;\n        stars.push(<span className={glyphClass} data-index={i} key={i} onMouseOver={props.readOnly ? undefined : mouseOver} onClick={onClick} role='presentation'/>);\n    }\n\n    return stars;\n};\n\nconst getIndex = (event: React.MouseEvent<HTMLElement>): number => {\n    const target = event.target as HTMLElement;\n    return parseInt(target.getAttribute('data-index')!, 10);\n};\n\n// @ts-ignore\nexport const RatingComponent: React.FunctionComponent<IRatingComponentProps> = msdyn365Commerce.createComponent<IRatingComponent>(\n    'Rating',\n    { component: Rating, ...RatingComponentActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}