{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{createObservableDataAction}from'@msdyn365-commerce/core';import{readAsync,updateAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CustomersDataActions.g';import{GetCustomerInput}from'./get-customer';import{buildCacheKey}from'./index';/**\r\n *  Input class for the updateCustomerAttributes\r\n */export class updateCustomerAttributesInput{constructor(userAccountNumber,customerAttributes,apiSettings,phone,vatNumber){this.getCacheKey=()=>buildCacheKey(\"\".concat(this.userAccountNumber),this.apiSettings);this.getCacheObjectType=()=>'Customer';this.dataCacheType=()=>'none';this.userAccountNumber=userAccountNumber;this.apiSettings=apiSettings;this.customerAttributes=customerAttributes;this.phone=phone;this.vatNumber=vatNumber;}}/**\r\n * The action method for the updateCustomerAttributes data action\r\n * @param input The action input\r\n * @param ctx The action context\r\n */export async function updateCustomerAttributesAction(input,ctx){const{customerAttributes,phone,vatNumber,userAccountNumber}=input;const customer=await readAsync({callerContext:ctx},userAccountNumber);if(!customer){ctx.telemetry.debug('[update-customer-attributes] Unable to find customer');throw new Error('Unable to find customer');}const newCustomer=_objectSpread({},customer);newCustomer.Phone=phone;newCustomer.VatNumber=vatNumber;newCustomer.Attributes=customerAttributes;const updatedCustomer=await updateAsync({callerContext:ctx},newCustomer);if(!updatedCustomer){ctx.telemetry.debug('[update-customer-attributes] Unable to update customer attributes');throw new Error('Unable to update customer attributes');}ctx.update(new GetCustomerInput(ctx.requestContext.apiSettings),updatedCustomer);return updatedCustomer;}/**\r\n * The updateCustomerAttributes data action\r\n * Returns the updated customer\r\n */export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/update-customer-attributes',action:updateCustomerAttributesAction});","map":{"version":3,"sources":["../../src/update-customer-attributes.ts"],"names":[],"mappings":"y4BAAA,OACe,0BADf,KAGO,yBAHP,CAKA,OACI,SADJ,CACe,WADf,KAEO,yEAFP,CAIA,OAAS,gBAAT,KAAiC,gBAAjC,CACA,OAAS,aAAT,KAA8B,SAA9B,CAUA;;AAEG,GACH,MAAM,MAAO,CAAA,6BAA6B,CAOtC,WAAA,CAAY,iBAAZ,CAAuC,kBAAvC,CAAgF,WAAhF,CAAmH,KAAnH,CAAmI,SAAnI,CAAqJ,CAQ9I,KAAA,WAAA,CAAc,IAAc,aAAa,WAAI,KAAK,iBAAT,EAA8B,KAAK,WAAnC,CAAzC,CACA,KAAA,kBAAA,CAAqB,IAAM,UAA3B,CACA,KAAA,aAAA,CAAgB,IAAiB,MAAjC,CATH,KAAK,iBAAL,CAAyB,iBAAzB,CACA,KAAK,WAAL,CAAmB,WAAnB,CACA,KAAK,kBAAL,CAA0B,kBAA1B,CACA,KAAK,KAAL,CAAa,KAAb,CACA,KAAK,SAAL,CAAiB,SAAjB,CACH,CAbqC,CAoB1C;;;;AAIG,GACH,MAAO,eAAe,CAAA,8BAAf,CAA8C,KAA9C,CAAqF,GAArF,CAAwG,CAC3G,KAAM,CAAE,kBAAF,CAAsB,KAAtB,CAA6B,SAA7B,CAAwC,iBAAxC,EAA8D,KAApE,CAEA,KAAM,CAAA,QAAQ,CAAG,KAAM,CAAA,SAAS,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,iBAAzB,CAAhC,CAEA,GAAI,CAAC,QAAL,CAAe,CACX,GAAG,CAAC,SAAJ,CAAc,KAAd,CAAoB,sDAApB,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,yBAAV,CAAN,CACH,CAED,KAAM,CAAA,WAAW,kBAAQ,QAAR,CAAjB,CACA,WAAW,CAAC,KAAZ,CAAoB,KAApB,CACA,WAAW,CAAC,SAAZ,CAAwB,SAAxB,CACA,WAAW,CAAC,UAAZ,CAAyB,kBAAzB,CAEA,KAAM,CAAA,eAAe,CAAG,KAAM,CAAA,WAAW,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,WAAzB,CAAzC,CAEA,GAAI,CAAC,eAAL,CAAsB,CAClB,GAAG,CAAC,SAAJ,CAAc,KAAd,CAAoB,mEAApB,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,sCAAV,CAAN,CACH,CAED,GAAG,CAAC,MAAJ,CAAW,GAAI,CAAA,gBAAJ,CAAqB,GAAG,CAAC,cAAJ,CAAmB,WAAxC,CAAX,CAAiE,eAAjE,EAEA,MAAO,CAAA,eAAP,CACH,CAED;;;AAGG,GACH,cAAe,CAAA,0BAA0B,CAAW,CAChD,EAAE,CAAE,sEAD4C,CAEhD,MAAM,CAAqB,8BAFqB,CAAX,CAAzC","sourcesContent":["import {\n    CacheType, createObservableDataAction, IAction, IActionContext, IActionInput,\n    ICommerceApiSettings\n} from '@msdyn365-commerce/core';\nimport { Customer, CustomerAttribute } from '@msdyn365-commerce/retail-proxy';\nimport {\n    readAsync, updateAsync\n} from '@msdyn365-commerce/retail-proxy/dist/DataActions/CustomersDataActions.g';\n\nimport { GetCustomerInput } from './get-customer';\nimport { buildCacheKey } from './index';\n\nexport interface IUpdateCustomerAttributesInput extends IActionInput {\n    phone?: string,\n    vatNumber?: string;\n    customerAttributes: CustomerAttribute[];\n    userAccountNumber: string;\n    apiSettings: ICommerceApiSettings;\n}\n\n/**\n *  Input class for the updateCustomerAttributes\n */\nexport class updateCustomerAttributesInput implements IUpdateCustomerAttributesInput {\n    public userAccountNumber: string;\n    public customerAttributes: CustomerAttribute[];\n    public apiSettings: ICommerceApiSettings;\n    public phone?: string;\n    public vatNumber?: string;\n\n    constructor(userAccountNumber: string, customerAttributes: CustomerAttribute[], apiSettings: ICommerceApiSettings, phone?: string, vatNumber?: string) {\n        this.userAccountNumber = userAccountNumber;\n        this.apiSettings = apiSettings;\n        this.customerAttributes = customerAttributes;\n        this.phone = phone;\n        this.vatNumber = vatNumber;\n    }\n\n    public getCacheKey = (): string => buildCacheKey(`${this.userAccountNumber}`, this.apiSettings);\n    public getCacheObjectType = () => 'Customer';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * The action method for the updateCustomerAttributes data action\n * @param input The action input\n * @param ctx The action context\n */\nexport async function updateCustomerAttributesAction(input: IUpdateCustomerAttributesInput, ctx: IActionContext): Promise<Customer> {\n    const { customerAttributes, phone, vatNumber, userAccountNumber } = input;\n\n    const customer = await readAsync({ callerContext: ctx }, userAccountNumber);\n\n    if (!customer) {\n        ctx.telemetry.debug('[update-customer-attributes] Unable to find customer');\n        throw new Error('Unable to find customer');\n    }\n\n    const newCustomer = { ...customer };\n    newCustomer.Phone = phone;\n    newCustomer.VatNumber = vatNumber;\n    newCustomer.Attributes = customerAttributes;\n\n    const updatedCustomer = await updateAsync({ callerContext: ctx }, newCustomer);\n\n    if (!updatedCustomer) {\n        ctx.telemetry.debug('[update-customer-attributes] Unable to update customer attributes');\n        throw new Error('Unable to update customer attributes');\n    }\n\n    ctx.update(new GetCustomerInput(ctx.requestContext.apiSettings), updatedCustomer);\n\n    return updatedCustomer;\n}\n\n/**\n * The updateCustomerAttributes data action\n * Returns the updated customer\n */\nexport default createObservableDataAction<Customer>({\n    id: '@msdyn365-commerce-modules/retail-actions/update-customer-attributes',\n    action: <IAction<Customer>>updateCustomerAttributesAction\n});"],"sourceRoot":""},"metadata":{},"sourceType":"module"}