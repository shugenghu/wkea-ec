{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{getCurrentAsync,getUsersAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/BusinessPartnersDataActions.g';/**\r\n * Input class for get customer data action\r\n */export var OrganizationUsersCountInput=function OrganizationUsersCountInput(){_classCallCheck(this,OrganizationUsersCountInput);this.getCacheKey=function(){return'OrganizationUsersCount';};this.getCacheObjectType=function(){return'BusinessPartner';};this.dataCacheType=function(){return'none';};};export var createGetOrganizationUsersCountInput=function createGetOrganizationUsersCountInput(inputData){var requestContext=inputData.requestContext;// Check if the user is authenticated.\nif(!requestContext.user.isAuthenticated){throw new Error('User is not logged in.');}return new OrganizationUsersCountInput();};export function getOrganizationUsersCount(_x,_x2){return _getOrganizationUsersCount.apply(this,arguments);}function _getOrganizationUsersCount(){_getOrganizationUsersCount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",getCurrentAsync({callerContext:ctx}).then(function(businessPartner){if(!businessPartner){return 0;}return getUsersAsync({callerContext:ctx},businessPartner.BusinessPartnerId).then(function(users){return users.length;})[\"catch\"](function(error){ctx.telemetry.exception(error);ctx.trace('[get-organization-users-count] Unable to load users');throw new Error('[get-organization-users-count] Unable to load users');});})[\"catch\"](function(error){ctx.telemetry.exception(error);ctx.telemetry.debug('[get-organization-users-count] Unable to get BusinessPartner');throw new Error('[get-organization-users-count] Unable to get BusinessPartner');}));case 1:case\"end\":return _context.stop();}}},_callee);}));return _getOrganizationUsersCount.apply(this,arguments);}export default createObservableDataAction({id:'get-organization-users-count',action:getOrganizationUsersCount,input:createGetOrganizationUsersCountInput});","map":{"version":3,"sources":["../../src/get-organization-users-count.ts"],"names":[],"mappings":"8MACA,OAAS,0BAAT,KAAiF,yBAAjF,CACA,OAAS,eAAT,CAA0B,aAA1B,KAA+C,gFAA/C,CAEA;;AAEG,GACH,UAAa,CAAA,2BAAb,CAAA,sCAAA,mDACW,KAAA,WAAA,CAAc,iBAAM,wBAAN,EAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,iBAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,MAAjB,EAAhB,CACV,CAJD,CAMA,MAAO,IAAM,CAAA,oCAAoC,CAAG,QAAvC,CAAA,oCAAuC,CAAC,SAAD,CAAkD,IAC1F,CAAA,cAD0F,CACvE,SADuE,CAC1F,cAD0F,CAGlG;AACA,GAAI,CAAC,cAAc,CAAC,IAAf,CAAoB,eAAzB,CAA0C,CACtC,KAAM,IAAI,CAAA,KAAJ,CAAU,wBAAV,CAAN,CACH,CAED,MAAO,IAAI,CAAA,2BAAJ,EAAP,CACH,CATM,CAWP,eAAsB,CAAA,yBAAtB,kE,yHAAO,iBAAyC,KAAzC,CAA6E,GAA7E,kJACI,eAAe,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAf,CACF,IADE,CACG,SAAA,eAAe,CAAG,CACpB,GAAI,CAAC,eAAL,CAAsB,CAClB,MAAO,EAAP,CACH,CAED,MAAO,CAAA,aAAa,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,eAAe,CAAC,iBAAzC,CAAb,CACF,IADE,CACG,SAAC,KAAD,CAAU,CACZ,MAAO,CAAA,KAAK,CAAC,MAAb,CACH,CAHE,WAII,SAAA,KAAK,CAAG,CACX,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,GAAG,CAAC,KAAJ,CAAU,qDAAV,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,qDAAV,CAAN,CACH,CARE,CAAP,CASH,CAfE,WAgBI,SAAA,KAAK,CAAG,CACX,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,GAAG,CAAC,SAAJ,CAAc,KAAd,CAAoB,8DAApB,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,8DAAV,CAAN,CACH,CApBE,CADJ,wD,4DAuBP,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,8BADkC,CAEtC,MAAM,CAA4B,yBAFI,CAGtC,KAAK,CAAE,oCAH+B,CAAD,CAAzC","sourcesContent":["import { CacheType, IAction, IActionInput } from '@msdyn365-commerce/core';\nimport { createObservableDataAction, IActionContext, ICreateActionContext } from '@msdyn365-commerce/core';\nimport { getCurrentAsync, getUsersAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/BusinessPartnersDataActions.g';\n\n/**\n * Input class for get customer data action\n */\nexport class OrganizationUsersCountInput implements IActionInput {\n    public getCacheKey = () => 'OrganizationUsersCount';\n    public getCacheObjectType = () => 'BusinessPartner';\n    public dataCacheType = (): CacheType => 'none';\n}\n\nexport const createGetOrganizationUsersCountInput = (inputData: ICreateActionContext): IActionInput => {\n    const { requestContext } = inputData;\n\n    // Check if the user is authenticated.\n    if (!requestContext.user.isAuthenticated) {\n        throw new Error('User is not logged in.');\n    }\n\n    return new OrganizationUsersCountInput();\n};\n\nexport async function getOrganizationUsersCount(input: OrganizationUsersCountInput, ctx: IActionContext): Promise<Number> {\n    return getCurrentAsync({ callerContext: ctx })\n        .then(businessPartner => {\n            if (!businessPartner) {\n                return 0;\n            }\n\n            return getUsersAsync({ callerContext: ctx }, businessPartner.BusinessPartnerId)\n                .then((users) => {\n                    return users.length;\n                })\n                .catch(error => {\n                    ctx.telemetry.exception(error);\n                    ctx.trace('[get-organization-users-count] Unable to load users');\n                    throw new Error('[get-organization-users-count] Unable to load users');\n                });\n        })\n        .catch(error => {\n            ctx.telemetry.exception(error);\n            ctx.telemetry.debug('[get-organization-users-count] Unable to get BusinessPartner');\n            throw new Error('[get-organization-users-count] Unable to get BusinessPartner');\n        });\n}\nexport default createObservableDataAction({\n    id: 'get-organization-users-count',\n    action: <IAction<Number>><unknown>getOrganizationUsersCount,\n    input: createGetOrganizationUsersCountInput\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}