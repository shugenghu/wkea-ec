{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import{buildCacheKeyWithUrlTokens,CurrentCategoryInput,getCategoryUrl,getCurrentCategory}from'@msdyn365-commerce-modules/retail-actions';import{createObservableDataAction,getFriendlyName}from'@msdyn365-commerce/core';export class CategoryPageSummaryInput{constructor(config,requestContext){this.getCacheObjectType=()=>'CategoryPageSummary';this.getCacheKey=()=>buildCacheKeyWithUrlTokens('CategoryPageSummary',this.requestContext);this.dataCacheType=()=>'request';this.config=config||{};this.requestContext=requestContext;}}const createGetCurrentCategoryInput=inputData=>{if(inputData&&inputData.requestContext){return new CurrentCategoryInput(inputData.requestContext);}throw new Error('Please specify categoryId query string in request.');};const action=async(input,context)=>{const{config}=input;let currentCategory;try{currentCategory=await getCurrentCategory(createGetCurrentCategoryInput(context),context);}catch(e){}if(currentCategory){let categoryUrl;try{const localName=getFriendlyName(context.requestContext.locale,currentCategory.NameTranslations);const neutralizedName=currentCategory.NeutralizedName||currentCategory.Name;currentCategory.Name=localName;currentCategory.NeutralizedName=neutralizedName;categoryUrl=getCategoryUrl(currentCategory);const canonicalDomain=context.requestContext.canonicalDomain;if(categoryUrl&&canonicalDomain){categoryUrl=\"https://\".concat(canonicalDomain).concat(categoryUrl);}else{categoryUrl=undefined;}}catch(e){categoryUrl=undefined;}return{title:currentCategory.Name,sharingImageUrl:currentCategory.OfflineImage,canonicalUrl:categoryUrl,faviconUrl:config&&config.faviconUrl};}else if(config){return{title:config.title,sharingImageUrl:config.sharingImage&&config.sharingImage.src,faviconUrl:config&&config.faviconUrl};}else{return{};}};export default createObservableDataAction({id:'@msdyn365-commerce-modules/page-summary/category-page-summary',action:action,input:args=>{return new CategoryPageSummaryInput(args.config,args.requestContext);}});","map":{"version":3,"sources":["modules/category-page-summary/category-page-summary.action.ts"],"names":[],"mappings":"sCAAA,OAAS,0BAAT,CAAqC,oBAArC,CAA2D,cAA3D,CAA2E,kBAA3E,KAAqG,2CAArG,CACA,OAEI,0BAFJ,CAGI,eAHJ,KASO,yBATP,CAcA,MAAM,MAAO,CAAA,wBAAwB,CAIjC,WAAA,CAAY,MAAZ,CAA+C,cAA/C,CAA8E,CAKvE,KAAA,kBAAA,CAAqB,IAAc,qBAAnC,CACA,KAAA,WAAA,CAAc,IAAc,0BAA0B,CAAC,qBAAD,CAAwB,KAAK,cAA7B,CAAtD,CACA,KAAA,aAAA,CAAgB,IAAiB,SAAjC,CANH,KAAK,MAAL,CAAc,MAAM,EAAI,EAAxB,CACA,KAAK,cAAL,CAAsB,cAAtB,CACH,CAPgC,CAcrC,KAAM,CAAA,6BAA6B,CAAI,SAAD,EAAoD,CACtF,GAAI,SAAS,EAAI,SAAS,CAAC,cAA3B,CAA2C,CACvC,MAAO,IAAI,CAAA,oBAAJ,CAAyB,SAAS,CAAC,cAAnC,CAAP,CACH,CAED,KAAM,IAAI,CAAA,KAAJ,CAAU,oDAAV,CAAN,CACH,CAND,CAQA,KAAM,CAAA,MAAM,CAAG,MAAO,KAAP,CAAwC,OAAxC,GAA8F,CACzG,KAAM,CAAE,MAAF,EAAa,KAAnB,CACA,GAAI,CAAA,eAAJ,CACA,GAAI,CACA,eAAe,CAAG,KAAM,CAAA,kBAAkB,CAAC,6BAA6B,CAAC,OAAD,CAA9B,CAAyC,OAAzC,CAA1C,CACH,CAAC,MAAO,CAAP,CAAU,CAEX,CACD,GAAI,eAAJ,CAAqB,CACjB,GAAI,CAAA,WAAJ,CACA,GAAI,CAEA,KAAM,CAAA,SAAS,CAAG,eAAe,CAAC,OAAO,CAAC,cAAR,CAAuB,MAAxB,CAAgC,eAAe,CAAC,gBAAhD,CAAjC,CACA,KAAM,CAAA,eAAe,CAAG,eAAe,CAAC,eAAhB,EAAmC,eAAe,CAAC,IAA3E,CACA,eAAe,CAAC,IAAhB,CAAuB,SAAvB,CACA,eAAe,CAAC,eAAhB,CAAkC,eAAlC,CACA,WAAW,CAAG,cAAc,CAAC,eAAD,CAA5B,CAEA,KAAM,CAAA,eAAe,CAAG,OAAO,CAAC,cAAR,CAAuB,eAA/C,CACA,GAAI,WAAW,EAAI,eAAnB,CAAoC,CAChC,WAAW,mBAAc,eAAd,SAAgC,WAAhC,CAAX,CACH,CAFD,IAEO,CACH,WAAW,CAAG,SAAd,CACH,CACJ,CAAC,MAAO,CAAP,CAAU,CACR,WAAW,CAAG,SAAd,CACH,CACD,MAAO,CACH,KAAK,CAAE,eAAe,CAAC,IADpB,CAEH,eAAe,CAAE,eAAe,CAAC,YAF9B,CAGH,YAAY,CAAE,WAHX,CAIH,UAAU,CAAE,MAAM,EAAI,MAAM,CAAC,UAJ1B,CAAP,CAOH,CA1BD,IA0BO,IAAI,MAAJ,CAAY,CACf,MAAO,CACH,KAAK,CAAE,MAAM,CAAC,KADX,CAEH,eAAe,CAAE,MAAM,CAAC,YAAP,EAAuB,MAAM,CAAC,YAAP,CAAoB,GAFzD,CAGH,UAAU,CAAE,MAAM,EAAI,MAAM,CAAC,UAH1B,CAAP,CAKH,CANM,IAMA,CACH,MAAO,EAAP,CACH,CACJ,CA3CD,CA6CA,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,+DADkC,CAEtC,MAAM,CAA6B,MAFG,CAGtC,KAAK,CAAG,IAAD,EAA+B,CAClC,MAAO,IAAI,CAAA,wBAAJ,CAAwD,IAAI,CAAC,MAA7D,CAAqE,IAAI,CAAC,cAA1E,CAAP,CACH,CALqC,CAAD,CAAzC","sourcesContent":["import { buildCacheKeyWithUrlTokens, CurrentCategoryInput, getCategoryUrl, getCurrentCategory } from '@msdyn365-commerce-modules/retail-actions';\nimport {\n    CacheType,\n    createObservableDataAction,\n    getFriendlyName,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICreateActionContext,\n    IRequestContext\n} from '@msdyn365-commerce/core';\nimport { IDefaultPageSummaryConfig } from '../default-page-summary/default-page-summary.props.autogenerated';\nimport { IPageSummaryData } from '../IPageSummaryData';\n\n/** Category Page Summary Input */\nexport class CategoryPageSummaryInput implements IActionInput {\n    public requestContext: IRequestContext;\n    public config: IDefaultPageSummaryConfig;\n\n    constructor(config: IDefaultPageSummaryConfig, requestContext: IRequestContext) {\n        this.config = config || {};\n        this.requestContext = requestContext;\n    }\n\n    public getCacheObjectType = (): string => 'CategoryPageSummary';\n    public getCacheKey = (): string => buildCacheKeyWithUrlTokens('CategoryPageSummary', this.requestContext);\n    public dataCacheType = (): CacheType => 'request';\n}\n\nconst createGetCurrentCategoryInput = (inputData: IActionContext): CurrentCategoryInput => {\n    if (inputData && inputData.requestContext) {\n        return new CurrentCategoryInput(inputData.requestContext);\n    }\n\n    throw new Error('Please specify categoryId query string in request.');\n};\n\nconst action = async (input: CategoryPageSummaryInput, context: IActionContext): Promise<IPageSummaryData> => {\n    const { config } = input;\n    let currentCategory;\n    try {\n        currentCategory = await getCurrentCategory(createGetCurrentCategoryInput(context), context);\n    } catch (e) {\n        // Do nothing, if the action fails fallback to values defined in data\n    }\n    if (currentCategory) {\n        let categoryUrl: string | undefined;\n        try {\n            // reset category's name neutralizedName\n            const localName = getFriendlyName(context.requestContext.locale, currentCategory.NameTranslations);\n            const neutralizedName = currentCategory.NeutralizedName || currentCategory.Name;\n            currentCategory.Name = localName;\n            currentCategory.NeutralizedName = neutralizedName;\n            categoryUrl = getCategoryUrl(currentCategory);\n            // @ts-ignore - TODO: property exits in new version of SDK. Remove once released.\n            const canonicalDomain = context.requestContext.canonicalDomain;\n            if (categoryUrl && canonicalDomain) {\n                categoryUrl = `https://${canonicalDomain}${categoryUrl}`;\n            } else {\n                categoryUrl = undefined;\n            }\n        } catch (e) {\n            categoryUrl = undefined;\n        }\n        return {\n            title: currentCategory.Name,\n            sharingImageUrl: currentCategory.OfflineImage,\n            canonicalUrl: categoryUrl,\n            faviconUrl: config && config.faviconUrl\n        };\n        // If the action fails fallback to values defined from data\n    } else if (config) {\n        return {\n            title: config.title,\n            sharingImageUrl: config.sharingImage && config.sharingImage.src,\n            faviconUrl: config && config.faviconUrl\n        };\n    } else {\n        return {};\n    }\n};\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/page-summary/category-page-summary',\n    action: <IAction<IPageSummaryData>>action,\n    input: (args: ICreateActionContext) => {\n        return new CategoryPageSummaryInput(<IDefaultPageSummaryConfig>args.config, args.requestContext);\n    }\n});\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}