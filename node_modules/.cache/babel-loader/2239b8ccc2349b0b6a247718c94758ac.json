{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{createObservableDataAction}from'@msdyn365-commerce/core';import{BaseCollectionInput,createBaseCollectionInput}from'./base-collection-action';import{getProductRefinerHierarchy}from'./get-product-refiner-hierarchy';export var RefinersByCollectionInput=/*#__PURE__*/function(_BaseCollectionInput){_inherits(RefinersByCollectionInput,_BaseCollectionInput);var _super=_createSuper(RefinersByCollectionInput);function RefinersByCollectionInput(){var _this;_classCallCheck(this,RefinersByCollectionInput);_this=_super.apply(this,arguments);_this.getCacheObjectType=function(){return'ProductRefiner';};_this.dataCacheType=function(){if(_this.pageType!=='Category'||_this.refiners&&_this.refiners.length>0||_this.queryResultSettings&&_this.queryResultSettings.Sorting&&_this.queryResultSettings.Sorting.Columns&&_this.queryResultSettings.Sorting.Columns.length>0){return'request';}else{return'application';}};return _this;}return RefinersByCollectionInput;}(BaseCollectionInput);var createInput=function createInput(args){return createBaseCollectionInput(args,RefinersByCollectionInput);};function action(_x,_x2){return _action.apply(this,arguments);}function _action(){_action=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var searchProductId;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(input.pageType==='Category')){_context.next=8;break;}if(!input.category){_context.next=5;break;}return _context.abrupt(\"return\",getProductRefinerHierarchy({CategoryIds:[input.category],Context:{ChannelId:input.apiSettings.channelId,CatalogId:input.apiSettings.catalogId}},input.queryResultSettings,ctx));case 5:throw new Error('[GetRefinersForCollection]Category Page Detected, but no global categoryId found');case 6:_context.next=22;break;case 8:if(!(input.searchText&&ctx.requestContext.query&&ctx.requestContext.query.q)){_context.next=12;break;}return _context.abrupt(\"return\",getProductRefinerHierarchy({SearchCondition:input.searchText,Context:{ChannelId:input.apiSettings.channelId,CatalogId:input.apiSettings.catalogId}},input.queryResultSettings,ctx));case 12:if(!(input.searchText&&ctx.requestContext.query&&ctx.requestContext.query.productId)){_context.next=21;break;}searchProductId=Number(input.searchText);if(!Number.isNaN(searchProductId)){_context.next=18;break;}throw new Error('Failed to cast search product id into a number.');case 18:return _context.abrupt(\"return\",getProductRefinerHierarchy({Context:{ChannelId:input.apiSettings.channelId,CatalogId:input.apiSettings.catalogId},RecommendationListId:'looks',Ids:[searchProductId||0]},input.queryResultSettings,ctx));case 19:_context.next=22;break;case 21:throw new Error('[GetFullProductsForCollection]Search Page Detected, but no q= or productId= query parameter found');case 22:case\"end\":return _context.stop();}}},_callee);}));return _action.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/search-result-container/get-refiners-for-collection',action:action,input:createInput});","map":{"version":3,"sources":["modules/search-result-container/actions/get-refiners-for-collection.ts"],"names":[],"mappings":"0lCAKA,OAAS,0BAAT,KAAwG,yBAAxG,CACA,OAAS,mBAAT,CAA8B,yBAA9B,KAA+D,0BAA/D,CACA,OAAS,0BAAT,KAA2C,iCAA3C,CAKA,UAAa,CAAA,yBAAb,0JAAA,oCAAA,2D,mCACW,MAAA,kBAAA,CAAqB,iBAAM,gBAAN,EAArB,CACA,MAAA,aAAA,CAAgB,UAAK,CACxB,GACI,MAAK,QAAL,GAAkB,UAAlB,EACC,MAAK,QAAL,EAAiB,MAAK,QAAL,CAAc,MAAd,CAAuB,CADzC,EAEC,MAAK,mBAAL,EAA4B,MAAK,mBAAL,CAAyB,OAArD,EAAgE,MAAK,mBAAL,CAAyB,OAAzB,CAAiC,OAAjG,EAA4G,MAAK,mBAAL,CAAyB,OAAzB,CAAiC,OAAjC,CAAyC,MAAzC,CAAkD,CAHnK,CAIE,CACE,MAAO,SAAP,CACH,CAND,IAMO,CACH,MAAO,aAAP,CACH,CACJ,CAVM,CAFX,aAaC,CAbD,mCAA+C,mBAA/C,EAkBA,GAAM,CAAA,WAAW,CAAG,QAAd,CAAA,WAAc,CAAC,IAAD,CAA6C,CAC7D,MAAO,CAAA,yBAAyB,CAAC,IAAD,CAAO,yBAAP,CAAhC,CACH,CAFD,C,QAOe,CAAA,M,kIAAf,iBAAsB,KAAtB,CAAuD,GAAvD,2IAEO,KAAK,CAAC,QAAN,GAAmB,UAF1B,8BAGW,KAAK,CAAC,QAHjB,yDAImB,0BAA0B,CAC7B,CACI,WAAW,CAAC,CAAC,KAAK,CAAC,QAAP,CADhB,CAEI,OAAO,CAAG,CACN,SAAS,CAAE,KAAK,CAAC,WAAN,CAAkB,SADvB,CAEN,SAAS,CAAE,KAAK,CAAC,WAAN,CAAkB,SAFvB,CAFd,CAD6B,CAQ7B,KAAK,CAAC,mBARuB,CAS7B,GAT6B,CAJ7C,cAekB,IAAI,CAAA,KAAJ,CAAU,kFAAV,CAflB,2CAkBY,KAAK,CAAC,UAAN,EAAqB,GAAG,CAAC,cAAJ,CAAmB,KAAnB,EAA4B,GAAG,CAAC,cAAJ,CAAmB,KAAnB,CAAyB,CAlBtF,2DAmBmB,0BAA0B,CAC7B,CACI,eAAe,CAAE,KAAK,CAAC,UAD3B,CAEI,OAAO,CAAG,CACN,SAAS,CAAE,KAAK,CAAC,WAAN,CAAkB,SADvB,CAEN,SAAS,CAAE,KAAK,CAAC,WAAN,CAAkB,SAFvB,CAFd,CAD6B,CAQ7B,KAAK,CAAC,mBARuB,CAS7B,GAT6B,CAnB7C,eA8BoB,KAAK,CAAC,UAAN,EAAqB,GAAG,CAAC,cAAJ,CAAmB,KAAnB,EAA4B,GAAG,CAAC,cAAJ,CAAmB,KAAnB,CAAyB,SA9B9F,2BA+BoB,eAAe,CAAG,MAAM,CAAC,KAAK,CAAC,UAAP,CAAxB,CA/BpB,IAgCwB,MAAM,CAAC,KAAP,CAAa,eAAb,CAhCxB,+BAiC8B,IAAI,CAAA,KAAJ,CAAU,iDAAV,CAjC9B,yCAmC+B,0BAA0B,CAC7B,CACI,OAAO,CAAG,CACN,SAAS,CAAE,KAAK,CAAC,WAAN,CAAkB,SADvB,CAEN,SAAS,CAAE,KAAK,CAAC,WAAN,CAAkB,SAFvB,CADd,CAKI,oBAAoB,CAAE,OAL1B,CAMI,GAAG,CAAE,CAAC,eAAe,EAAI,CAApB,CANT,CAD6B,CAS7B,KAAK,CAAC,mBATuB,CAU7B,GAV6B,CAnCzD,8CAgD0B,IAAI,CAAA,KAAJ,CACF,mGADE,CAhD1B,wD,yCAwDA,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,gFADkC,CAEtC,MAAM,CAAuC,MAFP,CAGtC,KAAK,CAAE,WAH+B,CAAD,CAAzC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IProductRefinerHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { createObservableDataAction, IAction, IActionContext, IActionInput, ICreateActionContext } from '@msdyn365-commerce/core';\nimport { BaseCollectionInput, createBaseCollectionInput } from './base-collection-action';\nimport { getProductRefinerHierarchy } from './get-product-refiner-hierarchy';\n\n/**\n * Refiners-by-Collection Input action\n */\nexport class RefinersByCollectionInput extends BaseCollectionInput implements IActionInput {\n    public getCacheObjectType = () => 'ProductRefiner';\n    public dataCacheType = () => {\n        if (\n            this.pageType !== 'Category' ||\n            (this.refiners && this.refiners.length > 0) ||\n            (this.queryResultSettings && this.queryResultSettings.Sorting && this.queryResultSettings.Sorting.Columns && this.queryResultSettings.Sorting.Columns.length > 0)\n        ) {\n            return 'request';\n        } else {\n            return 'application';\n        }\n    }\n}\n\n/**\n * Create input method which creates an ActionInput for fetching list page refiners\n */\nconst createInput = (args: ICreateActionContext): IActionInput => {\n    return createBaseCollectionInput(args, RefinersByCollectionInput);\n};\n\n/**\n * Action method which fetches refiners for the given list page\n */\nasync function action(input:RefinersByCollectionInput, ctx: IActionContext): Promise<IProductRefinerHierarchy[]> {\n    let searchProductId;\n    if(input.pageType === 'Category') {\n        if(input.category) {\n            return getProductRefinerHierarchy(\n                {\n                    CategoryIds:[input.category],\n                    Context:  {\n                        ChannelId: input.apiSettings.channelId,\n                        CatalogId: input.apiSettings.catalogId\n                    }\n                },\n                input.queryResultSettings,\n                ctx);\n        } else {\n            throw new Error('[GetRefinersForCollection]Category Page Detected, but no global categoryId found');\n        }\n    } else {\n        if (input.searchText && (ctx.requestContext.query && ctx.requestContext.query.q)) {\n            return getProductRefinerHierarchy(\n                {\n                    SearchCondition: input.searchText,\n                    Context:  {\n                        ChannelId: input.apiSettings.channelId,\n                        CatalogId: input.apiSettings.catalogId\n                    }\n                },\n                input.queryResultSettings,\n                ctx);\n            } else {\n                if (input.searchText && (ctx.requestContext.query && ctx.requestContext.query.productId)) {\n                    searchProductId = Number(input.searchText);\n                    if (Number.isNaN(searchProductId)) {\n                        throw new Error('Failed to cast search product id into a number.');\n                    } else {\n                        return getProductRefinerHierarchy(\n                            {\n                                Context:  {\n                                    ChannelId: input.apiSettings.channelId,\n                                    CatalogId: input.apiSettings.catalogId\n                                },\n                                RecommendationListId: 'looks',\n                                Ids: [searchProductId || 0]\n                            },\n                            input.queryResultSettings,\n                            ctx);\n                    }\n                } else {\n                    throw new Error(\n                        '[GetFullProductsForCollection]Search Page Detected, but no q= or productId= query parameter found'\n                    );\n                }\n            }\n    }\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/search-result-container/get-refiners-for-collection',\n    action: <IAction<IProductRefinerHierarchy[]>>action,\n    input: createInput\n});"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}