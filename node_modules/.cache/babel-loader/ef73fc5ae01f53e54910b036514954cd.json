{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{buildCacheKey,getProductUrlSync,getSelectedProductIdFromActionInput,getSelectedVariant,SelectedVariantInput}from'@msdyn365-commerce-modules/retail-actions';import{createObservableDataAction}from'@msdyn365-commerce/core';export var ProductPageSummaryInput=function ProductPageSummaryInput(config,apiSettings){var _this=this;_classCallCheck(this,ProductPageSummaryInput);this.getCacheObjectType=function(){return'ProductPageSummary';};this.getCacheKey=function(){return\"\".concat(buildCacheKey('ProductPageSummary',_this.apiSettings),\"-\").concat(_this.config.title);};this.dataCacheType=function(){return'request';};this.config=config||{};this.apiSettings=apiSettings;};var createGetSelectedVariantInput=function createGetSelectedVariantInput(inputData){var productId=getSelectedProductIdFromActionInput(inputData);if(productId){return new SelectedVariantInput(+productId,+inputData.requestContext.apiSettings.channelId,[]);}else{throw new Error('Unable to create SelectedVariantInput, no productId found on module config or query');}};var action=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,context){var config,simpleProductData,productUrl,canonicalDomain;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:config=input.config;_context.prev=1;_context.next=4;return getSelectedVariant(createGetSelectedVariantInput(context),context);case 4:simpleProductData=_context.sent;_context.next=9;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);case 9:if(!simpleProductData){_context.next=14;break;}try{productUrl=getProductUrlSync(simpleProductData,context);canonicalDomain=context.requestContext.canonicalDomain;if(productUrl&&canonicalDomain){productUrl=\"https://\".concat(canonicalDomain).concat(productUrl);}else{productUrl=undefined;}}catch(e){productUrl=undefined;}return _context.abrupt(\"return\",{title:simpleProductData.Name,description:simpleProductData.Description,sharingImageUrl:simpleProductData.PrimaryImageUrl,canonicalUrl:productUrl,faviconUrl:config&&config.faviconUrl});case 14:if(!config){_context.next=18;break;}return _context.abrupt(\"return\",{title:config.title,description:config.description,sharingImageUrl:config.sharingImage&&config.sharingImage.src,faviconUrl:config&&config.faviconUrl});case 18:return _context.abrupt(\"return\",{});case 19:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return function action(_x,_x2){return _ref.apply(this,arguments);};}();export default createObservableDataAction({id:'@msdyn365-commerce-modules/page-summary/product-page-summary',action:action,input:function input(args){return new ProductPageSummaryInput(args.config,args.requestContext.apiSettings);}});","map":{"version":3,"sources":["modules/product-page-summary/product-page-summary.action.ts"],"names":[],"mappings":"8MAAA,OAAS,aAAT,CAAwB,iBAAxB,CAA2C,mCAA3C,CAAgF,kBAAhF,CAAoG,oBAApG,KAAgI,2CAAhI,CACA,OAAoB,0BAApB,KAAwI,yBAAxI,CAKA,UAAa,CAAA,uBAAb,CAII,iCAAY,MAAZ,CAA+C,WAA/C,CAAgF,8DAKzE,KAAA,kBAAA,CAAqB,iBAAc,oBAAd,EAArB,CACA,KAAA,WAAA,CAAc,2BAAiB,aAAa,CAAC,oBAAD,CAAuB,KAAI,CAAC,WAA5B,CAA9B,aAA0E,KAAI,CAAC,MAAL,CAAY,KAAtF,GAAd,CACA,KAAA,aAAA,CAAgB,iBAAiB,SAAjB,EAAhB,CANH,KAAK,MAAL,CAAc,MAAM,EAAI,EAAxB,CACA,KAAK,WAAL,CAAmB,WAAnB,CACH,CAPL,CAcA,GAAM,CAAA,6BAA6B,CAAG,QAAhC,CAAA,6BAAgC,CAAC,SAAD,CAAoD,CACtF,GAAM,CAAA,SAAS,CAAG,mCAAmC,CAAC,SAAD,CAArD,CAEA,GAAI,SAAJ,CAAe,CACX,MAAO,IAAI,CAAA,oBAAJ,CAAyB,CAAC,SAA1B,CAAqC,CAAC,SAAS,CAAC,cAAV,CAAyB,WAAzB,CAAqC,SAA3E,CAAsF,EAAtF,CAAP,CACH,CAFD,IAEO,CACH,KAAM,IAAI,CAAA,KAAJ,CAAU,qFAAV,CAAN,CACH,CACJ,CARD,CAUA,GAAM,CAAA,MAAM,0FAAG,iBAAO,KAAP,CAAuC,OAAvC,0KACH,MADG,CACQ,KADR,CACH,MADG,uCAImB,CAAA,kBAAkB,CAAC,6BAA6B,CAAC,OAAD,CAA9B,CAAyC,OAAzC,CAJrC,QAIP,iBAJO,wGAQP,iBARO,0BAUP,GAAI,CACA,UAAU,CAAG,iBAAiB,CAAC,iBAAD,CAAoB,OAApB,CAA9B,CAEM,eAHN,CAGwB,OAAO,CAAC,cAAR,CAAuB,eAH/C,CAIA,GAAI,UAAU,EAAI,eAAlB,CAAmC,CAC/B,UAAU,mBAAc,eAAd,SAAgC,UAAhC,CAAV,CACH,CAFD,IAEO,CACH,UAAU,CAAG,SAAb,CACH,CACJ,CAAC,MAAO,CAAP,CAAU,CACR,UAAU,CAAG,SAAb,CACH,CArBM,gCAsBA,CACH,KAAK,CAAE,iBAAiB,CAAC,IADtB,CAEH,WAAW,CAAE,iBAAiB,CAAC,WAF5B,CAGH,eAAe,CAAE,iBAAiB,CAAC,eAHhC,CAIH,YAAY,CAAE,UAJX,CAKH,UAAU,CAAE,MAAM,EAAI,MAAM,CAAC,UAL1B,CAtBA,cA8BA,MA9BA,0DA+BA,CACH,KAAK,CAAE,MAAM,CAAC,KADX,CAEH,WAAW,CAAE,MAAM,CAAC,WAFjB,CAGH,eAAe,CAAE,MAAM,CAAC,YAAP,EAAuB,MAAM,CAAC,YAAP,CAAoB,GAHzD,CAIH,UAAU,CAAE,MAAM,EAAI,MAAM,CAAC,UAJ1B,CA/BA,0CAsCA,EAtCA,sEAAH,kBAAN,CAAA,MAAM,gDAAZ,CA0CA,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,8DADkC,CAEtC,MAAM,CAA6B,MAFG,CAGtC,KAAK,CAAE,eAAC,IAAD,CAA+B,CAClC,MAAO,IAAI,CAAA,uBAAJ,CAAuD,IAAI,CAAC,MAA5D,CAAoE,IAAI,CAAC,cAAL,CAAoB,WAAxF,CAAP,CACH,CALqC,CAAD,CAAzC","sourcesContent":["import { buildCacheKey, getProductUrlSync, getSelectedProductIdFromActionInput, getSelectedVariant, SelectedVariantInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { CacheType, createObservableDataAction, IAction, IActionContext,IActionInput, ICommerceApiSettings, ICreateActionContext } from '@msdyn365-commerce/core';\nimport { IDefaultPageSummaryConfig } from '../default-page-summary/default-page-summary.props.autogenerated';\nimport { IPageSummaryData } from '../IPageSummaryData';\n\n/** Product Page Summary Input */\nexport class ProductPageSummaryInput implements IActionInput {\n    public apiSettings: ICommerceApiSettings;\n    public config: IDefaultPageSummaryConfig;\n\n    constructor(config: IDefaultPageSummaryConfig, apiSettings: ICommerceApiSettings) {\n        this.config = config || {};\n        this.apiSettings = apiSettings;\n    }\n\n    public getCacheObjectType = (): string => 'ProductPageSummary';\n    public getCacheKey = (): string => `${buildCacheKey('ProductPageSummary', this.apiSettings)}-${this.config.title}`;\n    public dataCacheType = (): CacheType => 'request';\n}\n\nconst createGetSelectedVariantInput = (inputData: IActionContext): SelectedVariantInput => {\n    const productId = getSelectedProductIdFromActionInput(inputData);\n\n    if (productId) {\n        return new SelectedVariantInput(+productId, +inputData.requestContext.apiSettings.channelId, []);\n    } else {\n        throw new Error('Unable to create SelectedVariantInput, no productId found on module config or query');\n    }\n};\n\nconst action = async (input: ProductPageSummaryInput, context: IActionContext): Promise<IPageSummaryData> => {\n    const { config } = input;\n    let simpleProductData;\n    try {\n        simpleProductData = await getSelectedVariant(createGetSelectedVariantInput(context), context);\n    } catch (e) {\n        // Do nothing, if there's an error we fall back to values defined from data\n    }\n    if (simpleProductData) {\n        let productUrl: string | undefined;\n        try {\n            productUrl = getProductUrlSync(simpleProductData, context);\n            // @ts-ignore - TODO: property exits in new version of SDK. Remove once released.\n            const canonicalDomain = context.requestContext.canonicalDomain;\n            if (productUrl && canonicalDomain) {\n                productUrl = `https://${canonicalDomain}${productUrl}`;\n            } else {\n                productUrl = undefined;\n            }\n        } catch (e) {\n            productUrl = undefined;\n        }\n        return {\n            title: simpleProductData.Name,\n            description: simpleProductData.Description,\n            sharingImageUrl: simpleProductData.PrimaryImageUrl,\n            canonicalUrl: productUrl,\n            faviconUrl: config && config.faviconUrl\n        };\n    // If the action fails fallback to values defined from data\n    } else if (config) {\n        return {\n            title: config.title,\n            description: config.description,\n            sharingImageUrl: config.sharingImage && config.sharingImage.src,\n            faviconUrl: config && config.faviconUrl\n        };\n    } else {\n        return {};\n    }\n};\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/page-summary/product-page-summary',\n    action: <IAction<IPageSummaryData>>action,\n    input: (args: ICreateActionContext) => {\n        return new ProductPageSummaryInput(<IDefaultPageSummaryConfig>args.config, args.requestContext.apiSettings);\n    }\n});"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}