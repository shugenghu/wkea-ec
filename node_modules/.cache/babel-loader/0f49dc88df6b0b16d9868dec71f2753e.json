{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol===\"undefined\"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import*as React from'react';import{Button,format,getPayloadObject,getTelemetryAttributes,TelemetryConstant}from'@msdyn365-commerce-modules/utilities';import{msdyn365Commerce}from'@msdyn365-commerce/core';import{PriceComponent}from'../index';var PromoCodeComponentActions={};var PromoCode=/*#__PURE__*/function(_React$Component){_inherits(PromoCode,_React$Component);var _super=_createSuper(PromoCode);function PromoCode(props,state){var _this;_classCallCheck(this,PromoCode);_this=_super.call(this,props);_this._onInputChange=function(e){var error=e.target.value===''?'':_this.state.error;_this.setState({promoCodeInputValue:e.target.value,error:error,canApply:e.target.value?true:false});};_this._applyPromotion=function(cartState){if(!cartState||!cartState.cart){return;}var appliedPromo=_this.state.promoCodeInputValue;cartState.addPromoCode({promoCode:appliedPromo}).then(function(result){if(result.status==='SUCCESS'){_this.setState({promoCodeInputValue:'',error:'',canApply:false});}else if(result.substatus==='ALREADYADDED'){_this.setState({error:_this.props.duplicatePromoCodeErrorText});}else{_this.setState({error:_this.props.invalidPromoCodeErrorText});}})[\"catch\"](function(error){_this.setState({error:_this.props.failedToAddPromoCodeErrorText});});};_this._renderForm=function(promoPlaceholderText,promoCodeApplyButtonText,cartState){var _onSubmit=function _onSubmit(event){event.preventDefault();_this._applyPromotion(cartState);};var _applyPromotion=function _applyPromotion(event){_this._applyPromotion(cartState);};var attributes=getTelemetryAttributes(_this.props.telemetryContent,_this.payLoad);return/*#__PURE__*/React.createElement(\"form\",{onSubmit:_onSubmit,className:'msc-promo-code__form-container'},/*#__PURE__*/React.createElement(\"div\",{className:'msc-promo-code__group'},/*#__PURE__*/React.createElement(\"input\",{className:'msc-promo-code__input-box',\"aria-label\":promoPlaceholderText,onChange:_this._onInputChange,value:_this.state.promoCodeInputValue,placeholder:promoPlaceholderText}),/*#__PURE__*/React.createElement(Button,Object.assign({title:promoCodeApplyButtonText,className:'msc-promo-code__apply-btn btn',onClick:_applyPromotion,disabled:!_this.state.canApply},attributes),promoCodeApplyButtonText)));};_this._removePromotion=function(cartState,event){if(!cartState){return;}var code=event.currentTarget.getAttribute('data-value')||'';cartState.removePromoCodes({promoCodes:[code]}).then(function(result){if(result.status==='SUCCESS'){_this.setState({error:''});}})[\"catch\"](function(){_this.setState({error:_this.props.failedToRemovePromoCodeErrorText});});};_this._calculateDiscount=function(code,cartState){if(!cartState||!cartState.cart||!cartState.cart.CartLines||cartState.cart.CartLines.length===0||!code){return;}var discountAmount=0;var _iterator=_createForOfIteratorHelper(cartState.cart.CartLines),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var line=_step.value;if(line.DiscountLines){var _iterator2=_createForOfIteratorHelper(line.DiscountLines),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var discountLine=_step2.value;if(discountLine.DiscountCode===code){discountAmount+=discountLine.DiscountCost;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}}}catch(err){_iterator.e(err);}finally{_iterator.f();}return discountAmount*-1;};_this._renderAppliedPromoCode=function(props){if(!props.cart||!props.cart.cart||!props.cart.cart.Coupons||!(props.cart.cart.Coupons.length>0)){return;}var _removePromotion=function _removePromotion(event){_this._removePromotion(props.cart,event);};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:'msc-promo-code__discount'},/*#__PURE__*/React.createElement(\"div\",{className:'msc-promo-code__discount-heading'},_this.props.appliedPromoCodeHeadingText),/*#__PURE__*/React.createElement(PriceComponent,{data:{price:{CustomerContextualPrice:props.cart.cart.DiscountAmount}},context:props.context,id:props.id,typeName:props.typeName,className:'msc-promo-code__discount-value'})),props.cart.cart.Coupons.map(function(coupon){var ariaLabel=props.removePromoAriaLabelFormat?format(props.removePromoAriaLabelFormat,props.removePromoText,coupon.Code):'';return/*#__PURE__*/React.createElement(\"div\",{key:coupon.Code,className:'msc-promo-code__line-container'},/*#__PURE__*/React.createElement(\"div\",{className:'msc-promo-code__line-value'},coupon.Code,\" (\",/*#__PURE__*/React.createElement(PriceComponent,{data:{price:{CustomerContextualPrice:_this._calculateDiscount(coupon.Code||'',props.cart)}},context:props.context,id:props.id,typeName:props.typeName,className:'msc-promo-code__line-discount-value'}),\")\"),/*#__PURE__*/React.createElement(Button,{title:props.removePromoText,className:'msc-promo-code__line__btn-remove',onClick:_removePromotion,\"data-value\":coupon.Code,\"aria-label\":ariaLabel},props.removePromoText));}));};_this.payLoad=getPayloadObject('click',_this.props.telemetryContent,TelemetryConstant.ApplyPromoCode);_this.state={isCollapseOpen:false,promoCodeInputValue:'',error:'',canApply:false};return _this;}_createClass(PromoCode,[{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:'msc-promo-code-heading'},this.props.promoCodeHeadingText),this._renderForm(this.props.promoPlaceholderText,this.props.promoCodeApplyButtonText,this.props.cart),/*#__PURE__*/React.createElement(\"p\",{className:this.state.error?'msc-alert-danger':'',\"aria-live\":'assertive'},this.state.error),this._renderAppliedPromoCode(this.props));}}]);return PromoCode;}(React.Component);export var PromoCodeComponent=msdyn365Commerce.createComponent('PromoCode',_objectSpread({component:PromoCode},PromoCodeComponentActions));","map":{"version":3,"sources":["promocode/promocode.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\n\nimport { Button, format, getPayloadObject, getTelemetryAttributes, IPayLoad, ITelemetryContent, TelemetryConstant } from '@msdyn365-commerce-modules/utilities';\nimport { IComponent, IComponentProps, msdyn365Commerce } from '@msdyn365-commerce/core';\nimport { ICartState } from '@msdyn365-commerce/global-state';\nimport { Coupon } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { PriceComponent } from '../index';\n\nexport interface IPromoCodeProps extends IComponentProps<{}> {\n    cart: ICartState | undefined;\n    promoCodeHeadingText: string;\n    appliedPromoCodeHeadingText: string;\n    removePromoAriaLabelFormat: string;\n    promoPlaceholderText: string;\n    promoCodeApplyButtonText: string;\n    collapseTimeOut: number;\n    removePromoText: string;\n    invalidPromoCodeErrorText: string;\n    failedToAddPromoCodeErrorText: string;\n    duplicatePromoCodeErrorText: string;\n    failedToRemovePromoCodeErrorText: string;\n    /** The telemetry content */\n    telemetryContent?: ITelemetryContent;\n    promoCodeApplyCallback?(): void;\n}\n\nexport interface IPromoCodeComponent extends IComponent<IPromoCodeProps> { }\n\nconst PromoCodeComponentActions = {\n};\n\ninterface IPromoCodeState {\n    isCollapseOpen: boolean;\n    promoCodeInputValue: string;\n    error: string;\n    canApply: boolean;\n}\n\n/**\n *\n * The PromoCode component renders the promocode section.\n * @extends {React.PureComponent<IRefineSubmenuProps>}\n */\nclass PromoCode extends React.Component<IPromoCodeProps, IPromoCodeState> {\n\n    private payLoad: IPayLoad;\n\n    constructor(props: IPromoCodeProps, state: IPromoCodeState) {\n        super(props);\n        this.payLoad = getPayloadObject('click', this.props.telemetryContent!, TelemetryConstant.ApplyPromoCode);\n        this.state = {\n            isCollapseOpen: false,\n            promoCodeInputValue: '',\n            error: '',\n            canApply: false\n        };\n    }\n\n    public render(): JSX.Element {\n        return (\n            <div>\n                <div className='msc-promo-code-heading'>{this.props.promoCodeHeadingText}</div>\n                {this._renderForm(this.props.promoPlaceholderText, this.props.promoCodeApplyButtonText, this.props.cart)}\n                <p className={this.state.error ? 'msc-alert-danger' : ''}aria-live='assertive'>{this.state.error}</p>\n                {this._renderAppliedPromoCode(this.props)}\n            </div>\n        );\n    }\n\n    private _onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        const error = e.target.value === '' ? '' : this.state.error;\n        this.setState({\n            promoCodeInputValue: e.target.value, error: error,\n            canApply: e.target.value ? true : false\n        });\n    }\n\n    private _applyPromotion = (cartState: ICartState | undefined) => {\n        if (!cartState || !cartState.cart) {\n            return;\n        }\n        const appliedPromo = this.state.promoCodeInputValue;\n\n        cartState.addPromoCode({ promoCode: appliedPromo })\n            .then(result => {\n                if (result.status === 'SUCCESS') {\n                    // show success text\n                    this.setState({ promoCodeInputValue: '', error: '', canApply: false});\n                } else if (result.substatus === 'ALREADYADDED') {\n                    this.setState({ error: this.props.duplicatePromoCodeErrorText });\n                } else {\n                    this.setState({ error: this.props.invalidPromoCodeErrorText });\n                }\n            })\n            .catch(error => {\n                this.setState({ error: this.props.failedToAddPromoCodeErrorText });\n            });\n    }\n\n    private _renderForm = (promoPlaceholderText: string, promoCodeApplyButtonText: string, cartState: ICartState | undefined) => {\n        const _onSubmit = (event: React.FormEvent<HTMLFormElement>) => {event.preventDefault(); this._applyPromotion(cartState);};\n        const _applyPromotion = (event: React.MouseEvent<HTMLElement>) => {this._applyPromotion(cartState);};\n        const attributes = getTelemetryAttributes(this.props.telemetryContent!, this.payLoad);\n\n        return (\n            <form onSubmit={_onSubmit} className='msc-promo-code__form-container'>\n                <div className='msc-promo-code__group'>\n                    <input\n                        className='msc-promo-code__input-box'\n                        aria-label={promoPlaceholderText}\n                        onChange={this._onInputChange}\n                        value={this.state.promoCodeInputValue}\n                        placeholder={promoPlaceholderText}\n                    />\n                    <Button\n                        title={promoCodeApplyButtonText}\n                        className='msc-promo-code__apply-btn btn'\n                        onClick={_applyPromotion}\n                        disabled={!this.state.canApply}\n                        {...attributes}\n                    >\n                        {promoCodeApplyButtonText}\n                    </Button>\n                </div>\n            </form>\n        );\n    }\n\n    private _removePromotion = (cartState: ICartState | undefined, event: React.MouseEvent) => {\n        if (!cartState) {\n            return;\n        }\n        const code = event.currentTarget.getAttribute('data-value') || '';\n        cartState.removePromoCodes({\n            promoCodes: [\n                code\n            ]\n        })\n            .then(result => {\n                if (result.status === 'SUCCESS') {\n                    this.setState({ error: ''});\n                }\n            })\n            .catch(() => {\n                this.setState({ error: this.props.failedToRemovePromoCodeErrorText});\n            });\n\n    }\n    private _calculateDiscount = (code: string, cartState: ICartState | undefined) => {\n        if (!cartState || !cartState.cart || !cartState.cart.CartLines || cartState.cart.CartLines.length === 0 || !code) {\n            return;\n        }\n        let discountAmount = 0;\n        for (const line of cartState.cart.CartLines) {\n            if (line.DiscountLines) {\n                for (const discountLine of line.DiscountLines) {\n                    if (discountLine.DiscountCode === code) {\n                        discountAmount += discountLine.DiscountCost!;\n                    }\n                }\n            }\n        }\n        return discountAmount * -1;\n    }\n\n    private _renderAppliedPromoCode = (props: IPromoCodeProps) => {\n        if (!props.cart || !props.cart.cart || !props.cart.cart.Coupons || !(props.cart.cart.Coupons.length > 0)) {\n            return;\n        }\n\n        const _removePromotion = (event: React.MouseEvent<HTMLElement>) => {this._removePromotion(props.cart, event);};\n\n        return (\n            <>\n                <div className='msc-promo-code__discount'>\n                    <div className='msc-promo-code__discount-heading'>{this.props.appliedPromoCodeHeadingText}</div>\n                    <PriceComponent\n                        data={{\n                            price: {\n                                CustomerContextualPrice: props.cart.cart.DiscountAmount\n\n                            }\n                        }}\n                        context = {props.context}\n                        id = {props.id}\n                        typeName = {props.typeName}\n                        className = {'msc-promo-code__discount-value'}\n                    />\n                </div>\n                {\n                     props.cart.cart.Coupons.map((coupon: Coupon) => {\n                        const ariaLabel = props.removePromoAriaLabelFormat ? format(props.removePromoAriaLabelFormat, props.removePromoText, coupon.Code) : '';\n\n                        return (\n                            <div key={coupon.Code} className='msc-promo-code__line-container'>\n                                <div className='msc-promo-code__line-value'>\n                                    {coupon.Code} (\n                                        <PriceComponent\n                                            data={{\n                                                price: {\n                                                    CustomerContextualPrice: this._calculateDiscount(coupon.Code || '', props.cart)\n\n                                                }\n                                            }}\n                                            context = {props.context}\n                                            id = {props.id}\n                                            typeName = {props.typeName}\n                                            className = {'msc-promo-code__line-discount-value'}\n                                        />)\n                                </div>\n                                <Button\n                                    title={props.removePromoText}\n                                    className={'msc-promo-code__line__btn-remove'}\n                                    onClick={_removePromotion}\n                                    data-value={coupon.Code}\n                                    aria-label={ariaLabel}\n                                >\n                                    {props.removePromoText}\n                                </Button>\n                            </div>\n                        );\n                    })\n                }\n            </>\n        );\n    }\n}\n\n// @ts-ignore\nexport const PromoCodeComponent: React.FunctionComponent<IPromoCodeProps> = msdyn365Commerce.createComponent<IPromoCodeComponent>(\n    'PromoCode',\n    { component: PromoCode, ...PromoCodeComponentActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}