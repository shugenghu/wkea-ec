{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{getProductPageUrlSync}from'@msdyn365-commerce-modules/retail-actions';import{format,getPayloadObject,getTelemetryAttributes,onTelemetryClick}from'@msdyn365-commerce-modules/utilities';import{Image,msdyn365Commerce}from'@msdyn365-commerce/core';import React from'react';import{PriceComponent,RatingComponent}from'../index';var PriceComponentActions={};var ProductCard=function ProductCard(_ref){var data=_ref.data,context=_ref.context,imageSettings=_ref.imageSettings,savingsText=_ref.savingsText,freePriceText=_ref.freePriceText,originalPriceText=_ref.originalPriceText,currentPriceText=_ref.currentPriceText,ratingAriaLabel=_ref.ratingAriaLabel,allowBack=_ref.allowBack,typeName=_ref.typeName,id=_ref.id,telemetryContent=_ref.telemetryContent;var product=data.product;if(!product){return null;}var productUrl=getProductPageUrlSync(product.Name||'',product.RecordId,context&&context.actionContext,undefined);if(allowBack){productUrl=updateProductUrl(productUrl,context);}var payLoad=getPayloadObject('click',telemetryContent,'',product.RecordId.toString());var attribute=getTelemetryAttributes(telemetryContent,payLoad);return/*#__PURE__*/React.createElement(\"a\",Object.assign({href:productUrl,onClick:onTelemetryClick(telemetryContent,payLoad,product.Name),\"aria-label\":renderLabel(product.Name,context.cultureFormatter.formatCurrency(product.Price),product.AverageRating,ratingAriaLabel),className:'msc-product'},attribute),/*#__PURE__*/React.createElement(\"div\",{className:'msc-product__image'},renderProductPlacementImage(imageSettings,context.request.gridSettings,product.PrimaryImageUrl,product.Name)),/*#__PURE__*/React.createElement(\"div\",{className:'msc-product__details'},/*#__PURE__*/React.createElement(\"h4\",{className:'msc-product__title'},product.Name),renderPrice(context,typeName,id,product.BasePrice,product.Price,savingsText,freePriceText,originalPriceText,currentPriceText),renderDescription(product.Description),!context.app.config.hideRating&&renderRating(context,typeName,id,product.AverageRating,product.TotalRatings,ratingAriaLabel)));};function renderLabel(name,price,rating,ratingAriaLabel){name=name||'';price=price||'';return\"\".concat(name,\" \").concat(price,\" \").concat(getRatingAriaLabel(rating,ratingAriaLabel));}function renderDescription(description){return/*#__PURE__*/React.createElement(\"p\",{className:'msc-product__text'},description);}function getRatingAriaLabel(rating,ratingAriaLabel){if(rating&&ratingAriaLabel){var roundedRating=rating.toFixed(2);return format(ratingAriaLabel||'',roundedRating,'5');}return'';}function updateProductUrl(productUrl,context){var srcUrl=new URL(productUrl,context.request.apiSettings.baseUrl);var queryString=\"back=true\";if(srcUrl.search){srcUrl.search+=\"&\".concat(queryString);}else{srcUrl.search+=queryString;}var updatedUrl=new URL(srcUrl.href);return updatedUrl.pathname+srcUrl.search;}function renderRating(context,typeName,id,avgRating,totalRatings,ariaLabel){if(!avgRating){return null;}var numRatings=totalRatings&&totalRatings.toString()||undefined;var ratingAriaLabel=getRatingAriaLabel(avgRating,ariaLabel);return/*#__PURE__*/React.createElement(RatingComponent,{context:context,id:id,typeName:typeName,avgRating:avgRating,ratingCount:numRatings,readOnly:true,ariaLabel:ratingAriaLabel,data:{}});}function renderPrice(context,typeName,id,basePrice,adjustedPrice,savingsText,freePriceText,originalPriceText,currentPriceText){var price={BasePrice:basePrice,AdjustedPrice:adjustedPrice,CustomerContextualPrice:adjustedPrice};return/*#__PURE__*/React.createElement(PriceComponent,{context:context,id:id,typeName:typeName,data:{price:price},savingsText:savingsText,freePriceText:freePriceText,originalPriceText:originalPriceText});}function renderProductPlacementImage(imageSettings,gridSettings,imageUrl,altText){if(!imageUrl||!gridSettings||!imageSettings){return null;}var img={src:imageUrl,altText:altText?altText:''};var imageProps={gridSettings:gridSettings,imageSettings:imageSettings};return/*#__PURE__*/React.createElement(Image,Object.assign({},img,imageProps,{loadFailureBehavior:'empty'}));}export var ProductComponent=msdyn365Commerce.createComponent('Product',_objectSpread({component:ProductCard},PriceComponentActions));","map":{"version":3,"sources":["product-card/product.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import { getProductPageUrlSync } from '@msdyn365-commerce-modules/retail-actions';\nimport { format, getPayloadObject, getTelemetryAttributes, ITelemetryContent, onTelemetryClick } from '@msdyn365-commerce-modules/utilities';\nimport { IComponent, IComponentProps, ICoreContext, IGridSettings, IImageData, IImageSettings, Image, msdyn365Commerce } from '@msdyn365-commerce/core';\nimport { ProductPrice, ProductSearchResult } from '@msdyn365-commerce/retail-proxy';\nimport React from 'react';\nimport { PriceComponent, RatingComponent } from '../index';\n\nexport interface IProductComponentProps extends IComponentProps<{ product?: ProductSearchResult }> {\n    className?: string;\n    imageSettings?: IImageSettings;\n    savingsText?: string;\n    freePriceText?: string;\n    originalPriceText?: string;\n    currentPriceText?: string;\n    ratingAriaLabel?: string;\n    allowBack?: boolean;\n    telemetryContent?: ITelemetryContent;\n}\n\nexport interface IProductComponent extends IComponent<IProductComponentProps> { }\n\nconst PriceComponentActions = {\n};\n\nconst ProductCard: React.FC<IProductComponentProps> = ({\n    data,\n    context,\n    imageSettings,\n    savingsText,\n    freePriceText,\n    originalPriceText,\n    currentPriceText,\n    ratingAriaLabel,\n    allowBack,\n    typeName,\n    id,\n    telemetryContent\n}) => {\n    const product = data.product;\n    if (!product) {\n        return null;\n    }\n\n    let productUrl = getProductPageUrlSync(product.Name || '', product.RecordId, context && context.actionContext, undefined);\n    if(allowBack) {\n        productUrl = updateProductUrl(productUrl, context);\n    }\n\n    // Construct telemetry attribute to render\n    const payLoad = getPayloadObject('click', telemetryContent!, '', product.RecordId.toString());\n\n    const attribute = getTelemetryAttributes(telemetryContent!, payLoad);\n\n    return (\n        <a href={productUrl} onClick={onTelemetryClick(telemetryContent!, payLoad, product.Name!)} aria-label={renderLabel(product.Name, context.cultureFormatter.formatCurrency(product.Price), product.AverageRating, ratingAriaLabel)} className='msc-product' {...attribute}>\n            <div className='msc-product__image'>\n            {renderProductPlacementImage(imageSettings, context.request.gridSettings, product.PrimaryImageUrl, product.Name)}\n            </div>\n            <div className='msc-product__details'>\n                <h4 className='msc-product__title'>{product.Name}</h4>\n                {renderPrice(context, typeName, id, product.BasePrice, product.Price, savingsText, freePriceText, originalPriceText, currentPriceText)}\n                {renderDescription(product.Description)}\n                {!context.app.config.hideRating && renderRating(context, typeName, id, product.AverageRating, product.TotalRatings, ratingAriaLabel)}\n            </div>\n        </a>\n    );\n};\n\nfunction renderLabel(name?: string, price?: string, rating?: number, ratingAriaLabel?: string): string {\n    name = name || '';\n    price = price || '';\n    return (`${name} ${price} ${getRatingAriaLabel(rating, ratingAriaLabel)}`);\n}\n\nfunction renderDescription(description?: string): JSX.Element | null {\n    return <p className='msc-product__text'>{description}</p>;\n}\n\nfunction getRatingAriaLabel(rating?: number, ratingAriaLabel?: string): string {\n    if (rating && ratingAriaLabel) {\n    const roundedRating = rating.toFixed(2);\n    return format(ratingAriaLabel || '', roundedRating, '5');\n    }\n    return '';\n}\n\nfunction updateProductUrl(productUrl: string, context:ICoreContext): string {\n    const srcUrl = new URL(productUrl, context.request.apiSettings.baseUrl);\n    const queryString = `back=true` ;\n    if (srcUrl.search) {\n            srcUrl.search += `&${queryString}`;\n        } else {\n            srcUrl.search += queryString;\n        }\n\n    const updatedUrl = new URL(srcUrl.href);\n    return updatedUrl.pathname + srcUrl.search;\n}\n\nfunction renderRating(context: ICoreContext, typeName: string, id: string, avgRating?: number, totalRatings?: number, ariaLabel?: string): JSX.Element | null {\n    if (!avgRating) {\n        return null;\n    }\n\n    const numRatings = totalRatings && totalRatings.toString() || undefined;\n    const ratingAriaLabel = getRatingAriaLabel(avgRating, ariaLabel);\n\n    return (\n        <RatingComponent\n            context={context}\n            id={id}\n            typeName={typeName}\n            avgRating={avgRating}\n            ratingCount={numRatings}\n            readOnly={true}\n            ariaLabel={ratingAriaLabel}\n            data={{}}\n        />\n    );\n}\n\nfunction renderPrice(context: ICoreContext, typeName: string, id: string, basePrice?: number, adjustedPrice?: number, savingsText?: string, freePriceText?: string, originalPriceText?: string, currentPriceText?: string): JSX.Element | null {\n    const price: ProductPrice = {\n        BasePrice: basePrice,\n        AdjustedPrice: adjustedPrice,\n        CustomerContextualPrice: adjustedPrice\n    };\n\n    return (\n        <PriceComponent\n            context={context}\n            id={id}\n            typeName={typeName}\n            data={{ price: price }}\n            savingsText={savingsText}\n            freePriceText={freePriceText}\n            originalPriceText={originalPriceText}\n        />\n    );\n}\n\nfunction renderProductPlacementImage(imageSettings?: IImageSettings, gridSettings?: IGridSettings, imageUrl?: string, altText?: string): JSX.Element | null {\n    if (!imageUrl || !gridSettings || !imageSettings) {\n        return null;\n    }\n    const img: IImageData = {\n        src: imageUrl,\n        altText: altText ? altText : ''\n    };\n    const imageProps = {\n        gridSettings: gridSettings,\n        imageSettings: imageSettings\n    };\n    return (\n        <Image {...img} {...imageProps} loadFailureBehavior='empty' />\n    );\n}\n\n// @ts-ignore\nexport const ProductComponent: React.FunctionComponent<IProductComponentProps> = msdyn365Commerce.createComponent<IProductComponent>(\n    'Product',\n    { component: ProductCard, ...PriceComponentActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}