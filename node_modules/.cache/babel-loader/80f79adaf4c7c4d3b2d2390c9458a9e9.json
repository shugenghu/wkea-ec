{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _debounce from \"lodash/debounce\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { createSearchStateInput } from '@msdyn365-commerce-modules/search-utilities';\nimport { getTelemetryObject, KeyCodes } from '@msdyn365-commerce-modules/utilities';\nimport { getUrlSync } from '@msdyn365-commerce/core';\nimport { getProductSearchRefinersAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport getSearchSuggestionsAction, { AutoSuggestInput, SuggestionType } from './actions/get-auto-suggest-suggestions';\nimport { CategorySuggestionsComponent, FormComponent, KeywordSuggestionsComponent, LabelComponent, ProductSuggestionsComponent } from './components';\n/**\n *\n * Search module\n * @extends {React.Component<ISearchProps<ISearchData>, ISearchState>}\n */\n\nvar Search = /*#__PURE__*/function (_React$Component) {\n  _inherits(Search, _React$Component);\n\n  var _super = _createSuper(Search);\n\n  function Search(props) {\n    var _this;\n\n    _classCallCheck(this, Search);\n\n    _this = _super.call(this, props);\n    _this.hitPrefix = '{';\n    _this.hitSuffix = '}';\n    _this.waitTime = 500; // tslint:disable-next-line:no-any\n\n    _this._focusOutTarget = function (e) {\n      var suggestions = _this.state.suggestions;\n\n      if (suggestions && suggestions.AllSearchResults && e.target.closest('.ms-search') === null) {\n        _this._clearAutoSuggestState();\n      }\n    };\n\n    _this._keyup = function (e) {\n      var suggestions = _this.state.suggestions;\n\n      if (suggestions && suggestions.AllSearchResults && e.keyCode === KeyCodes.Escape) {\n        _this._clearAutoSuggestState();\n      } else if (_this.state.isSearchFormExpanded && e.keyCode === KeyCodes.Escape) {\n        if (_this.state.isSearchFormExpanded) {\n          _this.setState({\n            isSearchFormExpanded: false\n          });\n        }\n      }\n\n      if (!(_this.formReference.current && _this.formReference.current.contains(e.target) || _this.autoSuggestResultDiv.current && _this.autoSuggestResultDiv.current.contains(e.target))) {\n        if (suggestions && suggestions.AllSearchResults) {\n          _this._clearAutoSuggestState();\n        }\n\n        if (_this.state.isSearchFormExpanded) {\n          _this.setState({\n            isSearchFormExpanded: false\n          });\n        }\n      }\n    };\n\n    _this._clearAutoSuggestState = function () {\n      var _this$props = _this.props,\n          actionContext = _this$props.context.actionContext,\n          searchState = _this$props.data.searchState;\n\n      if (_this.searchTextInput.current && _this.searchTextInput.current.value.length > 0) {\n        searchState.searchText = '';\n        searchState.defaultBasicSearchUrl = '';\n        searchState.searchQueryStringParameter = '';\n        actionContext ? actionContext.update(createSearchStateInput(searchState), searchState) : null;\n        _this.searchTextInput.current.value = '';\n      }\n\n      _this.setState({\n        searchText: '',\n        suggestions: undefined,\n        searchRefiners: undefined\n      });\n    };\n\n    _this._handleInputChange = function (query) {\n      if (!query || query.length < _this.maxChars) {\n        _this.setState({\n          searchText: query\n        });\n      }\n\n      if (_this.cancellabelDebounce) {\n        _this.cancellabelDebounce.cancel();\n      }\n\n      var _this$props2 = _this.props,\n          telemetry = _this$props2.telemetry,\n          context = _this$props2.context,\n          searchState = _this$props2.data.searchState;\n\n      if (context) {\n        if (query && query.length > 0) {\n          if (query.length > _this.maxChars) {\n            return;\n          }\n\n          _this.cancellabelDebounce = _debounce(function () {\n            getSearchSuggestionsAction(new AutoSuggestInput(query, _this.topResultsCount, _this._getSuggestionType(_this.inputSuggestionType), _this.hitPrefix, _this.hitSuffix), context.actionContext).then(function (results) {\n              _this._getSearchRefiners(query).then(function (refiners) {\n                _this.setState({\n                  suggestions: results,\n                  searchRefiners: refiners,\n                  autoSuggestAriaLabel: _this._setAutoSuggestResultCount(results)\n                });\n              })[\"catch\"](function (error) {\n                _this.setState({\n                  suggestions: results,\n                  searchRefiners: undefined,\n                  autoSuggestAriaLabel: _this._setAutoSuggestResultCount(results)\n                });\n\n                telemetry.exception(error);\n                telemetry.debug('Unable to get refiners results');\n              });\n            })[\"catch\"](function (error) {\n              _this.setState({\n                suggestions: undefined,\n                searchRefiners: undefined,\n                autoSuggestAriaLabel: _this._setAutoSuggestResultCount()\n              });\n\n              telemetry.exception(error);\n              telemetry.debug('Unable to get auto suggest results');\n            });\n          }, _this.waitTime);\n          setTimeout(function () {\n            _this.cancellabelDebounce();\n          }, 0);\n          searchState.searchText = query;\n        } else {\n          _this.setState({\n            suggestions: undefined,\n            searchRefiners: undefined\n          });\n\n          searchState.searchText = '';\n        }\n\n        context.actionContext.update(createSearchStateInput(searchState), searchState);\n      }\n    };\n\n    _this._getSuggestionType = function (suggestionTypes) {\n      if (suggestionTypes && suggestionTypes.length > 0) {\n        var distinctSuggestionTypes = [];\n        suggestionTypes && suggestionTypes.forEach(function (suggestionTypeItem, index) {\n          suggestionTypeItem.SuggestionType && distinctSuggestionTypes.push(suggestionTypeItem.SuggestionType.charAt(0).toUpperCase() + suggestionTypeItem.SuggestionType.slice(1));\n        });\n        return distinctSuggestionTypes.join(',');\n      }\n\n      return 'Keyword, Product, ScopedCategory';\n    };\n\n    _this._handleSubmit = function (e) {\n      var _this$props3 = _this.props,\n          disableSubmitSearch = _this$props3.config.disableSubmitSearch,\n          _this$props3$context = _this$props3.context,\n          actionContext = _this$props3$context.actionContext,\n          searchQueryStringParameter = _this$props3$context.app.config.searchQueryStringParameter;\n      var query = _this.searchTextInput.current && _this.searchTextInput.current.value;\n      e.preventDefault();\n\n      if (!query || query && query.length === 0 || disableSubmitSearch) {\n        _this.searchTextInput && _this.searchTextInput.current && _this.searchTextInput.current.focus();\n      } else {\n        var searchQsp = searchQueryStringParameter || 'q';\n\n        var searchURL = _this._appendQueryParams(getUrlSync('search', actionContext) || '', query, searchQsp);\n\n        document.location.href = searchURL;\n      }\n    };\n\n    _this._handleCancelSearchChange = function () {\n      var _this$state = _this.state,\n          isSearchFormExpanded = _this$state.isSearchFormExpanded,\n          suggestions = _this$state.suggestions;\n\n      if (!isSearchFormExpanded) {\n        _this.setState({\n          isSearchFormExpanded: true,\n          searchText: '',\n          isInitialState: false\n        });\n      } else {\n        if (suggestions && suggestions.AllSearchResults) {\n          _this._clearAutoSuggestState();\n        }\n\n        _this.setState({\n          isSearchFormExpanded: false\n        });\n      }\n    };\n\n    _this._appendQueryParams = function (route, query, qsp) {\n      if (route && route.length > 0) {\n        return query && query.length > 0 ? \"\".concat(route).concat(route.indexOf('?') === -1 ? '?' : '&').concat(qsp, \"=\").concat(query) : route;\n      }\n\n      return '';\n    };\n\n    _this._setAutoSuggestResultCount = function (result) {\n      if (_this.autoSuggestResultScreenReaderDiv.current !== null) {\n        var ariaLiveRegion = _this.autoSuggestResultScreenReaderDiv.current;\n        var suggestResultString = _this.props.resources.autoSuggestFoundMessage;\n        var emptyResultString = _this.props.resources.noAutoSuggestionMessage;\n        ariaLiveRegion.innerText = result && result.AllSearchResults && result.AllSearchResults.length > 0 ? suggestResultString : emptyResultString;\n        ariaLiveRegion.setAttribute('aria-live', 'assertive');\n        return ariaLiveRegion.innerText;\n      } else {\n        return '';\n      }\n    };\n\n    _this.searchTextInput = /*#__PURE__*/React.createRef();\n    _this.searchCollapsedLabel = /*#__PURE__*/React.createRef();\n    _this.autoSuggestResultScreenReaderDiv = /*#__PURE__*/React.createRef();\n    _this.autoSuggestResultDiv = /*#__PURE__*/React.createRef();\n    _this.formReference = /*#__PURE__*/React.createRef();\n    _this.state = {\n      isSearchFormExpanded: false,\n      searchText: '',\n      searchKeywordSuggestClass: 'ms-search__autoSuggest__keyword',\n      searchProductSuggestClass: 'ms-search__autoSuggest__product',\n      searchCategorySuggestClass: 'ms-search__autoSuggest__category',\n      suggestions: undefined,\n      searchRefiners: undefined,\n      autoSuggestAriaLabel: '',\n      isInitialState: true\n    };\n    _this.maxChars = _this.props.context && _this.props.context.app && _this.props.context.app.config && _this.props.context.app.config.searchInputMaxLength || 50;\n    _this.inputSuggestionType = _this.props.config && _this.props.config.suggestionTypeCriterion;\n    _this.topResultsCount = _this.props.config && _this.props.config.topResultsCount ? _this.props.config.topResultsCount : 5;\n    _this.searchFormClass = 'ms-search__form';\n    _this.searchLabelClass = 'ms-search__label';\n    _this.telemetryContent = getTelemetryObject(_this.props.context.request.telemetryPageName, _this.props.friendlyName, _this.props.telemetry);\n    return _this;\n  }\n\n  _createClass(Search, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                document.body && document.body.addEventListener('mousedown', this._focusOutTarget);\n                window && window.addEventListener('keyup', this._keyup);\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      document.body && document.body.removeEventListener('mousedown', this._focusOutTarget, false);\n      window && window.removeEventListener('keyup', this._keyup, false);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var hideSearchLabel = this.props.config.hideSearchLabel;\n      var _this$state2 = this.state,\n          isSearchFormExpanded = _this$state2.isSearchFormExpanded,\n          isInitialState = _this$state2.isInitialState;\n\n      if (!this.props.context.request.params.isEditor) {\n        if (!hideSearchLabel && isSearchFormExpanded) {\n          this.searchTextInput && this.searchTextInput.current && this.searchTextInput.current.focus();\n        } else if (!isInitialState) {\n          this.searchCollapsedLabel && this.searchCollapsedLabel.current && this.searchCollapsedLabel.current.focus();\n        }\n      }\n    } // tslint:disable-next-line: cyclomatic-complexity max-func-body-length\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props4 = this.props,\n          context = _this$props4.context,\n          _this$props4$resource = _this$props4.resources,\n          searchtext = _this$props4$resource.searchtext,\n          searchLabelArialLabel = _this$props4$resource.searchLabelArialLabel,\n          cancelBtnAriaLabel = _this$props4$resource.cancelBtnAriaLabel,\n          searchBtnAriaLabel = _this$props4$resource.searchBtnAriaLabel,\n          submitBtnAriaLabel = _this$props4$resource.submitBtnAriaLabel,\n          _this$props4$config = _this$props4.config,\n          hideSearchLabel = _this$props4$config.hideSearchLabel,\n          disableSubmitSearch = _this$props4$config.disableSubmitSearch,\n          searchplaceholderText = _this$props4$config.searchplaceholderText,\n          _this$props4$config$c = _this$props4$config.className,\n          className = _this$props4$config$c === void 0 ? '' : _this$props4$config$c;\n      var _this$state3 = this.state,\n          isSearchFormExpanded = _this$state3.isSearchFormExpanded,\n          searchText = _this$state3.searchText,\n          searchKeywordSuggestClass = _this$state3.searchKeywordSuggestClass,\n          searchProductSuggestClass = _this$state3.searchProductSuggestClass,\n          searchCategorySuggestClass = _this$state3.searchCategorySuggestClass,\n          suggestions = _this$state3.suggestions,\n          searchRefiners = _this$state3.searchRefiners;\n      var searchQsp = context && context.app && context.app.config && context.app.config.searchQueryStringParameter || 'q';\n      var searchPageURL = getUrlSync('search', context && context.actionContext) || '';\n\n      var searchURL = this._appendQueryParams(searchPageURL, searchText, searchQsp);\n\n      var searchPlaceholder = searchplaceholderText && searchplaceholderText.length > 0 ? searchplaceholderText : 'Search in Fabrikam';\n      var keywordSuggestions = suggestions && suggestions.AllSearchResults && suggestions.AllSearchResults.filter(function (i) {\n        return i.SuggestionType === SuggestionType.Keyword || i.SuggestionType === SuggestionType.None;\n      });\n      var productSuggestions = suggestions && suggestions.AllSearchResults && suggestions.AllSearchResults.filter(function (i) {\n        return i.SuggestionType === SuggestionType.Product;\n      });\n      var categorySuggestions = suggestions && suggestions.AllSearchResults && suggestions.AllSearchResults.filter(function (i) {\n        return i.SuggestionType === SuggestionType.Category;\n      });\n\n      var viewProps = _objectSpread(_objectSpread({}, this.props), {}, {\n        Search: {\n          moduleProps: this.props,\n          className: \"\".concat(classnames('ms-search', className), \" \").concat(disableSubmitSearch ? 'no-submit' : 'with-submit')\n        },\n        AutoSuggestAriaLabel: {\n          tag: 'div',\n          className: 'msc-autoSuggest__screen-reader',\n          'aria-live': 'assertive',\n          ref: this.autoSuggestResultScreenReaderDiv\n        },\n        AutoSuggestAriaLabelText: this.state.autoSuggestAriaLabel,\n        searchText: this.state.searchText,\n        AutoSuggest: {\n          ref: this.autoSuggestResultDiv,\n          className: 'ms-search__autoSuggest'\n        },\n        KeywordSuggest: {\n          className: searchKeywordSuggestClass\n        },\n        ProductSuggest: {\n          className: searchProductSuggestClass\n        },\n        CategorySuggest: {\n          className: searchCategorySuggestClass\n        },\n        SearchForm: {\n          className: \"\".concat(this.searchFormClass, \" \").concat(isSearchFormExpanded ? 'bx-show' : 'bx-hide')\n        },\n        FormWrapper: {\n          tag: 'form',\n          ref: this.formReference,\n          className: 'ms-search__searchForm',\n          'aria-label': 'Search',\n          name: 'searchForm',\n          role: 'Search',\n          action: searchURL,\n          autoComplete: 'off',\n          onSubmit: this._handleSubmit\n        },\n        UlKeyword: {\n          tag: 'ul',\n          className: classnames('msc-autoSuggest__keywordResults-items', className)\n        },\n        UlProduct: {\n          tag: 'ul',\n          className: classnames('msc-autoSuggest__productResults-items', className)\n        },\n        UlCategory: {\n          tag: 'ul',\n          className: classnames('msc-autoSuggest__categoryResults-items', className)\n        },\n        label: LabelComponent({\n          isSearchFormExpanded: isSearchFormExpanded,\n          searchLabelClass: \"\".concat(this.searchLabelClass, \" \").concat(isSearchFormExpanded ? 'bx-hide' : 'bx-show'),\n          searchtext: searchtext,\n          searchLabelArialLabel: searchLabelArialLabel,\n          searchCollapsedLabel: this.searchCollapsedLabel,\n          hideSearchLabel: hideSearchLabel,\n          handleCancelSearchChange: this._handleCancelSearchChange,\n          telemetryContent: this.telemetryContent\n        }),\n        form: FormComponent({\n          ariaLabelCancel: cancelBtnAriaLabel,\n          ariaLabelSearch: searchBtnAriaLabel,\n          ariaLabelSubmit: submitBtnAriaLabel,\n          hideSearchLabel: hideSearchLabel,\n          searchTextInput: this.searchTextInput,\n          isSearchFormExpanded: isSearchFormExpanded,\n          disableSubmitSearch: disableSubmitSearch,\n          handleInputChange: this._handleInputChange,\n          handleCancelSearchChange: this._handleCancelSearchChange,\n          maxChars: this.maxChars,\n          searchQsp: searchQsp,\n          searchPlaceholder: searchPlaceholder,\n          query: searchText\n        }),\n        autosuggestKeyword: searchText && searchText.length > 0 && keywordSuggestions && keywordSuggestions.length > 0 ? KeywordSuggestionsComponent({\n          searchKeywordSuggestClass: searchKeywordSuggestClass,\n          searchPageURL: searchPageURL,\n          searchQsp: searchQsp,\n          hitPrefix: this.hitPrefix,\n          hitSuffix: this.hitSuffix,\n          autoSuggestProps: this.props,\n          searchText: searchText,\n          suggestions: keywordSuggestions,\n          telemetryContent: this.telemetryContent\n        }) : undefined,\n        autosuggestProduct: searchText && searchText.length > 0 && productSuggestions && productSuggestions.length > 0 ? ProductSuggestionsComponent({\n          searchProductSuggestClass: searchProductSuggestClass,\n          searchPageURL: searchPageURL,\n          searchQsp: searchQsp,\n          hitPrefix: this.hitPrefix,\n          hitSuffix: this.hitSuffix,\n          autoSuggestProps: this.props,\n          searchText: searchText,\n          suggestions: productSuggestions,\n          telemetry: this.props.telemetry,\n          moduleType: this.props.typeName,\n          moduleId: this.props.id,\n          telemetryContent: this.telemetryContent\n        }) : undefined,\n        autosuggestCategory: searchText && searchText.length > 0 && categorySuggestions && categorySuggestions.length > 0 ? CategorySuggestionsComponent({\n          searchCategorySuggestClass: searchCategorySuggestClass,\n          searchPageURL: searchPageURL,\n          searchQsp: searchQsp,\n          hitPrefix: this.hitPrefix,\n          hitSuffix: this.hitSuffix,\n          autoSuggestProps: this.props,\n          searchText: searchText,\n          suggestions: categorySuggestions,\n          searchRefiners: searchRefiners,\n          telemetryContent: this.telemetryContent\n        }) : undefined,\n        callbacks: {\n          handleCancelSearchChange: this._handleCancelSearchChange\n        },\n        isSearchFormExpanded: this.state.isSearchFormExpanded\n      });\n\n      return this.props.renderView(viewProps);\n    }\n  }, {\n    key: \"_getSearchRefiners\",\n    value: function () {\n      var _getSearchRefiners2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(searchText) {\n        var ctx;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                ctx = this.props.context.actionContext;\n                return _context2.abrupt(\"return\", getProductSearchRefinersAsync({\n                  callerContext: ctx\n                }, {\n                  SearchCondition: searchText,\n                  Context: {\n                    ChannelId: +ctx.requestContext.apiSettings.channelId,\n                    CatalogId: +ctx.requestContext.apiSettings.catalogId\n                  }\n                }));\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function _getSearchRefiners(_x) {\n        return _getSearchRefiners2.apply(this, arguments);\n      }\n\n      return _getSearchRefiners;\n    }()\n  }]);\n\n  return Search;\n}(React.Component);\n\nexport default Search;","map":{"version":3,"sources":["/Users/User/Documents/wkea-ec/Msdyn365.Commerce.Online/node_modules/source-map-loader/index.js!/Users/User/Documents/wkea-ec/Msdyn365.Commerce.Online/src/modules/search/search.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createSearchStateInput } from '@msdyn365-commerce-modules/search-utilities';\nimport { getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, KeyCodes } from '@msdyn365-commerce-modules/utilities';\nimport { Autosuggestions } from '@msdyn365-commerce/commerce-entities';\nimport { getUrlSync } from '@msdyn365-commerce/core';\nimport { ProductRefiner } from '@msdyn365-commerce/retail-proxy';\nimport { getProductSearchRefinersAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport classnames from 'classnames';\nimport { debounce } from 'lodash';\nimport * as React from 'react';\n\nimport getSearchSuggestionsAction, { AutoSuggestInput, SuggestionType } from './actions/get-auto-suggest-suggestions';\nimport {\n    CategorySuggestionsComponent,\n    FormComponent,\n    ISearchCategoryViewProps,\n    ISearchKeywordViewProps,\n    ISearchProductViewProps,\n    KeywordSuggestionsComponent,\n    LabelComponent,\n    ProductSuggestionsComponent\n} from './components';\nimport { ISearchData } from './search.data';\nimport { ISearchProps, ISuggestionTypeCriterionData } from './search.props.autogenerated';\n\nexport interface ISearchState {\n    isSearchFormExpanded: boolean;\n    searchText: string;\n    searchKeywordSuggestClass: string;\n    searchProductSuggestClass: string;\n    searchCategorySuggestClass: string;\n    suggestions: Autosuggestions | undefined;\n    searchRefiners?: ProductRefiner[] | undefined;\n    autoSuggestAriaLabel: string;\n    isInitialState: boolean;\n}\n\nexport interface ISearchViewProps extends ISearchProps<ISearchData> {\n    Search: IModuleProps;\n    AutoSuggestAriaLabel: INodeProps;\n    AutoSuggestAriaLabelText: string;\n    searchText: string;\n    AutoSuggest: INodeProps;\n    KeywordSuggest: INodeProps;\n    ProductSuggest: INodeProps;\n    CategorySuggest: INodeProps;\n    SearchForm: INodeProps;\n    FormWrapper: INodeProps;\n    UlKeyword: INodeProps;\n    UlProduct: INodeProps;\n    UlCategory: INodeProps;\n    label: React.ReactNode;\n    form: React.ReactNode;\n    autosuggestKeyword?: ISearchKeywordViewProps;\n    autosuggestProduct?: ISearchProductViewProps;\n    autosuggestCategory?: ISearchCategoryViewProps;\n    callbacks: {\n        handleCancelSearchChange(): void;\n    };\n    isSearchFormExpanded: boolean;\n}\n\n/**\n *\n * Search module\n * @extends {React.Component<ISearchProps<ISearchData>, ISearchState>}\n */\nclass Search extends React.Component<ISearchProps<ISearchData>, ISearchState> {\n    private searchTextInput: React.RefObject<HTMLInputElement>;\n    private searchCollapsedLabel: React.RefObject<HTMLButtonElement>;\n    private formReference: React.RefObject<HTMLButtonElement>;\n    private maxChars: number;\n    private inputSuggestionType?: ISuggestionTypeCriterionData[];\n    private topResultsCount?: number;\n    private hitPrefix: string = '{';\n    private hitSuffix: string = '}';\n    private waitTime: number = 500;\n    private autoSuggestResultScreenReaderDiv: React.RefObject<HTMLDivElement>;\n    private autoSuggestResultDiv: React.RefObject<HTMLDivElement>;\n    private searchFormClass: string;\n    private searchLabelClass: string;\n    private telemetryContent: ITelemetryContent;\n    // @ts-ignore\n    private cancellabelDebounce: debounce;\n\n    constructor(props: ISearchProps<ISearchData>) {\n        super(props);\n        this.searchTextInput = React.createRef();\n        this.searchCollapsedLabel = React.createRef();\n        this.autoSuggestResultScreenReaderDiv = React.createRef();\n        this.autoSuggestResultDiv = React.createRef();\n        this.formReference = React.createRef();\n        this.state = {\n            isSearchFormExpanded: false,\n            searchText: '',\n            searchKeywordSuggestClass: 'ms-search__autoSuggest__keyword',\n            searchProductSuggestClass: 'ms-search__autoSuggest__product',\n            searchCategorySuggestClass: 'ms-search__autoSuggest__category',\n            suggestions: undefined,\n            searchRefiners: undefined,\n            autoSuggestAriaLabel: '',\n            isInitialState: true\n        };\n        this.maxChars =\n            (this.props.context &&\n                this.props.context.app &&\n                this.props.context.app.config &&\n                this.props.context.app.config.searchInputMaxLength) ||\n            50;\n        this.inputSuggestionType = this.props.config && this.props.config.suggestionTypeCriterion;\n        this.topResultsCount = this.props.config && this.props.config.topResultsCount ? this.props.config.topResultsCount : 5;\n        this.searchFormClass = 'ms-search__form';\n        this.searchLabelClass = 'ms-search__label';\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public async componentDidMount(): Promise<void> {\n        document.body && document.body.addEventListener('mousedown', this._focusOutTarget);\n        window && window.addEventListener('keyup', this._keyup);\n    }\n\n    public componentWillUnmount(): void {\n        document.body && document.body.removeEventListener('mousedown', this._focusOutTarget, false);\n        window && window.removeEventListener('keyup', this._keyup, false);\n    }\n\n    public componentDidUpdate(): void {\n        const {\n            config: { hideSearchLabel }\n        } = this.props;\n        const { isSearchFormExpanded, isInitialState } = this.state;\n\n        if (!this.props.context.request.params.isEditor) {\n            if (!hideSearchLabel && isSearchFormExpanded) {\n                this.searchTextInput && this.searchTextInput.current && this.searchTextInput.current.focus();\n            } else if (!isInitialState) {\n                this.searchCollapsedLabel && this.searchCollapsedLabel.current && this.searchCollapsedLabel.current.focus();\n            }\n        }\n    }\n\n    // tslint:disable-next-line: cyclomatic-complexity max-func-body-length\n    public render(): JSX.Element {\n        const {\n            context,\n            resources: { searchtext, searchLabelArialLabel, cancelBtnAriaLabel, searchBtnAriaLabel, submitBtnAriaLabel},\n            config: { hideSearchLabel, disableSubmitSearch, searchplaceholderText, className = '' }\n        } = this.props;\n\n        const {\n            isSearchFormExpanded,\n            searchText,\n            searchKeywordSuggestClass,\n            searchProductSuggestClass,\n            searchCategorySuggestClass,\n            suggestions,\n            searchRefiners\n        } = this.state;\n\n        const searchQsp = (context && context.app && context.app.config && context.app.config.searchQueryStringParameter) || 'q';\n        const searchPageURL = getUrlSync('search', context && context.actionContext) || '';\n        const searchURL = this._appendQueryParams(searchPageURL, searchText, searchQsp);\n        const searchPlaceholder = searchplaceholderText && searchplaceholderText.length > 0 ? searchplaceholderText : 'Search in Fabrikam';\n\n        const keywordSuggestions =\n            suggestions &&\n            suggestions.AllSearchResults &&\n            suggestions.AllSearchResults.filter(\n                i => i.SuggestionType === SuggestionType.Keyword || i.SuggestionType === SuggestionType.None\n            );\n        const productSuggestions =\n            suggestions &&\n            suggestions.AllSearchResults &&\n            suggestions.AllSearchResults.filter(i => i.SuggestionType === SuggestionType.Product);\n        const categorySuggestions =\n            suggestions &&\n            suggestions.AllSearchResults &&\n            suggestions.AllSearchResults.filter(i => i.SuggestionType === SuggestionType.Category);\n\n        const viewProps: ISearchViewProps = {\n            ...(this.props as ISearchProps<ISearchData>),\n\n            Search: {\n                moduleProps: this.props,\n                className: `${classnames('ms-search', className)} ${disableSubmitSearch ? 'no-submit' : 'with-submit'}`,\n            },\n            AutoSuggestAriaLabel: {\n                tag: 'div',\n                className: 'msc-autoSuggest__screen-reader',\n                'aria-live': 'assertive',\n                ref: this.autoSuggestResultScreenReaderDiv\n            },\n            AutoSuggestAriaLabelText: this.state.autoSuggestAriaLabel,\n            searchText: this.state.searchText,\n            AutoSuggest: {\n                ref: this.autoSuggestResultDiv,\n                className: 'ms-search__autoSuggest'\n            },\n            KeywordSuggest: {\n                className: searchKeywordSuggestClass\n            },\n            ProductSuggest: {\n                className: searchProductSuggestClass\n            },\n            CategorySuggest: {\n                className: searchCategorySuggestClass\n            },\n            SearchForm: {\n                className: `${this.searchFormClass} ${isSearchFormExpanded ? 'bx-show' : 'bx-hide'}`\n            },\n            FormWrapper: {\n                tag: 'form',\n                ref: this.formReference,\n                className: 'ms-search__searchForm',\n                'aria-label': 'Search',\n                name: 'searchForm',\n                role: 'Search',\n                action: searchURL,\n                autoComplete: 'off',\n                onSubmit: this._handleSubmit\n            },\n            UlKeyword: {\n                tag: 'ul',\n                className: classnames('msc-autoSuggest__keywordResults-items', className)\n            },\n            UlProduct: {\n                tag: 'ul',\n                className: classnames('msc-autoSuggest__productResults-items', className)\n            },\n            UlCategory: {\n                tag: 'ul',\n                className: classnames('msc-autoSuggest__categoryResults-items', className)\n            },\n            label:LabelComponent({\n                isSearchFormExpanded: isSearchFormExpanded,\n                searchLabelClass: `${this.searchLabelClass} ${isSearchFormExpanded ? 'bx-hide' : 'bx-show'}`,\n                searchtext: searchtext,\n                searchLabelArialLabel: searchLabelArialLabel,\n                searchCollapsedLabel: this.searchCollapsedLabel,\n                hideSearchLabel: hideSearchLabel,\n                handleCancelSearchChange: this._handleCancelSearchChange,\n                telemetryContent: this.telemetryContent\n            }),\n            form: FormComponent({\n                ariaLabelCancel: cancelBtnAriaLabel,\n                ariaLabelSearch: searchBtnAriaLabel,\n                ariaLabelSubmit: submitBtnAriaLabel,\n                hideSearchLabel: hideSearchLabel,\n                searchTextInput: this.searchTextInput,\n                isSearchFormExpanded: isSearchFormExpanded,\n                disableSubmitSearch: disableSubmitSearch,\n                handleInputChange: this._handleInputChange,\n                handleCancelSearchChange: this._handleCancelSearchChange,\n                maxChars: this.maxChars,\n                searchQsp: searchQsp,\n                searchPlaceholder: searchPlaceholder,\n                query: searchText\n            }),\n            autosuggestKeyword:\n                searchText && searchText.length > 0 && keywordSuggestions && keywordSuggestions.length > 0\n                    ? KeywordSuggestionsComponent({\n                          searchKeywordSuggestClass: searchKeywordSuggestClass,\n                          searchPageURL: searchPageURL,\n                          searchQsp: searchQsp,\n                          hitPrefix: this.hitPrefix,\n                          hitSuffix: this.hitSuffix,\n                          autoSuggestProps: this.props,\n                          searchText: searchText,\n                          suggestions: keywordSuggestions,\n                          telemetryContent: this.telemetryContent\n                      })\n                    : undefined,\n            autosuggestProduct:\n                searchText && searchText.length > 0 && productSuggestions && productSuggestions.length > 0\n                    ? ProductSuggestionsComponent({\n                          searchProductSuggestClass: searchProductSuggestClass,\n                          searchPageURL: searchPageURL,\n                          searchQsp: searchQsp,\n                          hitPrefix: this.hitPrefix,\n                          hitSuffix: this.hitSuffix,\n                          autoSuggestProps: this.props,\n                          searchText: searchText,\n                          suggestions: productSuggestions,\n                          telemetry: this.props.telemetry,\n                          moduleType: this.props.typeName,\n                          moduleId: this.props.id,\n                          telemetryContent: this.telemetryContent\n                      })\n                    : undefined,\n            autosuggestCategory:\n                searchText && searchText.length > 0 && categorySuggestions && categorySuggestions.length > 0\n                    ? CategorySuggestionsComponent({\n                          searchCategorySuggestClass: searchCategorySuggestClass,\n                          searchPageURL: searchPageURL,\n                          searchQsp: searchQsp,\n                          hitPrefix: this.hitPrefix,\n                          hitSuffix: this.hitSuffix,\n                          autoSuggestProps: this.props,\n                          searchText: searchText,\n                          suggestions: categorySuggestions,\n                          searchRefiners: searchRefiners,\n                          telemetryContent: this.telemetryContent\n                      })\n                    : undefined,\n            callbacks: {\n                handleCancelSearchChange: this._handleCancelSearchChange\n            },\n            isSearchFormExpanded: this.state.isSearchFormExpanded\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    // tslint:disable-next-line:no-any\n    private _focusOutTarget = (e: any): void => {\n        const { suggestions } = this.state;\n\n        if (\n            suggestions &&\n            suggestions.AllSearchResults &&\n            e.target.closest('.ms-search') === null\n        ) {\n            this._clearAutoSuggestState();\n        }\n    };\n\n    private _keyup = (e: KeyboardEvent): void => {\n        const { suggestions } = this.state;\n\n        if (suggestions && suggestions.AllSearchResults && e.keyCode === KeyCodes.Escape) {\n            this._clearAutoSuggestState();\n        } else if(this.state.isSearchFormExpanded && e.keyCode === KeyCodes.Escape) {\n            if(this.state.isSearchFormExpanded) {\n                this.setState({ isSearchFormExpanded: false });\n            }\n        }\n\n        if (!((this.formReference.current && this.formReference.current.contains(e.target as unknown as Node)) ||\n        (this.autoSuggestResultDiv.current && this.autoSuggestResultDiv.current.contains(e.target as unknown as Node)))) {\n            if (suggestions && suggestions.AllSearchResults) {\n                this._clearAutoSuggestState();\n            }\n\n            if(this.state.isSearchFormExpanded) {\n                this.setState({ isSearchFormExpanded: false });\n            }\n        }\n    };\n\n    private _clearAutoSuggestState = (): void => {\n        const {\n            context: { actionContext },\n            data: { searchState }\n        } = this.props;\n\n        if (this.searchTextInput.current && this.searchTextInput.current.value.length > 0) {\n            searchState.searchText = '';\n            searchState.defaultBasicSearchUrl = '';\n            searchState.searchQueryStringParameter = '';\n            actionContext ? actionContext.update(createSearchStateInput(searchState), searchState) : null;\n            this.searchTextInput.current.value = '';\n        }\n\n        this.setState({ searchText: '', suggestions: undefined, searchRefiners: undefined });\n    };\n\n    private _handleInputChange = (query: string): void => {\n        if (!query || query.length < this.maxChars) {\n            this.setState({ searchText: query });\n        }\n\n        if (this.cancellabelDebounce) {\n            this.cancellabelDebounce.cancel();\n        }\n\n        const {\n            telemetry,\n            context,\n            data: { searchState }\n        } = this.props;\n\n        if (context) {\n            if (query && query.length > 0) {\n                if (query.length > this.maxChars) {\n                    return;\n                }\n\n                this.cancellabelDebounce = debounce(() => {\n                    getSearchSuggestionsAction(\n                        new AutoSuggestInput(\n                            query,\n                            this.topResultsCount,\n                            this._getSuggestionType(this.inputSuggestionType),\n                            this.hitPrefix,\n                            this.hitSuffix\n                        ),\n                        context.actionContext\n                    )\n                        .then(results => {\n                            this._getSearchRefiners(query)\n                                .then(refiners => {\n                                    this.setState({ suggestions: results, searchRefiners: refiners,\n                                        autoSuggestAriaLabel: this._setAutoSuggestResultCount(results) });\n                                })\n                                .catch(error => {\n                                    this.setState({ suggestions: results, searchRefiners: undefined,\n                                        autoSuggestAriaLabel: this._setAutoSuggestResultCount(results) });\n                                    telemetry.exception(error);\n                                    telemetry.debug('Unable to get refiners results');\n                                });\n                        })\n                        .catch(error => {\n                            this.setState({ suggestions: undefined, searchRefiners: undefined,\n                                autoSuggestAriaLabel: this._setAutoSuggestResultCount() });\n                            telemetry.exception(error);\n                            telemetry.debug('Unable to get auto suggest results');\n                        });\n                },                                  this.waitTime);\n\n                setTimeout(() => {\n                    this.cancellabelDebounce();\n                },         0);\n\n                searchState.searchText = query;\n            } else {\n                this.setState({ suggestions: undefined, searchRefiners: undefined });\n                searchState.searchText = '';\n            }\n            context.actionContext.update(createSearchStateInput(searchState), searchState);\n        }\n    };\n\n    private _getSuggestionType = (suggestionTypes?: ISuggestionTypeCriterionData[]): string => {\n        if (suggestionTypes && suggestionTypes.length > 0) {\n            const distinctSuggestionTypes: string[] = [];\n            suggestionTypes && suggestionTypes.forEach((suggestionTypeItem, index) => {\n                suggestionTypeItem.SuggestionType && distinctSuggestionTypes.push(suggestionTypeItem.SuggestionType.charAt(0).toUpperCase() + suggestionTypeItem.SuggestionType.slice(1));\n            });\n            return distinctSuggestionTypes.join(',');\n        }\n        return 'Keyword, Product, ScopedCategory';\n    };\n\n    private async _getSearchRefiners(searchText: string): Promise<ProductRefiner[]> {\n        const { actionContext: ctx } = this.props.context;\n        return getProductSearchRefinersAsync(\n            { callerContext: ctx },\n            {\n                SearchCondition: searchText,\n                Context: {\n                    ChannelId: +ctx.requestContext.apiSettings.channelId,\n                    CatalogId: +ctx.requestContext.apiSettings.catalogId\n                }\n            }\n        );\n    }\n\n    private _handleSubmit = (\n        e: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement> | React.FormEvent<HTMLFormElement>\n    ): void => {\n        const {\n            config: { disableSubmitSearch },\n            context: {\n                actionContext,\n                app: {\n                    config: { searchQueryStringParameter }\n                }\n            }\n        } = this.props;\n\n        const query = this.searchTextInput.current && this.searchTextInput.current.value;\n        e.preventDefault();\n\n        if (!query || (query && query.length === 0) || disableSubmitSearch) {\n            this.searchTextInput && this.searchTextInput.current && this.searchTextInput.current.focus();\n        } else {\n            const searchQsp = searchQueryStringParameter || 'q';\n            const searchURL = this._appendQueryParams(getUrlSync('search', actionContext) || '', query, searchQsp);\n            document.location.href = searchURL;\n        }\n    };\n\n    private _handleCancelSearchChange = (): void => {\n        const { isSearchFormExpanded, suggestions } = this.state;\n\n        if (!isSearchFormExpanded) {\n            this.setState({\n                isSearchFormExpanded: true,\n                searchText: '',\n                isInitialState: false\n            });\n        } else {\n            if (suggestions && suggestions.AllSearchResults) {\n                this._clearAutoSuggestState();\n            }\n\n            this.setState({ isSearchFormExpanded: false });\n        }\n    };\n\n    private _appendQueryParams = (route: string, query: string, qsp: string): string => {\n        if (route && route.length > 0) {\n            return query && query.length > 0 ? `${route}${route.indexOf('?') === -1 ? '?' : '&'}${qsp}=${query}` : route;\n        }\n        return '';\n    };\n\n    private _setAutoSuggestResultCount = (result?: Autosuggestions) => {\n        if (this.autoSuggestResultScreenReaderDiv.current !== null) {\n            const ariaLiveRegion = this.autoSuggestResultScreenReaderDiv.current;\n            const suggestResultString = this.props.resources.autoSuggestFoundMessage;\n            const emptyResultString = this.props.resources.noAutoSuggestionMessage;\n            ariaLiveRegion.innerText = result && (result.AllSearchResults && result.AllSearchResults.length > 0) ? suggestResultString : emptyResultString;\n            ariaLiveRegion.setAttribute('aria-live','assertive');\n            return ariaLiveRegion.innerText;\n        } else {\n            return '';\n        }\n    };\n}\n\nexport default Search;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}