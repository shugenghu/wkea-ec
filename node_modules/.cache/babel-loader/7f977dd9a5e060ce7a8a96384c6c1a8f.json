{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _toConsumableArray from\"@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import classname from'classnames';import{observable}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{Button,getPayloadObject,getTelemetryAttributes,getTelemetryObject,TelemetryConstant}from'@msdyn365-commerce-modules/utilities';import*as Msdyn365 from'@msdyn365-commerce/core';import LabelComponent from'../../common/label';import{getSalesOrderHistoryWithHydrationsAction,GetSalesOrderHistoryWithHydrationsInput}from'./actions/get-order-shipment-history';import{getSalesOrder}from'./components/get-sales-order';export*from'../../common/get-groups';export*from'../../common/get-order-information';export*from'../../common/get-sales-line';export*from'../../common/get-sales-lines';export*from'../../common/utilities';export*from'./components/get-sales-order';export*from'../../common/get-order-information';export*from'./components/get-sales-order';var OrderHistory=/*#__PURE__*/function(_React$Component){_inherits(OrderHistory,_React$Component);var _super=_createSuper(OrderHistory);function OrderHistory(props){var _this;_classCallCheck(this,OrderHistory);_this=_super.call(this,props);_this.handleOrderHistoryHeadingChange=function(event){return _this.props.config.heading.text=event.target.value;};_this.onMoreButtonClick=function(){_this.getOrderHistory();};_this.getOrderHistory=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var actionContext,input,response,_this$orderHistory$pr,_this$orderHistory$sa,products,salesOrders;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:actionContext=_this.props.context.actionContext;input=new GetSalesOrderHistoryWithHydrationsInput(_this.paging,_this.props.context.request.apiSettings);_context.prev=2;_this.viewState.isLoading=true;_context.next=6;return getSalesOrderHistoryWithHydrationsAction(input,actionContext);case 6:response=_context.sent;if(response){products=response.products,salesOrders=response.salesOrders;(_this$orderHistory$pr=_this.orderHistory.products).push.apply(_this$orderHistory$pr,_toConsumableArray(products));(_this$orderHistory$sa=_this.orderHistory.salesOrders).push.apply(_this$orderHistory$sa,_toConsumableArray(salesOrders));_this.viewState.isShowMoreButton=_this.viewState.isShowMoreButton&&response.salesOrders.length>0&&response.salesOrders.length===_this.pageSize;_this.paging.skip+=_this.pageSize;}_this.viewState.isLoading=false;return _context.abrupt(\"return\",Promise.resolve());case 12:_context.prev=12;_context.t0=_context[\"catch\"](2);return _context.abrupt(\"return\",Promise.reject());case 15:case\"end\":return _context.stop();}}},_callee,null,[[2,12]]);}));_this.orderHistory={salesOrders:[],products:[]};_this.viewState={isDataReady:false,hasError:false,isShowMoreButton:(_this.props.config.pageSize||0)>0,isLoading:false};_this.pageSize=_this.props.config.pageSize||10;_this.paging={top:_this.pageSize,skip:0};_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);_this.payLoad=getPayloadObject('click',_this.telemetryContent,'');return _this;}_createClass(OrderHistory,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.getOrderHistory().then(function(){_this2.viewState.isDataReady=true;})[\"catch\"](function(ex){_this2.viewState.hasError=true;});}},{key:\"render\",value:function render(){var _this3=this;var _this$props=this.props,_this$props$config=_this$props.config,heading=_this$props$config.heading,className=_this$props$config.className,showChannelInfo=_this$props$config.showChannelInfo,_this$props$resources=_this$props.resources,genericErrorMessage=_this$props$resources.genericErrorMessage,noOrderHistoryLable=_this$props$resources.noOrderHistoryLable,moreButtonText=_this$props$resources.moreButtonText,backToShopping=_this$props$resources.backToShopping,orderCountLabel=_this$props$resources.orderCountLabel,ordersCountLabel=_this$props$resources.ordersCountLabel,loadingLabel=_this$props$resources.loadingLabel;var _this$orderHistory=this.orderHistory,salesOrders=_this$orderHistory.salesOrders,products=_this$orderHistory.products;var _this$viewState=this.viewState,isDataReady=_this$viewState.isDataReady,hasError=_this$viewState.hasError,isShowMoreButton=_this$viewState.isShowMoreButton,isLoading=_this$viewState.isLoading;var backToShoppingUrl=Msdyn365.getUrlSync('home',this.props.context.actionContext)||'';var channelIdentities=this.props.data.channels.result&&this.props.data.channels.result.channelIdentities;var orgUnitLocations=this.props.data.orgUnitLocations.result&&this.props.data.orgUnitLocations.result.orgUnitLocations;var viewProps=_objectSpread(_objectSpread({},this.props),{},{orderHistory:this.orderHistory,viewState:this.viewState,orderHistoryProps:{moduleProps:this.props,className:classname('ms-order-history',className)},header:{headerProps:{className:'ms-order-history__header'},heading:heading&&heading.text&&/*#__PURE__*/React.createElement(Msdyn365.Text,Object.assign({},heading,{className:'ms-order-history__heading',text:heading.text,tag:heading.tag||'h2',editProps:{onEdit:this.handleOrderHistoryHeadingChange,requestContext:this.props.context.request}}))},backToShoppingLink:backToShoppingUrl&&/*#__PURE__*/React.createElement(Button,{className:'ms-order-history__btn-keep-shopping',href:backToShoppingUrl},backToShopping)});if(hasError){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-history__alert',label:genericErrorMessage})});return this.props.renderView(viewProps);}if(!isDataReady){viewProps=_objectSpread(_objectSpread({},viewProps),{},{loading:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-history__loading',label:loadingLabel})});return this.props.renderView(viewProps);}if(!salesOrders||salesOrders.length===0){viewProps=_objectSpread(_objectSpread({},viewProps),{},{emptyMessage:/*#__PURE__*/React.createElement(\"p\",{className:'ms-order-history__empty-message'},noOrderHistoryLable)});return this.props.renderView(viewProps);}var _orderCountLabel=salesOrders.length===1?orderCountLabel:ordersCountLabel;this.payLoad.contentAction.etext=TelemetryConstant.ViewMore;var viewMoreAttributes=getTelemetryAttributes(this.telemetryContent,this.payLoad);viewProps=_objectSpread(_objectSpread({},viewProps),{},{header:_objectSpread(_objectSpread({},viewProps.header),{},{orderCountLabel:/*#__PURE__*/React.createElement(\"span\",{className:'ms-order-history__order-count'},\"(\".concat(salesOrders.length,\" \").concat(_orderCountLabel,\")\"))}),list:{listProps:{className:'ms-order-history__sales-order-list'},salesOrders:salesOrders.map(function(salesOrder){return getSalesOrder(_objectSpread(_objectSpread({},_this3.props),{},{products:products,salesOrder:salesOrder,channelIdentities:channelIdentities,orgUnitLocations:orgUnitLocations,showChannelInfo:showChannelInfo,telemetryContent:_this3.telemetryContent}));})},moreButton:isShowMoreButton&&/*#__PURE__*/React.createElement(Button,Object.assign({className:\"ms-order-history__btn-more \".concat(isLoading?'is-busy':'')},viewMoreAttributes,{disabled:isLoading,onClick:this.onMoreButtonClick}),moreButtonText)});return this.props.renderView(viewProps);}}]);return OrderHistory;}(React.Component);__decorate([observable],OrderHistory.prototype,\"orderHistory\",void 0);__decorate([observable],OrderHistory.prototype,\"viewState\",void 0);OrderHistory=__decorate([observer],OrderHistory);export default OrderHistory;","map":{"version":3,"sources":["modules/order-history/order-history.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classname from 'classnames';\nimport { observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport { Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, IModuleProps, INodeProps, IPayLoad, ITelemetryContent, TelemetryConstant } from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\n\nimport LabelComponent from '../../common/label';\nimport {\n    getSalesOrderHistoryWithHydrationsAction, GetSalesOrderHistoryWithHydrationsInput,\n    IOrderHistory, IPaging\n} from './actions/get-order-shipment-history';\nimport { getSalesOrder, ISalesOrder } from './components/get-sales-order';\nimport { IOrderHistoryData } from './order-history.data';\nimport { IOrderHistoryProps } from './order-history.props.autogenerated';\n\nexport * from '../../common/get-groups';\nexport * from '../../common/get-order-information';\nexport * from '../../common/get-sales-line';\nexport * from '../../common/get-sales-lines';\nexport * from '../../common/utilities';\nexport * from './components/get-sales-order';\n\nexport * from '../../common/get-order-information';\nexport * from './components/get-sales-order';\n\nexport interface IHeader {\n    headerProps: INodeProps;\n    heading: React.ReactNode;\n    orderCountLabel?: React.ReactNode;\n}\n\nexport interface IList {\n    listProps: INodeProps;\n    salesOrders: ISalesOrder[];\n}\n\nexport interface IOrderHistoryViewState {\n    isDataReady: boolean;\n    hasError: boolean;\n    isLoading: boolean;\n    isShowMoreButton: boolean;\n}\n\nexport interface IOrderHistoryViewProps extends IOrderHistoryProps<IOrderHistoryData> {\n    orderHistory: IOrderHistory;\n    orderHistoryProps: IModuleProps;\n    alert?: React.ReactNode;\n    loading?: React.ReactNode;\n    emptyMessage?: React.ReactNode;\n    header: IHeader;\n    backToShoppingLink?: React.ReactNode;\n    list?: IList;\n    moreButton?: React.ReactNode;\n    viewState: IOrderHistoryViewState;\n}\n\n/**\n *\n * OrderHistory component\n * @extends {React.Component<IOrderHistoryProps<IOrderHistoryData>>}\n */\n@observer\nclass OrderHistory extends React.Component<IOrderHistoryProps<IOrderHistoryData>> {\n    @observable private orderHistory: IOrderHistory;\n    @observable private viewState: IOrderHistoryViewState;\n    private pageSize: number;\n    private paging: IPaging;\n    private telemetryContent?: ITelemetryContent;\n    private payLoad: IPayLoad;\n\n    constructor(props: IOrderHistoryProps<IOrderHistoryData>) {\n        super(props);\n        this.orderHistory = {\n            salesOrders: [],\n            products: []\n        };\n        this.viewState = {\n            isDataReady: false,\n            hasError: false,\n            isShowMoreButton: (this.props.config.pageSize || 0) > 0,\n            isLoading: false\n        };\n        this.pageSize = this.props.config.pageSize || 10;\n        this.paging = {\n            top: this.pageSize,\n            skip: 0\n        };\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n        this.payLoad = getPayloadObject('click', this.telemetryContent, '');\n    }\n\n    public componentDidMount(): void {\n        this.getOrderHistory()\n            .then(() => {\n                this.viewState.isDataReady = true;\n            })\n            .catch(ex => {\n                this.viewState.hasError = true;\n            });\n    }\n\n    public render(): JSX.Element {\n        const {\n            config: { heading, className, showChannelInfo },\n            resources: { genericErrorMessage, noOrderHistoryLable, moreButtonText, backToShopping, orderCountLabel, ordersCountLabel, loadingLabel }\n        } = this.props;\n        const { salesOrders, products } = this.orderHistory;\n        const { isDataReady, hasError, isShowMoreButton, isLoading } = this.viewState;\n        const backToShoppingUrl = Msdyn365.getUrlSync('home', this.props.context.actionContext) || '';\n        const channelIdentities = this.props.data.channels.result && this.props.data.channels.result.channelIdentities;\n        const orgUnitLocations = this.props.data.orgUnitLocations.result && this.props.data.orgUnitLocations.result.orgUnitLocations;\n\n        let viewProps: IOrderHistoryViewProps = {\n            ...this.props,\n            orderHistory: this.orderHistory,\n            viewState: this.viewState,\n            orderHistoryProps: {\n                moduleProps: this.props,\n                className: classname('ms-order-history', className)\n            },\n            header: {\n                headerProps: { className: 'ms-order-history__header' },\n                heading: heading && heading.text && (\n                <Msdyn365.Text\n                    {...heading}\n                    className='ms-order-history__heading'\n                    text={heading.text}\n                    tag={heading.tag || 'h2'}\n                    editProps={{ onEdit: this.handleOrderHistoryHeadingChange, requestContext: this.props.context.request }}\n                />\n                )\n            },\n            backToShoppingLink: backToShoppingUrl && (\n                <Button className='ms-order-history__btn-keep-shopping' href={backToShoppingUrl}>\n                    {backToShopping}\n                </Button>\n            )\n        };\n\n        if (hasError) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-history__alert' label={genericErrorMessage} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!isDataReady) {\n            viewProps = {\n                ...viewProps,\n                loading: <LabelComponent className='ms-order-history__loading' label={loadingLabel} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!salesOrders || salesOrders.length === 0) {\n            viewProps = {\n                ...viewProps,\n                emptyMessage: <p className='ms-order-history__empty-message'>{noOrderHistoryLable}</p>\n            };\n\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        const _orderCountLabel = salesOrders.length === 1 ? orderCountLabel : ordersCountLabel;\n        this.payLoad.contentAction.etext = TelemetryConstant.ViewMore;\n        const viewMoreAttributes = getTelemetryAttributes(this.telemetryContent!,this.payLoad);\n\n        viewProps = {\n            ...viewProps,\n            header: {\n                ...viewProps.header,\n                orderCountLabel: <span className='ms-order-history__order-count'>{`(${salesOrders.length} ${_orderCountLabel})`}</span>\n            },\n            list: {\n                listProps: { className: 'ms-order-history__sales-order-list' },\n                salesOrders: salesOrders.map(salesOrder =>\n                    getSalesOrder({\n                        ...this.props,\n                        products,\n                        salesOrder,\n                        channelIdentities,\n                        orgUnitLocations,\n                        showChannelInfo,\n                        telemetryContent: this.telemetryContent\n                    })\n                )\n            },\n            moreButton: isShowMoreButton && (\n                <Button className={`ms-order-history__btn-more ${isLoading ? 'is-busy' : ''}`} {...viewMoreAttributes} disabled={isLoading} onClick={this.onMoreButtonClick}>\n                    {moreButtonText}\n                </Button>\n            )\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleOrderHistoryHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n\n    private onMoreButtonClick = () => {\n        // tslint:disable-next-line:no-floating-promises\n        this.getOrderHistory();\n    }\n\n    private getOrderHistory = async (): Promise<void> => {\n        const actionContext = this.props.context.actionContext;\n        const input = new GetSalesOrderHistoryWithHydrationsInput(this.paging, this.props.context.request.apiSettings);\n\n        try {\n            this.viewState.isLoading = true;\n            const response = await getSalesOrderHistoryWithHydrationsAction(input, actionContext);\n            if (response) {\n                const { products, salesOrders } = response;\n                this.orderHistory.products.push(...products);\n                this.orderHistory.salesOrders.push(...salesOrders);\n                this.viewState.isShowMoreButton = this.viewState.isShowMoreButton && response.salesOrders.length > 0 && response.salesOrders.length === this.pageSize;\n                this.paging.skip += this.pageSize;\n            }\n            this.viewState.isLoading = false;\n            return Promise.resolve();\n        } catch (error) {\n            return Promise.reject();\n        }\n    }\n}\n\nexport default OrderHistory;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}