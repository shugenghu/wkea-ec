{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import classnames from'classnames';import React,{useState}from'react';import{Button,getPayloadObject,getTelemetryAttributes,PopupProducts,TelemetryConstant}from'@msdyn365-commerce-modules/utilities';import{msdyn365Commerce}from'@msdyn365-commerce/core';import{addOrderTemplateToCartAction,AddOrderTemplateToCartInput}from'@msdyn365-commerce-modules/retail-actions';import{LinesAddedToCartDialog}from'../lines-added-to-cart-dialog/lines-added-to-cart-dialog.component';const onClick=async(_event,props,setUploadStatus,openModal,setLinesAddedToCartDialogOpen,setAddedLinesCount)=>{openModal(true);setUploadStatus('LOADING');const{context}=props;const addOrderTemplateToCartInput=new AddOrderTemplateToCartInput(props.data.orderTemplate.productList.Id);const addedCartLines=await addOrderTemplateToCartAction(addOrderTemplateToCartInput,context.actionContext);setAddedLinesCount(addedCartLines.length);openModal(false);setTimeout(()=>{setLinesAddedToCartDialogOpen(true);},500);};const AddToCartComponentActions={onClick:onClick};const _getModalText=(status,props)=>{const{dialogStrings}=props;const{addToCartFailureMessage,addToCartSuccessMessage,addToCartProcessMessage}=dialogStrings;if(status==='LOADING'){return\"\".concat(addToCartProcessMessage,\"...\");}if(status==='SUCCESS'){return addToCartSuccessMessage;}if(status==='FAILED'){return addToCartFailureMessage;}return'';};const AddOrderTemplate=props=>{const[uploadStatus,setUploadStatus]=useState('WAITING');const[modalOpen,setModalOpen]=useState(false);const[addedLinesCount,setAddedLinesCount]=useState(0);const[linesAddedToCartDialogOpen,setLinesAddedToCartDialogOpen]=useState(false);const onClickHandler=async event=>{await AddToCartComponentActions.onClick(event,props,setUploadStatus,setModalOpen,setLinesAddedToCartDialogOpen,setAddedLinesCount);};const closeLinesAddedToCartDialog=()=>{setLinesAddedToCartDialogOpen(false);};const modalText=_getModalText(uploadStatus,props);const processStatusClass=uploadStatus.toLowerCase();const dialogStrings={closeWindowButtonText:props.dialogStrings.closeWindowButtonText};const payLoad=getPayloadObject('click',props.telemetryContent,TelemetryConstant.AddOrderTemplateToCart);const addOrderTemplateAttribute=getTelemetryAttributes(props.telemetryContent,payLoad);const popupProps={dialogStrings:dialogStrings,className:'msc-add-order-template-to-cart',processStatusClass:processStatusClass,text:modalText,modalOpen:modalOpen,setModalOpen:setModalOpen};const renderModalPopup=/*#__PURE__*/React.createElement(PopupProducts,Object.assign({},popupProps));const products=props.data.orderTemplate.orderTemplateLines.map(line=>line.fullProduct).filter(fullProduct=>fullProduct);return/*#__PURE__*/React.createElement(React.Fragment,null,renderModalPopup,/*#__PURE__*/React.createElement(Button,Object.assign({className:classnames('msc-add-order-template-to-cart ',props.className),\"aria-label\":props.addToCartText,disabled:props.data.orderTemplate.totalLines===0,onClick:onClickHandler},addOrderTemplateAttribute),props.addToCartText),/*#__PURE__*/React.createElement(LinesAddedToCartDialog,{className:'msc-lines-added-to-cart-dialog',id:props.id,typeName:props.typeName,context:props.context,dialogStrings:props.dialogStrings.linesAddedToCartDialogResources,data:{linesCount:addedLinesCount,orderTemplate:props.data.orderTemplate.productList,products:products},modalOpen:linesAddedToCartDialogOpen,onClose:closeLinesAddedToCartDialog}));};export const AddOrderTemplateToCartComponent=msdyn365Commerce.createComponent('AddOrderTemplate',_objectSpread({component:AddOrderTemplate},AddToCartComponentActions));","map":{"version":3,"sources":["order-template/add-order-template-to-cart/add-order-template-to-cart.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import classnames from 'classnames';\nimport React, { useState } from 'react';\n\nimport { Button, getPayloadObject, getTelemetryAttributes, IPopupProductsProps, ITelemetryContent, PopupProducts, TelemetryConstant } from '@msdyn365-commerce-modules/utilities';\nimport { IComponent, IComponentProps, msdyn365Commerce } from '@msdyn365-commerce/core';\n\nimport { addOrderTemplateToCartAction, AddOrderTemplateToCartInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { OrderTemplate } from '@msdyn365-commerce-modules/retail-actions';\nimport { FullProduct } from '@msdyn365-commerce/commerce-entities';\nimport { ILinesAddedToCartDialogResources, LinesAddedToCartDialog } from '../lines-added-to-cart-dialog/lines-added-to-cart-dialog.component';\n\nexport interface IAddOrderTemplateToCartComponentData {\n    orderTemplate: OrderTemplate;\n}\n\nexport interface IAddOrderTemplateToCartComponentProps extends IComponentProps<IAddOrderTemplateToCartComponentData> {\n    className?: string;\n    addToCartText: string;\n    telemetryContent?: ITelemetryContent;\n    dialogStrings: {\n        closeWindowButtonText: string;\n        addToCartFailureMessage: string;\n        addToCartSuccessMessage: string;\n        addToCartProcessMessage: string;\n        linesAddedToCartDialogResources: ILinesAddedToCartDialogResources;\n    };\n}\n\nexport declare type IAddToCartActionFailureReason = 'EMPTYINPUT' | 'MISSINGDIMENSION' | 'OUTOFSTOCK' | 'CARTACTIONFAILED'; // rename to used method\n\nexport interface IAddOrderTemplateToCartComponent extends IComponent<IAddOrderTemplateToCartComponentProps> {\n    onClick(): (event: React.MouseEvent<HTMLElement>, props: IAddOrderTemplateToCartComponentProps) => void;\n}\n\nconst onClick = async (\n    _event: React.MouseEvent<HTMLElement>,\n    props: IAddOrderTemplateToCartComponentProps,\n    setUploadStatus: (uploadStatus: addOrderTemplateToCartStatus) => void,\n    openModal: (opened: boolean) => void,\n    setLinesAddedToCartDialogOpen: (opened: boolean) => void,\n    setAddedLinesCount: (value: number) => void): Promise<void> => {\n        openModal(true);\n        setUploadStatus('LOADING');\n\n        const { context } = props;\n        const addOrderTemplateToCartInput = new AddOrderTemplateToCartInput(props.data.orderTemplate.productList.Id);\n        const addedCartLines = await addOrderTemplateToCartAction(addOrderTemplateToCartInput, context.actionContext);\n        setAddedLinesCount(addedCartLines.length);\n        openModal(false);\n        setTimeout(() => {\n            setLinesAddedToCartDialogOpen(true);\n        }, 500); // tslint:disable-line:align\n};\n\nconst AddToCartComponentActions = {\n    onClick: onClick\n};\n\nexport type addOrderTemplateToCartStatus = 'LOADING' | 'SUCCESS' | 'FAILED' | 'WAITING';\n\nconst _getModalText = (status: addOrderTemplateToCartStatus, props: IAddOrderTemplateToCartComponentProps) => {\n    const { dialogStrings } = props;\n    const { addToCartFailureMessage, addToCartSuccessMessage, addToCartProcessMessage } = dialogStrings;\n\n    if (status === 'LOADING') {\n        return `${addToCartProcessMessage}...`;\n    }\n\n    if (status === 'SUCCESS') {\n        return addToCartSuccessMessage;\n    }\n\n    if (status === 'FAILED') {\n        return addToCartFailureMessage;\n    }\n\n    return '';\n};\n\nconst AddOrderTemplate: React.FC<IAddOrderTemplateToCartComponentProps> = (props: IAddOrderTemplateToCartComponentProps) => {\n    const [uploadStatus, setUploadStatus] = useState<addOrderTemplateToCartStatus>('WAITING');\n    const [modalOpen, setModalOpen] = useState(false);\n    const [addedLinesCount, setAddedLinesCount] = useState(0);\n    const [linesAddedToCartDialogOpen, setLinesAddedToCartDialogOpen] = useState(false);\n\n    const onClickHandler = async (event: React.MouseEvent<HTMLElement>) => {\n        await AddToCartComponentActions.onClick(event, props, setUploadStatus, setModalOpen, setLinesAddedToCartDialogOpen, setAddedLinesCount);\n    };\n    const closeLinesAddedToCartDialog = () => {\n        setLinesAddedToCartDialogOpen(false);\n    };\n\n    const modalText = _getModalText(uploadStatus, props);\n    const processStatusClass = uploadStatus.toLowerCase();\n    const dialogStrings = { closeWindowButtonText: props.dialogStrings.closeWindowButtonText };\n    const payLoad = getPayloadObject('click', props.telemetryContent!, TelemetryConstant.AddOrderTemplateToCart);\n    const addOrderTemplateAttribute = getTelemetryAttributes(props.telemetryContent!, payLoad);\n\n    const popupProps: IPopupProductsProps = {\n        dialogStrings: dialogStrings,\n        className: 'msc-add-order-template-to-cart',\n        processStatusClass: processStatusClass,\n        text: modalText,\n        modalOpen: modalOpen,\n        setModalOpen: setModalOpen\n    };\n\n    const renderModalPopup = <PopupProducts {...popupProps} />;\n\n    const products = props.data.orderTemplate.orderTemplateLines.map(line => line.fullProduct).filter(fullProduct => fullProduct) as FullProduct[];\n\n    return (\n        <>\n            {renderModalPopup}\n            <Button\n                className={classnames('msc-add-order-template-to-cart ', props.className)}\n                aria-label={props.addToCartText}\n                disabled={props.data.orderTemplate.totalLines === 0}\n                onClick={onClickHandler}\n                {...addOrderTemplateAttribute}\n            >\n                {props.addToCartText}\n            </Button>\n            {\n                <LinesAddedToCartDialog\n                    className={'msc-lines-added-to-cart-dialog'}\n                    id={props.id}\n                    typeName={props.typeName}\n                    context={props.context}\n                    dialogStrings={props.dialogStrings.linesAddedToCartDialogResources}\n                    data={{\n                        linesCount: addedLinesCount,\n                        orderTemplate: props.data.orderTemplate.productList,\n                        products: products\n                    }}\n                    modalOpen={linesAddedToCartDialogOpen}\n                    onClose={closeLinesAddedToCartDialog}\n                />\n            }\n        </>\n    );\n};\n\n// @ts-ignore\nexport const AddOrderTemplateToCartComponent: React.FunctionComponent<IAddOrderTemplateToCartComponentProps> = msdyn365Commerce.createComponent<IAddOrderTemplateToCartComponent>(\n    'AddOrderTemplate',\n    { component: AddOrderTemplate, ...AddToCartComponentActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}