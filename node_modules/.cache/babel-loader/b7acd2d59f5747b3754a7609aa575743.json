{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import{ActiveCartProductsInput,getActiveCartProductsAction,getAvailabilitiesForCartLineItems,getDeliveryOptionsForCartLineItems,ProductAvailabilitiesForCartLineItems,ProductDeliveryOptionsForCartLineItems}from'@msdyn365-commerce-modules/retail-actions';import{getCartState}from'@msdyn365-commerce/global-state';export var createInput=function createInput(){return new ActiveCartProductsInput();};export function getMiniCartData(_x){return _getMiniCartData.apply(this,arguments);}function _getMiniCartData(){_getMiniCartData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx){var miniCartData,cartState,cart;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:miniCartData={};_context.next=3;return getCartState(ctx);case 3:cartState=_context.sent;cart=cartState.cart;if(!(cart&&cart.CartLines&&cart.CartLines.length)){_context.next=12;break;}_context.next=8;return getActiveCartProductsAction(new ActiveCartProductsInput(),ctx).then(function(products){if(products){miniCartData.products=products;}})[\"catch\"](function(error){ctx.telemetry.exception(error);throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');});case 8:_context.next=10;return getAvailabilitiesForCartLineItems(new ProductAvailabilitiesForCartLineItems(ctx.requestContext.apiSettings),ctx).then(function(availableQuantity){if(availableQuantity){miniCartData.productAvailabilites=availableQuantity;}})[\"catch\"](function(error){ctx.telemetry.exception(error);throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');});case 10:_context.next=12;return getDeliveryOptionsForCartLineItems(new ProductDeliveryOptionsForCartLineItems(ctx.requestContext.apiSettings),ctx).then(function(deliveryOptions){if(deliveryOptions){miniCartData.deliveryOptions=deliveryOptions;}})[\"catch\"](function(error){ctx.telemetry.exception(error);throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');});case 12:return _context.abrupt(\"return\",miniCartData);case 13:case\"end\":return _context.stop();}}},_callee);}));return _getMiniCartData.apply(this,arguments);}","map":{"version":3,"sources":["modules/cart-icon/utils/get-products-in-mini-cart.ts"],"names":[],"mappings":"uIAAA,OAAS,uBAAT,CAAkC,2BAAlC,CAA+D,iCAA/D,CAAkG,kCAAlG,CAAoK,qCAApK,CAA2M,sCAA3M,KAAyP,2CAAzP,CAEA,OAAS,YAAT,KAA6B,iCAA7B,CAYA,MAAO,IAAM,CAAA,WAAW,CAAG,QAAd,CAAA,WAAc,EAAK,CAC5B,MAAO,IAAI,CAAA,uBAAJ,EAAP,CACH,CAFM,CAOP,eAAsB,CAAA,eAAtB,oD,qGAAO,iBAA+B,GAA/B,kJACG,YADH,CACiC,EADjC,uBAGqB,CAAA,YAAY,CAAC,GAAD,CAHjC,QAGG,SAHH,eAIG,IAJH,CAIU,SAAS,CAAC,IAJpB,MAOC,IAAI,EAAI,IAAI,CAAC,SAAb,EAA0B,IAAI,CAAC,SAAL,CAAe,MAP1C,iDAQO,CAAA,2BAA2B,CAC7B,GAAI,CAAA,uBAAJ,EAD6B,CAE7B,GAF6B,CAA3B,CAID,IAJC,CAII,SAAA,QAAQ,CAAG,CACb,GAAI,QAAJ,CAAc,CACV,YAAY,CAAC,QAAb,CAAwB,QAAxB,CACH,CACJ,CARC,WASK,SAAA,KAAK,CAAG,CACX,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,4EAAV,CAAN,CACH,CAZC,CARP,+BAsBO,CAAA,iCAAiC,CACnC,GAAI,CAAA,qCAAJ,CAA0C,GAAG,CAAC,cAAJ,CAAmB,WAA7D,CADmC,CAEnC,GAFmC,CAAjC,CAID,IAJC,CAII,SAAA,iBAAiB,CAAG,CACtB,GAAI,iBAAJ,CAAuB,CACnB,YAAY,CAAC,oBAAb,CAAqC,iBAArC,CACH,CACJ,CARC,WASK,SAAA,KAAK,CAAG,CACX,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,4EAAV,CAAN,CACH,CAZC,CAtBP,gCAoCO,CAAA,kCAAkC,CACpC,GAAI,CAAA,sCAAJ,CAA2C,GAAG,CAAC,cAAJ,CAAmB,WAA9D,CADoC,CAEpC,GAFoC,CAAlC,CAID,IAJC,CAII,SAAA,eAAe,CAAG,CACpB,GAAI,eAAJ,CAAqB,CACjB,YAAY,CAAC,eAAb,CAA+B,eAA/B,CACH,CACJ,CARC,WASK,SAAA,KAAK,CAAG,CACX,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,4EAAV,CAAN,CACH,CAZC,CApCP,yCAmDI,YAnDJ,yD","sourcesContent":["import { ActiveCartProductsInput, getActiveCartProductsAction, getAvailabilitiesForCartLineItems, getDeliveryOptionsForCartLineItems, IProductInventoryInformation, ProductAvailabilitiesForCartLineItems, ProductDeliveryOptionsForCartLineItems } from '@msdyn365-commerce-modules/retail-actions';\nimport { IActionContext } from '@msdyn365-commerce/core';\nimport { getCartState } from '@msdyn365-commerce/global-state';\nimport { ProductDeliveryOptions, SimpleProduct } from '@msdyn365-commerce/retail-proxy';\n\n/**\n * IMiniCartData entity interface.\n */\nexport interface IMiniCartData {\n    products?: SimpleProduct[];\n    productAvailabilites?: IProductInventoryInformation[];\n    deliveryOptions?: ProductDeliveryOptions[];\n}\n\nexport const createInput = () => {\n    return new ActiveCartProductsInput();\n};\n\n/**\n * Calls the Retail API and returns a mini cart data\n */\nexport async function getMiniCartData(ctx: IActionContext): Promise<IMiniCartData> {\n    const miniCartData: IMiniCartData = {};\n\n    const cartState = await getCartState(ctx);\n    const cart = cartState.cart;\n\n    // If there are cart lines, make call to get products\n    if (cart && cart.CartLines && cart.CartLines.length) {\n        await getActiveCartProductsAction(\n            new ActiveCartProductsInput(),\n            ctx\n        )\n            .then(products => {\n                if (products) {\n                    miniCartData.products = products;\n                }\n            })\n            .catch(error => {\n                ctx.telemetry.exception(error);\n                throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');\n            });\n\n        await getAvailabilitiesForCartLineItems(\n            new ProductAvailabilitiesForCartLineItems(ctx.requestContext.apiSettings),\n            ctx\n        )\n            .then(availableQuantity => {\n                if (availableQuantity) {\n                    miniCartData.productAvailabilites =  availableQuantity;\n                }\n            })\n            .catch(error => {\n                ctx.telemetry.exception(error);\n                throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');\n            });\n\n        await getDeliveryOptionsForCartLineItems(\n            new ProductDeliveryOptionsForCartLineItems(ctx.requestContext.apiSettings),\n            ctx\n        )\n            .then(deliveryOptions => {\n                if (deliveryOptions) {\n                    miniCartData.deliveryOptions = deliveryOptions;\n                }\n            })\n            .catch(error => {\n                ctx.telemetry.exception(error);\n                throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');\n            });\n    }\n\n    return miniCartData;\n}"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}