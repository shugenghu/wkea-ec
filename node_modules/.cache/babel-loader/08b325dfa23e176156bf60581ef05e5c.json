{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{getOrderTemplates,GetOrderTemplatesInput,QueryResultSettingsProxy}from'..';import{getPaginatedOrderTemplateLinesAction,GetPaginatedOrderTemplateLinesInput}from'..';import{OrderTemplate}from'../utilities/order-templates';/**\r\n *  Input class for the GetOrderTemplates data action\r\n */export var GetFullOrderTemplatesInput=function GetFullOrderTemplatesInput(queryResultSettings){_classCallCheck(this,GetFullOrderTemplatesInput);this.getCacheKey=function(){return\"GetFullOrderTemplates\";};this.getCacheObjectType=function(){return'GetFullOrderTemplates';};this.dataCacheType=function(){return'none';};this.queryResultSettings=queryResultSettings;};/**\r\n * createInput method for the GetOrderTemplate method\r\n * @param inputData The input data passed to the createInput method.\r\n */export var createGetFullOrderTemplatesInput=function createGetFullOrderTemplatesInput(inputData){var requestContext=inputData.requestContext;if(!requestContext.user.isAuthenticated){throw new Error('Unable to get full order templates. User is not authenticated.');}var queryResultSettings=QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings;queryResultSettings.count=true;return new GetFullOrderTemplatesInput(queryResultSettings);};/**\r\n * The action method for the GetFullOrderTemplates data action\r\n * @param input The action input\r\n * @param ctx The action context\r\n */export function getFullOrderTemplatesAction(_x,_x2){return _getFullOrderTemplatesAction.apply(this,arguments);}/**\r\n * The GetFullOrderTemplates Data Action\r\n * Returns order templates\r\n */function _getFullOrderTemplatesAction(){_getFullOrderTemplatesAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var orderTemplates,inputParams,productLists,i,list,inputLines,linesState;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(ctx.requestContext.user.isAuthenticated){_context.next=2;break;}throw new Error('Unable to get full order templates. User is not authenticated.');case 2:orderTemplates=[];inputParams=new GetOrderTemplatesInput();_context.next=6;return getOrderTemplates(inputParams,ctx);case 6:productLists=_context.sent;if(!(!productLists||productLists.length===0)){_context.next=9;break;}return _context.abrupt(\"return\",orderTemplates);case 9:i=0;case 10:if(!(i<productLists.length)){_context.next=20;break;}list=productLists[i];inputLines=new GetPaginatedOrderTemplateLinesInput(list.Id,input.queryResultSettings);_context.next=15;return getPaginatedOrderTemplateLinesAction(inputLines,ctx);case 15:linesState=_context.sent;orderTemplates.push(new OrderTemplate(list,linesState.lines,linesState.totalCount));case 17:++i;_context.next=10;break;case 20:ctx.trace(orderTemplates.length.toString());return _context.abrupt(\"return\",orderTemplates);case 22:case\"end\":return _context.stop();}}},_callee);}));return _getFullOrderTemplatesAction.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/order-templates/get-full-order-templates',action:getFullOrderTemplatesAction,input:createGetFullOrderTemplatesInput});","map":{"version":3,"sources":["../../../src/order-templates/get-full-order-templates.ts"],"names":[],"mappings":"8MAAA,OACI,0BADJ,KAKgC,yBALhC,CAQA,OAAS,iBAAT,CAA4B,sBAA5B,CAAoD,wBAApD,KAAoF,IAApF,CACA,OAAS,oCAAT,CAA+C,mCAA/C,KAA0F,IAA1F,CACA,OAAS,aAAT,KAA8B,8BAA9B,CAEA;;AAEG,GACH,UAAa,CAAA,0BAAb,CAGI,oCAAY,mBAAZ,CAAqD,kDAI9C,KAAA,WAAA,CAAc,0CAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,uBAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,MAAjB,EAAhB,CALH,KAAK,mBAAL,CAA2B,mBAA3B,CACH,CALL,CAYA;;;AAGG,GACH,MAAO,IAAM,CAAA,gCAAgC,CAAG,QAAnC,CAAA,gCAAmC,CAAC,SAAD,CAAgE,IACpG,CAAA,cADoG,CACjF,SADiF,CACpG,cADoG,CAE5G,GAAI,CAAC,cAAc,CAAC,IAAf,CAAoB,eAAzB,CAA0C,CACtC,KAAM,IAAI,CAAA,KAAJ,CAAU,gEAAV,CAAN,CACH,CACD,GAAM,CAAA,mBAAmB,CAAyB,wBAAwB,CAAC,aAAzB,CAAuC,SAAvC,EAAkD,mBAApG,CACA,mBAAmB,CAAC,KAApB,CAA4B,IAA5B,CAEA,MAAO,IAAI,CAAA,0BAAJ,CAA+B,mBAA/B,CAAP,CACH,CATM,CAWP;;;;AAIG,GACH,eAAsB,CAAA,2BAAtB,oEAyBA;;;AAGG,G,6HA5BI,iBAA2C,KAA3C,CAA8E,GAA9E,8LACE,GAAG,CAAC,cAAJ,CAAmB,IAAnB,CAAwB,eAD1B,8BAEO,IAAI,CAAA,KAAJ,CAAU,gEAAV,CAFP,QAKG,cALH,CAKqC,EALrC,CAOG,WAPH,CAOiB,GAAI,CAAA,sBAAJ,EAPjB,uBAQuC,CAAA,iBAAiB,CAAC,WAAD,CAAc,GAAd,CARxD,QAQG,YARH,oBAUC,CAAC,YAAD,EAAiB,YAAY,CAAC,MAAb,GAAwB,CAV1C,0DAWQ,cAXR,SAcM,CAdN,CAcU,CAdV,cAca,CAAC,CAAG,YAAY,CAAC,MAd9B,2BAeO,IAfP,CAec,YAAY,CAAC,CAAD,CAf1B,CAgBO,UAhBP,CAgBoB,GAAI,CAAA,mCAAJ,CAAwC,IAAI,CAAC,EAA7C,CAAiD,KAAK,CAAC,mBAAvD,CAhBpB,wBAiB0B,CAAA,oCAAoC,CAAC,UAAD,CAAa,GAAb,CAjB9D,SAiBO,UAjBP,eAkBC,cAAc,CAAC,IAAf,CAAoB,GAAI,CAAA,aAAJ,CAAkB,IAAlB,CAAwB,UAAU,CAAC,KAAnC,CAA0C,UAAU,CAAC,UAArD,CAApB,EAlBD,QAcsC,EAAE,CAdxC,gCAqBH,GAAG,CAAC,KAAJ,CAAU,cAAc,CAAC,MAAf,CAAsB,QAAtB,EAAV,EArBG,gCAsBI,cAtBJ,yD,8DA6BP,cAAe,CAAA,0BAA0B,CAAkB,CACvD,EAAE,CAAE,oFADmD,CAEvD,MAAM,CAA4B,2BAFqB,CAGvD,KAAK,CAAE,gCAHgD,CAAlB,CAAzC","sourcesContent":["import { CacheType,\n    createObservableDataAction,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICreateActionContext } from '@msdyn365-commerce/core';\nimport { IQueryResultSettings } from '@msdyn365-commerce/retail-proxy';\nimport { ProductList } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { getOrderTemplates, GetOrderTemplatesInput, QueryResultSettingsProxy } from '..';\nimport { getPaginatedOrderTemplateLinesAction, GetPaginatedOrderTemplateLinesInput } from '..';\nimport { OrderTemplate } from '../utilities/order-templates';\n\n/**\n *  Input class for the GetOrderTemplates data action\n */\nexport class GetFullOrderTemplatesInput implements IActionInput {\n    public queryResultSettings: IQueryResultSettings;\n\n    constructor(queryResultSettings: IQueryResultSettings) {\n        this.queryResultSettings = queryResultSettings;\n    }\n\n    public getCacheKey = () => `GetFullOrderTemplates`;\n    public getCacheObjectType = () => 'GetFullOrderTemplates';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * createInput method for the GetOrderTemplate method\n * @param inputData The input data passed to the createInput method.\n */\nexport const createGetFullOrderTemplatesInput = (inputData: ICreateActionContext): GetFullOrderTemplatesInput => {\n    const { requestContext } = inputData;\n    if (!requestContext.user.isAuthenticated) {\n        throw new Error('Unable to get full order templates. User is not authenticated.');\n    }\n    const queryResultSettings: IQueryResultSettings = QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings;\n    queryResultSettings.count = true;\n\n    return new GetFullOrderTemplatesInput(queryResultSettings);\n};\n\n/**\n * The action method for the GetFullOrderTemplates data action\n * @param input The action input\n * @param ctx The action context\n */\nexport async function getFullOrderTemplatesAction(input: GetFullOrderTemplatesInput, ctx: IActionContext): Promise<OrderTemplate[]> {\n    if (!ctx.requestContext.user.isAuthenticated) {\n        throw new Error('Unable to get full order templates. User is not authenticated.');\n    }\n\n    const orderTemplates: OrderTemplate[] = [];\n\n    const inputParams = new GetOrderTemplatesInput();\n    const productLists: ProductList[] = await getOrderTemplates(inputParams, ctx);\n\n    if (!productLists || productLists.length === 0) {\n        return orderTemplates;\n    }\n\n    for (let i = 0; i < productLists.length; ++i) {\n        const list = productLists[i];\n        const inputLines = new GetPaginatedOrderTemplateLinesInput(list.Id, input.queryResultSettings);\n        const linesState = await getPaginatedOrderTemplateLinesAction(inputLines, ctx);\n        orderTemplates.push(new OrderTemplate(list, linesState.lines, linesState.totalCount));\n    }\n\n    ctx.trace(orderTemplates.length.toString());\n    return orderTemplates;\n}\n\n/**\n * The GetFullOrderTemplates Data Action\n * Returns order templates\n */\nexport default createObservableDataAction<OrderTemplate[]>({\n    id: '@msdyn365-commerce-modules/retail-actions/order-templates/get-full-order-templates',\n    action: <IAction<OrderTemplate[]>>getFullOrderTemplatesAction,\n    input: createGetFullOrderTemplatesInput\n});"],"sourceRoot":""},"metadata":{},"sourceType":"module"}