{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol===\"undefined\"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import{getRnrAuthEndpointId,getRnrEndpointId,getRnrPartnerId,getSelectedProductIdFromActionInput}from'@msdyn365-commerce-modules/retail-actions';import{format,getTelemetryObject,LabeledDropdown}from'@msdyn365-commerce-modules/utilities';import{RatingComponent}from'@msdyn365-commerce/components';import*as Msdyn365 from'@msdyn365-commerce/core';import classname from'classnames';import{reaction}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{getReviewsForGivenProduct}from'../../actions/get-product-reviews';import{GetProductReviewsInput}from'../../actions/inputs/get-product-reviews-input';import{ReportReviewConcernInput}from'../../actions/inputs/report-review-concern-input';import{SubmitHelpfulnessVoteInput}from'../../actions/inputs/submit-helpfulness-vote-input';import reportReviewConcern from'../../actions/report-review-concern';import submitHelpfulnessVote from'../../actions/submit-helpfulness-vote';import{ReviewModal,submitReview}from'../../common/review-modal';import{PageControls,ReviewCount}from'./components/components';import{ReportReviewModal}from'./components/report-review-modal';import{ReviewCard}from'./components/review-card';var ReviewsList=/*#__PURE__*/function(_React$Component){_inherits(ReviewsList,_React$Component);var _super=_createSuper(ReviewsList);function ReviewsList(props){var _this;_classCallCheck(this,ReviewsList);_this=_super.call(this,props);_this.sortByDropdownOptions=[{key:'MostHelpful',value:_this.props.resources.mostHelpfulSortOptionText},{key:'MostRecent',value:_this.props.resources.mostRecentSortOptionText},{key:'HighestRating',value:_this.props.resources.highestRatedSortOptionText},{key:'LowestRating',value:_this.props.resources.lowestRatedSortOptionText}];_this.filterByDropdownOptions=[{key:'1;2;3;4;5',value:_this.props.resources.allRatinsFilterByOptionText},{key:'5',value:_this.props.resources.fiveStarFilterByOptionText},{key:'4',value:_this.props.resources.fourStarFilterByOptionText},{key:'3',value:_this.props.resources.threeStarFilterByOptionText},{key:'2',value:_this.props.resources.twoStarFilterByOptionText},{key:'1',value:_this.props.resources.oneStarFilterByOptionText}];_this.handleHeadingChange=function(event){return _this.props.config.heading.text=event.target.value;};_this._userReview=function(){var userReview=_this.props.data.userReview.result;return userReview&&_this._reviewCard(userReview,true);};_this._reviewCards=function(reviewList){var userReview=_this.props.data.userReview.result;var reviewElements=[];var _iterator=_createForOfIteratorHelper(reviewList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var review=_step.value;if(!review.isTakenDown&&review.isPublished&&userReview?review.reviewId!==userReview.reviewId:true){reviewElements.push(_this._reviewCard(review,false));}}}catch(err){_iterator.e(err);}finally{_iterator.f();}return reviewElements;};_this._reviewCard=function(review,userReview){return ReviewCard({review:review,resources:_objectSpread({},_this.props.resources),context:_this.props.context,isUserReview:userReview,parentId:_this.props.id,parentType:_this.props.typeName,reportedReviews:_this.state.reportedReviews,returnRef:_this._userReportModalToggle,reportedReviewId:_this.state.reportingReviewId,toggleWriteReviewModal:_this._toggleReviewModal,toggleReportReviewModal:_this._onReportModalOpen,updateReviewHelpfulness:_this.updateReviewHelpfulnessVote,votedReviews:_this.state.votedReviews});};_this._userReviewModal=function(){return ReviewModal({userReview:_this.props.data.userReview.result,product:_this.props.data.product.result,resources:_objectSpread({},_this.props.resources),context:_this.props.context,parentId:_this.props.id,parentType:_this.props.typeName,isOpen:_this.state.isReviewModalOpen,rating:_this.state.userReviewRating,reviewTitle:_this.state.userReviewTitle,reviewText:_this.state.userReviewText,onModalToggle:_this._toggleReviewModal,onTitleChange:_this._onTitleChange,onTextChange:_this._onTextChange,onRatingChange:_this._onRatingChange,onReviewComplete:_this._onReviewComplete,renderContextId:'writeReview-list',returnRef:_this._userReviewModalToggle,hasError:_this.state.hasReviewError});};_this._onTitleChange=function(event){_this.reviewsListCallbacks.updateReviewTitle(event.target.value);};_this._onTextChange=function(event){_this.reviewsListCallbacks.updateReviewText(event.target.value);};_this._onRatingChange=function(value){_this.reviewsListCallbacks.updateRating(value);};_this._toggleReviewModal=function(){var userReview=_this.props.data.userReview.result;if(_this.state.isReviewModalOpen){_this.setState({isReviewModalOpen:false,hasReviewError:false});}else{_this.setState({isReviewModalOpen:true,userReviewText:userReview.reviewText,userReviewTitle:userReview.title,userReviewRating:userReview.rating});}};_this._onReviewComplete=function(isSuccess){if(isSuccess){_this.setState({isReviewModalOpen:false,hasReviewError:false});}else{_this.setState({hasReviewError:true});}};_this._reportReviewModal=function(){return ReportReviewModal({resources:_objectSpread({},_this.props.resources),context:_this.props.context,isOpen:_this.state.isReportModalOpen,returnRef:_this._userReportModalToggle,reportedKey:_this.state.reportedKey,onModalToggle:_this._onReportModalClose,onRadioChange:_this._onRadioChange,reportReview:_this._reportReview,hasError:_this.state.hasReportError,telemetryContent:_this.telemetryContent});};_this._onReportModalOpen=function(reviewId){_this.setState({isReportModalOpen:true,reportingReviewId:reviewId,reported:false,reportedKey:\"8\"});};_this._onReportModalClose=function(){_this.setState({isReportModalOpen:false,hasReportError:false});};_this._onRadioChange=function(event){_this.setState({reportedKey:event.currentTarget.getAttribute('data-key')||''});};_this._reportReviewCallback=function(reviewId,reportedKey){reportReviewConcern(new ReportReviewConcernInput(reviewId,getRnrPartnerId(_this.props.context.actionContext),_this.props.context.request.locale,reportedKey,_this.getUserToken(_this.props.context.request),getRnrAuthEndpointId(_this.props.context.actionContext)),_this.props.context.actionContext).then(function(_value){var reportedReview=_this.state.reportedReviews;reportedReview.push(reviewId);_this.setState({reported:true,reportedReviews:reportedReview,hasReportError:false});})[\"catch\"](function(_value){_this.setState({hasReportError:true});});};_this._reportReview=function(){_this._reportReviewCallback(_this.state.reportingReviewId,_this.state.reportedKey);};_this.updateSortByDropdown=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(notification){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.updateReviews(0,notification.selectedOption,_this.state.selectedFilterByOption,1,_this.state.isFilterApplied);case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.updateFilterByDropdown=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(notification){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _this.updateReviews(0,_this.state.selectedSortByOption,notification.selectedOption,1,true);case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.updateReviews=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(skipItems,selectedSortByOption,selectedFilterByOption,currentPage,isFilterApplied){var productId,result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:productId=getSelectedProductIdFromActionInput(_this.props.context.actionContext);if(!(productId===undefined)){_context3.next=3;break;}return _context3.abrupt(\"return\");case 3:_context3.next=5;return getReviewsForGivenProduct(new GetProductReviewsInput(productId,getRnrPartnerId(_this.props.context.actionContext),_this.props.context.request.locale,getRnrEndpointId(_this.props.context.actionContext),selectedSortByOption.key,selectedFilterByOption.key,skipItems<0?0:skipItems),_this.props.context.actionContext);case 5:result=_context3.sent;if(result&&result.items&&result.pagingInfo&&result.pagingInfo.totalItems!==undefined){_this.setState({currentPage:currentPage,listOfReviews:result.items,selectedSortByOption:selectedSortByOption,selectedFilterByOption:selectedFilterByOption,reviewsCount:result.pagingInfo.totalItems,isFilterApplied:isFilterApplied});}case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3,_x4,_x5,_x6,_x7){return _ref3.apply(this,arguments);};}();_this._updateVoteUi=function(reviewId,isHelpful){var alreadyExists=false;var list=_this.state.votedReviews.map(function(review){if(review.reviewId===reviewId){review.approved=isHelpful;alreadyExists=true;}return review;});if(!alreadyExists){list=list.concat({reviewId:reviewId,approved:isHelpful});}_this.setState({votedReviews:list});};_this.updateReviewHelpfulnessVote=function(reviewId,isHelpful){submitHelpfulnessVote(new SubmitHelpfulnessVoteInput(reviewId,getRnrPartnerId(_this.props.context.actionContext),_this.props.context.request.locale,isHelpful,_this.getUserToken(_this.props.context.request),getRnrAuthEndpointId(_this.props.context.actionContext)),_this.props.context.actionContext).then(function(){_this._updateVoteUi(reviewId,isHelpful);});};_this.getUserToken=function(context){return context&&context.user&&context.user.token;};_this.reviewsListCallbacks={updateReviewTitle:function updateReviewTitle(title){_this.setState({userReviewTitle:title});},updateReviewText:function updateReviewText(text){_this.setState({userReviewText:text});},updateRating:function updateRating(rating){_this.setState({userReviewRating:rating});},onReviewSubmitted:function onReviewSubmitted(isSuccessful){if(isSuccessful){_this.setState({isReviewModalOpen:false,hasReviewError:false});}else{_this.setState({hasReviewError:true});}},submitReview:submitReview,toggleModal:_this._toggleReviewModal,updateReviewHelpfulnessVote:_this.updateReviewHelpfulnessVote,toggleReportModal:function toggleReportModal(reviewId){_this.state.isReportModalOpen?_this._onReportModalOpen(reviewId):_this._onReportModalClose();},reportReview:_this._reportReviewCallback,updateFilterByDropdown:_this.updateFilterByDropdown,updateSortByDropdown:_this.updateSortByDropdown,updateReviews:_this.updateReviews};var userReview=_this.props.data.userReview.result;_this.state={skipItems:0,reviewsCount:0,listOfReviews:[],currentPage:1,showSpinner:false,isFilterApplied:false,selectedSortByOption:_this.sortByDropdownOptions[0],selectedFilterByOption:_this.filterByDropdownOptions[0],userReviewRating:userReview?userReview.rating:0,userReviewText:userReview?userReview.reviewText:'',userReviewTitle:userReview?userReview.title:'',isReviewModalOpen:false,hasReviewError:false,isReportModalOpen:false,hasReportError:false,reported:false,reportedKey:\"8\",reportingReviewId:'',reportedReviews:[],votedReviews:[]};_this._userReviewModalToggle=/*#__PURE__*/React.createRef();_this._userReportModalToggle=/*#__PURE__*/React.createRef();_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);return _this;}_createClass(ReviewsList,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.props.data.reviewsList.then(function(reviewsList){if(reviewsList&&reviewsList.pagingInfo&&reviewsList.pagingInfo.totalItems&&reviewsList.items&&reviewsList.items.length>0){_this2.setState({listOfReviews:reviewsList.items,reviewsCount:reviewsList.pagingInfo.totalItems});}});reaction(function(){return _this2.props.data.ratingsReviewsState.result&&_this2.props.data.ratingsReviewsState.result.filterKey;},/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(filterKey){var filterKeyValue,dropdownItemsCount,filterByOption,selectedIndex;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:filterKeyValue=Number(filterKey);dropdownItemsCount=_this2.filterByDropdownOptions.length;if(!(!!filterKey&&!isNaN(filterKeyValue)&&filterKeyValue<dropdownItemsCount)){_context4.next=12;break;}filterByOption=_this2.filterByDropdownOptions.find(function(option){return option.key===filterKey;});if(filterByOption){_context4.next=8;break;}_this2.props.telemetry.warning(\"[reviews-list] cannot find filter with key \".concat(filterKey));_context4.next=12;break;case 8:_context4.next=10;return _this2.updateReviews(0,_this2.state.selectedSortByOption,filterByOption,1,true);case 10:selectedIndex=dropdownItemsCount-filterKeyValue;_this2.setState({selectedFilterByOption:_this2.filterByDropdownOptions[selectedIndex]});case 12:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x8){return _ref4.apply(this,arguments);};}());}},{key:\"render\",value:function render(){var _this$props$config=this.props.config,className=_this$props$config.className,heading=_this$props$config.heading,reviewsShownOnEachPage=_this$props$config.reviewsShownOnEachPage;var _this$state=this.state,currentPage=_this$state.currentPage,reviewsCount=_this$state.reviewsCount,selectedFilterByOption=_this$state.selectedFilterByOption,selectedSortByOption=_this$state.selectedSortByOption;var ratingsSummary=this.props.data.ratingsSummary.result;var resources=this.props.resources;var completeClass=classname('ms-reviews-list',className);var viewProps=_objectSpread(_objectSpread({},this.props),{},{state:this.state,className:completeClass,moduleProps:{moduleProps:this.props,className:completeClass},callbacks:this.reviewsListCallbacks,reviewModal:this._userReviewModal(),reportReviewModal:this._reportReviewModal(),filterByDropdown:/*#__PURE__*/React.createElement(LabeledDropdown,{labelText:resources.filterByDropdownText,dropdownId:'reviewsListFilterBy',dropdownOptions:this.filterByDropdownOptions,selectedOption:selectedFilterByOption,onSelectOption:this.updateFilterByDropdown,controlledByParent:true}),sortByDropdown:/*#__PURE__*/React.createElement(LabeledDropdown,{labelText:resources.sortByDropdownText,dropdownId:'reviewsListSortBy',dropdownOptions:this.sortByDropdownOptions,selectedOption:selectedSortByOption,onSelectOption:this.updateSortByDropdown}),averageRating:ratingsSummary&&/*#__PURE__*/React.createElement(RatingComponent,{avgRating:ratingsSummary.averageRating||0,readOnly:true,ariaLabel:format(resources.averageRatingAriaLabel,ratingsSummary.averageRating,'5'),ratingCount:\"\".concat(ratingsSummary.reviewsCount),data:{},context:this.props.context,id:this.props.id,typeName:this.props.typeName}),reviewCount:/*#__PURE__*/React.createElement(ReviewCount,{resources:_objectSpread({},this.props.resources),currentPage:currentPage,reviewsCount:reviewsCount,reviewsShownOnEachPage:reviewsShownOnEachPage}),refineReviewsProps:{className:'ms-reviews-list__refiners'},reviewsListProps:{className:'ms-reviews-list__reviews'},reviewCards:this._reviewCards(this.state.listOfReviews),userReview:this._userReview(),pageControls:/*#__PURE__*/React.createElement(PageControls,{resources:_objectSpread({},this.props.resources),currentPage:currentPage,reviewsShownOnEachPage:reviewsShownOnEachPage,selectedSortByOption:selectedSortByOption,selectedFilterByOption:selectedFilterByOption,updateReviews:this.updateReviews,reviewsCount:reviewsCount,telemetryContent:this.telemetryContent}),noReviewsMessage:/*#__PURE__*/React.createElement(\"span\",{className:'ms-reviews-list__empty-message',\"aria-live\":'polite'},resources.noReviewsMessage),noReviewsWithFilterMessage:/*#__PURE__*/React.createElement(\"span\",{className:'ms-reviews-list__filter-message',\"aria-live\":'polite'},resources.noReviewsWithSelectedFilterMessage),heading:heading&&/*#__PURE__*/React.createElement(Msdyn365.Text,{className:'ms-reviews-list__heading',tag:heading.tag||'h2',text:heading.text,editProps:{onEdit:this.handleHeadingChange,requestContext:this.props.context.request}}),sortByOptions:this.sortByDropdownOptions,filterByOptions:this.filterByDropdownOptions});return this.props.renderView(viewProps);}}]);return ReviewsList;}(React.Component);ReviewsList=__decorate([observer],ReviewsList);export default ReviewsList;","map":{"version":3,"sources":["modules/reviews-list/reviews-list.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getRnrAuthEndpointId, getRnrEndpointId, getRnrPartnerId, getSelectedProductIdFromActionInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { format, getTelemetryObject, ILabeledDropdownOnChangeNotification, ILabeledDropdownOption, IModuleProps, INodeProps, ITelemetryContent, LabeledDropdown } from '@msdyn365-commerce-modules/utilities';\nimport { Review } from '@msdyn365-commerce/commerce-entities';\nimport { RatingComponent } from '@msdyn365-commerce/components';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport { SimpleProduct } from '@msdyn365-commerce/retail-proxy';\nimport classname from 'classnames';\nimport { reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { getReviewsForGivenProduct } from '../../actions/get-product-reviews';\nimport { GetProductReviewsInput } from '../../actions/inputs/get-product-reviews-input';\nimport { ReportReviewConcernInput, ReviewConcernCategory } from '../../actions/inputs/report-review-concern-input';\nimport { SubmitHelpfulnessVoteInput } from '../../actions/inputs/submit-helpfulness-vote-input';\nimport reportReviewConcern from '../../actions/report-review-concern';\nimport submitHelpfulnessVote from '../../actions/submit-helpfulness-vote';\nimport { IReviewModalViewProps, ReviewModal, submitReview } from '../../common/review-modal';\nimport { IRnrKeyValuePair, IRnrOrderByKeyValuePair } from '../../common/rnrInterface';\nimport { PageControls, ReviewCount } from './components/components';\nimport { IReportReviewModalViewProps, ReportReviewModal } from './components/report-review-modal';\nimport { IReviewCardViewProps, ReviewCard } from './components/review-card';\nimport { IReviewsListData } from './reviews-list.data';\nimport { IReviewsListProps } from './reviews-list.props.autogenerated';\n\nexport interface IReviewsListState {\n    skipItems: number;\n    listOfReviews: Review[];\n    currentPage: number;\n    reviewsCount: number;\n    showSpinner: boolean;\n    isFilterApplied: boolean;\n    selectedSortByOption: ILabeledDropdownOption;\n    selectedFilterByOption: ILabeledDropdownOption;\n    userReviewRating: number;\n    userReviewTitle: string;\n    userReviewText: string;\n    isReviewModalOpen: boolean;\n    hasReviewError: boolean;\n    isReportModalOpen: boolean;\n    hasReportError: boolean;\n    reportingReviewId: string;\n    reportedKey: string;\n    reported: boolean;\n    reportedReviews: string[];\n    votedReviews: {reviewId: string; approved: boolean}[];\n}\n\nexport interface IReviewsListCallbacks {\n    toggleModal(): void;\n    updateReviewTitle(title: string): void;\n    updateReviewText(text: string): void;\n    updateRating(rating: number): void;\n    onReviewSubmitted(isSuccessful: boolean): void;\n    submitReview(product: SimpleProduct, title: string, text: string, rating: number, context: Msdyn365.ICoreContext, userReview?: Review, onReviewSubmission?: (isSuccessful: boolean) => void): void;\n    updateReviewHelpfulnessVote(reviewId: string, isHelpful: boolean): void;\n    toggleReportModal(reviewId: string): void;\n    reportReview(reviewId: string, reportedKey: string): void;\n    updateSortByDropdown(notification: ILabeledDropdownOnChangeNotification): void;\n    updateFilterByDropdown(notification: ILabeledDropdownOnChangeNotification): void;\n    updateReviews(skipItems: number, selectedSortByOption: ILabeledDropdownOption, selectedFilterByOption: ILabeledDropdownOption, currentPage: number, isFilterApplied: boolean): void;\n}\n\nexport interface IReviewsListViewProps extends IReviewsListProps<IReviewsListData> {\n    state: IReviewsListState;\n    className: string;\n    callbacks: IReviewsListCallbacks;\n    moduleProps: IModuleProps;\n    reviewModal: IReviewModalViewProps;\n    reportReviewModal: IReportReviewModalViewProps;\n    sortByDropdown: React.ReactNode;\n    filterByDropdown: React.ReactNode;\n    averageRating: React.ReactNode;\n    reviewCount: React.ReactElement;\n    refineReviewsProps: INodeProps;\n    reviewsListProps: INodeProps;\n    reviewCards: IReviewCardViewProps[];\n    userReview?: IReviewCardViewProps;\n    pageControls: React.ReactNode;\n    noReviewsMessage: React.ReactElement;\n    noReviewsWithFilterMessage: React.ReactElement;\n    heading: React.ReactNode;\n    sortByOptions: IRnrOrderByKeyValuePair[];\n    filterByOptions: IRnrOrderByKeyValuePair[];\n}\n\n/**\n *\n * ReviewsList component\n * @extends {React.Component<IReviewsListProps<IReviewsListData>, IReviewsListState>}\n */\n@observer\nclass ReviewsList extends React.Component<IReviewsListProps<IReviewsListData>, IReviewsListState> {\n    public sortByDropdownOptions: IRnrOrderByKeyValuePair[] = [\n        { key: 'MostHelpful', value: this.props.resources.mostHelpfulSortOptionText },\n        { key: 'MostRecent', value: this.props.resources.mostRecentSortOptionText },\n        { key: 'HighestRating', value: this.props.resources.highestRatedSortOptionText },\n        { key: 'LowestRating', value: this.props.resources.lowestRatedSortOptionText }\n    ];\n\n    public filterByDropdownOptions: IRnrKeyValuePair[] = [\n        { key: '1;2;3;4;5', value: this.props.resources.allRatinsFilterByOptionText },\n        { key: '5', value: this.props.resources.fiveStarFilterByOptionText },\n        { key: '4', value: this.props.resources.fourStarFilterByOptionText },\n        { key: '3', value: this.props.resources.threeStarFilterByOptionText },\n        { key: '2', value: this.props.resources.twoStarFilterByOptionText },\n        { key: '1', value: this.props.resources.oneStarFilterByOptionText }\n    ];\n\n    private _userReviewModalToggle: React.RefObject<HTMLButtonElement>;\n    private _userReportModalToggle: React.RefObject<HTMLButtonElement>;\n    private telemetryContent?: ITelemetryContent;\n\n    constructor(props: IReviewsListProps<IReviewsListData>) {\n        super(props);\n        const {userReview: {result: userReview}} = this.props.data;\n\n        this.state = {\n            skipItems: 0,\n            reviewsCount: 0,\n            listOfReviews: [],\n            currentPage: 1,\n            showSpinner: false,\n            isFilterApplied: false,\n            selectedSortByOption: this.sortByDropdownOptions[0],\n            selectedFilterByOption: this.filterByDropdownOptions[0],\n            userReviewRating: userReview ? userReview.rating : 0,\n            userReviewText: userReview ? userReview.reviewText : '',\n            userReviewTitle: userReview ? userReview.title : '',\n            isReviewModalOpen: false,\n            hasReviewError: false,\n            isReportModalOpen: false,\n            hasReportError: false,\n            reported: false,\n            reportedKey: ReviewConcernCategory.SpamAdvertising,\n            reportingReviewId: '',\n            reportedReviews: [],\n            votedReviews: []\n        };\n\n        this._userReviewModalToggle = React.createRef<HTMLButtonElement>();\n        this._userReportModalToggle = React.createRef<HTMLButtonElement>();\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public componentDidMount(): void {\n        this.props.data.reviewsList.then((reviewsList) => {\n            if (\n                reviewsList &&\n                reviewsList.pagingInfo &&\n                reviewsList.pagingInfo.totalItems &&\n                reviewsList.items &&\n                reviewsList.items.length > 0\n            ) {\n                this.setState({\n                    listOfReviews: reviewsList.items,\n                    reviewsCount: reviewsList.pagingInfo.totalItems,\n                });\n            }\n        });\n\n        reaction(\n            () => this.props.data.ratingsReviewsState.result && this.props.data.ratingsReviewsState.result.filterKey,\n            async (filterKey: string | undefined) => {\n                const filterKeyValue = Number(filterKey);\n                const dropdownItemsCount = this.filterByDropdownOptions.length;\n                if (\n                    !!filterKey &&\n                    !isNaN(filterKeyValue) &&\n                    filterKeyValue < dropdownItemsCount\n                ) {\n                    const filterByOption = this.filterByDropdownOptions.find((option: IRnrKeyValuePair) => option.key === filterKey);\n                    if (!filterByOption) {\n                        this.props.telemetry.warning(`[reviews-list] cannot find filter with key ${filterKey}`);\n                    } else {\n                        await this.updateReviews(0, this.state.selectedSortByOption, filterByOption, 1, true);\n                        const selectedIndex = dropdownItemsCount - filterKeyValue;\n                        this.setState({\n                            selectedFilterByOption: this.filterByDropdownOptions[selectedIndex]\n                        });\n                    }\n                }\n            }\n        );\n    }\n\n    public render(): JSX.Element | null {\n        const {className, heading, reviewsShownOnEachPage} = this.props.config;\n        const {currentPage, reviewsCount, selectedFilterByOption, selectedSortByOption } = this.state;\n        const { ratingsSummary: { result: ratingsSummary } } = this.props.data;\n        const resources = this.props.resources;\n        const completeClass = classname('ms-reviews-list', className);\n        const viewProps: IReviewsListViewProps = {\n            ...this.props,\n            state: this.state,\n            className: completeClass,\n            moduleProps: {\n                moduleProps: this.props,\n                className: completeClass\n            },\n            callbacks: this.reviewsListCallbacks,\n            reviewModal: this._userReviewModal(),\n            reportReviewModal: this._reportReviewModal(),\n            filterByDropdown: (\n                                <LabeledDropdown\n                                    labelText={resources.filterByDropdownText}\n                                    dropdownId='reviewsListFilterBy'\n                                    dropdownOptions={this.filterByDropdownOptions}\n                                    selectedOption={selectedFilterByOption}\n                                    onSelectOption={this.updateFilterByDropdown}\n                                    controlledByParent={true}\n                                />\n            ),\n            sortByDropdown: <LabeledDropdown labelText={resources.sortByDropdownText} dropdownId='reviewsListSortBy' dropdownOptions={this.sortByDropdownOptions} selectedOption={selectedSortByOption} onSelectOption={this.updateSortByDropdown}/>,\n            averageRating: ratingsSummary && (\n                <RatingComponent\n                    avgRating={ratingsSummary.averageRating || 0}\n                    readOnly={true}\n                    ariaLabel={format(resources.averageRatingAriaLabel, ratingsSummary.averageRating, '5')}\n                    ratingCount={`${ratingsSummary.reviewsCount}`}\n                    data={{}}\n                    context={this.props.context}\n                    id={this.props.id}\n                    typeName={this.props.typeName}\n                />\n            ),\n            reviewCount: <ReviewCount resources={{...this.props.resources}} currentPage={currentPage} reviewsCount={reviewsCount} reviewsShownOnEachPage={reviewsShownOnEachPage}/>,\n            refineReviewsProps: {className: 'ms-reviews-list__refiners'},\n            reviewsListProps: {className: 'ms-reviews-list__reviews'},\n            reviewCards: this._reviewCards(this.state.listOfReviews),\n            userReview: this._userReview(),\n            pageControls: (\n                        <PageControls\n                            resources={{...this.props.resources}}\n                            currentPage={currentPage}\n                            reviewsShownOnEachPage={reviewsShownOnEachPage}\n                            selectedSortByOption={selectedSortByOption}\n                            selectedFilterByOption={selectedFilterByOption}\n                            updateReviews={this.updateReviews}\n                            reviewsCount={reviewsCount}\n                            telemetryContent={this.telemetryContent}\n                        />),\n            noReviewsMessage: <span className='ms-reviews-list__empty-message' aria-live='polite'>{resources.noReviewsMessage}</span>,\n            noReviewsWithFilterMessage: <span className='ms-reviews-list__filter-message' aria-live='polite'>{resources.noReviewsWithSelectedFilterMessage}</span>,\n            heading: heading && (\n                <Msdyn365.Text\n                    className='ms-reviews-list__heading'\n                    tag={heading.tag || 'h2'}\n                    text={heading.text}\n                    editProps={{onEdit:this.handleHeadingChange, requestContext: this.props.context.request}}\n                />\n            ),\n            sortByOptions: this.sortByDropdownOptions,\n            filterByOptions: this.filterByDropdownOptions\n        } as IReviewsListViewProps;\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n\n    private _userReview = () => {\n        const userReview = this.props.data.userReview.result;\n\n        return userReview && this._reviewCard(userReview, true);\n    }\n\n    private _reviewCards = (reviewList: Review[]) => {\n        const userReview = this.props.data.userReview.result;\n        const reviewElements: IReviewCardViewProps[] = [];\n\n        for (const review of reviewList) {\n            if (!review.isTakenDown && review.isPublished && userReview ? review.reviewId !== userReview.reviewId : true) {\n                reviewElements.push(this._reviewCard(review, false));\n            }\n        }\n        return reviewElements;\n    };\n\n    private _reviewCard = (review: Review, userReview: boolean): IReviewCardViewProps => {\n        return ReviewCard({\n            review: review,\n            resources: {...this.props.resources},\n            context:  this.props.context,\n            isUserReview: userReview,\n            parentId: this.props.id,\n            parentType: this.props.typeName,\n            reportedReviews: this.state.reportedReviews,\n            returnRef: this._userReportModalToggle,\n            reportedReviewId: this.state.reportingReviewId,\n            toggleWriteReviewModal: this._toggleReviewModal,\n            toggleReportReviewModal: this._onReportModalOpen,\n            updateReviewHelpfulness: this.updateReviewHelpfulnessVote,\n            votedReviews: this.state.votedReviews\n        });\n    }\n\n    private _userReviewModal = (): IReviewModalViewProps => {\n        return ReviewModal({\n            userReview: this.props.data.userReview.result,\n            product: this.props.data.product.result,\n            resources: {...this.props.resources},\n            context: this.props.context,\n            parentId: this.props.id,\n            parentType: this.props.typeName,\n            isOpen: this.state.isReviewModalOpen,\n            rating: this.state.userReviewRating,\n            reviewTitle: this.state.userReviewTitle,\n            reviewText: this.state.userReviewText,\n            onModalToggle: this._toggleReviewModal,\n            onTitleChange: this._onTitleChange,\n            onTextChange: this._onTextChange,\n            onRatingChange: this._onRatingChange,\n            onReviewComplete: this._onReviewComplete,\n            renderContextId: 'writeReview-list',\n            returnRef: this._userReviewModalToggle,\n            hasError: this.state.hasReviewError\n        });\n    }\n\n    private _onTitleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n        this.reviewsListCallbacks.updateReviewTitle(event.target.value);\n    }\n\n    private _onTextChange = (event: React.ChangeEvent<HTMLTextAreaElement>): void => {\n        this.reviewsListCallbacks.updateReviewText(event.target.value);\n    }\n\n    private _onRatingChange = (value: number): void => {\n        this.reviewsListCallbacks.updateRating(value);\n    }\n\n    private _toggleReviewModal = (): void => {\n        const userReview = this.props.data.userReview.result;\n        if (this.state.isReviewModalOpen) {\n            this.setState({isReviewModalOpen: false, hasReviewError: false});\n\n        } else {\n            this.setState({\n                isReviewModalOpen: true,\n                userReviewText: userReview!.reviewText,\n                userReviewTitle: userReview!.title,\n                userReviewRating: userReview!.rating\n            });\n        }\n    }\n\n    private _onReviewComplete = (isSuccess: boolean): void => {\n        if (isSuccess) {\n            this.setState({isReviewModalOpen: false, hasReviewError: false});\n        } else {\n            this.setState({hasReviewError: true});\n        }\n    }\n\n    private _reportReviewModal = () => {\n        return ReportReviewModal({\n            resources: {...this.props.resources},\n            context:  this.props.context,\n            isOpen: this.state.isReportModalOpen,\n            returnRef: this._userReportModalToggle,\n            reportedKey: this.state.reportedKey,\n            onModalToggle: this._onReportModalClose,\n            onRadioChange: this._onRadioChange,\n            reportReview: this._reportReview,\n            hasError: this.state.hasReportError,\n            telemetryContent: this.telemetryContent\n        });\n    }\n\n    private _onReportModalOpen = (reviewId: string) => {\n        this.setState({isReportModalOpen: true, reportingReviewId: reviewId, reported: false, reportedKey: ReviewConcernCategory.SpamAdvertising});\n    }\n\n    private _onReportModalClose = () => {\n        this.setState({isReportModalOpen: false, hasReportError: false});\n    }\n\n    private _onRadioChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        this.setState({reportedKey: event.currentTarget.getAttribute('data-key') || ''});\n    }\n\n    private _reportReviewCallback = (reviewId: string, reportedKey: string) => {\n        reportReviewConcern(\n            new ReportReviewConcernInput(\n                reviewId,\n                getRnrPartnerId(this.props.context.actionContext),\n                this.props.context.request.locale,\n                reportedKey,\n                this.getUserToken(this.props.context.request),\n                getRnrAuthEndpointId(this.props.context.actionContext)\n            ),\n            this.props.context.actionContext\n        ).then(_value => {\n            const reportedReview = this.state.reportedReviews;\n            reportedReview.push(reviewId);\n            this.setState({reported: true, reportedReviews: reportedReview, hasReportError: false});\n        }).catch(_value => {\n            this.setState({hasReportError: true});\n        });\n    }\n\n    private _reportReview = () => {\n        this._reportReviewCallback(this.state.reportingReviewId, this.state.reportedKey);\n    }\n\n    private updateSortByDropdown = async (notification: ILabeledDropdownOnChangeNotification) => {\n        await this.updateReviews(0, notification.selectedOption, this.state.selectedFilterByOption, 1, this.state.isFilterApplied);\n    };\n\n    private updateFilterByDropdown = async (notification: ILabeledDropdownOnChangeNotification) => {\n        await this.updateReviews(0, this.state.selectedSortByOption, notification.selectedOption, 1, true);\n    };\n\n    private updateReviews = async (\n        skipItems: number | 0,\n        selectedSortByOption: ILabeledDropdownOption,\n        selectedFilterByOption: ILabeledDropdownOption,\n        currentPage: number,\n        isFilterApplied: boolean\n    ) => {\n        // @ts-ignore\n        const productId = getSelectedProductIdFromActionInput(this.props.context.actionContext);\n        if (productId === undefined) {\n            return;\n        }\n        const result = await getReviewsForGivenProduct(\n            // Task #211227597 Remove this hardcoded values.\n            new GetProductReviewsInput(\n                productId,\n                getRnrPartnerId(this.props.context.actionContext),\n                this.props.context.request.locale,\n                getRnrEndpointId(this.props.context.actionContext),\n                selectedSortByOption.key,\n                selectedFilterByOption.key,\n                skipItems < 0 ? 0 : skipItems\n            ),\n            this.props.context.actionContext\n        );\n        if (result && result.items && result.pagingInfo && result.pagingInfo.totalItems !== undefined) {\n            this.setState({\n                currentPage: currentPage,\n                listOfReviews: result.items,\n                selectedSortByOption,\n                selectedFilterByOption,\n                reviewsCount: result.pagingInfo.totalItems,\n                isFilterApplied: isFilterApplied\n            });\n        }\n    };\n\n    private _updateVoteUi = (reviewId: string, isHelpful: boolean): void => {\n        let alreadyExists = false;\n        let list = this.state.votedReviews.map((review) => {\n            if(review.reviewId === reviewId) {\n                review.approved = isHelpful;\n                alreadyExists = true;\n            }\n            return review;\n        });\n\n        if (!alreadyExists) {\n            list = list.concat({reviewId: reviewId, approved: isHelpful});\n        }\n\n        this.setState({votedReviews: list});\n    }\n\n    private updateReviewHelpfulnessVote = (reviewId: string, isHelpful: boolean): void => {\n        submitHelpfulnessVote(\n            new SubmitHelpfulnessVoteInput(\n                reviewId,\n                getRnrPartnerId(this.props.context.actionContext),\n                this.props.context.request.locale,\n                isHelpful,\n                this.getUserToken(this.props.context.request),\n                getRnrAuthEndpointId(this.props.context.actionContext)\n            ),\n            this.props.context.actionContext\n        ).then(() => {\n            this._updateVoteUi(reviewId, isHelpful);\n        });\n    };\n\n    private getUserToken = (context: Msdyn365.IRequestContext): string => {\n        return context && context.user && context.user.token;\n    };\n\n    // tslint:disable-next-line\n    private reviewsListCallbacks: IReviewsListCallbacks = {\n        updateReviewTitle: (title: string): void => {\n            this.setState({userReviewTitle: title});\n        },\n        updateReviewText: (text: string): void => {\n            this.setState({userReviewText: text});\n        },\n        updateRating: (rating: number): void => {\n            this.setState({userReviewRating: rating});\n        },\n        onReviewSubmitted: (isSuccessful: boolean): void => {\n            if (isSuccessful) {\n                this.setState({isReviewModalOpen: false, hasReviewError: false});\n            } else {\n                this.setState({hasReviewError: true});\n            }\n        },\n        submitReview: submitReview,\n        toggleModal: this._toggleReviewModal,\n        updateReviewHelpfulnessVote: this.updateReviewHelpfulnessVote,\n        toggleReportModal: (reviewId: string): void => {\n            this.state.isReportModalOpen? this._onReportModalOpen(reviewId) : this._onReportModalClose();\n        },\n        reportReview: this._reportReviewCallback,\n        updateFilterByDropdown: this.updateFilterByDropdown,\n        updateSortByDropdown: this.updateSortByDropdown,\n        updateReviews: this.updateReviews\n    };\n}\n\nexport default ReviewsList;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}