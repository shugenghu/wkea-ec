{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import classnames from'classnames';import React,{useState}from'react';import{getPayloadObject,getTelemetryAttributes,Popup}from'@msdyn365-commerce-modules/utilities';import MsDyn365,{msdyn365Commerce,TelemetryEvent}from'@msdyn365-commerce/core';import{getCartState}from'@msdyn365-commerce/global-state';import{PriceComponent}from'../index';var onClick=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_event,props,setDisabled,openModal){var _props$productAvailab;var cartError,productToAdd,cartState;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:cartError=addToCartError(props);productToAdd=props.data.product;if(!cartError){_context.next=5;break;}propogateError(props,cartError);return _context.abrupt(\"return\");case 5:setDisabled(true);if(props.getSelectedProduct===undefined){_context.next=13;break;}_context.next=9;return props.getSelectedProduct;case 9:_context.t0=_context.sent;if(_context.t0){_context.next=12;break;}_context.t0=props.data.product;case 12:productToAdd=_context.t0;case 13:_context.next=15;return getCartState(props.context.actionContext);case 15:cartState=_context.sent;_context.next=18;return cartState.addProductToCart({product:productToAdd,count:props.quantity,availableQuantity:(_props$productAvailab=props.productAvailability)===null||_props$productAvailab===void 0?void 0:_props$productAvailab.AvailableQuantity,enableStockCheck:props.context.app.config.enableStockCheck}).then(function(result){if(result.status==='SUCCESS'){if(props.dialogStrings&&props.context.app.config.addToCartBehavior==='showModal'){setDisabled(false);openModal(true);}else if(MsDyn365.isBrowser&&props.navigationUrl&&(props.context.app.config.addToCartBehavior===undefined||props.context.app.config.addToCartBehavior==='goToCart')){window.location.assign(props.navigationUrl);}propogateResult(props,result);}else{propogateError(props,{failureReason:'CARTACTIONFAILED',cartActionResult:result});setDisabled(false);}});case 18:case\"end\":return _context.stop();}}},_callee);}));return function onClick(_x,_x2,_x3,_x4){return _ref.apply(this,arguments);};}();var AddToCartComponentActions={onClick:onClick};var AddToCart=function AddToCart(props){var _props$dialogStrings,_props$dialogStrings2,_props$dialogStrings3;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),disabled=_useState2[0],setDisabled=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),modalOpen=_useState4[0],setModalOpen=_useState4[1];var onClickHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return AddToCartComponentActions.onClick(event,props,setDisabled,setModalOpen);case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function onClickHandler(_x5){return _ref2.apply(this,arguments);};}();var priceComponent=props.data.price?/*#__PURE__*/React.createElement(PriceComponent,{data:{price:props.data.price},context:props.context,id:props.id,typeName:props.typeName,freePriceText:(_props$dialogStrings=props.dialogStrings)===null||_props$dialogStrings===void 0?void 0:_props$dialogStrings.freePriceText,originalPriceText:(_props$dialogStrings2=props.dialogStrings)===null||_props$dialogStrings2===void 0?void 0:_props$dialogStrings2.originalPriceText,currentPriceText:(_props$dialogStrings3=props.dialogStrings)===null||_props$dialogStrings3===void 0?void 0:_props$dialogStrings3.currentPriceText}):'';var popupProps={context:props.context,className:'msc-add-to-cart',id:props.id,typeName:props.typeName,data:{product:props.data.product,price:props.data.price},dialogStrings:props.dialogStrings,imageSettings:props.imageSettings,gridSettings:props.context.request.gridSettings,productQuantity:props.quantity!==undefined?props.quantity:1,priceComponent:priceComponent,navigationUrl:props.navigationUrl,modalOpen:modalOpen,setModalOpen:setModalOpen,telemetryContent:props.telemetryContent};var renderModalPopup=/*#__PURE__*/React.createElement(Popup,Object.assign({},popupProps));var label=getLinkText(props);var payload=getPayloadObject(TelemetryEvent.AddToCart,props.telemetryContent,label,'');var attributes=getTelemetryAttributes(props.telemetryContent,payload);return/*#__PURE__*/React.createElement(React.Fragment,null,renderModalPopup,/*#__PURE__*/React.createElement(\"button\",Object.assign({className:classnames('msc-add-to-cart ',props.className),\"aria-label\":getLinkText(props)},attributes,{onClick:onClickHandler,disabled:props.disabled||disabled||isIntermediateState(props)||shouldShowOutOfStock(props,false)}),getLinkText(props)));};AddToCart.defaultProps={quantity:1};var getLinkText=function getLinkText(props){return shouldShowOutOfStock(props,false)?props.outOfStockText:props.addToCartText;};var addToCartError=function addToCartError(props){if(!props.data||!props.data.product.RecordId){return{failureReason:'EMPTYINPUT'};}if(props.data.product.Dimensions){var missingDimensions=props.data.product.Dimensions.filter(function(dimension){return!(dimension.DimensionValue&&dimension.DimensionValue.Value);});if(missingDimensions.length>0){return{failureReason:'MISSINGDIMENSION',missingDimensions:missingDimensions};}}if(shouldShowOutOfStock(props,true)){var availableQuantity=props.productAvailability&&props.productAvailability.AvailableQuantity||0;var stockLeft=Math.max(availableQuantity,0);return{failureReason:'OUTOFSTOCK',stockLeft:stockLeft};}return undefined;};var shouldShowOutOfStock=function shouldShowOutOfStock(props,includeCurrentQuantity){if(props.context.app.config.enableStockCheck===undefined||props.context.app.config.enableStockCheck===false||props.isLoading||props.isUpdatingDimension||props.isAddServiceItemToCart){return false;}if(!props.data||!props.data.product.RecordId){return false;}if(props.data.product.Dimensions){if(props.data.product.Dimensions.find(function(dimension){return!(dimension.DimensionValue&&dimension.DimensionValue.Value);})){return false;}}var includedQuantityNumber=includeCurrentQuantity&&props.quantity?props.quantity:1;return props.productAvailability&&props.productAvailability.AvailableQuantity!==undefined&&props.productAvailability.AvailableQuantity>=includedQuantityNumber?false:true;};var isIntermediateState=function isIntermediateState(props){if(props.data.product.Dimensions){if(props.data.product.Dimensions.find(function(dimension){return!(dimension.DimensionValue&&dimension.DimensionValue.Value);})){return false;}}if(!props.isLoading&&!props.isUpdatingDimension){return false;}return true;};var propogateResult=function propogateResult(props,result){if(props.onAdd){props.onAdd(result);}};var propogateError=function propogateError(props,result){if(props.onError){props.onError(result);}};export var AddToCartComponent=msdyn365Commerce.createComponent('AddToCart',_objectSpread({component:AddToCart},AddToCartComponentActions));","map":{"version":3,"sources":["add-to-cart/add-to-cart.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import classnames from 'classnames';\nimport React, { useState } from 'react';\n\nimport { getPayloadObject, getTelemetryAttributes, IPopupProps, ITelemetryContent, Popup } from '@msdyn365-commerce-modules/utilities';\nimport MsDyn365, { IComponent, IComponentProps, IGridSettings, IImageSettings, msdyn365Commerce, TelemetryEvent } from '@msdyn365-commerce/core';\nimport { getCartState, ICartActionResult } from '@msdyn365-commerce/global-state';\nimport {\n    ProductAvailableQuantity, ProductDimension, ProductPrice, SimpleProduct\n} from '@msdyn365-commerce/retail-proxy';\nimport { PriceComponent } from '../index';\n\nexport interface IAddToCartComponentProps extends IComponentProps<{product: SimpleProduct; price?: ProductPrice}> {\n    className?: string;\n    addToCartText: string;\n    outOfStockText: string;\n    disabled?: boolean;\n    quantity?: number;\n    navigationUrl?: string;\n    productAvailability?: ProductAvailableQuantity;\n    getSelectedProduct?: Promise<SimpleProduct | null>;\n\n    imageSettings?: IImageSettings;\n    gridSettings?: IGridSettings;\n\n    isLoading?: boolean;\n    isUpdatingDimension?: boolean;\n    isAddServiceItemToCart?: boolean;\n\n    dialogStrings?: {\n        goToCartText: string;\n        continueShoppingText: string;\n        headerItemOneText: string;\n        headerItemFormatText: string;\n        headerMessageText: string;\n        freePriceText: string;\n        originalPriceText: string;\n        currentPriceText: string;\n    };\n    telemetryContent?: ITelemetryContent;\n\n    onAdd?(result: ICartActionResult): void;\n    onError?(result: IAddToCartFailureResult): void;\n    changeUpdatingDimension?(isUpdatingDimension: boolean): void;\n}\n\nexport declare type ICartActionFailureReason = 'EMPTYINPUT' | 'MISSINGDIMENSION' | 'OUTOFSTOCK' | 'CARTACTIONFAILED';\nexport interface IAddToCartFailureResult {\n    failureReason: ICartActionFailureReason;\n\n    stockLeft?: number;\n    cartActionResult?: ICartActionResult;\n    missingDimensions?: ProductDimension[];\n}\n\nexport interface IAddtoCartComponent extends IComponent<IAddToCartComponentProps> {\n    onClick(): (event: React.MouseEvent<HTMLElement>, props: IAddToCartComponentProps) => void;\n}\n\nconst onClick = async (_event: React.MouseEvent<HTMLElement>, props: IAddToCartComponentProps, setDisabled: (disabled: boolean) => void, openModal: (opened: boolean) => void): Promise<void> => {\n    const cartError = addToCartError(props);\n    let productToAdd = props.data.product;\n\n    if (cartError) {\n        propogateError(props, cartError);\n        return;\n    }\n\n    setDisabled(true);\n\n    if(!(props.getSelectedProduct === undefined)) {\n        productToAdd = (await props.getSelectedProduct) || props.data.product;\n    }\n\n    const cartState = await getCartState(props.context.actionContext);\n    await cartState.addProductToCart({ product: productToAdd, count: props.quantity, availableQuantity: props.productAvailability?.AvailableQuantity, enableStockCheck: props.context.app.config.enableStockCheck })\n        .then(result => {\n            if (result.status === 'SUCCESS') {\n                if (props.dialogStrings && props.context.app.config.addToCartBehavior === 'showModal') {\n                    setDisabled(false);\n                    openModal(true);\n                } else if (MsDyn365.isBrowser && props.navigationUrl && (props.context.app.config.addToCartBehavior === undefined || props.context.app.config.addToCartBehavior === 'goToCart')) {\n                    window.location.assign(props.navigationUrl);\n                }\n                propogateResult(props, result);\n            } else {\n                propogateError(props, { failureReason: 'CARTACTIONFAILED', cartActionResult: result });\n                setDisabled(false);\n            }\n        });\n};\n\nconst AddToCartComponentActions = {\n    onClick: onClick\n};\n\nconst AddToCart: React.FC<IAddToCartComponentProps> = (props: IAddToCartComponentProps) => {\n    const [disabled, setDisabled] = useState(false);\n    const [modalOpen, setModalOpen] = useState(false);\n\n    const onClickHandler = async (event: React.MouseEvent<HTMLElement>) => {\n        await AddToCartComponentActions.onClick(event, props, setDisabled, setModalOpen);\n    };\n\n    const priceComponent = props.data.price ? (\n        <PriceComponent\n            data={{price: props.data.price}}\n            context={props.context}\n            id={props.id}\n            typeName={props.typeName}\n            freePriceText={props.dialogStrings?.freePriceText}\n            originalPriceText={props.dialogStrings?.originalPriceText}\n            currentPriceText={props.dialogStrings?.currentPriceText}\n        />) : '';\n\n    const popupProps: IPopupProps = {\n        context: props.context,\n        className: 'msc-add-to-cart',\n        id: props.id,\n        typeName: props.typeName,\n        data: {product: props.data.product, price: props.data.price},\n        dialogStrings: props.dialogStrings,\n        imageSettings: props.imageSettings,\n        gridSettings: props.context.request.gridSettings,\n        productQuantity: props.quantity !== undefined ? props.quantity : 1,\n        priceComponent: priceComponent,\n        navigationUrl: props.navigationUrl,\n        modalOpen: modalOpen,\n        setModalOpen: setModalOpen,\n        telemetryContent: props.telemetryContent\n    };\n\n    const renderModalPopup = <Popup {...popupProps} />;\n    const label = getLinkText(props);\n    const payload= getPayloadObject(TelemetryEvent.AddToCart, props.telemetryContent!, label, '');\n    const attributes = getTelemetryAttributes(props.telemetryContent!, payload);\n    return (\n        <>\n            {renderModalPopup}\n            <button\n                className={classnames('msc-add-to-cart ', props.className)}\n                aria-label={getLinkText(props)}\n                {...attributes}\n                onClick={onClickHandler}\n                disabled={props.disabled || disabled || isIntermediateState(props) || shouldShowOutOfStock(props, false)}\n            >\n                {getLinkText(props)}\n            </button>\n        </>\n    );\n};\n\n// Set default props\nAddToCart.defaultProps = {\n    quantity: 1\n};\n\nconst getLinkText = (props: IAddToCartComponentProps): string => {\n    return shouldShowOutOfStock(props, false) ? props.outOfStockText : props.addToCartText;\n};\n\nconst addToCartError = (props: IAddToCartComponentProps): IAddToCartFailureResult | undefined => {\n    if (!props.data || !props.data.product.RecordId) {\n        // No product exists, won't be able to add to cart\n        return { failureReason: 'EMPTYINPUT' };\n    }\n\n    if (props.data.product.Dimensions) {\n        const missingDimensions = props.data.product.Dimensions.filter(dimension => !(dimension.DimensionValue && dimension.DimensionValue.Value));\n\n        if (missingDimensions.length > 0) {\n            // At least one dimension with no value exists on the product, won't be able to add to cart\n            return { failureReason: 'MISSINGDIMENSION', missingDimensions: missingDimensions };\n        }\n    }\n\n    if (shouldShowOutOfStock(props, true)) {\n        const availableQuantity = (props.productAvailability && props.productAvailability.AvailableQuantity) || 0;\n        const stockLeft = Math.max(availableQuantity, 0);\n\n        return { failureReason: 'OUTOFSTOCK', stockLeft: stockLeft };\n    }\n\n    // Only allow adding to cart if not showing out of stock\n    return undefined;\n};\n\nconst shouldShowOutOfStock = (props: IAddToCartComponentProps, includeCurrentQuantity: boolean): boolean => {\n    if (props.context.app.config.enableStockCheck === undefined || props.context.app.config.enableStockCheck === false\n        || props.isLoading || props.isUpdatingDimension || props.isAddServiceItemToCart) {\n        // Out of stock turn off, don't bother showing out of stock\n        return false;\n    }\n\n    if (!props.data || !props.data.product.RecordId) {\n        // No product exists, don't bother showing out of stock\n        return false;\n    }\n\n    if (props.data.product.Dimensions) {\n        if (props.data.product.Dimensions.find(dimension => !(dimension.DimensionValue && dimension.DimensionValue.Value))) {\n            // At least one dimension with no value exists on the product, so also don't show out of stock\n            return false;\n        }\n    }\n    const includedQuantityNumber = includeCurrentQuantity && props.quantity? props.quantity : 1;\n\n    return (props.productAvailability\n        && props.productAvailability.AvailableQuantity !== undefined\n        && props.productAvailability.AvailableQuantity >= includedQuantityNumber)\n        ? false : true;\n};\n\nconst isIntermediateState = (props: IAddToCartComponentProps): boolean => {\n    if (props.data.product.Dimensions) {\n        if (props.data.product.Dimensions.find(dimension => !(dimension.DimensionValue && dimension.DimensionValue.Value))) {\n            // At least one dimension with no value exists on the product, so also not in intermediate state\n            return false;\n        }\n    }\n\n    if (!props.isLoading && !props.isUpdatingDimension) {\n        return false;\n    }\n\n    return true;\n};\n\nconst propogateResult = (props: IAddToCartComponentProps, result: ICartActionResult): void => {\n    if (props.onAdd) {\n        props.onAdd(result);\n    }\n};\n\nconst propogateError = (props: IAddToCartComponentProps, result: IAddToCartFailureResult): void => {\n    if (props.onError) {\n        props.onError(result);\n    }\n};\n\n// @ts-ignore\nexport const AddToCartComponent: React.FunctionComponent<IAddToCartComponentProps> = msdyn365Commerce.createComponent<IAddtoCartComponent>(\n    'AddToCart',\n    { component: AddToCart, ...AddToCartComponentActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}