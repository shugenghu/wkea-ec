{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{createObservableDataAction}from'@msdyn365-commerce/core';import{createReadAsync,updateAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CustomersDataActions.g';import getCustomer,{GetCustomerInput}from'./get-customer';/**\r\n* The input class for the addAddress data action\r\n*/export class AddressManagementInput{constructor(address,userAccountNumber){this.getCacheKey=()=>'AddAddress';this.getCacheObjectType=()=>'AddAddress';this.dataCacheType=()=>'none';this.userAccountNumber=userAccountNumber;this.address=address;}}/**\r\n* The createInput method for the addAddress data action\r\n* @param inputData The input data passed to the createInput method\r\n*/export const createAddressManagementInput=inputData=>{if(inputData.requestContext.user.isAuthenticated){throw new Error('User is not authenticated. Cannot call UpdateAddress API');}const{address}=inputData.data||{address:undefined};if(!address){throw new Error('address is not provided. Cannot call UpdateAddress API');}return new AddressManagementInput(address);};export async function doAddressManagementOperation(input,ctx,operationHandler){const{userAccountNumber,address}=input;const customerInput=new GetCustomerInput(ctx.requestContext.apiSettings,userAccountNumber);const customer=await getCustomer(customerInput,ctx);if(!customer){throw new Error('Not able to create customer');}const newCustomer=operationHandler(_objectSpread({},customer),address);const updatedCustomer=await updateAsync({callerContext:ctx},newCustomer);if(!updatedCustomer){throw new Error('Not able to update customer');}ctx.update(createReadAsync(updatedCustomer.AccountNumber),updatedCustomer);return updatedCustomer.Addresses||[];}export function addAddressHandler(customer,address){customer.Addresses=[...(customer.Addresses||[])];customer.Addresses.push(address);return customer;}export async function addAddressAction(input,ctx){return doAddressManagementOperation(input,ctx,addAddressHandler);}/**\r\n* The addAddress data action\r\n* Calls the read RetailServer API to get information about a customer\r\n* Adds the passed address information to the retireved customer, and\r\n* then updates that customer via the update RetailServer API.\r\n*/export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/add-address',action:addAddressAction,input:createAddressManagementInput,isBatched:false});","map":{"version":3,"sources":["../../src/add-address.ts"],"names":[],"mappings":"i8BAAA,OACe,0BADf,KAGO,yBAHP,CAKA,OACI,eADJ,CACqB,WADrB,KAEO,yEAFP,CAGA,MAAO,CAAA,WAAP,EAAsB,gBAAtB,KAA8C,gBAA9C,CASA;;AAEE,EACF,MAAM,MAAO,CAAA,sBAAsB,CAI/B,WAAA,CAAY,OAAZ,CAA8B,iBAA9B,CAAwD,CAKjD,KAAA,WAAA,CAAc,IAAM,YAApB,CACA,KAAA,kBAAA,CAAqB,IAAM,YAA3B,CACA,KAAA,aAAA,CAAgB,IAAiB,MAAjC,CANH,KAAK,iBAAL,CAAyB,iBAAzB,CACA,KAAK,OAAL,CAAe,OAAf,CACH,CAP8B,CAcnC;;;AAGE,EACF,MAAO,MAAM,CAAA,4BAA4B,CACrC,SADwC,EAEf,CACrB,GAAI,SAAS,CAAC,cAAV,CAAyB,IAAzB,CAA8B,eAAlC,CAAmD,CACnD,KAAM,IAAI,CAAA,KAAJ,CAAU,0DAAV,CAAN,CACH,CAED,KAAM,CAAE,OAAF,EAAc,SAAS,CAAC,IAAV,EAAkB,CAAE,OAAO,CAAE,SAAX,CAAtC,CAEA,GAAI,CAAC,OAAL,CAAc,CACV,KAAM,IAAI,CAAA,KAAJ,CAAU,wDAAV,CAAN,CACH,CAED,MAAO,IAAI,CAAA,sBAAJ,CAA2B,OAA3B,CAAP,CACH,CAdM,CAgBP,MAAO,eAAe,CAAA,4BAAf,CACH,KADG,CAEH,GAFG,CAGH,gBAHG,CAGiE,CAEpE,KAAM,CAAE,iBAAF,CAAqB,OAArB,EAAiC,KAAvC,CACA,KAAM,CAAA,aAAa,CAAG,GAAI,CAAA,gBAAJ,CAAqB,GAAG,CAAC,cAAJ,CAAmB,WAAxC,CAAqD,iBAArD,CAAtB,CACA,KAAM,CAAA,QAAQ,CAAG,KAAM,CAAA,WAAW,CAAC,aAAD,CAAgB,GAAhB,CAAlC,CAEA,GAAI,CAAC,QAAL,CAAe,CACX,KAAM,IAAI,CAAA,KAAJ,CAAU,6BAAV,CAAN,CACH,CAED,KAAM,CAAA,WAAW,CAAG,gBAAgB,kBAAM,QAAN,EAAkB,OAAlB,CAApC,CACA,KAAM,CAAA,eAAe,CAAG,KAAM,CAAA,WAAW,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,WAAzB,CAAzC,CAEA,GAAI,CAAC,eAAL,CAAsB,CAClB,KAAM,IAAI,CAAA,KAAJ,CAAU,6BAAV,CAAN,CACH,CAED,GAAG,CAAC,MAAJ,CAAW,eAAe,CAAC,eAAe,CAAC,aAAjB,CAA1B,CAA2D,eAA3D,EAEA,MAAO,CAAA,eAAe,CAAC,SAAhB,EAA6B,EAApC,CACH,CAED,MAAM,SAAU,CAAA,iBAAV,CAA4B,QAA5B,CAAgD,OAAhD,CAAgE,CAClE,QAAQ,CAAC,SAAT,CAAqB,CAAC,IAAI,QAAQ,CAAC,SAAT,EAAsB,EAA1B,CAAD,CAArB,CACA,QAAQ,CAAC,SAAT,CAAmB,IAAnB,CAAwB,OAAxB,EACA,MAAO,CAAA,QAAP,CACH,CAED,MAAO,eAAe,CAAA,gBAAf,CAAgC,KAAhC,CAAgE,GAAhE,CAAmF,CACtF,MAAO,CAAA,4BAA4B,CAAC,KAAD,CAAQ,GAAR,CAAa,iBAAb,CAAnC,CACH,CAED;;;;;AAKE,EACF,cAAe,CAAA,0BAA0B,CAAY,CACjD,EAAE,CAAE,uDAD6C,CAEjD,MAAM,CAAsB,gBAFqB,CAGjD,KAAK,CAAuD,4BAHX,CAIjD,SAAS,CAAE,KAJsC,CAAZ,CAAzC","sourcesContent":["import {\n    CacheType, createObservableDataAction, IAction, IActionContext, IActionInput, IAny,\n    ICreateActionContext, IGeneric\n} from '@msdyn365-commerce/core';\nimport { Address, Customer } from '@msdyn365-commerce/retail-proxy';\nimport {\n    createReadAsync, updateAsync\n} from '@msdyn365-commerce/retail-proxy/dist/DataActions/CustomersDataActions.g';\nimport getCustomer, { GetCustomerInput } from './get-customer';\n\nexport interface IAddressManagementData {\n    address: Address;\n}\nexport interface IAddressManagementInput extends IActionInput {\n    address: Address;\n    userAccountNumber?: string;\n}\n/**\n* The input class for the addAddress data action\n*/\nexport class AddressManagementInput implements IAddressManagementInput {\n    public address: Address;\n    public userAccountNumber?: string;\n\n    constructor(address: Address, userAccountNumber?: string) {\n        this.userAccountNumber = userAccountNumber;\n        this.address = address;\n    }\n\n    public getCacheKey = () => 'AddAddress';\n    public getCacheObjectType = () => 'AddAddress';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n* The createInput method for the addAddress data action\n* @param inputData The input data passed to the createInput method\n*/\nexport const createAddressManagementInput = (\n    inputData: ICreateActionContext<IGeneric<IAny>, IAddressManagementData>\n): IAddressManagementInput => {\n        if (inputData.requestContext.user.isAuthenticated) {\n        throw new Error('User is not authenticated. Cannot call UpdateAddress API');\n    }\n\n    const { address } = inputData.data || { address: undefined };\n\n    if (!address) {\n        throw new Error('address is not provided. Cannot call UpdateAddress API');\n    }\n\n    return new AddressManagementInput(address);\n};\n\nexport async function doAddressManagementOperation(\n    input: IAddressManagementInput,\n    ctx: IActionContext,\n    operationHandler: (customer: Customer, address: Address) => Customer\n): Promise<Address[]> {\n    const { userAccountNumber, address } = input;\n    const customerInput = new GetCustomerInput(ctx.requestContext.apiSettings, userAccountNumber);\n    const customer = await getCustomer(customerInput, ctx);\n\n    if (!customer) {\n        throw new Error('Not able to create customer');\n    }\n\n    const newCustomer = operationHandler({ ...customer }, address);\n    const updatedCustomer = await updateAsync({ callerContext: ctx }, newCustomer);\n\n    if (!updatedCustomer) {\n        throw new Error('Not able to update customer');\n    }\n\n    ctx.update(createReadAsync(updatedCustomer.AccountNumber), updatedCustomer);\n\n    return updatedCustomer.Addresses || [];\n}\n\nexport function addAddressHandler(customer: Customer, address: Address): Customer {\n    customer.Addresses = [...(customer.Addresses || [])];\n    customer.Addresses.push(address);\n    return customer;\n}\n\nexport async function addAddressAction(input: IAddressManagementInput, ctx: IActionContext): Promise<Address[]> {\n    return doAddressManagementOperation(input, ctx, addAddressHandler);\n}\n\n/**\n* The addAddress data action\n* Calls the read RetailServer API to get information about a customer\n* Adds the passed address information to the retireved customer, and\n* then updates that customer via the update RetailServer API.\n*/\nexport default createObservableDataAction<Address[]>({\n    id: '@msdyn365-commerce-modules/retail-actions/add-address',\n    action: <IAction<Address[]>>addAddressAction,\n    input: <(args: ICreateActionContext) => IActionInput>(<IAny>createAddressManagementInput),\n    isBatched: false\n});"],"sourceRoot":""},"metadata":{},"sourceType":"module"}