{"ast":null,"code":"import\"core-js/modules/es.array.reduce.js\";import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{FullProductInput,getFullProducts,getProductDetailsCriteriaFromActionInput}from'@msdyn365-commerce-modules/retail-actions';import{Button}from'@msdyn365-commerce-modules/utilities';import{msdyn365Commerce}from'@msdyn365-commerce/core';import{addProductListLinesAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductListsDataActions.g';import React,{useState}from'react';import{AddToOrderTemplateDialog}from'../add-to-order-template-dialog/add-to-order-template-dialog.component';import{LinesAddedToOrderTemplateDialog}from'../lines-added-to-order-template-dialog/lines-added-to-order-template-dialog.component';const onDismiss=state=>{state.setContent({color:'success',showAlert:false});};const SaveCartToOrderTemplateActions={onDismiss:onDismiss};const SaveCartToOrderTemplate=props=>{var _props$data$customerI;if(!((_props$data$customerI=props.data.customerInformation)!==null&&_props$data$customerI!==void 0&&_props$data$customerI.IsB2b)){return null;}const[chosenOrderTemplate,setChosenOrderTemplate]=useState(undefined);const[addedProducts,setAddedProducts]=useState(undefined);const[addToOrderTemplateModalOpen,setAddToOrderTemplateModalOpen]=useState(false);const[linesAddedToOrderTemplateDialogOpen,setLinesAddedToOrderTemplateDialogOpen]=useState(false);const[addedLinesCount,setAddedLinesCount]=useState(0);const[addedItemsCount,setAddedItemsCount]=useState(0);const{addToOrderTemplateDialogResources,createOrderTemplateDialogResources,createOrderTemplateFromCartButton}=props;const onOrderTemplateSelected=async orderTemplate=>{setChosenOrderTemplate(orderTemplate);const productListLines=props.data.cartLines.map(cartLine=>{const productListLineToAdd={ProductListId:orderTemplate.Id,ProductId:cartLine.ProductId,Quantity:cartLine.Quantity,UnitOfMeasure:cartLine.UnitOfMeasureSymbol};return productListLineToAdd;});const addedLines=await addProductListLinesAsync({callerContext:props.context.actionContext},orderTemplate.Id,productListLines);const productInputs=[];addedLines.forEach(listLine=>{if(listLine.ProductId){productInputs.push(new FullProductInput(listLine.ProductId,props.context.actionContext.requestContext.apiSettings,getProductDetailsCriteriaFromActionInput(props.context.actionContext)));}});const products=await getFullProducts(productInputs,props.context.actionContext);setAddedLinesCount(addedLines.length);setAddedItemsCount(addedLines.map(line=>line.Quantity||1).reduce((firstQuantity,secondQuantity)=>firstQuantity+secondQuantity));setAddedProducts(products);setAddToOrderTemplateModalOpen(false);setTimeout(()=>{setLinesAddedToOrderTemplateDialogOpen(true);},500);};const onSaveCartToOrderTemplateClick=()=>{setAddToOrderTemplateModalOpen(true);};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(AddToOrderTemplateDialog,{className:'msc-add-to-order-template-dialog',modalOpen:addToOrderTemplateModalOpen,setModalOpen:setAddToOrderTemplateModalOpen,context:props.context,id:props.id,typeName:props.typeName,data:{orderTemplates:props.data.orderTemplates},addToOrderTemplateDialogResources:addToOrderTemplateDialogResources,createOrderTemplateDialogResources:createOrderTemplateDialogResources,onOrderTemplateSelected:onOrderTemplateSelected}),chosenOrderTemplate&&addedProducts&&/*#__PURE__*/React.createElement(LinesAddedToOrderTemplateDialog,{className:'msc-lines-added-to-order-template-dialog',id:props.id,typeName:props.typeName,context:props.context,dialogStrings:props.linesAddedToOrderTemplateDialogResources,data:{linesCount:addedLinesCount,itemsCount:addedItemsCount,orderTemplate:chosenOrderTemplate,products:addedProducts},modalOpen:linesAddedToOrderTemplateDialogOpen}),/*#__PURE__*/React.createElement(Button,{className:'msc-cart__btn-addcarttotemplate',onClick:onSaveCartToOrderTemplateClick,title:createOrderTemplateFromCartButton},createOrderTemplateFromCartButton));};export const SaveCartToOrderTemplateComponent=msdyn365Commerce.createComponent('SaveCartToOrderTemplate',_objectSpread({component:SaveCartToOrderTemplate},SaveCartToOrderTemplateActions));","map":{"version":3,"sources":["order-template/save-cart-to-order-template/save-cart-to-order-template.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import { FullProductInput, getFullProducts, getProductDetailsCriteriaFromActionInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { OrderTemplate } from '@msdyn365-commerce-modules/retail-actions';\nimport { Button } from '@msdyn365-commerce-modules/utilities';\nimport { FullProduct } from '@msdyn365-commerce/commerce-entities';\nimport { IComponent, IComponentProps, msdyn365Commerce } from '@msdyn365-commerce/core';\nimport { CartLine, Customer, ProductList, ProductListLine } from '@msdyn365-commerce/retail-proxy';\nimport { addProductListLinesAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductListsDataActions.g';\nimport React, { useState } from 'react';\nimport { AddToOrderTemplateDialog, IAddToOrderTemplateDialogResources } from '../add-to-order-template-dialog/add-to-order-template-dialog.component';\nimport { ILinesAddedToOrderTemplateDialogResources, LinesAddedToOrderTemplateDialog } from '../lines-added-to-order-template-dialog/lines-added-to-order-template-dialog.component';\nimport { IOrderTemplateNameDialogResources } from '../order-template-name-dialog/order-template-name-dialog.component';\n\nexport interface ISaveCartToOrderTemplateComponentProps extends IComponentProps<ISaveCartToOrderTemplateData> {\n    className?: string;\n\n    addToOrderTemplateDialogResources: IAddToOrderTemplateDialogResources;\n    createOrderTemplateDialogResources: IOrderTemplateNameDialogResources;\n    linesAddedToOrderTemplateDialogResources: ILinesAddedToOrderTemplateDialogResources;\n\n    createOrderTemplateFromCartButton: string;\n}\n\ninterface ISaveCartToOrderTemplateData {\n    orderTemplates: OrderTemplate[];\n    cartLines: CartLine[];\n\n    customerInformation?: Customer;\n}\n\ninterface ISaveCartToOrderTemplateContentState {\n    showAlert?: boolean;\n    orderTemplateTextMessage?: string;\n    color?: string;\n}\n\ninterface ISaveCartToOrderTemplateStateManager {\n    waiting: boolean;\n    content: ISaveCartToOrderTemplateContentState;\n\n    setWaiting(newWaiting: boolean): void;\n    setContent(newContent: ISaveCartToOrderTemplateContentState): void;\n}\n\nexport interface ISaveCartToOrderTemplateComponent extends IComponent<ISaveCartToOrderTemplateComponentProps> {\n    onClick(): (event: React.MouseEvent<HTMLElement>, props: ISaveCartToOrderTemplateComponentProps, state: ISaveCartToOrderTemplateStateManager) => void;\n}\n\nconst onDismiss = (state: ISaveCartToOrderTemplateStateManager): void => {\n    state.setContent({ color: 'success', showAlert: false });\n};\n\nconst SaveCartToOrderTemplateActions = {\n    onDismiss: onDismiss\n};\n\n// tslint:disable-next-line:max-func-body-length\nconst SaveCartToOrderTemplate: React.FC<ISaveCartToOrderTemplateComponentProps> = (props: ISaveCartToOrderTemplateComponentProps) => {\n    if (!props.data.customerInformation?.IsB2b) {\n        return null;\n    }\n\n    const [chosenOrderTemplate, setChosenOrderTemplate] = useState<ProductList | undefined>(undefined);\n    const [addedProducts, setAddedProducts] = useState<FullProduct[] | undefined>(undefined);\n    const [addToOrderTemplateModalOpen, setAddToOrderTemplateModalOpen] = useState(false);\n    const [linesAddedToOrderTemplateDialogOpen, setLinesAddedToOrderTemplateDialogOpen] = useState(false);\n    const [addedLinesCount, setAddedLinesCount] = useState(0);\n    const [addedItemsCount, setAddedItemsCount] = useState(0);\n\n    const {\n        addToOrderTemplateDialogResources, createOrderTemplateDialogResources,\n        createOrderTemplateFromCartButton\n    } = props;\n\n    const onOrderTemplateSelected = async (orderTemplate: ProductList) => {\n        setChosenOrderTemplate(orderTemplate);\n        const productListLines = props.data.cartLines.map(cartLine => {\n            // tslint:disable-next-line:no-unnecessary-local-variable\n            const productListLineToAdd: ProductListLine = {\n                ProductListId: orderTemplate.Id,\n                ProductId: cartLine.ProductId,\n                Quantity: cartLine.Quantity,\n                UnitOfMeasure: cartLine.UnitOfMeasureSymbol\n            };\n            return productListLineToAdd;\n        });\n\n        const addedLines = await addProductListLinesAsync({ callerContext: props.context.actionContext }, orderTemplate.Id, productListLines);\n        const productInputs: FullProductInput[] = [];\n        addedLines.forEach(listLine => {\n            if (listLine.ProductId) {\n                productInputs.push(new FullProductInput(\n                    listLine.ProductId,\n                    props.context.actionContext.requestContext.apiSettings,\n                    getProductDetailsCriteriaFromActionInput(props.context.actionContext)));\n            }\n        });\n        const products = await getFullProducts(productInputs, props.context.actionContext);\n\n        setAddedLinesCount(addedLines.length);\n        setAddedItemsCount(addedLines.map(line => line.Quantity || 1).reduce((firstQuantity, secondQuantity) => firstQuantity + secondQuantity));\n        setAddedProducts(products);\n\n        setAddToOrderTemplateModalOpen(false);\n        setTimeout(() => {\n            setLinesAddedToOrderTemplateDialogOpen(true);\n        }, 500); // tslint:disable-line:align\n    };\n\n    const onSaveCartToOrderTemplateClick = () => {\n        setAddToOrderTemplateModalOpen(true);\n    };\n\n    return (\n        <React.Fragment>\n            <AddToOrderTemplateDialog\n                className={'msc-add-to-order-template-dialog'}\n                modalOpen={addToOrderTemplateModalOpen}\n                setModalOpen={setAddToOrderTemplateModalOpen}\n                context={props.context}\n                id={props.id}\n                typeName={props.typeName}\n                data={{ orderTemplates: props.data.orderTemplates }}\n                addToOrderTemplateDialogResources={addToOrderTemplateDialogResources}\n                createOrderTemplateDialogResources={createOrderTemplateDialogResources}\n                onOrderTemplateSelected={onOrderTemplateSelected}\n            />\n            {\n                chosenOrderTemplate && addedProducts && <LinesAddedToOrderTemplateDialog\n                    className={'msc-lines-added-to-order-template-dialog'}\n                    id={props.id}\n                    typeName={props.typeName}\n                    context={props.context}\n                    dialogStrings={props.linesAddedToOrderTemplateDialogResources}\n                    data={{\n                        linesCount: addedLinesCount,\n                        itemsCount: addedItemsCount,\n                        orderTemplate: chosenOrderTemplate,\n                        products: addedProducts\n                    }}\n                    modalOpen={linesAddedToOrderTemplateDialogOpen}\n                />\n            }\n            <Button className={'msc-cart__btn-addcarttotemplate'} onClick={onSaveCartToOrderTemplateClick} title={createOrderTemplateFromCartButton}>{createOrderTemplateFromCartButton}</Button>\n        </React.Fragment>\n    );\n};\n\n// @ts-ignore\nexport const SaveCartToOrderTemplateComponent: React.FunctionComponent<ISaveCartToOrderTemplateComponentProps> = msdyn365Commerce.createComponent<ISaveCartToOrderTemplateComponent>(\n    'SaveCartToOrderTemplate',\n    { component: SaveCartToOrderTemplate, ...SaveCartToOrderTemplateActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}