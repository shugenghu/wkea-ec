{"ast":null,"code":"import\"core-js/modules/es.symbol.description.js\";import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _objectWithoutProperties from\"@babel/runtime/helpers/esm/objectWithoutProperties\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*!\r\n * Copyright (c) Microsoft Corporation.\r\n * All rights reserved. See LICENSE in the project root for license information.\r\n */import classnames from'classnames';import*as React from'react';import ReactDOM from'react-dom';import{EditableField,FieldType}from'../../utilities/editable-fields/editable-field';import{getImageResizeUrl,getLargestGridSettingViewportName,getSourceData}from'./source-builder';export const placeholderImageUrl='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAEALAAAAAABAAEAAAIBTAA7';/**\r\n *  Image\r\n */export class Image extends React.PureComponent{constructor(props){var _this;super(props);_this=this;this.defaultImage=(largestGridSettingViewportName,imageAttributes,lazyLoad,inputImageSettings)=>{const{src,className,image,imageSettings,binaryHash,altText,quality,focalRegion,cropRegions,description,fileName,fileSize,imageStyle,isLocalizable,isDecorativeImage,orientation,_links}=imageAttributes,attributes=_objectWithoutProperties(imageAttributes,[\"src\",\"className\",\"image\",\"imageSettings\",\"binaryHash\",\"altText\",\"quality\",\"focalRegion\",\"cropRegions\",\"description\",\"fileName\",\"fileSize\",\"imageStyle\",\"isLocalizable\",\"isDecorativeImage\",\"orientation\",\"_links\"]);const cssClassName=this.props.className||'';const filteredClassName=lazyLoad?cssClassName?\"\".concat(cssClassName,\" lazyload\"):'lazyload':cssClassName;const viewports=inputImageSettings&&inputImageSettings.viewports;if(viewports&&Object.keys(viewports).length){delete attributes.width;delete attributes.height;}const largestViewport=viewports&&viewports[largestGridSettingViewportName];const urlSrc=getImageResizeUrl(this.state.src,largestViewport,inputImageSettings);return/*#__PURE__*/React.createElement(EditableField,{type:FieldType.Image,editPropKey:this.props.editProps&&this.props.editProps.key,requestContext:this.props.editProps&&this.props.editProps.requestContext,fieldProps:_objectSpread(_objectSpread(_objectSpread({alt:this.props.altText},lazyLoad?{src:placeholderImageUrl,'data-src':urlSrc}:{src:urlSrc}),attributes),{},{key:'default-image',className:filteredClassName,onError:this.imageFailed,additionalProperties:this.props.additionalProperties})});};this.imageFailed=function(){if(_this.props.fallBackSrc&&_this.props.fallBackSrc===_this.state.src||!_this.props.fallBackSrc){_this.setState({loadFailed:true});}else{_this.setState({src:_this.props.fallBackSrc?_this.props.fallBackSrc:_this.props.src});}if(typeof _this.props.onError==='function'){_this.props.onError(...arguments);}};this.getSourceTag=(viewport,imageSettings,largestGridSettingViewportName,lazyLoad)=>{const srcData=getSourceData(this.state.src,this.props.gridSettings,this.props,imageSettings,viewport,largestGridSettingViewportName);if(!srcData){return;}return/*#__PURE__*/React.createElement(\"source\",Object.assign({key:viewport},lazyLoad?{'data-srcset':srcData.srcSet}:{srcSet:srcData.srcSet},srcData.media?{media:srcData.media}:{}));};this.state={loadFailed:false,src:props.src};}componentDidUpdate(prevProps){if(this.props.src!==prevProps.src||this.props.fallBackSrc!==prevProps.fallBackSrc){this.setState({loadFailed:false,src:this.props.src});}}componentDidMount(){// onError will sometimes fire before the react events get hooked up. So we\n// cannot rely on it for determining when image load fails. Instead we also have\n// to find the img that the Image component uses> If its complete, but naturalWidth\n// is zero that means load failed\nconst node=ReactDOM.findDOMNode(this);if(node&&node.querySelector){const child=node.querySelector('img');if(child&&child.complete&&child.naturalWidth===0){if(this.props.fallBackSrc&&this.props.fallBackSrc===this.state.src||!this.props.fallBackSrc){this.setState({loadFailed:true});}else{this.setState({src:this.props.fallBackSrc?this.props.fallBackSrc:this.props.src});}return;}}}render(){const _this$props=this.props,{loadFailureBehavior,pictureAttributes={},gridSettings,fallBackSrc}=_this$props,imageAttributes=_objectWithoutProperties(_this$props,[\"loadFailureBehavior\",\"pictureAttributes\",\"gridSettings\",\"fallBackSrc\"]);if(this.state.loadFailed||!this.props.src){if(loadFailureBehavior==='hide'){return null;}else if(loadFailureBehavior==='empty'){return/*#__PURE__*/React.createElement(\"div\",{className:classnames('msc-empty_image',imageAttributes.className)});}}const imageSettings=this.props.imageSettings||imageAttributes.imageSettings;const largestGridSettingViewportName=getLargestGridSettingViewportName(gridSettings);// Lazyload by default if nothing is specified\nconst lazyLoad=!imageSettings||!imageSettings.disableLazyLoad;const sourceTags=imageSettings&&imageSettings.viewports?Object.keys(imageSettings.viewports).map(vp=>this.getSourceTag(vp,imageSettings,largestGridSettingViewportName,lazyLoad)).filter(Boolean)||[]:[];sourceTags.push(this.defaultImage(largestGridSettingViewportName,imageAttributes,lazyLoad,imageSettings));return/*#__PURE__*/React.createElement(\"picture\",Object.assign({},pictureAttributes),sourceTags);}}","map":{"version":3,"sources":["../../../../src/components/image/image.tsx"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport { IImageSettings } from '../..';\nimport { IAny, IGeneric } from '../../interfaces';\nimport { EditableField, FieldType } from '../../utilities/editable-fields/editable-field';\nimport { IImageProps, Viewport } from './IImage';\nimport { getImageResizeUrl, getLargestGridSettingViewportName, getSourceData } from './source-builder';\n\nexport const placeholderImageUrl = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAEALAAAAAABAAEAAAIBTAA7';\n\nexport interface IPictureState {\n    loadFailed: boolean;\n    src: string;\n}\n\n/**\n *  Image\n */\nexport class Image extends React.PureComponent<IImageProps, IPictureState> {\n    constructor(props: IImageProps) {\n        super(props);\n        this.state = {\n            loadFailed: false,\n            src: props.src\n        };\n    }\n\n    public componentDidUpdate(prevProps: IImageProps): void {\n        if (this.props.src !== prevProps.src || this.props.fallBackSrc !== prevProps.fallBackSrc) {\n            this.setState({ loadFailed: false, src: this.props.src });\n        }\n    }\n    public componentDidMount(): void {\n        // onError will sometimes fire before the react events get hooked up. So we\n        // cannot rely on it for determining when image load fails. Instead we also have\n        // to find the img that the Image component uses> If its complete, but naturalWidth\n        // is zero that means load failed\n        const node = ReactDOM.findDOMNode(this) as HTMLElement;\n\n        if (node && node.querySelector) {\n            const child = node.querySelector('img');\n            if (child && child.complete && child.naturalWidth === 0) {\n                if ((this.props.fallBackSrc && this.props.fallBackSrc === this.state.src) || !this.props.fallBackSrc) {\n                    this.setState({ loadFailed: true });\n                } else {\n                    this.setState({ src: this.props.fallBackSrc ? this.props.fallBackSrc : this.props.src });\n                }\n                return;\n            }\n        }\n    }\n\n    public render(): JSX.Element | null {\n        const { loadFailureBehavior, pictureAttributes = {}, gridSettings, fallBackSrc, ...imageAttributes } = this.props;\n        if (this.state.loadFailed || !this.props.src) {\n            if (loadFailureBehavior === 'hide') {\n                return null;\n            } else if (loadFailureBehavior === 'empty') {\n                return <div className={classnames('msc-empty_image', imageAttributes.className)} />;\n            }\n        }\n\n        const imageSettings = this.props.imageSettings || imageAttributes.imageSettings;\n        const largestGridSettingViewportName = getLargestGridSettingViewportName(gridSettings);\n\n        // Lazyload by default if nothing is specified\n        const lazyLoad = !imageSettings || !imageSettings.disableLazyLoad;\n\n        const sourceTags: (JSX.Element | undefined)[] =\n            imageSettings && imageSettings.viewports\n                ? Object.keys(imageSettings.viewports)\n                      .map(vp => this.getSourceTag(vp as Viewport, imageSettings, largestGridSettingViewportName, lazyLoad))\n                      .filter(Boolean) || []\n                : [];\n\n        sourceTags.push(this.defaultImage(largestGridSettingViewportName, imageAttributes, lazyLoad, imageSettings));\n        return <picture {...pictureAttributes}>{sourceTags}</picture>;\n    }\n\n    private defaultImage = (\n        largestGridSettingViewportName: Viewport,\n        imageAttributes: IGeneric<IAny>,\n        lazyLoad: boolean,\n        inputImageSettings?: IImageSettings\n    ) => {\n        const {\n            src,\n            className,\n            image,\n            imageSettings,\n            binaryHash,\n            altText,\n            quality,\n            focalRegion,\n            cropRegions,\n            description,\n            fileName,\n            fileSize,\n            imageStyle,\n            isLocalizable,\n            isDecorativeImage,\n            orientation,\n            _links,\n            ...attributes\n        } = imageAttributes;\n\n        const cssClassName = this.props.className || '';\n        const filteredClassName = lazyLoad ? (cssClassName ? `${cssClassName} lazyload` : 'lazyload') : cssClassName;\n        const viewports = inputImageSettings && inputImageSettings.viewports;\n        if (viewports && Object.keys(viewports).length) {\n            delete attributes.width;\n            delete attributes.height;\n        }\n\n        const largestViewport = viewports && viewports[largestGridSettingViewportName];\n        const urlSrc = getImageResizeUrl(this.state.src, largestViewport, inputImageSettings);\n\n        return (\n            <EditableField\n                type={FieldType.Image}\n                editPropKey={this.props.editProps && this.props.editProps.key}\n                requestContext={this.props.editProps && this.props.editProps.requestContext}\n                fieldProps={{\n                    alt: this.props.altText,\n                    ...(lazyLoad ? { src: placeholderImageUrl, 'data-src': urlSrc } : { src: urlSrc }),\n                    ...attributes,\n                    key: 'default-image',\n                    className: filteredClassName,\n                    onError: this.imageFailed,\n                    additionalProperties: this.props.additionalProperties\n                }}\n            />\n        );\n    };\n\n    private imageFailed = (...args: unknown[]) => {\n        if ((this.props.fallBackSrc && this.props.fallBackSrc === this.state.src) || !this.props.fallBackSrc) {\n            this.setState({ loadFailed: true });\n        } else {\n            this.setState({ src: this.props.fallBackSrc ? this.props.fallBackSrc : this.props.src });\n        }\n        if (typeof this.props.onError === 'function') {\n            this.props.onError(...args);\n        }\n    };\n\n    private getSourceTag = (\n        viewport: Viewport,\n        imageSettings: IImageSettings,\n        largestGridSettingViewportName: Viewport,\n        lazyLoad: boolean\n    ) => {\n        const srcData = getSourceData(\n            this.state.src,\n            this.props.gridSettings,\n            this.props,\n            imageSettings,\n            viewport,\n            largestGridSettingViewportName\n        );\n        if (!srcData) {\n            return;\n        }\n        return (\n            <source\n                key={viewport}\n                {...(lazyLoad ? { 'data-srcset': srcData.srcSet } : { srcSet: srcData.srcSet })}\n                {...(srcData.media ? { media: srcData.media } : {})}\n            />\n        );\n    };\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}