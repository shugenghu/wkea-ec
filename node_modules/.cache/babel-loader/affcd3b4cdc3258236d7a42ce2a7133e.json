{"ast":null,"code":"import\"core-js/modules/es.symbol.description.js\";import\"core-js/modules/es.promise.js\";import{buildCacheKey,getProductUrlSync,getSelectedProductIdFromActionInput,getSelectedVariant,SelectedVariantInput}from'@msdyn365-commerce-modules/retail-actions';import{createObservableDataAction}from'@msdyn365-commerce/core';export class ProductPageSummaryInput{constructor(config,apiSettings){this.getCacheObjectType=()=>'ProductPageSummary';this.getCacheKey=()=>\"\".concat(buildCacheKey('ProductPageSummary',this.apiSettings),\"-\").concat(this.config.title);this.dataCacheType=()=>'request';this.config=config||{};this.apiSettings=apiSettings;}}const createGetSelectedVariantInput=inputData=>{const productId=getSelectedProductIdFromActionInput(inputData);if(productId){return new SelectedVariantInput(+productId,+inputData.requestContext.apiSettings.channelId,[]);}else{throw new Error('Unable to create SelectedVariantInput, no productId found on module config or query');}};const action=async(input,context)=>{const{config}=input;let simpleProductData;try{simpleProductData=await getSelectedVariant(createGetSelectedVariantInput(context),context);}catch(e){}if(simpleProductData){let productUrl;try{productUrl=getProductUrlSync(simpleProductData,context);const canonicalDomain=context.requestContext.canonicalDomain;if(productUrl&&canonicalDomain){productUrl=\"https://\".concat(canonicalDomain).concat(productUrl);}else{productUrl=undefined;}}catch(e){productUrl=undefined;}return{title:simpleProductData.Name,description:simpleProductData.Description,sharingImageUrl:simpleProductData.PrimaryImageUrl,canonicalUrl:productUrl,faviconUrl:config&&config.faviconUrl};}else if(config){return{title:config.title,description:config.description,sharingImageUrl:config.sharingImage&&config.sharingImage.src,faviconUrl:config&&config.faviconUrl};}else{return{};}};export default createObservableDataAction({id:'@msdyn365-commerce-modules/page-summary/product-page-summary',action:action,input:args=>{return new ProductPageSummaryInput(args.config,args.requestContext.apiSettings);}});","map":{"version":3,"sources":["modules/product-page-summary/product-page-summary.action.ts"],"names":[],"mappings":"uFAAA,OAAS,aAAT,CAAwB,iBAAxB,CAA2C,mCAA3C,CAAgF,kBAAhF,CAAoG,oBAApG,KAAgI,2CAAhI,CACA,OAAoB,0BAApB,KAAwI,yBAAxI,CAKA,MAAM,MAAO,CAAA,uBAAuB,CAIhC,WAAA,CAAY,MAAZ,CAA+C,WAA/C,CAAgF,CAKzE,KAAA,kBAAA,CAAqB,IAAc,oBAAnC,CACA,KAAA,WAAA,CAAc,cAAiB,aAAa,CAAC,oBAAD,CAAuB,KAAK,WAA5B,CAA9B,aAA0E,KAAK,MAAL,CAAY,KAAtF,CAAd,CACA,KAAA,aAAA,CAAgB,IAAiB,SAAjC,CANH,KAAK,MAAL,CAAc,MAAM,EAAI,EAAxB,CACA,KAAK,WAAL,CAAmB,WAAnB,CACH,CAP+B,CAcpC,KAAM,CAAA,6BAA6B,CAAI,SAAD,EAAoD,CACtF,KAAM,CAAA,SAAS,CAAG,mCAAmC,CAAC,SAAD,CAArD,CAEA,GAAI,SAAJ,CAAe,CACX,MAAO,IAAI,CAAA,oBAAJ,CAAyB,CAAC,SAA1B,CAAqC,CAAC,SAAS,CAAC,cAAV,CAAyB,WAAzB,CAAqC,SAA3E,CAAsF,EAAtF,CAAP,CACH,CAFD,IAEO,CACH,KAAM,IAAI,CAAA,KAAJ,CAAU,qFAAV,CAAN,CACH,CACJ,CARD,CAUA,KAAM,CAAA,MAAM,CAAG,MAAO,KAAP,CAAuC,OAAvC,GAA6F,CACxG,KAAM,CAAE,MAAF,EAAa,KAAnB,CACA,GAAI,CAAA,iBAAJ,CACA,GAAI,CACA,iBAAiB,CAAG,KAAM,CAAA,kBAAkB,CAAC,6BAA6B,CAAC,OAAD,CAA9B,CAAyC,OAAzC,CAA5C,CACH,CAAC,MAAO,CAAP,CAAU,CAEX,CACD,GAAI,iBAAJ,CAAuB,CACnB,GAAI,CAAA,UAAJ,CACA,GAAI,CACA,UAAU,CAAG,iBAAiB,CAAC,iBAAD,CAAoB,OAApB,CAA9B,CAEA,KAAM,CAAA,eAAe,CAAG,OAAO,CAAC,cAAR,CAAuB,eAA/C,CACA,GAAI,UAAU,EAAI,eAAlB,CAAmC,CAC/B,UAAU,mBAAc,eAAd,SAAgC,UAAhC,CAAV,CACH,CAFD,IAEO,CACH,UAAU,CAAG,SAAb,CACH,CACJ,CAAC,MAAO,CAAP,CAAU,CACR,UAAU,CAAG,SAAb,CACH,CACD,MAAO,CACH,KAAK,CAAE,iBAAiB,CAAC,IADtB,CAEH,WAAW,CAAE,iBAAiB,CAAC,WAF5B,CAGH,eAAe,CAAE,iBAAiB,CAAC,eAHhC,CAIH,YAAY,CAAE,UAJX,CAKH,UAAU,CAAE,MAAM,EAAI,MAAM,CAAC,UAL1B,CAAP,CAQH,CAtBD,IAsBO,IAAI,MAAJ,CAAY,CACf,MAAO,CACH,KAAK,CAAE,MAAM,CAAC,KADX,CAEH,WAAW,CAAE,MAAM,CAAC,WAFjB,CAGH,eAAe,CAAE,MAAM,CAAC,YAAP,EAAuB,MAAM,CAAC,YAAP,CAAoB,GAHzD,CAIH,UAAU,CAAE,MAAM,EAAI,MAAM,CAAC,UAJ1B,CAAP,CAMH,CAPM,IAOA,CACH,MAAO,EAAP,CACH,CACJ,CAxCD,CA0CA,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,8DADkC,CAEtC,MAAM,CAA6B,MAFG,CAGtC,KAAK,CAAG,IAAD,EAA+B,CAClC,MAAO,IAAI,CAAA,uBAAJ,CAAuD,IAAI,CAAC,MAA5D,CAAoE,IAAI,CAAC,cAAL,CAAoB,WAAxF,CAAP,CACH,CALqC,CAAD,CAAzC","sourcesContent":["import { buildCacheKey, getProductUrlSync, getSelectedProductIdFromActionInput, getSelectedVariant, SelectedVariantInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { CacheType, createObservableDataAction, IAction, IActionContext,IActionInput, ICommerceApiSettings, ICreateActionContext } from '@msdyn365-commerce/core';\nimport { IDefaultPageSummaryConfig } from '../default-page-summary/default-page-summary.props.autogenerated';\nimport { IPageSummaryData } from '../IPageSummaryData';\n\n/** Product Page Summary Input */\nexport class ProductPageSummaryInput implements IActionInput {\n    public apiSettings: ICommerceApiSettings;\n    public config: IDefaultPageSummaryConfig;\n\n    constructor(config: IDefaultPageSummaryConfig, apiSettings: ICommerceApiSettings) {\n        this.config = config || {};\n        this.apiSettings = apiSettings;\n    }\n\n    public getCacheObjectType = (): string => 'ProductPageSummary';\n    public getCacheKey = (): string => `${buildCacheKey('ProductPageSummary', this.apiSettings)}-${this.config.title}`;\n    public dataCacheType = (): CacheType => 'request';\n}\n\nconst createGetSelectedVariantInput = (inputData: IActionContext): SelectedVariantInput => {\n    const productId = getSelectedProductIdFromActionInput(inputData);\n\n    if (productId) {\n        return new SelectedVariantInput(+productId, +inputData.requestContext.apiSettings.channelId, []);\n    } else {\n        throw new Error('Unable to create SelectedVariantInput, no productId found on module config or query');\n    }\n};\n\nconst action = async (input: ProductPageSummaryInput, context: IActionContext): Promise<IPageSummaryData> => {\n    const { config } = input;\n    let simpleProductData;\n    try {\n        simpleProductData = await getSelectedVariant(createGetSelectedVariantInput(context), context);\n    } catch (e) {\n        // Do nothing, if there's an error we fall back to values defined from data\n    }\n    if (simpleProductData) {\n        let productUrl: string | undefined;\n        try {\n            productUrl = getProductUrlSync(simpleProductData, context);\n            // @ts-ignore - TODO: property exits in new version of SDK. Remove once released.\n            const canonicalDomain = context.requestContext.canonicalDomain;\n            if (productUrl && canonicalDomain) {\n                productUrl = `https://${canonicalDomain}${productUrl}`;\n            } else {\n                productUrl = undefined;\n            }\n        } catch (e) {\n            productUrl = undefined;\n        }\n        return {\n            title: simpleProductData.Name,\n            description: simpleProductData.Description,\n            sharingImageUrl: simpleProductData.PrimaryImageUrl,\n            canonicalUrl: productUrl,\n            faviconUrl: config && config.faviconUrl\n        };\n    // If the action fails fallback to values defined from data\n    } else if (config) {\n        return {\n            title: config.title,\n            description: config.description,\n            sharingImageUrl: config.sharingImage && config.sharingImage.src,\n            faviconUrl: config && config.faviconUrl\n        };\n    } else {\n        return {};\n    }\n};\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/page-summary/product-page-summary',\n    action: <IAction<IPageSummaryData>>action,\n    input: (args: ICreateActionContext) => {\n        return new ProductPageSummaryInput(<IDefaultPageSummaryConfig>args.config, args.requestContext.apiSettings);\n    }\n});"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}