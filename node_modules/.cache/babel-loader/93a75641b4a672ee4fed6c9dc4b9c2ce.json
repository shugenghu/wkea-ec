{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{createObservableDataAction}from'@msdyn365-commerce/core';import{readAsync,updateAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CustomersDataActions.g';import{GetCustomerInput}from'./get-customer';import{buildCacheKey}from'./index';/**\r\n *  Input class for the updateCustomerPersonalization\r\n */export var updateCustomerPersonalizationInput=function updateCustomerPersonalizationInput(userAccountNumber,isOptOut,apiSettings,preferenceType){var _this=this;_classCallCheck(this,updateCustomerPersonalizationInput);this.getCacheKey=function(){return buildCacheKey(\"\".concat(_this.userAccountNumber),_this.apiSettings);};this.getCacheObjectType=function(){return'Customer';};this.dataCacheType=function(){return'none';};this.userAccountNumber=userAccountNumber;this.apiSettings=apiSettings;this.isOptOut=isOptOut;this.preferenceType=preferenceType;};/**\r\n * The action method for the updateCustomerPersonalization data action\r\n * @param input The action input\r\n * @param ctx The action context\r\n */export function updateCustomerPersonalizationAction(_x,_x2){return _updateCustomerPersonalizationAction.apply(this,arguments);}/**\r\n * The updateCustomerPersonalization data action\r\n * Returns the updated customer\r\n */function _updateCustomerPersonalizationAction(){_updateCustomerPersonalizationAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var userAccountNumber,isOptOut,preferenceType,customer,newCustomer,updatedCustomer;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:userAccountNumber=input.userAccountNumber,isOptOut=input.isOptOut,preferenceType=input.preferenceType;_context.next=3;return readAsync({callerContext:ctx},userAccountNumber);case 3:customer=_context.sent;if(customer){_context.next=6;break;}throw new Error('Unable to find customer');case 6:newCustomer=_objectSpread({},customer);_context.t0=preferenceType;_context.next=_context.t0==='web-tracking'?10:_context.t0===undefined?12:_context.t0==='personalization'?12:12;break;case 10:newCustomer.OptOutWebActivityTracking=isOptOut;return _context.abrupt(\"break\",13);case 12:newCustomer.OptOutPersonalization=isOptOut;case 13:_context.next=15;return updateAsync({callerContext:ctx},newCustomer);case 15:updatedCustomer=_context.sent;if(updatedCustomer){_context.next=18;break;}throw new Error('Unable to update customer');case 18:ctx.update(new GetCustomerInput(ctx.requestContext.apiSettings),updatedCustomer);return _context.abrupt(\"return\",updatedCustomer);case 20:case\"end\":return _context.stop();}}},_callee);}));return _updateCustomerPersonalizationAction.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/update-customer-personalization',action:updateCustomerPersonalizationAction});","map":{"version":3,"sources":["../../src/update-customer-personalization.ts"],"names":[],"mappings":"ijCAAA,OACe,0BADf,KAGO,yBAHP,CAKA,OACI,SADJ,CACe,WADf,KAEO,yEAFP,CAIA,OAAS,gBAAT,KAAiC,gBAAjC,CACA,OAAS,aAAT,KAA8B,SAA9B,CASA;;AAEG,GACH,UAAa,CAAA,kCAAb,CAMI,4CAAY,iBAAZ,CAAuC,QAAvC,CAA0D,WAA1D,CAA6F,cAA7F,CAAoH,yEAO7G,KAAA,WAAA,CAAc,iBAAc,CAAA,aAAa,WAAI,KAAI,CAAC,iBAAT,EAA8B,KAAI,CAAC,WAAnC,CAA3B,EAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,UAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,MAAjB,EAAhB,CARH,KAAK,iBAAL,CAAyB,iBAAzB,CACA,KAAK,WAAL,CAAmB,WAAnB,CACA,KAAK,QAAL,CAAgB,QAAhB,CACA,KAAK,cAAL,CAAsB,cAAtB,CACH,CAXL,CAkBA;;;;AAIG,GACH,eAAsB,CAAA,mCAAtB,4EAgCA;;;AAGG,G,6IAnCI,iBAAmD,KAAnD,CAA+F,GAA/F,qMACK,iBADL,CACqD,KADrD,CACK,iBADL,CACwB,QADxB,CACqD,KADrD,CACwB,QADxB,CACkC,cADlC,CACqD,KADrD,CACkC,cADlC,uBAGoB,CAAA,SAAS,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,iBAAzB,CAH7B,QAGG,QAHH,kBAKE,QALF,8BAMO,IAAI,CAAA,KAAJ,CAAU,yBAAV,CANP,QASG,WATH,kBASsB,QATtB,cAWK,cAXL,6BAYM,cAZN,kBAeM,SAfN,kBAgBM,iBAhBN,qBAaK,WAAW,CAAC,yBAAZ,CAAwC,QAAxC,CAbL,2CAkBK,WAAW,CAAC,qBAAZ,CAAoC,QAApC,CAlBL,+BAqB2B,CAAA,WAAW,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,WAAzB,CArBtC,SAqBG,eArBH,kBAuBE,eAvBF,+BAwBO,IAAI,CAAA,KAAJ,CAAU,2BAAV,CAxBP,SA2BH,GAAG,CAAC,MAAJ,CAAW,GAAI,CAAA,gBAAJ,CAAqB,GAAG,CAAC,cAAJ,CAAmB,WAAxC,CAAX,CAAiE,eAAjE,EA3BG,gCA6BI,eA7BJ,yD,sEAoCP,cAAe,CAAA,0BAA0B,CAAW,CAChD,EAAE,CAAE,2EAD4C,CAEhD,MAAM,CAAqB,mCAFqB,CAAX,CAAzC","sourcesContent":["import {\n    CacheType, createObservableDataAction, IAction, IActionContext, IActionInput,\n    ICommerceApiSettings\n} from '@msdyn365-commerce/core';\nimport { Customer } from '@msdyn365-commerce/retail-proxy';\nimport {\n    readAsync, updateAsync\n} from '@msdyn365-commerce/retail-proxy/dist/DataActions/CustomersDataActions.g';\n\nimport { GetCustomerInput } from './get-customer';\nimport { buildCacheKey } from './index';\n\nexport interface IUpdateCustomerPersonalizationInput extends IActionInput {\n    isOptOut: boolean;\n    userAccountNumber: string;\n    apiSettings: ICommerceApiSettings;\n    preferenceType?: string;\n}\n\n/**\n *  Input class for the updateCustomerPersonalization\n */\nexport class updateCustomerPersonalizationInput implements IUpdateCustomerPersonalizationInput {\n    public userAccountNumber: string;\n    public isOptOut: boolean;\n    public apiSettings: ICommerceApiSettings;\n    public preferenceType: string | undefined;\n\n    constructor(userAccountNumber: string, isOptOut: boolean, apiSettings: ICommerceApiSettings, preferenceType?: string) {\n        this.userAccountNumber = userAccountNumber;\n        this.apiSettings = apiSettings;\n        this.isOptOut = isOptOut;\n        this.preferenceType = preferenceType;\n    }\n\n    public getCacheKey = (): string => buildCacheKey(`${this.userAccountNumber}`, this.apiSettings);\n    public getCacheObjectType = () => 'Customer';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * The action method for the updateCustomerPersonalization data action\n * @param input The action input\n * @param ctx The action context\n */\nexport async function updateCustomerPersonalizationAction(input: IUpdateCustomerPersonalizationInput, ctx: IActionContext): Promise<Customer> {\n    const { userAccountNumber, isOptOut, preferenceType } = input;\n\n    const customer = await readAsync({ callerContext: ctx }, userAccountNumber);\n\n    if (!customer) {\n        throw new Error('Unable to find customer');\n    }\n\n    const newCustomer = { ...customer };\n\n    switch (preferenceType) {\n        case 'web-tracking':\n            newCustomer.OptOutWebActivityTracking = isOptOut;\n            break;\n        case undefined:\n        case 'personalization':\n        default:\n            newCustomer.OptOutPersonalization = isOptOut;\n    }\n\n    const updatedCustomer = await updateAsync({ callerContext: ctx }, newCustomer);\n\n    if (!updatedCustomer) {\n        throw new Error('Unable to update customer');\n    }\n\n    ctx.update(new GetCustomerInput(ctx.requestContext.apiSettings), updatedCustomer);\n\n    return updatedCustomer;\n}\n\n/**\n * The updateCustomerPersonalization data action\n * Returns the updated customer\n */\nexport default createObservableDataAction<Customer>({\n    id: '@msdyn365-commerce-modules/retail-actions/update-customer-personalization',\n    action: <IAction<Customer>>updateCustomerPersonalizationAction\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}