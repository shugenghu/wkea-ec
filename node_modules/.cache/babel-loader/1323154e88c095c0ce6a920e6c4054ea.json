{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{FullProductInput,getFullProducts,getProductDetailsCriteriaFromActionInput}from'@msdyn365-commerce-modules/retail-actions';import{Button}from'@msdyn365-commerce-modules/utilities';import{msdyn365Commerce}from'@msdyn365-commerce/core';import{addProductListLinesAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductListsDataActions.g';import React,{useState}from'react';import{AddToOrderTemplateDialog}from'../add-to-order-template-dialog/add-to-order-template-dialog.component';import{LinesAddedToOrderTemplateDialog}from'../lines-added-to-order-template-dialog/lines-added-to-order-template-dialog.component';var onDismiss=function onDismiss(state){state.setContent({color:'success',showAlert:false});};var SaveCartToOrderTemplateActions={onDismiss:onDismiss};var SaveCartToOrderTemplate=function SaveCartToOrderTemplate(props){var _props$data$customerI;if(!((_props$data$customerI=props.data.customerInformation)!==null&&_props$data$customerI!==void 0&&_props$data$customerI.IsB2b)){return null;}var _useState=useState(undefined),_useState2=_slicedToArray(_useState,2),chosenOrderTemplate=_useState2[0],setChosenOrderTemplate=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),addedProducts=_useState4[0],setAddedProducts=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),addToOrderTemplateModalOpen=_useState6[0],setAddToOrderTemplateModalOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),linesAddedToOrderTemplateDialogOpen=_useState8[0],setLinesAddedToOrderTemplateDialogOpen=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),addedLinesCount=_useState10[0],setAddedLinesCount=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),addedItemsCount=_useState12[0],setAddedItemsCount=_useState12[1];var addToOrderTemplateDialogResources=props.addToOrderTemplateDialogResources,createOrderTemplateDialogResources=props.createOrderTemplateDialogResources,createOrderTemplateFromCartButton=props.createOrderTemplateFromCartButton;var onOrderTemplateSelected=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(orderTemplate){var productListLines,addedLines,productInputs,products;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setChosenOrderTemplate(orderTemplate);productListLines=props.data.cartLines.map(function(cartLine){var productListLineToAdd={ProductListId:orderTemplate.Id,ProductId:cartLine.ProductId,Quantity:cartLine.Quantity,UnitOfMeasure:cartLine.UnitOfMeasureSymbol};return productListLineToAdd;});_context.next=4;return addProductListLinesAsync({callerContext:props.context.actionContext},orderTemplate.Id,productListLines);case 4:addedLines=_context.sent;productInputs=[];addedLines.forEach(function(listLine){if(listLine.ProductId){productInputs.push(new FullProductInput(listLine.ProductId,props.context.actionContext.requestContext.apiSettings,getProductDetailsCriteriaFromActionInput(props.context.actionContext)));}});_context.next=9;return getFullProducts(productInputs,props.context.actionContext);case 9:products=_context.sent;setAddedLinesCount(addedLines.length);setAddedItemsCount(addedLines.map(function(line){return line.Quantity||1;}).reduce(function(firstQuantity,secondQuantity){return firstQuantity+secondQuantity;}));setAddedProducts(products);setAddToOrderTemplateModalOpen(false);setTimeout(function(){setLinesAddedToOrderTemplateDialogOpen(true);},500);case 15:case\"end\":return _context.stop();}}},_callee);}));return function onOrderTemplateSelected(_x){return _ref.apply(this,arguments);};}();var onSaveCartToOrderTemplateClick=function onSaveCartToOrderTemplateClick(){setAddToOrderTemplateModalOpen(true);};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(AddToOrderTemplateDialog,{className:'msc-add-to-order-template-dialog',modalOpen:addToOrderTemplateModalOpen,setModalOpen:setAddToOrderTemplateModalOpen,context:props.context,id:props.id,typeName:props.typeName,data:{orderTemplates:props.data.orderTemplates},addToOrderTemplateDialogResources:addToOrderTemplateDialogResources,createOrderTemplateDialogResources:createOrderTemplateDialogResources,onOrderTemplateSelected:onOrderTemplateSelected}),chosenOrderTemplate&&addedProducts&&/*#__PURE__*/React.createElement(LinesAddedToOrderTemplateDialog,{className:'msc-lines-added-to-order-template-dialog',id:props.id,typeName:props.typeName,context:props.context,dialogStrings:props.linesAddedToOrderTemplateDialogResources,data:{linesCount:addedLinesCount,itemsCount:addedItemsCount,orderTemplate:chosenOrderTemplate,products:addedProducts},modalOpen:linesAddedToOrderTemplateDialogOpen}),/*#__PURE__*/React.createElement(Button,{className:'msc-cart__btn-addcarttotemplate',onClick:onSaveCartToOrderTemplateClick,title:createOrderTemplateFromCartButton},createOrderTemplateFromCartButton));};export var SaveCartToOrderTemplateComponent=msdyn365Commerce.createComponent('SaveCartToOrderTemplate',_objectSpread({component:SaveCartToOrderTemplate},SaveCartToOrderTemplateActions));","map":{"version":3,"sources":["order-template/save-cart-to-order-template/save-cart-to-order-template.component.tsx"],"names":[],"mappings":"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","sourcesContent":["import { FullProductInput, getFullProducts, getProductDetailsCriteriaFromActionInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { OrderTemplate } from '@msdyn365-commerce-modules/retail-actions';\nimport { Button } from '@msdyn365-commerce-modules/utilities';\nimport { FullProduct } from '@msdyn365-commerce/commerce-entities';\nimport { IComponent, IComponentProps, msdyn365Commerce } from '@msdyn365-commerce/core';\nimport { CartLine, Customer, ProductList, ProductListLine } from '@msdyn365-commerce/retail-proxy';\nimport { addProductListLinesAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductListsDataActions.g';\nimport React, { useState } from 'react';\nimport { AddToOrderTemplateDialog, IAddToOrderTemplateDialogResources } from '../add-to-order-template-dialog/add-to-order-template-dialog.component';\nimport { ILinesAddedToOrderTemplateDialogResources, LinesAddedToOrderTemplateDialog } from '../lines-added-to-order-template-dialog/lines-added-to-order-template-dialog.component';\nimport { IOrderTemplateNameDialogResources } from '../order-template-name-dialog/order-template-name-dialog.component';\n\nexport interface ISaveCartToOrderTemplateComponentProps extends IComponentProps<ISaveCartToOrderTemplateData> {\n    className?: string;\n\n    addToOrderTemplateDialogResources: IAddToOrderTemplateDialogResources;\n    createOrderTemplateDialogResources: IOrderTemplateNameDialogResources;\n    linesAddedToOrderTemplateDialogResources: ILinesAddedToOrderTemplateDialogResources;\n\n    createOrderTemplateFromCartButton: string;\n}\n\ninterface ISaveCartToOrderTemplateData {\n    orderTemplates: OrderTemplate[];\n    cartLines: CartLine[];\n\n    customerInformation?: Customer;\n}\n\ninterface ISaveCartToOrderTemplateContentState {\n    showAlert?: boolean;\n    orderTemplateTextMessage?: string;\n    color?: string;\n}\n\ninterface ISaveCartToOrderTemplateStateManager {\n    waiting: boolean;\n    content: ISaveCartToOrderTemplateContentState;\n\n    setWaiting(newWaiting: boolean): void;\n    setContent(newContent: ISaveCartToOrderTemplateContentState): void;\n}\n\nexport interface ISaveCartToOrderTemplateComponent extends IComponent<ISaveCartToOrderTemplateComponentProps> {\n    onClick(): (event: React.MouseEvent<HTMLElement>, props: ISaveCartToOrderTemplateComponentProps, state: ISaveCartToOrderTemplateStateManager) => void;\n}\n\nconst onDismiss = (state: ISaveCartToOrderTemplateStateManager): void => {\n    state.setContent({ color: 'success', showAlert: false });\n};\n\nconst SaveCartToOrderTemplateActions = {\n    onDismiss: onDismiss\n};\n\n// tslint:disable-next-line:max-func-body-length\nconst SaveCartToOrderTemplate: React.FC<ISaveCartToOrderTemplateComponentProps> = (props: ISaveCartToOrderTemplateComponentProps) => {\n    if (!props.data.customerInformation?.IsB2b) {\n        return null;\n    }\n\n    const [chosenOrderTemplate, setChosenOrderTemplate] = useState<ProductList | undefined>(undefined);\n    const [addedProducts, setAddedProducts] = useState<FullProduct[] | undefined>(undefined);\n    const [addToOrderTemplateModalOpen, setAddToOrderTemplateModalOpen] = useState(false);\n    const [linesAddedToOrderTemplateDialogOpen, setLinesAddedToOrderTemplateDialogOpen] = useState(false);\n    const [addedLinesCount, setAddedLinesCount] = useState(0);\n    const [addedItemsCount, setAddedItemsCount] = useState(0);\n\n    const {\n        addToOrderTemplateDialogResources, createOrderTemplateDialogResources,\n        createOrderTemplateFromCartButton\n    } = props;\n\n    const onOrderTemplateSelected = async (orderTemplate: ProductList) => {\n        setChosenOrderTemplate(orderTemplate);\n        const productListLines = props.data.cartLines.map(cartLine => {\n            // tslint:disable-next-line:no-unnecessary-local-variable\n            const productListLineToAdd: ProductListLine = {\n                ProductListId: orderTemplate.Id,\n                ProductId: cartLine.ProductId,\n                Quantity: cartLine.Quantity,\n                UnitOfMeasure: cartLine.UnitOfMeasureSymbol\n            };\n            return productListLineToAdd;\n        });\n\n        const addedLines = await addProductListLinesAsync({ callerContext: props.context.actionContext }, orderTemplate.Id, productListLines);\n        const productInputs: FullProductInput[] = [];\n        addedLines.forEach(listLine => {\n            if (listLine.ProductId) {\n                productInputs.push(new FullProductInput(\n                    listLine.ProductId,\n                    props.context.actionContext.requestContext.apiSettings,\n                    getProductDetailsCriteriaFromActionInput(props.context.actionContext)));\n            }\n        });\n        const products = await getFullProducts(productInputs, props.context.actionContext);\n\n        setAddedLinesCount(addedLines.length);\n        setAddedItemsCount(addedLines.map(line => line.Quantity || 1).reduce((firstQuantity, secondQuantity) => firstQuantity + secondQuantity));\n        setAddedProducts(products);\n\n        setAddToOrderTemplateModalOpen(false);\n        setTimeout(() => {\n            setLinesAddedToOrderTemplateDialogOpen(true);\n        }, 500); // tslint:disable-line:align\n    };\n\n    const onSaveCartToOrderTemplateClick = () => {\n        setAddToOrderTemplateModalOpen(true);\n    };\n\n    return (\n        <React.Fragment>\n            <AddToOrderTemplateDialog\n                className={'msc-add-to-order-template-dialog'}\n                modalOpen={addToOrderTemplateModalOpen}\n                setModalOpen={setAddToOrderTemplateModalOpen}\n                context={props.context}\n                id={props.id}\n                typeName={props.typeName}\n                data={{ orderTemplates: props.data.orderTemplates }}\n                addToOrderTemplateDialogResources={addToOrderTemplateDialogResources}\n                createOrderTemplateDialogResources={createOrderTemplateDialogResources}\n                onOrderTemplateSelected={onOrderTemplateSelected}\n            />\n            {\n                chosenOrderTemplate && addedProducts && <LinesAddedToOrderTemplateDialog\n                    className={'msc-lines-added-to-order-template-dialog'}\n                    id={props.id}\n                    typeName={props.typeName}\n                    context={props.context}\n                    dialogStrings={props.linesAddedToOrderTemplateDialogResources}\n                    data={{\n                        linesCount: addedLinesCount,\n                        itemsCount: addedItemsCount,\n                        orderTemplate: chosenOrderTemplate,\n                        products: addedProducts\n                    }}\n                    modalOpen={linesAddedToOrderTemplateDialogOpen}\n                />\n            }\n            <Button className={'msc-cart__btn-addcarttotemplate'} onClick={onSaveCartToOrderTemplateClick} title={createOrderTemplateFromCartButton}>{createOrderTemplateFromCartButton}</Button>\n        </React.Fragment>\n    );\n};\n\n// @ts-ignore\nexport const SaveCartToOrderTemplateComponent: React.FunctionComponent<ISaveCartToOrderTemplateComponentProps> = msdyn365Commerce.createComponent<ISaveCartToOrderTemplateComponent>(\n    'SaveCartToOrderTemplate',\n    { component: SaveCartToOrderTemplate, ...SaveCartToOrderTemplateActions }\n);"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}