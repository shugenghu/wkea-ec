{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import classnames from'classnames';import{observable}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{Modal,ModalBody}from'@msdyn365-commerce-modules/utilities';import*as Msdyn365 from'@msdyn365-commerce/core';import SignUpButtonComponent from'./components/sign-up-button';import SignUpErrorComponent from'./components/sign-up-error';import SignUpInputComponent from'./components/sign-up-input';import SignUpLabelComponent from'./components/sign-up-label';import SignUpLoadingIconComponent from'./components/sign-up-loading-icon';import SignUpLoadingMessageComponent from'./components/sign-up-loading-message';import SignUpSuccessComponent from'./components/sign-up-success';let SignUp=class SignUp extends React.Component{constructor(props){super(props);this.moduleClassName='ms-sign-up';this.handleHeadingChange=event=>this.props.config.heading.text=event.target.value;this.handleParagraphChange=event=>this.props.config.disclaimer=event.target.value;this._onInit=()=>{this._prePopulateData();this._updateErrorMessage();this.initializationTimer=setInterval(()=>{this._isInitializationSuccessful();},100);setTimeout(()=>{clearInterval(this.initializationTimer);},10000);};this._isInitializationSuccessful=()=>{if(window&&window['$diags']&&window['$diags']['initializationSuccessful']){clearInterval(this.initializationTimer);this.isInitialized=true;}};this._prePopulateData=()=>{const resources=this.props.resources||{};if(window['SA_FIELDS']&&window['SA_FIELDS']['AttributeFields']){window['SA_FIELDS']['AttributeFields'].map(obj=>{switch(obj.ID.toLowerCase()){case'email':{this.emailRegex=obj.PAT;this.isEmailVerificationRequried=obj.VERIFY;break;}case'newpassword':{this.newPasswordRegex=obj.PAT;break;}case'reenterpassword':{this.reenterPasswordRegex=obj.PAT;break;}default:}switch(obj.UX_INPUT_TYPE.toLowerCase()){case'password':{obj.PAT_DESC=resources.invalidPasswordError;break;}case'emailbox':{obj.PAT_DESC=resources.invalidEmailAddressError;break;}default:}});}};this._updateErrorMessage=()=>{const resources=this.props.resources||{};if(window&&window['CONTENT']){const errorMessages={required_field:resources.requiredFieldMissingError};Object.assign(window['CONTENT'],errorMessages);}};const passwordDefaultRegex='^((?=.*[a-z])(?=.*[A-Z])(?=.*\\\\d)|(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9])|(?=.*[a-z])(?=.*\\\\d)(?=.*[^A-Za-z0-9])|(?=.*[A-Z])(?=.*\\\\d)(?=.*[^A-Za-z0-9]))([A-Za-z\\\\d@#$%^&*\\\\-_+=[\\\\]{}|\\\\\\\\:\\',?/`~\\'();!]|\\\\.(?!@)){8,16}$';this.emailRegex='^[a-zA-Z0-9.!#$%&\\'^_`{}~-]+@[a-zA-Z0-9-]+(?:\\\\.[a-zA-Z0-9-]+)*$';this.newPasswordRegex=passwordDefaultRegex;this.reenterPasswordRegex=passwordDefaultRegex;this.isEmailVerificationRequried=false;this.isInitialized=false;}componentDidMount(){this._onInit();}componentDidUpdate(){if(this.isInitialized&&window&&window['$element']&&window['$element']['initialize']){window['$element']['initialize']();}}render(){const{config,resources}=this.props;const viewProps=_objectSpread(_objectSpread({},this.props),{},{viewState:{isShowLoading:!this.isInitialized},signUp:{moduleProps:this.props,className:classnames(this.moduleClassName,config.className)},loading:{modal:{tag:Modal,isOpen:true},modalBody:{tag:ModalBody},icon:/*#__PURE__*/React.createElement(SignUpLoadingIconComponent,{className:this.moduleClassName}),message:/*#__PURE__*/React.createElement(SignUpLoadingMessageComponent,{className:this.moduleClassName,message:resources.loadingMessage})},defaultAADConainer:{id:'api',style:{display:'none'}},aadConainer:{id:this.isInitialized?'api':null,className:\"\".concat(this.moduleClassName,\"__container\")},heading:/*#__PURE__*/React.createElement(Msdyn365.Text,Object.assign({className:\"\".concat(this.moduleClassName,\"__heading\")},config.heading,{editProps:{onEdit:this.handleHeadingChange,requestContext:this.props.context.request}})),signUpLocalAccount:this._renderLocalAccount()});return this.props.renderView(viewProps);}_renderLocalAccount(){const{config,resources}=this.props;return{localAccount:{id:'attributeList',className:\"\".concat(this.moduleClassName,\"__account-items attr\")},items:[this._renderInput('givenName','text',resources.firstNameLabelText,resources.firstNameMaxLength),this._renderInput('surname','text',resources.lastNameLabelText,resources.lastNameMaxLength),this._renderInput('email','email',resources.emailAddressLabelText,undefined,this.emailRegex),this._renderInput('newPassword','password',resources.passwordLabelText,undefined,this.newPasswordRegex),this._renderInput('reenterPassword','password',resources.confirmPasswordLabelText,undefined,this.reenterPasswordRegex)],emailVerification:{isRequired:this.isEmailVerificationRequried,email:this._renderInput('email_ver_input','text',resources.verificationCodeLabelText),buttonWrapper:{className:\"\".concat(this.moduleClassName,\"__email-verification-buttons verify\"),'data-claim_id':'email'},buttons:[/*#__PURE__*/React.createElement(SignUpButtonComponent,{key:'email_ver_but_send',id:'email_ver_but_send',className:\"\".concat(this.moduleClassName,\"__email-verification-button \").concat(this.moduleClassName,\"__verify-email-send-button sendButton\"),ariaLabel:resources.sendCodeButtonAriaLabel,text:resources.sendCodeButtonText}),/*#__PURE__*/React.createElement(SignUpButtonComponent,{key:'email_ver_but_verify',id:'email_ver_but_verify',className:\"\".concat(this.moduleClassName,\"__email-verification-button \").concat(this.moduleClassName,\"__verify-email-verify-button verifyButton\"),ariaLabel:resources.verifyCodeButtonAriaLabel,text:resources.verifyCodeButtonText}),/*#__PURE__*/React.createElement(SignUpButtonComponent,{key:'email_ver_but_resend',id:'email_ver_but_resend',className:\"\".concat(this.moduleClassName,\"__email-verification-button \").concat(this.moduleClassName,\"__verify-email-resend-button sendButton\"),ariaLabel:resources.resendCodeButtonAriaLabel,text:resources.resendCodeButtonText}),/*#__PURE__*/React.createElement(SignUpButtonComponent,{key:'email_ver_but_edit',id:'email_ver_but_edit',className:\"\".concat(this.moduleClassName,\"__email-verification-button \").concat(this.moduleClassName,\"__verify-email-edit-button editButton\"),ariaLabel:resources.changeEmailButtonAriaLabel,text:resources.changeEmailButtonText})],successMessage:[/*#__PURE__*/React.createElement(SignUpSuccessComponent,{key:'email_info',id:'email_info',className:this.moduleClassName,message:resources.verificationCodeSendSuccess}),/*#__PURE__*/React.createElement(SignUpSuccessComponent,{key:'email_success',id:'email_success',className:this.moduleClassName,message:resources.emailAddressVerifiedSuccess})],errorMessage:[/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'email_fail_retry',id:'email_fail_retry',className:this.moduleClassName,message:resources.retryError}),/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'email_fail_no_retry',id:'email_fail_no_retry',className:this.moduleClassName,message:resources.retryNotAllowedError}),/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'email_fail_throttled',id:'email_fail_throttled',className:this.moduleClassName,message:resources.throttledError}),/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'email_fail_code_expired',id:'email_fail_code_expired',className:this.moduleClassName,message:resources.codeExpiredError}),/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'email_fail_server',id:'email_fail_server',className:this.moduleClassName,message:resources.serverError}),/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'email_incorrect_format',id:'email_incorrect_format',className:this.moduleClassName,message:resources.invalidEmailError})]},buttons:[/*#__PURE__*/React.createElement(SignUpButtonComponent,{key:'continue',id:'continue',className:\"\".concat(this.moduleClassName,\"__create-button\"),ariaLabel:resources.signUpButtonArialabel,text:resources.signUpButtonText}),/*#__PURE__*/React.createElement(SignUpButtonComponent,{key:'cancel',id:'cancel',className:\"\".concat(this.moduleClassName,\"__cancel-button\"),ariaLabel:resources.cancelButtonArialabel,text:resources.cancelButtonText})],errorMessage:[/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'passwordEntryMismatch',id:'passwordEntryMismatch',className:this.moduleClassName,message:resources.passwordEntryMismatchError}),/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'requiredFieldMissing',id:'requiredFieldMissing',className:this.moduleClassName,message:resources.requiredFieldMissingSummaryError}),/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'fieldIncorrect',id:'fieldIncorrect',className:this.moduleClassName,message:resources.fieldIncorrectError}),/*#__PURE__*/React.createElement(SignUpErrorComponent,{key:'claimVerificationServerError',id:'claimVerificationServerError',className:this.moduleClassName})],disclaimer:config.disclaimer&&/*#__PURE__*/React.createElement(Msdyn365.RichTextComponent,{className:\"\".concat(this.moduleClassName,\"__sign-up-disclaimer\"),text:config.disclaimer,editProps:{onEdit:this.handleParagraphChange,requestContext:this.props.context.request}})};}_renderInput(id,type,labelText,maxLength,pattern){const className=\"\".concat(this.moduleClassName,\"__account-item\");return{wrapper:{className:classnames(className,\"\".concat(className,\"-\").concat(id),'entry-item','attrEntry')},key:id,label:/*#__PURE__*/React.createElement(SignUpLabelComponent,Object.assign({},{id:id,forId:id,className:className,text:labelText})),errorMessage:/*#__PURE__*/React.createElement(SignUpErrorComponent,Object.assign({},{className:this.moduleClassName,type:'item'})),input:/*#__PURE__*/React.createElement(SignUpInputComponent,Object.assign({},{id:id,type:type,maxLength:maxLength,pattern:pattern,className:className}))};}};__decorate([observable],SignUp.prototype,\"emailRegex\",void 0);__decorate([observable],SignUp.prototype,\"newPasswordRegex\",void 0);__decorate([observable],SignUp.prototype,\"reenterPasswordRegex\",void 0);__decorate([observable],SignUp.prototype,\"isEmailVerificationRequried\",void 0);__decorate([observable],SignUp.prototype,\"isInitialized\",void 0);SignUp=__decorate([observer],SignUp);export default SignUp;","map":{"version":3,"sources":["modules/sign-up/sign-up.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classnames from 'classnames';\nimport { observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport {\n    IModuleProps, INodeProps, Modal, ModalBody\n} from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\n\nimport SignUpButtonComponent from './components/sign-up-button';\nimport SignUpErrorComponent from './components/sign-up-error';\nimport SignUpInputComponent from './components/sign-up-input';\nimport SignUpLabelComponent from './components/sign-up-label';\nimport SignUpLoadingIconComponent from './components/sign-up-loading-icon';\nimport SignUpLoadingMessageComponent from './components/sign-up-loading-message';\nimport SignUpSuccessComponent from './components/sign-up-success';\nimport { ISignUpConfig, ISignUpProps, ISignUpResources } from './sign-up.props.autogenerated';\n\nexport interface ISignUpViewState {\n    isShowLoading: boolean;\n}\n\nexport interface ISignUpItem {\n    wrapper: INodeProps;\n    key: string;\n    label: React.ReactNode;\n    errorMessage: React.ReactNode;\n    input: React.ReactNode;\n}\n\nexport interface ISignUpEmailVerification {\n    isRequired: boolean;\n    email: ISignUpItem;\n    buttonWrapper: INodeProps;\n    buttons: React.ReactNode[];\n    successMessage: React.ReactNode[];\n    errorMessage: React.ReactNode[];\n}\n\nexport interface ISignUpLocalAccount {\n    localAccount: INodeProps;\n    items: ISignUpItem[];\n    emailVerification: ISignUpEmailVerification;\n    buttons: React.ReactNode[];\n    errorMessage: React.ReactNode[];\n    disclaimer: React.ReactNode;\n}\n\nexport interface ISignUpLoading {\n    modal: INodeProps;\n    modalBody: INodeProps;\n    icon: React.ReactNode;\n    message: React.ReactNode;\n}\n\nexport interface ISignUpViewProps {\n    className: string;\n    viewState: ISignUpViewState;\n    loading: ISignUpLoading;\n    signUp: IModuleProps;\n    defaultAADConainer: INodeProps;\n    aadConainer: INodeProps;\n    heading: React.ReactNode;\n    signUpLocalAccount: ISignUpLocalAccount;\n}\n\n/**\n *\n * SignUp component\n * All AAD related module is rendered on AAD page and we need to respect HTML contract provide by AAD.\n * Please ensure any change in module don't break contract with AAD.\n * @extends {React.Component<ISignUpProps<ISignUpConfig>>}\n */\n@observer\nclass SignUp extends React.Component<ISignUpProps<ISignUpConfig>> {\n    private moduleClassName: string = 'ms-sign-up';\n    @observable private emailRegex: string;\n    @observable private newPasswordRegex: string;\n    @observable private reenterPasswordRegex: string;\n    @observable private isEmailVerificationRequried: boolean;\n    @observable private isInitialized: boolean;\n\n    // tslint:disable-next-line:no-any\n    private initializationTimer: any;\n\n    constructor(props: ISignUpProps<ISignUpConfig>) {\n        super(props);\n        // tslint:disable-next-line:max-line-length\n        const passwordDefaultRegex = '^((?=.*[a-z])(?=.*[A-Z])(?=.*\\\\d)|(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9])|(?=.*[a-z])(?=.*\\\\d)(?=.*[^A-Za-z0-9])|(?=.*[A-Z])(?=.*\\\\d)(?=.*[^A-Za-z0-9]))([A-Za-z\\\\d@#$%^&*\\\\-_+=[\\\\]{}|\\\\\\\\:\\',?/`~\\'();!]|\\\\.(?!@)){8,16}$';\n        this.emailRegex = '^[a-zA-Z0-9.!#$%&\\'^_`{}~-]+@[a-zA-Z0-9-]+(?:\\\\.[a-zA-Z0-9-]+)*$';\n        this.newPasswordRegex = passwordDefaultRegex;\n        this.reenterPasswordRegex = passwordDefaultRegex;\n        this.isEmailVerificationRequried = false;\n        this.isInitialized = false;\n    }\n\n    public componentDidMount(): void {\n        this._onInit();\n    }\n\n    // After successful AAD initialization, call initialize method provided by AAD to attach events.\n    public componentDidUpdate(): void {\n        // tslint:disable-next-line:no-string-literal\n        if (this.isInitialized && window && window['$element'] && window['$element']['initialize']) {\n            // tslint:disable-next-line:no-string-literal\n            window['$element']['initialize']();\n        }\n    }\n\n    public render(): JSX.Element {\n        const { config, resources } = this.props;\n\n        const viewProps = {\n            ...this.props,\n            viewState: {\n                isShowLoading: !this.isInitialized\n            },\n            signUp: {\n                moduleProps: this.props,\n                className: classnames(this.moduleClassName, config.className)\n            },\n            loading: {\n                modal: {\n                    tag: Modal,\n                    isOpen: true\n                },\n                modalBody: {\n                    tag: ModalBody\n                },\n                icon: <SignUpLoadingIconComponent className={this.moduleClassName} />,\n                message: <SignUpLoadingMessageComponent className={this.moduleClassName} message={resources.loadingMessage} />,\n            },\n            defaultAADConainer: {\n                id: 'api',\n                style: { display: 'none' }\n            },\n            aadConainer: {\n                id: this.isInitialized ? 'api' : null,\n                className: `${this.moduleClassName}__container`\n            },\n            heading: <Msdyn365.Text className={`${this.moduleClassName}__heading`} {...config.heading} editProps = {{onEdit: this.handleHeadingChange, requestContext: this.props.context.request}} />,\n            signUpLocalAccount: this._renderLocalAccount()\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading.text= event.target.value;\n    public handleParagraphChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.disclaimer = event.target.value;\n\n    public _onInit = () => {\n        this._prePopulateData();\n        this._updateErrorMessage();\n        // Check if AAD initialization is complete. AAD do not provide any event to subscribe so we need to check variable set by AAD to check initialization status.\n        this.initializationTimer = setInterval(() => { this._isInitializationSuccessful(); }, 100);\n        setTimeout(() => { clearInterval(this.initializationTimer); }, 10000);\n    }\n\n    // After successful AAD initialization, remove waiting and preload any data, if needed.\n    private _isInitializationSuccessful = () => {\n        // tslint:disable-next-line:no-string-literal\n        if (window && window['$diags'] && window['$diags']['initializationSuccessful']) {\n            clearInterval(this.initializationTimer);\n            this.isInitialized = true;\n        }\n    }\n\n    private _prePopulateData = () => {\n        const resources: ISignUpResources = this.props.resources || {};\n\n        // tslint:disable-next-line:no-string-literal\n        if (window['SA_FIELDS'] && window['SA_FIELDS']['AttributeFields']) {\n            // tslint:disable-next-line:no-string-literal\n            window['SA_FIELDS']['AttributeFields'].map((obj: { ID: string; PAT: string; UX_INPUT_TYPE: string; PAT_DESC: string; VERIFY: boolean }) => {\n                switch (obj.ID.toLowerCase()) {\n                    case 'email': {\n                        this.emailRegex = obj.PAT;\n                        this.isEmailVerificationRequried = obj.VERIFY;\n                        break;\n                    }\n                    case 'newpassword': {\n                        this.newPasswordRegex = obj.PAT;\n                        break;\n                    }\n                    case 'reenterpassword': {\n                        this.reenterPasswordRegex = obj.PAT;\n                        break;\n                    }\n                    default:\n                }\n\n                switch (obj.UX_INPUT_TYPE.toLowerCase()) {\n                    case 'password': {\n                        obj.PAT_DESC = resources.invalidPasswordError;\n                        break;\n                    }\n                    case 'emailbox': {\n                        obj.PAT_DESC = resources.invalidEmailAddressError;\n                        break;\n                    }\n                    default:\n                }\n            });\n        }\n    }\n\n    private _updateErrorMessage = () => {\n        const resources: ISignUpResources = this.props.resources || {};\n\n        // tslint:disable-next-line:no-string-literal\n        if (window && window['CONTENT']) {\n            const errorMessages = {\n                required_field: resources.requiredFieldMissingError\n            };\n\n            // tslint:disable-next-line:no-string-literal\n            Object.assign(window['CONTENT'], errorMessages);\n        }\n    }\n\n    private _renderLocalAccount(): ISignUpLocalAccount {\n        const { config, resources } = this.props;\n        return {\n            localAccount: {\n                id: 'attributeList',\n                className: `${this.moduleClassName}__account-items attr`\n            },\n            items: [\n                this._renderInput('givenName', 'text', resources.firstNameLabelText, resources.firstNameMaxLength),\n                this._renderInput('surname', 'text', resources.lastNameLabelText, resources.lastNameMaxLength),\n                this._renderInput('email', 'email', resources.emailAddressLabelText, undefined, this.emailRegex),\n                this._renderInput('newPassword', 'password', resources.passwordLabelText, undefined, this.newPasswordRegex),\n                this._renderInput('reenterPassword', 'password', resources.confirmPasswordLabelText, undefined, this.reenterPasswordRegex)\n            ],\n            emailVerification: {\n                isRequired: this.isEmailVerificationRequried,\n                email: this._renderInput('email_ver_input', 'text', resources.verificationCodeLabelText),\n                buttonWrapper: {\n                    className: `${this.moduleClassName}__email-verification-buttons verify`,\n                    'data-claim_id': 'email'\n                },\n                buttons: [\n                    (\n                        <SignUpButtonComponent\n                            key='email_ver_but_send'\n                            id='email_ver_but_send'\n                            className={`${this.moduleClassName}__email-verification-button ${this.moduleClassName}__verify-email-send-button sendButton`}\n                            ariaLabel={resources.sendCodeButtonAriaLabel}\n                            text={resources.sendCodeButtonText}\n                        />\n                    ),\n                    (\n                        <SignUpButtonComponent\n                            key='email_ver_but_verify'\n                            id='email_ver_but_verify'\n                            className={`${this.moduleClassName}__email-verification-button ${this.moduleClassName}__verify-email-verify-button verifyButton`}\n                            ariaLabel={resources.verifyCodeButtonAriaLabel}\n                            text={resources.verifyCodeButtonText}\n                        />\n                    ),\n                    (\n                        <SignUpButtonComponent\n                            key='email_ver_but_resend'\n                            id='email_ver_but_resend'\n                            className={`${this.moduleClassName}__email-verification-button ${this.moduleClassName}__verify-email-resend-button sendButton`}\n                            ariaLabel={resources.resendCodeButtonAriaLabel}\n                            text={resources.resendCodeButtonText}\n                        />\n                    ),\n                    (\n                        <SignUpButtonComponent\n                            key='email_ver_but_edit'\n                            id='email_ver_but_edit'\n                            className={`${this.moduleClassName}__email-verification-button ${this.moduleClassName}__verify-email-edit-button editButton`}\n                            ariaLabel={resources.changeEmailButtonAriaLabel}\n                            text={resources.changeEmailButtonText}\n                        />\n                    )\n                ],\n                successMessage: [\n                    <SignUpSuccessComponent key='email_info' id='email_info' className={this.moduleClassName} message={resources.verificationCodeSendSuccess} />,\n                    <SignUpSuccessComponent key='email_success' id='email_success' className={this.moduleClassName} message={resources.emailAddressVerifiedSuccess} />\n                ],\n                errorMessage: [\n                    <SignUpErrorComponent key='email_fail_retry' id='email_fail_retry' className={this.moduleClassName} message={resources.retryError} />,\n                    <SignUpErrorComponent key='email_fail_no_retry' id='email_fail_no_retry' className={this.moduleClassName} message={resources.retryNotAllowedError} />,\n                    <SignUpErrorComponent key='email_fail_throttled' id='email_fail_throttled' className={this.moduleClassName} message={resources.throttledError} />,\n                    <SignUpErrorComponent key='email_fail_code_expired' id='email_fail_code_expired' className={this.moduleClassName} message={resources.codeExpiredError} />,\n                    <SignUpErrorComponent key='email_fail_server' id='email_fail_server' className={this.moduleClassName} message={resources.serverError} />,\n                    <SignUpErrorComponent key='email_incorrect_format' id='email_incorrect_format' className={this.moduleClassName} message={resources.invalidEmailError} />\n                ]\n            },\n            buttons: [\n                <SignUpButtonComponent key='continue' id='continue' className={`${this.moduleClassName}__create-button`} ariaLabel={resources.signUpButtonArialabel} text={resources.signUpButtonText} />,\n                <SignUpButtonComponent key='cancel' id='cancel' className={`${this.moduleClassName}__cancel-button`} ariaLabel={resources.cancelButtonArialabel} text={resources.cancelButtonText} />\n            ],\n            errorMessage: [\n                <SignUpErrorComponent key='passwordEntryMismatch' id='passwordEntryMismatch' className={this.moduleClassName} message={resources.passwordEntryMismatchError} />,\n                <SignUpErrorComponent key='requiredFieldMissing' id='requiredFieldMissing' className={this.moduleClassName} message={resources.requiredFieldMissingSummaryError} />,\n                <SignUpErrorComponent key='fieldIncorrect' id='fieldIncorrect' className={this.moduleClassName} message={resources.fieldIncorrectError} />,\n                <SignUpErrorComponent key='claimVerificationServerError' id='claimVerificationServerError' className={this.moduleClassName} />\n            ],\n            disclaimer: config.disclaimer && (\n            <Msdyn365.RichTextComponent\n                className={`${this.moduleClassName}__sign-up-disclaimer`}\n                text={config.disclaimer}\n                editProps={{onEdit: this.handleParagraphChange, requestContext: this.props.context.request}}\n            />\n            ),\n        };\n    }\n\n    private _renderInput(id: string, type: string, labelText: string, maxLength?: string, pattern?: string): ISignUpItem {\n        const className = `${this.moduleClassName}__account-item`;\n        return (\n            {\n                wrapper: {\n                    className: classnames(className, `${className}-${id}`, 'entry-item', 'attrEntry')\n                },\n                key: id,\n                label: (\n                    <SignUpLabelComponent\n                        {\n                        ...{\n                            id: id,\n                            forId: id,\n                            className: className,\n                            text: labelText\n                        }\n                        }\n                    />\n                ),\n                errorMessage: (\n                    <SignUpErrorComponent\n                        {\n                        ...{\n                            className: this.moduleClassName,\n                            type: 'item'\n                        }\n                        }\n                    />\n                ),\n                input: (\n                    <SignUpInputComponent\n                        {\n                        ...{\n                            id: id,\n                            type: type,\n                            maxLength: maxLength,\n                            pattern: pattern,\n                            className: className\n                        }\n                        }\n                    />\n                )\n\n            }\n        );\n    }\n}\n\nexport default SignUp;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}