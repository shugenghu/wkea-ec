{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";/*!\r\n * Copyright (c) Microsoft Corporation.\r\n * All rights reserved. See LICENSE in the project root for license information.\r\n */import{createObservableDataAction}from'@msdyn365-commerce/action-internal';import{searchByTextAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import{getProductImageUrls}from'../../utils/product-list-utils';export var getProductsBySearchList=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,context){var searchText;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!input.listMetadata.searchText){_context.next=4;break;}searchText=input.listMetadata.searchText;_context.next=9;break;case 4:if(!(context.requestContext.query&&context.requestContext.query&&context.requestContext.query.q)){_context.next=8;break;}searchText=context.requestContext.query.q;_context.next=9;break;case 8:throw new Error('Search text missing for ProductsBySearch. Query string ?q={searchText} or search text in list meta data must be present.');case 9:return _context.abrupt(\"return\",searchByTextAsync({callerContext:context,queryResultSettings:{Paging:{Top:input.listMetadata.pageSize||10}}},input.channelId,input.catalogId,searchText).then(function(products){context.telemetry.debug('Products returned by productsBySearch action:',products);return getProductImageUrls(products,context.requestContext.apiSettings);})[\"catch\"](function(error){context.telemetry.error(\"Error running productsBySearch action: \".concat(error));throw new Error(error);}));case 10:case\"end\":return _context.stop();}}},_callee);}));return function getProductsBySearchList(_x,_x2){return _ref.apply(this,arguments);};}();export var getProductsBySearchListAction=createObservableDataAction({action:getProductsBySearchList,id:'@msdyn365-commerce/products-by-search'});","map":{"version":3,"sources":["../../../../src/hydrators/product-list-actions/products-by-search.action.ts"],"names":[],"mappings":"uIAAA;;;AAGG,GAEH,OAAS,0BAAT,KAA2C,oCAA3C,CAEA,OAAS,iBAAT,KAAkC,wEAAlC,CAEA,OAAS,mBAAT,KAAoC,gCAApC,CAGA,MAAO,IAAM,CAAA,uBAAuB,0FAAG,iBAAO,KAAP,CAAgC,OAAhC,qIAE/B,KAAK,CAAC,YAAN,CAAmB,UAFY,yBAG/B,UAAU,CAAG,KAAK,CAAC,YAAN,CAAmB,UAAhC,CAH+B,kCAIxB,OAAO,CAAC,cAAR,CAAuB,KAAvB,EAAgC,OAAO,CAAC,cAAR,CAAuB,KAAvD,EAAgE,OAAO,CAAC,cAAR,CAAuB,KAAvB,CAA6B,CAJrE,0BAK/B,UAAU,CAAG,OAAO,CAAC,cAAR,CAAuB,KAAvB,CAA6B,CAA1C,CAL+B,kCAOzB,IAAI,CAAA,KAAJ,CACF,0HADE,CAPyB,wCAY5B,iBAAiB,CACpB,CAAE,aAAa,CAAE,OAAjB,CAA0B,mBAAmB,CAAE,CAAE,MAAM,CAAE,CAAE,GAAG,CAAE,KAAK,CAAC,YAAN,CAAmB,QAAnB,EAA+B,EAAtC,CAAV,CAA/C,CADoB,CAEpB,KAAK,CAAC,SAFc,CAGpB,KAAK,CAAC,SAHc,CAIpB,UAJoB,CAAjB,CAMF,IANE,CAMG,SAAC,QAAD,CAAoC,CACtC,OAAO,CAAC,SAAR,CAAkB,KAAlB,CAAwB,+CAAxB,CAAyE,QAAzE,EACA,MAAO,CAAA,mBAAmB,CAAC,QAAD,CAAW,OAAO,CAAC,cAAR,CAAuB,WAAlC,CAA1B,CACH,CATE,WAUI,SAAA,KAAK,CAAG,CACX,OAAO,CAAC,SAAR,CAAkB,KAAlB,kDAAkE,KAAlE,GACA,KAAM,IAAI,CAAA,KAAJ,CAAU,KAAV,CAAN,CACH,CAbE,CAZ4B,yDAAH,kBAAvB,CAAA,uBAAuB,gDAA7B,CA4BP,MAAO,IAAM,CAAA,6BAA6B,CAAG,0BAA0B,CAAC,CACpE,MAAM,CAAkC,uBAD4B,CAEpE,EAAE,CAAE,uCAFgE,CAAD,CAAhE","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport { createObservableDataAction } from '@msdyn365-commerce/action-internal';\nimport { IAction, IActionContext } from '@msdyn365-commerce/core-internal';\nimport { searchByTextAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { ProductSearchResult } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { getProductImageUrls } from '../../utils/product-list-utils';\nimport { ProductListInput } from '../hydrator-action-inputs';\n\nexport const getProductsBySearchList = async (input: ProductListInput, context: IActionContext): Promise<ProductSearchResult[]> => {\n    let searchText: string;\n    if (input.listMetadata.searchText) {\n        searchText = input.listMetadata.searchText;\n    } else if (context.requestContext.query && context.requestContext.query && context.requestContext.query.q) {\n        searchText = context.requestContext.query.q;\n    } else {\n        throw new Error(\n            'Search text missing for ProductsBySearch. Query string ?q={searchText} or search text in list meta data must be present.'\n        );\n    }\n\n    return searchByTextAsync(\n        { callerContext: context, queryResultSettings: { Paging: { Top: input.listMetadata.pageSize || 10 } } },\n        input.channelId,\n        input.catalogId,\n        searchText\n    )\n        .then((products: ProductSearchResult[]) => {\n            context.telemetry.debug('Products returned by productsBySearch action:', products);\n            return getProductImageUrls(products, context.requestContext.apiSettings);\n        })\n        .catch(error => {\n            context.telemetry.error(`Error running productsBySearch action: ${error}`);\n            throw new Error(error);\n        });\n};\n\nexport const getProductsBySearchListAction = createObservableDataAction({\n    action: <IAction<ProductSearchResult[]>>getProductsBySearchList,\n    id: '@msdyn365-commerce/products-by-search'\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}