{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{getOrderTemplates,GetOrderTemplatesInput,QueryResultSettingsProxy}from'..';import{getPaginatedOrderTemplateLinesAction,GetPaginatedOrderTemplateLinesInput}from'..';import{OrderTemplate}from'../utilities/order-templates';/**\r\n *  Input class for the GetOrderTemplates data action\r\n */export class GetFullOrderTemplateInput{constructor(orderTemplateId,queryResultSettings){this.getCacheKey=()=>\"GetFullOrderTemplate|\".concat(this.orderTemplateId);this.getCacheObjectType=()=>'GetFullOrderTemplate';this.dataCacheType=()=>'none';this.orderTemplateId=orderTemplateId;this.queryResultSettings=queryResultSettings;}}/**\r\n * createInput method for the GetOrderTemplate method\r\n * @param inputData The input data passed to the createInput method.\r\n */export const createGetFullOrderTemplateInput=(inputData,orderTemplateId)=>{const{requestContext}=inputData;if(!requestContext.user.isAuthenticated){throw new Error('Unable to get full order templates. User is not authenticated.');}const queryResultSettings=QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings;queryResultSettings.count=true;return new GetFullOrderTemplateInput(orderTemplateId,queryResultSettings);};/**\r\n * The action method for the GetFullOrderTemplate data action\r\n * @param input The action input\r\n * @param ctx The action context\r\n */export async function getFullOrderTemplateAction(input,ctx){if(!ctx.requestContext.user.isAuthenticated){throw new Error('Unable to get full order template. User is not authenticated.');}const inputParams=new GetOrderTemplatesInput(input.orderTemplateId);const productLists=await getOrderTemplates(inputParams,ctx);if(!productLists||productLists.length!==1){throw new Error('Unable to get full order template. Order template was not found.');}const inputLines=new GetPaginatedOrderTemplateLinesInput(productLists[0].Id,input.queryResultSettings);const linesState=await getPaginatedOrderTemplateLinesAction(inputLines,ctx);return new OrderTemplate(productLists[0],linesState.lines,linesState.totalCount);}/**\r\n * The GetFullOrderTemplate Data Action\r\n * Returns order templates\r\n */export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/order-templates/get-full-order-template',action:getFullOrderTemplateAction,input:createGetFullOrderTemplateInput});","map":{"version":3,"sources":["../../../src/order-templates/get-full-order-template.ts"],"names":[],"mappings":"sCAAA,OACI,0BADJ,KAKgC,yBALhC,CAQA,OAAS,iBAAT,CAA4B,sBAA5B,CAAoD,wBAApD,KAAoF,IAApF,CACA,OAAS,oCAAT,CAA+C,mCAA/C,KAA0F,IAA1F,CACA,OAAS,aAAT,KAA8B,8BAA9B,CAEA;;AAEG,GACH,MAAM,MAAO,CAAA,yBAAyB,CAIlC,WAAA,CAAY,eAAZ,CAAqC,mBAArC,CAA8E,CAKvE,KAAA,WAAA,CAAc,mCAA8B,KAAK,eAAnC,CAAd,CACA,KAAA,kBAAA,CAAqB,IAAM,sBAA3B,CACA,KAAA,aAAA,CAAgB,IAAiB,MAAjC,CANH,KAAK,eAAL,CAAuB,eAAvB,CACA,KAAK,mBAAL,CAA2B,mBAA3B,CACH,CAPiC,CActC;;;AAGG,GACH,MAAO,MAAM,CAAA,+BAA+B,CAAG,CAAC,SAAD,CAAkC,eAAlC,GAAwF,CACnI,KAAM,CAAE,cAAF,EAAqB,SAA3B,CACA,GAAI,CAAC,cAAc,CAAC,IAAf,CAAoB,eAAzB,CAA0C,CACtC,KAAM,IAAI,CAAA,KAAJ,CAAU,gEAAV,CAAN,CACH,CACD,KAAM,CAAA,mBAAmB,CAAyB,wBAAwB,CAAC,aAAzB,CAAuC,SAAvC,EAAkD,mBAApG,CACA,mBAAmB,CAAC,KAApB,CAA4B,IAA5B,CAEA,MAAO,IAAI,CAAA,yBAAJ,CAA8B,eAA9B,CAA+C,mBAA/C,CAAP,CACH,CATM,CAWP;;;;AAIG,GACH,MAAO,eAAe,CAAA,0BAAf,CAA0C,KAA1C,CAA4E,GAA5E,CAA+F,CAClG,GAAI,CAAC,GAAG,CAAC,cAAJ,CAAmB,IAAnB,CAAwB,eAA7B,CAA8C,CAC1C,KAAM,IAAI,CAAA,KAAJ,CAAU,+DAAV,CAAN,CACH,CAED,KAAM,CAAA,WAAW,CAAG,GAAI,CAAA,sBAAJ,CAA2B,KAAK,CAAC,eAAjC,CAApB,CACA,KAAM,CAAA,YAAY,CAAkB,KAAM,CAAA,iBAAiB,CAAC,WAAD,CAAc,GAAd,CAA3D,CAEA,GAAI,CAAC,YAAD,EAAiB,YAAY,CAAC,MAAb,GAAwB,CAA7C,CAAgD,CAC5C,KAAM,IAAI,CAAA,KAAJ,CAAU,kEAAV,CAAN,CACH,CAED,KAAM,CAAA,UAAU,CAAG,GAAI,CAAA,mCAAJ,CAAwC,YAAY,CAAC,CAAD,CAAZ,CAAgB,EAAxD,CAA4D,KAAK,CAAC,mBAAlE,CAAnB,CACA,KAAM,CAAA,UAAU,CAAG,KAAM,CAAA,oCAAoC,CAAC,UAAD,CAAa,GAAb,CAA7D,CACA,MAAO,IAAI,CAAA,aAAJ,CAAkB,YAAY,CAAC,CAAD,CAA9B,CAAmC,UAAU,CAAC,KAA9C,CAAqD,UAAU,CAAC,UAAhE,CAAP,CACH,CAED;;;AAGG,GACH,cAAe,CAAA,0BAA0B,CAAgB,CACrD,EAAE,CAAE,mFADiD,CAErD,MAAM,CAA0B,0BAFqB,CAGrD,KAAK,CAAE,+BAH8C,CAAhB,CAAzC","sourcesContent":["import { CacheType,\n    createObservableDataAction,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICreateActionContext } from '@msdyn365-commerce/core';\nimport { IQueryResultSettings } from '@msdyn365-commerce/retail-proxy';\nimport { ProductList } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { getOrderTemplates, GetOrderTemplatesInput, QueryResultSettingsProxy } from '..';\nimport { getPaginatedOrderTemplateLinesAction, GetPaginatedOrderTemplateLinesInput } from '..';\nimport { OrderTemplate } from '../utilities/order-templates';\n\n/**\n *  Input class for the GetOrderTemplates data action\n */\nexport class GetFullOrderTemplateInput implements IActionInput {\n    public orderTemplateId: string;\n    public queryResultSettings: IQueryResultSettings;\n\n    constructor(orderTemplateId: string, queryResultSettings: IQueryResultSettings) {\n        this.orderTemplateId = orderTemplateId;\n        this.queryResultSettings = queryResultSettings;\n    }\n\n    public getCacheKey = () => `GetFullOrderTemplate|${this.orderTemplateId}`;\n    public getCacheObjectType = () => 'GetFullOrderTemplate';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * createInput method for the GetOrderTemplate method\n * @param inputData The input data passed to the createInput method.\n */\nexport const createGetFullOrderTemplateInput = (inputData: ICreateActionContext, orderTemplateId: string): GetFullOrderTemplateInput => {\n    const { requestContext } = inputData;\n    if (!requestContext.user.isAuthenticated) {\n        throw new Error('Unable to get full order templates. User is not authenticated.');\n    }\n    const queryResultSettings: IQueryResultSettings = QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings;\n    queryResultSettings.count = true;\n\n    return new GetFullOrderTemplateInput(orderTemplateId, queryResultSettings);\n};\n\n/**\n * The action method for the GetFullOrderTemplate data action\n * @param input The action input\n * @param ctx The action context\n */\nexport async function getFullOrderTemplateAction(input: GetFullOrderTemplateInput, ctx: IActionContext): Promise<OrderTemplate> {\n    if (!ctx.requestContext.user.isAuthenticated) {\n        throw new Error('Unable to get full order template. User is not authenticated.');\n    }\n\n    const inputParams = new GetOrderTemplatesInput(input.orderTemplateId);\n    const productLists: ProductList[] = await getOrderTemplates(inputParams, ctx);\n\n    if (!productLists || productLists.length !== 1) {\n        throw new Error('Unable to get full order template. Order template was not found.');\n    }\n\n    const inputLines = new GetPaginatedOrderTemplateLinesInput(productLists[0].Id, input.queryResultSettings);\n    const linesState = await getPaginatedOrderTemplateLinesAction(inputLines, ctx);\n    return new OrderTemplate(productLists[0], linesState.lines, linesState.totalCount);\n}\n\n/**\n * The GetFullOrderTemplate Data Action\n * Returns order templates\n */\nexport default createObservableDataAction<OrderTemplate>({\n    id: '@msdyn365-commerce-modules/retail-actions/order-templates/get-full-order-template',\n    action: <IAction<OrderTemplate>>getFullOrderTemplateAction,\n    input: createGetFullOrderTemplateInput\n});"],"sourceRoot":""},"metadata":{},"sourceType":"module"}