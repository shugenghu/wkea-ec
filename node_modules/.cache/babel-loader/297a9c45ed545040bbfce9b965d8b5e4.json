{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import{getRnrEndpointId,getRnrPartnerId,getSelectedProductIdFromActionInput}from'@msdyn365-commerce-modules/retail-actions';import{createObservableDataAction,sendRequest}from'@msdyn365-commerce/core';import{GetProductReviewsInput}from'./inputs/get-product-reviews-input';export const createInputForProductReviews=input=>{const productId=getSelectedProductIdFromActionInput(input);if(productId){return new GetProductReviewsInput(productId,getRnrPartnerId(input),input.requestContext.locale,getRnrEndpointId(input));}throw new Error('[GetProductReviews] Not all necessary parameters found while creating Input for GetProductReviewsApi');};export async function getReviewsForGivenProduct(input,ctx){if(!inputIsValid(input)){throw new Error(\"[GetProductReviews] Invalid input. ProductId = \".concat(input.productId,\", TenantId = \").concat(input.tenantId,\", localeListFilter = \").concat(input.localeListFilter));}let requestUrl=\"\".concat(input.serviceEndpoint,\"/v2.0/reviews/product/\").concat(input.productId)+\"?tenantId=\".concat(input.tenantId)+\"&localeListFilter=\".concat(input.localeListFilter)+\"&pageSize=\".concat(input.pageSize)+\"&orderBy=\".concat(input.orderBy)+\"&skipItems=\".concat(input.skipItems);if(input.starFilters!==undefined&&input.starFilters.length>0){requestUrl=\"\".concat(requestUrl,\"&starFilters=\").concat(input.starFilters);}if(input.pageToken!==null){requestUrl=\"\".concat(requestUrl,\"&pageToken=\").concat(input.pageToken);}return sendRequest(requestUrl,'get').then(response=>{if(response.data&&response.data.items&&response.data.items.length>0){return{items:response.data.items.filter(i=>!i.isTakenDown),pagingInfo:response.data.pagingInfo};}ctx.trace(\"[GetProductReviews] No reviews found for this product.\");return response.data;}).catch(error=>{ctx.trace(\"[GetProductReviews] Failed to get reviews for product\");ctx.telemetry.exception(error);ctx.telemetry.debug(\"[GetProductReviews] Failed to get reviews for product\");throw error;});}function inputIsValid(input){return input&&input.productId.length>0&&input.tenantId.length>0&&input.localeListFilter.length>0&&input.pageSize>0;}export default createObservableDataAction({id:'@msdyn365-commerce-modules/ratings-reviews/get-product-reviews',action:getReviewsForGivenProduct,input:createInputForProductReviews});","map":{"version":3,"sources":["actions/get-product-reviews.ts"],"names":[],"mappings":"sCAKA,OAAS,gBAAT,CAA2B,eAA3B,CAA4C,mCAA5C,KAAuF,2CAAvF,CAEA,OAAS,0BAAT,CAAkH,WAAlH,KAAqI,yBAArI,CACA,OAAS,sBAAT,KAAuC,oCAAvC,CAKA,MAAO,MAAM,CAAA,4BAA4B,CAAI,KAAD,EAA8D,CACtG,KAAM,CAAA,SAAS,CAAG,mCAAmC,CAAC,KAAD,CAArD,CACA,GAAI,SAAJ,CAAe,CAEX,MAAO,IAAI,CAAA,sBAAJ,CAA2B,SAA3B,CAAsC,eAAe,CAAC,KAAD,CAArD,CAA8D,KAAK,CAAC,cAAN,CAAqB,MAAnF,CAA2F,gBAAgB,CAAC,KAAD,CAA3G,CAAP,CACH,CACD,KAAM,IAAI,CAAA,KAAJ,CAAU,sGAAV,CAAN,CACH,CAPM,CASP,MAAO,eAAe,CAAA,yBAAf,CAAyC,KAAzC,CAAwE,GAAxE,CAA2F,CAC9F,GAAI,CAAC,YAAY,CAAC,KAAD,CAAjB,CAA0B,CACtB,KAAM,IAAI,CAAA,KAAJ,0DACgD,KAAK,CAAC,SADtD,yBAC+E,KAAK,CAAC,QADrF,iCACqH,KAAK,CAAC,gBAD3H,EAAN,CAGH,CACD,GAAI,CAAA,UAAU,CACV,UAAG,KAAK,CAAC,eAAT,kCAAiD,KAAK,CAAC,SAAvD,sBACa,KAAK,CAAC,QADnB,8BAEqB,KAAK,CAAC,gBAF3B,sBAGa,KAAK,CAAC,QAHnB,qBAIY,KAAK,CAAC,OAJlB,uBAKc,KAAK,CAAC,SALpB,CADJ,CAQA,GAAI,KAAK,CAAC,WAAN,GAAsB,SAAtB,EAAmC,KAAK,CAAC,WAAN,CAAkB,MAAlB,CAA2B,CAAlE,CAAqE,CACjE,UAAU,WAAM,UAAN,yBAAgC,KAAK,CAAC,WAAtC,CAAV,CACH,CAED,GAAI,KAAK,CAAC,SAAN,GAAoB,IAAxB,CAA8B,CAC1B,UAAU,WAAM,UAAN,uBAA8B,KAAK,CAAC,SAApC,CAAV,CACH,CACD,MAAO,CAAA,WAAW,CAAU,UAAV,CAAsB,KAAtB,CAAX,CACF,IADE,CACG,QAAQ,EAAG,CACb,GAAI,QAAQ,CAAC,IAAT,EAAiB,QAAQ,CAAC,IAAT,CAAc,KAA/B,EAAwC,QAAQ,CAAC,IAAT,CAAc,KAAd,CAAoB,MAApB,CAA6B,CAAzE,CAA4E,CACxE,MAAO,CACH,KAAK,CAAE,QAAQ,CAAC,IAAT,CAAc,KAAd,CAAoB,MAApB,CAA2B,CAAC,EAAI,CAAC,CAAC,CAAC,WAAnC,CADJ,CAEH,UAAU,CAAE,QAAQ,CAAC,IAAT,CAAc,UAFvB,CAAP,CAIH,CACD,GAAG,CAAC,KAAJ,2DACA,MAAO,CAAA,QAAQ,CAAC,IAAhB,CACH,CAVE,EAWF,KAXE,CAWI,KAAK,EAAG,CACX,GAAG,CAAC,KAAJ,0DACA,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,GAAG,CAAC,SAAJ,CAAc,KAAd,0DACA,KAAM,CAAA,KAAN,CACH,CAhBE,CAAP,CAiBH,CAED,QAAS,CAAA,YAAT,CAAsB,KAAtB,CAAmD,CAC/C,MAAO,CAAA,KAAK,EAAI,KAAK,CAAC,SAAN,CAAgB,MAAhB,CAAyB,CAAlC,EAAuC,KAAK,CAAC,QAAN,CAAe,MAAf,CAAwB,CAA/D,EAAoE,KAAK,CAAC,gBAAN,CAAuB,MAAvB,CAAgC,CAApG,EAAyG,KAAK,CAAC,QAAN,CAAiB,CAAjI,CACH,CAED,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,gEADkC,CAEtC,MAAM,CAAoB,yBAFY,CAGtC,KAAK,CAAE,4BAH+B,CAAD,CAAzC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getRnrEndpointId, getRnrPartnerId, getSelectedProductIdFromActionInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { Reviews } from '@msdyn365-commerce/commerce-entities';\nimport { createObservableDataAction, IAction, IActionContext, IActionInput, IAny, ICreateActionContext, IGeneric, sendRequest } from '@msdyn365-commerce/core';\nimport { GetProductReviewsInput } from './inputs/get-product-reviews-input';\n\n/**\n * TODO: Use this function to create the input required to make the API call\n */\nexport const createInputForProductReviews = (input: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    const productId = getSelectedProductIdFromActionInput(input);\n    if (productId) {\n        // Task #211227597 Remove these hardcoded values.\n        return new GetProductReviewsInput(productId, getRnrPartnerId(input), input.requestContext.locale, getRnrEndpointId(input));\n    }\n    throw new Error('[GetProductReviews] Not all necessary parameters found while creating Input for GetProductReviewsApi');\n};\n\nexport async function getReviewsForGivenProduct(input: GetProductReviewsInput, ctx: IActionContext): Promise<Reviews> {\n    if (!inputIsValid(input)) {\n        throw new Error(\n            `[GetProductReviews] Invalid input. ProductId = ${input.productId}, TenantId = ${input.tenantId}, localeListFilter = ${input.localeListFilter}`\n        );\n    }\n    let requestUrl =\n        `${input.serviceEndpoint}/v2.0/reviews/product/${input.productId}` +\n        `?tenantId=${input.tenantId}` +\n        `&localeListFilter=${input.localeListFilter}` +\n        `&pageSize=${input.pageSize}` +\n        `&orderBy=${input.orderBy}` +\n        `&skipItems=${input.skipItems}`;\n\n    if (input.starFilters !== undefined && input.starFilters.length > 0) {\n        requestUrl = `${requestUrl}&starFilters=${input.starFilters}`;\n    }\n\n    if (input.pageToken !== null) {\n        requestUrl = `${requestUrl}&pageToken=${input.pageToken}`;\n    }\n    return sendRequest<Reviews>(requestUrl, 'get')\n        .then(response => {\n            if (response.data && response.data.items && response.data.items.length > 0) {\n                return {\n                    items: response.data.items.filter(i => !i.isTakenDown),\n                    pagingInfo: response.data.pagingInfo\n                };\n            }\n            ctx.trace(`[GetProductReviews] No reviews found for this product.`);\n            return response.data;\n        })\n        .catch(error => {\n            ctx.trace(`[GetProductReviews] Failed to get reviews for product`);\n            ctx.telemetry.exception(error);\n            ctx.telemetry.debug(`[GetProductReviews] Failed to get reviews for product`);\n            throw error;\n        });\n}\n\nfunction inputIsValid(input: GetProductReviewsInput): boolean {\n    return input && input.productId.length > 0 && input.tenantId.length > 0 && input.localeListFilter.length > 0 && input.pageSize > 0;\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/ratings-reviews/get-product-reviews',\n    action: <IAction<Reviews>>getReviewsForGivenProduct,\n    input: createInputForProductReviews\n});\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}