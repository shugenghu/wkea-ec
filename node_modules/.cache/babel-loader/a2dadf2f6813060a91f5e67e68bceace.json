{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{buildCacheKey,QueryResultSettingsProxy}from'@msdyn365-commerce-modules/retail-actions';import{convertToString}from'@msdyn365-commerce/retail-proxy';import{toJS}from'mobx';import{hydrateRefinersFromUrl}from'./url-utils';function getIncludeAttributes(inputData){if(inputData&&inputData.config&&inputData.config.includeAttributes!==undefined&&inputData.config.includeAttributes===true){return true;}return false;}export class BaseCollectionInput{constructor(pageType,apiSettings,queryResultSettings,refiners,category,searchText,includeAttributes,locale){this.getCacheKey=()=>{const queryResultSettings=_objectSpread(_objectSpread({},this.queryResultSettings.Paging),toJS(this.queryResultSettings.Sorting));const cacheKey=buildCacheKey(\"\".concat(this.pageType,\"-\").concat(this.locale,\"-\").concat(this.category||this.searchText,\"-\").concat(this.refiners.map(refiner=>\"\".concat(refiner.RefinerRecordId+(refiner.LeftValueBoundString||'')+(refiner.RightValueBoundString||''),\"-\")),\"-\").concat(convertToString(queryResultSettings)),this.apiSettings,this.locale);return cacheKey;};this.getCacheObjectType=()=>'CollectionActionResult';this.dataCacheType=()=>'request';this.pageType=pageType;this.apiSettings=apiSettings;this.category=category;this.searchText=searchText;this.queryResultSettings=queryResultSettings;this.refiners=refiners;this.includeAttributes=includeAttributes;this.locale=locale;}}export const createBaseCollectionInput=(args,inputClassConstuctor)=>{const pageType=args.requestContext.urlTokens.pageType==='Category'||args.requestContext.query&&args.requestContext.query.categoryId?'Category':'Search';const queryResultSettings=QueryResultSettingsProxy.fromInputData(args).QueryResultSettings;const queryRefiners=hydrateRefinersFromUrl(args.requestContext);const includeAttributes=getIncludeAttributes(args);if(args.requestContext.query&&args.requestContext.query.sorting){queryResultSettings.Sorting={Columns:JSON.parse(decodeURIComponent(args.requestContext.query.sorting))};}if(pageType==='Category'){return new inputClassConstuctor(pageType,args.requestContext.apiSettings,queryResultSettings,queryRefiners,+(args.requestContext.urlTokens.itemId||args.requestContext.query&&args.requestContext.query.categoryId||0),undefined,includeAttributes,args.requestContext.locale);}else if(pageType==='Search'&&args.requestContext.query&&args.requestContext.query.q){return new inputClassConstuctor(pageType,args.requestContext.apiSettings,queryResultSettings,queryRefiners,undefined,args.requestContext.query.q,includeAttributes,args.requestContext.locale);}else if(pageType==='Search'&&args.requestContext.query&&args.requestContext.query.productId){return new inputClassConstuctor(pageType,args.requestContext.apiSettings,queryResultSettings,queryRefiners,undefined,args.requestContext.query.productId,includeAttributes,args.requestContext.locale);}throw new Error('[getFullProductsForCollection]Unable to create input');};","map":{"version":3,"sources":["modules/search-result-container/actions/base-collection-action.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport {\n    buildCacheKey,\n    QueryResultSettingsProxy\n} from '@msdyn365-commerce-modules/retail-actions';\nimport {\n    CacheType,\n    IActionInput,\n    IAny,\n    ICommerceApiSettings,\n    ICreateActionContext,\n    IGeneric\n} from '@msdyn365-commerce/core';\nimport { convertToString, IQueryResultSettings, ProductRefinerValue, SortColumn } from '@msdyn365-commerce/retail-proxy';\nimport { toJS } from 'mobx';\nimport { hydrateRefinersFromUrl } from './url-utils';\n\nexport type listPageType = 'Category' | 'Search' | 'Unknown';\n\n/**\n * Get include attributes from config.\n */\nfunction getIncludeAttributes(inputData: ICreateActionContext<IGeneric<IAny>, IGeneric<IAny>>): boolean {\n    if (inputData &&\n        inputData.config &&\n        inputData.config.includeAttributes !== undefined &&\n        inputData.config.includeAttributes === true) {\n        return true;\n    }\n    return false;\n}\n\n/**\n * BaseCollection Action Input\n */\nexport class BaseCollectionInput implements IActionInput {\n    public pageType: listPageType;\n    public category: number | undefined;\n    public searchText: string | undefined;\n    public refiners: ProductRefinerValue[];\n    public queryResultSettings: IQueryResultSettings;\n    public apiSettings: ICommerceApiSettings;\n    public includeAttributes:boolean | undefined;\n    public locale?:string;\n\n    constructor(\n        pageType: listPageType,\n        apiSettings: ICommerceApiSettings,\n        queryResultSettings: IQueryResultSettings,\n        refiners: ProductRefinerValue[],\n        category: number | undefined,\n        searchText: string | undefined,\n        includeAttributes: boolean |undefined,\n        locale?: string\n    ) {\n        this.pageType = pageType;\n        this.apiSettings = apiSettings;\n        this.category = category;\n        this.searchText = searchText;\n        this.queryResultSettings = queryResultSettings;\n        this.refiners = refiners;\n        this.includeAttributes=includeAttributes;\n        this.locale = locale;\n    }\n    public getCacheKey = () => {\n        const queryResultSettings = {\n            ...this.queryResultSettings.Paging,\n            ...toJS(this.queryResultSettings.Sorting)\n        };\n        // tslint:disable       \n        const cacheKey = buildCacheKey(\n            `${this.pageType}-${this.locale}-${this.category || this.searchText}-${this.refiners.map(refiner => `${refiner.RefinerRecordId + (refiner.LeftValueBoundString || '') + (refiner.RightValueBoundString || '')}-`)}-${convertToString(queryResultSettings)}`,\n            this.apiSettings, this.locale\n        );      \n        return cacheKey;\n    }\n   \n    public getCacheObjectType = () => 'CollectionActionResult';\n    public dataCacheType = (): CacheType => 'request';\n}\n\n\n// TODO: Create a data model here or import one to capture the response of the action\nexport interface IGetFullProductsByCollectionData {\n    text: string;\n}\n\nexport type CollectionClassConstructor = new (\n    pageType: listPageType,\n    apiSettings: ICommerceApiSettings,\n    queryResultSettings: IQueryResultSettings,\n    refiners: ProductRefinerValue[],\n    category: number | undefined,\n    searchText: string | undefined,\n    includeAttributes: boolean | undefined,\n    locale?: string\n) => BaseCollectionInput;\n\n/**\n * TODO: Use this function to create the input required to make the action call\n */\nexport const createBaseCollectionInput = (\n    args: ICreateActionContext,\n    inputClassConstuctor: CollectionClassConstructor\n): BaseCollectionInput => {\n    const pageType =\n        args.requestContext.urlTokens.pageType === 'Category' || (args.requestContext.query && args.requestContext.query.categoryId)\n            ? 'Category'\n            : 'Search';\n\n    const queryResultSettings = QueryResultSettingsProxy.fromInputData(args).QueryResultSettings;\n    const queryRefiners = hydrateRefinersFromUrl(args.requestContext);\n    const includeAttributes=getIncludeAttributes(args);\n   \n    if(args.requestContext.query && args.requestContext.query.sorting) {\n        queryResultSettings.Sorting = { Columns: <SortColumn[]>JSON.parse(decodeURIComponent(args.requestContext.query.sorting)) };\n    }\n\n    if (pageType === 'Category') {\n        return new inputClassConstuctor(\n            pageType,\n            args.requestContext.apiSettings,\n            queryResultSettings,\n            queryRefiners,\n            +(args.requestContext.urlTokens.itemId || (args.requestContext.query && args.requestContext.query.categoryId) || 0),\n            undefined,\n            includeAttributes,\n            args.requestContext.locale\n        );\n    } else if (pageType === 'Search' && args.requestContext.query && args.requestContext.query.q) {\n        return new inputClassConstuctor(\n            pageType,\n            args.requestContext.apiSettings,\n            queryResultSettings,\n            queryRefiners,\n            undefined,\n            args.requestContext.query.q,\n            includeAttributes,\n            args.requestContext.locale\n        )\n    } else if (pageType === 'Search' && args.requestContext.query && args.requestContext.query.productId) {\n        return new inputClassConstuctor(\n            pageType,\n            args.requestContext.apiSettings,\n            queryResultSettings,\n            queryRefiners,\n            undefined,\n            args.requestContext.query.productId,\n            includeAttributes,\n            args.requestContext.locale\n        );\n    }\n\n    throw new Error('[getFullProductsForCollection]Unable to create input');\n};"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}