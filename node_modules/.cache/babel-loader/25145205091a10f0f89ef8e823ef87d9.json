{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{getSelectedProductIdFromActionInput,getSelectedVariant,SelectedVariantInput}from'@msdyn365-commerce-modules/retail-actions';import{getAttributeValuesAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';export var AttributesForSelectedVariantInput=function AttributesForSelectedVariantInput(productId,channelId,selectedProduct,catalogId){_classCallCheck(this,AttributesForSelectedVariantInput);this.getCacheKey=function(){return\"AttributesForSelectedVariant\";};this.getCacheObjectType=function(){return'ProductAttributeValue';};this.dataCacheType=function(){return'none';};this.productId=productId;this.channelId=channelId;this.selectedProduct=selectedProduct;this.catalogId=catalogId||0;};export var createAttributesForSelectedVariantInput=function createAttributesForSelectedVariantInput(inputData){var productId=getSelectedProductIdFromActionInput(inputData);if(productId){return new AttributesForSelectedVariantInput(+productId,+inputData.requestContext.apiSettings.channelId);}else{throw new Error('Unable to create PriceForSelectedVariantInput, no productId found on module config or query');}};export function getAttributesForSelectedVariantAction(_x,_x2){return _getAttributesForSelectedVariantAction.apply(this,arguments);}function _getAttributesForSelectedVariantAction(){_getAttributesForSelectedVariantAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",Promise.resolve().then(function(){var activeProduct=input.selectedProduct;if(!activeProduct){var selectedVariantInput=new SelectedVariantInput(input.productId,input.channelId);return getSelectedVariant(selectedVariantInput,ctx);}return activeProduct;}).then(function(productResult){var activeProduct=productResult;if(activeProduct){return getAttributeValuesAsync({callerContext:ctx,queryResultSettings:{}},activeProduct.RecordId,input.channelId,input.catalogId);}return null;}).then(function(attributeValues){var resultArray=attributeValues;if(resultArray){return resultArray;}return[];})[\"catch\"](function(error){ctx.trace(error.message);throw new Error('[getPriceForSelectedVariantAction]Error executing action');}));case 1:case\"end\":return _context.stop();}}},_callee);}));return _getAttributesForSelectedVariantAction.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/product-info/get-attributes-for-selected-variant',action:getAttributesForSelectedVariantAction,input:createAttributesForSelectedVariantInput});","map":{"version":3,"sources":["dataActions/get-attributes-for-selected-variant.ts"],"names":[],"mappings":"8MAAA,OAAoB,0BAApB,KAAmI,yBAAnI,CAGA,OAAS,mCAAT,CAA8C,kBAA9C,CAAkE,oBAAlE,KAA8F,2CAA9F,CACA,OAAS,uBAAT,KAAwC,wEAAxC,CAKA,UAAa,CAAA,iCAAb,CAMI,2CAAY,SAAZ,CAA+B,SAA/B,CAAkD,eAAlD,CAAmF,SAAnF,CAAqG,yDAO9F,KAAA,WAAA,CAAc,iDAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,uBAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,MAAjB,EAAhB,CARH,KAAK,SAAL,CAAiB,SAAjB,CACA,KAAK,SAAL,CAAiB,SAAjB,CACA,KAAK,eAAL,CAAuB,eAAvB,CACA,KAAK,SAAL,CAAiB,SAAS,EAAI,CAA9B,CACH,CAXL,CAkBA,MAAO,IAAM,CAAA,uCAAuC,CAAG,QAA1C,CAAA,uCAA0C,CAAC,SAAD,CAAuF,CAC1I,GAAM,CAAA,SAAS,CAAG,mCAAmC,CAAC,SAAD,CAArD,CAEA,GAAI,SAAJ,CAAe,CACX,MAAO,IAAI,CAAA,iCAAJ,CAAsC,CAAC,SAAvC,CAAkD,CAAC,SAAS,CAAC,cAAV,CAAyB,WAAzB,CAAqC,SAAxF,CAAP,CACH,CAFD,IAEO,CACH,KAAM,IAAI,CAAA,KAAJ,CAAU,6FAAV,CAAN,CACH,CACJ,CARM,CAaP,eAAsB,CAAA,qCAAtB,8E,iJAAO,iBACH,KADG,CAEH,GAFG,kJAKI,OAAO,CAAC,OAAR,GAAkB,IAAlB,CAAuB,UAAK,CAC/B,GAAM,CAAA,aAAa,CAA6B,KAAK,CAAC,eAAtD,CAEA,GAAI,CAAC,aAAL,CAAoB,CAChB,GAAM,CAAA,oBAAoB,CAAG,GAAI,CAAA,oBAAJ,CAAyB,KAAK,CAAC,SAA/B,CAA0C,KAAK,CAAC,SAAhD,CAA7B,CAEA,MAAO,CAAA,kBAAkB,CAAC,oBAAD,CAAuB,GAAvB,CAAzB,CACH,CAED,MAAO,CAAA,aAAP,CACH,CAVM,EAUJ,IAVI,CAU0B,SAAC,aAAD,CAAwC,CACrE,GAAM,CAAA,aAAa,CAAwD,aAA3E,CAEA,GAAI,aAAJ,CAAmB,CACf,MAAO,CAAA,uBAAuB,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAsB,mBAAmB,CAAE,EAA3C,CAAD,CAAkD,aAAa,CAAC,QAAhE,CAA0E,KAAK,CAAC,SAAhF,CAA2F,KAAK,CAAC,SAAjG,CAA9B,CACH,CAED,MAAO,KAAP,CACH,CAlBM,EAkBJ,IAlBI,CAkBC,SAAC,eAAD,CAA6C,CACjD,GAAM,CAAA,WAAW,CAAqB,eAAtC,CACA,GAAI,WAAJ,CAAiB,CACb,MAAO,CAAA,WAAP,CACH,CAED,MAAO,EAAP,CACH,CAzBM,WAyBE,SAAC,KAAD,CAAiB,CACtB,GAAG,CAAC,KAAJ,CAAU,KAAK,CAAC,OAAhB,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,0DAAV,CAAN,CACH,CA5BM,CALJ,wD,wEAoCP,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,6EADkC,CAEtC,MAAM,CAA6B,qCAFG,CAGtC,KAAK,CAAE,uCAH+B,CAAD,CAAzC","sourcesContent":["import { CacheType, createObservableDataAction, IAction, IActionContext, IActionInput, IAny, ICreateActionContext, IGeneric } from '@msdyn365-commerce/core';\nimport { AttributeValue, SimpleProduct } from '@msdyn365-commerce/retail-proxy';\n\nimport { getSelectedProductIdFromActionInput, getSelectedVariant, SelectedVariantInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { getAttributeValuesAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\n\n/**\n * Chains getting the SelectedVariant with GetActivePrice\n */\nexport class AttributesForSelectedVariantInput implements IActionInput {\n    public productId: number;\n    public channelId: number;\n    public catalogId: number;\n    public selectedProduct: SimpleProduct | undefined;\n\n    constructor(productId: number, channelId: number, selectedProduct?: SimpleProduct, catalogId?: number) {\n        this.productId = productId;\n        this.channelId = channelId;\n        this.selectedProduct = selectedProduct;\n        this.catalogId = catalogId || 0;\n    }\n\n    public getCacheKey = () => `AttributesForSelectedVariant`;\n    public getCacheObjectType = () => 'ProductAttributeValue';\n    public dataCacheType = (): CacheType => 'none';\n}\n\nexport const createAttributesForSelectedVariantInput = (inputData: ICreateActionContext<IGeneric<IAny>>): AttributesForSelectedVariantInput => {\n    const productId = getSelectedProductIdFromActionInput(inputData);\n\n    if (productId) {\n        return new AttributesForSelectedVariantInput(+productId, +inputData.requestContext.apiSettings.channelId);\n    } else {\n        throw new Error('Unable to create PriceForSelectedVariantInput, no productId found on module config or query');\n    }\n};\n\n/**\n * Calls the Retail API a get a list of dimension values for a given product.\n */\nexport async function getAttributesForSelectedVariantAction(\n    input: AttributesForSelectedVariantInput,\n    ctx: IActionContext\n): Promise<AttributeValue[]> {\n    // @ts-ignore: Promise vs. ObservablePromise typing conflict\n    return Promise.resolve().then(() => {\n        const activeProduct:SimpleProduct | undefined = input.selectedProduct;\n\n        if (!activeProduct) {\n            const selectedVariantInput = new SelectedVariantInput(input.productId, input.channelId);\n\n            return getSelectedVariant(selectedVariantInput, ctx);\n        }\n\n        return activeProduct;\n    }).then<AttributeValue[] | null>((productResult: SimpleProduct | null) => {\n        const activeProduct:SimpleProduct | undefined = <SimpleProduct | undefined>productResult;\n\n        if (activeProduct) {\n            return getAttributeValuesAsync({ callerContext: ctx, queryResultSettings: {} }, activeProduct.RecordId, input.channelId, input.catalogId);\n        }\n\n        return null;\n    }).then((attributeValues: AttributeValue[] | null) => {\n        const resultArray = <AttributeValue[]>attributeValues;\n        if (resultArray) {\n            return resultArray;\n        }\n\n        return [];\n    }).catch((error: Error) => {\n        ctx.trace(error.message);\n        throw new Error('[getPriceForSelectedVariantAction]Error executing action');\n    });\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/product-info/get-attributes-for-selected-variant',\n    action: <IAction<AttributeValue[]>>getAttributesForSelectedVariantAction,\n    input: createAttributesForSelectedVariantInput\n});\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}