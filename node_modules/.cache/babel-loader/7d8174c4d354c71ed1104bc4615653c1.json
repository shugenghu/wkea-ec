{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import{getUrlSync}from'@msdyn365-commerce/core';import checkout from'./checkout';import emptyActiveCart from'./empty-active-cart';export default/*#__PURE__*/(function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx,checkoutState,orderedProducts,redirect){var salesOrder,orderConfirmationUrl,separator,url,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return checkout(ctx);case 3:salesOrder=_context.sent;_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);throw _context.t0;case 9:_context.prev=9;_context.next=12;return emptyActiveCart(ctx);case 12:_context.next=17;break;case 14:_context.prev=14;_context.t1=_context[\"catch\"](9);throw _context.t1;case 17:if(!redirect){_context.next=26;break;}orderConfirmationUrl=getUrlSync('orderConfirmation',ctx)||'';if(orderConfirmationUrl){_context.next=21;break;}throw new Error('Error: No orderConfirmationUrl');case 21:separator=orderConfirmationUrl.includes('?')?'&':'?';url=\"\".concat(orderConfirmationUrl).concat(separator,\"transactionId=\").concat(salesOrder.Id);window.location.assign(url);_context.next=35;break;case 26:if(!checkoutState){_context.next=34;break;}_context.next=29;return checkoutState.updateSalesOrder({newSalesOrder:salesOrder,newOrderedProducts:orderedProducts||[]});case 29:result=_context.sent;if(!(result.status==='FAILED')){_context.next=32;break;}throw new Error('Error: Updating error state failed');case 32:_context.next=35;break;case 34:throw new Error('Error: No checkout state');case 35:case\"end\":return _context.stop();}}},_callee,null,[[0,6],[9,14]]);}));return function(_x,_x2,_x3,_x4){return _ref.apply(this,arguments);};})();","map":{"version":3,"sources":["modules/checkout/methods/place-order.ts"],"names":[],"mappings":"uIAIA,OAAS,UAAT,KAA2C,yBAA3C,CAGA,MAAO,CAAA,QAAP,KAAqB,YAArB,CACA,MAAO,CAAA,eAAP,KAA4B,qBAA5B,CAEA,wGAAe,iBAAO,GAAP,CAA4B,aAA5B,CAAuE,eAAvE,CAAqH,QAArH,iNAKY,CAAA,QAAQ,CAAC,GAAD,CALpB,QAKP,UALO,6JAYD,CAAA,eAAe,CAAC,GAAD,CAZd,wHAiBP,QAjBO,0BAmBD,oBAnBC,CAmBsB,UAAU,CAAC,mBAAD,CAAsB,GAAtB,CAAV,EAAwC,EAnB9D,IAoBF,oBApBE,+BAqBG,IAAI,CAAA,KAAJ,CAAU,gCAAV,CArBH,SAwBD,SAxBC,CAwBW,oBAAoB,CAAC,QAArB,CAA8B,GAA9B,EAAqC,GAArC,CAA2C,GAxBtD,CAyBD,GAzBC,WAyBQ,oBAzBR,SAyB+B,SAzB/B,0BAyByD,UAAU,CAAC,EAzBpE,EA0BP,MAAM,CAAC,QAAP,CAAgB,MAAhB,CAAuB,GAAvB,EA1BO,mCA4BH,aA5BG,iDA6BkB,CAAA,aAAa,CAAC,gBAAd,CAA+B,CAAE,aAAa,CAAE,UAAjB,CAA6B,kBAAkB,CAAE,eAAe,EAAI,EAApE,CAA/B,CA7BlB,SA6BG,MA7BH,oBA+BC,MAAM,CAAC,MAAP,GAAkB,QA/BnB,gCAgCO,IAAI,CAAA,KAAJ,CAAU,oCAAV,CAhCP,6CAmCG,IAAI,CAAA,KAAJ,CAAU,0BAAV,CAnCH,4EAAf","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getUrlSync, IActionContext } from '@msdyn365-commerce/core';\nimport { ICheckoutState } from '@msdyn365-commerce/global-state';\nimport { SalesOrder, SimpleProduct } from '@msdyn365-commerce/retail-proxy';\nimport checkout from './checkout';\nimport emptyActiveCart from './empty-active-cart';\n\nexport default async (ctx: IActionContext, checkoutState: ICheckoutState | undefined, orderedProducts: SimpleProduct[] | undefined, redirect: boolean) => {\n    let salesOrder: SalesOrder;\n\n    // Proceed checkout\n    try {\n        salesOrder = await checkout(ctx);\n    } catch (error) {\n        throw error;\n    }\n\n    // Remove purchased items from the active cart\n    try {\n        await emptyActiveCart(ctx);\n    } catch (error) {\n        throw error;\n    }\n\n    if (redirect) {\n        // Redirect to the order confirmation page\n        const orderConfirmationUrl = getUrlSync('orderConfirmation', ctx) || '';\n        if (!orderConfirmationUrl) {\n            throw new Error('Error: No orderConfirmationUrl');\n        }\n\n        const separator = orderConfirmationUrl.includes('?') ? '&' : '?';\n        const url = `${orderConfirmationUrl}${separator}transactionId=${salesOrder.Id}`;\n        window.location.assign(url);\n    } else {\n        if (checkoutState) {\n            const result = await checkoutState.updateSalesOrder({ newSalesOrder: salesOrder, newOrderedProducts: orderedProducts || [] });\n\n            if (result.status === 'FAILED') {\n                throw new Error('Error: Updating error state failed');\n            }\n        } else {\n            throw new Error('Error: No checkout state');\n        }\n    }\n};\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}