{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";import _get from\"lodash/get\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import{addItemToOrderTemplate,AddItemToOrderTemplateInput,getDimensionsForSelectedVariant,GetDimensionsForSelectedVariantInput,getSelectedVariant,SelectedVariantInput}from'@msdyn365-commerce-modules/retail-actions';import{Button,Modal,ModalBody}from'@msdyn365-commerce-modules/utilities';import{searchByCriteriaAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import{computed}from'mobx';import React from'react';import{NotFoundComponent,ProductConfiguration,ProductList}from'./';var CONTENT;(function(CONTENT){CONTENT[CONTENT[\"Search\"]=0]=\"Search\";CONTENT[CONTENT[\"ProductList\"]=1]=\"ProductList\";CONTENT[CONTENT[\"ProductConfiguration\"]=2]=\"ProductConfiguration\";CONTENT[CONTENT[\"NotFound\"]=3]=\"NotFound\";CONTENT[CONTENT[\"Error\"]=4]=\"Error\";CONTENT[CONTENT[\"Loading\"]=5]=\"Loading\";})(CONTENT||(CONTENT={}));export var AddLineToTemplate=/*#__PURE__*/function(_React$Component){_inherits(AddLineToTemplate,_React$Component);var _super=_createSuper(AddLineToTemplate);function AddLineToTemplate(props){var _this;_classCallCheck(this,AddLineToTemplate);_this=_super.call(this,props);_this.state={isOpen:false,query:'',products:[],content:CONTENT.Search,selectedProduct:null};_this.defaultImageSettings={viewports:{xs:{q:\"w=64&h=64&m=6\",w:0,h:0},lg:{q:\"w=64&h=64&m=6\",w:0,h:0},xl:{q:\"w=64&h=64&m=6\",w:0,h:0}},lazyload:true};_this.searchTextInput=/*#__PURE__*/React.createRef();_this._onSearchSubmit=function(event){event.preventDefault();var query=_get(_assertThisInitialized(_this),'searchTextInput.current.value',null);if(!query){return;}_this.setState({content:CONTENT.Loading});_this._getSearchResults(query).then(function(result){if(result.length===0){_this.setState({content:CONTENT.NotFound});}else{_this.setState({products:result,content:CONTENT.ProductList});}})[\"catch\"](function(error){_this.setState({content:CONTENT.Error});});};_this._onQuantityChangeHandler=function(event){_this.setState({selectedQuantity:+event.target.value});};_this._onSelectItem=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(product){var _this$props$context,actionContext,channelId,varianteInput,productVariant,dimensions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props$context=_this.props.context,actionContext=_this$props$context.actionContext,channelId=_this$props$context.request.apiSettings.channelId;varianteInput=new SelectedVariantInput(product.RecordId,channelId,[]);_context.next=4;return getSelectedVariant(varianteInput,actionContext);case 4:productVariant=_context.sent;if(productVariant){_context.next=8;break;}_this.props.context.telemetry.error('Error retrieving product variant');return _context.abrupt(\"return\");case 8:_context.next=10;return _this._getProductDimensions(product);case 10:dimensions=_context.sent;_this.setState({selectedProductDimensions:dimensions,content:CONTENT.ProductConfiguration,selectedProduct:productVariant});case 12:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this._onInputChange=function(event){_this.setState({query:event.target.value});};_this._onBackButtonClickHandler=function(){console.log('on back button');_this.setState({content:CONTENT.ProductList});};_this._highlightSearchTerm=function(name){var parsedName=name&&unescape(name.replace(new RegExp(_this.state.query,'i'),'<span>$&</span>'));return/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__product__name',dangerouslySetInnerHTML:{__html:parsedName||''}});};_this._addItemToTemplateHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(config){var _this$props,orderTemplateId,actionContext,input,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props=_this.props,orderTemplateId=_this$props.orderTemplateId,actionContext=_this$props.context.actionContext;input=new AddItemToOrderTemplateInput(orderTemplateId,config.product.RecordId,config.quantity,config.product.DefaultUnitOfMeasure||'ea');_context2.next=4;return addItemToOrderTemplate(input,actionContext);case 4:result=_context2.sent;_this.setState({reloadPage:true});return _context2.abrupt(\"return\",result);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this._toggleModalHandler=function(){_this.setState({isOpen:!_this.state.isOpen,content:CONTENT.Search});if(_this.state.reloadPage){window.location.reload();_this.setState({reloadPage:false});}};return _this;}_createClass(AddLineToTemplate,[{key:\"onComponentDidMount\",value:function onComponentDidMount(){var _this$searchTextInput;(_this$searchTextInput=this.searchTextInput.current)===null||_this$searchTextInput===void 0?void 0:_this$searchTextInput.focus();}},{key:\"onComponentDidUpdate\",value:function onComponentDidUpdate(){var _this$searchTextInput2;(_this$searchTextInput2=this.searchTextInput.current)===null||_this$searchTextInput2===void 0?void 0:_this$searchTextInput2.focus();}},{key:\"render\",value:function render(){var _this$props$resources=this.props.resources,addLineModalLinkText=_this$props$resources.addLineModalLinkText,searchButtonAriaLabel=_this$props$resources.searchButtonAriaLabel,searchInputAriaLabel=_this$props$resources.searchInputAriaLabel,searchModalPlaceholderText=_this$props$resources.searchModalPlaceholderText;var modalProps=_objectSpread(_objectSpread({},this.props),{},{className:'msc-add-line-to-template',toggle:this._toggleModalHandler,isOpen:this.state.isOpen});return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Modal,Object.assign({},modalProps),/*#__PURE__*/React.createElement(\"div\",{className:'msc-modal__header'},this.showBackArrow&&/*#__PURE__*/React.createElement(\"button\",{type:'button',className:'msc-modal__back-button',\"aria-label\":'Back to search results',onClick:this._onBackButtonClickHandler}),/*#__PURE__*/React.createElement(\"h5\",{className:'msc-modal__title'},addLineModalLinkText),/*#__PURE__*/React.createElement(\"button\",{type:'button',className:'msc-modal__close-button',\"aria-label\":'Close',onClick:this._toggleModalHandler})),/*#__PURE__*/React.createElement(ModalBody,null,/*#__PURE__*/React.createElement(\"form\",{className:'msc-add-line-to-template__search-form',\"aria-label\":searchButtonAriaLabel,name:'add-line-to-template-search-form',role:'form',autoComplete:'off',onSubmit:this._onSearchSubmit},/*#__PURE__*/React.createElement(\"input\",{type:'text',autoFocus:true,\"aria-label\":searchInputAriaLabel,className:'msc-form-control msc-add-line-to-template__search-input',placeholder:searchModalPlaceholderText,value:this.state.query,onChange:this._onInputChange,ref:this.searchTextInput}),/*#__PURE__*/React.createElement(\"button\",{className:'msc-add-line-to-template__search-button',\"aria-label\":'Add To Template Search Button',color:'primary'})),this._renderContent())),/*#__PURE__*/React.createElement(Button,{className:'msc-add-line-to-template__button',\"aria-label\":addLineModalLinkText,onClick:this._toggleModalHandler},/*#__PURE__*/React.createElement(\"span\",null),addLineModalLinkText));}},{key:\"_renderContent\",value:function _renderContent(){switch(this.state.content){case CONTENT.ProductConfiguration:var _this$state=this.state,selectedProduct=_this$state.selectedProduct,selectedProductDimensions=_this$state.selectedProductDimensions;var viewProps=_objectSpread(_objectSpread({},this.props),{},{imageSettings:this.props.imageSettings||this.defaultImageSettings,product:selectedProduct,dimensions:selectedProductDimensions,addToTemplateHandler:this._addItemToTemplateHandler,onQuantityChangeHandler:this._onQuantityChangeHandler,highlightSearchTerm:this._highlightSearchTerm});return/*#__PURE__*/React.createElement(ProductConfiguration,Object.assign({},viewProps));case CONTENT.ProductList:var productProps=_objectSpread(_objectSpread({},this.props),{},{imageSettings:this.props.imageSettings||this.defaultImageSettings,clickHandler:this._onSelectItem,products:this.state.products,highlightSearchTerm:this._highlightSearchTerm});return/*#__PURE__*/React.createElement(ProductList,Object.assign({},productProps));case CONTENT.Loading:return/*#__PURE__*/React.createElement(Loader,{msg:this.props.resources.progressNotificationText});case CONTENT.NotFound:var _this$props$resources2=this.props.resources,notFoundSearchErrorNotice=_this$props$resources2.notFoundSearchErrorNotice,notFoundSearchErrorRedediation=_this$props$resources2.notFoundSearchErrorRedediation;return/*#__PURE__*/React.createElement(NotFoundComponent,{error:notFoundSearchErrorNotice,msg:notFoundSearchErrorRedediation});case CONTENT.Error:return/*#__PURE__*/React.createElement(\"div\",{className:'msc-alert-danger'},this.props.resources.searchErrorMessage);default:return null;}}},{key:\"_getSearchResults\",value:function _getSearchResults(searchText){var _this$props$context2=this.props.context,actionContext=_this$props$context2.actionContext,_this$props$context2$=_this$props$context2.request.apiSettings,channelId=_this$props$context2$.channelId,catalogId=_this$props$context2$.catalogId;var searchCriteriaInput={};searchCriteriaInput.Context={ChannelId:channelId,CatalogId:catalogId};searchCriteriaInput.IncludeAttributes=true;searchCriteriaInput.SearchCondition=searchText;return searchByCriteriaAsync({callerContext:actionContext},searchCriteriaInput);}},{key:\"_getProductDimensions\",value:function(){var _getProductDimensions2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(product){var _this$props$context3,actionContext,channelId,id;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this$props$context3=this.props.context,actionContext=_this$props$context3.actionContext,channelId=_this$props$context3.request.apiSettings.channelId;id=product.MasterProductId?product.MasterProductId:product.RecordId;return _context3.abrupt(\"return\",getDimensionsForSelectedVariant(new GetDimensionsForSelectedVariantInput(id,channelId,[]),actionContext));case 3:case\"end\":return _context3.stop();}}},_callee3,this);}));function _getProductDimensions(_x3){return _getProductDimensions2.apply(this,arguments);}return _getProductDimensions;}()},{key:\"showBackArrow\",get:function get(){return this.state.content===CONTENT.ProductConfiguration;}}]);return AddLineToTemplate;}(React.Component);__decorate([computed],AddLineToTemplate.prototype,\"showBackArrow\",null);var Loader=function Loader(props){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__loading__icon'}),/*#__PURE__*/React.createElement(\"div\",{className:'msc-add-line-to-template__loading__msg'},props.msg));};","map":{"version":3,"sources":["modules/order-template/components/add-line/add-line.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n    addItemToOrderTemplate,\n    AddItemToOrderTemplateInput,\n    getDimensionsForSelectedVariant,\n    GetDimensionsForSelectedVariantInput,\n    getSelectedVariant,\n    SelectedVariantInput\n} from '@msdyn365-commerce-modules/retail-actions';\nimport { Button, Modal, ModalBody } from '@msdyn365-commerce-modules/utilities';\nimport { ProductDimensionFull } from '@msdyn365-commerce/commerce-entities';\nimport { ICoreContext, IImageSettings } from '@msdyn365-commerce/core';\nimport { ProductListLine, ProductSearchCriteria, ProductSearchResult } from '@msdyn365-commerce/retail-proxy';\nimport { searchByCriteriaAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { get } from 'lodash';\nimport { computed } from 'mobx';\nimport React from 'react';\nimport { IProductConfigurationState, NotFoundComponent, ProductConfiguration, ProductList } from './';\n\nexport interface IAddLineToTemplateProps {\n    context: ICoreContext;\n    resources: IAddLineToTemplateResources;\n    orderTemplateId: string;\n    imageSettings?: IImageSettings;\n}\n\nexport interface IAddLineToTemplateResources {\n    addLineModalLinkText: string;\n    searchButtonAriaLabel: string;\n    searchInputAriaLabel: string;\n    searchModalPlaceholderText: string;\n    selectProductButtonText: string;\n    addItemToTemplateText: string;\n    addLineProductUnitPricePrefix: string;\n    backButtonText: string;\n    decrementButtonAriaLabel: string;\n    incrementButtonAriaLabel: string;\n    quantitySelectLabel: string;\n    addLineProductUnitOfMeasurePrefix: string;\n    notFoundSearchErrorNotice: string;\n    notFoundSearchErrorRedediation: string;\n    searchErrorMessage: string;\n    productDimensionTypeColor: string;\n    productDimensionTypeConfiguration: string;\n    productDimensionTypeSize: string;\n    productDimensionTypeStyle: string;\n    searchResultsCountVerbage: string;\n    searchResultsCountSubject: string;\n    addToTemplateConfirmation: string;\n    totalPriceLabel: string;\n    progressNotificationText: string;\n    addToTemplateError: string;\n}\n\nenum CONTENT {\n    Search,\n    ProductList,\n    ProductConfiguration,\n    NotFound,\n    Error,\n    Loading\n}\n\ninterface IAddLineToTemplateState {\n    isOpen: boolean;\n    query: string;\n    products: ProductSearchResult[];\n    content: number;\n    selectedProduct: SimpleProduct | null;\n    selectedProductDimensions?: ProductDimensionFull[];\n    selectedQuantity?: number;\n    reloadPage?: boolean;\n}\n\n/**\n * Add Lines to order template\n */\nexport class AddLineToTemplate extends React.Component<IAddLineToTemplateProps, IAddLineToTemplateState> {\n    public state: IAddLineToTemplateState = {\n        isOpen: false,\n        query: '',\n        products: [],\n        content: CONTENT.Search,\n        selectedProduct: null,\n    };\n    public defaultImageSettings: IImageSettings = {\n        viewports: {\n            xs: { q: `w=64&h=64&m=6`, w: 0, h: 0 },\n            lg: { q: `w=64&h=64&m=6`, w: 0, h: 0 },\n            xl: { q: `w=64&h=64&m=6`, w: 0, h: 0 }\n        },\n        lazyload: true\n    };\n    public searchTextInput: React.RefObject<HTMLInputElement> = React.createRef();// @TODO public/private\n\n    constructor(props: IAddLineToTemplateProps) {\n        super(props);\n    }\n\n    public onComponentDidMount(): void {\n        this.searchTextInput.current?.focus();\n    }\n\n    public onComponentDidUpdate(): void {\n        this.searchTextInput.current?.focus();\n    }\n\n    // @ts-ignore\n    @computed get showBackArrow(): boolean {\n        return this.state.content === CONTENT.ProductConfiguration;\n    }\n\n    public render(): JSX.Element {\n        const {\n            resources: { addLineModalLinkText, searchButtonAriaLabel, searchInputAriaLabel, searchModalPlaceholderText }\n         } = this.props;\n\n        const modalProps = {\n             ...this.props,\n            className: 'msc-add-line-to-template',\n            toggle: this._toggleModalHandler,\n            isOpen: this.state.isOpen\n        };\n\n        return (\n            <>\n                <Modal {...modalProps}>\n                    <div className='msc-modal__header'>\n                    {this.showBackArrow && <button\n                        type='button'\n                        className='msc-modal__back-button'\n                        aria-label='Back to search results'\n                        onClick={this._onBackButtonClickHandler}\n                    />}<h5 className='msc-modal__title'>{addLineModalLinkText}\n                    </h5><button\n                        type='button'\n                        className='msc-modal__close-button'\n                        aria-label='Close'\n                        onClick={this._toggleModalHandler}\n                    />\n                    </div>\n                    <ModalBody>\n                        <form\n                            className='msc-add-line-to-template__search-form'\n                            aria-label={searchButtonAriaLabel}\n                            name='add-line-to-template-search-form'\n                            role='form'\n                            autoComplete='off'\n                            onSubmit={this._onSearchSubmit}\n                        >\n                            <input\n                                type='text'\n                                autoFocus\n                                aria-label={searchInputAriaLabel}\n                                className={'msc-form-control msc-add-line-to-template__search-input'}\n                                placeholder={searchModalPlaceholderText}\n                                value={this.state.query}\n                                onChange={this._onInputChange}\n                                ref={this.searchTextInput}\n                            />\n                            <button\n                                className={'msc-add-line-to-template__search-button'}\n                                aria-label={'Add To Template Search Button'}\n                                color={'primary'}\n                            />\n                        </form>\n                        {this._renderContent()}\n                    </ModalBody>\n                </Modal>\n                <Button className={'msc-add-line-to-template__button'} aria-label={addLineModalLinkText} onClick={this._toggleModalHandler}><span/>{addLineModalLinkText}</Button>\n            </>\n        );\n    }\n\n    private _onSearchSubmit = (event: React.FormEvent): void => {\n        event.preventDefault();\n\n        const query = get(this, 'searchTextInput.current.value', null);\n\n        if (!query) {\n            return;\n        }\n\n        this.setState({\n            content: CONTENT.Loading,\n        });\n\n        this._getSearchResults(query)\n            .then(result => {\n                if (result.length === 0) {\n                    this.setState({\n                        content: CONTENT.NotFound,\n                    });\n                } else {\n                    this.setState({\n                        products: result,\n                        content: CONTENT.ProductList,\n                    });\n                }\n            })\n            .catch(error => {\n                this.setState({\n                    content: CONTENT.Error,\n                });\n            });\n    };\n\n    private _onQuantityChangeHandler = (event: React.ChangeEvent<HTMLInputElement>) => {\n        this.setState({\n            selectedQuantity: +event.target.value\n        });\n    }\n\n    private _onSelectItem = async (product: ProductSearchResult): Promise<void> => {\n        const {\n            actionContext,\n            request: { apiSettings: { channelId } }\n        } = this.props.context;\n        const varianteInput = new SelectedVariantInput(product.RecordId, channelId, []);\n        const productVariant = await getSelectedVariant(varianteInput, actionContext);\n\n        if (!productVariant) {\n            this.props.context.telemetry.error('Error retrieving product variant');\n            return;\n        }\n\n        const dimensions = await this._getProductDimensions(product as SimpleProduct);\n\n        this.setState({\n            selectedProductDimensions: dimensions,\n            content: CONTENT.ProductConfiguration,\n            selectedProduct: productVariant\n        });\n    };\n\n    private _onInputChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n        this.setState({\n            query: event.target.value\n        });\n    };\n\n    private _onBackButtonClickHandler = (): void => {\n        console.log('on back button');\n        this.setState({\n            content: CONTENT.ProductList\n        });\n    }\n\n    private _highlightSearchTerm = (name: string) => {\n        const parsedName = name && unescape(name.replace(new RegExp(this.state.query, 'i'), '<span>$&</span>'));\n        // tslint:disable-next-line:react-no-dangerous-html\n        return <div className='msc-add-line-to-template__product__name' dangerouslySetInnerHTML={{__html: parsedName || ''}}/>;\n    };\n\n    private _renderContent(): React.ReactNode | null {\n        switch (this.state.content) {\n            case CONTENT.ProductConfiguration:\n                const { selectedProduct, selectedProductDimensions } = this.state;\n                const viewProps = {\n                    ...this.props,\n                    imageSettings: this.props.imageSettings || this.defaultImageSettings,\n                    product: selectedProduct!,\n                    dimensions: selectedProductDimensions!,\n                    addToTemplateHandler: this._addItemToTemplateHandler,\n                    onQuantityChangeHandler: this._onQuantityChangeHandler,\n                    highlightSearchTerm: this._highlightSearchTerm\n                };\n                return <ProductConfiguration {...viewProps}/>;\n\n            case CONTENT.ProductList:\n                const productProps = {\n                    ...this.props,\n                    imageSettings: this.props.imageSettings || this.defaultImageSettings,\n                    clickHandler: this._onSelectItem,\n                    products: this.state.products,\n                    highlightSearchTerm: this._highlightSearchTerm\n                };\n\n                return <ProductList {...productProps}/>;\n\n            case CONTENT.Loading:\n                return <Loader msg={this.props.resources.progressNotificationText}/>;\n\n            case CONTENT.NotFound:\n                const { notFoundSearchErrorNotice, notFoundSearchErrorRedediation } = this.props.resources;\n\n                return <NotFoundComponent error={notFoundSearchErrorNotice} msg={notFoundSearchErrorRedediation}/>;\n\n            case CONTENT.Error:\n                return <div className='msc-alert-danger'>{this.props.resources.searchErrorMessage}</div>;\n\n            default:\n                return null;\n        }\n    }\n\n    // tslint:disable-next-line:no-any\n    private _addItemToTemplateHandler = async (config: IProductConfigurationState): Promise<ProductListLine> => {\n        const { orderTemplateId, context: { actionContext } } = this.props;\n        const input = new AddItemToOrderTemplateInput(\n            orderTemplateId,\n            config.product.RecordId,\n            config.quantity,\n            config.product.DefaultUnitOfMeasure || 'ea'\n        );\n\n        const result = await addItemToOrderTemplate(input, actionContext);\n\n        this.setState({\n            reloadPage: true\n        });\n\n        return result;\n    }\n\n    private _getSearchResults(searchText: string): Promise<ProductSearchResult[]> {\n        const {\n            context: {\n                actionContext,\n                request: {\n                    apiSettings: { channelId, catalogId }\n                }\n            }\n        } = this.props;\n        const searchCriteriaInput: ProductSearchCriteria = {};\n\n        searchCriteriaInput.Context = {\n            ChannelId: channelId,\n            CatalogId: catalogId\n        };\n        searchCriteriaInput.IncludeAttributes = true;\n        searchCriteriaInput.SearchCondition = searchText;\n\n        return searchByCriteriaAsync({ callerContext: actionContext }, searchCriteriaInput);\n    }\n\n    private async _getProductDimensions(product: SimpleProduct): Promise<ProductDimensionFull[]> {\n        const {\n            context: {\n                actionContext,\n                request: {\n                    apiSettings: { channelId }\n                }\n            }\n        } = this.props;\n        const id = product.MasterProductId ? product.MasterProductId : product.RecordId;\n\n        return getDimensionsForSelectedVariant(\n            new GetDimensionsForSelectedVariantInput(id, channelId, []),\n            actionContext\n        );\n    }\n\n    private _toggleModalHandler = () => {\n        this.setState({\n            isOpen: !this.state.isOpen,\n            content: CONTENT.Search\n        });\n\n        if (this.state.reloadPage) {\n            window.location.reload();\n            this.setState({\n                reloadPage: false\n            });\n        }\n\n    };\n}\n\nconst Loader = (props: { msg: string }) => (\n    <>\n        <div className='msc-add-line-to-template__loading__icon'/>\n        <div className='msc-add-line-to-template__loading__msg'>{props.msg}</div>\n    </>\n);\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}