{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/es.regexp.to-string.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import{generateImageUrl}from'@msdyn365-commerce-modules/retail-actions';import{getPayloadObject,getTelemetryAttributes,getTelemetryObject,Module,Node,onTelemetryClick}from'@msdyn365-commerce-modules/utilities';import{Image}from'@msdyn365-commerce/core';import classnames from'classnames';import*as React from'react';export class NavigationMenuView extends React.PureComponent{constructor(props){super(props);this.supportedLevel=3;this.currentLevel=0;this._updateCategoryImage=categoryImage=>()=>{this.setState({categoryImage:categoryImage!==''?categoryImage:'empty'});};this._handleDropdownToggle=(data,parentId)=>()=>{if(!this.props.isMobileView){this.setState({activeMenu:this.state.activeMenu&&this.state.activeMenu===data.id?undefined:data.id,parentMenu:parentId});if(this.props.showCategoryImage){this._updateCategoryImage(data.imageSource)();}}else{NavigationMenuView.isBackTrack=false;this.setState({activeMenu:data.id,mobileViewLabelText:data.linkText,parentMenu:parentId});}this._resetFocus();};this._handleGoBack=()=>()=>{NavigationMenuView.isBackTrack=true;this.setState({activeMenu:this.state.parentMenu});this._resetFocus();};this._resetFocus=()=>{if(this.props.isMobileView){setTimeout(()=>{this.menuNode&&this.menuNode.current&&this.menuNode.current.focus();},0);}};this._handleClickOutside=event=>{if(this.menuNode.current&&!this.menuNode.current.contains(event.target)){this.setState({activeMenu:undefined,mobileViewLabelText:''});}};this._getCategoryImage=categoryImage=>{const categoryImageUrl=generateImageUrl(\"\".concat(categoryImage),this.props.context.actionContext.requestContext.apiSettings);const defaultImageSettings={viewports:{xs:{q:'w=300&h=250&m=8',w:0,h:0},sm:{q:'w=300&h=250&m=8',w:0,h:0},md:{q:'w=300&h=250&m=8',w:0,h:0},lg:{q:'w=300&h=250&m=8',w:0,h:0}},lazyload:true};if(categoryImageUrl!==undefined){const ImageData={src:categoryImageUrl};return/*#__PURE__*/React.createElement(Image,Object.assign({className:'ms-nav-image__item'},ImageData,{gridSettings:this.props.context.request.gridSettings,imageSettings:this.props.config.categoryImageSettings||defaultImageSettings,loadFailureBehavior:'hide',role:'tabpanel',id:\"\".concat(categoryImage,\"__categoryImage\")}));}return null;};this.menuNode=/*#__PURE__*/React.createRef();this.state={activeMenu:undefined,mobileViewLabelText:'',parentMenu:undefined};this._closeSubmenu=this._closeSubmenu.bind(this);this.telemetryContent=getTelemetryObject(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);this.payLoad=getPayloadObject('click',this.telemetryContent,'','');}componentDidMount(){document.body&&document.body.addEventListener('mousedown',this._handleClickOutside);}componentWillUnmount(){document.body&&document.body.removeEventListener('mousedown',this._handleClickOutside,false);}render(){const{isMobileView,MenuList,MobileBackButton,MobileDescriptionContainer,MobileDescriptionLabel,Navigation}=this.props;this.currentLevel=1;return/*#__PURE__*/React.createElement(Module,Object.assign({},Navigation,{className:classnames(Navigation.className,isMobileView&&this.state.activeMenu!==undefined?'child':'parent')}),/*#__PURE__*/React.createElement(Node,Object.assign({},MenuList,{ref:this.menuNode,tabIndex:'-1'}),isMobileView&&this.state.activeMenu!==undefined&&/*#__PURE__*/React.createElement(Node,Object.assign({},MobileDescriptionContainer),/*#__PURE__*/React.createElement(Node,Object.assign({},MobileBackButton,{onClick:this._handleGoBack()})),/*#__PURE__*/React.createElement(Node,Object.assign({},MobileDescriptionLabel),this.state.mobileViewLabelText)),this._renderDisplay()));}_renderDisplay(){const{ListItem,menuItemData,isMobileView}=this.props;const{activeMenu}=this.state;const menuItemList=[];if(isMobileView&&activeMenu!==undefined&&menuItemData.length>0){let menuItem={};for(let i=0;i<menuItemData.length;i++){if(menuItemData[i]&&menuItemData[i].id===activeMenu){menuItem=menuItemData[i];!NavigationMenuView.isBackTrack?this.setState({parentMenu:undefined}):this.setState({parentMenu:undefined,mobileViewLabelText:menuItemData[i].linkText});break;}menuItem=this._getFromSubMenu(menuItemData[i]);if(menuItem&&menuItem.id===activeMenu){break;}}menuItem&&menuItemList.push(/*#__PURE__*/React.createElement(Node,Object.assign({key:menuItem.id},ListItem),\" \",this._createMenuItemList(menuItem),\" \"));}else{menuItemData.forEach((item,index)=>{menuItemList.push(/*#__PURE__*/React.createElement(Node,Object.assign({key:index},ListItem),this._createMenuItemList(item)));});}return menuItemList;}_getFromSubMenu(item){const subMenus=item&&item.subMenu;if(subMenus&&subMenus.length>0){for(let i=0;i<=subMenus.length-1;i++){if(subMenus[i].id===this.state.activeMenu){!NavigationMenuView.isBackTrack?this.setState({parentMenu:item&&item.id}):this.setState({parentMenu:item&&item.id,mobileViewLabelText:subMenus[i].linkText});return subMenus[i];}const found=this._getFromSubMenu(subMenus[i]);if(found){return found;}}}this.props.context.telemetry.error('Submenu content is empty, module wont render.');return null;}_createMenuItemList(menuItemData){if(menuItemData&&menuItemData.subMenu&&menuItemData.subMenu.length>0){if(this.props.isMobileView&&this.state.activeMenu!==undefined){return this._renderSubMenu(menuItemData.subMenu,menuItemData.id);}else{return/*#__PURE__*/React.createElement(React.Fragment,null,this._renderButtonMenuItem(menuItemData),this._renderSubMenu(menuItemData.subMenu,menuItemData.id));}}else if(menuItemData&&menuItemData.linkText&&menuItemData.linkURL&&menuItemData.linkURL.length>0){return this._renderLinkMenuItem(menuItemData);}else if(menuItemData&&menuItemData.linkText&&!menuItemData.linkURL){return this._renderSpanMenuItem(menuItemData);}this.props.context.telemetry.error('Navigation menu content is empty, module wont render.');return null;}_renderSubMenu(subMenus,activeMenu){const{isMobileView,ListItem}=this.props;if(activeMenu&&this.state.activeMenu!==activeMenu){this.props.context.telemetry.error('Navigation Active menu content is empty, module wont render.');return null;}if(!subMenus||subMenus.length===0){this.props.context.telemetry.error('Navigation Submenu content is empty, module wont render.');return null;}let levelClassName='';const menuOptions=subMenus&&subMenus.map((option,idx)=>{const hasOptions=option.subMenu&&option.subMenu.length>0;let menuItem;if(hasOptions&&isMobileView){menuItem=this._renderButtonMenuItem(option,activeMenu,idx);}else{menuItem=option.linkURL?this._renderLinkMenuItem(option,idx):this._renderSpanMenuItem(option);}let subMenu;if(hasOptions){this.currentLevel++;if(this.currentLevel<=this.supportedLevel-1){levelClassName=\"level-\".concat(this.currentLevel.toString());subMenu=this._renderSubMenu(option.subMenu,isMobileView?option.id:undefined);}}return/*#__PURE__*/React.createElement(Node,Object.assign({},ListItem,{key:option.id}),menuItem,subMenu);});return this._renderMenu(levelClassName,menuOptions,activeMenu);}_renderButtonMenuItem(option,activeMenu,index){const{Button}=this.props;return/*#__PURE__*/React.createElement(Node,Object.assign({key:index},Button,{onClick:this._handleDropdownToggle(option,activeMenu),onFocus:this._closeSubmenu,\"aria-haspopup\":true,\"aria-expanded\":this.state.activeMenu&&this.state.activeMenu===option.id?true:false,\"data-parent\":activeMenu}),option.linkText);}_renderLinkMenuItem(option,index){const{Link}=this.props;const linkText=option.linkText?option.linkText:'';const imagesource=option.imageSource?option.imageSource:'';this.payLoad.contentAction.etext=linkText;const attributes=getTelemetryAttributes(this.telemetryContent,this.payLoad);return/*#__PURE__*/React.createElement(Node,Object.assign({},Link,{key:index,onMouseOver:this._updateCategoryImage(imagesource),href:option.linkURL},attributes,{onClick:onTelemetryClick(this.telemetryContent,this.payLoad,linkText)}),option.linkText);}_renderSpanMenuItem(option,index){const{Span}=this.props;return/*#__PURE__*/React.createElement(Node,Object.assign({key:index},Span),option.linkText);}_renderMenu(level,menuOptions,currentItem){const{DivContainer,MenuList,ImageDivContainer,showCategoryImage}=this.props;this.currentLevel=1;if(showCategoryImage){return/*#__PURE__*/React.createElement(Node,Object.assign({},DivContainer,{className:DivContainer.className}),/*#__PURE__*/React.createElement(Node,Object.assign({},MenuList,{className:classnames(MenuList.className,level)}),menuOptions),/*#__PURE__*/React.createElement(Node,Object.assign({},ImageDivContainer,{className:ImageDivContainer.className}),this.state.categoryImage!==undefined&&this.state.categoryImage!==null&&this._getCategoryImage(this.state.categoryImage)));}return/*#__PURE__*/React.createElement(Node,Object.assign({},MenuList,{className:classnames(MenuList.className,level)}),menuOptions);}_closeSubmenu(){if(!this.props.isMobileView){this.setState({activeMenu:undefined,mobileViewLabelText:''});}}}NavigationMenuView.isBackTrack=false;export default NavigationMenuView;","map":{"version":3,"sources":["modules/navigation-menu/navigation-menu.view.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { generateImageUrl } from '@msdyn365-commerce-modules/retail-actions';\nimport { getPayloadObject, getTelemetryAttributes, getTelemetryObject, IPayLoad, ITelemetryContent, Module, Node, onTelemetryClick } from '@msdyn365-commerce-modules/utilities';\nimport { IImageData, IImageSettings, Image} from '@msdyn365-commerce/core';\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport { INavigationMenuViewProps } from './navigation-menu';\nimport { IMenuItemData } from './navigation-menu.data';\n\ninterface INavigationState {\n  parentMenu?: number;\n  activeMenu?: number;\n  categoryImage?:string|null;\n  mobileViewLabelText?: string;\n}\n\n/**\n *\n * NavigationMenuView component\n * @extends {React.PureComponent<INavigationMenuViewProps>}\n */\nexport class NavigationMenuView extends React.PureComponent<INavigationMenuViewProps, INavigationState> {\n    private static isBackTrack: boolean = false;\n    private supportedLevel: number = 3;\n    private currentLevel: number = 0;\n    private menuNode: React.RefObject<HTMLUListElement>;\n    private telemetryContent: ITelemetryContent;\n    private payLoad: IPayLoad;\n    constructor(props: INavigationMenuViewProps) {\n        super(props);\n        this.menuNode = React.createRef();\n        this.state = {activeMenu: undefined, mobileViewLabelText: '', parentMenu: undefined};\n        this._closeSubmenu  =this._closeSubmenu.bind(this);\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!,\n                                                   this.props.friendlyName,\n                                                   this.props.telemetry);\n        this.payLoad = getPayloadObject('click', this.telemetryContent, '', '');\n    }\n\n    public componentDidMount(): void {\n      document.body && document.body.addEventListener('mousedown',  this._handleClickOutside);\n    }\n\n    public componentWillUnmount(): void {\n        document.body && document.body.removeEventListener('mousedown', this._handleClickOutside, false);\n    }\n\n    public render(): JSX.Element | null {\n      const { isMobileView, MenuList, MobileBackButton, MobileDescriptionContainer, MobileDescriptionLabel, Navigation} = this.props;\n\n      this.currentLevel = 1;\n      return(\n          <Module {...Navigation} className={classnames(Navigation.className, isMobileView && this.state.activeMenu !== undefined ? 'child' : 'parent')}>\n            <Node { ...MenuList } ref={this.menuNode} tabIndex='-1'>\n            {isMobileView && this.state.activeMenu !== undefined &&\n              <Node {...MobileDescriptionContainer}>\n                  <Node {...MobileBackButton} onClick={this._handleGoBack()}/>\n                  <Node {...MobileDescriptionLabel}>{this.state.mobileViewLabelText}</Node>\n              </Node>}\n                {this._renderDisplay()}\n            </Node>\n          </Module>\n      );\n    }\n\n    private _renderDisplay(): JSX.Element[] {\n      const {ListItem, menuItemData, isMobileView} = this.props;\n      const {activeMenu} = this.state;\n      const menuItemList: JSX.Element[] = [];\n\n      if (isMobileView &&  activeMenu !== undefined && menuItemData.length > 0) {\n        let menuItem: IMenuItemData = {};\n        for(let i = 0; i < menuItemData.length; i++) {\n          if (menuItemData[i] && menuItemData[i].id === activeMenu) {\n            menuItem = menuItemData[i];\n            !NavigationMenuView.isBackTrack ? this.setState({parentMenu: undefined}) : this.setState({parentMenu: undefined, mobileViewLabelText: menuItemData[i].linkText});\n            break;\n          }\n          menuItem = this._getFromSubMenu(menuItemData[i]) as IMenuItemData;\n          if (menuItem && menuItem.id === activeMenu) {\n            break;\n          }\n        }\n\n        menuItem && menuItemList.push (\n          <Node key={menuItem.id} { ...ListItem}> {this._createMenuItemList(menuItem)} </Node>\n        );\n      } else {\n        menuItemData.forEach((item: IMenuItemData, index: number) => {\n          menuItemList.push (\n            <Node key={index} { ...ListItem}>\n                {this._createMenuItemList(item)}\n            </Node>\n          );\n      });\n      }\n\n      return menuItemList;\n  }\n\n  private _getFromSubMenu(item?: IMenuItemData): IMenuItemData | null {\n    const subMenus = item && item.subMenu;\n    if (subMenus && subMenus.length > 0) {\n      for(let i = 0; i <= subMenus.length-1; i++) {\n        if (subMenus[i].id === this.state.activeMenu) {\n            !NavigationMenuView.isBackTrack ? this.setState({parentMenu: item && item.id}) : this.setState({parentMenu: item && item.id, mobileViewLabelText: subMenus[i].linkText});\n            return subMenus[i];\n        }\n        const found = this._getFromSubMenu(subMenus[i]);\n        if (found) {\n          return found;\n        }\n      }\n    }\n    this.props.context.telemetry.error('Submenu content is empty, module wont render.');\n    return null;\n  }\n\n  private _createMenuItemList(menuItemData: IMenuItemData): JSX.Element | null {\n    if (menuItemData && menuItemData.subMenu && menuItemData.subMenu.length > 0) {\n      if (this.props.isMobileView && this.state.activeMenu !== undefined) {\n        return (this._renderSubMenu(menuItemData.subMenu, menuItemData.id));\n      } else {\n        return (\n          <React.Fragment>\n            {this._renderButtonMenuItem(menuItemData)}\n            {this._renderSubMenu(menuItemData.subMenu, menuItemData.id)}\n          </React.Fragment>\n        );\n      }\n    } else if (menuItemData && menuItemData.linkText && menuItemData.linkURL && menuItemData.linkURL.length > 0) {\n      return (this._renderLinkMenuItem(menuItemData));\n    } else if (menuItemData && menuItemData.linkText && !menuItemData.linkURL) {\n      return (this._renderSpanMenuItem(menuItemData));\n    }\n    this.props.context.telemetry.error('Navigation menu content is empty, module wont render.');\n    return null;\n  }\n\n  private _renderSubMenu(subMenus?: IMenuItemData[], activeMenu?: number): JSX.Element | null {\n    const {isMobileView, ListItem} = this.props;\n    if (activeMenu && this.state.activeMenu !== activeMenu) {\n      this.props.context.telemetry.error('Navigation Active menu content is empty, module wont render.');\n      return null;\n    }\n\n    if (!subMenus || subMenus.length === 0) {\n      this.props.context.telemetry.error('Navigation Submenu content is empty, module wont render.');\n      return null;\n    }\n\n    let levelClassName: string = '';\n    const menuOptions = subMenus && subMenus.map((option: IMenuItemData, idx: number)  => {\n    const hasOptions = (option.subMenu && option.subMenu.length > 0);\n    let menuItem: JSX.Element | null;\n    if (hasOptions && isMobileView) {\n      menuItem = this._renderButtonMenuItem(option, activeMenu, idx);\n    } else {\n      menuItem = (option.linkURL\n        ? this._renderLinkMenuItem(option, idx)\n        : this._renderSpanMenuItem(option)\n      );\n    }\n\n    let subMenu;\n\n    if (hasOptions) {\n      this.currentLevel++;\n      if (this.currentLevel <= this.supportedLevel-1) {\n        levelClassName = `level-${this.currentLevel.toString()}`;\n        subMenu = this._renderSubMenu(option.subMenu, isMobileView ? option.id : undefined);\n      }\n    }\n\n    return (\n    <Node {...ListItem} key={ option.id }>\n        { menuItem }\n        { subMenu }\n    </Node>\n    );\n    });\n\n    return (this._renderMenu(levelClassName, menuOptions, activeMenu));\n  }\n\n  private _renderButtonMenuItem(option: IMenuItemData, activeMenu?: number, index?: number): JSX.Element | null {\n    const {Button} = this.props;\n    return (\n          <Node\n            key={index}\n            {...Button}\n            onClick={this._handleDropdownToggle(option, activeMenu)}\n            onFocus={this._closeSubmenu}\n            aria-haspopup={true}\n            aria-expanded={this.state.activeMenu && this.state.activeMenu === option.id ? true : false}\n            data-parent={activeMenu}\n          >\n            { option.linkText }\n          </Node>\n      );\n  }\n\n  private _renderLinkMenuItem(option: IMenuItemData, index?: number): JSX.Element | null {\n    const {Link} = this.props;\n    const linkText = option.linkText ? option.linkText : '';\n    const imagesource= option.imageSource ? option.imageSource :'';\n    this.payLoad.contentAction.etext = linkText;\n    const attributes = getTelemetryAttributes(this.telemetryContent, this.payLoad);\n    return (\n      <Node {...Link} key={index} onMouseOver={this._updateCategoryImage(imagesource)} href={ option.linkURL } {...attributes} onClick={onTelemetryClick(this.telemetryContent, this.payLoad, linkText)}>\n        { option.linkText }\n      </Node>\n    );\n  }\n\n  private _renderSpanMenuItem(option: IMenuItemData, index?: number): JSX.Element | null {\n    const {Span} = this.props;\n    return (\n      <Node key={index} {...Span}>{ option.linkText }</Node>\n    );\n  }\n\n  private _renderMenu(level: string, menuOptions: JSX.Element[], currentItem?: number): JSX.Element | null {\n    const {DivContainer, MenuList,ImageDivContainer,showCategoryImage} = this.props;\n    this.currentLevel = 1;\n    if(showCategoryImage) {\n      return (\n        <Node {...DivContainer} className={DivContainer!.className}>\n        <Node {...MenuList} className={classnames(MenuList.className, level)}>\n          { menuOptions }\n          </Node>\n        <Node {...ImageDivContainer}  className={ImageDivContainer!.className}>\n          {this.state.categoryImage !==undefined && this.state.categoryImage !==null && this._getCategoryImage(this.state.categoryImage)}\n        </Node>\n        </Node>\n      );\n    }\n    return (\n      <Node {...MenuList} className={classnames(MenuList.className, level)}>\n        { menuOptions }\n      </Node>\n    );\n  }\n  private _updateCategoryImage=(categoryImage:string) => ()=> {\n    this.setState({\n      categoryImage: categoryImage !==''? categoryImage :'empty'\n     });\n }\n  private _handleDropdownToggle = (data: IMenuItemData, parentId?: number) => () => {\n    if (!this.props.isMobileView) {\n      this.setState({\n        activeMenu: (this.state.activeMenu && this.state.activeMenu === data.id!) ? undefined : data.id!,\n        parentMenu: parentId\n      });\n      if(this.props.showCategoryImage) {\n        this._updateCategoryImage(data.imageSource!)();\n      }\n    } else {\n      NavigationMenuView.isBackTrack = false;\n      this.setState({\n        activeMenu: data.id,\n        mobileViewLabelText: data.linkText!,\n        parentMenu: parentId\n      });\n    }\n\n    this._resetFocus();\n  };\n\n  private _handleGoBack = () => () => {\n    NavigationMenuView.isBackTrack = true;\n    this.setState({ activeMenu: this.state.parentMenu});\n\n    this._resetFocus();\n  };\n\n  private _resetFocus = () => {\n    if (this.props.isMobileView) {\n      setTimeout(() => {\n        this.menuNode && this.menuNode.current && this.menuNode.current.focus();\n      },         0);\n    }\n  }\n\n  // tslint:disable-next-line:no-any\n  private _handleClickOutside = (event: any) => {\n    if (this.menuNode.current && !this.menuNode.current.contains(event.target)) {\n      this.setState({activeMenu:undefined, mobileViewLabelText: ''});\n    }\n  };\n\n  private _closeSubmenu():void {\n    if (!this.props.isMobileView) {\n      this.setState({activeMenu:undefined, mobileViewLabelText: ''});\n    }\n  }\n  private _getCategoryImage=(categoryImage:string):React.ReactNode|null => {\n\n    const categoryImageUrl = generateImageUrl(`${categoryImage}`, this.props.context.actionContext.requestContext.apiSettings);\n    const defaultImageSettings: IImageSettings = {\n        viewports: {\n            xs: { q: 'w=300&h=250&m=8', w: 0, h: 0 },\n            sm: { q: 'w=300&h=250&m=8', w: 0, h: 0 },\n            md: { q: 'w=300&h=250&m=8', w: 0, h: 0 },\n            lg: { q: 'w=300&h=250&m=8', w: 0, h: 0 }\n        },\n        lazyload: true\n    };\n    if(categoryImageUrl !== undefined) {\n        const ImageData:IImageData = {src:categoryImageUrl};\n        return (\n            <Image\n                className='ms-nav-image__item'\n                {...ImageData}\n                gridSettings={this.props.context.request.gridSettings!}\n                imageSettings={this.props.config.categoryImageSettings || defaultImageSettings}\n                loadFailureBehavior='hide'\n                role='tabpanel'\n                id={`${categoryImage}__categoryImage`}\n            />\n        );\n    }\n    return null;\n  }\n}\n\nexport default NavigationMenuView;"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}