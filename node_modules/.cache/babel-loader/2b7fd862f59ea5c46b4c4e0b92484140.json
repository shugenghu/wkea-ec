{"ast":null,"code":"/*!\r\n * Copyright (c) Microsoft Corporation.\r\n * All rights reserved. See LICENSE in the project root for license information.\r\n */import{getCurrency}from'locale-currency';// Helper function for parsing/normalizing json, exported\nexport var parsePayload=function parsePayload(content){try{return content.constructor===String?JSON.parse(content):content;}catch(error){throw new Error(\"JSON Parsing fails for content -- \".concat(content));}};export var isEmptyOrNullObject=function isEmptyOrNullObject(obj){return!obj||Object.keys(obj).length<=0;};export var returnEmptyPromise=function returnEmptyPromise(){// tslint:disable:no-void-expression\nreturn new Promise(function(resolve){return resolve();});};var UNSAFE_CHARS_REGEXP=/[<>\\/\\u2028\\u2029]/g;var ESCAPED_CHARS={'<':\"\\\\u003C\",'>':\"\\\\u003E\",'/':\"\\\\u002F\",\"\\u2028\":\"\\\\u2028\",\"\\u2029\":\"\\\\u2029\"};var escapeUnsafeChars=function escapeUnsafeChars(unsafeChar){return ESCAPED_CHARS[unsafeChar];};export var sanitizeForXss=function sanitizeForXss(str){return str.replace(UNSAFE_CHARS_REGEXP,escapeUnsafeChars);};export var removeInstanceCache=function removeInstanceCache(_key,value){if(value&&value.instance==='instance'){return undefined;}return value;};export var isAuthoringEditEnabled=function isAuthoringEditEnabled(context){if(context){if(context.features&&context.features.authoring_inline_edit&&context.params&&!!context.params.isEditor){return true;}}return false;};/**\r\n * Tries to parse a string value into an number and reurns this value. If the string is undefined\r\n * or if the string does not represent a valid number, undefined is returned\r\n *\r\n * @param value The string representing the number to be parsed\r\n */export var tryParseInt=function tryParseInt(value){if(value){var parsedValue=parseInt(value,10);return isNaN(parsedValue)?undefined:parsedValue;}return undefined;};/**\r\n * Name of internal component fragment, must be all lower case\r\n */export var SDK_FRAGMENT_NAME='platform.saferendermodule';/**\r\n * Regex constant for capturing the internal fragment name with data-reactroot that is occasionally emitted\r\n */export var SDK_FRAGMENT_NAME_REGEX=/<[/]?platform\\.saferendermodule( data-reactroot=[\"].*[\"])?>/gi;/**\r\n * Hepler function to build a URL to get the asset\r\n * @param assetPath the path to the asset\r\n */export var getAsset=function getAsset(assetPath,context){var assetUrl='';if(context.url.staticCdnUrl){assetUrl+=context.url.staticCdnUrl;}if(assetPath.length>0&&assetPath.charAt(0)==='/'){assetPath=assetPath.substr(1);}if(!process.env.SUBMISSIONID||process.env.SUBMISSIONID==='undefined'){return\"\".concat(assetUrl).concat(\"\".concat(assetPath).replace(/\\/+/g,'/'));}else{return\"\".concat(assetUrl).concat(\"\".concat(process.env.SUBMISSIONID,\"/\").concat(assetPath).replace(/\\/+/g,'/'));}};export var CurrencyCodeIdentifier='cc';export var getCurrencyCodeFromContext=function getCurrencyCodeFromContext(requestContext){return requestContext&&requestContext.query&&requestContext.query[CurrencyCodeIdentifier]||requestContext.cookies&&requestContext.cookies.get(CurrencyCodeIdentifier).value||requestContext.channel&&requestContext.channel.Currency||getCurrency(requestContext.locale);};export var isNonceEnabled=function isNonceEnabled(requestCnotext){var contentSecurityPolicy=requestCnotext.app&&requestCnotext.app.contentSecurityPolicy;var nonceToken=contentSecurityPolicy&&contentSecurityPolicy.nonceToken;return contentSecurityPolicy&&!contentSecurityPolicy.disableContentSecurityPolicy&&contentSecurityPolicy.enableNonce&&nonceToken;};","map":{"version":3,"sources":["../../../src/utilities/helper.ts"],"names":[],"mappings":"AAAA;;;AAGG,GAEH,OAAS,WAAT,KAA4B,iBAA5B,CAOA;AACA,MAAO,IAAM,CAAA,YAAY,CAAG,QAAf,CAAA,YAAe,CAAC,OAAD,CAAoB,CAC5C,GAAI,CACA,MAAO,CAAA,OAAO,CAAC,WAAR,GAAwB,MAAxB,CAAiC,IAAI,CAAC,KAAL,CAAW,OAAX,CAAjC,CAAuD,OAA9D,CACH,CAAC,MAAO,KAAP,CAAc,CACZ,KAAM,IAAI,CAAA,KAAJ,6CAA+C,OAA/C,EAAN,CACH,CACJ,CANM,CAQP,MAAO,IAAM,CAAA,mBAAmB,CAAG,QAAtB,CAAA,mBAAsB,CAAC,GAAD,CAA4C,CAC3E,MAAO,CAAC,GAAD,EAAQ,MAAM,CAAC,IAAP,CAAY,GAAZ,EAAiB,MAAjB,EAA2B,CAA1C,CACH,CAFM,CAIP,MAAO,IAAM,CAAA,kBAAkB,CAAG,QAArB,CAAA,kBAAqB,EAAkB,CAChD;AACA,MAAO,IAAI,CAAA,OAAJ,CAAY,SAAC,OAAD,QAAiE,CAAA,OAAO,EAAxE,EAAZ,CAAP,CACH,CAHM,CAKP,GAAM,CAAA,mBAAmB,CAAG,qBAA5B,CACA,GAAM,CAAA,aAAa,CAAqC,CACpD,IAAK,SAD+C,CAEpD,IAAK,SAF+C,CAGpD,IAAK,SAH+C,CAIpD,SAAU,SAJ0C,CAKpD,SAAU,SAL0C,CAAxD,CAOA,GAAM,CAAA,iBAAiB,CAAG,QAApB,CAAA,iBAAoB,CAAC,UAAD,CAA+B,CACrD,MAAO,CAAA,aAAa,CAAC,UAAD,CAApB,CACH,CAFD,CAIA,MAAO,IAAM,CAAA,cAAc,CAAG,QAAjB,CAAA,cAAiB,CAAC,GAAD,CAAwB,CAClD,MAAO,CAAA,GAAG,CAAC,OAAJ,CAAY,mBAAZ,CAAiC,iBAAjC,CAAP,CACH,CAFM,CAIP,MAAO,IAAM,CAAA,mBAAmB,CAAG,QAAtB,CAAA,mBAAsB,CAAC,IAAD,CAAe,KAAf,CAAmE,CAClG,GAAI,KAAK,EAAI,KAAK,CAAC,QAAN,GAAmB,UAAhC,CAA4C,CACxC,MAAO,CAAA,SAAP,CACH,CACD,MAAO,CAAA,KAAP,CACH,CALM,CAOP,MAAO,IAAM,CAAA,sBAAsB,CAAG,QAAzB,CAAA,sBAAyB,CAAC,OAAD,CAAkD,CACpF,GAAI,OAAJ,CAAa,CACT,GAAI,OAAO,CAAC,QAAR,EAAoB,OAAO,CAAC,QAAR,CAAiB,qBAArC,EAA8D,OAAO,CAAC,MAAtE,EAAgF,CAAC,CAAC,OAAO,CAAC,MAAR,CAAe,QAArG,CAA+G,CAC3G,MAAO,KAAP,CACH,CACJ,CAED,MAAO,MAAP,CACH,CARM,CAUP;;;;;AAKG,GACH,MAAO,IAAM,CAAA,WAAW,CAAG,QAAd,CAAA,WAAc,CAAC,KAAD,CAAkD,CACzE,GAAI,KAAJ,CAAW,CACP,GAAM,CAAA,WAAW,CAAG,QAAQ,CAAC,KAAD,CAAQ,EAAR,CAA5B,CACA,MAAO,CAAA,KAAK,CAAC,WAAD,CAAL,CAAqB,SAArB,CAAiC,WAAxC,CACH,CACD,MAAO,CAAA,SAAP,CACH,CANM,CAQP;;AAEG,GACH,MAAO,IAAM,CAAA,iBAAiB,CAAG,2BAA1B,CAEP;;AAEG,GACH,MAAO,IAAM,CAAA,uBAAuB,CAAG,+DAAhC,CAEP;;;AAGG,GACH,MAAO,IAAM,CAAA,QAAQ,CAAG,QAAX,CAAA,QAAW,CAAC,SAAD,CAAoB,OAApB,CAAgD,CACpE,GAAI,CAAA,QAAQ,CAAW,EAAvB,CACA,GAAI,OAAO,CAAC,GAAR,CAAY,YAAhB,CAA8B,CAC1B,QAAQ,EAAI,OAAO,CAAC,GAAR,CAAY,YAAxB,CACH,CACD,GAAI,SAAS,CAAC,MAAV,CAAmB,CAAnB,EAAwB,SAAS,CAAC,MAAV,CAAiB,CAAjB,IAAwB,GAApD,CAAyD,CACrD,SAAS,CAAG,SAAS,CAAC,MAAV,CAAiB,CAAjB,CAAZ,CACH,CACD,GAAI,CAAC,OAAO,CAAC,GAAR,CAAY,YAAb,EAA6B,OAAO,CAAC,GAAR,CAAY,YAAZ,GAA6B,WAA9D,CAA2E,CACvE,gBAAU,QAAV,SAAqB,UAAG,SAAH,EAAe,OAAf,CAAuB,MAAvB,CAA+B,GAA/B,CAArB,EACH,CAFD,IAEO,CACH,gBAAU,QAAV,SAAqB,UAAG,OAAO,CAAC,GAAR,CAAY,YAAf,aAA+B,SAA/B,EAA2C,OAA3C,CAAmD,MAAnD,CAA2D,GAA3D,CAArB,EACH,CACJ,CAbM,CAeP,MAAO,IAAM,CAAA,sBAAsB,CAAG,IAA/B,CACP,MAAO,IAAM,CAAA,0BAA0B,CAAG,QAA7B,CAAA,0BAA6B,CAAC,cAAD,CAAoC,CAC1E,MACK,CAAA,cAAc,EAAI,cAAc,CAAC,KAAjC,EAA0C,cAAc,CAAC,KAAf,CAAqB,sBAArB,CAA3C,EACC,cAAc,CAAC,OAAf,EAA0B,cAAc,CAAC,OAAf,CAAuB,GAAvB,CAAmC,sBAAnC,EAA2D,KADtF,EAEC,cAAc,CAAC,OAAf,EAA0B,cAAc,CAAC,OAAf,CAAuB,QAFlD,EAGA,WAAW,CAAC,cAAc,CAAC,MAAhB,CAJf,CAMH,CAPM,CASP,MAAO,IAAM,CAAA,cAAc,CAAG,QAAjB,CAAA,cAAiB,CAAC,cAAD,CAAoC,CAC9D,GAAM,CAAA,qBAAqB,CAAG,cAAc,CAAC,GAAf,EAAsB,cAAc,CAAC,GAAf,CAAmB,qBAAvE,CACA,GAAM,CAAA,UAAU,CAAG,qBAAqB,EAAI,qBAAqB,CAAC,UAAlE,CACA,MAAO,CAAA,qBAAqB,EAAI,CAAC,qBAAqB,CAAC,4BAAhD,EAAgF,qBAAqB,CAAC,WAAtG,EAAqH,UAA5H,CACH,CAJM","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport { getCurrency } from 'locale-currency';\nimport { IRequestContext } from '../interfaces';\n\nexport interface IContentEditableInitEvent {\n    type: string;\n}\n\n// Helper function for parsing/normalizing json, exported\nexport const parsePayload = (content: string) => {\n    try {\n        return content.constructor === String ? JSON.parse(content) : content;\n    } catch (error) {\n        throw new Error(`JSON Parsing fails for content -- ${content}`);\n    }\n};\n\nexport const isEmptyOrNullObject = (obj: object | undefined | null): boolean => {\n    return !obj || Object.keys(obj).length <= 0;\n};\n\nexport const returnEmptyPromise = (): Promise<{}> => {\n    // tslint:disable:no-void-expression\n    return new Promise((resolve: (value?: {} | PromiseLike<{}> | undefined) => void) => resolve());\n};\n\nconst UNSAFE_CHARS_REGEXP = /[<>\\/\\u2028\\u2029]/g;\nconst ESCAPED_CHARS: { [unsafechar: string]: string } = {\n    '<': '\\\\u003C',\n    '>': '\\\\u003E',\n    '/': '\\\\u002F',\n    '\\u2028': '\\\\u2028',\n    '\\u2029': '\\\\u2029'\n};\nconst escapeUnsafeChars = (unsafeChar: string): string => {\n    return ESCAPED_CHARS[unsafeChar];\n};\n\nexport const sanitizeForXss = (str: string): string => {\n    return str.replace(UNSAFE_CHARS_REGEXP, escapeUnsafeChars);\n};\n\nexport const removeInstanceCache = (_key: string, value: { instance: string }): undefined | unknown => {\n    if (value && value.instance === 'instance') {\n        return undefined;\n    }\n    return value;\n};\n\nexport const isAuthoringEditEnabled = (context: IRequestContext | undefined): boolean => {\n    if (context) {\n        if (context.features && context.features.authoring_inline_edit && context.params && !!context.params.isEditor) {\n            return true;\n        }\n    }\n\n    return false;\n};\n\n/**\n * Tries to parse a string value into an number and reurns this value. If the string is undefined\n * or if the string does not represent a valid number, undefined is returned\n *\n * @param value The string representing the number to be parsed\n */\nexport const tryParseInt = (value: string | undefined): number | undefined => {\n    if (value) {\n        const parsedValue = parseInt(value, 10);\n        return isNaN(parsedValue) ? undefined : parsedValue;\n    }\n    return undefined;\n};\n\n/**\n * Name of internal component fragment, must be all lower case\n */\nexport const SDK_FRAGMENT_NAME = 'platform.saferendermodule';\n\n/**\n * Regex constant for capturing the internal fragment name with data-reactroot that is occasionally emitted\n */\nexport const SDK_FRAGMENT_NAME_REGEX = /<[/]?platform\\.saferendermodule( data-reactroot=[\"].*[\"])?>/gi;\n\n/**\n * Hepler function to build a URL to get the asset\n * @param assetPath the path to the asset\n */\nexport const getAsset = (assetPath: string, context: IRequestContext) => {\n    let assetUrl: string = '';\n    if (context.url.staticCdnUrl) {\n        assetUrl += context.url.staticCdnUrl;\n    }\n    if (assetPath.length > 0 && assetPath.charAt(0) === '/') {\n        assetPath = assetPath.substr(1);\n    }\n    if (!process.env.SUBMISSIONID || process.env.SUBMISSIONID === 'undefined') {\n        return `${assetUrl}${`${assetPath}`.replace(/\\/+/g, '/')}`;\n    } else {\n        return `${assetUrl}${`${process.env.SUBMISSIONID}/${assetPath}`.replace(/\\/+/g, '/')}`;\n    }\n};\n\nexport const CurrencyCodeIdentifier = 'cc';\nexport const getCurrencyCodeFromContext = (requestContext: IRequestContext) => {\n    return (\n        (requestContext && requestContext.query && requestContext.query[CurrencyCodeIdentifier]) ||\n        (requestContext.cookies && requestContext.cookies.get<string>(CurrencyCodeIdentifier).value) ||\n        (requestContext.channel && requestContext.channel.Currency) ||\n        getCurrency(requestContext.locale)\n    );\n};\n\nexport const isNonceEnabled = (requestCnotext: IRequestContext) => {\n    const contentSecurityPolicy = requestCnotext.app && requestCnotext.app.contentSecurityPolicy;\n    const nonceToken = contentSecurityPolicy && contentSecurityPolicy.nonceToken;\n    return contentSecurityPolicy && !contentSecurityPolicy.disableContentSecurityPolicy && contentSecurityPolicy.enableNonce && nonceToken;\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}