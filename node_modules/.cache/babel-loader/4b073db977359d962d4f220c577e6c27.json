{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _debounce from\"lodash/debounce\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{createSearchStateInput}from'@msdyn365-commerce-modules/search-utilities';import{getTelemetryObject}from'@msdyn365-commerce-modules/utilities';import{getUrlSync}from'@msdyn365-commerce/core';import{getProductSearchRefinersAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import classnames from'classnames';import*as React from'react';import getSearchSuggestionsAction,{AutoSuggestInput}from'./actions/get-auto-suggest-suggestions';import{CategorySuggestionsComponent,FormComponent,KeywordSuggestionsComponent,LabelComponent,ProductSuggestionsComponent}from'./components';class Search extends React.Component{constructor(props){super(props);this.hitPrefix='{';this.hitSuffix='}';this.waitTime=500;this._focusOutTarget=e=>{const{suggestions}=this.state;if(suggestions&&suggestions.AllSearchResults&&e.target.closest('.ms-search')===null){this._clearAutoSuggestState();}};this._keyup=e=>{const{suggestions}=this.state;if(suggestions&&suggestions.AllSearchResults&&e.keyCode===27){this._clearAutoSuggestState();}else if(this.state.isSearchFormExpanded&&e.keyCode===27){if(this.state.isSearchFormExpanded){this.setState({isSearchFormExpanded:false});}}if(!(this.formReference.current&&this.formReference.current.contains(e.target)||this.autoSuggestResultDiv.current&&this.autoSuggestResultDiv.current.contains(e.target))){if(suggestions&&suggestions.AllSearchResults){this._clearAutoSuggestState();}if(this.state.isSearchFormExpanded){this.setState({isSearchFormExpanded:false});}}};this._clearAutoSuggestState=()=>{const{context:{actionContext},data:{searchState}}=this.props;if(this.searchTextInput.current&&this.searchTextInput.current.value.length>0){searchState.searchText='';searchState.defaultBasicSearchUrl='';searchState.searchQueryStringParameter='';actionContext?actionContext.update(createSearchStateInput(searchState),searchState):null;this.searchTextInput.current.value='';}this.setState({searchText:'',suggestions:undefined,searchRefiners:undefined});};this._handleInputChange=query=>{if(!query||query.length<this.maxChars){this.setState({searchText:query});}if(this.cancellabelDebounce){this.cancellabelDebounce.cancel();}const{telemetry,context,data:{searchState}}=this.props;if(context){if(query&&query.length>0){if(query.length>this.maxChars){return;}this.cancellabelDebounce=_debounce(()=>{getSearchSuggestionsAction(new AutoSuggestInput(query,this.topResultsCount,this._getSuggestionType(this.inputSuggestionType),this.hitPrefix,this.hitSuffix),context.actionContext).then(results=>{this._getSearchRefiners(query).then(refiners=>{this.setState({suggestions:results,searchRefiners:refiners,autoSuggestAriaLabel:this._setAutoSuggestResultCount(results)});}).catch(error=>{this.setState({suggestions:results,searchRefiners:undefined,autoSuggestAriaLabel:this._setAutoSuggestResultCount(results)});telemetry.exception(error);telemetry.debug('Unable to get refiners results');});}).catch(error=>{this.setState({suggestions:undefined,searchRefiners:undefined,autoSuggestAriaLabel:this._setAutoSuggestResultCount()});telemetry.exception(error);telemetry.debug('Unable to get auto suggest results');});},this.waitTime);setTimeout(()=>{this.cancellabelDebounce();},0);searchState.searchText=query;}else{this.setState({suggestions:undefined,searchRefiners:undefined});searchState.searchText='';}context.actionContext.update(createSearchStateInput(searchState),searchState);}};this._getSuggestionType=suggestionTypes=>{if(suggestionTypes&&suggestionTypes.length>0){const distinctSuggestionTypes=[];suggestionTypes&&suggestionTypes.forEach((suggestionTypeItem,index)=>{suggestionTypeItem.SuggestionType&&distinctSuggestionTypes.push(suggestionTypeItem.SuggestionType.charAt(0).toUpperCase()+suggestionTypeItem.SuggestionType.slice(1));});return distinctSuggestionTypes.join(',');}return'Keyword, Product, ScopedCategory';};this._handleSubmit=e=>{const{config:{disableSubmitSearch},context:{actionContext,app:{config:{searchQueryStringParameter}}}}=this.props;const query=this.searchTextInput.current&&this.searchTextInput.current.value;e.preventDefault();if(!query||query&&query.length===0||disableSubmitSearch){this.searchTextInput&&this.searchTextInput.current&&this.searchTextInput.current.focus();}else{const searchQsp=searchQueryStringParameter||'q';const searchURL=this._appendQueryParams(getUrlSync('search',actionContext)||'',query,searchQsp);document.location.href=searchURL;}};this._handleCancelSearchChange=()=>{const{isSearchFormExpanded,suggestions}=this.state;if(!isSearchFormExpanded){this.setState({isSearchFormExpanded:true,searchText:'',isInitialState:false});}else{if(suggestions&&suggestions.AllSearchResults){this._clearAutoSuggestState();}this.setState({isSearchFormExpanded:false});}};this._appendQueryParams=(route,query,qsp)=>{if(route&&route.length>0){return query&&query.length>0?\"\".concat(route).concat(route.indexOf('?')===-1?'?':'&').concat(qsp,\"=\").concat(query):route;}return'';};this._setAutoSuggestResultCount=result=>{if(this.autoSuggestResultScreenReaderDiv.current!==null){const ariaLiveRegion=this.autoSuggestResultScreenReaderDiv.current;const suggestResultString=this.props.resources.autoSuggestFoundMessage;const emptyResultString=this.props.resources.noAutoSuggestionMessage;ariaLiveRegion.innerText=result&&result.AllSearchResults&&result.AllSearchResults.length>0?suggestResultString:emptyResultString;ariaLiveRegion.setAttribute('aria-live','assertive');return ariaLiveRegion.innerText;}else{return'';}};this.searchTextInput=/*#__PURE__*/React.createRef();this.searchCollapsedLabel=/*#__PURE__*/React.createRef();this.autoSuggestResultScreenReaderDiv=/*#__PURE__*/React.createRef();this.autoSuggestResultDiv=/*#__PURE__*/React.createRef();this.formReference=/*#__PURE__*/React.createRef();this.state={isSearchFormExpanded:false,searchText:'',searchKeywordSuggestClass:'ms-search__autoSuggest__keyword',searchProductSuggestClass:'ms-search__autoSuggest__product',searchCategorySuggestClass:'ms-search__autoSuggest__category',suggestions:undefined,searchRefiners:undefined,autoSuggestAriaLabel:'',isInitialState:true};this.maxChars=this.props.context&&this.props.context.app&&this.props.context.app.config&&this.props.context.app.config.searchInputMaxLength||50;this.inputSuggestionType=this.props.config&&this.props.config.suggestionTypeCriterion;this.topResultsCount=this.props.config&&this.props.config.topResultsCount?this.props.config.topResultsCount:5;this.searchFormClass='ms-search__form';this.searchLabelClass='ms-search__label';this.telemetryContent=getTelemetryObject(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);}async componentDidMount(){document.body&&document.body.addEventListener('mousedown',this._focusOutTarget);window&&window.addEventListener('keyup',this._keyup);}componentWillUnmount(){document.body&&document.body.removeEventListener('mousedown',this._focusOutTarget,false);window&&window.removeEventListener('keyup',this._keyup,false);}componentDidUpdate(){const{config:{hideSearchLabel}}=this.props;const{isSearchFormExpanded,isInitialState}=this.state;if(!this.props.context.request.params.isEditor){if(!hideSearchLabel&&isSearchFormExpanded){this.searchTextInput&&this.searchTextInput.current&&this.searchTextInput.current.focus();}else if(!isInitialState){this.searchCollapsedLabel&&this.searchCollapsedLabel.current&&this.searchCollapsedLabel.current.focus();}}}render(){const{context,resources:{searchtext,searchLabelArialLabel,cancelBtnAriaLabel,searchBtnAriaLabel,submitBtnAriaLabel},config:{hideSearchLabel,disableSubmitSearch,searchplaceholderText,className=''}}=this.props;const{isSearchFormExpanded,searchText,searchKeywordSuggestClass,searchProductSuggestClass,searchCategorySuggestClass,suggestions,searchRefiners}=this.state;const searchQsp=context&&context.app&&context.app.config&&context.app.config.searchQueryStringParameter||'q';const searchPageURL=getUrlSync('search',context&&context.actionContext)||'';const searchURL=this._appendQueryParams(searchPageURL,searchText,searchQsp);const searchPlaceholder=searchplaceholderText&&searchplaceholderText.length>0?searchplaceholderText:'Search in Fabrikam';const keywordSuggestions=suggestions&&suggestions.AllSearchResults&&suggestions.AllSearchResults.filter(i=>i.SuggestionType===\"Keyword\"||i.SuggestionType===\"None\");const productSuggestions=suggestions&&suggestions.AllSearchResults&&suggestions.AllSearchResults.filter(i=>i.SuggestionType===\"Product\");const categorySuggestions=suggestions&&suggestions.AllSearchResults&&suggestions.AllSearchResults.filter(i=>i.SuggestionType===\"ScopedCategory\");const viewProps=_objectSpread(_objectSpread({},this.props),{},{Search:{moduleProps:this.props,className:\"\".concat(classnames('ms-search',className),\" \").concat(disableSubmitSearch?'no-submit':'with-submit')},AutoSuggestAriaLabel:{tag:'div',className:'msc-autoSuggest__screen-reader','aria-live':'assertive',ref:this.autoSuggestResultScreenReaderDiv},AutoSuggestAriaLabelText:this.state.autoSuggestAriaLabel,searchText:this.state.searchText,AutoSuggest:{ref:this.autoSuggestResultDiv,className:'ms-search__autoSuggest'},KeywordSuggest:{className:searchKeywordSuggestClass},ProductSuggest:{className:searchProductSuggestClass},CategorySuggest:{className:searchCategorySuggestClass},SearchForm:{className:\"\".concat(this.searchFormClass,\" \").concat(isSearchFormExpanded?'bx-show':'bx-hide')},FormWrapper:{tag:'form',ref:this.formReference,className:'ms-search__searchForm','aria-label':'Search',name:'searchForm',role:'Search',action:searchURL,autoComplete:'off',onSubmit:this._handleSubmit},UlKeyword:{tag:'ul',className:classnames('msc-autoSuggest__keywordResults-items',className)},UlProduct:{tag:'ul',className:classnames('msc-autoSuggest__productResults-items',className)},UlCategory:{tag:'ul',className:classnames('msc-autoSuggest__categoryResults-items',className)},label:LabelComponent({isSearchFormExpanded:isSearchFormExpanded,searchLabelClass:\"\".concat(this.searchLabelClass,\" \").concat(isSearchFormExpanded?'bx-hide':'bx-show'),searchtext:searchtext,searchLabelArialLabel:searchLabelArialLabel,searchCollapsedLabel:this.searchCollapsedLabel,hideSearchLabel:hideSearchLabel,handleCancelSearchChange:this._handleCancelSearchChange,telemetryContent:this.telemetryContent}),form:FormComponent({ariaLabelCancel:cancelBtnAriaLabel,ariaLabelSearch:searchBtnAriaLabel,ariaLabelSubmit:submitBtnAriaLabel,hideSearchLabel:hideSearchLabel,searchTextInput:this.searchTextInput,isSearchFormExpanded:isSearchFormExpanded,disableSubmitSearch:disableSubmitSearch,handleInputChange:this._handleInputChange,handleCancelSearchChange:this._handleCancelSearchChange,maxChars:this.maxChars,searchQsp:searchQsp,searchPlaceholder:searchPlaceholder,query:searchText}),autosuggestKeyword:searchText&&searchText.length>0&&keywordSuggestions&&keywordSuggestions.length>0?KeywordSuggestionsComponent({searchKeywordSuggestClass:searchKeywordSuggestClass,searchPageURL:searchPageURL,searchQsp:searchQsp,hitPrefix:this.hitPrefix,hitSuffix:this.hitSuffix,autoSuggestProps:this.props,searchText:searchText,suggestions:keywordSuggestions,telemetryContent:this.telemetryContent}):undefined,autosuggestProduct:searchText&&searchText.length>0&&productSuggestions&&productSuggestions.length>0?ProductSuggestionsComponent({searchProductSuggestClass:searchProductSuggestClass,searchPageURL:searchPageURL,searchQsp:searchQsp,hitPrefix:this.hitPrefix,hitSuffix:this.hitSuffix,autoSuggestProps:this.props,searchText:searchText,suggestions:productSuggestions,telemetry:this.props.telemetry,moduleType:this.props.typeName,moduleId:this.props.id,telemetryContent:this.telemetryContent}):undefined,autosuggestCategory:searchText&&searchText.length>0&&categorySuggestions&&categorySuggestions.length>0?CategorySuggestionsComponent({searchCategorySuggestClass:searchCategorySuggestClass,searchPageURL:searchPageURL,searchQsp:searchQsp,hitPrefix:this.hitPrefix,hitSuffix:this.hitSuffix,autoSuggestProps:this.props,searchText:searchText,suggestions:categorySuggestions,searchRefiners:searchRefiners,telemetryContent:this.telemetryContent}):undefined,callbacks:{handleCancelSearchChange:this._handleCancelSearchChange},isSearchFormExpanded:this.state.isSearchFormExpanded});return this.props.renderView(viewProps);}async _getSearchRefiners(searchText){const{actionContext:ctx}=this.props.context;return getProductSearchRefinersAsync({callerContext:ctx},{SearchCondition:searchText,Context:{ChannelId:+ctx.requestContext.apiSettings.channelId,CatalogId:+ctx.requestContext.apiSettings.catalogId}});}}export default Search;","map":{"version":3,"sources":["modules/search/search.tsx"],"names":[],"mappings":"w+BAKA,OAAS,sBAAT,KAAuC,6CAAvC,CACA,OAAS,kBAAT,KAA0F,sCAA1F,CAEA,OAAS,UAAT,KAA2B,yBAA3B,CAEA,OAAS,6BAAT,KAA8C,wEAA9C,CACA,MAAO,CAAA,UAAP,KAAuB,YAAvB,CAEA,MAAO,GAAK,CAAA,KAAZ,KAAuB,OAAvB,CAEA,MAAO,CAAA,0BAAP,EAAqC,gBAArC,KAA6E,wCAA7E,CACA,OACI,4BADJ,CAEI,aAFJ,CAMI,2BANJ,CAOI,cAPJ,CAQI,2BARJ,KASO,cATP,CAuDA,KAAM,CAAA,MAAN,QAAqB,CAAA,KAAK,CAAC,SAAkD,CAkBzE,WAAA,CAAY,KAAZ,CAA4C,CACxC,MAAM,KAAN,EAZI,KAAA,SAAA,CAAoB,GAApB,CACA,KAAA,SAAA,CAAoB,GAApB,CACA,KAAA,QAAA,CAAmB,GAAnB,CA8OA,KAAA,eAAA,CAAmB,CAAD,EAAiB,CACvC,KAAM,CAAE,WAAF,EAAkB,KAAK,KAA7B,CAEA,GACI,WAAW,EACX,WAAW,CAAC,gBADZ,EAEA,CAAC,CAAC,MAAF,CAAS,OAAT,CAAiB,YAAjB,IAAmC,IAHvC,CAIE,CACE,KAAK,sBAAL,GACH,CACJ,CAVO,CAYA,KAAA,MAAA,CAAU,CAAD,EAA2B,CACxC,KAAM,CAAE,WAAF,EAAkB,KAAK,KAA7B,CAEA,GAAI,WAAW,EAAI,WAAW,CAAC,gBAA3B,EAA+C,CAAC,CAAC,OAAF,GAAS,EAA5D,CAAkF,CAC9E,KAAK,sBAAL,GACH,CAFD,IAEO,IAAG,KAAK,KAAL,CAAW,oBAAX,EAAmC,CAAC,CAAC,OAAF,GAAS,EAA/C,CAAqE,CACxE,GAAG,KAAK,KAAL,CAAW,oBAAd,CAAoC,CAChC,KAAK,QAAL,CAAc,CAAE,oBAAoB,CAAE,KAAxB,CAAd,EACH,CACJ,CAED,GAAI,EAAG,KAAK,aAAL,CAAmB,OAAnB,EAA8B,KAAK,aAAL,CAAmB,OAAnB,CAA2B,QAA3B,CAAoC,CAAC,CAAC,MAAtC,CAA/B,EACL,KAAK,oBAAL,CAA0B,OAA1B,EAAqC,KAAK,oBAAL,CAA0B,OAA1B,CAAkC,QAAlC,CAA2C,CAAC,CAAC,MAA7C,CADlC,CAAJ,CACiH,CAC7G,GAAI,WAAW,EAAI,WAAW,CAAC,gBAA/B,CAAiD,CAC7C,KAAK,sBAAL,GACH,CAED,GAAG,KAAK,KAAL,CAAW,oBAAd,CAAoC,CAChC,KAAK,QAAL,CAAc,CAAE,oBAAoB,CAAE,KAAxB,CAAd,EACH,CACJ,CACJ,CArBO,CAuBA,KAAA,sBAAA,CAAyB,IAAW,CACxC,KAAM,CACF,OAAO,CAAE,CAAE,aAAF,CADP,CAEF,IAAI,CAAE,CAAE,WAAF,CAFJ,EAGF,KAAK,KAHT,CAKA,GAAI,KAAK,eAAL,CAAqB,OAArB,EAAgC,KAAK,eAAL,CAAqB,OAArB,CAA6B,KAA7B,CAAmC,MAAnC,CAA4C,CAAhF,CAAmF,CAC/E,WAAW,CAAC,UAAZ,CAAyB,EAAzB,CACA,WAAW,CAAC,qBAAZ,CAAoC,EAApC,CACA,WAAW,CAAC,0BAAZ,CAAyC,EAAzC,CACA,aAAa,CAAG,aAAa,CAAC,MAAd,CAAqB,sBAAsB,CAAC,WAAD,CAA3C,CAA0D,WAA1D,CAAH,CAA4E,IAAzF,CACA,KAAK,eAAL,CAAqB,OAArB,CAA6B,KAA7B,CAAqC,EAArC,CACH,CAED,KAAK,QAAL,CAAc,CAAE,UAAU,CAAE,EAAd,CAAkB,WAAW,CAAE,SAA/B,CAA0C,cAAc,CAAE,SAA1D,CAAd,EACH,CAfO,CAiBA,KAAA,kBAAA,CAAsB,KAAD,EAAwB,CACjD,GAAI,CAAC,KAAD,EAAU,KAAK,CAAC,MAAN,CAAe,KAAK,QAAlC,CAA4C,CACxC,KAAK,QAAL,CAAc,CAAE,UAAU,CAAE,KAAd,CAAd,EACH,CAED,GAAI,KAAK,mBAAT,CAA8B,CAC1B,KAAK,mBAAL,CAAyB,MAAzB,GACH,CAED,KAAM,CACF,SADE,CAEF,OAFE,CAGF,IAAI,CAAE,CAAE,WAAF,CAHJ,EAIF,KAAK,KAJT,CAMA,GAAI,OAAJ,CAAa,CACT,GAAI,KAAK,EAAI,KAAK,CAAC,MAAN,CAAe,CAA5B,CAA+B,CAC3B,GAAI,KAAK,CAAC,MAAN,CAAe,KAAK,QAAxB,CAAkC,CAC9B,OACH,CAED,KAAK,mBAAL,CAA2B,UAAS,IAAK,CACrC,0BAA0B,CACtB,GAAI,CAAA,gBAAJ,CACI,KADJ,CAEI,KAAK,eAFT,CAGI,KAAK,kBAAL,CAAwB,KAAK,mBAA7B,CAHJ,CAII,KAAK,SAJT,CAKI,KAAK,SALT,CADsB,CAQtB,OAAO,CAAC,aARc,CAA1B,CAUK,IAVL,CAUU,OAAO,EAAG,CACZ,KAAK,kBAAL,CAAwB,KAAxB,EACK,IADL,CACU,QAAQ,EAAG,CACb,KAAK,QAAL,CAAc,CAAE,WAAW,CAAE,OAAf,CAAwB,cAAc,CAAE,QAAxC,CACV,oBAAoB,CAAE,KAAK,0BAAL,CAAgC,OAAhC,CADZ,CAAd,EAEH,CAJL,EAKK,KALL,CAKW,KAAK,EAAG,CACX,KAAK,QAAL,CAAc,CAAE,WAAW,CAAE,OAAf,CAAwB,cAAc,CAAE,SAAxC,CACV,oBAAoB,CAAE,KAAK,0BAAL,CAAgC,OAAhC,CADZ,CAAd,EAEA,SAAS,CAAC,SAAV,CAAoB,KAApB,EACA,SAAS,CAAC,KAAV,CAAgB,gCAAhB,EACH,CAVL,EAWH,CAtBL,EAuBK,KAvBL,CAuBW,KAAK,EAAG,CACX,KAAK,QAAL,CAAc,CAAE,WAAW,CAAE,SAAf,CAA0B,cAAc,CAAE,SAA1C,CACV,oBAAoB,CAAE,KAAK,0BAAL,EADZ,CAAd,EAEA,SAAS,CAAC,SAAV,CAAoB,KAApB,EACA,SAAS,CAAC,KAAV,CAAgB,oCAAhB,EACH,CA5BL,EA6BH,CA9B0B,CA8BS,KAAK,QA9Bd,CAA3B,CAgCA,UAAU,CAAC,IAAK,CACZ,KAAK,mBAAL,GACH,CAFS,CAEC,CAFD,CAAV,CAIA,WAAW,CAAC,UAAZ,CAAyB,KAAzB,CACH,CA1CD,IA0CO,CACH,KAAK,QAAL,CAAc,CAAE,WAAW,CAAE,SAAf,CAA0B,cAAc,CAAE,SAA1C,CAAd,EACA,WAAW,CAAC,UAAZ,CAAyB,EAAzB,CACH,CACD,OAAO,CAAC,aAAR,CAAsB,MAAtB,CAA6B,sBAAsB,CAAC,WAAD,CAAnD,CAAkE,WAAlE,EACH,CACJ,CAhEO,CAkEA,KAAA,kBAAA,CAAsB,eAAD,EAA6D,CACtF,GAAI,eAAe,EAAI,eAAe,CAAC,MAAhB,CAAyB,CAAhD,CAAmD,CAC/C,KAAM,CAAA,uBAAuB,CAAa,EAA1C,CACA,eAAe,EAAI,eAAe,CAAC,OAAhB,CAAwB,CAAC,kBAAD,CAAqB,KAArB,GAA8B,CACrE,kBAAkB,CAAC,cAAnB,EAAqC,uBAAuB,CAAC,IAAxB,CAA6B,kBAAkB,CAAC,cAAnB,CAAkC,MAAlC,CAAyC,CAAzC,EAA4C,WAA5C,GAA4D,kBAAkB,CAAC,cAAnB,CAAkC,KAAlC,CAAwC,CAAxC,CAAzF,CAArC,CACH,CAFkB,CAAnB,CAGA,MAAO,CAAA,uBAAuB,CAAC,IAAxB,CAA6B,GAA7B,CAAP,CACH,CACD,MAAO,kCAAP,CACH,CATO,CAyBA,KAAA,aAAA,CACJ,CADoB,EAEd,CACN,KAAM,CACF,MAAM,CAAE,CAAE,mBAAF,CADN,CAEF,OAAO,CAAE,CACL,aADK,CAEL,GAAG,CAAE,CACD,MAAM,CAAE,CAAE,0BAAF,CADP,CAFA,CAFP,EAQF,KAAK,KART,CAUA,KAAM,CAAA,KAAK,CAAG,KAAK,eAAL,CAAqB,OAArB,EAAgC,KAAK,eAAL,CAAqB,OAArB,CAA6B,KAA3E,CACA,CAAC,CAAC,cAAF,GAEA,GAAI,CAAC,KAAD,EAAW,KAAK,EAAI,KAAK,CAAC,MAAN,GAAiB,CAArC,EAA2C,mBAA/C,CAAoE,CAChE,KAAK,eAAL,EAAwB,KAAK,eAAL,CAAqB,OAA7C,EAAwD,KAAK,eAAL,CAAqB,OAArB,CAA6B,KAA7B,EAAxD,CACH,CAFD,IAEO,CACH,KAAM,CAAA,SAAS,CAAG,0BAA0B,EAAI,GAAhD,CACA,KAAM,CAAA,SAAS,CAAG,KAAK,kBAAL,CAAwB,UAAU,CAAC,QAAD,CAAW,aAAX,CAAV,EAAuC,EAA/D,CAAmE,KAAnE,CAA0E,SAA1E,CAAlB,CACA,QAAQ,CAAC,QAAT,CAAkB,IAAlB,CAAyB,SAAzB,CACH,CACJ,CAvBO,CAyBA,KAAA,yBAAA,CAA4B,IAAW,CAC3C,KAAM,CAAE,oBAAF,CAAwB,WAAxB,EAAwC,KAAK,KAAnD,CAEA,GAAI,CAAC,oBAAL,CAA2B,CACvB,KAAK,QAAL,CAAc,CACV,oBAAoB,CAAE,IADZ,CAEV,UAAU,CAAE,EAFF,CAGV,cAAc,CAAE,KAHN,CAAd,EAKH,CAND,IAMO,CACH,GAAI,WAAW,EAAI,WAAW,CAAC,gBAA/B,CAAiD,CAC7C,KAAK,sBAAL,GACH,CAED,KAAK,QAAL,CAAc,CAAE,oBAAoB,CAAE,KAAxB,CAAd,EACH,CACJ,CAhBO,CAkBA,KAAA,kBAAA,CAAqB,CAAC,KAAD,CAAgB,KAAhB,CAA+B,GAA/B,GAAsD,CAC/E,GAAI,KAAK,EAAI,KAAK,CAAC,MAAN,CAAe,CAA5B,CAA+B,CAC3B,MAAO,CAAA,KAAK,EAAI,KAAK,CAAC,MAAN,CAAe,CAAxB,WAA+B,KAA/B,SAAuC,KAAK,CAAC,OAAN,CAAc,GAAd,IAAuB,CAAC,CAAxB,CAA4B,GAA5B,CAAkC,GAAzE,SAA+E,GAA/E,aAAsF,KAAtF,EAAgG,KAAvG,CACH,CACD,MAAO,EAAP,CACH,CALO,CAOA,KAAA,0BAAA,CAA8B,MAAD,EAA6B,CAC9D,GAAI,KAAK,gCAAL,CAAsC,OAAtC,GAAkD,IAAtD,CAA4D,CACxD,KAAM,CAAA,cAAc,CAAG,KAAK,gCAAL,CAAsC,OAA7D,CACA,KAAM,CAAA,mBAAmB,CAAG,KAAK,KAAL,CAAW,SAAX,CAAqB,uBAAjD,CACA,KAAM,CAAA,iBAAiB,CAAG,KAAK,KAAL,CAAW,SAAX,CAAqB,uBAA/C,CACA,cAAc,CAAC,SAAf,CAA2B,MAAM,EAAK,MAAM,CAAC,gBAAP,EAA2B,MAAM,CAAC,gBAAP,CAAwB,MAAxB,CAAiC,CAAvE,CAA4E,mBAA5E,CAAkG,iBAA7H,CACA,cAAc,CAAC,YAAf,CAA4B,WAA5B,CAAwC,WAAxC,EACA,MAAO,CAAA,cAAc,CAAC,SAAtB,CACH,CAPD,IAOO,CACH,MAAO,EAAP,CACH,CACJ,CAXO,CApaJ,KAAK,eAAL,cAAuB,KAAK,CAAC,SAAN,EAAvB,CACA,KAAK,oBAAL,cAA4B,KAAK,CAAC,SAAN,EAA5B,CACA,KAAK,gCAAL,cAAwC,KAAK,CAAC,SAAN,EAAxC,CACA,KAAK,oBAAL,cAA4B,KAAK,CAAC,SAAN,EAA5B,CACA,KAAK,aAAL,cAAqB,KAAK,CAAC,SAAN,EAArB,CACA,KAAK,KAAL,CAAa,CACT,oBAAoB,CAAE,KADb,CAET,UAAU,CAAE,EAFH,CAGT,yBAAyB,CAAE,iCAHlB,CAIT,yBAAyB,CAAE,iCAJlB,CAKT,0BAA0B,CAAE,kCALnB,CAMT,WAAW,CAAE,SANJ,CAOT,cAAc,CAAE,SAPP,CAQT,oBAAoB,CAAE,EARb,CAST,cAAc,CAAE,IATP,CAAb,CAWA,KAAK,QAAL,CACK,KAAK,KAAL,CAAW,OAAX,EACG,KAAK,KAAL,CAAW,OAAX,CAAmB,GADtB,EAEG,KAAK,KAAL,CAAW,OAAX,CAAmB,GAAnB,CAAuB,MAF1B,EAGG,KAAK,KAAL,CAAW,OAAX,CAAmB,GAAnB,CAAuB,MAAvB,CAA8B,oBAHlC,EAIA,EALJ,CAMA,KAAK,mBAAL,CAA2B,KAAK,KAAL,CAAW,MAAX,EAAqB,KAAK,KAAL,CAAW,MAAX,CAAkB,uBAAlE,CACA,KAAK,eAAL,CAAuB,KAAK,KAAL,CAAW,MAAX,EAAqB,KAAK,KAAL,CAAW,MAAX,CAAkB,eAAvC,CAAyD,KAAK,KAAL,CAAW,MAAX,CAAkB,eAA3E,CAA6F,CAApH,CACA,KAAK,eAAL,CAAuB,iBAAvB,CACA,KAAK,gBAAL,CAAwB,kBAAxB,CACA,KAAK,gBAAL,CAAwB,kBAAkB,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,iBAA5B,CAAgD,KAAK,KAAL,CAAW,YAA3D,CAAyE,KAAK,KAAL,CAAW,SAApF,CAA1C,CACH,CAEM,KAAM,CAAA,iBAAN,EAAuB,CAC1B,QAAQ,CAAC,IAAT,EAAiB,QAAQ,CAAC,IAAT,CAAc,gBAAd,CAA+B,WAA/B,CAA4C,KAAK,eAAjD,CAAjB,CACA,MAAM,EAAI,MAAM,CAAC,gBAAP,CAAwB,OAAxB,CAAiC,KAAK,MAAtC,CAAV,CACH,CAEM,oBAAoB,EAAA,CACvB,QAAQ,CAAC,IAAT,EAAiB,QAAQ,CAAC,IAAT,CAAc,mBAAd,CAAkC,WAAlC,CAA+C,KAAK,eAApD,CAAqE,KAArE,CAAjB,CACA,MAAM,EAAI,MAAM,CAAC,mBAAP,CAA2B,OAA3B,CAAoC,KAAK,MAAzC,CAAiD,KAAjD,CAAV,CACH,CAEM,kBAAkB,EAAA,CACrB,KAAM,CACF,MAAM,CAAE,CAAE,eAAF,CADN,EAEF,KAAK,KAFT,CAGA,KAAM,CAAE,oBAAF,CAAwB,cAAxB,EAA2C,KAAK,KAAtD,CAEA,GAAI,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,MAA3B,CAAkC,QAAvC,CAAiD,CAC7C,GAAI,CAAC,eAAD,EAAoB,oBAAxB,CAA8C,CAC1C,KAAK,eAAL,EAAwB,KAAK,eAAL,CAAqB,OAA7C,EAAwD,KAAK,eAAL,CAAqB,OAArB,CAA6B,KAA7B,EAAxD,CACH,CAFD,IAEO,IAAI,CAAC,cAAL,CAAqB,CACxB,KAAK,oBAAL,EAA6B,KAAK,oBAAL,CAA0B,OAAvD,EAAkE,KAAK,oBAAL,CAA0B,OAA1B,CAAkC,KAAlC,EAAlE,CACH,CACJ,CACJ,CAGM,MAAM,EAAA,CACT,KAAM,CACF,OADE,CAEF,SAAS,CAAE,CAAE,UAAF,CAAc,qBAAd,CAAqC,kBAArC,CAAyD,kBAAzD,CAA6E,kBAA7E,CAFT,CAGF,MAAM,CAAE,CAAE,eAAF,CAAmB,mBAAnB,CAAwC,qBAAxC,CAA+D,SAAS,CAAG,EAA3E,CAHN,EAIF,KAAK,KAJT,CAMA,KAAM,CACF,oBADE,CAEF,UAFE,CAGF,yBAHE,CAIF,yBAJE,CAKF,0BALE,CAMF,WANE,CAOF,cAPE,EAQF,KAAK,KART,CAUA,KAAM,CAAA,SAAS,CAAI,OAAO,EAAI,OAAO,CAAC,GAAnB,EAA0B,OAAO,CAAC,GAAR,CAAY,MAAtC,EAAgD,OAAO,CAAC,GAAR,CAAY,MAAZ,CAAmB,0BAApE,EAAmG,GAArH,CACA,KAAM,CAAA,aAAa,CAAG,UAAU,CAAC,QAAD,CAAW,OAAO,EAAI,OAAO,CAAC,aAA9B,CAAV,EAA0D,EAAhF,CACA,KAAM,CAAA,SAAS,CAAG,KAAK,kBAAL,CAAwB,aAAxB,CAAuC,UAAvC,CAAmD,SAAnD,CAAlB,CACA,KAAM,CAAA,iBAAiB,CAAG,qBAAqB,EAAI,qBAAqB,CAAC,MAAtB,CAA+B,CAAxD,CAA4D,qBAA5D,CAAoF,oBAA9G,CAEA,KAAM,CAAA,kBAAkB,CACpB,WAAW,EACX,WAAW,CAAC,gBADZ,EAEA,WAAW,CAAC,gBAAZ,CAA6B,MAA7B,CACI,CAAC,EAAI,CAAC,CAAC,cAAF,GAAgB,SAAhB,EAA+C,CAAC,CAAC,cAAF,GAAgB,MADxE,CAHJ,CAMA,KAAM,CAAA,kBAAkB,CACpB,WAAW,EACX,WAAW,CAAC,gBADZ,EAEA,WAAW,CAAC,gBAAZ,CAA6B,MAA7B,CAAoC,CAAC,EAAI,CAAC,CAAC,cAAF,GAAgB,SAAzD,CAHJ,CAIA,KAAM,CAAA,mBAAmB,CACrB,WAAW,EACX,WAAW,CAAC,gBADZ,EAEA,WAAW,CAAC,gBAAZ,CAA6B,MAA7B,CAAoC,CAAC,EAAI,CAAC,CAAC,cAAF,GAAgB,gBAAzD,CAHJ,CAKA,KAAM,CAAA,SAAS,gCACP,KAAK,KADE,MAGX,MAAM,CAAE,CACJ,WAAW,CAAE,KAAK,KADd,CAEJ,SAAS,WAAK,UAAU,CAAC,WAAD,CAAc,SAAd,CAAf,aAA2C,mBAAmB,CAAG,WAAH,CAAiB,aAA/E,CAFL,CAHG,CAOX,oBAAoB,CAAE,CAClB,GAAG,CAAE,KADa,CAElB,SAAS,CAAE,gCAFO,CAGlB,YAAa,WAHK,CAIlB,GAAG,CAAE,KAAK,gCAJQ,CAPX,CAaX,wBAAwB,CAAE,KAAK,KAAL,CAAW,oBAb1B,CAcX,UAAU,CAAE,KAAK,KAAL,CAAW,UAdZ,CAeX,WAAW,CAAE,CACT,GAAG,CAAE,KAAK,oBADD,CAET,SAAS,CAAE,wBAFF,CAfF,CAmBX,cAAc,CAAE,CACZ,SAAS,CAAE,yBADC,CAnBL,CAsBX,cAAc,CAAE,CACZ,SAAS,CAAE,yBADC,CAtBL,CAyBX,eAAe,CAAE,CACb,SAAS,CAAE,0BADE,CAzBN,CA4BX,UAAU,CAAE,CACR,SAAS,WAAK,KAAK,eAAV,aAA6B,oBAAoB,CAAG,SAAH,CAAe,SAAhE,CADD,CA5BD,CA+BX,WAAW,CAAE,CACT,GAAG,CAAE,MADI,CAET,GAAG,CAAE,KAAK,aAFD,CAGT,SAAS,CAAE,uBAHF,CAIT,aAAc,QAJL,CAKT,IAAI,CAAE,YALG,CAMT,IAAI,CAAE,QANG,CAOT,MAAM,CAAE,SAPC,CAQT,YAAY,CAAE,KARL,CAST,QAAQ,CAAE,KAAK,aATN,CA/BF,CA0CX,SAAS,CAAE,CACP,GAAG,CAAE,IADE,CAEP,SAAS,CAAE,UAAU,CAAC,uCAAD,CAA0C,SAA1C,CAFd,CA1CA,CA8CX,SAAS,CAAE,CACP,GAAG,CAAE,IADE,CAEP,SAAS,CAAE,UAAU,CAAC,uCAAD,CAA0C,SAA1C,CAFd,CA9CA,CAkDX,UAAU,CAAE,CACR,GAAG,CAAE,IADG,CAER,SAAS,CAAE,UAAU,CAAC,wCAAD,CAA2C,SAA3C,CAFb,CAlDD,CAsDX,KAAK,CAAC,cAAc,CAAC,CACjB,oBAAoB,CAAE,oBADL,CAEjB,gBAAgB,WAAK,KAAK,gBAAV,aAA8B,oBAAoB,CAAG,SAAH,CAAe,SAAjE,CAFC,CAGjB,UAAU,CAAE,UAHK,CAIjB,qBAAqB,CAAE,qBAJN,CAKjB,oBAAoB,CAAE,KAAK,oBALV,CAMjB,eAAe,CAAE,eANA,CAOjB,wBAAwB,CAAE,KAAK,yBAPd,CAQjB,gBAAgB,CAAE,KAAK,gBARN,CAAD,CAtDT,CAgEX,IAAI,CAAE,aAAa,CAAC,CAChB,eAAe,CAAE,kBADD,CAEhB,eAAe,CAAE,kBAFD,CAGhB,eAAe,CAAE,kBAHD,CAIhB,eAAe,CAAE,eAJD,CAKhB,eAAe,CAAE,KAAK,eALN,CAMhB,oBAAoB,CAAE,oBANN,CAOhB,mBAAmB,CAAE,mBAPL,CAQhB,iBAAiB,CAAE,KAAK,kBARR,CAShB,wBAAwB,CAAE,KAAK,yBATf,CAUhB,QAAQ,CAAE,KAAK,QAVC,CAWhB,SAAS,CAAE,SAXK,CAYhB,iBAAiB,CAAE,iBAZH,CAahB,KAAK,CAAE,UAbS,CAAD,CAhER,CA+EX,kBAAkB,CACd,UAAU,EAAI,UAAU,CAAC,MAAX,CAAoB,CAAlC,EAAuC,kBAAvC,EAA6D,kBAAkB,CAAC,MAAnB,CAA4B,CAAzF,CACM,2BAA2B,CAAC,CACxB,yBAAyB,CAAE,yBADH,CAExB,aAAa,CAAE,aAFS,CAGxB,SAAS,CAAE,SAHa,CAIxB,SAAS,CAAE,KAAK,SAJQ,CAKxB,SAAS,CAAE,KAAK,SALQ,CAMxB,gBAAgB,CAAE,KAAK,KANC,CAOxB,UAAU,CAAE,UAPY,CAQxB,WAAW,CAAE,kBARW,CASxB,gBAAgB,CAAE,KAAK,gBATC,CAAD,CADjC,CAYM,SA5FC,CA6FX,kBAAkB,CACd,UAAU,EAAI,UAAU,CAAC,MAAX,CAAoB,CAAlC,EAAuC,kBAAvC,EAA6D,kBAAkB,CAAC,MAAnB,CAA4B,CAAzF,CACM,2BAA2B,CAAC,CACxB,yBAAyB,CAAE,yBADH,CAExB,aAAa,CAAE,aAFS,CAGxB,SAAS,CAAE,SAHa,CAIxB,SAAS,CAAE,KAAK,SAJQ,CAKxB,SAAS,CAAE,KAAK,SALQ,CAMxB,gBAAgB,CAAE,KAAK,KANC,CAOxB,UAAU,CAAE,UAPY,CAQxB,WAAW,CAAE,kBARW,CASxB,SAAS,CAAE,KAAK,KAAL,CAAW,SATE,CAUxB,UAAU,CAAE,KAAK,KAAL,CAAW,QAVC,CAWxB,QAAQ,CAAE,KAAK,KAAL,CAAW,EAXG,CAYxB,gBAAgB,CAAE,KAAK,gBAZC,CAAD,CADjC,CAeM,SA7GC,CA8GX,mBAAmB,CACf,UAAU,EAAI,UAAU,CAAC,MAAX,CAAoB,CAAlC,EAAuC,mBAAvC,EAA8D,mBAAmB,CAAC,MAApB,CAA6B,CAA3F,CACM,4BAA4B,CAAC,CACzB,0BAA0B,CAAE,0BADH,CAEzB,aAAa,CAAE,aAFU,CAGzB,SAAS,CAAE,SAHc,CAIzB,SAAS,CAAE,KAAK,SAJS,CAKzB,SAAS,CAAE,KAAK,SALS,CAMzB,gBAAgB,CAAE,KAAK,KANE,CAOzB,UAAU,CAAE,UAPa,CAQzB,WAAW,CAAE,mBARY,CASzB,cAAc,CAAE,cATS,CAUzB,gBAAgB,CAAE,KAAK,gBAVE,CAAD,CADlC,CAaM,SA5HC,CA6HX,SAAS,CAAE,CACP,wBAAwB,CAAE,KAAK,yBADxB,CA7HA,CAgIX,oBAAoB,CAAE,KAAK,KAAL,CAAW,oBAhItB,EAAf,CAmIA,MAAO,MAAK,KAAL,CAAW,UAAX,CAAsB,SAAtB,CAAP,CACH,CAoIO,KAAM,CAAA,kBAAN,CAAyB,UAAzB,CAA2C,CAC/C,KAAM,CAAE,aAAa,CAAE,GAAjB,EAAyB,KAAK,KAAL,CAAW,OAA1C,CACA,MAAO,CAAA,6BAA6B,CAChC,CAAE,aAAa,CAAE,GAAjB,CADgC,CAEhC,CACI,eAAe,CAAE,UADrB,CAEI,OAAO,CAAE,CACL,SAAS,CAAE,CAAC,GAAG,CAAC,cAAJ,CAAmB,WAAnB,CAA+B,SADtC,CAEL,SAAS,CAAE,CAAC,GAAG,CAAC,cAAJ,CAAmB,WAAnB,CAA+B,SAFtC,CAFb,CAFgC,CAApC,CAUH,CApYwE,CAsc7E,cAAe,CAAA,MAAf","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createSearchStateInput } from '@msdyn365-commerce-modules/search-utilities';\nimport { getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, KeyCodes } from '@msdyn365-commerce-modules/utilities';\nimport { Autosuggestions } from '@msdyn365-commerce/commerce-entities';\nimport { getUrlSync } from '@msdyn365-commerce/core';\nimport { ProductRefiner } from '@msdyn365-commerce/retail-proxy';\nimport { getProductSearchRefinersAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport classnames from 'classnames';\nimport { debounce } from 'lodash';\nimport * as React from 'react';\n\nimport getSearchSuggestionsAction, { AutoSuggestInput, SuggestionType } from './actions/get-auto-suggest-suggestions';\nimport {\n    CategorySuggestionsComponent,\n    FormComponent,\n    ISearchCategoryViewProps,\n    ISearchKeywordViewProps,\n    ISearchProductViewProps,\n    KeywordSuggestionsComponent,\n    LabelComponent,\n    ProductSuggestionsComponent\n} from './components';\nimport { ISearchData } from './search.data';\nimport { ISearchProps, ISuggestionTypeCriterionData } from './search.props.autogenerated';\n\nexport interface ISearchState {\n    isSearchFormExpanded: boolean;\n    searchText: string;\n    searchKeywordSuggestClass: string;\n    searchProductSuggestClass: string;\n    searchCategorySuggestClass: string;\n    suggestions: Autosuggestions | undefined;\n    searchRefiners?: ProductRefiner[] | undefined;\n    autoSuggestAriaLabel: string;\n    isInitialState: boolean;\n}\n\nexport interface ISearchViewProps extends ISearchProps<ISearchData> {\n    Search: IModuleProps;\n    AutoSuggestAriaLabel: INodeProps;\n    AutoSuggestAriaLabelText: string;\n    searchText: string;\n    AutoSuggest: INodeProps;\n    KeywordSuggest: INodeProps;\n    ProductSuggest: INodeProps;\n    CategorySuggest: INodeProps;\n    SearchForm: INodeProps;\n    FormWrapper: INodeProps;\n    UlKeyword: INodeProps;\n    UlProduct: INodeProps;\n    UlCategory: INodeProps;\n    label: React.ReactNode;\n    form: React.ReactNode;\n    autosuggestKeyword?: ISearchKeywordViewProps;\n    autosuggestProduct?: ISearchProductViewProps;\n    autosuggestCategory?: ISearchCategoryViewProps;\n    callbacks: {\n        handleCancelSearchChange(): void;\n    };\n    isSearchFormExpanded: boolean;\n}\n\n/**\n *\n * Search module\n * @extends {React.Component<ISearchProps<ISearchData>, ISearchState>}\n */\nclass Search extends React.Component<ISearchProps<ISearchData>, ISearchState> {\n    private searchTextInput: React.RefObject<HTMLInputElement>;\n    private searchCollapsedLabel: React.RefObject<HTMLButtonElement>;\n    private formReference: React.RefObject<HTMLButtonElement>;\n    private maxChars: number;\n    private inputSuggestionType?: ISuggestionTypeCriterionData[];\n    private topResultsCount?: number;\n    private hitPrefix: string = '{';\n    private hitSuffix: string = '}';\n    private waitTime: number = 500;\n    private autoSuggestResultScreenReaderDiv: React.RefObject<HTMLDivElement>;\n    private autoSuggestResultDiv: React.RefObject<HTMLDivElement>;\n    private searchFormClass: string;\n    private searchLabelClass: string;\n    private telemetryContent: ITelemetryContent;\n    // @ts-ignore\n    private cancellabelDebounce: debounce;\n\n    constructor(props: ISearchProps<ISearchData>) {\n        super(props);\n        this.searchTextInput = React.createRef();\n        this.searchCollapsedLabel = React.createRef();\n        this.autoSuggestResultScreenReaderDiv = React.createRef();\n        this.autoSuggestResultDiv = React.createRef();\n        this.formReference = React.createRef();\n        this.state = {\n            isSearchFormExpanded: false,\n            searchText: '',\n            searchKeywordSuggestClass: 'ms-search__autoSuggest__keyword',\n            searchProductSuggestClass: 'ms-search__autoSuggest__product',\n            searchCategorySuggestClass: 'ms-search__autoSuggest__category',\n            suggestions: undefined,\n            searchRefiners: undefined,\n            autoSuggestAriaLabel: '',\n            isInitialState: true\n        };\n        this.maxChars =\n            (this.props.context &&\n                this.props.context.app &&\n                this.props.context.app.config &&\n                this.props.context.app.config.searchInputMaxLength) ||\n            50;\n        this.inputSuggestionType = this.props.config && this.props.config.suggestionTypeCriterion;\n        this.topResultsCount = this.props.config && this.props.config.topResultsCount ? this.props.config.topResultsCount : 5;\n        this.searchFormClass = 'ms-search__form';\n        this.searchLabelClass = 'ms-search__label';\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public async componentDidMount(): Promise<void> {\n        document.body && document.body.addEventListener('mousedown', this._focusOutTarget);\n        window && window.addEventListener('keyup', this._keyup);\n    }\n\n    public componentWillUnmount(): void {\n        document.body && document.body.removeEventListener('mousedown', this._focusOutTarget, false);\n        window && window.removeEventListener('keyup', this._keyup, false);\n    }\n\n    public componentDidUpdate(): void {\n        const {\n            config: { hideSearchLabel }\n        } = this.props;\n        const { isSearchFormExpanded, isInitialState } = this.state;\n\n        if (!this.props.context.request.params.isEditor) {\n            if (!hideSearchLabel && isSearchFormExpanded) {\n                this.searchTextInput && this.searchTextInput.current && this.searchTextInput.current.focus();\n            } else if (!isInitialState) {\n                this.searchCollapsedLabel && this.searchCollapsedLabel.current && this.searchCollapsedLabel.current.focus();\n            }\n        }\n    }\n\n    // tslint:disable-next-line: cyclomatic-complexity max-func-body-length\n    public render(): JSX.Element {\n        const {\n            context,\n            resources: { searchtext, searchLabelArialLabel, cancelBtnAriaLabel, searchBtnAriaLabel, submitBtnAriaLabel},\n            config: { hideSearchLabel, disableSubmitSearch, searchplaceholderText, className = '' }\n        } = this.props;\n\n        const {\n            isSearchFormExpanded,\n            searchText,\n            searchKeywordSuggestClass,\n            searchProductSuggestClass,\n            searchCategorySuggestClass,\n            suggestions,\n            searchRefiners\n        } = this.state;\n\n        const searchQsp = (context && context.app && context.app.config && context.app.config.searchQueryStringParameter) || 'q';\n        const searchPageURL = getUrlSync('search', context && context.actionContext) || '';\n        const searchURL = this._appendQueryParams(searchPageURL, searchText, searchQsp);\n        const searchPlaceholder = searchplaceholderText && searchplaceholderText.length > 0 ? searchplaceholderText : 'Search in Fabrikam';\n\n        const keywordSuggestions =\n            suggestions &&\n            suggestions.AllSearchResults &&\n            suggestions.AllSearchResults.filter(\n                i => i.SuggestionType === SuggestionType.Keyword || i.SuggestionType === SuggestionType.None\n            );\n        const productSuggestions =\n            suggestions &&\n            suggestions.AllSearchResults &&\n            suggestions.AllSearchResults.filter(i => i.SuggestionType === SuggestionType.Product);\n        const categorySuggestions =\n            suggestions &&\n            suggestions.AllSearchResults &&\n            suggestions.AllSearchResults.filter(i => i.SuggestionType === SuggestionType.Category);\n\n        const viewProps: ISearchViewProps = {\n            ...(this.props as ISearchProps<ISearchData>),\n\n            Search: {\n                moduleProps: this.props,\n                className: `${classnames('ms-search', className)} ${disableSubmitSearch ? 'no-submit' : 'with-submit'}`,\n            },\n            AutoSuggestAriaLabel: {\n                tag: 'div',\n                className: 'msc-autoSuggest__screen-reader',\n                'aria-live': 'assertive',\n                ref: this.autoSuggestResultScreenReaderDiv\n            },\n            AutoSuggestAriaLabelText: this.state.autoSuggestAriaLabel,\n            searchText: this.state.searchText,\n            AutoSuggest: {\n                ref: this.autoSuggestResultDiv,\n                className: 'ms-search__autoSuggest'\n            },\n            KeywordSuggest: {\n                className: searchKeywordSuggestClass\n            },\n            ProductSuggest: {\n                className: searchProductSuggestClass\n            },\n            CategorySuggest: {\n                className: searchCategorySuggestClass\n            },\n            SearchForm: {\n                className: `${this.searchFormClass} ${isSearchFormExpanded ? 'bx-show' : 'bx-hide'}`\n            },\n            FormWrapper: {\n                tag: 'form',\n                ref: this.formReference,\n                className: 'ms-search__searchForm',\n                'aria-label': 'Search',\n                name: 'searchForm',\n                role: 'Search',\n                action: searchURL,\n                autoComplete: 'off',\n                onSubmit: this._handleSubmit\n            },\n            UlKeyword: {\n                tag: 'ul',\n                className: classnames('msc-autoSuggest__keywordResults-items', className)\n            },\n            UlProduct: {\n                tag: 'ul',\n                className: classnames('msc-autoSuggest__productResults-items', className)\n            },\n            UlCategory: {\n                tag: 'ul',\n                className: classnames('msc-autoSuggest__categoryResults-items', className)\n            },\n            label:LabelComponent({\n                isSearchFormExpanded: isSearchFormExpanded,\n                searchLabelClass: `${this.searchLabelClass} ${isSearchFormExpanded ? 'bx-hide' : 'bx-show'}`,\n                searchtext: searchtext,\n                searchLabelArialLabel: searchLabelArialLabel,\n                searchCollapsedLabel: this.searchCollapsedLabel,\n                hideSearchLabel: hideSearchLabel,\n                handleCancelSearchChange: this._handleCancelSearchChange,\n                telemetryContent: this.telemetryContent\n            }),\n            form: FormComponent({\n                ariaLabelCancel: cancelBtnAriaLabel,\n                ariaLabelSearch: searchBtnAriaLabel,\n                ariaLabelSubmit: submitBtnAriaLabel,\n                hideSearchLabel: hideSearchLabel,\n                searchTextInput: this.searchTextInput,\n                isSearchFormExpanded: isSearchFormExpanded,\n                disableSubmitSearch: disableSubmitSearch,\n                handleInputChange: this._handleInputChange,\n                handleCancelSearchChange: this._handleCancelSearchChange,\n                maxChars: this.maxChars,\n                searchQsp: searchQsp,\n                searchPlaceholder: searchPlaceholder,\n                query: searchText\n            }),\n            autosuggestKeyword:\n                searchText && searchText.length > 0 && keywordSuggestions && keywordSuggestions.length > 0\n                    ? KeywordSuggestionsComponent({\n                          searchKeywordSuggestClass: searchKeywordSuggestClass,\n                          searchPageURL: searchPageURL,\n                          searchQsp: searchQsp,\n                          hitPrefix: this.hitPrefix,\n                          hitSuffix: this.hitSuffix,\n                          autoSuggestProps: this.props,\n                          searchText: searchText,\n                          suggestions: keywordSuggestions,\n                          telemetryContent: this.telemetryContent\n                      })\n                    : undefined,\n            autosuggestProduct:\n                searchText && searchText.length > 0 && productSuggestions && productSuggestions.length > 0\n                    ? ProductSuggestionsComponent({\n                          searchProductSuggestClass: searchProductSuggestClass,\n                          searchPageURL: searchPageURL,\n                          searchQsp: searchQsp,\n                          hitPrefix: this.hitPrefix,\n                          hitSuffix: this.hitSuffix,\n                          autoSuggestProps: this.props,\n                          searchText: searchText,\n                          suggestions: productSuggestions,\n                          telemetry: this.props.telemetry,\n                          moduleType: this.props.typeName,\n                          moduleId: this.props.id,\n                          telemetryContent: this.telemetryContent\n                      })\n                    : undefined,\n            autosuggestCategory:\n                searchText && searchText.length > 0 && categorySuggestions && categorySuggestions.length > 0\n                    ? CategorySuggestionsComponent({\n                          searchCategorySuggestClass: searchCategorySuggestClass,\n                          searchPageURL: searchPageURL,\n                          searchQsp: searchQsp,\n                          hitPrefix: this.hitPrefix,\n                          hitSuffix: this.hitSuffix,\n                          autoSuggestProps: this.props,\n                          searchText: searchText,\n                          suggestions: categorySuggestions,\n                          searchRefiners: searchRefiners,\n                          telemetryContent: this.telemetryContent\n                      })\n                    : undefined,\n            callbacks: {\n                handleCancelSearchChange: this._handleCancelSearchChange\n            },\n            isSearchFormExpanded: this.state.isSearchFormExpanded\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    // tslint:disable-next-line:no-any\n    private _focusOutTarget = (e: any): void => {\n        const { suggestions } = this.state;\n\n        if (\n            suggestions &&\n            suggestions.AllSearchResults &&\n            e.target.closest('.ms-search') === null\n        ) {\n            this._clearAutoSuggestState();\n        }\n    };\n\n    private _keyup = (e: KeyboardEvent): void => {\n        const { suggestions } = this.state;\n\n        if (suggestions && suggestions.AllSearchResults && e.keyCode === KeyCodes.Escape) {\n            this._clearAutoSuggestState();\n        } else if(this.state.isSearchFormExpanded && e.keyCode === KeyCodes.Escape) {\n            if(this.state.isSearchFormExpanded) {\n                this.setState({ isSearchFormExpanded: false });\n            }\n        }\n\n        if (!((this.formReference.current && this.formReference.current.contains(e.target as unknown as Node)) ||\n        (this.autoSuggestResultDiv.current && this.autoSuggestResultDiv.current.contains(e.target as unknown as Node)))) {\n            if (suggestions && suggestions.AllSearchResults) {\n                this._clearAutoSuggestState();\n            }\n\n            if(this.state.isSearchFormExpanded) {\n                this.setState({ isSearchFormExpanded: false });\n            }\n        }\n    };\n\n    private _clearAutoSuggestState = (): void => {\n        const {\n            context: { actionContext },\n            data: { searchState }\n        } = this.props;\n\n        if (this.searchTextInput.current && this.searchTextInput.current.value.length > 0) {\n            searchState.searchText = '';\n            searchState.defaultBasicSearchUrl = '';\n            searchState.searchQueryStringParameter = '';\n            actionContext ? actionContext.update(createSearchStateInput(searchState), searchState) : null;\n            this.searchTextInput.current.value = '';\n        }\n\n        this.setState({ searchText: '', suggestions: undefined, searchRefiners: undefined });\n    };\n\n    private _handleInputChange = (query: string): void => {\n        if (!query || query.length < this.maxChars) {\n            this.setState({ searchText: query });\n        }\n\n        if (this.cancellabelDebounce) {\n            this.cancellabelDebounce.cancel();\n        }\n\n        const {\n            telemetry,\n            context,\n            data: { searchState }\n        } = this.props;\n\n        if (context) {\n            if (query && query.length > 0) {\n                if (query.length > this.maxChars) {\n                    return;\n                }\n\n                this.cancellabelDebounce = debounce(() => {\n                    getSearchSuggestionsAction(\n                        new AutoSuggestInput(\n                            query,\n                            this.topResultsCount,\n                            this._getSuggestionType(this.inputSuggestionType),\n                            this.hitPrefix,\n                            this.hitSuffix\n                        ),\n                        context.actionContext\n                    )\n                        .then(results => {\n                            this._getSearchRefiners(query)\n                                .then(refiners => {\n                                    this.setState({ suggestions: results, searchRefiners: refiners,\n                                        autoSuggestAriaLabel: this._setAutoSuggestResultCount(results) });\n                                })\n                                .catch(error => {\n                                    this.setState({ suggestions: results, searchRefiners: undefined,\n                                        autoSuggestAriaLabel: this._setAutoSuggestResultCount(results) });\n                                    telemetry.exception(error);\n                                    telemetry.debug('Unable to get refiners results');\n                                });\n                        })\n                        .catch(error => {\n                            this.setState({ suggestions: undefined, searchRefiners: undefined,\n                                autoSuggestAriaLabel: this._setAutoSuggestResultCount() });\n                            telemetry.exception(error);\n                            telemetry.debug('Unable to get auto suggest results');\n                        });\n                },                                  this.waitTime);\n\n                setTimeout(() => {\n                    this.cancellabelDebounce();\n                },         0);\n\n                searchState.searchText = query;\n            } else {\n                this.setState({ suggestions: undefined, searchRefiners: undefined });\n                searchState.searchText = '';\n            }\n            context.actionContext.update(createSearchStateInput(searchState), searchState);\n        }\n    };\n\n    private _getSuggestionType = (suggestionTypes?: ISuggestionTypeCriterionData[]): string => {\n        if (suggestionTypes && suggestionTypes.length > 0) {\n            const distinctSuggestionTypes: string[] = [];\n            suggestionTypes && suggestionTypes.forEach((suggestionTypeItem, index) => {\n                suggestionTypeItem.SuggestionType && distinctSuggestionTypes.push(suggestionTypeItem.SuggestionType.charAt(0).toUpperCase() + suggestionTypeItem.SuggestionType.slice(1));\n            });\n            return distinctSuggestionTypes.join(',');\n        }\n        return 'Keyword, Product, ScopedCategory';\n    };\n\n    private async _getSearchRefiners(searchText: string): Promise<ProductRefiner[]> {\n        const { actionContext: ctx } = this.props.context;\n        return getProductSearchRefinersAsync(\n            { callerContext: ctx },\n            {\n                SearchCondition: searchText,\n                Context: {\n                    ChannelId: +ctx.requestContext.apiSettings.channelId,\n                    CatalogId: +ctx.requestContext.apiSettings.catalogId\n                }\n            }\n        );\n    }\n\n    private _handleSubmit = (\n        e: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement> | React.FormEvent<HTMLFormElement>\n    ): void => {\n        const {\n            config: { disableSubmitSearch },\n            context: {\n                actionContext,\n                app: {\n                    config: { searchQueryStringParameter }\n                }\n            }\n        } = this.props;\n\n        const query = this.searchTextInput.current && this.searchTextInput.current.value;\n        e.preventDefault();\n\n        if (!query || (query && query.length === 0) || disableSubmitSearch) {\n            this.searchTextInput && this.searchTextInput.current && this.searchTextInput.current.focus();\n        } else {\n            const searchQsp = searchQueryStringParameter || 'q';\n            const searchURL = this._appendQueryParams(getUrlSync('search', actionContext) || '', query, searchQsp);\n            document.location.href = searchURL;\n        }\n    };\n\n    private _handleCancelSearchChange = (): void => {\n        const { isSearchFormExpanded, suggestions } = this.state;\n\n        if (!isSearchFormExpanded) {\n            this.setState({\n                isSearchFormExpanded: true,\n                searchText: '',\n                isInitialState: false\n            });\n        } else {\n            if (suggestions && suggestions.AllSearchResults) {\n                this._clearAutoSuggestState();\n            }\n\n            this.setState({ isSearchFormExpanded: false });\n        }\n    };\n\n    private _appendQueryParams = (route: string, query: string, qsp: string): string => {\n        if (route && route.length > 0) {\n            return query && query.length > 0 ? `${route}${route.indexOf('?') === -1 ? '?' : '&'}${qsp}=${query}` : route;\n        }\n        return '';\n    };\n\n    private _setAutoSuggestResultCount = (result?: Autosuggestions) => {\n        if (this.autoSuggestResultScreenReaderDiv.current !== null) {\n            const ariaLiveRegion = this.autoSuggestResultScreenReaderDiv.current;\n            const suggestResultString = this.props.resources.autoSuggestFoundMessage;\n            const emptyResultString = this.props.resources.noAutoSuggestionMessage;\n            ariaLiveRegion.innerText = result && (result.AllSearchResults && result.AllSearchResults.length > 0) ? suggestResultString : emptyResultString;\n            ariaLiveRegion.setAttribute('aria-live','assertive');\n            return ariaLiveRegion.innerText;\n        } else {\n            return '';\n        }\n    };\n}\n\nexport default Search;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}