{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{createObservableDataAction}from'@msdyn365-commerce/core';import{createGlobalState}from'../global-state/i-global-state';/**\r\n * Shared class that handles global state inputs\r\n */export var GlobalStateInput=function GlobalStateInput(key,stateConstructor,apiSettings){var _this=this;_classCallCheck(this,GlobalStateInput);this.getCacheKey=function(){return\"\".concat(_this.key,\"-chanId:\").concat(_this.apiSettings.channelId,\"-catId:\").concat(_this.apiSettings.catalogId);};this.getCacheObjectType=function(){return _this.key;};this.dataCacheType=function(){return'instance';};this.apiSettings=apiSettings;this.stateConstructor=stateConstructor;this.key=key;};export function getState(_x,_x2){return _getState.apply(this,arguments);}function _getState(){_getState=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var globalStateObject;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:globalStateObject=createGlobalState(input.stateConstructor,ctx);_context.next=3;return globalStateObject.initialize();case 3:return _context.abrupt(\"return\",globalStateObject);case 4:case\"end\":return _context.stop();}}},_callee);}));return _getState.apply(this,arguments);}export default function createGlobalStateDataAction(key,stateConstructor){return createObservableDataAction({action:getState,input:function input(args){return new GlobalStateInput(key,stateConstructor,args.requestContext.apiSettings);}});}","map":{"version":3,"sources":["data-actions/global-state-data-action.ts"],"names":[],"mappings":"8MAAA,OAAoB,0BAApB,KAA4J,yBAA5J,CACA,OAAS,iBAAT,KAAwE,gCAAxE,CAIA;;AAEG,GACH,UAAa,CAAA,gBAAb,CAKI,0BAAY,GAAZ,CAAkC,gBAAlC,CAAkF,WAAlF,CAAmH,uDAM5G,KAAA,WAAA,CAAc,2BAAS,KAAI,CAAC,GAAd,oBAA4B,KAAI,CAAC,WAAL,CAAiB,SAA7C,mBAAgE,KAAI,CAAC,WAAL,CAAiB,SAAjF,GAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,CAAA,KAAI,CAAC,GAAX,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,UAAjB,EAAhB,CAPH,KAAK,WAAL,CAAmB,WAAnB,CACA,KAAK,gBAAL,CAAwB,gBAAxB,CACA,KAAK,GAAL,CAAW,GAAX,CACH,CATL,CAgBA,eAAsB,CAAA,QAAtB,iD,uFAAO,iBAAmD,KAAnD,CAAkF,GAAlF,wIACG,iBADH,CACuB,iBAAiB,CAAC,KAAK,CAAC,gBAAP,CAAyB,GAAzB,CADxC,uBAGG,CAAA,iBAAiB,CAAC,UAAlB,EAHH,wCAKI,iBALJ,wD,2CAQP,cAAc,SAAU,CAAA,2BAAV,CAAiE,GAAjE,CAAuF,gBAAvF,CAAqI,CAC/I,MAAO,CAAA,0BAA0B,CAAC,CAC9B,MAAM,CAAiB,QADO,CAE9B,KAAK,CAAE,eAAC,IAAD,CAA+B,CAClC,MAAO,IAAI,CAAA,gBAAJ,CAAqB,GAArB,CAA0B,gBAA1B,CAA4C,IAAI,CAAC,cAAL,CAAoB,WAAhE,CAAP,CACH,CAJ6B,CAAD,CAAjC,CAMH","sourcesContent":["import { CacheType, createObservableDataAction, IAction, IActionContext, IActionInput, ICommerceApiSettings, ICreateActionContext, IObservableAction } from '@msdyn365-commerce/core';\nimport { createGlobalState, GlobalStateConstructor, IGlobalState } from '../global-state/i-global-state';\n\nexport declare type GlobalStateType = 'CARTSTATE' | 'CHECKOUTSTATE';\n\n/**\n * Shared class that handles global state inputs\n */\nexport class GlobalStateInput<TOut extends IGlobalState> implements IActionInput {\n    public readonly stateConstructor: GlobalStateConstructor<TOut>;\n    public readonly key: GlobalStateType;\n    private apiSettings: ICommerceApiSettings;\n\n    constructor(key: GlobalStateType, stateConstructor: GlobalStateConstructor<TOut>, apiSettings: ICommerceApiSettings) {\n        this.apiSettings = apiSettings;\n        this.stateConstructor = stateConstructor;\n        this.key = key;\n    }\n\n    public getCacheKey = () => `${this.key}-chanId:${this.apiSettings.channelId}-catId:${this.apiSettings.catalogId}`;\n    public getCacheObjectType = () => this.key;\n    public dataCacheType = (): CacheType => 'instance';\n}\n\nexport async function getState<TOut extends IGlobalState>(input: GlobalStateInput<TOut>, ctx: IActionContext): Promise<TOut> {\n    const globalStateObject = createGlobalState(input.stateConstructor, ctx);\n\n    await globalStateObject.initialize();\n\n    return globalStateObject;\n}\n\nexport default function createGlobalStateDataAction<TOut extends IGlobalState>(key: GlobalStateType, stateConstructor: GlobalStateConstructor<TOut>): IObservableAction<TOut> {\n    return createObservableDataAction({\n        action: <IAction<TOut>>getState,\n        input: (args: ICreateActionContext) => {\n            return new GlobalStateInput(key, stateConstructor, args.requestContext.apiSettings);\n        }\n    });\n}"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}