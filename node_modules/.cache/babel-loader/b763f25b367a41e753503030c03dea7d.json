{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import{Button,getTelemetryObject}from'@msdyn365-commerce-modules/utilities';import*as Msdyn365 from'@msdyn365-commerce/core';import classname from'classnames';import _get from'lodash/get';import{computed}from'mobx';import*as React from'react';import{getGroups}from'../../common/get-groups';import{getOrderInfomationInput,getOrderInformation}from'../../common/get-order-information';import{getSalesLines,getSalesLinesInput}from'../../common/get-sales-lines';import LabelComponent from'../../common/label';import{getTenderIdOperationIdMap}from'../../common/utilities';import{getOrderDetailsHelp}from'./components/get-help';import{getOrderDetailsOrderSummary}from'./components/get-order-summary';import{getOrderDetailsPaymentMethods}from'./components/get-payment-methods';export*from'../../common/get-groups';export*from'../../common/get-order-information';export*from'../../common/get-sales-line';export*from'../../common/get-sales-lines';export*from'../../common/utilities';export*from'./components/get-help';export*from'./components/get-order-summary';export*from'./components/get-payment-methods';var OrderDetails=/*#__PURE__*/function(_React$PureComponent){_inherits(OrderDetails,_React$PureComponent);var _super=_createSuper(OrderDetails);function OrderDetails(props){var _this;_classCallCheck(this,OrderDetails);_this=_super.call(this,props);_this.moduleName='ms-order-details';_this.handleOrderDetailsHeadingChange=function(event){return _this.props.config.heading.text=event.target.value;};_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);return _this;}_createClass(OrderDetails,[{key:\"render\",value:function render(){var _this$props=this.props,_this$props$resources=_this$props.resources,noSalesOrderDetailsText=_this$props$resources.noSalesOrderDetailsText,genericErrorMessage=_this$props$resources.genericErrorMessage,needHelpLabel=_this$props$resources.needHelpLabel,helpLineNumberLabel=_this$props$resources.helpLineNumberLabel,loadingLabel=_this$props$resources.loadingLabel,backToShopping=_this$props$resources.backToShopping,orderItemLabel=_this$props$resources.orderItemLabel,orderItemsLabel=_this$props$resources.orderItemsLabel,helpLineContactAriaLabel=_this$props$resources.helpLineContactAriaLabel,_this$props$config=_this$props.config,heading=_this$props$config.heading,contactNumber=_this$props$config.contactNumber,showChannelInfo=_this$props$config.showChannelInfo;var showAddress=this.props.config.addressOptions!==undefined&&this.props.config.addressOptions===\"showAddressWithSingleLine\"||this.props.config.addressOptions===\"showAddressWithMultiplelines\";var showFullAddress=this.props.config.addressOptions!==undefined&&this.props.config.addressOptions===\"showAddressWithMultiplelines\";var moduleProps={moduleProps:this.props,className:classname('ms-order-details',this.props.config.className)};var backToShoppingUrl=Msdyn365.getUrlSync('home',this.props.context.actionContext)||'';var channelIdentities=this.props.data.channels.result&&this.props.data.channels.result.channelIdentities;var orgUnitLocations=this.props.data.orgUnitLocations.result&&this.props.data.orgUnitLocations.result.orgUnitLocations;var viewProps=_objectSpread(_objectSpread({},this.props),{},{moduleProps:moduleProps,heading:heading&&/*#__PURE__*/React.createElement(Msdyn365.Text,Object.assign({},heading,{className:'ms-order-details__heading',text:heading.text,tag:heading.tag||'h2',editProps:{onEdit:this.handleOrderDetailsHeadingChange,requestContext:this.props.context.request}})),backToShoppingLink:backToShoppingUrl&&/*#__PURE__*/React.createElement(Button,{className:'ms-order-details__btn-keep-shopping',href:backToShoppingUrl},backToShopping),footerProps:{className:'ms-order-details__footer'}});if(this.hasError){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-details__alert',label:genericErrorMessage})});return this.props.renderView(viewProps);}if(!this.isDataReady){viewProps=_objectSpread(_objectSpread({},viewProps),{},{loading:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-details__loading',label:loadingLabel})});return this.props.renderView(viewProps);}if(!this.order){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-details__alert',label:noSalesOrderDetailsText})});return this.props.renderView(viewProps);}var salesLinesInput=getSalesLinesInput(this.props,this.moduleName,this.order,this.products,this.priceContext,showFullAddress,this.telemetryContent);var salesLines=salesLinesInput&&getSalesLines(salesLinesInput);var orderInfomationInput=this.order&&getOrderInfomationInput(this.props,this.moduleName,this.order,this.priceContext,channelIdentities,orgUnitLocations,showChannelInfo);var orderInfomation=orderInfomationInput&&getOrderInformation(orderInfomationInput);viewProps=_objectSpread(_objectSpread({},viewProps),{},{salesOrder:this.order,orderInfomation:orderInfomation,salesLines:salesLines,groups:salesLines?getGroups({moduleName:this.moduleName,salesLines:salesLines,resources:{orderItemLabel:orderItemLabel,orderItemsLabel:orderItemsLabel},showAddress:showAddress}):undefined,orderSummary:this.orderSummaryProps?getOrderDetailsOrderSummary(this.orderSummaryProps):undefined,payment:this.paymentMethodsProps?getOrderDetailsPaymentMethods(this.paymentMethodsProps):undefined,help:contactNumber?getOrderDetailsHelp({needHelpLabel:needHelpLabel,helpLineNumberLabel:helpLineNumberLabel,contactNumber:contactNumber,helpLineContactAriaLabel:helpLineContactAriaLabel,telemetryContent:this.telemetryContent}):undefined});return this.props.renderView(viewProps);}},{key:\"isCurrentChannel\",get:function get(){if(!this.order){return false;}return this.order.ChannelId===_get(this.props,'context.request.apiSettings.channelId');}},{key:\"isDataReady\",get:function get(){return _get(this.props,'data.orderHydration.status')==='SUCCESS';}},{key:\"hasError\",get:function get(){return _get(this.props,'data.orderHydration.status')==='FAILED';}},{key:\"order\",get:function get(){return _get(this.props,'data.orderHydration.result.salesOrder');}},{key:\"products\",get:function get(){return _get(this.props,'data.orderHydration.result.products')||[];}},{key:\"priceContext\",get:function get(){var _this$props2=this.props,id=_this$props2.id,typeName=_this$props2.typeName,context=_this$props2.context,telemetry=_this$props2.telemetry,freePriceText=_this$props2.resources.freePriceText;return{id:id,typeName:typeName,context:context,telemetry:telemetry,freePriceText:freePriceText};}},{key:\"earnedPoints\",get:function get(){var loyaltyCard=this.props.data.loyaltyCard.result;if(loyaltyCard&&loyaltyCard.RewardPoints&&this.order){var pointPrograms=loyaltyCard.RewardPoints.map(function(point){return point.RewardPointId;});var rewardLines=this.order.LoyaltyRewardPointLines||[];var total=0;rewardLines.forEach(function(line){if((line.RewardPointAmountQuantity||0)>0&&pointPrograms.indexOf(line.RewardPointId)>-1){total+=line.RewardPointAmountQuantity;}});return total;}return 0;}},{key:\"orderSummaryProps\",get:function get(){var _this$order;if(!this.order){return;}var request=this.props.context.request;var pickupDeliveryModeCode=request&&request.channel&&request.channel.PickupDeliveryModeCode;var orderDetailsLines=(_this$order=this.order)===null||_this$order===void 0?void 0:_this$order.SalesLines;var canShip=orderDetailsLines===null||orderDetailsLines===void 0?void 0:orderDetailsLines.some(function(orderDetailsLine){return orderDetailsLine.DeliveryMode&&orderDetailsLine.DeliveryMode!==''?orderDetailsLine.DeliveryMode!==pickupDeliveryModeCode:orderDetailsLine;});var _this$props$resources2=this.props.resources,orderSummaryHeading=_this$props$resources2.orderSummaryHeading,orderSummaryItemsTotalLabel=_this$props$resources2.orderSummaryItemsTotalLabel,orderSummaryShippingFeeLabel=_this$props$resources2.orderSummaryShippingFeeLabel,orderSummaryTaxLabel=_this$props$resources2.orderSummaryTaxLabel,orderSummaryGrandTotalLabel=_this$props$resources2.orderSummaryGrandTotalLabel,pointsEarnedLabel=_this$props$resources2.pointsEarnedLabel;return{order:this.order,earnedPoints:this.earnedPoints,priceContext:this.priceContext,resource:{orderSummaryHeading:orderSummaryHeading,orderSummaryItemsTotalLabel:orderSummaryItemsTotalLabel,orderSummaryShippingFeeLabel:orderSummaryShippingFeeLabel,orderSummaryTaxLabel:orderSummaryTaxLabel,pointsEarnedLabel:pointsEarnedLabel,orderSummaryGrandTotalLabel:orderSummaryGrandTotalLabel},canShip:canShip};}},{key:\"paymentMethodsProps\",get:function get(){var tenderTypes=this.props.data.tenderTypes.result;if(!this.order||!this.order.TenderLines||!tenderTypes){return;}var locale=_get(this.props,'context.request.locale')||'en-US';var _this$props$resources3=this.props.resources,paymentMethodsTitle=_this$props$resources3.paymentMethodsTitle,creditCardEndingLabel=_this$props$resources3.creditCardEndingLabel,giftCardEndingLabel=_this$props$resources3.giftCardEndingLabel,amountCoveredLabel=_this$props$resources3.amountCoveredLabel,cashUsedLabel=_this$props$resources3.cashUsedLabel,loyaltyCardUsedLabel=_this$props$resources3.loyaltyCardUsedLabel,customerAccountUsedLabel=_this$props$resources3.customerAccountUsedLabel;return{priceContext:this.priceContext,tenderLines:this.order.TenderLines,tenderIdOperationIdMap:getTenderIdOperationIdMap(tenderTypes),locale:locale,resource:{paymentMethodsTitle:paymentMethodsTitle,creditCardEndingLabel:creditCardEndingLabel,giftCardEndingLabel:giftCardEndingLabel,amountCoveredLabel:amountCoveredLabel,cashUsedLabel:cashUsedLabel,loyaltyCardUsedLabel:loyaltyCardUsedLabel,customerAccountUsedLabel:customerAccountUsedLabel}};}}]);return OrderDetails;}(React.PureComponent);__decorate([computed],OrderDetails.prototype,\"isCurrentChannel\",null);__decorate([computed],OrderDetails.prototype,\"isDataReady\",null);__decorate([computed],OrderDetails.prototype,\"hasError\",null);__decorate([computed],OrderDetails.prototype,\"order\",null);__decorate([computed],OrderDetails.prototype,\"products\",null);__decorate([computed],OrderDetails.prototype,\"priceContext\",null);__decorate([computed],OrderDetails.prototype,\"earnedPoints\",null);__decorate([computed],OrderDetails.prototype,\"orderSummaryProps\",null);__decorate([computed],OrderDetails.prototype,\"paymentMethodsProps\",null);export default OrderDetails;","map":{"version":3,"sources":["modules/order-details/order-details.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Button, getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport { SalesOrder, SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport classname from 'classnames';\nimport get from 'lodash/get';\nimport { computed } from 'mobx';\nimport * as React from 'react';\nimport { IGetOrderSummaryInput, IHelp, IOrderSummary, IPaymentMethods, IPaymentMethodsInput  } from '../../common';\nimport { getGroups, IGroups } from '../../common/get-groups';\nimport { getOrderInfomationInput, getOrderInformation, IOrderInformation } from '../../common/get-order-information';\nimport { ISalesLine } from '../../common/get-sales-line';\nimport { getSalesLines, getSalesLinesInput } from '../../common/get-sales-lines';\nimport LabelComponent from '../../common/label';\nimport { getTenderIdOperationIdMap, IPriceContext } from '../../common/utilities';\nimport { IOrderDetailsData, IOrderDetailsProps } from './../..';\nimport { getOrderDetailsHelp } from './components/get-help';\nimport { getOrderDetailsOrderSummary } from './components/get-order-summary';\nimport { getOrderDetailsPaymentMethods } from './components/get-payment-methods';\nimport { addressOptions } from './order-details.props.autogenerated';\n\nexport * from '../../common/get-groups';\nexport * from '../../common/get-order-information';\nexport * from '../../common/get-sales-line';\nexport * from '../../common/get-sales-lines';\nexport * from '../../common/utilities';\nexport * from './components/get-help';\nexport * from './components/get-order-summary';\nexport * from './components/get-payment-methods';\n\nexport interface IOrderDetailsViewProps extends IOrderDetailsProps<IOrderDetailsData> {\n    moduleProps: IModuleProps;\n    salesOrder?: SalesOrder;\n    footerProps?: INodeProps;\n    alert?: React.ReactNode;\n    loading?: React.ReactNode;\n    heading: React.ReactNode;\n    backToShoppingLink?: React.ReactNode;\n    orderInfomation?: IOrderInformation;\n    salesLines?: ISalesLine[];\n    groups?: IGroups;\n    orderSummary?: IOrderSummary;\n    payment?: IPaymentMethods;\n    help?: IHelp;\n}\n\n/**\n *\n * OrderDetails component\n * @extends {React.PureComponent<IOrderDetailsProps<IOrderDetailsData>>}\n */\nclass OrderDetails extends React.PureComponent<IOrderDetailsProps<IOrderDetailsData>> {\n    private moduleName: string = 'ms-order-details';\n    private telemetryContent: ITelemetryContent;\n\n    @computed get isCurrentChannel(): boolean {\n        if (!this.order) {\n            return false;\n        }\n        return this.order.ChannelId === get(this.props, 'context.request.apiSettings.channelId');\n    }\n\n    @computed get isDataReady(): boolean {\n        return get(this.props, 'data.orderHydration.status') === 'SUCCESS';\n    }\n\n    @computed get hasError(): boolean {\n        return get(this.props, 'data.orderHydration.status') === 'FAILED';\n    }\n\n    @computed get order(): SalesOrder | undefined {\n        return get(this.props, 'data.orderHydration.result.salesOrder');\n    }\n\n    @computed get products(): SimpleProduct[] {\n        return get(this.props, 'data.orderHydration.result.products') || [];\n    }\n\n    @computed get priceContext(): IPriceContext {\n        const {\n            id,\n            typeName,\n            context,\n            telemetry,\n            resources: { freePriceText }\n        } = this.props;\n        return {\n            id,\n            typeName,\n            context,\n            telemetry,\n            freePriceText\n        };\n    }\n\n    @computed get earnedPoints(): number {\n        const loyaltyCard = this.props.data.loyaltyCard.result;\n        if (loyaltyCard && loyaltyCard.RewardPoints && this.order) {\n            const pointPrograms = loyaltyCard.RewardPoints.map(point => point.RewardPointId);\n            const rewardLines = this.order.LoyaltyRewardPointLines || [];\n            let total = 0;\n            rewardLines.forEach(line => {\n                if ((line.RewardPointAmountQuantity || 0) > 0 && pointPrograms.indexOf(line.RewardPointId) > -1) {\n                    total += line.RewardPointAmountQuantity!;\n                }\n            });\n            return total;\n        }\n        return 0;\n    }\n\n    @computed get orderSummaryProps(): IGetOrderSummaryInput | undefined {\n        if (!this.order) {\n            return;\n        }\n        const { request } = this.props.context;\n        const pickupDeliveryModeCode = request && request.channel && request.channel.PickupDeliveryModeCode;\n        const orderDetailsLines =  this.order?.SalesLines;\n        const canShip = orderDetailsLines?.some(orderDetailsLine => (orderDetailsLine.DeliveryMode && orderDetailsLine.DeliveryMode !== '') ? orderDetailsLine.DeliveryMode !== pickupDeliveryModeCode : orderDetailsLine);\n\n        const {\n            resources: { orderSummaryHeading, orderSummaryItemsTotalLabel, orderSummaryShippingFeeLabel, orderSummaryTaxLabel, orderSummaryGrandTotalLabel, pointsEarnedLabel }\n        } = this.props;\n        return {\n            order: this.order,\n            earnedPoints: this.earnedPoints,\n            priceContext: this.priceContext,\n            resource: {\n                orderSummaryHeading,\n                orderSummaryItemsTotalLabel,\n                orderSummaryShippingFeeLabel,\n                orderSummaryTaxLabel,\n                pointsEarnedLabel,\n                orderSummaryGrandTotalLabel\n            },\n            canShip: canShip\n        };\n    }\n\n    @computed get paymentMethodsProps(): IPaymentMethodsInput | undefined {\n        const tenderTypes = this.props.data.tenderTypes.result;\n        if (!this.order || !this.order.TenderLines || !tenderTypes) {\n            return;\n        }\n\n        const locale = get(this.props, 'context.request.locale') || 'en-US';\n\n        const {\n            resources: {\n                paymentMethodsTitle,\n                creditCardEndingLabel,\n                giftCardEndingLabel,\n                amountCoveredLabel,\n                cashUsedLabel,\n                loyaltyCardUsedLabel,\n                customerAccountUsedLabel\n            }\n        } = this.props;\n\n        return {\n            priceContext: this.priceContext,\n            tenderLines: this.order.TenderLines,\n            tenderIdOperationIdMap: getTenderIdOperationIdMap(tenderTypes),\n            locale,\n            resource: {\n                paymentMethodsTitle,\n                creditCardEndingLabel,\n                giftCardEndingLabel,\n                amountCoveredLabel,\n                cashUsedLabel,\n                loyaltyCardUsedLabel,\n                customerAccountUsedLabel\n            }\n        };\n    }\n\n    constructor(props: IOrderDetailsProps<IOrderDetailsData>) {\n        super(props);\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public render(): JSX.Element {\n        const {\n            resources: {\n                noSalesOrderDetailsText,\n                genericErrorMessage,\n                needHelpLabel,\n                helpLineNumberLabel,\n                loadingLabel,\n                backToShopping,\n                orderItemLabel,\n                orderItemsLabel,\n                helpLineContactAriaLabel,\n            },\n            config: { heading, contactNumber, showChannelInfo }\n        } = this.props;\n\n        const showAddress = this.props.config.addressOptions !== undefined && this.props.config.addressOptions === addressOptions.showAddressWithSingleLine || this.props.config.addressOptions === addressOptions.showAddressWithMultiplelines;\n        const showFullAddress = this.props.config.addressOptions !== undefined && this.props.config.addressOptions === addressOptions.showAddressWithMultiplelines;\n        const moduleProps = { moduleProps: this.props, className: classname('ms-order-details', this.props.config.className) };\n        const backToShoppingUrl = Msdyn365.getUrlSync('home', this.props.context.actionContext) || '';\n        const channelIdentities = this.props.data.channels.result && this.props.data.channels.result.channelIdentities;\n        const orgUnitLocations = this.props.data.orgUnitLocations.result && this.props.data.orgUnitLocations.result.orgUnitLocations;\n\n        let viewProps: IOrderDetailsViewProps = {\n            ...this.props,\n            moduleProps,\n            heading: heading && (\n            <Msdyn365.Text\n                {...heading}\n                className='ms-order-details__heading'\n                text={heading.text}\n                tag={heading.tag || 'h2'}\n                editProps={{ onEdit: this.handleOrderDetailsHeadingChange, requestContext: this.props.context.request }}\n            />\n            ),\n            backToShoppingLink: backToShoppingUrl && (\n                <Button className='ms-order-details__btn-keep-shopping' href={backToShoppingUrl}>\n                    {backToShopping}\n                </Button>\n            ),\n            footerProps: { className: 'ms-order-details__footer' }\n        };\n\n        if (this.hasError) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-details__alert' label={genericErrorMessage} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!this.isDataReady) {\n            viewProps = {\n                ...viewProps,\n                loading: <LabelComponent className='ms-order-details__loading' label={loadingLabel} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!this.order) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-details__alert' label={noSalesOrderDetailsText} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        const salesLinesInput = getSalesLinesInput(this.props, this.moduleName, this.order, this.products, this.priceContext, showFullAddress, this.telemetryContent);\n        const salesLines = salesLinesInput && getSalesLines(salesLinesInput);\n\n        const orderInfomationInput = this.order && getOrderInfomationInput(this.props, this.moduleName, this.order, this.priceContext, channelIdentities, orgUnitLocations, showChannelInfo);\n        const orderInfomation = orderInfomationInput && getOrderInformation(orderInfomationInput);\n\n        viewProps = {\n            ...viewProps,\n            salesOrder: this.order,\n            orderInfomation,\n            salesLines,\n            groups: salesLines\n                ? getGroups({\n                    moduleName: this.moduleName,\n                    salesLines,\n                    resources: { orderItemLabel, orderItemsLabel },\n                    showAddress\n                })\n                : undefined,\n            orderSummary: this.orderSummaryProps ? getOrderDetailsOrderSummary(this.orderSummaryProps) : undefined,\n            payment: this.paymentMethodsProps ? getOrderDetailsPaymentMethods(this.paymentMethodsProps) : undefined,\n            help: contactNumber ? getOrderDetailsHelp({ needHelpLabel, helpLineNumberLabel, contactNumber, helpLineContactAriaLabel, telemetryContent: this.telemetryContent }) : undefined\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleOrderDetailsHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n}\n\nexport default OrderDetails;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}