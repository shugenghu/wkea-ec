{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _cloneDeep from\"lodash/cloneDeep\";import{updateCartLinesAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';export default function clearCartLinesDeliveryInformation(_x,_x2){return _clearCartLinesDeliveryInformation.apply(this,arguments);}function _clearCartLinesDeliveryInformation(){_clearCartLinesDeliveryInformation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(cart,actionContext){var _actionContext$reques;var pickupDeliveryModeCode,matchingLines,copiedLines;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!cart||!cart.CartLines)){_context.next=2;break;}return _context.abrupt(\"return\",{cart:undefined,status:'FAILED'});case 2:pickupDeliveryModeCode=actionContext&&actionContext.requestContext&&((_actionContext$reques=actionContext.requestContext.channel)===null||_actionContext$reques===void 0?void 0:_actionContext$reques.PickupDeliveryModeCode);matchingLines=cart.CartLines.filter(function(cartLine){return cartLine.DeliveryMode&&cartLine.DeliveryMode!==pickupDeliveryModeCode&&cartLine.LineId;});// If there are no lines needing updates, just return success\nif(!(matchingLines.length===0)){_context.next=6;break;}return _context.abrupt(\"return\",{cart:cart,status:'SUCCESS'});case 6:copiedLines=_cloneDeep(matchingLines);copiedLines.forEach(function(line){line.DeliveryMode='';line.FulfillmentStoreId='';line.ShippingAddress={};});return _context.abrupt(\"return\",updateCartLinesAsync({callerContext:actionContext},cart.Id,copiedLines,null).then(function(newCart){return{cart:newCart,status:'SUCCESS'};})[\"catch\"](function(error){actionContext.telemetry.warning(error);actionContext.telemetry.debug('Unable to Update Cart Lines');return{cart:undefined,status:'FAILED'};}));case 9:case\"end\":return _context.stop();}}},_callee);}));return _clearCartLinesDeliveryInformation.apply(this,arguments);}","map":{"version":3,"sources":["cart-state/clear-cart-lines-delivery-information.ts"],"names":[],"mappings":"gLACA,OAAS,oBAAT,KAAqC,qEAArC,CAKA,uBAA8B,CAAA,iCAA9B,0E,yIAAe,iBAAiD,IAAjD,CAAmF,aAAnF,sMAEP,CAAC,IAAD,EAAS,CAAC,IAAI,CAAC,SAFR,0DAGA,CAAE,IAAI,CAAE,SAAR,CAAmB,MAAM,CAAE,QAA3B,CAHA,SAML,sBANK,CAMoB,aAAa,EAAI,aAAa,CAAC,cAA/B,0BAAiD,aAAa,CAAC,cAAd,CAA6B,OAA9E,gDAAiD,sBAAsC,sBAAvF,CANpB,CAQL,aARK,CAQW,IAAI,CAAC,SAAL,CAAe,MAAf,CAClB,SAAA,QAAQ,QAAI,CAAA,QAAQ,CAAC,YAAT,EAAyB,QAAQ,CAAC,YAAT,GAA0B,sBAAnD,EAA6E,QAAQ,CAAC,MAA1F,EADU,CARX,CAYX;AAZW,KAaP,aAAa,CAAC,MAAd,GAAyB,CAblB,0DAc4B,CAAE,IAAI,CAAE,IAAR,CAAc,MAAM,CAAE,SAAtB,CAd5B,SAiBP,WAjBO,CAiBmB,WAAY,aAAZ,CAjBnB,CAmBX,WAAW,CAAC,OAAZ,CAAqB,SAAA,IAAI,CAAG,CACxB,IAAI,CAAC,YAAL,CAAoB,EAApB,CACA,IAAI,CAAC,kBAAL,CAA0B,EAA1B,CACA,IAAI,CAAC,eAAL,CAAuB,EAAvB,CACH,CAJD,EAnBW,gCAyBJ,oBAAoB,CAAC,CAAE,aAAa,CAAE,aAAjB,CAAD,CAAkC,IAAI,CAAC,EAAvC,CAA2C,WAA3C,CAAwD,IAAxD,CAApB,CACF,IADE,CACG,SAAC,OAAD,CAAiB,CACnB,MAAmC,CAAE,IAAI,CAAE,OAAR,CAAiB,MAAM,CAAE,SAAzB,CAAnC,CACH,CAHE,WAII,SAAC,KAAD,CAAkB,CACrB,aAAa,CAAC,SAAd,CAAwB,OAAxB,CAAgC,KAAhC,EACA,aAAa,CAAC,SAAd,CAAwB,KAAxB,CAA8B,6BAA9B,EAEA,MAAmC,CAAE,IAAI,CAAE,SAAR,CAAmB,MAAM,CAAE,QAA3B,CAAnC,CACH,CATE,CAzBI,wD","sourcesContent":["import { IActionContext } from '@msdyn365-commerce/core';\nimport { updateCartLinesAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';\nimport { Cart, CartLine } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { ICartActionResultWithCart } from './cart-action-result';\nimport _ from 'lodash';\n\nexport default async function clearCartLinesDeliveryInformation(cart: Readonly<Cart | undefined>, actionContext: IActionContext): Promise<ICartActionResultWithCart> {\n\n    if (!cart || !cart.CartLines) {\n        return { cart: undefined, status: 'FAILED'};\n    }\n\n    const pickupDeliveryModeCode = actionContext && actionContext.requestContext && actionContext.requestContext.channel?.PickupDeliveryModeCode;\n\n    const matchingLines = cart.CartLines.filter(\n        cartLine => cartLine.DeliveryMode && cartLine.DeliveryMode !== pickupDeliveryModeCode && cartLine.LineId\n    );\n\n    // If there are no lines needing updates, just return success\n    if (matchingLines.length === 0) {\n        return <ICartActionResultWithCart> { cart: cart, status: 'SUCCESS'};\n    }\n\n    let copiedLines: CartLine[] = _.cloneDeep(matchingLines);\n\n    copiedLines.forEach( line => {\n        line.DeliveryMode = '';\n        line.FulfillmentStoreId = '';\n        line.ShippingAddress = {};\n    });\n\n    return updateCartLinesAsync({ callerContext: actionContext}, cart.Id, copiedLines, null)\n        .then((newCart: any) => {\n            return <ICartActionResultWithCart> { cart: newCart, status: 'SUCCESS'};\n        })\n        .catch((error: string) => {\n            actionContext.telemetry.warning(error);\n            actionContext.telemetry.debug('Unable to Update Cart Lines');\n\n            return <ICartActionResultWithCart> { cart: undefined, status: 'FAILED'};\n        });\n}"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}