{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import{getRnrAuthEndpointId,getRnrPartnerId,getSelectedProductIdFromActionInput}from'@msdyn365-commerce-modules/retail-actions';import{createObservableDataAction,sendRequest}from'@msdyn365-commerce/core';import{GetUserReviewInput}from'./inputs/get-user-review-input';const createInput=input=>{const productId=getSelectedProductIdFromActionInput(input);const userInfo=input.requestContext.user;if(productId&&userInfo&&userInfo.isAuthenticated){return new GetUserReviewInput(productId,getRnrPartnerId(input),userInfo.token,getRnrAuthEndpointId(input));}throw new Error('[GetUserReview] Not all necessary parameters found while creating Input for GetUserReviewAPI');};async function getUserReview(input,ctx){if(!inputIsValid(input)){const errorMessage=\"[GettUserReview] Failed to get user's review due to bad input \".concat(input);ctx.trace(errorMessage);throw new Error(errorMessage);}const requestUrl=\"\".concat(input.serviceEndpoint,\"/v2.0/reviews/product/\").concat(input.productId,\"/user?tenantId=\").concat(input.tenantId);return sendRequest(requestUrl,'get',null,{headers:{Authorization:\"id_token \".concat(input.authorization)}}).then(response=>{return response.data;}).catch(error=>{ctx.trace(\"[GettUserReview] Failed to get user's review for product\");ctx.telemetry.exception(error);ctx.telemetry.debug(\"[GettUserReview] Failed to get user's review for product\");ctx.trace(error);throw error;});}function inputIsValid(input){return input.productId.length>0&&input.authorization.length>0&&input.tenantId.length>0;}export default createObservableDataAction({id:'@msdyn365-commerce-modules/ratings-reviews/get-user-review',action:getUserReview,input:createInput});","map":{"version":3,"sources":["actions/get-user-review.ts"],"names":[],"mappings":"sCAKA,OAAS,oBAAT,CAA+B,eAA/B,CAAgD,mCAAhD,KAA2F,2CAA3F,CAEA,OAAS,0BAAT,CAAkG,WAAlG,KAAqH,yBAArH,CACA,OAAS,kBAAT,KAAmC,gCAAnC,CAKA,KAAM,CAAA,WAAW,CAAI,KAAD,EAA8C,CAC9D,KAAM,CAAA,SAAS,CAAG,mCAAmC,CAAC,KAAD,CAArD,CACA,KAAM,CAAA,QAAQ,CAAG,KAAK,CAAC,cAAN,CAAqB,IAAtC,CACA,GAAI,SAAS,EAAI,QAAb,EAAyB,QAAQ,CAAC,eAAtC,CAAuD,CAEnD,MAAO,IAAI,CAAA,kBAAJ,CAAuB,SAAvB,CAAkC,eAAe,CAAC,KAAD,CAAjD,CAA0D,QAAQ,CAAC,KAAnE,CAA0E,oBAAoB,CAAC,KAAD,CAA9F,CAAP,CACH,CACD,KAAM,IAAI,CAAA,KAAJ,CAAU,8FAAV,CAAN,CACH,CARD,CAaA,cAAe,CAAA,aAAf,CAA6B,KAA7B,CAAuD,GAAvD,CAA0E,CACtE,GAAI,CAAC,YAAY,CAAC,KAAD,CAAjB,CAA0B,CACtB,KAAM,CAAA,YAAY,yEAAoE,KAApE,CAAlB,CACA,GAAG,CAAC,KAAJ,CAAU,YAAV,EACA,KAAM,IAAI,CAAA,KAAJ,CAAU,YAAV,CAAN,CACH,CAED,KAAM,CAAA,UAAU,WAAM,KAAK,CAAC,eAAZ,kCAAoD,KAAK,CAAC,SAA1D,2BAAqF,KAAK,CAAC,QAA3F,CAAhB,CAEA,MAAO,CAAA,WAAW,CAAS,UAAT,CAAqB,KAArB,CAA4B,IAA5B,CAAkC,CAAC,OAAO,CAAE,CAAC,aAAa,oBAAc,KAAK,CAAC,aAApB,CAAd,CAAV,CAAlC,CAAX,CAA4G,IAA5G,CAAkH,QAAD,EAAa,CACjI,MAAO,CAAA,QAAQ,CAAC,IAAhB,CACH,CAFM,EAEJ,KAFI,CAEG,KAAD,EAAU,CACf,GAAG,CAAC,KAAJ,6DACA,GAAG,CAAC,SAAJ,CAAc,SAAd,CAAwB,KAAxB,EACA,GAAG,CAAC,SAAJ,CAAc,KAAd,6DACA,GAAG,CAAC,KAAJ,CAAU,KAAV,EACA,KAAO,CAAA,KAAP,CACH,CARM,CAAP,CASH,CAED,QAAS,CAAA,YAAT,CAAsB,KAAtB,CAA8C,CAC1C,MAAO,CAAA,KAAK,CAAC,SAAN,CAAgB,MAAhB,CAAyB,CAAzB,EAA8B,KAAK,CAAC,aAAN,CAAoB,MAApB,CAA6B,CAA3D,EAAgE,KAAK,CAAC,QAAN,CAAe,MAAf,CAAwB,CAA/F,CACH,CAED,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,4DADkC,CAEtC,MAAM,CAAmB,aAFa,CAGtC,KAAK,CAAE,WAH+B,CAAD,CAAzC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getRnrAuthEndpointId, getRnrPartnerId, getSelectedProductIdFromActionInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { Review } from '@msdyn365-commerce/commerce-entities';\nimport { createObservableDataAction, IAction, IActionContext, IActionInput, ICreateActionContext, sendRequest } from '@msdyn365-commerce/core';\nimport { GetUserReviewInput } from './inputs/get-user-review-input';\n\n/**\n * This method builds the input for the getUserReviewApi call\n */\nconst createInput = (input: ICreateActionContext): IActionInput => {\n    const productId = getSelectedProductIdFromActionInput(input);\n    const userInfo = input.requestContext.user;\n    if (productId && userInfo && userInfo.isAuthenticated) {\n        // Task #211227597 Remove these hardcoded values.\n        return new GetUserReviewInput(productId, getRnrPartnerId(input), userInfo.token, getRnrAuthEndpointId(input));\n    }\n    throw new Error('[GetUserReview] Not all necessary parameters found while creating Input for GetUserReviewAPI');\n};\n\n/**\n * This method gets the user's review from the RnR service endpoint\n */\nasync function getUserReview(input:GetUserReviewInput, ctx: IActionContext):Promise<Review> {\n    if (!inputIsValid(input)) {\n        const errorMessage = `[GettUserReview] Failed to get user's review due to bad input ${input}`;\n        ctx.trace(errorMessage);\n        throw new Error(errorMessage);\n    }\n\n    const requestUrl = `${input.serviceEndpoint}/v2.0/reviews/product/${input.productId}/user?tenantId=${input.tenantId}`;\n\n    return sendRequest<Review>(requestUrl, 'get', null, {headers: {Authorization: `id_token ${input.authorization}`}}).then((response) => {\n        return response.data;\n    }).catch((error) => {\n        ctx.trace(`[GettUserReview] Failed to get user's review for product`);\n        ctx.telemetry.exception(error);\n        ctx.telemetry.debug(`[GettUserReview] Failed to get user's review for product`);\n        ctx.trace(error);\n        throw (error);\n    });\n}\n\nfunction inputIsValid(input:GetUserReviewInput): boolean {\n    return input.productId.length > 0 && input.authorization.length > 0 && input.tenantId.length > 0;\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/ratings-reviews/get-user-review',\n    action: <IAction<Review>>getUserReview,\n    input: createInput\n});\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}