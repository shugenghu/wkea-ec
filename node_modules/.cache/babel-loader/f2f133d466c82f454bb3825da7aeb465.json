{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import get from'lodash/get';import{action,computed,observable}from'mobx';import{GlobalState}from'../global-state/global-state';import{BaseCheckoutCartState}from'./base-checkout-cart-state';import{CheckoutStorageKey}from'./checkout-state-storage';/**\r\n * State information related to what is needed to succesfully perform a checkout\r\n */export var BaseCheckoutState=/*#__PURE__*/function(_GlobalState){_inherits(BaseCheckoutState,_GlobalState);var _super=_createSuper(BaseCheckoutState);function BaseCheckoutState(actionContext){var _this;_classCallCheck(this,BaseCheckoutState);_this=_super.call(this,actionContext);_this._giftCardExtends=[];_this._loyaltyAmount=0;_this._guestCheckoutEmail='';_this._customerAccountAmount=0;_this._checkoutGenericData={};_this._checkoutCart=new BaseCheckoutCartState(actionContext);_this._attributeValues=[];_this._extensionProperties=[];return _this;}_createClass(BaseCheckoutState,[{key:\"initialize\",value:function(){var _initialize=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!this.isInitialized){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.next=4;return this._checkoutCart.initialize();case 4:this.setInitialData();this.isInitialized=true;this._status='READY';this._attributeValues=[];this._extensionProperties=[];case 9:case\"end\":return _context.stop();}}},_callee,this);}));function initialize(){return _initialize.apply(this,arguments);}return initialize;}()},{key:\"updateSalesOrder\",value:function updateSalesOrder(input){this._salesOrder=input.newSalesOrder;this._orderedProducts=input.newOrderedProducts;this._attributeValues=input.newSalesOrder.AttributeValues||[];this._extensionProperties=input.newSalesOrder.ExtensionProperties||[];return Promise.resolve({status:'SUCCESS'});}},{key:\"updateAttributeValues\",value:function(){var _updateAttributeValues=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(input){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this._attributeValues=input.newAttributeValues;return _context2.abrupt(\"return\",Promise.resolve({status:'SUCCESS'}));case 2:case\"end\":return _context2.stop();}}},_callee2,this);}));function updateAttributeValues(_x){return _updateAttributeValues.apply(this,arguments);}return updateAttributeValues;}()},{key:\"updateExtensionProperties\",value:function(){var _updateExtensionProperties=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(input){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:this._extensionProperties=input.newExtensionProperties;return _context3.abrupt(\"return\",Promise.resolve({status:'SUCCESS'}));case 2:case\"end\":return _context3.stop();}}},_callee3,this);}));function updateExtensionProperties(_x2){return _updateExtensionProperties.apply(this,arguments);}return updateExtensionProperties;}()},{key:\"updateTokenizedPaymentCard\",value:function updateTokenizedPaymentCard(input){this._tokenizedPaymentCard=input.newTokenizedPaymentCard;return Promise.resolve({status:'SUCCESS'});}},{key:\"updateTenderLine\",value:function updateTenderLine(input){this._tenderLine=input.newTenderLine;return Promise.resolve({status:'SUCCESS'});}},{key:\"updateShippingAddress\",value:function(){var _updateShippingAddress=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(input){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this._shippingAddress=input.newShippingAddress;return _context4.abrupt(\"return\",Promise.resolve({status:'SUCCESS'}));case 2:case\"end\":return _context4.stop();}}},_callee4,this);}));function updateShippingAddress(_x3){return _updateShippingAddress.apply(this,arguments);}return updateShippingAddress;}()},{key:\"updateTermsAndConditionsAcceptance\",value:function(){var _updateTermsAndConditionsAcceptance=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(input){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:this._isTermsAndConditionAccepted=input.newIsTermsAndConditionAccepted;return _context5.abrupt(\"return\",Promise.resolve({status:'SUCCESS'}));case 2:case\"end\":return _context5.stop();}}},_callee5,this);}));function updateTermsAndConditionsAcceptance(_x4){return _updateTermsAndConditionsAcceptance.apply(this,arguments);}return updateTermsAndConditionsAcceptance;}()},{key:\"updateBillingAddress\",value:function updateBillingAddress(input){var _input$additionalProp;this._billingAddress=input.newBillingAddress;// @ts-ignore\nthis._isBillingAddressSameAsShippingAddress=((_input$additionalProp=input.additionalProperties)===null||_input$additionalProp===void 0?void 0:_input$additionalProp.isBillingAddressSameAsShippingAddress)||false;return Promise.resolve({status:'SUCCESS'});}},{key:\"removeBillingAddress\",value:function removeBillingAddress(input){this._billingAddress=undefined;this._isBillingAddressSameAsShippingAddress=undefined;return Promise.resolve({status:'SUCCESS'});}},{key:\"updatePaymentTenderType\",value:function updatePaymentTenderType(input){this._paymentTenderType=input.newPaymentTenderType;return Promise.resolve({status:'SUCCESS'});}},{key:\"updateCardPrefix\",value:function updateCardPrefix(input){this._cardPrefix=input.newCardPrefix;return Promise.resolve({status:'SUCCESS'});}},{key:\"removeGiftCard\",value:function removeGiftCard(input){this._giftCardExtends=this._giftCardExtends.filter(function(giftCard){return giftCard.Id!==input.giftCardNumber;});return Promise.resolve({status:'SUCCESS'});}},{key:\"removeGiftCardExtend\",value:function removeGiftCardExtend(input){this._giftCardExtends=this._giftCardExtends.filter(function(giftCard){return giftCard.Id!==input.giftCardNumber;});return Promise.resolve({status:'SUCCESS'});}},{key:\"addGiftCard\",value:function addGiftCard(input){// @ts-ignore\nvar _ref=input.additionalProperties||{},Pin=_ref.Pin,ExpirationDate=_ref.ExpirationDate,TenderTypeId=_ref.TenderTypeId;var gitCardExtend=_objectSpread(_objectSpread({},input.giftCard),{Pin:Pin,ExpirationDate:ExpirationDate,TenderTypeId:TenderTypeId});this._giftCardExtends=[gitCardExtend].concat(_toConsumableArray(this._giftCardExtends));return Promise.resolve({status:'SUCCESS'});}},{key:\"addGiftCardExtend\",value:function addGiftCardExtend(input){this._giftCardExtends=[input.giftCard].concat(_toConsumableArray(this._giftCardExtends));return Promise.resolve({status:'SUCCESS'});}},{key:\"updateLoyaltyCardNumber\",value:function updateLoyaltyCardNumber(input){this._loyaltyCardNumber=input.newLoyaltyCardNumber;return Promise.resolve({status:'SUCCESS'});}},{key:\"updateLoyaltyAmount\",value:function updateLoyaltyAmount(input){this._loyaltyAmount=Number(input.newAmount.toFixed(2));return Promise.resolve({status:'SUCCESS'});}},{key:\"updateGuestCheckoutEmail\",value:function(){var _updateGuestCheckoutEmail=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(input){var emailOnCart;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:this._guestCheckoutEmail=input.newGuestCheckoutEmail;emailOnCart=this.checkoutCart.cart.ReceiptEmail;if(!(emailOnCart!==input.newGuestCheckoutEmail)){_context6.next=5;break;}_context6.next=5;return this.checkoutCart.updateReceiptEmail({newEmail:input.newGuestCheckoutEmail});case 5:return _context6.abrupt(\"return\",Promise.resolve({status:'SUCCESS'}));case 6:case\"end\":return _context6.stop();}}},_callee6,this);}));function updateGuestCheckoutEmail(_x5){return _updateGuestCheckoutEmail.apply(this,arguments);}return updateGuestCheckoutEmail;}()},{key:\"removeCheckoutCartId\",value:function removeCheckoutCartId(input){//@ts-ignore\nthis.actionContext.requestContext.cookies.removeCheckoutCartCookie();return Promise.resolve({status:'SUCCESS'});}},{key:\"saveDataInStorage\",value:function saveDataInStorage(input){var _this2=this;var sessionStorage=this.actionContext.requestContext.sessionStorage;// Add all local data to session storage\nif(this.billingAddress){sessionStorage.setCheckoutCartData(CheckoutStorageKey.BillingAddress,{billingAddress:this.billingAddress,isBillingAddressSameAsShippingAddress:this.isBillingAddressSameAsShippingAddress});}if(this.giftCardExtends&&this.giftCardExtends.length>0){sessionStorage.setCheckoutCartData(CheckoutStorageKey.GiftCard,this.giftCardExtends);}if(this.loyaltyCardNumber){sessionStorage.setCheckoutCartData(CheckoutStorageKey.LoyaltyCardNumber,{loyaltyCardNumber:this.loyaltyCardNumber});}if(this.loyaltyAmount){sessionStorage.setCheckoutCartData(CheckoutStorageKey.LoyaltyAmount,{loyaltyAmount:this.loyaltyAmount});}if(this.isTermsAndConditionAccepted){sessionStorage.setCheckoutCartData(CheckoutStorageKey.TermsAndCondition,{isTermsAndConditionAccepted:this.isTermsAndConditionAccepted});}if(this.paymentTenderType){sessionStorage.setCheckoutCartData(CheckoutStorageKey.PaymentTenderType,{paymentTenderType:this.paymentTenderType});}// save generic data with SaveDataBeforeRedirect value true\nvar filtered=Object.keys(this._checkoutGenericData).reduce(function(filteredData,key){if(_this2._checkoutGenericData[key].SaveDataBeforeRedirect){filteredData[key]=_this2._checkoutGenericData[key];}return filteredData;},{});if(Object.keys(filtered).length>0){sessionStorage.setCheckoutCartData(CheckoutStorageKey.CheckoutGenericData,{checkoutGenericData:filtered});}return Promise.resolve({status:'SUCCESS'});}},{key:\"updateCustomerAccountAmount\",value:function updateCustomerAccountAmount(input){this._customerAccountAmount=Number(input.newAmount.toFixed(2));return Promise.resolve({status:'SUCCESS'});}},{key:\"setCheckoutGenericData\",value:function setCheckoutGenericData(input){this._checkoutGenericData[input.key]=input.checkoutGenericData;return Promise.resolve({status:'SUCCESS'});}},{key:\"getCheckoutGenericData\",value:function getCheckoutGenericData(input){return this._checkoutGenericData[input.key];}},{key:\"cleanCheckoutData\",value:function cleanCheckoutData(input){this.actionContext.requestContext.sessionStorage.removeCheckoutCartData();return Promise.resolve({status:'SUCCESS'});}},{key:\"isPaymentVerificationRedirection\",value:function isPaymentVerificationRedirection(){var _this$actionContext$r=this.actionContext.requestContext,requestFormData=_this$actionContext$r.requestFormData,query=_this$actionContext$r.query;return requestFormData&&query&&query.pv==='1'?true:false;}},{key:\"setInitialData\",value:function setInitialData(){var sessionStorage=this.actionContext.requestContext.sessionStorage;if(this.isPaymentVerificationRedirection()){var billingAddress=sessionStorage.getCheckoutCartData(CheckoutStorageKey.BillingAddress);var giftCard=sessionStorage.getCheckoutCartData(CheckoutStorageKey.GiftCard);this._billingAddress=get(billingAddress,'billingAddress');this._isBillingAddressSameAsShippingAddress=get(billingAddress,'isBillingAddressSameAsShippingAddress');this._giftCardExtends=giftCard&&Array.isArray(giftCard)?giftCard:[];this._loyaltyCardNumber=get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.LoyaltyCardNumber),'loyaltyCardNumber');this._loyaltyAmount=get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.LoyaltyAmount),'loyaltyAmount');this._isTermsAndConditionAccepted=get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.TermsAndCondition),'isTermsAndConditionAccepted');this._checkoutGenericData=get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.CheckoutGenericData),'checkoutGenericData')||{};this._paymentTenderType=get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.PaymentTenderType),'paymentTenderType');}this.cleanCheckoutData({});}},{key:\"checkoutCart\",get:function get(){return this._checkoutCart;}},{key:\"salesOrder\",get:function get(){return this._salesOrder;}},{key:\"attributeValues\",get:function get(){return this._attributeValues;}},{key:\"extensionProperties\",get:function get(){return this._extensionProperties;}},{key:\"orderedProducts\",get:function get(){return this._orderedProducts;}},{key:\"tokenizedPaymentCard\",get:function get(){return this._tokenizedPaymentCard;}},{key:\"tenderLine\",get:function get(){return this._tenderLine;}},{key:\"billingAddress\",get:function get(){return this._billingAddress;}},{key:\"isBillingAddressSameAsShippingAddress\",get:function get(){return this._isBillingAddressSameAsShippingAddress;}},{key:\"shippingAddress\",get:function get(){return this._shippingAddress;}},{key:\"cardPrefix\",get:function get(){return this._cardPrefix;}},{key:\"paymentTenderType\",get:function get(){return this._paymentTenderType;}/**\r\n     * @deprecated Use giftCardExtends method\r\n     */},{key:\"giftCards\",get:function get(){return this.giftCardExtends;}},{key:\"giftCardExtends\",get:function get(){return this._giftCardExtends;}},{key:\"loyaltyCardNumber\",get:function get(){return this._loyaltyCardNumber;}},{key:\"loyaltyAmount\",get:function get(){return this._loyaltyAmount;}},{key:\"guestCheckoutEmail\",get:function get(){return this._guestCheckoutEmail;}},{key:\"isTermsAndConditionAccepted\",get:function get(){return this._isTermsAndConditionAccepted;}},{key:\"customerAccountAmount\",get:function get(){return this._customerAccountAmount;}}]);return BaseCheckoutState;}(GlobalState);__decorate([observable],BaseCheckoutState.prototype,\"_checkoutCart\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"checkoutCart\",null);__decorate([observable],BaseCheckoutState.prototype,\"_salesOrder\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"salesOrder\",null);__decorate([observable],BaseCheckoutState.prototype,\"_attributeValues\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"attributeValues\",null);__decorate([observable],BaseCheckoutState.prototype,\"_extensionProperties\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"extensionProperties\",null);__decorate([observable],BaseCheckoutState.prototype,\"_orderedProducts\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"orderedProducts\",null);__decorate([observable],BaseCheckoutState.prototype,\"_tokenizedPaymentCard\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"tokenizedPaymentCard\",null);__decorate([observable],BaseCheckoutState.prototype,\"_tenderLine\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"tenderLine\",null);__decorate([observable],BaseCheckoutState.prototype,\"_billingAddress\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"billingAddress\",null);__decorate([observable],BaseCheckoutState.prototype,\"_isBillingAddressSameAsShippingAddress\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"isBillingAddressSameAsShippingAddress\",null);__decorate([observable],BaseCheckoutState.prototype,\"_shippingAddress\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"shippingAddress\",null);__decorate([observable],BaseCheckoutState.prototype,\"_cardPrefix\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"cardPrefix\",null);__decorate([observable],BaseCheckoutState.prototype,\"_paymentTenderType\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"paymentTenderType\",null);__decorate([computed],BaseCheckoutState.prototype,\"giftCards\",null);__decorate([observable],BaseCheckoutState.prototype,\"_giftCardExtends\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"giftCardExtends\",null);__decorate([observable],BaseCheckoutState.prototype,\"_loyaltyCardNumber\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"loyaltyCardNumber\",null);__decorate([observable],BaseCheckoutState.prototype,\"_loyaltyAmount\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"loyaltyAmount\",null);__decorate([observable],BaseCheckoutState.prototype,\"_guestCheckoutEmail\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"guestCheckoutEmail\",null);__decorate([observable],BaseCheckoutState.prototype,\"_isTermsAndConditionAccepted\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"isTermsAndConditionAccepted\",null);__decorate([observable],BaseCheckoutState.prototype,\"_customerAccountAmount\",void 0);__decorate([computed],BaseCheckoutState.prototype,\"customerAccountAmount\",null);__decorate([observable],BaseCheckoutState.prototype,\"_checkoutGenericData\",void 0);__decorate([action],BaseCheckoutState.prototype,\"updateSalesOrder\",null);__decorate([action],BaseCheckoutState.prototype,\"updateAttributeValues\",null);__decorate([action],BaseCheckoutState.prototype,\"updateExtensionProperties\",null);__decorate([action],BaseCheckoutState.prototype,\"updateTokenizedPaymentCard\",null);__decorate([action],BaseCheckoutState.prototype,\"updateTenderLine\",null);__decorate([action],BaseCheckoutState.prototype,\"updateShippingAddress\",null);__decorate([action],BaseCheckoutState.prototype,\"updateTermsAndConditionsAcceptance\",null);__decorate([action],BaseCheckoutState.prototype,\"updateBillingAddress\",null);__decorate([action],BaseCheckoutState.prototype,\"removeBillingAddress\",null);__decorate([action],BaseCheckoutState.prototype,\"updatePaymentTenderType\",null);__decorate([action],BaseCheckoutState.prototype,\"updateCardPrefix\",null);__decorate([action],BaseCheckoutState.prototype,\"removeGiftCard\",null);__decorate([action],BaseCheckoutState.prototype,\"removeGiftCardExtend\",null);__decorate([action],BaseCheckoutState.prototype,\"addGiftCard\",null);__decorate([action],BaseCheckoutState.prototype,\"addGiftCardExtend\",null);__decorate([action],BaseCheckoutState.prototype,\"updateLoyaltyCardNumber\",null);__decorate([action],BaseCheckoutState.prototype,\"updateLoyaltyAmount\",null);__decorate([action],BaseCheckoutState.prototype,\"updateGuestCheckoutEmail\",null);__decorate([action],BaseCheckoutState.prototype,\"removeCheckoutCartId\",null);__decorate([action],BaseCheckoutState.prototype,\"saveDataInStorage\",null);__decorate([action],BaseCheckoutState.prototype,\"updateCustomerAccountAmount\",null);__decorate([action],BaseCheckoutState.prototype,\"setCheckoutGenericData\",null);__decorate([action],BaseCheckoutState.prototype,\"getCheckoutGenericData\",null);__decorate([action],BaseCheckoutState.prototype,\"cleanCheckoutData\",null);","map":{"version":3,"sources":["checkout-state/base-checkout-state.ts"],"names":[],"mappings":"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","sourcesContent":["import get from 'lodash/get';\nimport { action, computed, observable } from 'mobx';\n\nimport { IActionContext } from '@msdyn365-commerce/core';\nimport {\n    Address, AttributeValueBase, CommerceProperty, GiftCard, SalesOrder, SimpleProduct, TenderLine, TokenizedPaymentCard\n} from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\n\nimport { GlobalState } from '../global-state/global-state';\nimport { ICartState } from '../state-interfaces/i-cart-state';\nimport { ICheckoutActionResult, ICheckoutGenericData, ICheckoutState, IGiftCardExtend } from '../state-interfaces/i-checkout-state';\nimport { BaseCheckoutCartState } from './base-checkout-cart-state';\nimport { CheckoutStorageKey } from './checkout-state-storage';\n\n/**\n * State information related to what is needed to succesfully perform a checkout\n */\nexport class BaseCheckoutState extends GlobalState implements ICheckoutState {\n    @observable protected _checkoutCart: ICartState;\n    @computed public get checkoutCart(): ICartState {\n        return this._checkoutCart;\n    }\n\n    @observable protected _salesOrder?: SalesOrder;\n    @computed public get salesOrder(): Readonly<SalesOrder | undefined> {\n        return this._salesOrder;\n    }\n\n    @observable protected _attributeValues: AttributeValueBase[];\n    @computed public get attributeValues(): Readonly<AttributeValueBase[] | undefined> {\n        return this._attributeValues;\n    }\n\n    @observable protected _extensionProperties: CommerceProperty[];\n    @computed public get extensionProperties(): Readonly<CommerceProperty[] | undefined> {\n        return this._extensionProperties;\n    }\n\n    @observable protected _orderedProducts?: SimpleProduct[];\n    @computed public get orderedProducts(): Readonly<SimpleProduct[] | undefined> {\n        return this._orderedProducts;\n    }\n\n    @observable protected _tokenizedPaymentCard?: TokenizedPaymentCard;\n    @computed public get tokenizedPaymentCard(): Readonly<TokenizedPaymentCard | undefined> {\n        return this._tokenizedPaymentCard;\n    }\n\n    @observable protected _tenderLine?: TenderLine;\n    @computed public get tenderLine(): Readonly<TenderLine | undefined> {\n        return this._tenderLine;\n    }\n\n    @observable protected _billingAddress?: Address;\n    @computed public get billingAddress(): Readonly<Address | undefined> {\n        return this._billingAddress;\n    }\n\n    @observable protected _isBillingAddressSameAsShippingAddress?: boolean;\n    @computed public get isBillingAddressSameAsShippingAddress(): Readonly<boolean | undefined> {\n        return this._isBillingAddressSameAsShippingAddress;\n    }\n\n    @observable protected _shippingAddress?: Address;\n    @computed public get shippingAddress(): Readonly<Address | undefined> {\n        return this._shippingAddress;\n    }\n\n    @observable protected _cardPrefix?: string;\n    @computed public get cardPrefix(): Readonly<string | undefined> {\n        return this._cardPrefix;\n    }\n\n    @observable protected _paymentTenderType?: string;\n    @computed public get paymentTenderType(): Readonly<string | undefined> {\n        return this._paymentTenderType;\n    }\n\n    /**\n     * @deprecated Use giftCardExtends method\n     */\n    @computed public get giftCards(): Readonly<GiftCard[]> {\n        return this.giftCardExtends;\n    }\n\n    @observable protected _giftCardExtends: IGiftCardExtend[] = [];\n    @computed public get giftCardExtends(): Readonly<IGiftCardExtend[]> {\n        return this._giftCardExtends;\n    }\n\n    @observable protected _loyaltyCardNumber?: string;\n    @computed public get loyaltyCardNumber(): Readonly<string | undefined> {\n        return this._loyaltyCardNumber;\n    }\n\n    @observable protected _loyaltyAmount: number = 0;\n    @computed public get loyaltyAmount(): Readonly<number> {\n        return this._loyaltyAmount;\n    }\n\n    @observable protected _guestCheckoutEmail: string = '';\n    @computed public get guestCheckoutEmail(): Readonly<string> {\n        return this._guestCheckoutEmail;\n    }\n\n    @observable protected _isTermsAndConditionAccepted?: boolean;\n    @computed public get isTermsAndConditionAccepted(): Readonly<boolean | undefined> {\n        return this._isTermsAndConditionAccepted;\n    }\n\n    @observable protected _customerAccountAmount: number = 0;\n    @computed public get customerAccountAmount(): Readonly<number> {\n        return this._customerAccountAmount;\n    }\n\n    @observable protected _checkoutGenericData: object = {};\n\n    constructor(actionContext: IActionContext) {\n        super(actionContext);\n        this._checkoutCart = new BaseCheckoutCartState(actionContext);\n        this._attributeValues = [];\n        this._extensionProperties = [];\n    }\n\n    public async initialize(): Promise<void> {\n        if (this.isInitialized) {\n            return;\n        }\n\n        await this._checkoutCart.initialize();\n\n        this.setInitialData();\n        this.isInitialized = true;\n        this._status = 'READY';\n        this._attributeValues = [];\n        this._extensionProperties = [];\n    }\n\n    @action\n    public updateSalesOrder(input: { newSalesOrder: SalesOrder; newOrderedProducts: SimpleProduct[]; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._salesOrder = input.newSalesOrder;\n        this._orderedProducts = input.newOrderedProducts;\n        this._attributeValues = input.newSalesOrder.AttributeValues || [];\n        this._extensionProperties = input.newSalesOrder.ExtensionProperties || [];\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public async updateAttributeValues(input: { newAttributeValues: AttributeValueBase[]; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._attributeValues = input.newAttributeValues;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public async updateExtensionProperties(input: { newExtensionProperties: CommerceProperty[]; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._extensionProperties = input.newExtensionProperties;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public updateTokenizedPaymentCard(input: { newTokenizedPaymentCard?: TokenizedPaymentCard; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._tokenizedPaymentCard = input.newTokenizedPaymentCard;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public updateTenderLine(input: { newTenderLine?: TenderLine; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._tenderLine = input.newTenderLine;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public async updateShippingAddress(input: { newShippingAddress: Address; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._shippingAddress = input.newShippingAddress;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public async updateTermsAndConditionsAcceptance(input: { newIsTermsAndConditionAccepted: boolean; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._isTermsAndConditionAccepted = input.newIsTermsAndConditionAccepted;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public updateBillingAddress(input: { newBillingAddress: Address; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._billingAddress = input.newBillingAddress;\n\n        // @ts-ignore\n        this._isBillingAddressSameAsShippingAddress = input.additionalProperties?.isBillingAddressSameAsShippingAddress || false;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public removeBillingAddress(input: { additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._billingAddress = undefined;\n        this._isBillingAddressSameAsShippingAddress = undefined;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public updatePaymentTenderType(input: { newPaymentTenderType?: string; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._paymentTenderType = input.newPaymentTenderType;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public updateCardPrefix(input: { newCardPrefix: string; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._cardPrefix = input.newCardPrefix;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public removeGiftCard(input: { giftCardNumber: string; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._giftCardExtends = this._giftCardExtends.filter(giftCard => giftCard.Id !== input.giftCardNumber);\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public removeGiftCardExtend(input: { giftCardNumber: string; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._giftCardExtends = this._giftCardExtends.filter(giftCard => giftCard.Id !== input.giftCardNumber);\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public addGiftCard(input: { giftCard: GiftCard; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        // @ts-ignore\n        const { Pin, ExpirationDate, TenderTypeId } = input.additionalProperties || {}\n\n        const gitCardExtend = { ...input.giftCard, ...{ Pin, ExpirationDate, TenderTypeId } };\n\n        this._giftCardExtends = [gitCardExtend, ...this._giftCardExtends];\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public addGiftCardExtend(input: { giftCard: IGiftCardExtend; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._giftCardExtends = [input.giftCard, ...this._giftCardExtends];\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public updateLoyaltyCardNumber(input: { newLoyaltyCardNumber: string; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._loyaltyCardNumber = input.newLoyaltyCardNumber;\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public updateLoyaltyAmount(input: { newAmount: number; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._loyaltyAmount = Number(input.newAmount.toFixed(2));\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public async updateGuestCheckoutEmail(input: { newGuestCheckoutEmail: string; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._guestCheckoutEmail = input.newGuestCheckoutEmail;\n        const emailOnCart = this.checkoutCart.cart.ReceiptEmail;\n\n        if (emailOnCart !== input.newGuestCheckoutEmail) {\n            await this.checkoutCart.updateReceiptEmail({ newEmail: input.newGuestCheckoutEmail });\n        }\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public removeCheckoutCartId(input: { additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        //@ts-ignore\n        this.actionContext.requestContext.cookies.removeCheckoutCartCookie();\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public saveDataInStorage(input: { additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        const { sessionStorage } = this.actionContext.requestContext;\n\n        // Add all local data to session storage\n        if (this.billingAddress) {\n            sessionStorage.setCheckoutCartData(CheckoutStorageKey.BillingAddress, { billingAddress: this.billingAddress, isBillingAddressSameAsShippingAddress: this.isBillingAddressSameAsShippingAddress });\n        }\n\n        if (this.giftCardExtends && this.giftCardExtends.length > 0) {\n            sessionStorage.setCheckoutCartData(CheckoutStorageKey.GiftCard, this.giftCardExtends);\n        }\n\n        if (this.loyaltyCardNumber) {\n            sessionStorage.setCheckoutCartData(CheckoutStorageKey.LoyaltyCardNumber, { loyaltyCardNumber: this.loyaltyCardNumber });\n        }\n\n        if (this.loyaltyAmount) {\n            sessionStorage.setCheckoutCartData(CheckoutStorageKey.LoyaltyAmount, { loyaltyAmount: this.loyaltyAmount });\n        }\n\n        if (this.isTermsAndConditionAccepted) {\n            sessionStorage.setCheckoutCartData(CheckoutStorageKey.TermsAndCondition, { isTermsAndConditionAccepted: this.isTermsAndConditionAccepted });\n        }\n\n        if (this.paymentTenderType) {\n            sessionStorage.setCheckoutCartData(CheckoutStorageKey.PaymentTenderType, { paymentTenderType: this.paymentTenderType });\n        }\n\n        // save generic data with SaveDataBeforeRedirect value true\n        const filtered = Object.keys(this._checkoutGenericData).reduce((filteredData: object, key: string) => {\n            if (this._checkoutGenericData[key].SaveDataBeforeRedirect) {\n                filteredData[key] = this._checkoutGenericData[key];\n            }\n            return filteredData;\n        }, {});\n\n        if (Object.keys(filtered).length > 0) {\n            sessionStorage.setCheckoutCartData(CheckoutStorageKey.CheckoutGenericData, { checkoutGenericData: filtered });\n        }\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public updateCustomerAccountAmount(input: { newAmount: number; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._customerAccountAmount = Number(input.newAmount.toFixed(2));\n\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public setCheckoutGenericData(input: { key: string; checkoutGenericData: ICheckoutGenericData; additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this._checkoutGenericData[input.key] = input.checkoutGenericData;\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    @action\n    public getCheckoutGenericData(input: { key: string }): ICheckoutGenericData | undefined {\n        return this._checkoutGenericData[input.key];\n    }\n\n    @action\n    private cleanCheckoutData(input: { additionalProperties?: object }): Promise<ICheckoutActionResult> {\n        this.actionContext.requestContext.sessionStorage.removeCheckoutCartData();\n        return Promise.resolve(<ICheckoutActionResult>{ status: 'SUCCESS' });\n    }\n\n    private isPaymentVerificationRedirection(): boolean {\n        const { requestFormData, query } = this.actionContext.requestContext;\n        return (requestFormData && query && query.pv === '1') ? true : false;\n    }\n\n    private setInitialData() {\n        const { sessionStorage } = this.actionContext.requestContext;\n\n        if (this.isPaymentVerificationRedirection()) {\n            const billingAddress = sessionStorage.getCheckoutCartData(CheckoutStorageKey.BillingAddress);\n            const giftCard = sessionStorage.getCheckoutCartData(CheckoutStorageKey.GiftCard);\n\n            this._billingAddress = get(billingAddress, 'billingAddress');\n            this._isBillingAddressSameAsShippingAddress = get(billingAddress, 'isBillingAddressSameAsShippingAddress');\n            this._giftCardExtends = (giftCard && Array.isArray(giftCard) ? giftCard : []) as IGiftCardExtend[];\n            this._loyaltyCardNumber = get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.LoyaltyCardNumber), 'loyaltyCardNumber');\n            this._loyaltyAmount = get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.LoyaltyAmount), 'loyaltyAmount');\n            this._isTermsAndConditionAccepted = get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.TermsAndCondition), 'isTermsAndConditionAccepted');\n            this._checkoutGenericData = get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.CheckoutGenericData), 'checkoutGenericData') || {};\n            this._paymentTenderType = get(sessionStorage.getCheckoutCartData(CheckoutStorageKey.PaymentTenderType), 'paymentTenderType');\n        }\n\n        this.cleanCheckoutData({});\n    }\n}"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}