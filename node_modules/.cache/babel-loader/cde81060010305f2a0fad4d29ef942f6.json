{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{createObservableDataAction}from'@msdyn365-commerce/core';import getCategoriesHierarchy,{CategoriesInput}from'./get-categories-hierarchy';/**\r\n * Action Input Class for get-current-category-hierarchy\r\n */export var CurrentCategoryHierarchyInput=/*#__PURE__*/function(_CategoriesInput){_inherits(CurrentCategoryHierarchyInput,_CategoriesInput);var _super=_createSuper(CurrentCategoryHierarchyInput);function CurrentCategoryHierarchyInput(context,mappedToHierarchy,maxItems,activeCategoryId){var _this;_classCallCheck(this,CurrentCategoryHierarchyInput);_this=_super.call(this,context,mappedToHierarchy,maxItems);// @ts-ignore: Overriding cache object type\n_this.getCacheObjectType=function(){return'CurrentCategoryHierarchy';};_this.getCacheKey=function(){return\"\".concat(_this.activeCategoryId,\"-\").concat(_this.channelId);};_this.activeCategoryId=activeCategoryId||0;return _this;}return CurrentCategoryHierarchyInput;}(CategoriesInput);/**\r\n * Creates the input required for the data action\r\n */export var createCategoriesHierarchyInput=function createCategoriesHierarchyInput(inputData){var topItems=inputData.config&&inputData.config.topCategories&&parseInt(inputData.config.topCategories,10);var activeCategoryId=inputData.requestContext.urlTokens&&inputData.requestContext.urlTokens.pageType==='Category'&&inputData.requestContext.urlTokens.itemId||inputData.requestContext.query&&inputData.requestContext.query.categoryId||0;return new CurrentCategoryHierarchyInput(inputData.requestContext,true,topItems,+activeCategoryId);};/**\r\n * Get the hierarchy of categories that are currently active as a parent -> child array.\r\n * Return will be as follows: [ParentCategory, Child, SubChild, SubSubChild]\r\n */export function getCurrentCategoryHierarchyAction(_x,_x2){return _getCurrentCategoryHierarchyAction.apply(this,arguments);}function _getCurrentCategoryHierarchyAction(){_getCurrentCategoryHierarchyAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var fullCategoryHierarchy,categoryArray,findCategory;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getCategoriesHierarchy(new CategoriesInput(ctx.requestContext,true,input.maxItems),ctx);case 2:fullCategoryHierarchy=_context.sent;categoryArray=[];findCategory=function findCategory(category){if(category.RecordId===input.activeCategoryId){categoryArray.push(category);return true;}else if(category.Children&&category.Children.length){category.Children.forEach(function(childCategory){if(findCategory(childCategory)){categoryArray.push(category);}});}else{return false;}};fullCategoryHierarchy.forEach(function(categoryHierarchy){findCategory(categoryHierarchy);});return _context.abrupt(\"return\",categoryArray.reverse());case 7:case\"end\":return _context.stop();}}},_callee);}));return _getCurrentCategoryHierarchyAction.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/get-current-category-hierarchy',action:getCurrentCategoryHierarchyAction,input:createCategoriesHierarchyInput});","map":{"version":3,"sources":["../../src/get-current-category-hierarchy.ts"],"names":[],"mappings":"0lCACA,OAAS,0BAAT,KAAyI,yBAAzI,CACA,MAAO,CAAA,sBAAP,EAAiC,eAAjC,KAAwD,4BAAxD,CAEA;;AAEG,GACH,UAAa,CAAA,6BAAb,0JAGI,uCAAY,OAAZ,CAAsC,iBAAtC,CAAkE,QAAlE,CAAqF,gBAArF,CAA8G,+DAC1G,uBAAM,OAAN,CAAe,iBAAf,CAAkC,QAAlC,EAIJ;AACO,MAAA,kBAAA,CAAqB,iBAAM,0BAAN,EAArB,CACA,MAAA,WAAA,CAAc,2BAAS,MAAK,gBAAd,aAAkC,MAAK,SAAvC,GAAd,CALH,MAAK,gBAAL,CAAwB,gBAAgB,EAAI,CAA5C,CAF0G,aAG7G,CANL,uCAAmD,eAAnD,EAaA;;AAEG,GACH,MAAO,IAAM,CAAA,8BAA8B,CAAG,QAAjC,CAAA,8BAAiC,CAAC,SAAD,CAAkE,CAC5G,GAAM,CAAA,QAAQ,CAAG,SAAS,CAAC,MAAV,EAAoB,SAAS,CAAC,MAAV,CAAiB,aAArC,EAAsD,QAAQ,CAAC,SAAS,CAAC,MAAV,CAAiB,aAAlB,CAAiC,EAAjC,CAA/E,CACA,GAAM,CAAA,gBAAgB,CACjB,SAAS,CAAC,cAAV,CAAyB,SAAzB,EAAsC,SAAS,CAAC,cAAV,CAAyB,SAAzB,CAAmC,QAAnC,GAAgD,UAAtF,EAAoG,SAAS,CAAC,cAAV,CAAyB,SAAzB,CAAmC,MAAxI,EACC,SAAS,CAAC,cAAV,CAAyB,KAAzB,EAAkC,SAAS,CAAC,cAAV,CAAyB,KAAzB,CAA+B,UADlE,EAEA,CAHJ,CAKA,MAAO,IAAI,CAAA,6BAAJ,CAAkC,SAAS,CAAC,cAA5C,CAA4D,IAA5D,CAAkE,QAAlE,CAA4E,CAAC,gBAA7E,CAAP,CACH,CARM,CAUP;;;AAGG,GACH,eAAsB,CAAA,iCAAtB,0E,yIAAO,iBAAiD,KAAjD,CAAuF,GAAvF,6LAEiC,CAAA,sBAAsB,CACtD,GAAI,CAAA,eAAJ,CACI,GAAG,CAAC,cADR,CAEI,IAFJ,CAGI,KAAK,CAAC,QAHV,CADsD,CAKtD,GALsD,CAFvD,QAEG,qBAFH,eAQG,aARH,CAQwC,EARxC,CAUG,YAVH,CAUkB,QAAf,CAAA,YAAe,CAAC,QAAD,CAAgC,CACjD,GAAG,QAAQ,CAAC,QAAT,GAAsB,KAAK,CAAC,gBAA/B,CAAiD,CAC7C,aAAa,CAAC,IAAd,CAAmB,QAAnB,EACA,MAAO,KAAP,CACH,CAHD,IAGO,IAAI,QAAQ,CAAC,QAAT,EAAqB,QAAQ,CAAC,QAAT,CAAkB,MAA3C,CAAmD,CACtD,QAAQ,CAAC,QAAT,CAAkB,OAAlB,CAA0B,SAAC,aAAD,CAAkB,CACxC,GAAG,YAAY,CAAC,aAAD,CAAf,CAAgC,CAC5B,aAAa,CAAC,IAAd,CAAmB,QAAnB,EACH,CACJ,CAJD,EAKH,CANM,IAMA,CACH,MAAO,MAAP,CACH,CACJ,CAvBE,CAyBH,qBAAqB,CAAC,OAAtB,CAA8B,SAAC,iBAAD,CAAyC,CACnE,YAAY,CAAC,iBAAD,CAAZ,CACH,CAFD,EAzBG,gCA6BI,aAAa,CAAC,OAAd,EA7BJ,wD,oEAgCP,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,0EADkC,CAEtC,MAAM,CAAgC,iCAFA,CAGtC,KAAK,CAAE,8BAH+B,CAAD,CAAzC","sourcesContent":["import { CategoryHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { createObservableDataAction, IAction, IActionContext, IActionInput, IAny, ICreateActionContext, IGeneric, IRequestContext } from '@msdyn365-commerce/core';\nimport getCategoriesHierarchy, { CategoriesInput } from './get-categories-hierarchy';\n\n/**\n * Action Input Class for get-current-category-hierarchy\n */\nexport class CurrentCategoryHierarchyInput extends CategoriesInput {\n    public activeCategoryId: number;\n\n    constructor(context: IRequestContext, mappedToHierarchy: boolean, maxItems?: number, activeCategoryId?: number) {\n        super(context, mappedToHierarchy, maxItems);\n        this.activeCategoryId = activeCategoryId || 0;\n    }\n\n    // @ts-ignore: Overriding cache object type\n    public getCacheObjectType = () => 'CurrentCategoryHierarchy';\n    public getCacheKey = () => `${this.activeCategoryId}-${this.channelId}`;\n}\n\n/**\n * Creates the input required for the data action\n */\nexport const createCategoriesHierarchyInput = (inputData: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    const topItems = inputData.config && inputData.config.topCategories && parseInt(inputData.config.topCategories, 10);\n    const activeCategoryId =\n        (inputData.requestContext.urlTokens && inputData.requestContext.urlTokens.pageType === 'Category' && inputData.requestContext.urlTokens.itemId) ||\n        (inputData.requestContext.query && inputData.requestContext.query.categoryId) ||\n        0;\n\n    return new CurrentCategoryHierarchyInput(inputData.requestContext, true, topItems, +activeCategoryId);\n};\n\n/**\n * Get the hierarchy of categories that are currently active as a parent -> child array.\n * Return will be as follows: [ParentCategory, Child, SubChild, SubSubChild]\n */\nexport async function getCurrentCategoryHierarchyAction(input: CurrentCategoryHierarchyInput, ctx: IActionContext): Promise<CategoryHierarchy[]> {\n\n    const fullCategoryHierarchy = await getCategoriesHierarchy(\n        new CategoriesInput(\n            ctx.requestContext,\n            true,\n            input.maxItems),\n        ctx);\n    const categoryArray: CategoryHierarchy[] = [];\n\n    const findCategory = (category: CategoryHierarchy) => {\n        if(category.RecordId === input.activeCategoryId) {\n            categoryArray.push(category);\n            return true;\n        } else if (category.Children && category.Children.length) {\n            category.Children.forEach((childCategory) => {\n                if(findCategory(childCategory)) {\n                    categoryArray.push(category);\n                }\n            });\n        } else {\n            return false;\n        }\n    };\n\n    fullCategoryHierarchy.forEach((categoryHierarchy: CategoryHierarchy) => {\n        findCategory(categoryHierarchy);\n    });\n\n    return categoryArray.reverse();\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-current-category-hierarchy',\n    action: <IAction<CategoryHierarchy[]>>getCurrentCategoryHierarchyAction,\n    input: createCategoriesHierarchyInput\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}