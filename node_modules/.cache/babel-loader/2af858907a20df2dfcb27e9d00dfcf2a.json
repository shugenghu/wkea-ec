{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import*as Msdyn365 from'@msdyn365-commerce/core';import{reaction}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{StoreSelectorEmptyMessage,StoreSelectorFoundLocationsMessage,StoreSelectorLocationLines,StoreSelectorSearchForm,StoreSelectorTermsOfService,StoreSelectorWaiting}from'./components';import{getFullAvailableInventoryNearby,GetFullAvailableInventoryNearbyInput,getOrgUnitLocationsByArea,GetOrgUnitLocationsByAreaInput}from'@msdyn365-commerce-modules/retail-actions';import{getTelemetryObject,Modal,ModalBody,ModalFooter,ModalHeader}from'@msdyn365-commerce-modules/utilities';import classname from'classnames';var StoreSelector=/*#__PURE__*/function(_React$Component){_inherits(StoreSelector,_React$Component);var _super=_createSuper(StoreSelector);function StoreSelector(props){var _this;_classCallCheck(this,StoreSelector);_this=_super.call(this,props);_this.preferredStoreLocalStorageKey='_msdyn365__preferredStore_';_this.handleLinkTextChange=function(event){if(_this.props.config.termsOfServiceLink){_this.props.config.termsOfServiceLink.linkText=event.target.value;}};_this.handleHeadingChange=function(event){return _this.props.config.heading=event.target.value;};_this._attachMapAutoSuggest=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$props,autoSuggestOptions,_this$props$context,telemetry,channel,storeSelectorStateManager;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props=_this.props,autoSuggestOptions=_this$props.config.autoSuggestOptions,_this$props$context=_this$props.context,telemetry=_this$props$context.telemetry,channel=_this$props$context.actionContext.requestContext.channel,storeSelectorStateManager=_this$props.data.storeSelectorStateManager.result;if(storeSelectorStateManager!==null&&storeSelectorStateManager!==void 0&&storeSelectorStateManager.isMapApiLoaded&&!_this.autoSuggestManager){Microsoft.Maps.loadModule('Microsoft.Maps.AutoSuggest',{callback:function callback(){var options=_objectSpread(_objectSpread({},autoSuggestOptions),{},{countryCode:channel===null||channel===void 0?void 0:channel.ChannelCountryRegionISOCode});_this.autoSuggestManager=new Microsoft.Maps.AutosuggestManager(options);_this.autoSuggestManager.attachAutosuggest('#ms-store-select__search-box','#ms-store-select__search-box-container',_this._onSuggestionSelected);},errorCallback:function errorCallback(){if(telemetry){telemetry.debug('Unable to attach map auto suggest.');}},credentials:channel===null||channel===void 0?void 0:channel.BingMapsApiKey});}case 2:case\"end\":return _context.stop();}}},_callee);}));_this._onSuggestionSelected=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(result){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _this._searchTermChanged(result.formattedSuggestion);case 2:_context2.next=4;return _this._performSearch(result.formattedSuggestion);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();_this._setPreferredStore=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(storeId){var _window;var localStorage,_this$props2,cookies,storeSelectorStateManager;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:localStorage=(_window=window)===null||_window===void 0?void 0:_window.localStorage;if(!(!storeId||!localStorage)){_context3.next=3;break;}return _context3.abrupt(\"return\");case 3:_this$props2=_this.props,cookies=_this$props2.context.actionContext.requestContext.cookies,storeSelectorStateManager=_this$props2.data.storeSelectorStateManager.result;if(!(!storeSelectorStateManager||!(cookies!==null&&cookies!==void 0&&cookies.isConsentGiven()))){_context3.next=6;break;}return _context3.abrupt(\"return\");case 6:localStorage.setItem(_this.preferredStoreLocalStorageKey,storeId);_context3.next=9;return storeSelectorStateManager.setPreferredStoreLocationId(storeId);case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref3.apply(this,arguments);};}();_this._removePreferredStore=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _window2;var localStorage,_this$props3,cookies,storeSelectorStateManager;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:localStorage=(_window2=window)===null||_window2===void 0?void 0:_window2.localStorage;if(localStorage){_context4.next=3;break;}return _context4.abrupt(\"return\");case 3:_this$props3=_this.props,cookies=_this$props3.context.actionContext.requestContext.cookies,storeSelectorStateManager=_this$props3.data.storeSelectorStateManager.result;if(!(!storeSelectorStateManager||!(cookies!==null&&cookies!==void 0&&cookies.isConsentGiven()))){_context4.next=6;break;}return _context4.abrupt(\"return\");case 6:localStorage.removeItem(_this.preferredStoreLocalStorageKey);_context4.next=9;return storeSelectorStateManager.setPreferredStoreLocationId(undefined);case 9:case\"end\":return _context4.stop();}}},_callee4);}));_this._setSelectedStore=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(storeId){var storeSelectorStateManager;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:storeSelectorStateManager=_this.props.data.storeSelectorStateManager.result;if(storeSelectorStateManager){_context5.next=3;break;}return _context5.abrupt(\"return\");case 3:_context5.next=5;return storeSelectorStateManager.setSelectedStoreLocationId(storeId);case 5:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x3){return _ref5.apply(this,arguments);};}();_this._performSearch=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(searchTerm){var _this$props4,actionContext,storeSelectorStateManager,location;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_this$props4=_this.props,actionContext=_this$props4.context.actionContext,storeSelectorStateManager=_this$props4.data.storeSelectorStateManager.result;if(!(!searchTerm||!storeSelectorStateManager)){_context6.next=3;break;}return _context6.abrupt(\"return\");case 3:_this.setState({isSearchInProgress:true,isSeeAllStoreValue:false});_context6.next=6;return storeSelectorStateManager.geoLocate(searchTerm.trim()!==''?searchTerm:'0',actionContext);case 6:location=_context6.sent;if(!location){_context6.next=10;break;}_context6.next=10;return _this._updateLocations(location.latitude,location.longitude);case 10:_this.setState({isSearchInProgress:false});case 11:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x4){return _ref6.apply(this,arguments);};}();_this._searchTermChanged=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(searchTerm){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_this.setState({searchTerm:searchTerm});case 1:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x5){return _ref7.apply(this,arguments);};}();_this._getAndUpdateStoreLocation=function(showAllStores){var _this$props5=_this.props,style=_this$props5.config.style,storeSelectorStateManager=_this$props5.data.storeSelectorStateManager.result;var styleDefault=style!==undefined?style:\"dialog\";if(styleDefault!==\"inline\"&&(!storeSelectorStateManager||!storeSelectorStateManager.isDialogOpen)){return;}_this.setState({isSearchInProgress:true,isSeeAllStoreValue:false});if(navigator&&navigator.geolocation){navigator.geolocation.getCurrentPosition(/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(position){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(!showAllStores){_context8.next=8;break;}_this.setState({isSeeAllStoreValue:true});_context8.next=4;return _this._searchTermChanged('');case 4:_context8.next=6;return _this._updateLocations(position.coords.latitude,position.coords.longitude,0);case 6:_context8.next=10;break;case 8:_context8.next=10;return _this._updateLocations(position.coords.latitude,position.coords.longitude);case 10:_this.setState({isSearchInProgress:false});case 11:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x6){return _ref8.apply(this,arguments);};}(),/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(error){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:if(!error.PERMISSION_DENIED){_context9.next=12;break;}_this.setState({isLocationDisabled:true});if(!showAllStores){_context9.next=10;break;}_this.setState({isSeeAllStoreValue:true});_context9.next=6;return _this._searchTermChanged('');case 6:_context9.next=8;return _this._updateLocations(void 0,void 0,0);case 8:_context9.next=12;break;case 10:_context9.next=12;return _this._updateLocations();case 12:_this.setState({isSearchInProgress:false});case 13:case\"end\":return _context9.stop();}}},_callee9);}));return function(_x7){return _ref9.apply(this,arguments);};}(),{timeout:2000});}else{_this.setState({isSearchInProgress:false});}};_this._closeDialog=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var storeSelectorStateManager;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:storeSelectorStateManager=_this.props.data.storeSelectorStateManager.result;_this.setState({searchTerm:''});if(!storeSelectorStateManager){_context10.next=4;break;}return _context10.abrupt(\"return\",storeSelectorStateManager.closeDialog());case 4:case\"end\":return _context10.stop();}}},_callee10);}));_this._setOrgUnitStoreInformation=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(orgUnitStoreInformation){var _this$props6,storeSelectorStateManager,telemetry;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_this$props6=_this.props,storeSelectorStateManager=_this$props6.data.storeSelectorStateManager.result,telemetry=_this$props6.telemetry;if(storeSelectorStateManager){_context11.next=3;break;}return _context11.abrupt(\"return\");case 3:_context11.next=5;return storeSelectorStateManager.setOrgUnitStoreInformation({orgUnitStoreInformation:orgUnitStoreInformation,onLocationSelected:function onLocationSelected(orgUnitLocation){return Promise.resolve();}})[\"catch\"](function(error){if(telemetry){telemetry.error(error.message);telemetry.debug('Unable to Update store location state');}return;});case 5:return _context11.abrupt(\"return\");case 6:case\"end\":return _context11.stop();}}},_callee11);}));return function(_x8){return _ref11.apply(this,arguments);};}();_this._updateLocations=/*#__PURE__*/function(){var _ref12=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(latitude,longitude,radius){var _this$props7,telemetry,_this$props7$config,mode,lookupRadius,actionContext,storeSelectorStateManager,calRadius,distanceUnitValue,modeDefault,orgUnitLocationsInput,orgUnitLocations,input;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_this$props7=_this.props,telemetry=_this$props7.telemetry,_this$props7$config=_this$props7.config,mode=_this$props7$config.mode,lookupRadius=_this$props7$config.lookupRadius,actionContext=_this$props7.context.actionContext,storeSelectorStateManager=_this$props7.data.storeSelectorStateManager.result;calRadius=radius||radius===0?radius:lookupRadius||50;distanceUnitValue=_this.props.config.searchRadiusUnit===\"kilometers\"?1:0;modeDefault=mode!==undefined?mode:\"pickupInStore\";if(!(modeDefault===\"findStores\")){_context12.next=15;break;}orgUnitLocationsInput=new GetOrgUnitLocationsByAreaInput(latitude,longitude,calRadius,distanceUnitValue,_this.state.isLocationDisabled);_context12.next=8;return getOrgUnitLocationsByArea(orgUnitLocationsInput,actionContext);case 8:orgUnitLocations=_context12.sent;if(!orgUnitLocations){_context12.next=14;break;}_context12.next=12;return _this._setOrgUnitStoreInformation(orgUnitLocations);case 12:_context12.next=14;return _this._setSelectedStore(undefined);case 14:return _context12.abrupt(\"return\");case 15:if(!(!storeSelectorStateManager||!storeSelectorStateManager.context)){_context12.next=17;break;}return _context12.abrupt(\"return\");case 17:if(storeSelectorStateManager.context.product){_context12.next=19;break;}return _context12.abrupt(\"return\");case 19:input=new GetFullAvailableInventoryNearbyInput(storeSelectorStateManager.context.product.RecordId,latitude||0,longitude||0,calRadius,distanceUnitValue,_this.state.isLocationDisabled);_context12.next=22;return getFullAvailableInventoryNearby(input,actionContext)[\"catch\"](function(error){telemetry.warning(error);telemetry.error(error.message);telemetry.debug(\"Unable to get full available inventory near by\");});case 22:case\"end\":return _context12.stop();}}},_callee12);}));return function(_x9,_x10,_x11){return _ref12.apply(this,arguments);};}();_this._onOrgUnitLocationSelected=/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(location){var _this$props8,telemetry,storeSelectorStateManager;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_this$props8=_this.props,telemetry=_this$props8.telemetry,storeSelectorStateManager=_this$props8.data.storeSelectorStateManager.result;if(!storeSelectorStateManager){_context13.next=7;break;}if(!(location&&storeSelectorStateManager.context)){_context13.next=5;break;}_context13.next=5;return storeSelectorStateManager.context.onLocationSelected(location)[\"catch\"](function(error){telemetry.warning(error);telemetry.error(error.message);telemetry.debug(\"Unable to get on org unit location selected\");});case 5:_context13.next=7;return storeSelectorStateManager.closeDialog();case 7:case\"end\":return _context13.stop();}}},_callee13);}));return function(_x12){return _ref13.apply(this,arguments);};}();_this.state={isSearchInProgress:true,searchTerm:'',isSeeAllStoreValue:false};_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);return _this;}_createClass(StoreSelector,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var _this$props9=this.props,_this$props9$context=_this$props9.context,telemetry=_this$props9$context.telemetry,channel=_this$props9$context.actionContext.requestContext.channel,autoSuggestionEnabled=_this$props9.config.autoSuggestionEnabled;this._getAndUpdateStoreLocation();reaction(function(){return _this2.props.data.storeSelectorStateManager.result&&_this2.props.data.storeSelectorStateManager.result.isDialogOpen;},function(){_this2._getAndUpdateStoreLocation();});if(channel&&!channel.BingMapsApiKey){telemetry.error('BingMapsApiKey is missing.');return;}if(channel&&!channel.BingMapsEnabled){telemetry.error('Map is disabled from HQ.');return;}reaction(function(){var _this2$props$data$sto;return(_this2$props$data$sto=_this2.props.data.storeSelectorStateManager.result)===null||_this2$props$data$sto===void 0?void 0:_this2$props$data$sto.loadMapApi;},function(){var _this2$props$data$sto2,_this2$props$context,_this2$props$context$,_this2$props$context$2,_this2$props$context$3,_this2$props$context2,_this2$props$context3,_this2$props$context4,_this2$props$context5;(_this2$props$data$sto2=_this2.props.data.storeSelectorStateManager.result)===null||_this2$props$data$sto2===void 0?void 0:_this2$props$data$sto2.loadMapApi({key:channel===null||channel===void 0?void 0:channel.BingMapsApiKey,lang:(_this2$props$context=_this2.props.context)===null||_this2$props$context===void 0?void 0:(_this2$props$context$=_this2$props$context.actionContext)===null||_this2$props$context$===void 0?void 0:(_this2$props$context$2=_this2$props$context$.requestContext)===null||_this2$props$context$2===void 0?void 0:(_this2$props$context$3=_this2$props$context$2.channel)===null||_this2$props$context$3===void 0?void 0:_this2$props$context$3.ChannelCountryRegionISOCode,market:(_this2$props$context2=_this2.props.context)===null||_this2$props$context2===void 0?void 0:(_this2$props$context3=_this2$props$context2.actionContext)===null||_this2$props$context3===void 0?void 0:(_this2$props$context4=_this2$props$context3.requestContext)===null||_this2$props$context4===void 0?void 0:(_this2$props$context5=_this2$props$context4.channel)===null||_this2$props$context5===void 0?void 0:_this2$props$context5.DefaultLanguageId});});if(autoSuggestionEnabled){reaction(function(){var _this2$props$data$sto3;return(_this2$props$data$sto3=_this2.props.data.storeSelectorStateManager.result)===null||_this2$props$data$sto3===void 0?void 0:_this2$props$data$sto3.isMapApiLoaded;},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(){return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.next=2;return _this2._attachMapAutoSuggest();case 2:case\"end\":return _context14.stop();}}},_callee14);})));}}},{key:\"render\",value:function render(){var _window3,_window3$localStorage,_storeSelectorStateMa,_this3=this;var _this$props10=this.props,_this$props10$config=_this$props10.config,termsOfServiceLink=_this$props10$config.termsOfServiceLink,className=_this$props10$config.className,heading=_this$props10$config.heading,mode=_this$props10$config.mode,style=_this$props10$config.style,setAsPreferredStore=_this$props10$config.setAsPreferredStore,showAllStores=_this$props10$config.showAllStores,lookupRadius=_this$props10$config.lookupRadius,_this$props10$context=_this$props10.context,telemetry=_this$props10$context.telemetry,appConfig=_this$props10$context.app.config,_this$props10$context2=_this$props10$context.actionContext.requestContext,channel=_this$props10$context2.channel,cookies=_this$props10$context2.cookies,resources=_this$props10.resources,_this$props10$data=_this$props10.data,availabilitiesWithHours=_this$props10$data.availabilitiesWithHours.result,storeSelectorStateManager=_this$props10$data.storeSelectorStateManager.result,storeLocations=_this$props10$data.storeLocations.result;var isMapDisabled=channel&&channel.BingMapsApiKey&&channel.BingMapsEnabled?false:true;var context=storeSelectorStateManager?storeSelectorStateManager.context:undefined;var isDialogOpen=storeSelectorStateManager?storeSelectorStateManager.isDialogOpen:false;var styleDefault=style!==undefined?style:\"dialog\";var modeDefault=mode!==undefined?mode:\"pickupInStore\";var inlineView=styleDefault===\"inline\";var locatorView=modeDefault===\"findStores\";var hideInventory=locatorView;var selectedStoreLocationId=storeSelectorStateManager===null||storeSelectorStateManager===void 0?void 0:storeSelectorStateManager.selectedStoreLocationId;var preferredStoreLocationId=(storeSelectorStateManager===null||storeSelectorStateManager===void 0?void 0:storeSelectorStateManager.preferredStoreLocationId)||((_window3=window)===null||_window3===void 0?void 0:(_window3$localStorage=_window3.localStorage)===null||_window3$localStorage===void 0?void 0:_window3$localStorage.getItem('_msdyn365__preferredStore_'));var displayList=storeSelectorStateManager===null||storeSelectorStateManager===void 0?void 0:(_storeSelectorStateMa=storeSelectorStateManager.listMapViewState)===null||_storeSelectorStateMa===void 0?void 0:_storeSelectorStateMa.displayList;var isPreferredStoreEnabled=setAsPreferredStore&&(cookies===null||cookies===void 0?void 0:cookies.isConsentGiven());var StoreSelectorActions={toggleListMapViewState:function toggleListMapViewState(){storeSelectorStateManager===null||storeSelectorStateManager===void 0?void 0:storeSelectorStateManager.toggleListMapViewState();}};if(!(channel&&channel.BingMapsApiKey)){telemetry.error('BingMapsApiKey is missing.');}var configHeading=heading?heading:locatorView?resources.storeLocatorHeaderText:resources.storeSelectorHeaderText;var preferredDistanceUnit=this.props.config.searchRadiusUnit===\"kilometers\"?resources.kilometersShortText:resources.milesShortText;var viewProps=_objectSpread(_objectSpread({},this.props),{},{state:this.state,ModuleProps:{tag:inlineView?'div':Modal,moduleProps:this.props,className:classname(\"ms-store-\".concat(inlineView?'locate':'select'),className),autoFocus:true,fade:true,isOpen:isDialogOpen,onClosed:this._closeDialog,horizontalPosition:'center',verticalPosition:'center'},HeaderContainerProps:{tag:inlineView?'div':ModalHeader,className:\"ms-store-select__\".concat(inlineView?'header':'modal-header'),toggle:this._closeDialog},HeaderProps:configHeading&&/*#__PURE__*/React.createElement(Msdyn365.Text,Object.assign({className:'msc-modal__title'},configHeading,{tag:'h2',text:configHeading,editProps:{onEdit:this.handleHeadingChange,requestContext:this.props.context.request}})),FooterContainerProps:{tag:inlineView?'div':ModalFooter,className:\"ms-store-select__\".concat(inlineView?'footer':'modal-footer',\" \").concat(!displayList?'map-only-view':'')},BodyContainerProps:{tag:inlineView?'div':ModalBody,className:\"ms-store-select__\".concat(inlineView?'body':'modal-body')},locationsMessage:!this.state.isLocationDisabled&&/*#__PURE__*/React.createElement(StoreSelectorFoundLocationsMessage,{resources:resources,locations:hideInventory?storeLocations:availabilitiesWithHours,searchRadius:lookupRadius||50,preferredDistanceUnit:preferredDistanceUnit,isSeeAllStore:this.state.isSeeAllStoreValue}),search:/*#__PURE__*/React.createElement(StoreSelectorSearchForm,{value:this.state.searchTerm||'',resources:resources,performSearch:this._performSearch,searchTermChanged:this._searchTermChanged,isMapDisabled:isMapDisabled,showAllStores:showAllStores,onShowAllStores:function onShowAllStores(){return _this3._getAndUpdateStoreLocation(true);},onToggleListMapViewState:StoreSelectorActions.toggleListMapViewState,displayList:displayList,locatorView:locatorView,telemetryContent:this.telemetryContent}),spinner:/*#__PURE__*/React.createElement(StoreSelectorWaiting,null),locationsList:(availabilitiesWithHours&&availabilitiesWithHours.length||storeLocations&&storeLocations.length)&&/*#__PURE__*/React.createElement(StoreSelectorLocationLines,{locations:hideInventory?storeLocations:availabilitiesWithHours,resources:resources,preferredDistanceUnit:preferredDistanceUnit,alreadySelectedLocation:context?context.alreadySelectedLocation:undefined,outOfStockThreshold:appConfig.outOfStockThreshold||0,enableOutOfStockCheck:appConfig.enableStockCheck||false,onLocationSelected:this._onOrgUnitLocationSelected,storeLocatorView:locatorView,selectedStoreLocationId:selectedStoreLocationId,onClick:this._setSelectedStore,preferredStoreLocationId:preferredStoreLocationId,onSetAsPreferredStore:this._setPreferredStore,onRemovePreferredStore:this._removePreferredStore,isPreferredStoreEnabled:isPreferredStoreEnabled,displayList:displayList,telemetryContent:this.telemetryContent,isLocationDisabled:this.state.isLocationDisabled}),noLocationsMessage:/*#__PURE__*/React.createElement(StoreSelectorEmptyMessage,{resources:resources}),terms:/*#__PURE__*/React.createElement(StoreSelectorTermsOfService,{link:termsOfServiceLink,onTextChange:this.handleLinkTextChange,requestContext:this.props.context.request}),headerText:/*#__PURE__*/React.createElement(\"span\",null,heading?heading:locatorView?resources.storeLocatorHeaderText:resources.storeSelectorHeaderText),callbacks:{searchTermChanged:this._searchTermChanged,performSearch:this._performSearch,closeDialog:this._closeDialog,selectedLocation:this._onOrgUnitLocationSelected,getAndUpdateUserLocation:function getAndUpdateUserLocation(){_this3._getAndUpdateStoreLocation();return Promise.resolve();},attachMapAutoSuggest:this._attachMapAutoSuggest,onSuggestionSelected:this._onOrgUnitLocationSelected,setPreferredStore:this._setPreferredStore,removePreferredStore:this._removePreferredStore,setSelectedStore:this._setSelectedStore,setOrgUnitStoreInformation:this._setOrgUnitStoreInformation}});return this.props.renderView(viewProps);}}]);return StoreSelector;}(React.Component);StoreSelector=__decorate([observer],StoreSelector);export default StoreSelector;","map":{"version":3,"sources":["modules/store-selector/store-selector.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n// tslint:disable:no-reference\n/// <reference path=\"types/MicrosoftMaps/Microsoft.Maps.All.d.ts\" />\n\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport { reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { IStoreSelectorData } from './store-selector.data';\nimport { IStoreSelectorProps, mode as modeEnum, searchRadiusUnit, style as stylyEnum } from './store-selector.props.autogenerated';\n\nimport {\n    StoreSelectorEmptyMessage,\n    StoreSelectorFoundLocationsMessage,\n    StoreSelectorLocationLines,\n    StoreSelectorSearchForm,\n    StoreSelectorTermsOfService,\n    StoreSelectorWaiting\n} from './components';\n\nimport { getFullAvailableInventoryNearby, GetFullAvailableInventoryNearbyInput, getOrgUnitLocationsByArea, GetOrgUnitLocationsByAreaInput, IFullOrgUnitAvailability } from '@msdyn365-commerce-modules/retail-actions';\n\nimport { getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, Modal, ModalBody, ModalFooter, ModalHeader, NodeTag } from '@msdyn365-commerce-modules/utilities';\nimport { OrgUnitLocation } from '@msdyn365-commerce/retail-proxy';\nimport classname from 'classnames';\nexport interface IStoreSelectorState {\n    isSearchInProgress: boolean;\n    searchTerm?: string;\n    isSeeAllStoreValue: boolean;\n    isLocationDisabled?: boolean;\n}\n\nexport interface IStoreSelectorViewProps extends IStoreSelectorProps<IStoreSelectorData> {\n    state: IStoreSelectorState;\n\n    // Containers:\n    ModuleProps: IModuleProps;\n    BodyContainerProps: INodeProps;\n    FooterContainerProps: INodeProps;\n    HeaderContainerProps: INodeProps;\n    HeaderProps?: React.ReactNode;\n\n    // Components\n    locationsMessage?: React.ReactNode;\n    search?: React.ReactNode;\n    spinner?: React.ReactNode;\n    locationsList?: React.ReactNode;\n    noLocationsMessage?: React.ReactNode;\n    terms?: React.ReactNode;\n    headerText?: React.ReactNode;\n\n    callbacks: {\n        closeDialog(): Promise<void>;\n        searchTermChanged(searchTerm: string): Promise<void>;\n        performSearch(searchTerm: string): Promise<void>;\n        selectedLocation(location: OrgUnitLocation | undefined): Promise<void>;\n        getAndUpdateUserLocation(): Promise<void>;\n        attachMapAutoSuggest(): Promise<void>;\n        onSuggestionSelected(result: Microsoft.Maps.ISuggestionResult): Promise<void>;\n        setPreferredStore(storeId: string | undefined): Promise<void>;\n        removePreferredStore(): Promise<void>;\n        setSelectedStore(storeId: string | undefined): Promise<void>;\n        setOrgUnitStoreInformation(location: OrgUnitLocation | undefined): Promise<void>;\n    };\n}\n\n/**\n *\n * Pick Up In Store module\n * @extends React.Component<IPickUpInStoreProps<IPickUpInStoreData>>}\n */\n@observer\nclass StoreSelector extends React.Component<IStoreSelectorProps<IStoreSelectorData>, IStoreSelectorState> {\n    private autoSuggestManager: Microsoft.Maps.AutosuggestManager | undefined;\n    private preferredStoreLocalStorageKey: string = '_msdyn365__preferredStore_';\n    private telemetryContent: ITelemetryContent;\n\n    constructor(props: IStoreSelectorProps<IStoreSelectorData>) {\n        super(props);\n        this.state = { isSearchInProgress: true, searchTerm: '',isSeeAllStoreValue:false};\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!,\n                                                   this.props.friendlyName,\n                                                   this.props.telemetry);\n    }\n\n    public componentDidMount(): void {\n        const {\n            context: {\n                telemetry,\n                actionContext: {\n                    requestContext: {\n                        channel\n                    }\n                }\n            },\n            config: {\n                autoSuggestionEnabled\n            }\n        } = this.props;\n\n        this._getAndUpdateStoreLocation();\n\n        reaction(\n            () => this.props.data.storeSelectorStateManager.result && this.props.data.storeSelectorStateManager.result.isDialogOpen,\n            () => {\n                this._getAndUpdateStoreLocation();\n            }\n        );\n\n        if (channel && !channel.BingMapsApiKey) {\n            telemetry.error('BingMapsApiKey is missing.');\n            return;\n        }\n\n        if (channel && !channel.BingMapsEnabled) {\n            telemetry.error('Map is disabled from HQ.');\n            return;\n        }\n\n        reaction(\n            () => this.props.data.storeSelectorStateManager.result?.loadMapApi,\n            () => {\n                this.props.data.storeSelectorStateManager.result?.loadMapApi({\n                    key: channel?.BingMapsApiKey,\n                    lang: this.props.context?.actionContext?.requestContext?.channel?.ChannelCountryRegionISOCode,\n                    market: this.props.context?.actionContext?.requestContext?.channel?.DefaultLanguageId\n                });\n            }\n        );\n\n        if (autoSuggestionEnabled) {\n            reaction(\n                () => this.props.data.storeSelectorStateManager.result?.isMapApiLoaded,\n                async () => {\n                    await this._attachMapAutoSuggest();\n                }\n            );\n        }\n    }\n\n    // tslint:disable-next-line:max-func-body-length cyclomatic-complexity\n    public render(): JSX.Element {\n        const {\n            config: {\n                termsOfServiceLink,\n                className,\n                heading,\n                mode,\n                style,\n                setAsPreferredStore,\n                showAllStores,\n                lookupRadius\n            },\n            context: {\n                telemetry,\n                app: {\n                    config: appConfig\n                },\n                actionContext: {\n                    requestContext: {\n                        channel,\n                        cookies\n                    }\n                }\n            },\n            resources,\n            data: {\n                availabilitiesWithHours: { result: availabilitiesWithHours },\n                storeSelectorStateManager: { result: storeSelectorStateManager },\n                storeLocations: { result: storeLocations }\n            }\n        } = this.props;\n\n        const isMapDisabled = (channel && channel.BingMapsApiKey && channel.BingMapsEnabled) ? false : true;\n        const context = storeSelectorStateManager ? storeSelectorStateManager.context : undefined;\n        const isDialogOpen: boolean = storeSelectorStateManager ? storeSelectorStateManager.isDialogOpen : false;\n        const styleDefault = style !== undefined ? style : stylyEnum.dialog;\n        const modeDefault = mode !== undefined ? mode : modeEnum.pickupInStore;\n        const inlineView = styleDefault === stylyEnum.inline;\n        const locatorView = modeDefault === modeEnum.findStores;\n        const hideInventory = locatorView;\n        const selectedStoreLocationId = storeSelectorStateManager?.selectedStoreLocationId;\n        const preferredStoreLocationId = storeSelectorStateManager?.preferredStoreLocationId || window?.localStorage?.getItem('_msdyn365__preferredStore_');\n        const displayList = storeSelectorStateManager?.listMapViewState?.displayList;\n        const isPreferredStoreEnabled = setAsPreferredStore && cookies?.isConsentGiven();\n\n        const StoreSelectorActions = {\n            toggleListMapViewState(): void {\n                storeSelectorStateManager?.toggleListMapViewState();\n            }\n        };\n\n        if (!(channel && channel.BingMapsApiKey)) {\n            telemetry.error('BingMapsApiKey is missing.');\n        }\n\n        const configHeading = heading ? heading : locatorView ? resources.storeLocatorHeaderText : resources.storeSelectorHeaderText;\n        const preferredDistanceUnit = this.props.config.searchRadiusUnit === searchRadiusUnit.kilometers ? resources.kilometersShortText : resources.milesShortText ;\n\n        const viewProps = {\n            ...(this.props as IStoreSelectorProps<IStoreSelectorData>),\n            state: this.state,\n\n            ModuleProps: {\n                tag: inlineView ? 'div' as NodeTag : Modal,\n                moduleProps: this.props,\n                className: classname(`ms-store-${inlineView ? 'locate' : 'select'}`, className),\n                autoFocus: true,\n                fade: true,\n                isOpen: isDialogOpen,\n                onClosed: this._closeDialog,\n                horizontalPosition: 'center',\n                verticalPosition: 'center'\n            },\n            HeaderContainerProps: {\n                tag: inlineView ? 'div' as NodeTag : ModalHeader,\n                className: `ms-store-select__${inlineView ? 'header' : 'modal-header'}`,\n                toggle: this._closeDialog\n            },\n            HeaderProps: configHeading && (\n                <Msdyn365.Text\n                    className='msc-modal__title'\n                    {...configHeading}\n                    tag={'h2'}\n                    text={configHeading}\n                    editProps={{ onEdit: this.handleHeadingChange, requestContext: this.props.context.request }}\n                />\n            ),\n            FooterContainerProps: {\n                tag: inlineView ? 'div' as NodeTag : ModalFooter,\n                className: `ms-store-select__${inlineView ? 'footer' : 'modal-footer'} ${!displayList ? 'map-only-view' : ''}`\n            },\n            BodyContainerProps: {\n                tag: inlineView ? 'div' as NodeTag : ModalBody,\n                className: `ms-store-select__${inlineView ? 'body' : 'modal-body'}`\n            },\n            locationsMessage: !this.state.isLocationDisabled && (\n                <StoreSelectorFoundLocationsMessage\n                    resources={resources}\n                    locations={hideInventory ? storeLocations : availabilitiesWithHours}\n                    searchRadius={lookupRadius || 50}\n                    preferredDistanceUnit={preferredDistanceUnit}\n                    isSeeAllStore={this.state.isSeeAllStoreValue}\n                />\n            ),\n            search: (\n                <StoreSelectorSearchForm\n                    value={this.state.searchTerm || ''}\n                    resources={resources}\n                    performSearch={this._performSearch}\n                    searchTermChanged={this._searchTermChanged}\n                    isMapDisabled={isMapDisabled}\n                    showAllStores={showAllStores}\n                    // tslint:disable-next-line:react-this-binding-issue jsx-no-lambda\n                    onShowAllStores={() => this._getAndUpdateStoreLocation(true)}\n                    onToggleListMapViewState={StoreSelectorActions.toggleListMapViewState}\n                    displayList={displayList}\n                    locatorView={locatorView}\n                    telemetryContent={this.telemetryContent}\n                />\n            ),\n            spinner: <StoreSelectorWaiting />,\n            locationsList: ((availabilitiesWithHours && availabilitiesWithHours.length) || (storeLocations && storeLocations.length)) && (\n                <StoreSelectorLocationLines\n                    locations={hideInventory ? storeLocations : availabilitiesWithHours}\n                    resources={resources}\n                    preferredDistanceUnit={preferredDistanceUnit}\n                    alreadySelectedLocation={context ? context.alreadySelectedLocation : undefined}\n                    outOfStockThreshold={appConfig.outOfStockThreshold || 0}\n                    enableOutOfStockCheck={appConfig.enableStockCheck || false}\n                    onLocationSelected={this._onOrgUnitLocationSelected}\n                    storeLocatorView={locatorView}\n                    selectedStoreLocationId={selectedStoreLocationId}\n                    onClick={this._setSelectedStore}\n                    preferredStoreLocationId={preferredStoreLocationId}\n                    onSetAsPreferredStore={this._setPreferredStore}\n                    onRemovePreferredStore={this._removePreferredStore}\n                    isPreferredStoreEnabled={isPreferredStoreEnabled}\n                    displayList={displayList}\n                    telemetryContent={this.telemetryContent}\n                    isLocationDisabled={this.state.isLocationDisabled}\n                />\n            ),\n            noLocationsMessage: <StoreSelectorEmptyMessage resources={resources} />,\n            terms: <StoreSelectorTermsOfService link={termsOfServiceLink} onTextChange={this.handleLinkTextChange} requestContext={this.props.context.request} />,\n            // Not being used in current context, we can use it here to pass more props.\n            headerText: <span>{heading ? heading : locatorView ? resources.storeLocatorHeaderText : resources.storeSelectorHeaderText}</span>,\n\n            callbacks: {\n                searchTermChanged: this._searchTermChanged,\n                performSearch: this._performSearch,\n                closeDialog: this._closeDialog,\n                selectedLocation: this._onOrgUnitLocationSelected,\n                getAndUpdateUserLocation: () => { this._getAndUpdateStoreLocation(); return Promise.resolve(); },\n                attachMapAutoSuggest: this._attachMapAutoSuggest,\n                onSuggestionSelected: this._onOrgUnitLocationSelected,\n                setPreferredStore: this._setPreferredStore,\n                removePreferredStore: this._removePreferredStore,\n                setSelectedStore: this._setSelectedStore,\n                setOrgUnitStoreInformation: this._setOrgUnitStoreInformation\n            }\n        } as IStoreSelectorViewProps;\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleLinkTextChange = (event: Msdyn365.ContentEditableEvent) => {\n        if (this.props.config.termsOfServiceLink) {\n            this.props.config.termsOfServiceLink.linkText = event.target.value;\n        }\n    };\n    public handleHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading = event.target.value;\n\n    private _attachMapAutoSuggest = async (): Promise<void> => {\n        const {\n            config: {\n                autoSuggestOptions\n            },\n            context: {\n                telemetry,\n                actionContext: {\n                    requestContext: {\n                        channel\n                    }\n                }\n            },\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        if (storeSelectorStateManager?.isMapApiLoaded && !this.autoSuggestManager) {\n            Microsoft.Maps.loadModule('Microsoft.Maps.AutoSuggest', {\n                callback: () => {\n                    const options = { ...autoSuggestOptions, countryCode: channel?.ChannelCountryRegionISOCode };\n                    this.autoSuggestManager = new Microsoft.Maps.AutosuggestManager(options);\n                    this.autoSuggestManager.attachAutosuggest('#ms-store-select__search-box', '#ms-store-select__search-box-container', this._onSuggestionSelected);\n                },\n                errorCallback: () => {\n                    if (telemetry) {\n                        telemetry.debug('Unable to attach map auto suggest.');\n                    }\n                },\n                credentials: channel?.BingMapsApiKey\n            });\n        }\n    }\n\n    private _onSuggestionSelected = async (result: Microsoft.Maps.ISuggestionResult): Promise<void> => {\n        await this._searchTermChanged(result.formattedSuggestion);\n        await this._performSearch(result.formattedSuggestion);\n    }\n\n    private _setPreferredStore = async (storeId: string | undefined): Promise<void> => {\n        const localStorage = window?.localStorage;\n\n        if (!storeId || !localStorage) {\n            return;\n        }\n\n        const {\n            context: {\n                actionContext: {\n                    requestContext: {\n                        cookies\n                    }\n                }\n            },\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        if (!storeSelectorStateManager || !cookies?.isConsentGiven()) { return; }\n\n        localStorage.setItem(this.preferredStoreLocalStorageKey, storeId);\n        await storeSelectorStateManager.setPreferredStoreLocationId(storeId);\n    }\n\n    private _removePreferredStore = async (): Promise<void> => {\n        const localStorage = window?.localStorage;\n\n        if (!localStorage) {\n            return;\n        }\n\n        const {\n            context: {\n                actionContext: {\n                    requestContext: {\n                        cookies\n                    }\n                }\n            },\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        if (!storeSelectorStateManager || !cookies?.isConsentGiven()) { return; }\n\n        localStorage.removeItem(this.preferredStoreLocalStorageKey);\n        await storeSelectorStateManager.setPreferredStoreLocationId(undefined);\n    }\n\n    private _setSelectedStore = async (storeId: string | undefined): Promise<void> => {\n        const {\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        if (!storeSelectorStateManager) { return; }\n\n        await storeSelectorStateManager.setSelectedStoreLocationId(storeId);\n    }\n\n    private _performSearch = async (searchTerm: string): Promise<void> => {\n        const {\n            context: {\n                actionContext\n            },\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        if (!searchTerm || !storeSelectorStateManager) {\n            return;\n        }\n\n        this.setState({ isSearchInProgress: true, isSeeAllStoreValue: false });\n\n        const location = await storeSelectorStateManager.geoLocate(searchTerm.trim() !== '' ? searchTerm : '0', actionContext);\n\n        if (location) {\n            await this._updateLocations(location.latitude, location.longitude);\n        }\n\n        this.setState({ isSearchInProgress: false });\n    }\n\n    private _searchTermChanged = async (searchTerm: string): Promise<void> => {\n        this.setState({ searchTerm: searchTerm });\n    }\n\n    private _getAndUpdateStoreLocation = (showAllStores?: boolean): void => {\n        const {\n            config: {\n                style\n            },\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        const styleDefault = style !== undefined ? style : stylyEnum.dialog;\n\n        if (styleDefault !== stylyEnum.inline && (!storeSelectorStateManager || !storeSelectorStateManager.isDialogOpen)) {\n            // Store selector dialog isn't open yet, so don't try and update anything\n            return;\n        }\n\n        this.setState({ isSearchInProgress: true, isSeeAllStoreValue: false });\n\n        if (navigator && navigator.geolocation) {\n            navigator.geolocation.getCurrentPosition(\n                async position => {\n                    if (showAllStores) {\n                        this.setState({ isSeeAllStoreValue: true });\n                        await this._searchTermChanged('');\n                        await this._updateLocations(position.coords.latitude, position.coords.longitude, 0);\n                    } else {\n                        await this._updateLocations(position.coords.latitude, position.coords.longitude);\n                    }\n\n                    this.setState({ isSearchInProgress: false });\n                },\n                async error => {\n                    // If the location setting is turned off\n                    if (error.PERMISSION_DENIED) {\n                        this.setState({ isLocationDisabled: true });\n                        if (showAllStores) {\n                            this.setState({ isSeeAllStoreValue: true });\n                            await this._searchTermChanged('');\n                            await this._updateLocations(void 0, void 0, 0);\n                        } else {\n                            await this._updateLocations();\n                        }\n                    }\n\n                    this.setState({ isSearchInProgress: false });\n                },\n                { timeout: 2000 }\n            );\n        } else {\n            this.setState({ isSearchInProgress: false });\n        }\n    }\n\n    private _closeDialog = async (): Promise<void> => {\n        const {\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        this.setState({ searchTerm: '' });\n\n        if (storeSelectorStateManager) {\n            return storeSelectorStateManager.closeDialog();\n        }\n    }\n\n    private _setOrgUnitStoreInformation = async (orgUnitStoreInformation: IFullOrgUnitAvailability[]): Promise<void> => {\n        const {\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            },\n            telemetry\n        } = this.props;\n\n        if (!storeSelectorStateManager) { return; }\n\n        await storeSelectorStateManager.setOrgUnitStoreInformation({\n            orgUnitStoreInformation,\n            onLocationSelected: orgUnitLocation => {\n                // TO-DO handle event for when location in selected\n                return Promise.resolve();\n            }\n        })\n            .catch((error: Error) => {\n                if (telemetry) {\n                    telemetry.error(error.message);\n                    telemetry.debug('Unable to Update store location state');\n                }\n                return;\n            });\n        return;\n    }\n\n    private _updateLocations = async (latitude?: number, longitude?: number, radius?: number): Promise<void> => {\n        const {\n            telemetry,\n            config: {\n                mode,\n                lookupRadius\n            },\n            context: {\n                actionContext\n            },\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        const calRadius = (radius || radius === 0) ? radius : (lookupRadius || 50);\n        const distanceUnitValue = this.props.config.searchRadiusUnit === searchRadiusUnit.kilometers ? 1 : 0;\n        const modeDefault = mode !== undefined ? mode : modeEnum.pickupInStore;\n\n        if (modeDefault === modeEnum.findStores) {\n            const orgUnitLocationsInput = new GetOrgUnitLocationsByAreaInput(\n                latitude,\n                longitude,\n                calRadius,\n                distanceUnitValue,\n                this.state.isLocationDisabled\n            );\n\n            const orgUnitLocations = await getOrgUnitLocationsByArea(orgUnitLocationsInput, actionContext);\n            if (orgUnitLocations) {\n                await this._setOrgUnitStoreInformation(orgUnitLocations);\n                await this._setSelectedStore(undefined);\n            }\n            return;\n        }\n\n        if (!storeSelectorStateManager || !storeSelectorStateManager.context) {\n            // Store selector dialog isn't open yet, so don't try and update anything\n            return;\n        }\n\n        if (!storeSelectorStateManager.context.product) {\n            // TODO: Use alternative search method here to not make inventory check\n            return;\n        }\n\n        const input = new GetFullAvailableInventoryNearbyInput(\n            storeSelectorStateManager.context.product.RecordId,\n            latitude || 0,\n            longitude || 0,\n            calRadius,\n            distanceUnitValue,\n            this.state.isLocationDisabled\n        );\n\n        await getFullAvailableInventoryNearby(input, actionContext).catch((error) => {\n            telemetry.warning(error);\n            telemetry.error(error.message);\n            telemetry.debug(`Unable to get full available inventory near by`);\n        });\n    }\n\n    private _onOrgUnitLocationSelected = async (location: OrgUnitLocation | undefined): Promise<void> => {\n        const {\n            telemetry,\n            data: {\n                storeSelectorStateManager: { result: storeSelectorStateManager }\n            }\n        } = this.props;\n\n        if (storeSelectorStateManager) {\n            if (location && storeSelectorStateManager.context) {\n                // Want to eat exceptions here so that the dialog still closes even if the onLocationSelected call goes wrong\n                await storeSelectorStateManager.context.onLocationSelected(location).catch(error => {\n                    telemetry.warning(error);\n                    telemetry.error(error.message);\n                    telemetry.debug(`Unable to get on org unit location selected`);\n                });\n            }\n\n            await storeSelectorStateManager.closeDialog();\n        }\n    };\n}\n\nexport default StoreSelector;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}