{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import{Button,getPayloadObject,getTelemetryAttributes,getTelemetryObject,TelemetryConstant}from'@msdyn365-commerce-modules/utilities';import*as Msdyn365 from'@msdyn365-commerce/core';import classname from'classnames';import _get from'lodash/get';import{computed}from'mobx';import*as React from'react';import{getGroups}from'../../common/get-groups';import{getOrderInfomationInput,getOrderInformation}from'../../common/get-order-information';import{getSalesLines,getSalesLinesInput}from'../../common/get-sales-lines';import LabelComponent from'../../common/label';import{getTenderIdOperationIdMap}from'../../common/utilities';import{getOrderConfirmationHelp}from'../order-confirmation/components/get-help';import{getOrderConfirmationOrderSummary}from'../order-confirmation/components/get-order-summary';import{getOrderConfirmationPaymentMethods}from'../order-confirmation/components/get-payment-methods';export*from'../../common/get-groups';export*from'../../common/get-order-information';export*from'../../common/get-sales-line';export*from'../../common/get-sales-lines';export*from'../../common/utilities';export*from'../order-confirmation/components/get-help';export*from'../order-confirmation/components/get-order-summary';export*from'../order-confirmation/components/get-payment-methods';var OrderConfirmation=/*#__PURE__*/function(_React$PureComponent){_inherits(OrderConfirmation,_React$PureComponent);var _super=_createSuper(OrderConfirmation);function OrderConfirmation(props){var _this;_classCallCheck(this,OrderConfirmation);_this=_super.call(this,props);_this.moduleName='ms-order-confirmation';_this.handleCheckoutOrderConfirmationHeadingChange=function(event){return _this.props.config.heading.text=event.target.value;};_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);var payLoad=getPayloadObject('click',_this.telemetryContent,TelemetryConstant.BackToShopping);_this.backToShoppingAttributes=getTelemetryAttributes(_this.telemetryContent,payLoad);return _this;}_createClass(OrderConfirmation,[{key:\"render\",value:function render(){var _this$props=this.props,_this$props$resources=_this$props.resources,noSalesOrderText=_this$props$resources.noSalesOrderText,genericErrorMessage=_this$props$resources.genericErrorMessage,needHelpLabel=_this$props$resources.needHelpLabel,helpLineNumberLabel=_this$props$resources.helpLineNumberLabel,loadingLabel=_this$props$resources.loadingLabel,backToShopping=_this$props$resources.backToShopping,orderItemLabel=_this$props$resources.orderItemLabel,orderItemsLabel=_this$props$resources.orderItemsLabel,helpLineContactAriaLabel=_this$props$resources.helpLineContactAriaLabel,_this$props$config=_this$props.config,heading=_this$props$config.heading,contactNumber=_this$props$config.contactNumber;var moduleProps={moduleProps:this.props,className:classname('ms-order-confirmation',this.props.config.className)};var backToShoppingUrl=Msdyn365.getUrlSync('home',this.props.context.actionContext)||'';var viewProps=_objectSpread(_objectSpread({},this.props),{},{moduleProps:moduleProps,heading:heading&&heading.text&&/*#__PURE__*/React.createElement(Msdyn365.Text,Object.assign({},heading,{className:'ms-order-confirmation__heading',text:heading.text,tag:heading.tag||'h2',editProps:{onEdit:this.handleCheckoutOrderConfirmationHeadingChange,requestContext:this.props.context.request}})),backToShoppingLink:backToShoppingUrl&&/*#__PURE__*/React.createElement(Button,Object.assign({className:'ms-order-confirmation__btn-keep-shopping',href:backToShoppingUrl},this.backToShoppingAttributes),backToShopping),footerProps:{className:'ms-order-confirmation__footer'}});if(this.hasError){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-confirmation__alert',label:genericErrorMessage})});return this.props.renderView(viewProps);}if(!this.isDataReady){viewProps=_objectSpread(_objectSpread({},viewProps),{},{loading:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-confirmation__loading',label:loadingLabel})});return this.props.renderView(viewProps);}if(!this.order){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-confirmation__alert',label:noSalesOrderText})});return this.props.renderView(viewProps);}var salesLinesInput=getSalesLinesInput(this.props,this.moduleName,this.order,this.products,this.priceContext);var salesLines=salesLinesInput&&getSalesLines(salesLinesInput);var orderInfomationInput=this.order&&getOrderInfomationInput(this.props,this.moduleName,this.order,this.priceContext);var orderInfomation=orderInfomationInput&&getOrderInformation(orderInfomationInput);viewProps=_objectSpread(_objectSpread({},viewProps),{},{salesOrder:this.order,orderInfomation:orderInfomation,salesLines:salesLines,groups:salesLines?getGroups({moduleName:this.moduleName,salesLines:salesLines,resources:{orderItemLabel:orderItemLabel,orderItemsLabel:orderItemsLabel}}):undefined,orderSummary:this.orderSummaryProps?getOrderConfirmationOrderSummary(this.orderSummaryProps):undefined,payment:this.paymentMethodsProps?getOrderConfirmationPaymentMethods(this.paymentMethodsProps):undefined,help:contactNumber?getOrderConfirmationHelp({needHelpLabel:needHelpLabel,helpLineNumberLabel:helpLineNumberLabel,contactNumber:contactNumber,helpLineContactAriaLabel:helpLineContactAriaLabel,telemetryContent:this.telemetryContent}):undefined});return this.props.renderView(viewProps);}},{key:\"isCurrentChannel\",get:function get(){if(!this.order){return false;}return this.order.ChannelId===_get(this.props,'context.request.apiSettings.channelId');}},{key:\"isDataReady\",get:function get(){return _get(this.props,'data.checkout.status')==='SUCCESS';}},{key:\"hasError\",get:function get(){return _get(this.props,'data.checkout.status')==='FAILED';}},{key:\"order\",get:function get(){return _get(this.props,'data.checkout.result.salesOrder');}},{key:\"products\",get:function get(){return _get(this.props,'data.checkout.result.orderedProducts')||[];}},{key:\"priceContext\",get:function get(){var _this$props2=this.props,id=_this$props2.id,typeName=_this$props2.typeName,context=_this$props2.context,telemetry=_this$props2.telemetry,freePriceText=_this$props2.resources.freePriceText;return{id:id,typeName:typeName,context:context,telemetry:telemetry,freePriceText:freePriceText};}},{key:\"earnedPoints\",get:function get(){var loyaltyCard=this.props.data.loyaltyCard.result;if(loyaltyCard&&loyaltyCard.RewardPoints&&this.order){var pointPrograms=loyaltyCard.RewardPoints.map(function(point){return point.RewardPointId;});var rewardLines=this.order.LoyaltyRewardPointLines||[];var total=0;rewardLines.forEach(function(line){if((line.RewardPointAmountQuantity||0)>0&&pointPrograms.indexOf(line.RewardPointId)>-1){total+=line.RewardPointAmountQuantity;}});return total;}return 0;}},{key:\"orderSummaryProps\",get:function get(){if(!this.order){return;}var _this$props$resources2=this.props.resources,orderSummaryHeading=_this$props$resources2.orderSummaryHeading,orderSummaryItemsTotalLabel=_this$props$resources2.orderSummaryItemsTotalLabel,orderSummaryShippingFeeLabel=_this$props$resources2.orderSummaryShippingFeeLabel,orderSummaryTaxLabel=_this$props$resources2.orderSummaryTaxLabel,orderSummaryGrandTotalLabel=_this$props$resources2.orderSummaryGrandTotalLabel,pointsEarnedLabel=_this$props$resources2.pointsEarnedLabel;return{order:this.order,earnedPoints:this.earnedPoints,priceContext:this.priceContext,resource:{orderSummaryHeading:orderSummaryHeading,orderSummaryItemsTotalLabel:orderSummaryItemsTotalLabel,orderSummaryShippingFeeLabel:orderSummaryShippingFeeLabel,orderSummaryTaxLabel:orderSummaryTaxLabel,pointsEarnedLabel:pointsEarnedLabel,orderSummaryGrandTotalLabel:orderSummaryGrandTotalLabel}};}},{key:\"paymentMethodsProps\",get:function get(){var tenderTypes=this.props.data.tenderTypes.result;if(!this.order||!this.order.TenderLines||!tenderTypes){return;}var locale=_get(this.props,'context.request.locale')||'en-US';var _this$props$resources3=this.props.resources,paymentMethodsTitle=_this$props$resources3.paymentMethodsTitle,creditCardEndingLabel=_this$props$resources3.creditCardEndingLabel,giftCardEndingLabel=_this$props$resources3.giftCardEndingLabel,amountCoveredLabel=_this$props$resources3.amountCoveredLabel,cashUsedLabel=_this$props$resources3.cashUsedLabel,loyaltyCardUsedLabel=_this$props$resources3.loyaltyCardUsedLabel,customerAccountUsedLabel=_this$props$resources3.customerAccountUsedLabel;return{priceContext:this.priceContext,tenderLines:this.order.TenderLines,tenderIdOperationIdMap:getTenderIdOperationIdMap(tenderTypes),locale:locale,resource:{paymentMethodsTitle:paymentMethodsTitle,creditCardEndingLabel:creditCardEndingLabel,giftCardEndingLabel:giftCardEndingLabel,amountCoveredLabel:amountCoveredLabel,cashUsedLabel:cashUsedLabel,loyaltyCardUsedLabel:loyaltyCardUsedLabel,customerAccountUsedLabel:customerAccountUsedLabel}};}}]);return OrderConfirmation;}(React.PureComponent);__decorate([computed],OrderConfirmation.prototype,\"isCurrentChannel\",null);__decorate([computed],OrderConfirmation.prototype,\"isDataReady\",null);__decorate([computed],OrderConfirmation.prototype,\"hasError\",null);__decorate([computed],OrderConfirmation.prototype,\"order\",null);__decorate([computed],OrderConfirmation.prototype,\"products\",null);__decorate([computed],OrderConfirmation.prototype,\"priceContext\",null);__decorate([computed],OrderConfirmation.prototype,\"earnedPoints\",null);__decorate([computed],OrderConfirmation.prototype,\"orderSummaryProps\",null);__decorate([computed],OrderConfirmation.prototype,\"paymentMethodsProps\",null);export default OrderConfirmation;","map":{"version":3,"sources":["modules/checkout-order-confirmation/checkout-order-confirmation.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, TelemetryConstant } from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport { SalesOrder, SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport classname from 'classnames';\nimport get from 'lodash/get';\nimport { computed } from 'mobx';\nimport * as React from 'react';\nimport { IGetOrderSummaryInput, IHelp, IOrderSummary, IPaymentMethods, IPaymentMethodsInput  } from '../../common';\nimport { getGroups, IGroups } from '../../common/get-groups';\nimport { getOrderInfomationInput, getOrderInformation, IOrderInformation } from '../../common/get-order-information';\nimport { ISalesLine } from '../../common/get-sales-line';\nimport { getSalesLines, getSalesLinesInput } from '../../common/get-sales-lines';\nimport LabelComponent from '../../common/label';\nimport { getTenderIdOperationIdMap, IPriceContext } from '../../common/utilities';\nimport { getOrderConfirmationHelp } from '../order-confirmation/components/get-help';\nimport { getOrderConfirmationOrderSummary } from '../order-confirmation/components/get-order-summary';\nimport { getOrderConfirmationPaymentMethods } from '../order-confirmation/components/get-payment-methods';\nimport { ICheckoutOrderConfirmationData } from './checkout-order-confirmation.data';\nimport { ICheckoutOrderConfirmationProps } from './checkout-order-confirmation.props.autogenerated';\n\nexport * from '../../common/get-groups';\nexport * from '../../common/get-order-information';\nexport * from '../../common/get-sales-line';\nexport * from '../../common/get-sales-lines';\nexport * from '../../common/utilities';\nexport * from '../order-confirmation/components/get-help';\nexport * from '../order-confirmation/components/get-order-summary';\nexport * from '../order-confirmation/components/get-payment-methods';\n\nexport interface ICheckoutOrderConfirmationViewProps extends ICheckoutOrderConfirmationProps<ICheckoutOrderConfirmationData> {\n    moduleProps: IModuleProps;\n    salesOrder?: SalesOrder;\n    footerProps?: INodeProps;\n    alert?: React.ReactNode;\n    loading?: React.ReactNode;\n    heading: React.ReactNode;\n    backToShoppingLink?: React.ReactNode;\n    orderInfomation?: IOrderInformation;\n    salesLines?: ISalesLine[];\n    groups?: IGroups;\n    orderSummary?: IOrderSummary;\n    payment?: IPaymentMethods;\n    help?: IHelp;\n}\n\n/**\n *\n * OrderConfirmation component\n * @extends {React.PureComponent<IOrderConfirmationProps<IOrderConfirmationData>>}\n */\nclass OrderConfirmation extends React.PureComponent<ICheckoutOrderConfirmationProps<ICheckoutOrderConfirmationData>> {\n    private moduleName: string = 'ms-order-confirmation';\n    private telemetryContent?: ITelemetryContent;\n    private backToShoppingAttributes?: Msdyn365.IDictionary<string>;\n\n    constructor(props: ICheckoutOrderConfirmationProps<ICheckoutOrderConfirmationData>) {\n        super(props);\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n        const payLoad = getPayloadObject('click', this.telemetryContent, TelemetryConstant.BackToShopping);\n        this.backToShoppingAttributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n    }\n\n    @computed get isCurrentChannel(): boolean {\n        if (!this.order) {\n            return false;\n        }\n        return this.order.ChannelId === get(this.props, 'context.request.apiSettings.channelId');\n    }\n\n    @computed get isDataReady(): boolean {\n        return get(this.props, 'data.checkout.status') === 'SUCCESS';\n    }\n\n    @computed get hasError(): boolean {\n        return get(this.props, 'data.checkout.status') === 'FAILED';\n    }\n\n    @computed get order(): SalesOrder | undefined {\n        return get(this.props, 'data.checkout.result.salesOrder');\n    }\n\n    @computed get products(): SimpleProduct[] {\n        return get(this.props, 'data.checkout.result.orderedProducts') || [];\n    }\n\n    @computed get priceContext(): IPriceContext {\n        const {\n            id,\n            typeName,\n            context,\n            telemetry,\n            resources: { freePriceText }\n        } = this.props;\n        return {\n            id,\n            typeName,\n            context,\n            telemetry,\n            freePriceText\n        };\n    }\n\n    @computed get earnedPoints(): number {\n        const loyaltyCard = this.props.data.loyaltyCard.result;\n        if (loyaltyCard && loyaltyCard.RewardPoints && this.order) {\n            const pointPrograms = loyaltyCard.RewardPoints.map(point => point.RewardPointId);\n            const rewardLines = this.order.LoyaltyRewardPointLines || [];\n            let total = 0;\n            rewardLines.forEach(line => {\n                if ((line.RewardPointAmountQuantity || 0) > 0 && pointPrograms.indexOf(line.RewardPointId) > -1) {\n                    total += line.RewardPointAmountQuantity!;\n                }\n            });\n            return total;\n        }\n        return 0;\n    }\n\n    @computed get orderSummaryProps(): IGetOrderSummaryInput | undefined {\n        if (!this.order) {\n            return;\n        }\n\n        const {\n            resources: { orderSummaryHeading, orderSummaryItemsTotalLabel, orderSummaryShippingFeeLabel, orderSummaryTaxLabel, orderSummaryGrandTotalLabel, pointsEarnedLabel }\n        } = this.props;\n        return {\n            order: this.order,\n            earnedPoints: this.earnedPoints,\n            priceContext: this.priceContext,\n            resource: {\n                orderSummaryHeading,\n                orderSummaryItemsTotalLabel,\n                orderSummaryShippingFeeLabel,\n                orderSummaryTaxLabel,\n                pointsEarnedLabel,\n                orderSummaryGrandTotalLabel\n            }\n        };\n    }\n\n    @computed get paymentMethodsProps(): IPaymentMethodsInput | undefined {\n        const tenderTypes = this.props.data.tenderTypes.result;\n        if (!this.order || !this.order.TenderLines || !tenderTypes) {\n            return;\n        }\n\n        const locale = get(this.props, 'context.request.locale') || 'en-US';\n\n        const {\n            resources: {\n                paymentMethodsTitle,\n                creditCardEndingLabel,\n                giftCardEndingLabel,\n                amountCoveredLabel,\n                cashUsedLabel,\n                loyaltyCardUsedLabel,\n                customerAccountUsedLabel\n            }\n        } = this.props;\n\n        return {\n            priceContext: this.priceContext,\n            tenderLines: this.order.TenderLines,\n            tenderIdOperationIdMap: getTenderIdOperationIdMap(tenderTypes),\n            locale,\n            resource: {\n                paymentMethodsTitle,\n                creditCardEndingLabel,\n                giftCardEndingLabel,\n                amountCoveredLabel,\n                cashUsedLabel,\n                loyaltyCardUsedLabel,\n                customerAccountUsedLabel\n            }\n        };\n    }\n\n    public render(): JSX.Element {\n        const {\n            resources: {\n                noSalesOrderText,\n                genericErrorMessage,\n                needHelpLabel,\n                helpLineNumberLabel,\n                loadingLabel,\n                backToShopping,\n                orderItemLabel,\n                orderItemsLabel,\n                helpLineContactAriaLabel,\n            },\n            config: { heading, contactNumber }\n        } = this.props;\n\n        const moduleProps = { moduleProps: this.props, className: classname('ms-order-confirmation', this.props.config.className) };\n        const backToShoppingUrl = Msdyn365.getUrlSync('home', this.props.context.actionContext) || '';\n\n        let viewProps: ICheckoutOrderConfirmationViewProps = {\n            ...this.props,\n            moduleProps,\n            heading: heading && heading.text && (\n            <Msdyn365.Text\n                {...heading}\n                className='ms-order-confirmation__heading'\n                text={heading.text}\n                tag={heading.tag || 'h2'}\n                editProps={{ onEdit: this.handleCheckoutOrderConfirmationHeadingChange, requestContext: this.props.context.request }}\n            />\n            ),\n            backToShoppingLink: backToShoppingUrl && (\n                <Button className='ms-order-confirmation__btn-keep-shopping' href={backToShoppingUrl} {...this.backToShoppingAttributes}>\n                    {backToShopping}\n                </Button>\n            ),\n            footerProps: { className: 'ms-order-confirmation__footer' }\n        };\n\n        if (this.hasError) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-confirmation__alert' label={genericErrorMessage} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!this.isDataReady) {\n            viewProps = {\n                ...viewProps,\n                loading: <LabelComponent className='ms-order-confirmation__loading' label={loadingLabel} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!this.order) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-confirmation__alert' label={noSalesOrderText} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        const salesLinesInput = getSalesLinesInput(this.props, this.moduleName, this.order, this.products, this.priceContext);\n        const salesLines = salesLinesInput && getSalesLines(salesLinesInput);\n\n        const orderInfomationInput = this.order && getOrderInfomationInput(this.props, this.moduleName, this.order, this.priceContext);\n        const orderInfomation = orderInfomationInput && getOrderInformation(orderInfomationInput);\n\n        viewProps = {\n            ...viewProps,\n            salesOrder: this.order,\n            orderInfomation,\n            salesLines,\n            groups: salesLines\n                ? getGroups({\n                    moduleName: this.moduleName,\n                    salesLines,\n                    resources: { orderItemLabel, orderItemsLabel }\n                })\n                : undefined,\n            orderSummary: this.orderSummaryProps ? getOrderConfirmationOrderSummary(this.orderSummaryProps) : undefined,\n            payment: this.paymentMethodsProps ? getOrderConfirmationPaymentMethods(this.paymentMethodsProps) : undefined,\n            help: contactNumber ? getOrderConfirmationHelp({ needHelpLabel, helpLineNumberLabel, contactNumber, helpLineContactAriaLabel, telemetryContent: this.telemetryContent }) : undefined\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleCheckoutOrderConfirmationHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n\n}\n\nexport default OrderConfirmation;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}