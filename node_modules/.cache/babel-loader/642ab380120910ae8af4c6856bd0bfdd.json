{"ast":null,"code":"import\"core-js/modules/web.dom-collections.for-each.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import{withModuleState}from'@msdyn365-commerce-modules/checkout-utilities';import classname from'classnames';import get from'lodash/get';import{reaction}from'mobx';import{observer}from'mobx-react';import*as React from'react';import LoadingComponent from'./components/loading';let CheckoutPlainContainer=class CheckoutPlainContainer extends React.Component{constructor(){super(...arguments);this.getItems=()=>{const{slots}=this.props;return slots&&slots.primary&&slots.primary.length&&slots.primary||[];};this.getActiveChildModuleStates=()=>{const{childIds,getModule}=this.props.moduleState;return childIds.map(getModule).filter(state=>!!state&&!state.isDisabled&&state.hasModuleState);};this.clearError=()=>{this.getActiveChildModuleStates().forEach(state=>{state.hasError&&state.setHasError(false);});};this.onSubmit=()=>{this.clearError();this.getActiveChildModuleStates().forEach(state=>{!state.isReady&&state.onSubmit&&state.onSubmit();});};this.onCancel=()=>{this.clearError();this.getActiveChildModuleStates().forEach(state=>{!state.isReady&&state.onCancel&&state.onCancel();});};this.onEdit=()=>{this.getActiveChildModuleStates().forEach(state=>{(state.isReady||state.isSkipped)&&state.onEdit&&state.onEdit();});};this.onContainerReady=()=>{this.getActiveChildModuleStates().forEach(state=>{state.isReady&&state.onContainerReady&&state.onContainerReady();});};}componentDidMount(){const items=this.getItems();const childIds=items.map(item=>get(item,'props.id'));this.props.moduleState.init({onEdit:this.onEdit,onCancel:this.onCancel,onSubmit:this.onSubmit,childIds});reaction(()=>this.props.moduleState.isReady,()=>{this.onContainerReady();});reaction(()=>this.props.moduleState.shouldSubmitContainer,()=>{this.onSubmit();});}componentDidUpdate(){if(!this.props.moduleState.hasExternalSubmitGroup){return;}const{childIds,hasError,getModule}=this.props.moduleState;const hasReadyItems=childIds.some(childId=>{const state=getModule(childId);return!!state&&state.isReady;});if(hasReadyItems&&hasError){this.onEdit();}}render(){const{enableControl,moduleState,config:{width}}=this.props;const items=this.getItems();if(!items.length){this.props.context.telemetry.error('Checkout section content is empty, module wont render');return null;}const moduleClassName=classname('ms-checkout-section-container',{'has-initialized':moduleState.hasInitialized,'is-ready':moduleState.isReady,'is-updating':!moduleState.isReady,container:width==='container','col-12 fullwidth':width==='fluid'},this.props.config.className);const viewProps=_objectSpread(_objectSpread({},this.props),{},{className:moduleClassName,checkoutPlainContainerProps:{moduleProps:this.props,className:moduleClassName},items:items.map(item=>{const childId=get(item,'props.id');const state=moduleState.getModule(childId);const hidden=state.hasModuleState&&(!state.hasInitialized||state.isDisabled||state.isSkipped);return{id:childId,loading:state.hasModuleState&&!state.hasInitialized&&/*#__PURE__*/React.createElement(LoadingComponent,null),itemProps:{'data-type-name':state.typeName,className:classname('ms-checkout-section-container__item',{hidden:hidden,initialized:state.hasInitialized,disabled:state.isDisabled,skipped:state.isSkipped,ready:state.isReady,updating:state.isUpdating,pending:state.isPending})},item:/*#__PURE__*/React.cloneElement(item,{enableControl})};})});return this.props.renderView(viewProps);}};CheckoutPlainContainer=__decorate([observer],CheckoutPlainContainer);export{CheckoutPlainContainer};export default withModuleState(CheckoutPlainContainer);","map":{"version":3,"sources":["modules/checkout-section-container/checkout-section-container.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IModuleStateManager, IModuleStateProps, withModuleState } from '@msdyn365-commerce-modules/checkout-utilities';\nimport { IModuleProps, INodeProps } from '@msdyn365-commerce-modules/utilities';\nimport classname from 'classnames';\nimport get from 'lodash/get';\nimport { reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { ICheckoutSectionContainerProps } from './checkout-section-container.props.autogenerated';\nimport LoadingComponent from './components/loading';\n\nexport interface ICheckoutSectionContainerModuleProps extends ICheckoutSectionContainerProps<{}>, IModuleStateProps {\n    enableControl: boolean;\n}\n\nexport interface ICheckoutSectionContainerItem {\n    id: string;\n    loading?: React.ReactNode;\n    itemProps: INodeProps;\n    item: React.ReactNode;\n}\n\nexport interface ICheckoutSectionContainerViewProps extends ICheckoutSectionContainerProps<{}> {\n    className: string;\n    checkoutPlainContainerProps: IModuleProps;\n    items: ICheckoutSectionContainerItem[];\n}\n\n/**\n *\n * CheckoutPlainContainer component\n * @extends {React.Component<ICheckoutSectionContainerModuleProps>}\n */\n@observer\nexport class CheckoutPlainContainer extends React.Component<ICheckoutSectionContainerModuleProps> {\n    public componentDidMount(): void {\n        const items = this.getItems();\n        const childIds = items.map((item: React.ReactNode) => get(item, 'props.id'));\n        this.props.moduleState.init({\n            onEdit: this.onEdit,\n            onCancel: this.onCancel,\n            onSubmit: this.onSubmit,\n            childIds\n        });\n\n        reaction(\n            () => this.props.moduleState.isReady,\n            () => {\n                this.onContainerReady();\n            }\n        );\n\n        reaction(\n            () => this.props.moduleState.shouldSubmitContainer,\n            () => {\n                this.onSubmit();\n            }\n        );\n    }\n\n    public componentDidUpdate(): void {\n        if (!this.props.moduleState.hasExternalSubmitGroup) {\n            return;\n        }\n        /**\n         * Review all modules to updating status if one of the modules has error\n         */\n        const { childIds, hasError, getModule } = this.props.moduleState;\n        const hasReadyItems = childIds.some((childId: string) => {\n            const state = getModule(childId);\n            return !!state && state.isReady;\n        });\n        if (hasReadyItems && hasError) {\n            this.onEdit();\n        }\n    }\n\n    public render(): JSX.Element | null {\n        const {\n            enableControl,\n            moduleState,\n            config: { width }\n        } = this.props;\n\n        const items = this.getItems();\n        if (!items.length) {\n            this.props.context.telemetry.error('Checkout section content is empty, module wont render');\n            return null;\n        }\n\n        const moduleClassName = classname(\n            'ms-checkout-section-container',\n            {\n                'has-initialized': moduleState.hasInitialized,\n                'is-ready': moduleState.isReady,\n                'is-updating': !moduleState.isReady,\n                container: width === 'container',\n                'col-12 fullwidth': width === 'fluid'\n            },\n            this.props.config.className\n        );\n\n        const viewProps: ICheckoutSectionContainerViewProps = {\n            ...this.props,\n\n            className: moduleClassName,\n            checkoutPlainContainerProps: {\n                moduleProps: this.props,\n                className: moduleClassName\n            },\n            items: items.map((item: React.ReactNode) => {\n                const childId = get(item, 'props.id');\n                const state = moduleState.getModule(childId);\n                // Modules has not completed initializing or it's disable\n                const hidden = state.hasModuleState && (!state.hasInitialized || state.isDisabled || state.isSkipped);\n                return {\n                    id: childId,\n                    loading: state.hasModuleState && !state.hasInitialized && <LoadingComponent />,\n                    itemProps: {\n                        'data-type-name': state.typeName,\n                        className: classname('ms-checkout-section-container__item', {\n                            hidden: hidden,\n                            initialized: state.hasInitialized,\n                            disabled: state.isDisabled,\n                            skipped: state.isSkipped,\n                            ready: state.isReady,\n                            updating: state.isUpdating,\n                            pending: state.isPending\n                        })\n                    },\n                    item: React.cloneElement(item as React.ReactElement, { enableControl })\n                };\n            })\n        };\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private getItems = (): React.ReactNode[] => {\n        const { slots } = this.props;\n        return (slots && slots.primary && slots.primary.length && slots.primary) || [];\n    };\n\n    private getActiveChildModuleStates = (): IModuleStateManager[] => {\n        const { childIds, getModule } = this.props.moduleState;\n        return childIds\n            .map(getModule)\n            .filter((state): state is IModuleStateManager => !!state && !state.isDisabled && state.hasModuleState);\n    };\n\n    private clearError = (): void => {\n        // Clear error before action, otherwise it will rise conflict;\n        this.getActiveChildModuleStates().forEach(state => {\n            state.hasError && state.setHasError(false);\n        });\n    };\n\n    private onSubmit = (): void => {\n        this.clearError();\n        this.getActiveChildModuleStates().forEach(state => {\n            !state.isReady && state.onSubmit && state.onSubmit();\n        });\n    };\n\n    private onCancel = (): void => {\n        this.clearError();\n        this.getActiveChildModuleStates().forEach(state => {\n            !state.isReady && state.onCancel && state.onCancel();\n        });\n    };\n\n    private onEdit = (): void => {\n        this.getActiveChildModuleStates().forEach(state => {\n            (state.isReady || state.isSkipped) && state.onEdit && state.onEdit();\n        });\n    };\n\n    private onContainerReady = (): void => {\n        this.getActiveChildModuleStates().forEach(state => {\n            state.isReady && state.onContainerReady && state.onContainerReady();\n        });\n    };\n}\n\nexport default withModuleState(CheckoutPlainContainer);\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}