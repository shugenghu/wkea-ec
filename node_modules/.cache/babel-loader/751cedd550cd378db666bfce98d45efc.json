{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import classnames from'classnames';import{observable,reaction,set}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{getTelemetryObject}from'@msdyn365-commerce-modules/utilities';import{AddressCommon}from'../../common/address-common';import{AddressFormat}from'../../common/address-format';import{AddressItemType}from'../../common/address-format.data';import{AddressMetaData}from'../../common/address-meta-data';import{AddressOperation,AddressType}from'../../common/address-module.data';import{AddressAddUpdate}from'../../common/components/address-add';import{AddressList}from'../../common/components/address-list';var AccountManagementAddress=/*#__PURE__*/function(_React$Component){_inherits(AccountManagementAddress,_React$Component);var _super=_createSuper(AccountManagementAddress);function AccountManagementAddress(props){var _this;_classCallCheck(this,AccountManagementAddress);_this=_super.call(this,props);_this.countryRegionId='USA';_this.defaultAddressType=6;_this._renderAddOrUpdateAddress=function(){return AddressAddUpdate({isUpdating:_this.isUpdating,resources:_this.resources,addressType:AddressType.Shipping,addressFormat:_this.addressFormat.getAddressFormat(_this.addUpdateAddress.ThreeLetterISORegionName||_this.countryRegionId),defaultCountryRegionId:_this.countryRegionId,defaultAddressType:_this.defaultAddressType,selectedAddress:_this.addUpdateAddress,validationError:_this.validationError,addressActionResponse:_this.addressActionResponse,dropdownDisplayData:_this.addressFormat.getPrefilledAddressDropdownData(_this.resources.addressStateDefaultSelectionText,_this.stateProvinceInfo),telemetryContent:_this.telemetryContent,onInputChange:_this._onAddressAddUpdateInputChange,onDropdownChange:_this._onAddressAddUpdateDropdownChange,onSave:_this._onAddressAddUpdateSubmit,onCancel:_this._resetView});};_this._renderListAddress=function(){var config=_this.props.config;return AddressList({isUpdating:_this.isUpdating,selectedAddress:_this.selectedAddress,addressFormat:_this.addressFormat,addresses:_this.customerAddresses,addressPurposes:_this.addressPurposes,resources:_this.resources,heading:config.heading,primaryAddressSectionHeading:config.primaryAddressSectionHeading,otherAddressSectionHeading:config.otherAddressSectionHeading,contextRequest:_this.props.context.request,telemetryContent:_this.telemetryContent,onEditAddress:_this._goToEditAddress,onRemoveAddress:_this._onRemoveAddress,onAddAddress:_this._goToAddAddress,onUpdatePrimaryAddress:_this._onSubmitUpdatePrimaryAddress});};_this.onAddressAddUpdate=function(name,value){set(_this.addUpdateAddress,_defineProperty({},name,value));_this.addressFormat.validateAddressFormat(_this.addUpdateAddress,_this.validationError,_this.countryRegionId,name);};_this._onAddressAddUpdateInputChange=function(event){if(event.target.type==='checkbox'){_this.onAddressAddUpdate(event.target.name,event.target.checked);}else{var value=(event.target.value||'').replace(new RegExp('[<>]','gi'),'');_this.onAddressAddUpdate(event.target.name,value);}};_this._onAddressAddUpdateDropdownChange=function(event){if(event.target.name===AddressItemType[AddressItemType.AddressTypeValue]){_this.onAddressAddUpdate(event.target.name,+event.target.value);}else{_this.onAddressAddUpdate(event.target.name,event.target.value);}if(event.target.name===AddressItemType[AddressItemType.ThreeLetterISORegionName]){_this._onCountryChange(event.target.value);}};_this._onAddressUpdate=function(response,onSuccess){_this.isUpdating=true;response.then(function(result){if(result.address){_this.hasError=false;onSuccess(result);}else{_this.hasError=true;_this.addressActionResponse=result;}_this.isUpdating=false;},function(){_this.hasError=true;_this.isUpdating=false;});};_this._onAddressAddUpdateSubmit=function(){if(!_this.addressFormat.validateAddressFormat(_this.addUpdateAddress,_this.validationError,_this.countryRegionId)){return;}var response;if(_this.addressCommon.isAuthenticatedFlow()){response=_this.currentOperation===AddressOperation.Update?_this.addressCommon.updateCustomerAddress(_this.addUpdateAddress):_this.addressCommon.addCustomerAddress(_this.addUpdateAddress);}else{response=Promise.resolve({address:_this.addUpdateAddress});}_this._onAddressUpdate(response,_this._onAddOrUpdateSuccess);};_this._onCountryChange=function(countryRegionId){_this.countryRegionId=countryRegionId;set(_this.addUpdateAddress,_defineProperty({},'ThreeLetterISORegionName',countryRegionId));};_this._getAddressFormatExcludeList=function(){var config=_this.props.config;var addressFormatExcludeList=[];if(!config.showAddressType){addressFormatExcludeList.push(AddressItemType.AddressTypeValue);}addressFormatExcludeList.push(AddressItemType.IsPrimary);return addressFormatExcludeList;};_this._getStateProvinces=function(){if(!_this.countryRegionId||!(_this.currentOperation===AddressOperation.Add||_this.currentOperation===AddressOperation.Update)){return;}_this.addressCommon.getStateProvinces(_this.countryRegionId).then(function(result){var stateInfo=result.some(function(state){return state.StateId===_this.addUpdateAddress.State;});if(!stateInfo){set(_this.addUpdateAddress,_defineProperty({},'State',''));}_this.stateProvinceInfo=result;});};_this._updateCurrentOperation=function(operation){_this.currentOperation=operation;};_this._onSubmitUpdatePrimaryAddress=function(address){_this.selectedAddress=address;var response=_this.addressCommon.updateCustomerPrimaryAddress(address);_this._onAddressUpdate(response,_this._onUpdatePrimaryAddressSuccess);};_this._goToEditAddress=function(address){_this.addUpdateAddress=_objectSpread({},address);_this.countryRegionId=_this.addUpdateAddress.ThreeLetterISORegionName||'USA';_this._updateCurrentOperation(AddressOperation.Update);};_this._onRemoveAddress=function(address){address.Deactivate=true;var response=_this.addressCommon.updateCustomerAddress(address);_this._onAddressUpdate(response,_this._onAddOrUpdateSuccess);};_this._goToAddAddress=function(){_this.addUpdateAddress={};_this._setDefaultCountryRegionId();set(_this.addUpdateAddress,_defineProperty({},'ThreeLetterISORegionName',_this.countryRegionId));set(_this.addUpdateAddress,_defineProperty({},'AddressTypeValue',_this.defaultAddressType));_this._setDefaultCountryRegionId();_this._updateCurrentOperation(AddressOperation.Add);};_this._onAddOrUpdateSuccess=function(response){if(response.customerAddresses){_this.customerAddresses=response.customerAddresses;}_this._resetView();};_this._onUpdatePrimaryAddressSuccess=function(response){if(response.customerAddresses){_this.customerAddresses=response.customerAddresses;}};_this._resetView=function(){_this.selectedAddress=undefined;_this._updateCurrentOperation(AddressOperation.List);};var _this$props=_this.props,context=_this$props.context,data=_this$props.data,resources=_this$props.resources,telemetry=_this$props.telemetry;_this.resources=resources;_this.currentOperation=AddressOperation.List;_this.countryRegions=data.countryRegions.result||[];_this.addressPurposes=data.addressPurposes.result||[];_this.customerAddresses=data.address.result||[];_this.addUpdateAddress={};_this.validationError={};_this.addressCommon=new AddressCommon(context,resources,telemetry);_this.addressFormat=new AddressFormat(_this.countryRegions,new AddressMetaData(_objectSpread({},resources),_this._getAddressFormatExcludeList()),_this.addressPurposes);_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);return _this;}_createClass(AccountManagementAddress,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.props.data.countryRegions.then(function(){_this2._setDefaultCountryRegionId();});reaction(function(){return _this2.countryRegionId;},function(){return _this2._getStateProvinces();});reaction(function(){return _this2.currentOperation;},function(){_this2._getStateProvinces();});}},{key:\"render\",value:function render(){var _this$props2=this.props,renderView=_this$props2.renderView,config=_this$props2.config;var viewProps=_objectSpread(_objectSpread({},this.props),{},{currentOperation:this.currentOperation,selectedAddress:this.selectedAddress,addUpdateAddress:this.addUpdateAddress,countryRegionId:this.countryRegionId,stateProvinceInfo:this.stateProvinceInfo,customerAddresses:this.customerAddresses,validationError:this.validationError,addressActionResponse:this.addressActionResponse,isUpdating:this.isUpdating,hasError:this.hasError,className:config.className,viewState:{isShowAddresList:this.currentOperation===AddressOperation.List,isShowAddOrUpdateAddress:this.currentOperation!==AddressOperation.List},AccountAddressManagement:{moduleProps:this.props,className:classnames('ms-account-management-address',config.className)},showAddressList:this._renderListAddress(),showAddOrUpdateAddress:this._renderAddOrUpdateAddress()});return renderView(viewProps);}},{key:\"_setDefaultCountryRegionId\",value:function _setDefaultCountryRegionId(){var request=this.props.context.request;var market=request&&request.channel&&request.channel.ChannelCountryRegionISOCode;this.countryRegionId=this.addressCommon.getDefaultCountryRegionId(this.countryRegionId,this.countryRegions,market);}}]);return AccountManagementAddress;}(React.Component);__decorate([observable],AccountManagementAddress.prototype,\"currentOperation\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"selectedAddress\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"countryRegionId\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"stateProvinceInfo\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"customerAddresses\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"addUpdateAddress\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"validationError\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"addressActionResponse\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"isUpdating\",void 0);__decorate([observable],AccountManagementAddress.prototype,\"hasError\",void 0);AccountManagementAddress=__decorate([observer],AccountManagementAddress);export default AccountManagementAddress;","map":{"version":3,"sources":["modules/account-management-address/account-management-address.tsx"],"names":[],"mappings":"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","sourcesContent":["\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classnames from 'classnames';\nimport { observable, reaction, set } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport { getTelemetryObject, IModuleProps, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport {\n    Address, AddressPurpose, CountryRegionInfo, StateProvinceInfo\n} from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\n\nimport { AddressCommon } from '../../common/address-common';\nimport { AddressFormat } from '../../common/address-format';\nimport { AddressItemType } from '../../common/address-format.data';\nimport { AddressMetaData } from '../../common/address-meta-data';\nimport {\n    AddressOperation, AddressType, IAddressResource, IAddressResponse\n} from '../../common/address-module.data';\nimport { AddressAddUpdate, IAddressAddUpdateProps } from '../../common/components/address-add';\nimport { AddressList, IAddressListProps } from '../../common/components/address-list';\nimport { IAccountManagementAddressData } from './account-management-address.data';\nimport { IAccountManagementAddressProps } from './account-management-address.props.autogenerated';\n\nexport interface IAccountManagementAddressViewState {\n    isShowAddresList: boolean;\n    isShowAddOrUpdateAddress: boolean;\n}\n\nexport interface IAccountManagementAddressViewProps extends React.Component<IAccountManagementAddressProps<IAccountManagementAddressData>> {\n    className: string;\n    currentOperation: AddressOperation;\n    selectedAddress?: Address;\n    addUpdateAddress: Address;\n    countryRegionId: string;\n    stateProvinceInfo?: StateProvinceInfo[];\n    customerAddresses: Address[];\n    validationError: object;\n    addressActionResponse?: IAddressResponse;\n    viewState: IAccountManagementAddressViewState;\n    AccountAddressManagement: IModuleProps;\n    isUpdating: boolean;\n    showAddressList: IAddressListProps;\n    showAddOrUpdateAddress: IAddressAddUpdateProps;\n}\n\n/**\n *\n * Address component\n * @extends {React.Component<IAccountManagementAddressProps<IAccountManagementAddressData>>}\n */\n@observer\nclass AccountManagementAddress extends React.Component<IAccountManagementAddressProps<IAccountManagementAddressData>> {\n    @observable private currentOperation: AddressOperation;\n    @observable private selectedAddress?: Address;\n    @observable private countryRegionId: string = 'USA';\n    @observable private stateProvinceInfo?: StateProvinceInfo[];\n    @observable private customerAddresses: Address[];\n    @observable private addUpdateAddress: Address;\n    @observable private validationError: object;\n    @observable private addressActionResponse?: IAddressResponse;\n    @observable private isUpdating?: boolean;\n    @observable private hasError?: boolean;\n\n    private addressCommon: AddressCommon;\n    private addressFormat: AddressFormat;\n    private countryRegions: CountryRegionInfo[];\n    private addressPurposes: AddressPurpose[];\n    private resources: IAddressResource;\n    private defaultAddressType: number = 6; // Default to Home\n    private telemetryContent: ITelemetryContent;\n\n    constructor(props: IAccountManagementAddressProps<IAccountManagementAddressData>) {\n        super(props);\n        const { context, data, resources, telemetry } = this.props;\n\n        this.resources = resources;\n        this.currentOperation = AddressOperation.List;\n        this.countryRegions = data.countryRegions.result || [];\n        this.addressPurposes = data.addressPurposes.result || [];\n        this.customerAddresses = data.address.result || [];\n        this.addUpdateAddress = {};\n        this.validationError = {};\n        this.addressCommon = new AddressCommon(context, resources, telemetry);\n        this.addressFormat = new AddressFormat(this.countryRegions, new AddressMetaData({ ...resources }, this._getAddressFormatExcludeList()), this.addressPurposes);\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public componentDidMount(): void {\n        this.props.data.countryRegions.then(() => {\n            this._setDefaultCountryRegionId();\n        });\n\n        reaction(\n            () => this.countryRegionId,\n            () => this._getStateProvinces()\n        );\n\n        reaction(\n            () => this.currentOperation,\n            () => {\n                this._getStateProvinces();\n            }\n        );\n    }\n\n    public render(): JSX.Element {\n        const { renderView, config } = this.props;\n\n        const viewProps = {\n            ...this.props,\n            currentOperation: this.currentOperation,\n            selectedAddress: this.selectedAddress,\n            addUpdateAddress: this.addUpdateAddress,\n            countryRegionId: this.countryRegionId,\n            stateProvinceInfo: this.stateProvinceInfo,\n            customerAddresses: this.customerAddresses,\n            validationError: this.validationError,\n            addressActionResponse: this.addressActionResponse,\n            isUpdating: this.isUpdating,\n            hasError: this.hasError,\n            className: config.className,\n            viewState: {\n                isShowAddresList: this.currentOperation === AddressOperation.List,\n                isShowAddOrUpdateAddress: this.currentOperation !== AddressOperation.List,\n            },\n            AccountAddressManagement: {\n                moduleProps: this.props,\n                className: classnames('ms-account-management-address', config.className)\n            },\n            showAddressList: this._renderListAddress(),\n            showAddOrUpdateAddress: this._renderAddOrUpdateAddress()\n        };\n\n        return renderView(viewProps) as React.ReactElement;\n    }\n\n    private _renderAddOrUpdateAddress = (): IAddressAddUpdateProps => {\n        return AddressAddUpdate(\n            {\n                isUpdating: this.isUpdating,\n                resources: this.resources,\n                addressType: AddressType.Shipping,\n                addressFormat: this.addressFormat.getAddressFormat((this.addUpdateAddress.ThreeLetterISORegionName) || this.countryRegionId),\n                defaultCountryRegionId: this.countryRegionId,\n                defaultAddressType: this.defaultAddressType,\n                selectedAddress: this.addUpdateAddress,\n                validationError: this.validationError,\n                addressActionResponse: this.addressActionResponse,\n                dropdownDisplayData: this.addressFormat.getPrefilledAddressDropdownData(this.resources.addressStateDefaultSelectionText, this.stateProvinceInfo),\n                telemetryContent: this.telemetryContent,\n                onInputChange: this._onAddressAddUpdateInputChange,\n                onDropdownChange: this._onAddressAddUpdateDropdownChange,\n                onSave: this._onAddressAddUpdateSubmit,\n                onCancel: this._resetView\n            }\n        );\n    }\n\n    private _renderListAddress = (): IAddressListProps => {\n        const { config } = this.props;\n\n        return AddressList(\n            {\n                isUpdating: this.isUpdating,\n                selectedAddress: this.selectedAddress,\n                addressFormat: this.addressFormat,\n                addresses: this.customerAddresses,\n                addressPurposes: this.addressPurposes,\n                resources: this.resources,\n                heading: config.heading,\n                primaryAddressSectionHeading: config.primaryAddressSectionHeading,\n                otherAddressSectionHeading: config.otherAddressSectionHeading,\n                contextRequest: this.props.context.request,\n                telemetryContent: this.telemetryContent,\n                onEditAddress: this._goToEditAddress,\n                onRemoveAddress: this._onRemoveAddress,\n                onAddAddress: this._goToAddAddress,\n                onUpdatePrimaryAddress: this._onSubmitUpdatePrimaryAddress\n            }\n        );\n    };\n\n    private onAddressAddUpdate = (name: string, value: string | boolean | number) => {\n        set(this.addUpdateAddress, { [name]: value });\n        this.addressFormat.validateAddressFormat(this.addUpdateAddress, this.validationError, this.countryRegionId, name);\n    }\n\n    private _onAddressAddUpdateInputChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n        if (event.target.type === 'checkbox') {\n            this.onAddressAddUpdate(event.target.name, event.target.checked);\n        } else {\n            const value = (event.target.value || '').replace(new RegExp('[<>]', 'gi'), '');\n            this.onAddressAddUpdate(event.target.name, value);\n        }\n    }\n\n    private _onAddressAddUpdateDropdownChange = (event: React.ChangeEvent<HTMLSelectElement>): void => {\n        if (event.target.name === AddressItemType[AddressItemType.AddressTypeValue]) {\n            this.onAddressAddUpdate(event.target.name, +event.target.value);\n        } else {\n            this.onAddressAddUpdate(event.target.name, event.target.value);\n        }\n        if (event.target.name === AddressItemType[AddressItemType.ThreeLetterISORegionName]) {\n            this._onCountryChange(event.target.value);\n        }\n    }\n\n    private _onAddressUpdate = (response: Promise<IAddressResponse>, onSuccess: (response: IAddressResponse) => void): void => {\n\n        this.isUpdating = true;\n        response.then(\n            (result: IAddressResponse) => {\n                if (result.address) {\n                    this.hasError = false;\n                    onSuccess(result);\n                } else {\n                    this.hasError = true;\n                    this.addressActionResponse = result;\n                }\n                this.isUpdating = false;\n            },\n            () => {\n                this.hasError = true;\n                this.isUpdating = false;\n            }\n        );\n    }\n\n    private _onAddressAddUpdateSubmit = (): void => {\n        if (!this.addressFormat.validateAddressFormat(this.addUpdateAddress, this.validationError, this.countryRegionId)) {\n            return;\n        }\n        let response: Promise<IAddressResponse>;\n        if (this.addressCommon.isAuthenticatedFlow()) {\n            response = this.currentOperation === AddressOperation.Update ? this.addressCommon.updateCustomerAddress(this.addUpdateAddress) : this.addressCommon.addCustomerAddress(this.addUpdateAddress);\n        } else {\n            response = Promise.resolve({ address: this.addUpdateAddress });\n        }\n\n        this._onAddressUpdate(response, this._onAddOrUpdateSuccess);\n    }\n\n    private _onCountryChange = (countryRegionId: string) => {\n        this.countryRegionId = countryRegionId;\n        set(this.addUpdateAddress, { ['ThreeLetterISORegionName']: countryRegionId });\n    }\n\n    private _getAddressFormatExcludeList = (): AddressItemType[] => {\n        const { config } = this.props;\n        const addressFormatExcludeList: AddressItemType[] = [];\n\n        if (!config.showAddressType) {\n            addressFormatExcludeList.push(AddressItemType.AddressTypeValue);\n        }\n\n        addressFormatExcludeList.push(AddressItemType.IsPrimary);\n\n        return addressFormatExcludeList;\n    }\n\n    private _getStateProvinces = (): void => {\n        if (!this.countryRegionId || !(this.currentOperation === AddressOperation.Add || this.currentOperation === AddressOperation.Update)) {\n            return;\n        }\n\n        // tslint:disable-next-line:no-floating-promises\n        this.addressCommon.getStateProvinces(this.countryRegionId).then(\n            (result: StateProvinceInfo[]) => {\n                const stateInfo = result.some(state => state.StateId === this.addUpdateAddress.State);\n                // Reset state if selected state not found in the list.\n                if (!stateInfo) {\n                    set(this.addUpdateAddress, { ['State']: '' });\n                }\n                this.stateProvinceInfo = result;\n            });\n    }\n\n    private _setDefaultCountryRegionId(): void {\n        const { request } = this.props.context;\n        const market = request && request.channel && request.channel.ChannelCountryRegionISOCode;\n\n        this.countryRegionId = this.addressCommon.getDefaultCountryRegionId(this.countryRegionId, this.countryRegions, market);\n    }\n\n    private _updateCurrentOperation = (operation: AddressOperation) => {\n        this.currentOperation = operation;\n    }\n\n    private _onSubmitUpdatePrimaryAddress = (address: Address): void => {\n        this.selectedAddress = address;\n        const response = this.addressCommon.updateCustomerPrimaryAddress(address);\n        this._onAddressUpdate(response, this._onUpdatePrimaryAddressSuccess);\n    }\n\n    private _goToEditAddress = (address: Address): void => {\n        this.addUpdateAddress = { ...address };\n        this.countryRegionId = this.addUpdateAddress.ThreeLetterISORegionName || 'USA';\n        this._updateCurrentOperation(AddressOperation.Update);\n    }\n\n    private _onRemoveAddress = (address: Address): void => {\n        address.Deactivate = true;\n        const response = this.addressCommon.updateCustomerAddress(address);\n        this._onAddressUpdate(response, this._onAddOrUpdateSuccess);\n    }\n\n    private _goToAddAddress = (): void => {\n        this.addUpdateAddress = {};\n        this._setDefaultCountryRegionId();\n        set(this.addUpdateAddress, { ['ThreeLetterISORegionName']: this.countryRegionId });\n        set(this.addUpdateAddress, { ['AddressTypeValue']: this.defaultAddressType });\n        this._setDefaultCountryRegionId();\n        this._updateCurrentOperation(AddressOperation.Add);\n    }\n\n    private _onAddOrUpdateSuccess = (response: IAddressResponse): void => {\n        if (response.customerAddresses) {\n            this.customerAddresses = response.customerAddresses;\n        }\n        this._resetView();\n    }\n\n    private _onUpdatePrimaryAddressSuccess = (response: IAddressResponse): void => {\n        if (response.customerAddresses) {\n            this.customerAddresses = response.customerAddresses;\n        }\n    }\n\n    private _resetView = (): void => {\n        this.selectedAddress = undefined;\n        this._updateCurrentOperation(AddressOperation.List);\n    }\n}\n\nexport default AccountManagementAddress;"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}