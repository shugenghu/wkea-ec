{"ast":null,"code":"import\"core-js/modules/es.array.reduce.js\";import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _isEqual from\"lodash/isEqual\";import React,{Component}from'react';import withSideEffect from'react-side-effect';import{updateHead}from'./html-head-utils';import{ALLOWED_DUPLICATES,BODY_END_LOAD_POINT,BODY_START_LOAD_POINT,COMPONENT_TYPES,DATA_LOAD_POINT,FAVICON_REL,HEAD_ELEMENT_IDENTIFIER_ATTR,HEAD_END_LOAD_POINT,HEAD_START_LOAD_POINT,META_CONTENT_APPEND_ATTR,METATYPES,NON_SCRIPT_TAGS,TAG_NAMES}from'./IHtmlHeadModel';import msdyn365Commerce from'../../msdyn365-commerce';/**\r\n * reduces props of various HtmlHeadInclude instances and deduces a final state value\r\n *\r\n * @function reduceComponents\r\n * @access public\r\n * @param {IHtmlHeadProps[]} props - props list of all the HtmlHeadInclude instances\r\n * @return {HtmlHead} - final list of merged tags\r\n */function reduceComponents(props){const reducedComponents=props.map(component=>{return component.children;}).reduce((a,b)=>{if(b instanceof React.createElement||Array.isArray(b)){return a.concat(React.Children.toArray(b));}return a.concat(b);},[]).reverse().filter(Boolean).filter(unique()).reverse();const mergedComponents=[];reducedComponents.forEach((child,index)=>{const childElement=child;// Append content for conflicting meta tags with same 'name' property\nif(childElement.type===TAG_NAMES.META){for(let i=0;i<mergedComponents.length;++i){if(mergedComponents[i].props.name===childElement.props.name&&(mergedComponents[i].props[META_CONTENT_APPEND_ATTR]||childElement.props[META_CONTENT_APPEND_ATTR])){mergedComponents[i]=/*#__PURE__*/React.cloneElement(mergedComponents[i],{content:\"\".concat(mergedComponents[i].props.content,\", \").concat(childElement.props.content)});return;}}}const className=(childElement.props&&childElement.props.className?\"\".concat(childElement.props.className,\" \"):'')+HEAD_ELEMENT_IDENTIFIER_ATTR;const key=childElement.key||index;mergedComponents.push(/*#__PURE__*/React.cloneElement(childElement,{key,className}));});// Initialize dictionary to map all merged components into their respective slots\nconst componentMap={};// tslint:disable-next-line: prefer-for-of\nfor(let i=0;i<COMPONENT_TYPES.length;i++){componentMap[COMPONENT_TYPES[i]]=[];}let hasFavIcon=false;// Loop through the merged components and map the component to its appropriate slot\nmergedComponents.forEach(comp=>{if(comp.type==='script'){switch(comp.props[DATA_LOAD_POINT]){case HEAD_START_LOAD_POINT:componentMap[HEAD_START_LOAD_POINT].push(comp);break;case HEAD_END_LOAD_POINT:componentMap[HEAD_END_LOAD_POINT].push(comp);break;case BODY_START_LOAD_POINT:componentMap[BODY_START_LOAD_POINT].push(comp);break;default:componentMap[BODY_END_LOAD_POINT].push(comp);}}else if(comp.type!=='script'){if(FAVICON_REL.indexOf(comp.props.rel)!==-1){hasFavIcon=true;}componentMap[NON_SCRIPT_TAGS].push(comp);}});return{tags:mergedComponents,nonScriptTags:componentMap[NON_SCRIPT_TAGS],scriptTags:{headStart:componentMap[HEAD_START_LOAD_POINT],headEnd:componentMap[HEAD_END_LOAD_POINT],bodyStart:componentMap[BODY_START_LOAD_POINT],bodyEnd:componentMap[BODY_END_LOAD_POINT]},hasFavIcon:hasFavIcon};}/*\r\n returns a function for filtering head child elements\r\n which shouldn't be duplicated, like <title/>,\r\n except we explicit allow it in ALLOWED_DUPLICATES array\r\n*/export function unique(){const keys=new Set();const tags=new Set();const metaTypes=new Set();const metaCategories={};return tagComponent=>{const tagElement=tagComponent;if(tagElement instanceof React.createElement&&tagElement.key){if(keys.has(tagElement.key)){return false;}keys.add(tagElement.key);}switch(tagElement.type){case TAG_NAMES.TITLE:case TAG_NAMES.BASE:if(tags.has(tagElement.type)){return false;}tags.add(tagElement.type);break;case TAG_NAMES.META:// tslint:disable-next-line: prefer-for-of\nfor(let i=0;i<METATYPES.length;i++){const metaType=METATYPES[i];if(tagElement.props[metaType]){if(metaType==='charSet'){if(metaTypes.has(metaType)){return false;}metaTypes.add(metaType);}else{const category=tagElement.props[metaType];const categories=metaCategories[metaType]||new Set();if(categories.has(category)&&!ALLOWED_DUPLICATES.has(category)){return false;}categories.add(category);metaCategories[metaType]=categories;}}}break;case TAG_NAMES.LINK:tags.add(tagElement.type);break;default:}return true;};}/**\r\n * maps state on server\r\n * @function mapOnServer\r\n * @param {HtmlHead} head - final list of merged tags\r\n * @return {HtmlHead} - final list of merged tags\r\n */function mapOnServer(head){return head;}/**\r\n * state change handler\r\n * @function onStateChange\r\n * @param {HtmlHead} head - final list of merged tags\r\n */function onStateChange(head){updateHead(head);}/**\r\n * <HtmlHeadInclude>\r\n *     <title></title>\r\n *     <meta name='description' content='Home page'>\r\n *     <meta property='og:type, content='article>\r\n *     <script src='http://include.com/pathtojs.js  type='text/javascript' />\r\n * </HtmlHeadInclude>\r\n *\r\n * HigherOrder Component to wrap HtmlHeadInclude instance and pass it to another higher order component withSideEffect\r\n * that tracks changes on various instances of HtmlHeadInclude and arrives at a final merged list of props that can be\r\n * used to update head tags\r\n */ // tslint:disable-next-line:no-any\nconst withHtmlHeadInclude=WrappedComponent=>{var _a;return _a=class WrapperComponent extends Component{static set canUseDOM(canUseDOM){WrappedComponent.canUseDOM=canUseDOM;}shouldComponentUpdate(nextProps){return!_isEqual(this.props,nextProps);}render(){if(msdyn365Commerce.isBrowser){return/*#__PURE__*/React.createElement(React.Fragment,null);}return/*#__PURE__*/React.createElement(WrappedComponent,Object.assign({},this.props));}},_a.peek=()=>{return WrappedComponent.peek();},_a.rewind=()=>{let mappedState=WrappedComponent.rewind();if(!mappedState){// provide fallback if mappedState is undefined\nmappedState=mapOnServer({tags:[],nonScriptTags:[],scriptTags:{headStart:[],headEnd:[],bodyStart:[],bodyEnd:[]},hasFavIcon:false});}return mappedState;},_a;};const htmlHeadIncludeWithSideEffect=withSideEffect(reduceComponents,onStateChange,mapOnServer);export const HtmlHeadInclude=withHtmlHeadInclude(htmlHeadIncludeWithSideEffect(()=>null));","map":{"version":3,"sources":["../../../../src/components/head-injector/html-head-include.tsx"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport { isEqual } from 'lodash';\nimport React, { Component } from 'react';\nimport withSideEffect from 'react-side-effect';\nimport { IDictionary, IGeneric } from '../../interfaces';\nimport { updateHead } from './html-head-utils';\nimport {\n    ALLOWED_DUPLICATES,\n    BODY_END_LOAD_POINT,\n    BODY_START_LOAD_POINT,\n    COMPONENT_TYPES,\n    DATA_LOAD_POINT,\n    FAVICON_REL,\n    HEAD_ELEMENT_IDENTIFIER_ATTR,\n    HEAD_END_LOAD_POINT,\n    HEAD_START_LOAD_POINT,\n    HtmlHeadElement,\n    IHtmlHead,\n    IHtmlHeadProps,\n    META_CONTENT_APPEND_ATTR,\n    METATYPES,\n    NON_SCRIPT_TAGS,\n    TAG_NAMES\n} from './IHtmlHeadModel';\n\nimport msdyn365Commerce from '../../msdyn365-commerce';\n\n/**\n * reduces props of various HtmlHeadInclude instances and deduces a final state value\n *\n * @function reduceComponents\n * @access public\n * @param {IHtmlHeadProps[]} props - props list of all the HtmlHeadInclude instances\n * @return {HtmlHead} - final list of merged tags\n */\nfunction reduceComponents(props: IHtmlHeadProps[]): IHtmlHead {\n    const reducedComponents = props\n        .map((component: IHtmlHeadProps) => {\n            return component.children;\n        })\n        .reduce((a: React.ReactChild[], b: React.ReactChild[]) => {\n            if (b instanceof React.createElement || Array.isArray(b)) {\n                return a.concat(React.Children.toArray(b));\n            }\n\n            return a.concat(b);\n        },      [])\n        .reverse()\n        .filter(Boolean)\n        .filter(unique())\n        .reverse();\n\n    const mergedComponents: HtmlHeadElement[] = [];\n    reducedComponents.forEach((child: React.ReactChild, index: number): void => {\n        const childElement = child as HtmlHeadElement;\n\n        // Append content for conflicting meta tags with same 'name' property\n        if (childElement.type === TAG_NAMES.META) {\n            for (let i = 0; i < mergedComponents.length; ++i) {\n                if (\n                    mergedComponents[i].props.name === childElement.props.name &&\n                    (mergedComponents[i].props[META_CONTENT_APPEND_ATTR] || childElement.props[META_CONTENT_APPEND_ATTR])\n                ) {\n                    mergedComponents[i] = React.cloneElement(mergedComponents[i], {\n                        content: `${mergedComponents[i].props.content}, ${childElement.props.content}`\n                    });\n\n                    return;\n                }\n            }\n        }\n\n        const className =\n            (childElement.props && childElement.props.className ? `${childElement.props.className} ` : '') + HEAD_ELEMENT_IDENTIFIER_ATTR;\n        const key = childElement.key || index;\n\n        mergedComponents.push(React.cloneElement(childElement, { key, className }));\n    });\n    // Initialize dictionary to map all merged components into their respective slots\n    const componentMap: IDictionary<HtmlHeadElement[]> = {};\n    // tslint:disable-next-line: prefer-for-of\n    for (let i = 0; i < COMPONENT_TYPES.length; i++) {\n        componentMap[COMPONENT_TYPES[i]] = [];\n    }\n    let hasFavIcon: boolean = false;\n    // Loop through the merged components and map the component to its appropriate slot\n    mergedComponents.forEach((comp: HtmlHeadElement) => {\n        if (comp.type === 'script') {\n            switch (comp.props[DATA_LOAD_POINT]) {\n                case HEAD_START_LOAD_POINT:\n                    componentMap[HEAD_START_LOAD_POINT].push(comp);\n                    break;\n                case HEAD_END_LOAD_POINT:\n                    componentMap[HEAD_END_LOAD_POINT].push(comp);\n                    break;\n                case BODY_START_LOAD_POINT:\n                    componentMap[BODY_START_LOAD_POINT].push(comp);\n                    break;\n                default:\n                    componentMap[BODY_END_LOAD_POINT].push(comp);\n            }\n        } else if (comp.type !== 'script') {\n            if (FAVICON_REL.indexOf(comp.props.rel) !== -1) {\n                hasFavIcon = true;\n            }\n            componentMap[NON_SCRIPT_TAGS].push(comp);\n        }\n    });\n\n    return {\n        tags: mergedComponents,\n        nonScriptTags: componentMap[NON_SCRIPT_TAGS],\n        scriptTags: {\n            headStart: componentMap[HEAD_START_LOAD_POINT],\n            headEnd: componentMap[HEAD_END_LOAD_POINT],\n            bodyStart: componentMap[BODY_START_LOAD_POINT],\n            bodyEnd: componentMap[BODY_END_LOAD_POINT]\n        },\n        hasFavIcon: hasFavIcon\n    };\n}\n\n/*\n returns a function for filtering head child elements\n which shouldn't be duplicated, like <title/>,\n except we explicit allow it in ALLOWED_DUPLICATES array\n*/\nexport function unique(): (h: React.ReactChild) => boolean {\n    const keys = new Set();\n    const tags = new Set();\n    const metaTypes = new Set();\n    const metaCategories: IGeneric<unknown> = {};\n\n    return (tagComponent: React.ReactChild) => {\n        const tagElement = tagComponent as HtmlHeadElement;\n\n        if (tagElement instanceof React.createElement && tagElement.key) {\n            if (keys.has(tagElement.key)) {\n                return false;\n            }\n\n            keys.add(tagElement.key);\n        }\n\n        switch (tagElement.type) {\n            case TAG_NAMES.TITLE:\n            case TAG_NAMES.BASE:\n                if (tags.has(tagElement.type)) {\n                    return false;\n                }\n\n                tags.add(tagElement.type);\n                break;\n            case TAG_NAMES.META:\n                // tslint:disable-next-line: prefer-for-of\n                for (let i = 0; i < METATYPES.length; i++) {\n                    const metaType = METATYPES[i];\n                    if (tagElement.props[metaType]) {\n                        if (metaType === 'charSet') {\n                            if (metaTypes.has(metaType)) {\n                                return false;\n                            }\n\n                            metaTypes.add(metaType);\n                        } else {\n                            const category = tagElement.props[metaType];\n                            const categories = metaCategories[metaType] || new Set();\n                            if (categories.has(category) && !ALLOWED_DUPLICATES.has(category)) {\n                                return false;\n                            }\n\n                            categories.add(category);\n                            metaCategories[metaType] = categories;\n                        }\n                    }\n                }\n\n                break;\n            case TAG_NAMES.LINK:\n                tags.add(tagElement.type);\n                break;\n            default:\n        }\n\n        return true;\n    };\n}\n\n/**\n * maps state on server\n * @function mapOnServer\n * @param {HtmlHead} head - final list of merged tags\n * @return {HtmlHead} - final list of merged tags\n */\nfunction mapOnServer(head: IHtmlHead): IHtmlHead {\n    return head;\n}\n\n/**\n * state change handler\n * @function onStateChange\n * @param {HtmlHead} head - final list of merged tags\n */\nfunction onStateChange(head: IHtmlHead): void {\n    updateHead(head);\n}\n\n/**\n * <HtmlHeadInclude>\n *     <title></title>\n *     <meta name='description' content='Home page'>\n *     <meta property='og:type, content='article>\n *     <script src='http://include.com/pathtojs.js  type='text/javascript' />\n * </HtmlHeadInclude>\n *\n * HigherOrder Component to wrap HtmlHeadInclude instance and pass it to another higher order component withSideEffect\n * that tracks changes on various instances of HtmlHeadInclude and arrives at a final merged list of props that can be\n * used to update head tags\n */\n// tslint:disable-next-line:no-any\nconst withHtmlHeadInclude = (WrappedComponent: any) =>\n    class WrapperComponent extends Component {\n        static set canUseDOM(canUseDOM: boolean) {\n            WrappedComponent.canUseDOM = canUseDOM;\n        }\n\n        public static peek = () => {\n            return WrappedComponent.peek();\n        };\n\n        public static rewind = () => {\n            let mappedState = WrappedComponent.rewind();\n            if (!mappedState) {\n                // provide fallback if mappedState is undefined\n                mappedState = mapOnServer({\n                    tags: [],\n                    nonScriptTags: [],\n                    scriptTags: {\n                        headStart: [],\n                        headEnd: [],\n                        bodyStart: [],\n                        bodyEnd: []\n                    },\n                    hasFavIcon: false\n                });\n            }\n\n            return mappedState;\n        };\n\n        public shouldComponentUpdate(nextProps: IGeneric<unknown>): boolean {\n            return !isEqual(this.props, nextProps);\n        }\n\n        public render(): JSX.Element | null {\n            if (msdyn365Commerce.isBrowser) {\n                return <React.Fragment />;\n            }\n\n            return <WrappedComponent {...this.props} />;\n        }\n    };\n\nconst htmlHeadIncludeWithSideEffect = withSideEffect(reduceComponents, onStateChange, mapOnServer);\nexport const HtmlHeadInclude = withHtmlHeadInclude(htmlHeadIncludeWithSideEffect(() => null));\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}