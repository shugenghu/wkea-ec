{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/es.regexp.constructor.js\";import\"core-js/modules/es.regexp.to-string.js\";import\"core-js/modules/es.string.replace.js\";import\"core-js/modules/es.string.split.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import*as React from'react';import{getRichTextHtml}from'@msdyn365-commerce/core';import{format,getPayloadObject,getTelemetryAttributes}from'@msdyn365-commerce-modules/utilities';let payLoad;export const CategorySuggestionsComponent=props=>{const{suggestions,searchText,autoSuggestProps:{resources:{categorySuggestionHeading}}}=props;if(!suggestions){return undefined;}const reactNodes=[];payLoad=getPayloadObject('click',props.telemetryContent,'');suggestions.map(item=>{reactNodes.push(_assembleNode(item,props));});const titleNode=_renderTitle(categorySuggestionHeading,searchText);return{title:titleNode,text:reactNodes};};const _renderTitle=(categorySuggestionHeading,searchText)=>{const categoryAutoSuggestionHeading=categorySuggestionHeading?format(categorySuggestionHeading,searchText):\"Search \\\"\".concat(searchText,\"\\\" in categories\");return/*#__PURE__*/React.createElement(\"li\",{className:'msc-autoSuggest__categoryResults-title'},categoryAutoSuggestionHeading);};const _assembleNode=(item,props)=>{const{searchText,hitPrefix,hitSuffix}=props;const splitValue=item.Value&&item.Value.split('|').pop();const ariaLabel=splitValue?splitValue.replace(new RegExp(\"[\".concat(hitPrefix,\"]\"),'gi'),'').replace(new RegExp(\"[\".concat(hitSuffix,\"]\"),'gi'),''):item.Value&&item.Value.replace(new RegExp(\"[\".concat(hitPrefix,\"]\"),'gi'),'').replace(new RegExp(\"[\".concat(hitSuffix,\"]\"),'gi'),'');payLoad.contentAction.etext=item.Value;const attribute=getTelemetryAttributes(props.telemetryContent,payLoad);return/*#__PURE__*/React.createElement(\"li\",{className:'msc-autoSuggest__categoryResults-item',key:item.Id},/*#__PURE__*/React.createElement(\"a\",Object.assign({\"aria-label\":ariaLabel,href:_generateLink(item,searchText,props)},attribute),_generateLink(item,searchText,props)&&_getHighlightedText(item.Value?item.Value:'',hitPrefix,hitSuffix)));};const _generateLink=(suggestion,searchText,props)=>{return suggestion&&suggestion.Id?_getCategoryLink(suggestion.Id,searchText,props):'';};const _getCategoryLink=(id,searchText,props)=>{const{searchPageURL,searchQsp,searchRefiners}=props;const route=searchPageURL||'';const urlPath=\"\".concat(route).concat(route.indexOf('?')===-1?'?':'&').concat(searchQsp,\"=\").concat(searchText);const categoryRefiners=searchRefiners&&searchRefiners.find(refiners=>{return refiners.KeyName==='Category';});const refiner=categoryRefiners&&categoryRefiners.Values&&categoryRefiners.Values.find(item=>{return item.RefinerRecordId===parseInt(id,10);});const encodedRefiner=refiner&&encodeURIComponent(JSON.stringify(compressRefiners([refiner])));return encodedRefiner?\"\".concat(urlPath,\"&refiners=\").concat(encodedRefiner):urlPath;};const _getHighlightedText=(suggestion,hitPrefix,hitSuffix)=>{let formattedText=suggestion.replace(new RegExp(\"[\".concat(hitPrefix,\"]\"),'gi'),'<strong>').replace(new RegExp(\"[\".concat(hitSuffix,\"]\"),'gi'),'</strong>');formattedText=formattedText.split('|').pop()||'';return/*#__PURE__*/React.createElement(\"span\",{dangerouslySetInnerHTML:getRichTextHtml(formattedText)});};const compressedRefinerKeys=['DataTypeValue','LeftValueBoundString','RefinerRecordId','RefinerSourceValue','RightValueBoundString','UnitText'];const compressRefiners=refiners=>{const compressedRefiners=[];refiners.forEach(refiner=>{const compressedRefiner=[];compressedRefinerKeys.forEach(refinerKey=>{compressedRefiner.push(refiner[refinerKey]);});compressedRefiners.push(compressedRefiner);});return compressedRefiners;};","map":{"version":3,"sources":["modules/search/components/search.categorysuggest.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as React from 'react';\n\nimport { getRichTextHtml } from '@msdyn365-commerce/core';\nimport { ProductRefiner, ProductRefinerValue, SearchSuggestion } from '@msdyn365-commerce/retail-proxy';\n\nimport { format, getPayloadObject, getTelemetryAttributes, IPayLoad, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport { ISearchData } from '../search.data';\nimport { ISearchProps } from '../search.props.autogenerated';\n\nexport interface ISearchCategorySuggestProps {\n    searchCategorySuggestClass: string;\n    searchPageURL: string;\n    searchQsp: string | undefined;\n    hitPrefix: string;\n    hitSuffix: string;\n    autoSuggestProps: ISearchProps<ISearchData>;\n    searchText: string;\n    searchRefiners: ProductRefiner[] | undefined;\n    suggestions: SearchSuggestion[] | undefined;\n    telemetryContent?: ITelemetryContent;\n}\n\nexport interface ISearchCategoryViewProps {\n    title: React.ReactNode;\n    text: React.ReactNode[];\n}\n\nlet payLoad: IPayLoad;\n\n/**\n *\n * CategorySuggestionsComponent\n */\nexport const CategorySuggestionsComponent = (props: ISearchCategorySuggestProps): ISearchCategoryViewProps | undefined => {\n    const {\n        suggestions,\n        searchText,\n        autoSuggestProps: {\n            resources: { categorySuggestionHeading }\n        }\n    } = props;\n\n    if (!suggestions) {\n        return undefined;\n    }\n\n    const reactNodes: React.ReactNode[] = [];\n    payLoad = getPayloadObject('click', props.telemetryContent!, '');\n\n    suggestions.map(item => {\n        reactNodes.push(_assembleNode(item, props));\n    });\n\n    const titleNode = _renderTitle(categorySuggestionHeading, searchText);\n\n    return { title: titleNode, text: reactNodes };\n};\n\nconst _renderTitle = (categorySuggestionHeading: string, searchText: string) => {\n    const categoryAutoSuggestionHeading = categorySuggestionHeading\n        ? format(categorySuggestionHeading, searchText)\n        : `Search \"${searchText}\" in categories`;\n\n    return <li className='msc-autoSuggest__categoryResults-title'>{categoryAutoSuggestionHeading}</li>;\n};\n\nconst _assembleNode = (item: SearchSuggestion, props: ISearchCategorySuggestProps) => {\n    const { searchText, hitPrefix, hitSuffix } = props;\n\n    const splitValue = item.Value && item.Value.split('|').pop();\n    const ariaLabel = splitValue\n        ? splitValue.replace(new RegExp(`[${hitPrefix}]`, 'gi'), '').replace(new RegExp(`[${hitSuffix}]`, 'gi'), '')\n        : item.Value && item.Value.replace(new RegExp(`[${hitPrefix}]`, 'gi'), '').replace(new RegExp(`[${hitSuffix}]`, 'gi'), '');\n    payLoad.contentAction.etext = item.Value;\n    const attribute = getTelemetryAttributes(props.telemetryContent!, payLoad);\n    return (\n        <li className='msc-autoSuggest__categoryResults-item' key={item.Id}>\n            <a aria-label={ariaLabel} href={_generateLink(item, searchText, props)} {...attribute}>\n                {_generateLink(item, searchText, props) && _getHighlightedText(item.Value ? item.Value : '', hitPrefix, hitSuffix)}\n            </a>\n        </li>\n    );\n};\n\nconst _generateLink = (suggestion: SearchSuggestion, searchText: string, props: ISearchCategorySuggestProps): string => {\n    return suggestion && suggestion.Id ? _getCategoryLink(suggestion.Id, searchText, props) : '';\n};\n\nconst _getCategoryLink = (id: string, searchText: string, props: ISearchCategorySuggestProps): string => {\n    const { searchPageURL, searchQsp, searchRefiners } = props;\n\n    const route = searchPageURL || '';\n    const urlPath = `${route}${route.indexOf('?') === -1 ? '?' : '&'}${searchQsp}=${searchText}`;\n    const categoryRefiners =\n        searchRefiners &&\n        searchRefiners.find(refiners => {\n            return refiners.KeyName === 'Category';\n        });\n    const refiner =\n        categoryRefiners &&\n        categoryRefiners.Values &&\n        categoryRefiners.Values.find(item => {\n            return item.RefinerRecordId === parseInt(id, 10);\n        });\n\n    const encodedRefiner = refiner && encodeURIComponent(JSON.stringify(compressRefiners([refiner])));\n\n    return encodedRefiner ? `${urlPath}&refiners=${encodedRefiner}` : urlPath;\n};\n\nconst _getHighlightedText = (suggestion: string, hitPrefix: string, hitSuffix: string): JSX.Element => {\n    let formattedText = suggestion\n        .replace(new RegExp(`[${hitPrefix}]`, 'gi'), '<strong>')\n        .replace(new RegExp(`[${hitSuffix}]`, 'gi'), '</strong>');\n    formattedText = formattedText.split('|').pop() || '';\n\n    // tslint:disable:react-no-dangerous-html\n    return <span dangerouslySetInnerHTML={getRichTextHtml(formattedText)} />;\n};\n\n// TODO: This code is currently duplicated in categoryautosuggest need to either remove one of these files\n// or move this code to a common place\nconst compressedRefinerKeys = ['DataTypeValue', 'LeftValueBoundString', 'RefinerRecordId', 'RefinerSourceValue', 'RightValueBoundString', 'UnitText'];\n\n/**\n * Compressed a list of refiners for use in URLs\n * @param refiners The uncompressed refiners\n */\nconst compressRefiners = (refiners: ProductRefinerValue[]) => {\n    const compressedRefiners: (string | number)[][] = [];\n\n    refiners.forEach((refiner) => {\n        const compressedRefiner: (string | number)[] = [];\n        compressedRefinerKeys.forEach((refinerKey) => {\n            // @ts-ignore: This line is intentionally not typesafe\n            compressedRefiner.push(refiner[refinerKey]);\n        });\n        compressedRefiners.push(compressedRefiner);\n    });\n\n    return compressedRefiners;\n};\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}