{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{createObservableDataAction}from'@msdyn365-commerce/core';import getCurrentCategory,{CurrentCategoryInput}from'./get-current-category';import{getRefinersByCategoryAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import{QueryResultSettingsProxy}from'./utilities/QueryResultSettingsProxy';/**\r\n * Action Input class for the getRefinersByCategory data action\r\n */export var RefinersByCategoryInput=function RefinersByCategoryInput(category,queryResultSettingsProxy,catalogId){var _this=this;_classCallCheck(this,RefinersByCategoryInput);this.getCacheKey=function(){return\"\".concat(_this.currentCategory.getCacheKey(),\"|\").concat(_this.catalogId,\"|\").concat(_this.queryResultSettingsProxy.cacheKeyHint);};this.getCacheObjectType=function(){return'ProductRefiner';};this.shouldCacheOutput=function(){return true;};this.queryResultSettingsProxy=queryResultSettingsProxy;this.catalogId=catalogId||0;this.currentCategory=category;};/**\r\n * Creates the input required to make the retail api call\r\n */export var createRefinersByCategoryInput=function createRefinersByCategoryInput(inputData){if(inputData&&inputData.requestContext){var catalogId=inputData.config?Number(inputData.config.catalogId):0;var currentCategory=new CurrentCategoryInput(inputData.requestContext);return new RefinersByCategoryInput(currentCategory,QueryResultSettingsProxy.fromInputData(inputData),Number.isNaN(catalogId)?0:catalogId);}throw new Error('Please specify categoryId query string in request.');};/**\r\n * Calls the Retail API and returns all refiners by category\r\n */export function getRefinersByCategoryAction(_x,_x2){return _getRefinersByCategoryAction.apply(this,arguments);}function _getRefinersByCategoryAction(){_getRefinersByCategoryAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var categoryId,category;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:categoryId=input.currentCategory.categoryId;if(!(input.currentCategory.categorySlug&&!categoryId)){_context.next=9;break;}_context.next=4;return getCurrentCategory(input.currentCategory,ctx);case 4:category=_context.sent;if(category){_context.next=8;break;}ctx.trace('[getRefinersByCategoryAction] Unable to find category');return _context.abrupt(\"return\",[]);case 8:categoryId=category.RecordId;case 9:return _context.abrupt(\"return\",getRefinersByCategoryAsync({callerContext:ctx,queryResultSettings:input.queryResultSettingsProxy.QueryResultSettings},input.catalogId,categoryId||0));case 10:case\"end\":return _context.stop();}}},_callee);}));return _getRefinersByCategoryAction.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/get-refiners-by-category',action:getRefinersByCategoryAction,input:createRefinersByCategoryInput});","map":{"version":3,"sources":["../../src/get-refiners-by-category.ts"],"names":[],"mappings":"8MACA,OAAS,0BAAT,KAAiG,yBAAjG,CAEA,MAAO,CAAA,kBAAP,EAA6B,oBAA7B,KAAyD,wBAAzD,CAEA,OAAS,0BAAT,KAA2C,wEAA3C,CACA,OAAS,wBAAT,KAAyC,sCAAzC,CAEA;;AAEG,GACH,UAAa,CAAA,uBAAb,CAII,iCAAY,QAAZ,CAA4C,wBAA5C,CAAgG,SAAhG,CAAkH,8DAM3G,KAAA,WAAA,CAAc,2BAAS,KAAI,CAAC,eAAL,CAAqB,WAArB,EAAT,aAA+C,KAAI,CAAC,SAApD,aAAiE,KAAI,CAAC,wBAAL,CAA8B,YAA/F,GAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,gBAAN,EAArB,CACA,KAAA,iBAAA,CAAoB,iBAAM,KAAN,EAApB,CAPH,KAAK,wBAAL,CAAgC,wBAAhC,CACA,KAAK,SAAL,CAAiB,SAAS,EAAI,CAA9B,CACA,KAAK,eAAL,CAAuB,QAAvB,CACH,CARL,CAeA;;AAEG,GACH,MAAO,IAAM,CAAA,6BAA6B,CAAG,QAAhC,CAAA,6BAAgC,CAAC,SAAD,CAAkE,CAC3G,GAAI,SAAS,EAAI,SAAS,CAAC,cAA3B,CAA2C,CACvC,GAAM,CAAA,SAAS,CAAG,SAAS,CAAC,MAAV,CAAmB,MAAM,CAAC,SAAS,CAAC,MAAV,CAAiB,SAAlB,CAAzB,CAAwD,CAA1E,CACA,GAAM,CAAA,eAAe,CAAG,GAAI,CAAA,oBAAJ,CAAyB,SAAS,CAAC,cAAnC,CAAxB,CAEA,MAAO,IAAI,CAAA,uBAAJ,CACH,eADG,CAEH,wBAAwB,CAAC,aAAzB,CAAuC,SAAvC,CAFG,CAGH,MAAM,CAAC,KAAP,CAAa,SAAb,EAA0B,CAA1B,CAA8B,SAH3B,CAAP,CAKH,CAED,KAAM,IAAI,CAAA,KAAJ,CAAU,oDAAV,CAAN,CACH,CAbM,CAeP;;AAEG,GACH,eAAsB,CAAA,2BAAtB,oE,6HAAO,iBAA2C,KAA3C,CAA2E,GAA3E,0IACC,UADD,CACc,KAAK,CAAC,eAAN,CAAsB,UADpC,MAEC,KAAK,CAAC,eAAN,CAAsB,YAAtB,EAAsC,CAAC,UAFxC,gDAGwB,CAAA,kBAAkB,CAAC,KAAK,CAAC,eAAP,CAAwB,GAAxB,CAH1C,QAGO,QAHP,kBAIM,QAJN,yBAKK,GAAG,CAAC,KAAJ,CAAU,uDAAV,EALL,gCAM8B,EAN9B,SAQC,UAAU,CAAG,QAAQ,CAAC,QAAtB,CARD,uCAWI,0BAA0B,CAC7B,CAAE,aAAa,CAAE,GAAjB,CAAsB,mBAAmB,CAAE,KAAK,CAAC,wBAAN,CAA+B,mBAA1E,CAD6B,CAE7B,KAAK,CAAC,SAFuB,CAG7B,UAAU,EAAI,CAHe,CAX9B,yD,8DAkBP,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,oEADkC,CAEtC,MAAM,CAA6B,2BAFG,CAGtC,KAAK,CAAE,6BAH+B,CAAD,CAAzC","sourcesContent":["import { IAction, IActionInput } from '@msdyn365-commerce/core';\nimport { createObservableDataAction, IActionContext, IAny, ICreateActionContext, IGeneric } from '@msdyn365-commerce/core';\nimport { ProductRefiner } from '@msdyn365-commerce/retail-proxy';\nimport getCurrentCategory, { CurrentCategoryInput } from './get-current-category';\n\nimport { getRefinersByCategoryAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { QueryResultSettingsProxy } from './utilities/QueryResultSettingsProxy';\n\n/**\n * Action Input class for the getRefinersByCategory data action\n */\nexport class RefinersByCategoryInput implements IActionInput {\n    public readonly catalogId: number;\n    public readonly currentCategory: CurrentCategoryInput;\n    public readonly queryResultSettingsProxy: QueryResultSettingsProxy;\n    constructor(category: CurrentCategoryInput, queryResultSettingsProxy: QueryResultSettingsProxy, catalogId?: number) {\n        this.queryResultSettingsProxy = queryResultSettingsProxy;\n        this.catalogId = catalogId || 0;\n        this.currentCategory = category;\n    }\n\n    public getCacheKey = () => `${this.currentCategory.getCacheKey()}|${this.catalogId}|${this.queryResultSettingsProxy.cacheKeyHint}`;\n    public getCacheObjectType = () => 'ProductRefiner';\n    public shouldCacheOutput = () => true;\n}\n\n/**\n * Creates the input required to make the retail api call\n */\nexport const createRefinersByCategoryInput = (inputData: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    if (inputData && inputData.requestContext) {\n        const catalogId = inputData.config ? Number(inputData.config.catalogId) : 0;\n        const currentCategory = new CurrentCategoryInput(inputData.requestContext);\n\n        return new RefinersByCategoryInput(\n            currentCategory,\n            QueryResultSettingsProxy.fromInputData(inputData),\n            Number.isNaN(catalogId) ? 0 : catalogId\n        );\n    }\n\n    throw new Error('Please specify categoryId query string in request.');\n};\n\n/**\n * Calls the Retail API and returns all refiners by category\n */\nexport async function getRefinersByCategoryAction(input: RefinersByCategoryInput, ctx: IActionContext): Promise<ProductRefiner[]> {\n    let categoryId = input.currentCategory.categoryId;\n    if (input.currentCategory.categorySlug && !categoryId) {\n        const category = await getCurrentCategory(input.currentCategory, ctx);\n        if (!category) {\n            ctx.trace('[getRefinersByCategoryAction] Unable to find category');\n            return <ProductRefiner[]>[];\n        }\n        categoryId = category.RecordId;\n    }\n\n    return getRefinersByCategoryAsync(\n        { callerContext: ctx, queryResultSettings: input.queryResultSettingsProxy.QueryResultSettings },\n        input.catalogId,\n        categoryId || 0\n    );\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-refiners-by-category',\n    action: <IAction<ProductRefiner[]>>getRefinersByCategoryAction,\n    input: createRefinersByCategoryInput\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}