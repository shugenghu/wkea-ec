{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import{Button,getPayloadObject,getTelemetryAttributes,getTelemetryObject,Modal,ModalBody,ModalHeader,onTelemetryClick,Popover,TelemetryConstant}from'@msdyn365-commerce-modules/utilities';import{CartIconComponent,WishListIconComponent}from'@msdyn365-commerce/components';import*as MsDyn365 from'@msdyn365-commerce/core';import classnames from'classnames';import{computed}from'mobx';import*as React from'react';import{Logo,NavIcon}from'./components';var Header=/*#__PURE__*/function(_React$PureComponent){_inherits(Header,_React$PureComponent);var _super=_createSuper(Header);function Header(props){var _this;_classCallCheck(this,Header);_this=_super.call(this,props);_this.handleLinkTextChange=function(linkIndex){return function(event){if(_this.props.config.myAccountLinks&&_this.props.config.myAccountLinks[linkIndex]){_this.props.config.myAccountLinks[linkIndex].linkText=event.target.value;}};};_this.popOverRef=/*#__PURE__*/React.createRef();_this._toggleNavbar=_this._toggleNavbar.bind(_assertThisInitialized(_this));_this._togglePopover=_this._togglePopover.bind(_assertThisInitialized(_this));_this._keydown=_this._keydown.bind(_assertThisInitialized(_this));_this.state={mobileMenuCollapsed:true,signinPopoverOpen:false};_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);return _this;}_createClass(Header,[{key:\"componentDidMount\",value:function componentDidMount(){if(MsDyn365.msdyn365Commerce.isBrowser){window.addEventListener('keydown',this._keydown);}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(MsDyn365.msdyn365Commerce.isBrowser){window.removeEventListener('keydown',this._keydown,false);}}},{key:\"render\",value:function render(){var _this$props=this.props,id=_this$props.id,typeName=_this$props.typeName,_this$props$data=_this$props.data,accountInformation=_this$props$data.accountInformation,cart=_this$props$data.cart.result,user=_this$props.context.request.user,context=_this$props.context,cartLabel=_this$props.resources.cartLabel;var _this$props$config=this.props.config,logoLink=_this$props$config.logoLink,logoImage=_this$props$config.logoImage;var headerClassName=classnames('ms-header',this.props.config.className);var navbarKey='header-nav-mobile';var customer=accountInformation&&accountInformation.result;var cartIconSlot=this._getSlot('cartIcon');var menuBarSlot=this._getSlot('menuBar');var searchSlot=this._getSlot('search');var siteOptionsSlot=this._getSlot('siteOptions');var viewProps=_objectSpread(_objectSpread(_objectSpread({},this.props),this.state),{},{logo:/*#__PURE__*/React.createElement(Logo,Object.assign({},{link:logoLink,image:logoImage,className:'ms-header__logo',gridSettings:this.props.context.request.gridSettings,requestContext:this.props.context.request,telemetryContent:this.telemetryContent})),wishListIconDesktop:/*#__PURE__*/React.createElement(WishListIconComponent,{className:'ms-header__wishlist-desktop',showButtonTooltip:true,wishlistTooltipText:this.props.resources.wishlistTooltipText,context:context,id:id,typeName:typeName,telemetryContent:this.telemetryContent,data:{}}),wishListIconMobile:/*#__PURE__*/React.createElement(WishListIconComponent,{className:'ms-header__wishlist-mobile',showButtonTooltip:true,wishlistTooltipText:this.props.resources.wishlistTooltipText,context:context,id:id,typeName:typeName,telemetryContent:this.telemetryContent,data:{}}),cartIcon:cartIconSlot&&cartIconSlot.length>0?cartIconSlot[0]:cart&&/*#__PURE__*/React.createElement(CartIconComponent,{cartLabel:cartLabel,context:context,id:id,typeName:typeName,telemetryContent:this.telemetryContent,data:{cart:cart}}),navIcon:/*#__PURE__*/React.createElement(NavIcon,Object.assign({},{resources:this.props.resources,isExpanded:!this.state.mobileMenuCollapsed,targetId:navbarKey,toggleNavBar:this._toggleNavbar,telemetryContent:this.telemetryContent})),menuBar:menuBarSlot&&menuBarSlot.length&&menuBarSlot||[],search:searchSlot&&searchSlot.length&&searchSlot||[],siteOptions:siteOptionsSlot&&siteOptionsSlot.length&&siteOptionsSlot||[],className:headerClassName,HeaderTag:{moduleProps:this.props,className:classnames(headerClassName),tag:'header'},HeaderContainer:{className:classnames('ms-header__container')},HeaderTopBarContainer:{className:classnames('ms-header__topbar')},Divider:{className:classnames('ms-header__divider')},MobileMenuContainer:{tag:Modal,id:navbarKey,className:'ms-header__mobile-hamburger',isOpen:!this.state.mobileMenuCollapsed,wrapClassName:'ms-header__modal'},MobileMenuHeader:/*#__PURE__*/React.createElement(ModalHeader,{className:'ms-header__mobile-hamburger-menu-header',toggle:this._toggleNavbar}),MobileMenuBodyContainer:{tag:ModalBody,className:'ms-header__mobile-hamburger-menu-body'},MobileMenuLinksContainer:{className:'ms-header__mobile-hamburger-menu-links'},AccountInfoDropdownParentContainer:{className:'ms-header__account-info'},AccountInfoDropdownPopoverConentContainer:customer&&this.displayName&&{tag:Popover,id:'myprofilePopover',className:'ms-header__account-info-content',placement:'bottom',isOpen:this.state.signinPopoverOpen,target:this.popOverRef,toggle:this._togglePopover}||undefined,signInLink:this._getSigninButton(customer,user,this.props.resources),signOutLink:this._getSignOutButton(customer,user,this.props.resources),accountInfoDropdownButton:this._getAccountInfoDropdownButton(customer),accountLinks:this._getAccountLinks(customer)});return this.props.renderView(viewProps);}},{key:\"_getSlot\",value:function _getSlot(slotName){var slots=this.props.slots;return slots&&slots[slotName]&&slots[slotName].length&&slots[slotName]||null;}},{key:\"_getSigninButton\",value:function _getSigninButton(customer,user,resources){var payLoad=getPayloadObject('click',this.telemetryContent,TelemetryConstant.SignIn);var attributes=getTelemetryAttributes(this.telemetryContent,payLoad);return!customer&&/*#__PURE__*/React.createElement(Button,Object.assign({className:'ms-header__signin-button',title:resources.signInLinkText,href:user&&user.signInUrl,\"aria-label\":resources.signInLinkAriaText,onClick:onTelemetryClick(this.telemetryContent,payLoad,'Sign in')},attributes),/*#__PURE__*/React.createElement(\"span\",{className:'ms-header__signin-button-text',\"aria-hidden\":true},resources.signInLinkText));}},{key:\"_getSignOutButton\",value:function _getSignOutButton(customer,user,resources){var payLoad=getPayloadObject('click',this.telemetryContent,TelemetryConstant.SignOut);var attributes=getTelemetryAttributes(this.telemetryContent,payLoad);return customer&&this.displayName&&/*#__PURE__*/React.createElement(Button,Object.assign({className:'ms-header__signout-button',title:resources.signOutLinkText,href:user&&user.signOutUrl||'',\"aria-label\":resources.signOutLinkAriaText,onClick:onTelemetryClick(this.telemetryContent,payLoad,'Sign out')},attributes),/*#__PURE__*/React.createElement(\"span\",{className:'ms-header__signout-button-text',\"aria-hidden\":true},resources.signOutLinkText));}},{key:\"_getAccountInfoDropdownButton\",value:function _getAccountInfoDropdownButton(customer){var payLoad=getPayloadObject('click',this.telemetryContent,TelemetryConstant.MyProfile);var attributes=getTelemetryAttributes(this.telemetryContent,payLoad);return customer&&this.displayName&&/*#__PURE__*/React.createElement(Button,Object.assign({innerRef:this.popOverRef,className:'ms-header__profile-button',\"aria-describedby\":'myprofilePopover',onClick:this._togglePopover,color:'link',\"aria-expanded\":this.state.signinPopoverOpen},attributes),/*#__PURE__*/React.createElement(\"span\",{className:'ms-profile-button-text'},this.displayName));}},{key:\"_getAccountLinks\",value:function _getAccountLinks(customer){var _this2=this;var myAccountLinks=this.props.config.myAccountLinks;var payLoad=getPayloadObject('click',this.telemetryContent,'');if(!customer||!this.displayName||!myAccountLinks||!myAccountLinks.length){return undefined;}return myAccountLinks.map(function(cta,index){payLoad.contentAction.etext=cta.linkText;var attributes=getTelemetryAttributes(_this2.telemetryContent,payLoad);var editableLink={ariaLabel:cta.ariaLabel,className:'ms-signin-info__account-link-button',linkText:cta.linkText,linkUrl:cta.linkUrl.destinationUrl,openInNewTab:cta.openInNewTab,role:'button',additionalProperties:attributes};return/*#__PURE__*/React.createElement(MsDyn365.Link,{key:index,link:editableLink,editProps:{onTextChange:_this2.handleLinkTextChange(index),requestContext:_this2.props.context.request}});});}},{key:\"_toggleNavbar\",value:function _toggleNavbar(){this.setState({mobileMenuCollapsed:!this.state.mobileMenuCollapsed});}},{key:\"_togglePopover\",value:function _togglePopover(){this.setState({signinPopoverOpen:!this.state.signinPopoverOpen});}},{key:\"_keydown\",value:function _keydown(e){if(e.keyCode===27){this.setState({mobileMenuCollapsed:true});}}},{key:\"displayName\",get:function get(){var _this$props$data$acco;var customer=(_this$props$data$acco=this.props.data.accountInformation)===null||_this$props$data$acco===void 0?void 0:_this$props$data$acco.result;return customer?customer.FirstName||customer.Name:undefined;}}]);return Header;}(React.PureComponent);__decorate([computed],Header.prototype,\"displayName\",null);export default Header;","map":{"version":3,"sources":["modules/header/header.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport {\n    Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, KeyCodes, Modal,\n    ModalBody, ModalHeader, onTelemetryClick, Popover, TelemetryConstant\n} from '@msdyn365-commerce-modules/utilities';\nimport { CartIconComponent, WishListIconComponent } from '@msdyn365-commerce/components';\nimport * as MsDyn365 from '@msdyn365-commerce/core';\nimport { Customer } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport { computed } from 'mobx';\nimport * as React from 'react';\nimport { Logo, NavIcon } from './components';\nimport { IHeaderData } from './header.data';\nimport { IHeaderProps, IHeaderResources, IMyAccountLinksData } from './header.props.autogenerated';\n\nexport interface IHeaderState {\n    mobileMenuCollapsed: boolean;\n    signinPopoverOpen: boolean;\n}\n\nexport interface IHeaderViewProps extends IHeaderProps<IHeaderData>, IHeaderState {\n    logo: React.ReactNode;\n    wishListIconDesktop: React.ReactNode;\n    wishListIconMobile: React.ReactNode;\n    cartIcon: React.ReactNode;\n    navIcon: React.ReactNode;\n    className: string;\n    menuBar: React.ReactNode[];\n    search: React.ReactNode[];\n    siteOptions: React.ReactNode[];\n    HeaderTag: IModuleProps;\n    HeaderContainer: INodeProps;\n    MobileMenuContainer: INodeProps;\n    MobileMenuHeader: React.ReactNode;\n    MobileMenuBodyContainer: INodeProps;\n    MobileMenuLinksContainer: INodeProps;\n    HeaderTopBarContainer: INodeProps;\n    Divider: INodeProps;\n\n    AccountInfoDropdownParentContainer?: INodeProps;\n    AccountInfoDropdownPopoverConentContainer?: INodeProps;\n    accountInfoDropdownButton?: React.ReactNode;\n\n    signOutLink?: React.ReactNode;\n    signInLink?: React.ReactNode;\n    accountLinks?: React.ReactNode[];\n}\n\n/**\n *\n * Header component\n * @extends {React.PureComponent<IHeaderProps<IHeaderData>>}\n */\nclass Header extends React.PureComponent<IHeaderProps<IHeaderData>, IHeaderState> {\n    private popOverRef: React.RefObject<HTMLButtonElement>;\n    private telemetryContent: ITelemetryContent;\n    @computed public get displayName(): Readonly<string | undefined> {\n        const customer = this.props.data.accountInformation?.result;\n        return customer ? customer.FirstName || customer.Name : undefined;\n    }\n\n    constructor(props: IHeaderProps<IHeaderData>) {\n        super(props);\n        this.popOverRef = React.createRef();\n        this._toggleNavbar = this._toggleNavbar.bind(this);\n        this._togglePopover = this._togglePopover.bind(this);\n        this._keydown = this._keydown.bind(this);\n        this.state = {\n            mobileMenuCollapsed: true,\n            signinPopoverOpen: false\n        };\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public componentDidMount(): void {\n        if (MsDyn365.msdyn365Commerce.isBrowser) {\n            window.addEventListener('keydown', this._keydown);\n        }\n    }\n\n    public componentWillUnmount(): void {\n        if (MsDyn365.msdyn365Commerce.isBrowser) {\n            window.removeEventListener('keydown', this._keydown, false);\n        }\n    }\n\n    // tslint:disable-next-line: max-func-body-length\n    public render(): JSX.Element | null {\n        const {\n            id,\n            typeName,\n            data: { accountInformation,\n                cart: { result: cart }\n            },\n            context: {\n                request: {\n                    user\n                }\n            },\n            context,\n            resources: {\n                cartLabel\n            }\n        } = this.props;\n        const { logoLink, logoImage } = this.props.config;\n        const headerClassName = classnames('ms-header', this.props.config.className);\n        const navbarKey = 'header-nav-mobile';\n        const customer = accountInformation && accountInformation.result;\n        const cartIconSlot = this._getSlot('cartIcon');\n        const menuBarSlot = this._getSlot('menuBar');\n        const searchSlot = this._getSlot('search');\n        const siteOptionsSlot = this._getSlot('siteOptions');\n        const viewProps: IHeaderViewProps = {\n            ...(this.props as IHeaderProps<IHeaderData>),\n            ...(this.state),\n            logo: <Logo {...{ link: logoLink, image: logoImage, className: 'ms-header__logo', gridSettings: this.props.context.request.gridSettings, requestContext: this.props.context.request, telemetryContent: this.telemetryContent }} />,\n            wishListIconDesktop: (\n                <WishListIconComponent\n                    className='ms-header__wishlist-desktop'\n                    showButtonTooltip={true}\n                    wishlistTooltipText={this.props.resources.wishlistTooltipText}\n                    context={context}\n                    id={id}\n                    typeName={typeName}\n                    telemetryContent={this.telemetryContent}\n                    data={{}}\n                />\n            ),\n            wishListIconMobile: (\n                <WishListIconComponent\n                    className='ms-header__wishlist-mobile'\n                    showButtonTooltip={true}\n                    wishlistTooltipText={this.props.resources.wishlistTooltipText}\n                    context={context}\n                    id={id}\n                    typeName={typeName}\n                    telemetryContent={this.telemetryContent}\n                    data={{}}\n                />\n            ),\n            cartIcon: (cartIconSlot && cartIconSlot.length > 0)\n                ? cartIconSlot[0]\n                : cart && <CartIconComponent cartLabel={cartLabel} context={context} id={id} typeName={typeName} telemetryContent={this.telemetryContent} data={{ cart: cart }} />,\n            navIcon: <NavIcon {...{ resources: this.props.resources, isExpanded: !this.state.mobileMenuCollapsed, targetId: navbarKey, toggleNavBar: this._toggleNavbar, telemetryContent: this.telemetryContent }} />,\n            menuBar: menuBarSlot && menuBarSlot.length && menuBarSlot || [],\n            search: searchSlot && searchSlot.length && searchSlot || [],\n            siteOptions: siteOptionsSlot && siteOptionsSlot.length && siteOptionsSlot || [],\n            className: headerClassName,\n            HeaderTag: {\n                moduleProps: this.props,\n                className: classnames(headerClassName),\n                tag: 'header'\n            },\n            HeaderContainer: {\n                className: classnames('ms-header__container')\n            },\n            HeaderTopBarContainer: {\n                className: classnames('ms-header__topbar')\n            },\n            Divider: {\n                className: classnames('ms-header__divider')\n            },\n            MobileMenuContainer: {\n                tag: Modal,\n                id: navbarKey,\n                className: 'ms-header__mobile-hamburger',\n                isOpen: !this.state.mobileMenuCollapsed,\n                wrapClassName: 'ms-header__modal'\n            },\n            MobileMenuHeader: (\n                <ModalHeader\n                    className='ms-header__mobile-hamburger-menu-header'\n                    toggle={this._toggleNavbar}\n                />\n            ),\n            MobileMenuBodyContainer: {\n                tag: ModalBody,\n                className: 'ms-header__mobile-hamburger-menu-body',\n            },\n            MobileMenuLinksContainer: {\n                className: 'ms-header__mobile-hamburger-menu-links',\n            },\n            AccountInfoDropdownParentContainer: {\n                className: 'ms-header__account-info'\n            },\n            AccountInfoDropdownPopoverConentContainer: customer && this.displayName && {\n                tag: Popover,\n                id: 'myprofilePopover',\n                className: 'ms-header__account-info-content',\n                placement: 'bottom',\n                isOpen: this.state.signinPopoverOpen,\n                target: this.popOverRef,\n                toggle: this._togglePopover,\n            } || undefined,\n            signInLink: this._getSigninButton(customer, user, this.props.resources),\n            signOutLink: this._getSignOutButton(customer, user, this.props.resources),\n            accountInfoDropdownButton: this._getAccountInfoDropdownButton(customer),\n            accountLinks: this._getAccountLinks(customer)\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    /* Handle link text change*/\n    public handleLinkTextChange = (linkIndex: number) => (event: MsDyn365.ContentEditableEvent) => {\n        if (this.props.config.myAccountLinks && this.props.config.myAccountLinks[linkIndex]) {\n            this.props.config.myAccountLinks[linkIndex].linkText = event.target.value;\n        }\n    }\n\n    private _getSlot(slotName: string): React.ReactNode[] | null {\n        const { slots } = this.props;\n        return (slots && slots[slotName] && slots[slotName].length && slots[slotName]) || null;\n    }\n\n    private _getSigninButton(customer: Customer | undefined, user: MsDyn365.IRequestContextUser | undefined, resources: IHeaderResources): React.ReactNode | undefined {\n        const payLoad = getPayloadObject('click', this.telemetryContent, TelemetryConstant.SignIn);\n        const attributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n        return !customer && (\n            <Button\n                className='ms-header__signin-button'\n                title={resources.signInLinkText}\n                href={user && user.signInUrl}\n                aria-label={resources.signInLinkAriaText}\n                onClick={onTelemetryClick(this.telemetryContent, payLoad, 'Sign in')}\n                {...attributes}\n            >\n                <span className='ms-header__signin-button-text' aria-hidden={true}>{resources.signInLinkText}</span>\n            </Button>\n        );\n    }\n\n    private _getSignOutButton(customer: Customer | undefined, user: MsDyn365.IRequestContextUser | undefined, resources: IHeaderResources): React.ReactNode | undefined {\n        const payLoad = getPayloadObject('click', this.telemetryContent, TelemetryConstant.SignOut);\n        const attributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n        return customer && this.displayName && (\n            <Button\n                className={'ms-header__signout-button'}\n                title={resources.signOutLinkText}\n                href={user && user.signOutUrl || ''}\n                aria-label={resources.signOutLinkAriaText}\n                onClick={onTelemetryClick(this.telemetryContent, payLoad, 'Sign out')}\n                {...attributes}\n            >\n                <span className='ms-header__signout-button-text' aria-hidden={true}>{resources.signOutLinkText}</span>\n            </Button>\n        );\n    }\n\n    private _getAccountInfoDropdownButton(customer: Customer | undefined): React.ReactNode | undefined {\n        const payLoad = getPayloadObject('click', this.telemetryContent, TelemetryConstant.MyProfile);\n        const attributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n        return customer && this.displayName && (\n            <Button\n                innerRef={this.popOverRef}\n                className={'ms-header__profile-button'}\n                aria-describedby='myprofilePopover'\n                onClick={this._togglePopover}\n                color='link'\n                aria-expanded={this.state.signinPopoverOpen}\n                {...attributes}\n            >\n                <span className='ms-profile-button-text'>{this.displayName}</span>\n            </Button>\n        );\n    }\n\n    private _getAccountLinks(customer: Customer | undefined): React.ReactNode[] | undefined {\n        const { myAccountLinks } = this.props.config;\n        const payLoad = getPayloadObject('click', this.telemetryContent, '');\n        if(!customer || ! this.displayName || !myAccountLinks || !myAccountLinks.length) {\n            return undefined;\n        }\n        return myAccountLinks.map((cta: IMyAccountLinksData, index: number) => {\n            payLoad.contentAction.etext = cta.linkText;\n            const attributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n            const editableLink: MsDyn365.ILinksData = {\n                ariaLabel: cta.ariaLabel,\n                className: 'ms-signin-info__account-link-button',\n                linkText: cta.linkText,\n                linkUrl: cta.linkUrl.destinationUrl,\n                openInNewTab: cta.openInNewTab,\n                role: 'button',\n                additionalProperties: attributes\n            };\n\n            return (\n                <MsDyn365.Link\n                    key={index}\n                    link={editableLink}\n                    editProps={{ onTextChange: this.handleLinkTextChange(index), requestContext: this.props.context.request }}\n                />\n            );\n        });\n    }\n\n    private _toggleNavbar(): void {\n        this.setState({\n            mobileMenuCollapsed: !this.state.mobileMenuCollapsed\n        });\n    }\n\n    private _togglePopover(): void {\n        this.setState({\n            signinPopoverOpen: !this.state.signinPopoverOpen\n        });\n    }\n\n    private _keydown(e: KeyboardEvent): void {\n        if (e.keyCode === KeyCodes.Escape) {\n            this.setState({ mobileMenuCollapsed: true });\n        }\n    }\n}\n\nexport default Header;"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}