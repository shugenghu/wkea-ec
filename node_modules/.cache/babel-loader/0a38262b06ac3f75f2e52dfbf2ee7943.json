{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol===\"undefined\"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}import{getCartState,getCheckoutState}from'@msdyn365-commerce/global-state';function emptyActiveCart(_x){return _emptyActiveCart.apply(this,arguments);}function _emptyActiveCart(){_emptyActiveCart=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx){var cartState,checkoutState,lineItemIdsToRemove,activeCart,checkoutCart,_iterator,_step,activeCartLine,_iterator2,_step2,checkoutCartLine;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:lineItemIdsToRemove=[];_context.prev=1;_context.next=4;return getCartState(ctx);case 4:cartState=_context.sent;_context.next=7;return getCheckoutState(ctx);case 7:checkoutState=_context.sent;_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);throw _context.t0;case 13:if(!(!cartState||!cartState.cart)){_context.next=15;break;}throw new Error('Fail to fetch active cart');case 15:if(!(!checkoutState||!checkoutState.checkoutCart)){_context.next=17;break;}throw new Error('Fail to fetch checkoutCart cart');case 17:activeCart=cartState.cart;checkoutCart=checkoutState.checkoutCart.cart;_iterator=_createForOfIteratorHelper(activeCart.CartLines||[]);try{for(_iterator.s();!(_step=_iterator.n()).done;){activeCartLine=_step.value;_iterator2=_createForOfIteratorHelper(checkoutCart.CartLines||[]);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){checkoutCartLine=_step2.value;if(activeCartLine.LineId&&activeCartLine.LineId===checkoutCartLine.LineId){lineItemIdsToRemove.push(activeCartLine.LineId);}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}}catch(err){_iterator.e(err);}finally{_iterator.f();}_context.prev=21;_context.next=24;return cartState.removeCartLines({cartLineIds:lineItemIdsToRemove});case 24:_context.next=26;return cartState.removeAllPromoCodes({});case 26:_context.next=28;return checkoutState.removeCheckoutCartId({});case 28:_context.next=33;break;case 30:_context.prev=30;_context.t1=_context[\"catch\"](21);throw _context.t1;case 33:case\"end\":return _context.stop();}}},_callee,null,[[1,10],[21,30]]);}));return _emptyActiveCart.apply(this,arguments);}export default emptyActiveCart;","map":{"version":3,"sources":["modules/checkout/methods/empty-active-cart.ts"],"names":[],"mappings":"q/CACA,OAAS,YAAT,CAAuB,gBAAvB,KAA+C,iCAA/C,C,QAEe,CAAA,e,yJAAf,iBAA+B,GAA/B,4PAGU,mBAHV,CAGgC,EAHhC,uCAM0B,CAAA,YAAY,CAAC,GAAD,CANtC,QAMQ,SANR,qCAO8B,CAAA,gBAAgB,CAAC,GAAD,CAP9C,QAOQ,aAPR,+HAYQ,CAAC,SAAD,EAAc,CAAC,SAAS,CAAC,IAZjC,gCAac,IAAI,CAAA,KAAJ,CAAU,2BAAV,CAbd,cAgBQ,CAAC,aAAD,EAAkB,CAAC,aAAa,CAAC,YAhBzC,gCAiBc,IAAI,CAAA,KAAJ,CAAU,iCAAV,CAjBd,SAoBU,UApBV,CAoBuB,SAAS,CAAC,IApBjC,CAqBU,YArBV,CAqByB,aAAa,CAAC,YAAd,CAA2B,IArBpD,sCAuBiC,UAAU,CAAC,SAAX,EAAwB,EAvBzD,MAuBI,+CAAyD,CAA9C,cAA8C,mDACtB,YAAY,CAAC,SAAb,EAA0B,EADJ,MACrD,kDAA6D,CAAlD,gBAAkD,cACzD,GAAI,cAAc,CAAC,MAAf,EAAyB,cAAc,CAAC,MAAf,GAA0B,gBAAgB,CAAC,MAAxE,CAAgF,CAC5E,mBAAmB,CAAC,IAApB,CAAyB,cAAc,CAAC,MAAxC,EACH,CACJ,CALoD,uDAMxD,CA7BL,6FAgCc,CAAA,SAAS,CAAC,eAAV,CAA0B,CAAE,WAAW,CAAE,mBAAf,CAA1B,CAhCd,gCAiCc,CAAA,SAAS,CAAC,mBAAV,CAA8B,EAA9B,CAjCd,gCAkCc,CAAA,aAAa,CAAC,oBAAd,CAAmC,EAAnC,CAlCd,0L,kDAwCA,cAAe,CAAA,eAAf","sourcesContent":["import { IActionContext } from '@msdyn365-commerce/core';\nimport { getCartState, getCheckoutState } from '@msdyn365-commerce/global-state';\n\nasync function emptyActiveCart(ctx: IActionContext): Promise<void> {\n    let cartState;\n    let checkoutState;\n    const lineItemIdsToRemove = [];\n\n    try {\n        cartState = await getCartState(ctx);\n        checkoutState = await getCheckoutState(ctx);\n    } catch (e) {\n        throw e;\n    }\n\n    if (!cartState || !cartState.cart) {\n        throw new Error('Fail to fetch active cart');\n    }\n\n    if (!checkoutState || !checkoutState.checkoutCart) {\n        throw new Error('Fail to fetch checkoutCart cart');\n    }\n\n    const activeCart = cartState.cart;\n    const checkoutCart = checkoutState.checkoutCart.cart;\n\n    for (const activeCartLine of activeCart.CartLines || []) {\n        for (const checkoutCartLine of checkoutCart.CartLines || []) {\n            if (activeCartLine.LineId && activeCartLine.LineId === checkoutCartLine.LineId) {\n                lineItemIdsToRemove.push(activeCartLine.LineId);\n            }\n        }\n    }\n\n    try {\n        await cartState.removeCartLines({ cartLineIds: lineItemIdsToRemove });\n        await cartState.removeAllPromoCodes({});\n        await checkoutState.removeCheckoutCartId({});\n    } catch (e) {\n        throw e;\n    }\n}\n\nexport default emptyActiveCart;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}