{"ast":null,"code":"import\"core-js/modules/es.string.split.js\";import classnames from'classnames';import*as React from'react';export const POST_MESSAGE_NAME='message';const getHostName=function getHostName(){let url=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';return(url.indexOf('//')>-1?url.split('/')[2]:url.split('/')[0]).toLowerCase();};class IPaymentFrameElement extends React.PureComponent{constructor(props){super(props);this.postMessage=params=>{if(this.iframeRef&&this.iframeRef.current&&this.iframeRef.current.contentWindow&&this.iframeRef.current.contentWindow.postMessage){this.iframeRef.current.contentWindow.postMessage(params.message,params.targetOrigin);}};this.onEvent=event=>{const{sourceUrl,onIFrameMessage,requestUrlOrigin,messageOrigin}=this.props;const sourceHost=getHostName(sourceUrl);const eventHost=getHostName(event.origin);const requestHost=getHostName(requestUrlOrigin);const messageHost=getHostName(messageOrigin);if(!onIFrameMessage||sourceUrl&&!(sourceHost===eventHost||requestHost===eventHost||messageHost===eventHost)||!sourceUrl&&!(requestHost===eventHost||messageHost===eventHost)){return;}return onIFrameMessage(event);};this.updateContentDocument=()=>{const{displayContent,sourceUrl,css}=this.props;if(!sourceUrl&&displayContent&&this.iframeRef&&this.iframeRef.current){const innerDocument=this.iframeRef.current.contentDocument;if(innerDocument){innerDocument.open();innerDocument.write(displayContent);if(css){const style=document.createElement('style');const cssNote=document.createTextNode(css);style.type='text/css';style.appendChild(cssNote);innerDocument.head.appendChild(style);}innerDocument.close();}}};this.iframeRef=/*#__PURE__*/React.createRef();}componentDidMount(){window.addEventListener(POST_MESSAGE_NAME,this.onEvent);this.updateContentDocument();}componentDidUpdate(prevProps){if(prevProps.displayContent!==this.props.displayContent){this.updateContentDocument();}}componentWillUnmount(){window.removeEventListener(POST_MESSAGE_NAME,this.onEvent);}render(){const{sourceUrl,className,iframeAriaLabel,height}=this.props;return/*#__PURE__*/React.createElement(\"iframe\",{className:classnames('checkout-payment-instrument__iframe',className),\"aria-label\":iframeAriaLabel,src:sourceUrl,ref:this.iframeRef,height:height,sandbox:'allow-scripts allow-forms allow-same-origin allow-popups'});}}export default IPaymentFrameElement;","map":{"version":3,"sources":["modules/checkout-payment-instrument/components/iframe.tsx"],"names":[],"mappings":"2CAIA,MAAO,CAAA,UAAP,KAAuB,YAAvB,CACA,MAAO,GAAK,CAAA,KAAZ,KAAuB,OAAvB,CAeA,MAAO,MAAM,CAAA,iBAAiB,CAAG,SAA1B,CAEP,KAAM,CAAA,WAAW,CAAG,QAAd,CAAA,WAAc,EAA6B,IAA5B,CAAA,GAA4B,2DAAd,EAAc,CAC7C,MAAO,CAAC,GAAG,CAAC,OAAJ,CAAY,IAAZ,EAAoB,CAAC,CAArB,CAAyB,GAAG,CAAC,KAAJ,CAAU,GAAV,EAAe,CAAf,CAAzB,CAA6C,GAAG,CAAC,KAAJ,CAAU,GAAV,EAAe,CAAf,CAA9C,EAAiE,WAAjE,EAAP,CACH,CAFD,CASA,KAAM,CAAA,oBAAN,QAAmC,CAAA,KAAK,CAAC,aAAwC,CAG7E,WAAA,CAAY,KAAZ,CAA4C,CACxC,MAAM,KAAN,EAmCG,KAAA,WAAA,CAAe,MAAD,EAA+C,CAChE,GACI,KAAK,SAAL,EACA,KAAK,SAAL,CAAe,OADf,EAEA,KAAK,SAAL,CAAe,OAAf,CAAuB,aAFvB,EAGA,KAAK,SAAL,CAAe,OAAf,CAAuB,aAAvB,CAAqC,WAJzC,CAKE,CACE,KAAK,SAAL,CAAe,OAAf,CAAuB,aAAvB,CAAqC,WAArC,CAAiD,MAAM,CAAC,OAAxD,CAAiE,MAAM,CAAC,YAAxE,EACH,CACJ,CATM,CAWC,KAAA,OAAA,CAAW,KAAD,EAAwB,CACtC,KAAM,CAAE,SAAF,CAAa,eAAb,CAA8B,gBAA9B,CAAgD,aAAhD,EAAkE,KAAK,KAA7E,CACA,KAAM,CAAA,UAAU,CAAG,WAAW,CAAC,SAAD,CAA9B,CACA,KAAM,CAAA,SAAS,CAAG,WAAW,CAAC,KAAK,CAAC,MAAP,CAA7B,CACA,KAAM,CAAA,WAAW,CAAG,WAAW,CAAC,gBAAD,CAA/B,CACA,KAAM,CAAA,WAAW,CAAG,WAAW,CAAC,aAAD,CAA/B,CAIA,GACI,CAAC,eAAD,EACC,SAAS,EAAI,EAAE,UAAU,GAAK,SAAf,EAA4B,WAAW,GAAK,SAA5C,EAAyD,WAAW,GAAK,SAA3E,CADd,EAEC,CAAC,SAAD,EAAc,EAAE,WAAW,GAAK,SAAhB,EAA6B,WAAW,GAAK,SAA/C,CAHnB,CAIE,CACE,OACH,CAED,MAAO,CAAA,eAAe,CAAC,KAAD,CAAtB,CACH,CAlBO,CAoBA,KAAA,qBAAA,CAAwB,IAAW,CACvC,KAAM,CAAE,cAAF,CAAkB,SAAlB,CAA6B,GAA7B,EAAqC,KAAK,KAAhD,CACA,GAAI,CAAC,SAAD,EAAc,cAAd,EAAgC,KAAK,SAArC,EAAkD,KAAK,SAAL,CAAe,OAArE,CAA8E,CAC1E,KAAM,CAAA,aAAa,CAAG,KAAK,SAAL,CAAe,OAAf,CAAuB,eAA7C,CAEA,GAAI,aAAJ,CAAmB,CACf,aAAa,CAAC,IAAd,GACA,aAAa,CAAC,KAAd,CAAoB,cAApB,EACA,GAAI,GAAJ,CAAS,CAEL,KAAM,CAAA,KAAK,CAAG,QAAQ,CAAC,aAAT,CAAuB,OAAvB,CAAd,CACA,KAAM,CAAA,OAAO,CAAG,QAAQ,CAAC,cAAT,CAAwB,GAAxB,CAAhB,CACA,KAAK,CAAC,IAAN,CAAa,UAAb,CACA,KAAK,CAAC,WAAN,CAAkB,OAAlB,EACA,aAAa,CAAC,IAAd,CAAmB,WAAnB,CAA+B,KAA/B,EACH,CAED,aAAa,CAAC,KAAd,GACH,CACJ,CACJ,CApBO,CAjEJ,KAAK,SAAL,cAAiB,KAAK,CAAC,SAAN,EAAjB,CACH,CAEM,iBAAiB,EAAA,CACpB,MAAM,CAAC,gBAAP,CAAwB,iBAAxB,CAA2C,KAAK,OAAhD,EAEA,KAAK,qBAAL,GACH,CAEM,kBAAkB,CAAC,SAAD,CAAqC,CAC1D,GAAI,SAAS,CAAC,cAAV,GAA6B,KAAK,KAAL,CAAW,cAA5C,CAA4D,CACxD,KAAK,qBAAL,GACH,CACJ,CAEM,oBAAoB,EAAA,CACvB,MAAM,CAAC,mBAAP,CAA2B,iBAA3B,CAA8C,KAAK,OAAnD,EACH,CAEM,MAAM,EAAA,CACT,KAAM,CAAE,SAAF,CAAa,SAAb,CAAwB,eAAxB,CAAyC,MAAzC,EAAoD,KAAK,KAA/D,CACA,mBACI,KAAA,CAAA,aAAA,CAAA,QAAA,CAAA,CACI,SAAS,CAAE,UAAU,CAAC,qCAAD,CAAwC,SAAxC,CADzB,CAC2E,aAC3D,eAFhB,CAGI,GAAG,CAAE,SAHT,CAII,GAAG,CAAE,KAAK,SAJd,CAKI,MAAM,CAAE,MALZ,CAOI,OAAO,CAAC,0DAPZ,CAAA,CADJ,CAWH,CArC4E,CA6FjF,cAAe,CAAA,oBAAf","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport { IPaymentConnectorPostMessage } from '../payment-instrument-message';\n\nexport interface IPaymentFrameElementProps {\n    className?: string;\n    iframeAriaLabel: string;\n    displayContent?: string;\n    sourceUrl?: string;\n    requestUrlOrigin?: string;\n    messageOrigin?: string;\n    css?: string;\n    height?: number;\n    onIFrameMessage?(event: MessageEvent): void;\n}\n\nexport const POST_MESSAGE_NAME = 'message';\n\nconst getHostName = (url: string = ''): string => {\n    return (url.indexOf('//') > -1 ? url.split('/')[2] : url.split('/')[0]).toLowerCase();\n};\n\n/**\n *\n * IFrameElement component\n * @extends {React.PureComponent<IPaymentFrameElementProps>}\n */\nclass IPaymentFrameElement extends React.PureComponent<IPaymentFrameElementProps> {\n    private iframeRef: React.RefObject<HTMLIFrameElement>;\n\n    constructor(props: IPaymentFrameElementProps) {\n        super(props);\n        this.iframeRef = React.createRef();\n    }\n\n    public componentDidMount(): void {\n        window.addEventListener(POST_MESSAGE_NAME, this.onEvent);\n\n        this.updateContentDocument();\n    }\n\n    public componentDidUpdate(prevProps: IPaymentFrameElementProps): void {\n        if (prevProps.displayContent !== this.props.displayContent) {\n            this.updateContentDocument();\n        }\n    }\n\n    public componentWillUnmount(): void {\n        window.removeEventListener(POST_MESSAGE_NAME, this.onEvent);\n    }\n\n    public render(): JSX.Element | null {\n        const { sourceUrl, className, iframeAriaLabel, height } = this.props;\n        return (\n            <iframe\n                className={classnames('checkout-payment-instrument__iframe', className)}\n                aria-label={iframeAriaLabel}\n                src={sourceUrl}\n                ref={this.iframeRef}\n                height={height}\n                // tslint:disable-next-line:react-iframe-missing-sandbox\n                sandbox='allow-scripts allow-forms allow-same-origin allow-popups'\n            />\n        );\n    }\n\n    public postMessage = (params: IPaymentConnectorPostMessage): void => {\n        if (\n            this.iframeRef &&\n            this.iframeRef.current &&\n            this.iframeRef.current.contentWindow &&\n            this.iframeRef.current.contentWindow.postMessage\n        ) {\n            this.iframeRef.current.contentWindow.postMessage(params.message, params.targetOrigin);\n        }\n    };\n\n    private onEvent = (event: MessageEvent) => {\n        const { sourceUrl, onIFrameMessage, requestUrlOrigin, messageOrigin } = this.props;\n        const sourceHost = getHostName(sourceUrl);\n        const eventHost = getHostName(event.origin);\n        const requestHost = getHostName(requestUrlOrigin);\n        const messageHost = getHostName(messageOrigin);\n\n        // Important: security check\n        // check actual origin matches with expected origin\n        if (\n            !onIFrameMessage ||\n            (sourceUrl && !(sourceHost === eventHost || requestHost === eventHost || messageHost === eventHost)) ||\n            (!sourceUrl && !(requestHost === eventHost || messageHost === eventHost))\n        ) {\n            return;\n        }\n\n        return onIFrameMessage(event);\n    };\n\n    private updateContentDocument = (): void => {\n        const { displayContent, sourceUrl, css } = this.props;\n        if (!sourceUrl && displayContent && this.iframeRef && this.iframeRef.current) {\n            const innerDocument = this.iframeRef.current.contentDocument;\n\n            if (innerDocument) {\n                innerDocument.open();\n                innerDocument.write(displayContent);\n                if (css) {\n                    // Append custom style\n                    const style = document.createElement('style');\n                    const cssNote = document.createTextNode(css);\n                    style.type = 'text/css';\n                    style.appendChild(cssNote);\n                    innerDocument.head.appendChild(style);\n                }\n\n                innerDocument.close();\n            }\n        }\n    };\n}\n\nexport default IPaymentFrameElement;"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}