{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}var SearchResultContainer_1;import{__decorate}from\"tslib\";import{getTelemetryObject,LabeledDropdown,UncontrolledPagination}from'@msdyn365-commerce-modules/utilities';import MsDyn365 from'@msdyn365-commerce/core';import{format}from'@msdyn365-commerce/retail-proxy';import classnames from'classnames';import{computed,observable,reaction,transaction}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{buildListPageUrl,getCollectionProducts,getCurrentUrl,GetFullProductsByCollectionInput,parseQueryParam,sortOptions}from'./actions';import{ErrorMessage,FeatureSearchResultItem,getUpdatedRefinementCriteria,isMatchingRefinementCriterion,Link,ModalToggle,ProductSearchResultItems,SearchResultModal,Separator,Title}from'./components';import ChoiceSummary from'./components/choice-summary';import RefineSubmenu from'./components/refine-submenu';let SearchResultContainer=SearchResultContainer_1=class SearchResultContainer extends React.PureComponent{constructor(props,state){var _this$props$context$r2;super(props);this.sortByDropdownOptions=[{key:sortOptions.sortByOptionRelevanceDesc,value:this.props.resources.sortByOptionRelevanceDesc},{key:sortOptions.sortByOptionNameAsc,value:this.props.resources.sortByOptionNameAsc},{key:sortOptions.sortByOptionNameDesc,value:this.props.resources.sortByOptionNameDesc},{key:sortOptions.sortByOptionPriceAsc,value:this.props.resources.sortByOptionPriceAsc},{key:sortOptions.sortByOptionPriceDesc,value:this.props.resources.sortByOptionPriceDesc},{key:sortOptions.sortByOptionRatingDesc,value:this.props.resources.sortByOptionRatingDesc}];this._pageType=this.props.context.request.urlTokens.pageType;this.expandrefinerCount=0;this._getSearchResultModal=()=>{const{resources}=this.props;return SearchResultModal({resources:{modalCloseButtonText:resources.modalCloseButtonText,modalTitle:resources.modalTitle},isOpen:this.state.modalIsOpen,returnRef:this._modalToggleRef,onModalToggle:this._toggleModal});};this._getCollectionTitle=()=>{const{data,context,resources}=this.props;let collectionTitle='';if(context&&context.request&&context.request.query&&context.request.query.q){collectionTitle=\"\\\"\".concat(context.request.query.q,\"\\\"\");}else{collectionTitle=data.category.result&&SearchResultContainer_1.getFriendlyName(context.request.locale,data.category.result.NameTranslations)||data.category.result&&data.category.result.Name;}let productCountText='';let productCountNumber;if(data.listPageState&&data.listPageState.result&&data.listPageState.result.totalProductCount!==undefined){productCountNumber=data.listPageState.result.totalProductCount;}else if(data.products&&data.products.result){productCountNumber=data.products.result.count;}if(productCountNumber&&productCountNumber!==0){productCountText=productCountNumber!==1?format(this.props.resources.numberOfProducts,productCountNumber):this.props.resources.oneProduct;}else{productCountText=format(this.props.resources.numberOfProducts,0);}const titlePrefix=/*#__PURE__*/React.createElement(Title,{className:'ms-search-result__collection-title-prefix',text:resources.searchTextPrefix});const titleText=collectionTitle&&/*#__PURE__*/React.createElement(Title,{className:'ms-search-result__collection-title-text',text:collectionTitle});const titleCount=/*#__PURE__*/React.createElement(Title,{className:'ms-search-result__collection-title-count',text:productCountText});return{TitleContainer:{className:'ms-search-result-container__title'},title:{titlePrefix:titlePrefix,titleText:titleText,titleCount:titleCount}};};this._getCategoryHierarchy=()=>{const{data}=this.props;const categoryHierarchy=data.categoryHierarchy.result;const categoryLinks=categoryHierarchy&&categoryHierarchy.map((value,index)=>{return/*#__PURE__*/React.createElement(Link,{key:index,text:value.Name,ariaLabel:\"\".concat(this.props.resources.categoryLinkAriaLabel,\" \").concat(value.Name),href:value.Url});});const categoryLinkSeparator=/*#__PURE__*/React.createElement(Separator,{separator:'/'});return{CategoryHierarchyContainer:{tag:'nav',className:'ms-search-result-container__category-hierarchy'},categoryHierarchyList:categoryLinks,categoryHierarchySeparator:categoryLinkSeparator};};this._getSortingDropDown=()=>{const{resources}=this.props;const activeDropdown=this._getCurrentlySelectedOption()||this.state.sortingState.selectedSortByOption;const dropdown=/*#__PURE__*/React.createElement(LabeledDropdown,{labelClassname:'reviews-list-sort-by',labelText:resources.sortByDropdownLabel,dropdownId:'categorySortByDropdown',dropdownClassname:'reviews-list-dropdown',toggleColor:'link',dropdownOptions:this.sortByDropdownOptions,selectedOption:activeDropdown,onSelectOption:this._updateSortByDropdown,ref:this._sortAndFilterContainerRef});return{SortingContainer:{className:'ms-search-result-container__Sort-by-category'},sortByDropDown:dropdown};};this._getPagination=()=>{const{config,context,data,resources}=this.props;const listPageState=data&&data.listPageState&&data.listPageState.result;const fullUrl=getCurrentUrl(context.request);const itemsPerPage=config.itemsPerPage||10;const skipCount=listPageState&&listPageState.currentPageNumber!==null?listPageState.currentPageNumber*(this.props.config.itemsPerPage||10):this.props.context.request.query&&+this.props.context.request.query.skip||0;const totalItems=listPageState&&listPageState.totalProductCount||0;const previousText=resources.flipperPrevious;const nextText=resources.flipperNext;if(totalItems<=itemsPerPage){return null;}return/*#__PURE__*/React.createElement(UncontrolledPagination,{className:'ms-search-result-container__pagination',role:'navigation',\"aria-label\":resources.paginationAriaLabel,url:fullUrl.href,qsp:'skip',items:totalItems,itemsPerPage:itemsPerPage,startingItem:skipCount,previousText:/*#__PURE__*/React.createElement(\"div\",{className:'msc-pagination__prev'},/*#__PURE__*/React.createElement(\"span\",{className:'ms-search-result__pagination-left',\"aria-hidden\":'true'}),/*#__PURE__*/React.createElement(\"span\",{className:'prev-text'},previousText)),nextText:/*#__PURE__*/React.createElement(\"div\",{className:'msc-pagination__next'},/*#__PURE__*/React.createElement(\"span\",{className:'next-text'},nextText),/*#__PURE__*/React.createElement(\"span\",{className:'ms-search-result__pagination-right',\"aria-hidden\":'true'})),previousAriaLabel:previousText,nextAriaLabel:nextText,telemetryContent:this.telemetryContent});};this._getRefineMenu=()=>{const{data,context,config}=this.props;const tempRangeTypeTODO=context.request.query&&context.request.query.inputRange?'input':'slider';const validRefiners=data.refiners.result&&data.refiners.result.filter(refiner=>{return refiner.Values.length>0;});const activeRefiners=data.listPageState.result&&data.listPageState.result.activeFilters||[];this._getexpandRefinerCount(config.expandRefinersCount);const refinelist=this.expandrefinerCount===undefined?0:this.expandrefinerCount;const expandedRefiners=refinelist===0?validRefiners&&validRefiners.length:refinelist;const subMenus=validRefiners&&validRefiners.map((productRefinerHierarchy,index)=>{return data.listPageState.result.totalProductCount!==0?/*#__PURE__*/React.createElement(RefineSubmenu,{productRefinerHierarchy:productRefinerHierarchy,selectedRefinerValues:activeRefiners,refineItemCommonProps:this._refineItemCommonProps,minValueSliderThumbAriaLabel:this.props.resources.minValueSliderThumbAriaLabel,maxValueSliderThumbAriaLabel:this.props.resources.maxValueSliderThumbAriaLabel,key:index,onUpdateRefiners:this._onUpdateRefiners,urlBuilder:this._buildRefinerUrl,isDisabled:false,isExpandedOnInitialLoad:expandedRefiners&&expandedRefiners>index?true:false,tempRangeTypeTODO:tempRangeTypeTODO,context:context,moduleId:this.props.id,moduleTypeName:this.props.typeName,telemetryContent:this.telemetryContent}):null;});return{RefineMenuContainer:{className:'ms-search-result-container__refine-menu'},RefinerSectionContainer:{className:'ms-search-result-container__refiner-section'},refiners:subMenus};};this._getChoiceSummary=()=>{const{resources,data,telemetry}=this.props;const selectedRefiners=data.listPageState.result&&data.listPageState.result.activeFilters||[];return/*#__PURE__*/React.createElement(ChoiceSummary,{classNames:'ms-choice-summary-by-category',clearAllText:resources.clearAllText,label:resources.choiceSummaryLabel,selectedChoices:selectedRefiners,refinerHierarchy:data.refiners.result,choiceFormat:resources.choiceFormat,choiceRangeValueFormat:resources.choiceRangeValueFormat,telemetry:telemetry,onChoiceClicked:this._onChoiceClicked,urlBuilder:this._buildRefinerUrlForChoiceSummary,choiceAriaLabel:resources.choiceAriaLabel,telemetryContent:this.telemetryContent});};this._updateSortByDropdown=notification=>{const{context}=this.props;const requestContext=context&&context.request;const actionContext=context&&context.actionContext;if(!requestContext||!actionContext||!this.props.data.listPageState.result){const error=\"[sort-by-category] cannot sort without context: \".concat(!requestContext?'requestContext ':'',\" \").concat(!actionContext?'actionContext ':'',\" could not be found\");this.props.telemetry.warning(error);}window.history.pushState({},'',buildListPageUrl(getCurrentUrl(this.props.context.request),undefined,[this._getSortColumnFromSelectedOption(notification.selectedOption)],undefined));transaction(()=>{this.props.data.listPageState.result.currentPageNumber=0;this.props.data.listPageState.result.sortingCritera={Columns:[this._getSortColumnFromSelectedOption(notification.selectedOption)]};});};this._getSortColumnFromSelectedOption=option=>{const{data}=this.props;if(!data.searchConfiguration.result){return{};}const mappedConfiguration=data.searchConfiguration.result.find(searchConfiguration=>{return searchConfiguration.key===option.key;});if(mappedConfiguration){return mappedConfiguration.sortColumn;}return{};};this._getCurrentlySelectedOption=()=>{const{data}=this.props;const sortCriteria=data.listPageState.result&&data.listPageState.result.sortingCritera;const activeSortColumn=sortCriteria&&sortCriteria.Columns&&sortCriteria.Columns[0]||(parseQueryParam('sorting',this.props.context.request)||[])[0];if(activeSortColumn&&data.searchConfiguration.result){const activeMappedConfig=data.searchConfiguration.result.find(mappedSearchConfig=>{return mappedSearchConfig.sortColumn.ColumnName===activeSortColumn.ColumnName&&mappedSearchConfig.sortColumn.IsDescending===activeSortColumn.IsDescending;});if(activeMappedConfig){return this.sortByDropdownOptions.find(dropdownOption=>dropdownOption.key===activeMappedConfig.key);}}return;};this._onUpdateRefiners=itemToggleNotification=>{const{context}=this.props;const requestContext=context&&context.request;const actionContext=context&&context.actionContext;if(!requestContext||!actionContext||!this.props.data.listPageState.result){const error=\"Refine menu cannot refine search criteria: \".concat(!requestContext?'requestContext ':'',\" \").concat(!actionContext?'actionContext ':'',\" could not be found\");this.props.telemetry.warning(error);}const updatedRefinementCriteria=getUpdatedRefinementCriteria(itemToggleNotification,this.props.data.listPageState.result&&this.props.data.listPageState.result.activeFilters||[]);window.history.pushState({},'',buildListPageUrl(getCurrentUrl(this.props.context.request),updatedRefinementCriteria));transaction(()=>{this.props.data.listPageState.result.currentPageNumber=0;this.props.data.listPageState.result.activeFilters=updatedRefinementCriteria;});};this._buildRefinerUrl=itemToggleNotification=>{if(this.props.data.listPageState.result){const newRefinementCriteria=getUpdatedRefinementCriteria(itemToggleNotification,this.props.data.listPageState.result.activeFilters||[]);return buildListPageUrl(getCurrentUrl(this.props.context.request),newRefinementCriteria);}else{this.props.telemetry.warning(\"[buildRefinerQueryString]List Page State Not available, unable to build refiner URL\");return'';}};this._onChoiceClicked=notification=>{const{data,telemetry}=this.props;if(!data.listPageState.result){telemetry.warning('[choice-summary-by-category._onChoiceClicked]ListPageState unavailable, unable to update refiners.');return;}let currentRefinementCriteria=data.listPageState.result&&data.listPageState.result.activeFilters||[];if(!notification.clearAll){const selectedChoice=notification.choiceClicked;if(!selectedChoice){telemetry.warning('[choice-summary-by-category._onChoiceClicked] Choice could not be determined');return;}currentRefinementCriteria=currentRefinementCriteria.filter(selectedCriterion=>!isMatchingRefinementCriterion(selectedChoice,selectedCriterion));}else{currentRefinementCriteria=[];const dropdownElementId=this._sortAndFilterContainerRef.current&&this._sortAndFilterContainerRef.current.props.dropdownId;const dropdownElement=dropdownElementId&&document.getElementById(dropdownElementId);setTimeout(()=>{dropdownElement&&dropdownElement.focus();},50);}const fullUrl=getCurrentUrl(this.props.context.request);window.history.pushState({},'',buildListPageUrl(fullUrl,currentRefinementCriteria));data.listPageState.result.currentPageNumber=0;data.listPageState.result.activeFilters=currentRefinementCriteria;};this._buildRefinerUrlForChoiceSummary=(selectedRefiner,isClearAll)=>{const{data,telemetry}=this.props;const fullUrl=getCurrentUrl(this.props.context.request);if(!data.listPageState.result){telemetry.warning('[choice-summary-by-category._buildRefinerUrl]ListPageState unavailable, unable to create refiner URL.');return fullUrl.href;}let currentRefinementCriteria=data.listPageState.result&&data.listPageState.result.activeFilters||[];if(!isClearAll){if(!selectedRefiner){telemetry.warning('[choice-summary-by-category._buildRefinerUrl] URL for Choice could not be determined');return fullUrl.href;}currentRefinementCriteria=currentRefinementCriteria.filter(selectedCriterion=>!isMatchingRefinementCriterion(selectedRefiner,selectedCriterion));}else{currentRefinementCriteria=[];}return buildListPageUrl(fullUrl,currentRefinementCriteria);};this._getexpandRefinerCount=refinerCount=>{switch(refinerCount){case\"all\":this.expandrefinerCount=0;break;case\"one\":this.expandrefinerCount=1;break;case\"two\":this.expandrefinerCount=2;break;case\"three\":this.expandrefinerCount=3;break;case\"four\":this.expandrefinerCount=4;break;default:this.expandrefinerCount=0;}};this._viewport=props.context.request&&props.context.request.device&&props.context.request.device.Type==='Mobile'?'xs':'lg';this._modalToggleRef=/*#__PURE__*/React.createRef();this._sortAndFilterContainerRef=/*#__PURE__*/React.createRef();this._toggleModal=this._toggleModal.bind(this);this._updateViewport=this._updateViewport.bind(this);this.state={sortingState:{pending:false,selectedSortByOption:this.sortByDropdownOptions[0]},modalIsOpen:false};const{placeholderTextMax,minLabel,maxLabel,rangeNameFormat}=this.props.resources;const locale=this.props.context.request.locale;const telemetry=this.props.telemetry;const validationErrorNaN=this.props.resources.validationErrorNotNumber;const validationErrorRange=this.props.resources.validationErrorNotRange;this._refineItemCommonProps={telemetry,locale,placeholderTextMax,minLabel,maxLabel,rangeNameFormat,validationErrorNaN,validationErrorRange};this.telemetryContent=getTelemetryObject(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);this.props.data.products.then(products=>{this.props.data.listPageState.then(listPageState=>{if(this._pageType==='Category'){listPageState.pageType='Category';}else{listPageState.pageType='Search';}let querySorting=[];if(this.props.context.request.query&&this.props.context.request.query.sorting){querySorting=JSON.parse(decodeURIComponent(this.props.context.request.query.sorting));}listPageState.currentPageNumber=this.props.context.request.query&&+this.props.context.request.query.skip/(this.props.config.itemsPerPage||10)||0;listPageState.sortingCritera={Columns:querySorting};listPageState.pageSize=this.props.config.itemsPerPage||10;listPageState.activeProducts=products.products;listPageState.totalProductCount=products.count;reaction(()=>{return[listPageState.activeFilters&&listPageState.activeFilters.length,listPageState.currentPageNumber,listPageState.sortingCritera&&listPageState.sortingCritera.Columns&&listPageState.sortingCritera.Columns.length];},()=>{var _this$props$context$r;const input=new GetFullProductsByCollectionInput(listPageState.pageType,this.props.context.request.apiSettings,{Paging:{Top:this.props.config.itemsPerPage,Skip:Math.max(listPageState.pageSize*(listPageState.currentPageNumber||0),0)},count:true,Sorting:listPageState.sortingCritera||{}},listPageState.activeFilters||[],+(this.props.context.request.urlTokens.itemId||0),this.props.context.request.query&&this.props.context.request.query.q?this.props.context.request.query.q:(_this$props$context$r=this.props.context.request.query)===null||_this$props$context$r===void 0?void 0:_this$props$context$r.productId,this.props&&this.props.config&&this.props.config.includeAttributes!==undefined&&this.props.config.includeAttributes===true?true:false,this.props.context.request.locale);getCollectionProducts(input,this.props.context.actionContext).then(productResults=>{listPageState.activeProducts=productResults.products;listPageState.totalProductCount=productResults.count;});});});});if((_this$props$context$r2=this.props.context.request.query)!==null&&_this$props$context$r2!==void 0&&_this$props$context$r2.productId){this.props.data.featureProduct.then(products=>{this.props.data.listPageState.then(listPageStateFeature=>{listPageStateFeature.featureProduct=products;});});}this._updateViewport();}get isMobile(){return this._viewport==='xs'||this._viewport==='sm';}static getFriendlyName(locale,nameTranslations){let nameTranslation;if(locale&&nameTranslations&&nameTranslations.length>0){nameTranslation=nameTranslations.find(item=>item.Language.toLowerCase()===locale.toLowerCase());}return nameTranslation&&nameTranslation.Text;}componentDidMount(){if(MsDyn365.isBrowser&&window.addEventListener){window.addEventListener('resize',this._updateViewport);this._updateViewport();}}componentWillUnmount(){if(MsDyn365.isBrowser&&window.removeEventListener){window.removeEventListener('resize',this._updateViewport);}}render(){const{imageSettings,className,allowBackNavigation}=this.props.config;const{resources}=this.props;const products=this.props.data.listPageState.result&&this.props.data.listPageState.result.activeProducts||[];const searchProduct=this.props.data.listPageState.result&&this.props.data.listPageState.result.featureProduct||null;let errorText='';const breaCrumbType=this.props.context.app.config.breadcrumbType;const allowBack=allowBackNavigation&&(breaCrumbType==='back'||breaCrumbType==='categoryAndBack');if(!products||products.length===0){errorText=this._pageType==='Category'?resources.resultCategoryNotFoundText:resources.resultSearchNotFoundText;}const productsComponent=/*#__PURE__*/React.createElement(ProductSearchResultItems,{products:products,context:this.props.context,imageSettings:imageSettings,resources:resources,moduleType:this.props.typeName,moduleId:this.props.id,allowBackNavigation:allowBack,telemetryContent:this.telemetryContent});const featureComponent=/*#__PURE__*/React.createElement(FeatureSearchResultItem,{product:searchProduct,context:this.props.context,imageSettings:imageSettings,resources:resources,moduleType:this.props.typeName,moduleId:this.props.id,telemetryContent:this.telemetryContent});const searchResultContainerViewProps=_objectSpread(_objectSpread({},this.props),{},{products:productsComponent,TitleViewProps:this._getCollectionTitle(),categoryHierarchy:!this.props.config.disableHierarchy&&this._getCategoryHierarchy(),refineMenu:this._getRefineMenu(),className:classnames('ms-search-result-container',className),SearchResultContainer:{moduleProps:this.props,className:classnames('ms-search-result-container',className)},sortByOptions:this.props.data.listPageState.result&&this.props.data.listPageState.result.totalProductCount!==0?this._getSortingDropDown():null,pagination:this._getPagination(),ProductsContainer:{className:'ms-search-result-container__Products'},ProductSectionContainer:{className:'ms-search-result-container__product-section'},CategoryNavContainer:{className:'ms-search-result-container__category-nav-section'},RefineAndProductSectionContainer:{className:'ms-search-result-container__refine-product-section'},choiceSummary:this._getChoiceSummary(),modalToggle:this.props.data.listPageState.result&&this.props.data.listPageState.result.totalProductCount!==0?/*#__PURE__*/React.createElement(ModalToggle,{text:resources.modalTitle,ariaLabel:resources.modalTitle,innerRef:this._modalToggleRef,onClick:this._toggleModal,id:'search-result-modal'}):null,searchResultModal:this._getSearchResultModal(),isMobile:this.isMobile,errorMessage:errorText&&/*#__PURE__*/React.createElement(ErrorMessage,{text:errorText}),FeatureSearchContainer:{className:'ms-feature-search-result'},similarLookProduct:this.props.data.listPageState.result&&this.props.data.listPageState.result.featureProduct!==null&&this.props.data.listPageState.result.featureProduct!==undefined?featureComponent:null});return this.props.renderView(searchResultContainerViewProps);}_getViewport(){const{context}=this.props;if(context.request&&context.request.device&&context.request.device.Type==='Mobile'){return'xs';}if(MsDyn365.isBrowser&&window.innerWidth){const gridSettings=context.request.gridSettings;if(gridSettings){if(gridSettings.xs&&window.innerWidth<=gridSettings.xs.w){return'xs';}else if(gridSettings.sm&&window.innerWidth<=gridSettings.sm.w){return'sm';}else if(gridSettings.md&&window.innerWidth<=gridSettings.md.w){return'md';}else if(gridSettings.lg&&window.innerWidth<=gridSettings.lg.w){return'lg';}else{return'xl';}}}return'lg';}_toggleModal(){this.setState({modalIsOpen:!this.state.modalIsOpen});}_updateViewport(){this._viewport=this._getViewport();if(this.state.modalIsOpen&&!this.isMobile){this._toggleModal();}}};__decorate([computed],SearchResultContainer.prototype,\"isMobile\",null);__decorate([observable],SearchResultContainer.prototype,\"_viewport\",void 0);SearchResultContainer=SearchResultContainer_1=__decorate([observer],SearchResultContainer);export default SearchResultContainer;","map":{"version":3,"sources":["modules/search-result-container/search-result-container.tsx"],"names":[],"mappings":"65BAIA,OAAS,kBAAT,CAAwI,eAAxI,CAAyJ,sBAAzJ,KAAuL,sCAAvL,CAEA,MAAO,CAAA,QAAP,KAAqB,yBAArB,CACA,OAAS,MAAT,KAA8E,iCAA9E,CACA,MAAO,CAAA,UAAP,KAAuB,YAAvB,CACA,OAAS,QAAT,CAAmB,UAAnB,CAA+B,QAA/B,CAAyC,WAAzC,KAA4D,MAA5D,CACA,OAAS,QAAT,KAAyB,YAAzB,CACA,MAAO,GAAK,CAAA,KAAZ,KAAuB,OAAvB,CACA,OAAS,gBAAT,CAA2B,qBAA3B,CAAkD,aAAlD,CAAiE,gCAAjE,CAAmG,eAAnG,CAAoH,WAApH,KAAwI,WAAxI,CACA,OAAS,YAAT,CAAuB,uBAAvB,CAAgD,4BAAhD,CACyF,6BADzF,CACwH,IADxH,CAC8H,WAD9H,CAC2I,wBAD3I,CACqK,iBADrK,CACwL,SADxL,CACmM,KADnM,KACgN,cADhN,CAEA,MAAO,CAAA,aAAP,KAA0B,6BAA1B,CACA,MAAO,CAAA,aAAP,KAA0B,6BAA1B,CA2EA,GAAqB,CAAA,qBAAqB,CAAA,uBAAA,CAA1C,KAAqB,CAAA,qBAArB,QAAmD,CAAA,KAAK,CAAC,aAAmG,CAiCxJ,WAAA,CAAY,KAAZ,CAA4E,KAA5E,CAA8G,4BAC1G,MAAM,KAAN,EA5BI,KAAA,qBAAA,CAAkD,CACtD,CAAE,GAAG,CAAE,WAAW,CAAC,yBAAnB,CAA8C,KAAK,CAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,yBAA1E,CADsD,CAEtD,CAAE,GAAG,CAAE,WAAW,CAAC,mBAAnB,CAAwC,KAAK,CAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,mBAApE,CAFsD,CAGtD,CAAE,GAAG,CAAE,WAAW,CAAC,oBAAnB,CAAyC,KAAK,CAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,oBAArE,CAHsD,CAItD,CAAE,GAAG,CAAE,WAAW,CAAC,oBAAnB,CAAyC,KAAK,CAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,oBAArE,CAJsD,CAKtD,CAAE,GAAG,CAAE,WAAW,CAAC,qBAAnB,CAA0C,KAAK,CAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,qBAAtE,CALsD,CAMtD,CAAE,GAAG,CAAE,WAAW,CAAC,sBAAnB,CAA2C,KAAK,CAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,sBAAvE,CANsD,CAAlD,CASA,KAAA,SAAA,CAAgC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,SAA3B,CAAqC,QAArE,CAMA,KAAA,kBAAA,CAA6B,CAA7B,CAuMA,KAAA,qBAAA,CAAwB,IAAkC,CAC9D,KAAM,CAAC,SAAD,EAAc,KAAK,KAAzB,CACA,MAAO,CAAA,iBAAiB,CACpB,CACD,SAAS,CAAC,CACN,oBAAoB,CAAE,SAAS,CAAC,oBAD1B,CAEN,UAAU,CAAE,SAAS,CAAC,UAFhB,CADT,CAKD,MAAM,CAAC,KAAK,KAAL,CAAW,WALjB,CAMD,SAAS,CAAE,KAAK,eANf,CAOD,aAAa,CAAE,KAAK,YAPnB,CADoB,CAAxB,CAUH,CAZO,CAcA,KAAA,mBAAA,CAAsB,IAAsB,CAChD,KAAM,CAAE,IAAF,CAAQ,OAAR,CAAiB,SAAjB,EAA+B,KAAK,KAA1C,CAEA,GAAI,CAAA,eAAe,CAAuB,EAA1C,CACA,GAAI,OAAO,EAAI,OAAO,CAAC,OAAnB,EAA8B,OAAO,CAAC,OAAR,CAAgB,KAA9C,EAAuD,OAAO,CAAC,OAAR,CAAgB,KAAhB,CAAsB,CAAjF,CAAoF,CAChF,eAAe,aAAO,OAAO,CAAC,OAAR,CAAgB,KAAhB,CAAsB,CAA7B,MAAf,CACH,CAFD,IAEO,CACH,eAAe,CAAI,IAAI,CAAC,QAAL,CAAc,MAAd,EAAwB,uBAAqB,CAAC,eAAtB,CAAsC,OAAO,CAAC,OAAR,CAAgB,MAAtD,CAA8D,IAAI,CAAC,QAAL,CAAc,MAAd,CAAqB,gBAAnF,CAAzB,EACb,IAAI,CAAC,QAAL,CAAc,MAAd,EAAwB,IAAI,CAAC,QAAL,CAAc,MAAd,CAAqB,IADlD,CAEH,CACD,GAAI,CAAA,gBAAgB,CAAG,EAAvB,CACA,GAAI,CAAA,kBAAJ,CACA,GAAI,IAAI,CAAC,aAAL,EAAsB,IAAI,CAAC,aAAL,CAAmB,MAAzC,EAAmD,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,iBAA1B,GAAgD,SAAvG,CAAkH,CAC9G,kBAAkB,CAAG,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,iBAA/C,CACH,CAFD,IAEO,IAAI,IAAI,CAAC,QAAL,EAAiB,IAAI,CAAC,QAAL,CAAc,MAAnC,CAA2C,CAC9C,kBAAkB,CAAG,IAAI,CAAC,QAAL,CAAc,MAAd,CAAqB,KAA1C,CACH,CAED,GAAI,kBAAkB,EAAI,kBAAkB,GAAK,CAAjD,CAAoD,CAChD,gBAAgB,CAAG,kBAAkB,GAAK,CAAvB,CAA2B,MAAM,CAAC,KAAK,KAAL,CAAW,SAAX,CAAqB,gBAAtB,CAAwC,kBAAxC,CAAjC,CAA+F,KAAK,KAAL,CAAW,SAAX,CAAqB,UAAvI,CACH,CAFD,IAEO,CACH,gBAAgB,CAAG,MAAM,CAAC,KAAK,KAAL,CAAW,SAAX,CAAqB,gBAAtB,CAAwC,CAAxC,CAAzB,CACH,CACD,KAAM,CAAA,WAAW,cAAG,KAAA,CAAA,aAAA,CAAC,KAAD,CAAM,CAAC,SAAS,CAAC,2CAAX,CAAuD,IAAI,CAAE,SAAS,CAAC,gBAAvE,CAAN,CAApB,CACA,KAAM,CAAA,SAAS,CAAG,eAAe,eAAI,KAAA,CAAA,aAAA,CAAC,KAAD,CAAM,CAAC,SAAS,CAAC,yCAAX,CAAqD,IAAI,CAAE,eAA3D,CAAN,CAArC,CACA,KAAM,CAAA,UAAU,cAAG,KAAA,CAAA,aAAA,CAAC,KAAD,CAAM,CAAC,SAAS,CAAC,0CAAX,CAAsD,IAAI,CAAE,gBAA5D,CAAN,CAAnB,CAEA,MAAO,CACH,cAAc,CAAE,CAAE,SAAS,CAAE,mCAAb,CADb,CAEH,KAAK,CAAC,CACN,WAAW,CAAE,WADP,CAEN,SAAS,CAAE,SAFL,CAGN,UAAU,CAAE,UAHN,CAFH,CAAP,CASH,CApCO,CAqCA,KAAA,qBAAA,CAAwB,IAAkC,CAC9D,KAAM,CAAE,IAAF,EAAW,KAAK,KAAtB,CACA,KAAM,CAAA,iBAAiB,CAAG,IAAI,CAAC,iBAAL,CAAuB,MAAjD,CACA,KAAM,CAAA,aAAa,CACf,iBAAiB,EAAI,iBAAiB,CAAC,GAAlB,CAAsB,CAAC,KAAD,CAA+B,KAA/B,GAAgD,CAEvF,mBACI,KAAA,CAAA,aAAA,CAAC,IAAD,CAAK,CACD,GAAG,CAAE,KADJ,CAED,IAAI,CAAE,KAAK,CAAC,IAFX,CAGD,SAAS,WAAK,KAAK,KAAL,CAAW,SAAX,CAAqB,qBAA1B,aAAmD,KAAK,CAAC,IAAzD,CAHR,CAID,IAAI,CAAE,KAAK,CAAC,GAJX,CAAL,CADJ,CAQH,CAVoB,CADzB,CAYA,KAAM,CAAA,qBAAqB,cAAG,KAAA,CAAA,aAAA,CAAC,SAAD,CAAU,CAAC,SAAS,CAAC,GAAX,CAAV,CAA9B,CAEA,MAAO,CACH,0BAA0B,CAAE,CAAE,GAAG,CAAE,KAAP,CAAc,SAAS,CAAE,gDAAzB,CADzB,CAEH,qBAAqB,CAAE,aAFpB,CAGH,0BAA0B,CAAE,qBAHzB,CAAP,CAMH,CAvBO,CAyBA,KAAA,mBAAA,CAAsB,IAAuB,CACjD,KAAM,CAAE,SAAF,EAAgB,KAAK,KAA3B,CACA,KAAM,CAAA,cAAc,CAAG,KAAK,2BAAL,IAAsC,KAAK,KAAL,CAAW,YAAX,CAAwB,oBAArF,CACA,KAAM,CAAA,QAAQ,cACd,KAAA,CAAA,aAAA,CAAC,eAAD,CAAgB,CACZ,cAAc,CAAC,sBADH,CAEZ,SAAS,CAAE,SAAS,CAAC,mBAFT,CAGZ,UAAU,CAAC,wBAHC,CAIZ,iBAAiB,CAAC,uBAJN,CAKZ,WAAW,CAAC,MALA,CAMZ,eAAe,CAAE,KAAK,qBANV,CAOZ,cAAc,CAAE,cAPJ,CAQZ,cAAc,CAAE,KAAK,qBART,CASZ,GAAG,CAAE,KAAK,0BATE,CAAhB,CADA,CAYA,MAAO,CACH,gBAAgB,CAAE,CAAE,SAAS,CAAE,8CAAb,CADf,CAEH,cAAc,CAAC,QAFZ,CAAP,CAIH,CAnBO,CAqBA,KAAA,cAAA,CAAiB,IAAsB,CAC3C,KAAM,CAAE,MAAF,CAAU,OAAV,CAAmB,IAAnB,CAAyB,SAAzB,EAAuC,KAAK,KAAlD,CACA,KAAM,CAAA,aAAa,CAAG,IAAI,EAAI,IAAI,CAAC,aAAb,EAA8B,IAAI,CAAC,aAAL,CAAmB,MAAvE,CACA,KAAM,CAAA,OAAO,CAAG,aAAa,CAAC,OAAO,CAAC,OAAT,CAA7B,CACA,KAAM,CAAA,YAAY,CAAG,MAAM,CAAC,YAAP,EAAuB,EAA5C,CACA,KAAM,CAAA,SAAS,CAAG,aAAa,EAAI,aAAa,CAAC,iBAAd,GAAoC,IAArD,CACb,aAAa,CAAC,iBAAd,EAAmC,KAAK,KAAL,CAAW,MAAX,CAAkB,YAAlB,EAAkC,EAArE,CADa,CAEZ,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,EAAoC,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,CAAiC,IAAvE,EAAgF,CAFrF,CAGA,KAAM,CAAA,UAAU,CAAG,aAAa,EAAI,aAAa,CAAC,iBAA/B,EAAoD,CAAvE,CACA,KAAM,CAAA,YAAY,CAAG,SAAS,CAAC,eAA/B,CACA,KAAM,CAAA,QAAQ,CAAG,SAAS,CAAC,WAA3B,CACA,GAAI,UAAU,EAAI,YAAlB,CAAgC,CAC5B,MAAO,KAAP,CACH,CACD,mBACA,KAAA,CAAA,aAAA,CAAC,sBAAD,CAAuB,CACnB,SAAS,CAAC,wCADS,CAEnB,IAAI,CAAC,YAFc,CAEF,aACL,SAAS,CAAC,mBAHH,CAInB,GAAG,CAAE,OAAO,CAAC,IAJM,CAKnB,GAAG,CAAE,MALc,CAMnB,KAAK,CAAE,UANY,CAOnB,YAAY,CAAE,YAPK,CAQnB,YAAY,CAAE,SARK,CASnB,YAAY,cAAE,KAAA,CAAA,aAAA,CAAA,KAAA,CAAA,CAAK,SAAS,CAAC,sBAAf,CAAA,cAAsC,KAAA,CAAA,aAAA,CAAA,MAAA,CAAA,CAAM,SAAS,CAAC,mCAAhB,CAAmD,cAAa,MAAhE,CAAA,CAAtC,cAA8G,KAAA,CAAA,aAAA,CAAA,MAAA,CAAA,CAAM,SAAS,CAAC,WAAhB,CAAA,CAA6B,YAA7B,CAA9G,CATK,CAUnB,QAAQ,cAAE,KAAA,CAAA,aAAA,CAAA,KAAA,CAAA,CAAK,SAAS,CAAC,sBAAf,CAAA,cAAsC,KAAA,CAAA,aAAA,CAAA,MAAA,CAAA,CAAM,SAAS,CAAC,WAAhB,CAAA,CAA6B,QAA7B,CAAtC,cAAmF,KAAA,CAAA,aAAA,CAAA,MAAA,CAAA,CAAM,SAAS,CAAC,oCAAhB,CAAoD,cAAa,MAAjE,CAAA,CAAnF,CAVS,CAWnB,iBAAiB,CAAE,YAXA,CAYnB,aAAa,CAAE,QAZI,CAanB,gBAAgB,CAAE,KAAK,gBAbJ,CAAvB,CADA,CAgBH,CA9BO,CAgCA,KAAA,cAAA,CAAiB,IAA2B,CAChD,KAAM,CAAE,IAAF,CAAQ,OAAR,CAAiB,MAAjB,EAA4B,KAAK,KAAvC,CACA,KAAM,CAAA,iBAAiB,CAAG,OAAO,CAAC,OAAR,CAAgB,KAAhB,EAAyB,OAAO,CAAC,OAAR,CAAgB,KAAhB,CAAsB,UAA/C,CAA4D,OAA5D,CAAsE,QAAhG,CACA,KAAM,CAAA,aAAa,CAAG,IAAI,CAAC,QAAL,CAAc,MAAd,EAAwB,IAAI,CAAC,QAAL,CAAc,MAAd,CAAqB,MAArB,CAA4B,OAAO,EAAG,CAChF,MAAO,CAAA,OAAO,CAAC,MAAR,CAAe,MAAf,CAAwB,CAA/B,CACH,CAF6C,CAA9C,CAIA,KAAM,CAAA,cAAc,CAAI,IAAI,CAAC,aAAL,CAAmB,MAAnB,EAA6B,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,aAAxD,EAA0E,EAAjG,CAEA,KAAK,sBAAL,CAA4B,MAAM,CAAC,mBAAnC,EACA,KAAM,CAAA,UAAU,CAAG,KAAK,kBAAL,GAA4B,SAA5B,CAAwC,CAAxC,CAA6C,KAAK,kBAArE,CACA,KAAM,CAAA,gBAAgB,CAAG,UAAU,GAAK,CAAf,CAAmB,aAAa,EAAI,aAAa,CAAC,MAAlD,CAA0D,UAAnF,CACA,KAAM,CAAA,QAAQ,CAAG,aAAa,EAAI,aAAa,CAAC,GAAd,CAAkB,CAAC,uBAAD,CAAoD,KAApD,GAAqE,CACrH,MAAQ,CAAA,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA2B,iBAA3B,GAAiD,CAAjD,cAEJ,KAAA,CAAA,aAAA,CAAC,aAAD,CAAc,CACV,uBAAuB,CAAE,uBADf,CAEV,qBAAqB,CAAE,cAFb,CAGV,qBAAqB,CAAE,KAAK,sBAHlB,CAIV,4BAA4B,CAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,4BAJzC,CAKV,4BAA4B,CAAE,KAAK,KAAL,CAAW,SAAX,CAAqB,4BALzC,CAMV,GAAG,CAAE,KANK,CAOV,gBAAgB,CAAE,KAAK,iBAPb,CAQV,UAAU,CAAE,KAAK,gBARP,CASV,UAAU,CAAE,KATF,CAUV,uBAAuB,CAAE,gBAAgB,EAAI,gBAAgB,CAAG,KAAvC,CAA+C,IAA/C,CAAsD,KAVrE,CAWV,iBAAiB,CAAE,iBAXT,CAYV,OAAO,CAAI,OAZD,CAaV,QAAQ,CAAE,KAAK,KAAL,CAAW,EAbX,CAcV,cAAc,CAAE,KAAK,KAAL,CAAW,QAdjB,CAeV,gBAAgB,CAAE,KAAK,gBAfb,CAAd,CAFI,CAkBE,IAlBV,CAoBH,CArBiC,CAAlC,CAuBA,MAAO,CACH,mBAAmB,CAAC,CAAC,SAAS,CAAE,yCAAZ,CADjB,CAEH,uBAAuB,CAAC,CAAC,SAAS,CAAE,6CAAZ,CAFrB,CAGH,QAAQ,CAAE,QAHP,CAAP,CAMH,CAzCO,CA2CA,KAAA,iBAAA,CAAoB,IAAsB,CAC9C,KAAM,CAAE,SAAF,CAAa,IAAb,CAAmB,SAAnB,EAAiC,KAAK,KAA5C,CACA,KAAM,CAAA,gBAAgB,CAAI,IAAI,CAAC,aAAL,CAAmB,MAAnB,EAA6B,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,aAAxD,EAA0E,EAAnG,CACA,mBACI,KAAA,CAAA,aAAA,CAAC,aAAD,CAAc,CACV,UAAU,CAAC,+BADD,CAEV,YAAY,CAAE,SAAS,CAAC,YAFd,CAGV,KAAK,CAAE,SAAS,CAAC,kBAHP,CAIV,eAAe,CAAE,gBAJP,CAMV,gBAAgB,CAAE,IAAI,CAAC,QAAL,CAAc,MANtB,CAOV,YAAY,CAAE,SAAS,CAAC,YAPd,CAQV,sBAAsB,CAAE,SAAS,CAAC,sBARxB,CASV,SAAS,CAAE,SATD,CAUV,eAAe,CAAE,KAAK,gBAVZ,CAWV,UAAU,CAAE,KAAK,gCAXP,CAYV,eAAe,CAAE,SAAS,CAAC,eAZjB,CAaV,gBAAgB,CAAE,KAAK,gBAbb,CAAd,CADJ,CAkBH,CArBO,CAuBA,KAAA,qBAAA,CAAyB,YAAD,EAA6D,CACzF,KAAM,CAAE,OAAF,EAAc,KAAK,KAAzB,CACA,KAAM,CAAA,cAAc,CAAG,OAAO,EAAI,OAAO,CAAC,OAA1C,CACA,KAAM,CAAA,aAAa,CAAG,OAAO,EAAI,OAAO,CAAC,aAAzC,CAEA,GAAI,CAAC,cAAD,EAAmB,CAAC,aAApB,EAAqC,CAAC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAAxE,CAAgF,CAC5E,KAAM,CAAA,KAAK,2DAAsD,CAAC,cAAD,CAAkB,iBAAlB,CAAsC,EAA5F,aAAkG,CAAC,aAAD,CAAiB,gBAAjB,CAAoC,EAAtI,uBAAX,CACA,KAAK,KAAL,CAAW,SAAX,CAAqB,OAArB,CAA6B,KAA7B,EACH,CAED,MAAM,CAAC,OAAP,CAAe,SAAf,CAAyB,EAAzB,CAA6B,EAA7B,CAAiC,gBAAgB,CAAC,aAAa,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAApB,CAAd,CAA4C,SAA5C,CAAuD,CAAC,KAAK,gCAAL,CAAsC,YAAY,CAAC,cAAnD,CAAD,CAAvD,CAA6H,SAA7H,CAAjD,EACA,WAAW,CAAC,IAAK,CACb,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAsC,iBAAtC,CAA0D,CAA1D,CACA,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAsC,cAAtC,CAAuD,CAAE,OAAO,CAAE,CAAC,KAAK,gCAAL,CAAsC,YAAY,CAAC,cAAnD,CAAD,CAAX,CAAvD,CACH,CAHU,CAAX,CAIH,CAfO,CAiBA,KAAA,gCAAA,CAAoC,MAAD,EAA+C,CACtF,KAAM,CAAE,IAAF,EAAW,KAAK,KAAtB,CAEA,GAAI,CAAC,IAAI,CAAC,mBAAL,CAAyB,MAA9B,CAAsC,CAClC,MAAO,EAAP,CACH,CAED,KAAM,CAAA,mBAAmB,CAAG,IAAI,CAAC,mBAAL,CAAyB,MAAzB,CAAgC,IAAhC,CAAsC,mBAAD,EAAwB,CAAG,MAAO,CAAA,mBAAmB,CAAC,GAApB,GAA4B,MAAM,CAAC,GAA1C,CAAgD,CAAhH,CAA5B,CAEA,GAAI,mBAAJ,CAAyB,CACrB,MAAO,CAAA,mBAAmB,CAAC,UAA3B,CACH,CAED,MAAO,EAAP,CACH,CAdO,CAgBA,KAAA,2BAAA,CAA8B,IAAyC,CAC3E,KAAM,CAAE,IAAF,EAAW,KAAK,KAAtB,CACA,KAAM,CAAA,YAAY,CAAG,IAAI,CAAC,aAAL,CAAmB,MAAnB,EAA6B,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,cAA5E,CAEA,KAAM,CAAA,gBAAgB,CACjB,YAAY,EAAI,YAAY,CAAC,OAA7B,EAAwC,YAAY,CAAC,OAAb,CAAqB,CAArB,CAAzC,EACA,CAAC,eAAe,CAAe,SAAf,CAA0B,KAAK,KAAL,CAAW,OAAX,CAAmB,OAA7C,CAAf,EAAwE,EAAzE,EAA6E,CAA7E,CAFJ,CAIA,GAAI,gBAAgB,EAAI,IAAI,CAAC,mBAAL,CAAyB,MAAjD,CAAyD,CACrD,KAAM,CAAA,kBAAkB,CAAG,IAAI,CAAC,mBAAL,CAAyB,MAAzB,CAAgC,IAAhC,CAAsC,kBAAD,EAAuB,CACnF,MAAQ,CAAA,kBAAkB,CAAC,UAAnB,CAA8B,UAA9B,GAA6C,gBAAgB,CAAC,UAA/D,EACF,kBAAkB,CAAC,UAAnB,CAA8B,YAA9B,GAA+C,gBAAgB,CAAC,YADrE,CAEH,CAH0B,CAA3B,CAIA,GAAI,kBAAJ,CAAwB,CACpB,MAAO,MAAK,qBAAL,CAA2B,IAA3B,CAAiC,cAAD,EAAoB,cAAc,CAAC,GAAf,GAAuB,kBAAkB,CAAC,GAA9F,CAAP,CACH,CACJ,CAED,OACH,CAnBO,CAqBA,KAAA,iBAAA,CAAqB,sBAAD,EAAgE,CACxF,KAAM,CAAE,OAAF,EAAc,KAAK,KAAzB,CACA,KAAM,CAAA,cAAc,CAAG,OAAO,EAAI,OAAO,CAAC,OAA1C,CACA,KAAM,CAAA,aAAa,CAAG,OAAO,EAAI,OAAO,CAAC,aAAzC,CAEA,GAAI,CAAC,cAAD,EAAmB,CAAC,aAApB,EAAqC,CAAC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAAxE,CAAgF,CAC5E,KAAM,CAAA,KAAK,sDAAiD,CAAC,cAAD,CAAkB,iBAAlB,CAAsC,EAAvF,aAA6F,CAAC,aAAD,CAAiB,gBAAjB,CAAoC,EAAjI,uBAAX,CACA,KAAK,KAAL,CAAW,SAAX,CAAqB,OAArB,CAA6B,KAA7B,EACH,CAED,KAAM,CAAA,yBAAyB,CAAG,4BAA4B,CAAC,sBAAD,CAAyB,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,EAAwC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAqC,aAA7E,EAA8F,EAAvH,CAA9D,CAEA,MAAM,CAAC,OAAP,CAAe,SAAf,CAAyB,EAAzB,CAA6B,EAA7B,CAAiC,gBAAgB,CAAC,aAAa,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAApB,CAAd,CAA4C,yBAA5C,CAAjD,EACA,WAAW,CAAC,IAAK,CACb,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAsC,iBAAtC,CAA0D,CAA1D,CACA,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAsC,aAAtC,CAAsD,yBAAtD,CACH,CAHU,CAAX,CAIH,CAjBO,CAmBA,KAAA,gBAAA,CAAoB,sBAAD,EAAkE,CACzF,GAAI,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAAlC,CAA0C,CACtC,KAAM,CAAA,qBAAqB,CAAG,4BAA4B,CAAC,sBAAD,CAAyB,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAqC,aAArC,EAAsD,EAA/E,CAA1D,CAEA,MAAO,CAAA,gBAAgB,CAAC,aAAa,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAApB,CAAd,CAA4C,qBAA5C,CAAvB,CACH,CAJD,IAIO,CACH,KAAK,KAAL,CAAW,SAAX,CAAqB,OAArB,wFACA,MAAO,EAAP,CACH,CACJ,CATO,CAWA,KAAA,gBAAA,CAAoB,YAAD,EAAwD,CAC/E,KAAM,CAAE,IAAF,CAAQ,SAAR,EAAsB,KAAK,KAAjC,CAEA,GAAI,CAAC,IAAI,CAAC,aAAL,CAAmB,MAAxB,CAAgC,CAC5B,SAAS,CAAC,OAAV,CAAkB,oGAAlB,EACA,OACH,CAED,GAAI,CAAA,yBAAyB,CAAI,IAAI,CAAC,aAAL,CAAmB,MAAnB,EAA6B,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,aAAxD,EAA0E,EAA1G,CAEA,GAAI,CAAC,YAAY,CAAC,QAAlB,CAA4B,CACxB,KAAM,CAAA,cAAc,CAAG,YAAY,CAAC,aAApC,CACA,GAAI,CAAC,cAAL,CAAqB,CACjB,SAAS,CAAC,OAAV,CAAkB,8EAAlB,EACA,OACH,CACD,yBAAyB,CAAG,yBAAyB,CAAC,MAA1B,CACvB,iBAAD,EAA4C,CAAC,6BAA6B,CAAC,cAAD,CAAiB,iBAAjB,CADlD,CAA5B,CAGH,CATD,IASO,CACH,yBAAyB,CAAG,EAA5B,CAGA,KAAM,CAAA,iBAAiB,CAAG,KAAK,0BAAL,CAAgC,OAAhC,EAA2C,KAAK,0BAAL,CAAgC,OAAhC,CAAwC,KAAxC,CAA8C,UAAnH,CACA,KAAM,CAAA,eAAe,CAAG,iBAAiB,EAAI,QAAQ,CAAC,cAAT,CAAwB,iBAAxB,CAA7C,CACA,UAAU,CAAC,IAAK,CACZ,eAAe,EAAI,eAAe,CAAC,KAAhB,EAAnB,CACH,CAFS,CAGC,EAHD,CAAV,CAIH,CAED,KAAM,CAAA,OAAO,CAAG,aAAa,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAApB,CAA7B,CACA,MAAM,CAAC,OAAP,CAAe,SAAf,CAAyB,EAAzB,CAA6B,EAA7B,CAAiC,gBAAgB,CAAC,OAAD,CAAU,yBAAV,CAAjD,EACA,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,iBAA1B,CAA8C,CAA9C,CACA,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,aAA1B,CAA0C,yBAA1C,CACH,CAnCO,CAqCA,KAAA,gCAAA,CAAmC,CAAC,eAAD,CAAuC,UAAvC,GAAsE,CAC7G,KAAM,CAAE,IAAF,CAAQ,SAAR,EAAsB,KAAK,KAAjC,CACA,KAAM,CAAA,OAAO,CAAG,aAAa,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAApB,CAA7B,CAEA,GAAI,CAAC,IAAI,CAAC,aAAL,CAAmB,MAAxB,CAAgC,CAC5B,SAAS,CAAC,OAAV,CAAkB,uGAAlB,EACA,MAAO,CAAA,OAAO,CAAC,IAAf,CACH,CAED,GAAI,CAAA,yBAAyB,CAAI,IAAI,CAAC,aAAL,CAAmB,MAAnB,EAA6B,IAAI,CAAC,aAAL,CAAmB,MAAnB,CAA0B,aAAxD,EAA0E,EAA1G,CAEA,GAAI,CAAC,UAAL,CAAiB,CACb,GAAI,CAAC,eAAL,CAAsB,CAClB,SAAS,CAAC,OAAV,CAAkB,sFAAlB,EACA,MAAO,CAAA,OAAO,CAAC,IAAf,CACH,CACD,yBAAyB,CAAG,yBAAyB,CAAC,MAA1B,CACvB,iBAAD,EAA4C,CAAC,6BAA6B,CAAC,eAAD,CAAkB,iBAAlB,CADlD,CAA5B,CAGH,CARD,IAQO,CACH,yBAAyB,CAAG,EAA5B,CACH,CAED,MAAO,CAAA,gBAAgB,CAAC,OAAD,CAAU,yBAAV,CAAvB,CACH,CAxBO,CAoEA,KAAA,sBAAA,CAA0B,YAAD,EAA6C,CAC1E,OAAO,YAAP,EACI,IAAA,KAAA,CACI,KAAK,kBAAL,CAA0B,CAA1B,CACA,MACJ,IAAA,KAAA,CACI,KAAK,kBAAL,CAA0B,CAA1B,CACA,MACJ,IAAA,KAAA,CACG,KAAK,kBAAL,CAA0B,CAA1B,CACA,MACH,IAAA,OAAA,CACI,KAAK,kBAAL,CAA0B,CAA1B,CACA,MACJ,IAAA,MAAA,CACI,KAAK,kBAAL,CAA0B,CAA1B,CACA,MACJ,QACI,KAAK,kBAAL,CAA0B,CAA1B,CAjBR,CAmBH,CApBO,CAzjBJ,KAAK,SAAL,CAAiB,KAAK,CAAC,OAAN,CAAc,OAAd,EAAyB,KAAK,CAAC,OAAN,CAAc,OAAd,CAAsB,MAA/C,EAAyD,KAAK,CAAC,OAAN,CAAc,OAAd,CAAsB,MAAtB,CAA6B,IAA7B,GAAsC,QAA/F,CAA0G,IAA1G,CAAiH,IAAlI,CACA,KAAK,eAAL,cAAuB,KAAK,CAAC,SAAN,EAAvB,CACA,KAAK,0BAAL,cAAkC,KAAK,CAAC,SAAN,EAAlC,CACA,KAAK,YAAL,CAAoB,KAAK,YAAL,CAAkB,IAAlB,CAAuB,IAAvB,CAApB,CACA,KAAK,eAAL,CAAuB,KAAK,eAAL,CAAqB,IAArB,CAA0B,IAA1B,CAAvB,CACA,KAAK,KAAL,CAAa,CACT,YAAY,CAAE,CACV,OAAO,CAAE,KADC,CAEV,oBAAoB,CAAE,KAAK,qBAAL,CAA2B,CAA3B,CAFZ,CADL,CAKT,WAAW,CAAE,KALJ,CAAb,CAOA,KAAM,CACF,kBADE,CAEF,QAFE,CAGF,QAHE,CAIF,eAJE,EAKF,KAAK,KAAL,CAAW,SALf,CAOA,KAAM,CAAA,MAAM,CAAG,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,MAA1C,CACA,KAAM,CAAA,SAAS,CAAG,KAAK,KAAL,CAAW,SAA7B,CACA,KAAM,CAAA,kBAAkB,CAAG,KAAK,KAAL,CAAW,SAAX,CAAqB,wBAAhD,CACA,KAAM,CAAA,oBAAoB,CAAG,KAAK,KAAL,CAAW,SAAX,CAAqB,uBAAlD,CACA,KAAK,sBAAL,CAA8B,CAC1B,SAD0B,CAE1B,MAF0B,CAG1B,kBAH0B,CAI1B,QAJ0B,CAK1B,QAL0B,CAM1B,eAN0B,CAO1B,kBAP0B,CAQ1B,oBAR0B,CAA9B,CAUA,KAAK,gBAAL,CAAwB,kBAAkB,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,iBAA5B,CACC,KAAK,KAAL,CAAW,YADZ,CAEC,KAAK,KAAL,CAAW,SAFZ,CAA1C,CAKA,KAAK,KAAL,CAAW,IAAX,CAAgB,QAAhB,CAAyB,IAAzB,CAA+B,QAAD,EAAa,CACvC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,IAA9B,CAAoC,aAAD,EAAkB,CACjD,GAAI,KAAK,SAAL,GAAmB,UAAvB,CAAmC,CAC/B,aAAa,CAAC,QAAd,CAAyB,UAAzB,CACH,CAFD,IAEO,CACH,aAAa,CAAC,QAAd,CAAyB,QAAzB,CACH,CAED,GAAI,CAAA,YAAY,CAAiB,EAAjC,CAEA,GAAI,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,EAAoC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,CAAiC,OAAzE,CAAkF,CAC9E,YAAY,CAAG,IAAI,CAAC,KAAL,CAAW,kBAAkB,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,CAAiC,OAAlC,CAA7B,CAAf,CACH,CAED,aAAa,CAAC,iBAAd,CAAkC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,EAAqC,CAAC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,CAAiC,IAAlC,EAA0C,KAAK,KAAL,CAAW,MAAX,CAAkB,YAAlB,EAAkC,EAA5E,CAArC,EAAyH,CAA3J,CACA,aAAa,CAAC,cAAd,CAA+B,CAAE,OAAO,CAAE,YAAX,CAA/B,CACA,aAAa,CAAC,QAAd,CAAyB,KAAK,KAAL,CAAW,MAAX,CAAkB,YAAlB,EAAkC,EAA3D,CACA,aAAa,CAAC,cAAd,CAA+B,QAAQ,CAAC,QAAxC,CACA,aAAa,CAAC,iBAAd,CAAkC,QAAQ,CAAC,KAA3C,CAGA,QAAQ,CACJ,IAAK,CACD,MAAO,CAAC,aAAa,CAAC,aAAd,EAA+B,aAAa,CAAC,aAAd,CAA4B,MAA5D,CAAoE,aAAa,CAAC,iBAAlF,CAAqG,aAAa,CAAC,cAAd,EAAgC,aAAa,CAAC,cAAd,CAA6B,OAA7D,EAAwE,aAAa,CAAC,cAAd,CAA6B,OAA7B,CAAqC,MAAlN,CAAP,CACH,CAHG,CAIJ,IAAK,2BACD,KAAM,CAAA,KAAK,CAAG,GAAI,CAAA,gCAAJ,CACV,aAAa,CAAC,QADJ,CAEV,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,WAFjB,CAGV,CAAE,MAAM,CAAE,CAAE,GAAG,CAAE,KAAK,KAAL,CAAW,MAAX,CAAkB,YAAzB,CAAuC,IAAI,CAAE,IAAI,CAAC,GAAL,CAAU,aAAa,CAAC,QAAd,EAA0B,aAAa,CAAC,iBAAd,EAAmC,CAA7D,CAAV,CAA4E,CAA5E,CAA7C,CAAV,CAAyI,KAAK,CAAE,IAAhJ,CAAsJ,OAAO,CAAE,aAAa,CAAC,cAAd,EAAgC,EAA/L,CAHU,CAIV,aAAa,CAAC,aAAd,EAA+B,EAJrB,CAKV,EAAE,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,SAA3B,CAAqC,MAArC,EAA+C,CAAjD,CALU,CAMV,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,EAAoC,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,CAAiC,CAArE,CAAyE,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA3B,CAAiC,CAA1G,wBAA8G,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAAzI,gDAA8G,sBAAkC,SANtI,CAOV,KAAK,KAAL,EAAc,KAAK,KAAL,CAAW,MAAzB,EAAmC,KAAK,KAAL,CAAW,MAAX,CAAkB,iBAAlB,GAAwC,SAA3E,EAAwF,KAAK,KAAL,CAAW,MAAX,CAAkB,iBAAlB,GAAwC,IAAhI,CAAuI,IAAvI,CAA8I,KAPpI,CAQV,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,MARjB,CAAd,CAWA,qBAAqB,CAAC,KAAD,CAAQ,KAAK,KAAL,CAAW,OAAX,CAAmB,aAA3B,CAArB,CAA+D,IAA/D,CAAoE,cAAc,EAAG,CACjF,aAAa,CAAC,cAAd,CAA+B,cAAc,CAAC,QAA9C,CACA,aAAa,CAAC,iBAAd,CAAkC,cAAc,CAAC,KAAjD,CACH,CAHD,EAIH,CApBG,CAAR,CAuBH,CA3CD,EA4CH,CA7CD,EA+CA,2BAAI,KAAK,KAAL,CAAW,OAAX,CAAmB,OAAnB,CAA2B,KAA/B,2CAAI,uBAAkC,SAAtC,CAAiD,CAC7C,KAAK,KAAL,CAAW,IAAX,CAAgB,cAAhB,CAA+B,IAA/B,CAAqC,QAAD,EAAa,CAC7C,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,IAA9B,CAAoC,oBAAD,EAAyB,CACxD,oBAAoB,CAAC,cAArB,CAAsC,QAAtC,CAEH,CAHD,EAIH,CALD,EAMP,CACG,KAAK,eAAL,GACH,CA/HS,GAAI,CAAA,QAAJ,EAAY,CAClB,MAAQ,MAAK,SAAL,GAAmB,IAAnB,EAA2B,KAAK,SAAL,GAAmB,IAAtD,CACH,CAoBM,MAAO,CAAA,eAAP,CAAuB,MAAvB,CAAuC,gBAAvC,CAAgF,CACnF,GAAI,CAAA,eAAJ,CACA,GAAI,MAAM,EAAI,gBAAV,EAA8B,gBAAgB,CAAC,MAAjB,CAA0B,CAA5D,CAA+D,CAC3D,eAAe,CAAG,gBAAgB,CAAC,IAAjB,CAAsB,IAAI,EAAI,IAAI,CAAC,QAAL,CAAe,WAAf,KAAiC,MAAM,CAAC,WAAP,EAA/D,CAAlB,CACH,CAED,MAAO,CAAA,eAAe,EAAI,eAAe,CAAC,IAA1C,CACH,CAoGM,iBAAiB,EAAA,CACpB,GAAI,QAAQ,CAAC,SAAT,EAAsB,MAAM,CAAC,gBAAjC,CAAmD,CAC/C,MAAM,CAAC,gBAAP,CAAwB,QAAxB,CAAkC,KAAK,eAAvC,EACA,KAAK,eAAL,GACH,CACJ,CAEM,oBAAoB,EAAA,CACvB,GAAI,QAAQ,CAAC,SAAT,EAAsB,MAAM,CAAC,mBAAjC,CAAsD,CAClD,MAAM,CAAC,mBAAP,CAA2B,QAA3B,CAAqC,KAAK,eAA1C,EACH,CACJ,CAEM,MAAM,EAAA,CACT,KAAM,CAAE,aAAF,CAAiB,SAAjB,CAA4B,mBAA5B,EAAoD,KAAK,KAAL,CAAW,MAArE,CACA,KAAM,CAAE,SAAF,EAAgB,KAAK,KAA3B,CACA,KAAM,CAAA,QAAQ,CAAI,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,EAAwC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAqC,cAA9E,EAAiG,EAAlH,CACA,KAAM,CAAA,aAAa,CAAI,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,EAAwC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAqC,cAA9E,EAAiG,IAAvH,CACA,GAAI,CAAA,SAAS,CAAG,EAAhB,CACA,KAAM,CAAA,aAAa,CAAG,KAAK,KAAL,CAAW,OAAX,CAAmB,GAAnB,CAAuB,MAAvB,CAA8B,cAApD,CACA,KAAM,CAAA,SAAS,CAAG,mBAAmB,GAAK,aAAa,GAAK,MAAlB,EAA4B,aAAa,GAAK,iBAAnD,CAArC,CACA,GAAG,CAAC,QAAD,EAAa,QAAQ,CAAC,MAAT,GAAoB,CAApC,CAAuC,CACnC,SAAS,CAAG,KAAK,SAAL,GAAmB,UAAnB,CAA+B,SAAS,CAAC,0BAAzC,CAAsE,SAAS,CAAC,wBAA5F,CAEH,CACD,KAAM,CAAA,iBAAiB,cACnB,KAAA,CAAA,aAAA,CAAC,wBAAD,CAAyB,CACrB,QAAQ,CAAE,QADW,CAErB,OAAO,CAAE,KAAK,KAAL,CAAW,OAFC,CAGrB,aAAa,CAAE,aAHM,CAIrB,SAAS,CAAE,SAJU,CAKrB,UAAU,CAAE,KAAK,KAAL,CAAW,QALF,CAMrB,QAAQ,CAAE,KAAK,KAAL,CAAW,EANA,CAOrB,mBAAmB,CAAI,SAPF,CAQrB,gBAAgB,CAAE,KAAK,gBARF,CAAzB,CADJ,CAaA,KAAM,CAAA,gBAAgB,cAClB,KAAA,CAAA,aAAA,CAAC,uBAAD,CAAwB,CACpB,OAAO,CAAE,aADW,CAEpB,OAAO,CAAE,KAAK,KAAL,CAAW,OAFA,CAGpB,aAAa,CAAE,aAHK,CAIpB,SAAS,CAAE,SAJS,CAKpB,UAAU,CAAE,KAAK,KAAL,CAAW,QALH,CAMpB,QAAQ,CAAE,KAAK,KAAL,CAAW,EAND,CAOpB,gBAAgB,CAAE,KAAK,gBAPH,CAAxB,CADJ,CAYA,KAAM,CAAA,8BAA8B,gCAC7B,KAAK,KADwB,MAEhC,QAAQ,CAAE,iBAFsB,CAGhC,cAAc,CAAE,KAAK,mBAAL,EAHgB,CAIhC,iBAAiB,CAAE,CAAC,KAAK,KAAL,CAAW,MAAX,CAAkB,gBAAnB,EAAuC,KAAK,qBAAL,EAJ1B,CAKhC,UAAU,CAAE,KAAK,cAAL,EALoB,CAMhC,SAAS,CAAE,UAAU,CAAC,4BAAD,CAA+B,SAA/B,CANW,CAOhC,qBAAqB,CAAE,CACnB,WAAW,CAAE,KAAK,KADC,CAEnB,SAAS,CAAE,UAAU,CAAC,4BAAD,CAA+B,SAA/B,CAFF,CAPS,CAWhC,aAAa,CAAE,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,EAAwC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAqC,iBAArC,GAA2D,CAAnG,CAAuG,KAAK,mBAAL,EAAvG,CAAmI,IAXlH,CAYhC,UAAU,CAAE,KAAK,cAAL,EAZoB,CAahC,iBAAiB,CAAE,CAAE,SAAS,CAAE,sCAAb,CAba,CAchC,uBAAuB,CAAE,CAAC,SAAS,CAAE,6CAAZ,CAdO,CAehC,oBAAoB,CAAE,CAAC,SAAS,CAAE,kDAAZ,CAfU,CAgBhC,gCAAgC,CAAE,CAAC,SAAS,CAAE,oDAAZ,CAhBF,CAiBhC,aAAa,CAAE,KAAK,iBAAL,EAjBiB,CAkBhC,WAAW,CAAE,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,EAAwC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAqC,iBAArC,GAA2D,CAAnG,cAEL,KAAA,CAAA,aAAA,CAAC,WAAD,CAAY,CACR,IAAI,CAAE,SAAS,CAAC,UADR,CAER,SAAS,CAAE,SAAS,CAAC,UAFb,CAGR,QAAQ,CAAE,KAAK,eAHP,CAIR,OAAO,CAAE,KAAK,YAJN,CAKR,EAAE,CAAC,qBALK,CAAZ,CAFK,CASL,IA3BwB,CA4B/B,iBAAiB,CAAE,KAAK,qBAAL,EA5BY,CA6B/B,QAAQ,CAAE,KAAK,QA7BgB,CA8B/B,YAAY,CAAE,SAAS,eACnB,KAAA,CAAA,aAAA,CAAC,YAAD,CAAa,CAAC,IAAI,CAAE,SAAP,CAAb,CA/B2B,CAiC/B,sBAAsB,CAAE,CAAE,SAAS,CAAE,0BAAb,CAjCO,CAkC/B,kBAAkB,CAAE,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,EAAyC,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAqC,cAArC,GAAwD,IAAxD,EAAgE,KAAK,KAAL,CAAW,IAAX,CAAgB,aAAhB,CAA8B,MAA9B,CAAqC,cAArC,GAAwD,SAAjK,CAA8K,gBAA9K,CAAiM,IAlCtL,EAApC,CAoCA,MAAO,MAAK,KAAL,CAAW,UAAX,CAAsB,8BAAtB,CAAP,CACH,CAwVO,YAAY,EAAA,CAChB,KAAM,CAAE,OAAF,EAAc,KAAK,KAAzB,CAGA,GAAI,OAAO,CAAC,OAAR,EAAmB,OAAO,CAAC,OAAR,CAAgB,MAAnC,EAA6C,OAAO,CAAC,OAAR,CAAgB,MAAhB,CAAuB,IAAvB,GAAgC,QAAjF,CAA2F,CACvF,MAAO,IAAP,CACH,CAED,GAAI,QAAQ,CAAC,SAAT,EAAsB,MAAM,CAAC,UAAjC,CAA6C,CACzC,KAAM,CAAA,YAAY,CAAG,OAAO,CAAC,OAAR,CAAgB,YAArC,CACA,GAAI,YAAJ,CAAkB,CACd,GAAI,YAAY,CAAC,EAAb,EAAmB,MAAM,CAAC,UAAP,EAAqB,YAAY,CAAC,EAAb,CAAgB,CAA5D,CAA+D,CAC3D,MAAO,IAAP,CACH,CAFD,IAEO,IAAI,YAAY,CAAC,EAAb,EAAmB,MAAM,CAAC,UAAP,EAAqB,YAAY,CAAC,EAAb,CAAgB,CAA5D,CAA+D,CAClE,MAAO,IAAP,CACH,CAFM,IAEA,IAAI,YAAY,CAAC,EAAb,EAAmB,MAAM,CAAC,UAAP,EAAqB,YAAY,CAAC,EAAb,CAAgB,CAA5D,CAA+D,CAClE,MAAO,IAAP,CACH,CAFM,IAEA,IAAI,YAAY,CAAC,EAAb,EAAmB,MAAM,CAAC,UAAP,EAAqB,YAAY,CAAC,EAAb,CAAgB,CAA5D,CAA+D,CAClE,MAAO,IAAP,CACH,CAFM,IAEA,CACH,MAAO,IAAP,CACH,CACJ,CACJ,CAED,MAAO,IAAP,CACH,CAEO,YAAY,EAAA,CAChB,KAAK,QAAL,CAAc,CACV,WAAW,CAAE,CAAC,KAAK,KAAL,CAAW,WADf,CAAd,EAGH,CAEO,eAAe,EAAA,CACnB,KAAK,SAAL,CAAiB,KAAK,YAAL,EAAjB,CAEA,GAAI,KAAK,KAAL,CAAW,WAAX,EAA0B,CAAC,KAAK,QAApC,CAA8C,CAC1C,KAAK,YAAL,GACH,CACJ,CA1lBuJ,CAA5J,CAEc,UAAA,CAAA,CAAT,QAAS,CAAA,C,+BAAA,C,UAAA,CAET,IAFS,CAAA,CAeV,UAAA,CAAA,CADC,UACD,CAAA,C,+BAAA,C,WAAA,C,IAA4B,EAA5B,CAAA,CAjBiB,qBAAqB,CAAA,uBAAA,CAAA,UAAA,CAAA,CADzC,QACyC,CAAA,CAArB,qBAAqB,CAArB,C,cAAA,CAAA,qB","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getTelemetryObject, ILabeledDropdownOnChangeNotification, ILabeledDropdownOption, IModuleProps, INodeProps, ITelemetryContent, LabeledDropdown, UncontrolledPagination } from '@msdyn365-commerce-modules/utilities';\nimport { CategoryHierarchy as CategoryHierarchyData, IProductRefinerHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport MsDyn365 from '@msdyn365-commerce/core';\nimport { format, ProductRefinerValue, SortColumn, TextValueTranslation } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport { computed, observable, reaction, transaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { buildListPageUrl, getCollectionProducts, getCurrentUrl, GetFullProductsByCollectionInput, parseQueryParam, sortOptions, } from './actions';\nimport { ErrorMessage, FeatureSearchResultItem, getUpdatedRefinementCriteria, IChoiceSummaryClickNotification,\n     IRefineItemCommonProps, IRefineItemToggleNotification, ISearchResultModalViewProps, isMatchingRefinementCriterion, Link, ModalToggle, ProductSearchResultItems, SearchResultModal, Separator, Title } from './components';\nimport ChoiceSummary from './components/choice-summary';\nimport RefineSubmenu from './components/refine-submenu';\nimport { ISearchResultContainerData } from './search-result-container.data';\nimport { expandRefinersCount, ISearchResultContainerProps } from './search-result-container.props.autogenerated';\n\nexport interface ISearchResultContainerViewProps extends ISearchResultContainerProps<ISearchResultContainerData> {\n    products?: React.ReactNode;\n    className?: string;\n    SearchResultContainer: IModuleProps;\n    TitleViewProps: ITitleViewProps;\n    categoryHierarchy: ICategoryHierarchyViewProps;\n    pagination?: React.ReactNode;\n    ProductsContainer: INodeProps;\n    ProductSectionContainer: INodeProps;\n    refineMenu: IRefineMenuViewProps;\n    sortByOptions: ISortByViewProps;\n    choiceSummary?: React.ReactNode;\n    modalToggle: React.ReactNode;\n    searchResultModal: ISearchResultModalViewProps;\n    isMobile: boolean;\n    CategoryNavContainer: INodeProps;\n    RefineAndProductSectionContainer: INodeProps;\n    errorMessage: React.ReactNode;\n    FeatureSearchContainer: INodeProps;\n    similarLookProduct?: React.ReactNode;\n}\n\nexport interface ITitleViewProps {\n    TitleContainer: INodeProps;\n    title:ISearchResultTitle;\n}\n\nexport interface IRefineMenuViewProps {\n    RefineMenuContainer: INodeProps;\n    RefinerSectionContainer: INodeProps;\n    refiners?: React.ReactNode[];\n}\n\nexport interface ICategoryHierarchyViewProps {\n    categoryHierarchyList?: React.ReactNode[];\n    categoryHierarchySeparator?: React.ReactNode;\n    CategoryHierarchyContainer: INodeProps;\n}\n\nexport interface ISortByViewProps {\n    SortingContainer: INodeProps;\n    sortByDropDown?:React.ReactNode;\n}\n\nexport type GridSize = 'xs' | 'sm' | 'md' | 'lg' | 'xl';\n\n/**\n * Title component for search result container\n */\nexport interface ISearchResultTitle {\n    titlePrefix?: React.ReactNode;\n    titleText?: React.ReactNode;\n    titleCount?: React.ReactNode;\n}\n\nexport interface ISearchResultContainerState {\n    sortingState: ISortByCollectionState;\n    modalIsOpen: boolean;\n}\n\ninterface ISortByCollectionState {\n    selectedSortByOption: ILabeledDropdownOption;\n    pending: boolean;\n}\n\n/**\n *\n * SearchResultContainer component\n * @extends {React.PureComponent<ISearchResultContainerProps<ISearchResultContainerData>>}\n */\n@observer\nexport default class SearchResultContainer extends React.PureComponent<ISearchResultContainerProps<ISearchResultContainerData>, ISearchResultContainerState> {\n\n    @computed get isMobile(): boolean {\n        return (this._viewport === 'xs' || this._viewport === 'sm');\n    }\n\n    private sortByDropdownOptions: ILabeledDropdownOption[] = [\n        { key: sortOptions.sortByOptionRelevanceDesc, value: this.props.resources.sortByOptionRelevanceDesc },\n        { key: sortOptions.sortByOptionNameAsc, value: this.props.resources.sortByOptionNameAsc },\n        { key: sortOptions.sortByOptionNameDesc, value: this.props.resources.sortByOptionNameDesc },\n        { key: sortOptions.sortByOptionPriceAsc, value: this.props.resources.sortByOptionPriceAsc },\n        { key: sortOptions.sortByOptionPriceDesc, value: this.props.resources.sortByOptionPriceDesc },\n        { key: sortOptions.sortByOptionRatingDesc, value: this.props.resources.sortByOptionRatingDesc },\n    ];\n    private _refineItemCommonProps: IRefineItemCommonProps;\n    private _pageType: string | undefined = this.props.context.request.urlTokens.pageType;\n    @observable\n    private _viewport: GridSize;\n\n    private _modalToggleRef: React.RefObject<HTMLButtonElement>;\n    private _sortAndFilterContainerRef: React.RefObject<LabeledDropdown>;\n    private expandrefinerCount: number = 0;\n    private telemetryContent: ITelemetryContent;\n\n    public static getFriendlyName(locale: string, nameTranslations?: TextValueTranslation[]): string | undefined {\n        let nameTranslation: TextValueTranslation | undefined;\n        if (locale && nameTranslations && nameTranslations.length > 0) {\n            nameTranslation = nameTranslations.find(item => item.Language!.toLowerCase() === locale.toLowerCase());\n        }\n\n        return nameTranslation && nameTranslation.Text;\n    }\n\n    constructor(props: ISearchResultContainerProps<ISearchResultContainerData>, state: ISearchResultContainerState) {\n        super(props);\n        this._viewport = props.context.request && props.context.request.device && props.context.request.device.Type === 'Mobile' ? 'xs' : 'lg';\n        this._modalToggleRef = React.createRef<HTMLButtonElement>();\n        this._sortAndFilterContainerRef = React.createRef<LabeledDropdown>();\n        this._toggleModal = this._toggleModal.bind(this);\n        this._updateViewport = this._updateViewport.bind(this);\n        this.state = {\n            sortingState: {\n                pending: false,\n                selectedSortByOption: this.sortByDropdownOptions[0]\n            },\n            modalIsOpen: false\n        };\n        const {\n            placeholderTextMax,\n            minLabel,\n            maxLabel,\n            rangeNameFormat\n        } = this.props.resources;\n\n        const locale = this.props.context.request.locale;\n        const telemetry = this.props.telemetry;\n        const validationErrorNaN = this.props.resources.validationErrorNotNumber;\n        const validationErrorRange = this.props.resources.validationErrorNotRange;\n        this._refineItemCommonProps = {\n            telemetry,\n            locale,\n            placeholderTextMax,\n            minLabel,\n            maxLabel,\n            rangeNameFormat,\n            validationErrorNaN,\n            validationErrorRange\n        };\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!,\n                                                   this.props.friendlyName,\n                                                   this.props.telemetry);\n\n        // Initalization of list page\n        this.props.data.products.then((products) => {\n            this.props.data.listPageState.then((listPageState) => {\n                if (this._pageType === 'Category') {\n                    listPageState.pageType = 'Category';\n                } else {\n                    listPageState.pageType = 'Search';\n                }\n\n                let querySorting: SortColumn[] = [];\n\n                if (this.props.context.request.query && this.props.context.request.query.sorting) {\n                    querySorting = JSON.parse(decodeURIComponent(this.props.context.request.query.sorting)) as SortColumn[];\n                }\n\n                listPageState.currentPageNumber = this.props.context.request.query && (+this.props.context.request.query.skip / (this.props.config.itemsPerPage || 10)) || 0;\n                listPageState.sortingCritera = { Columns: querySorting };\n                listPageState.pageSize = this.props.config.itemsPerPage || 10;\n                listPageState.activeProducts = products.products;\n                listPageState.totalProductCount = products.count;\n\n                // Initialize reaction based on listPageState properties\n                reaction(\n                    () => {\n                        return [listPageState.activeFilters && listPageState.activeFilters.length, listPageState.currentPageNumber, listPageState.sortingCritera && listPageState.sortingCritera.Columns && listPageState.sortingCritera.Columns.length];\n                    },\n                    () => {\n                        const input = new GetFullProductsByCollectionInput(\n                            listPageState.pageType,\n                            this.props.context.request.apiSettings,\n                            { Paging: { Top: this.props.config.itemsPerPage, Skip: Math.max((listPageState.pageSize * (listPageState.currentPageNumber || 0)), 0) }, count: true, Sorting: listPageState.sortingCritera || {} },\n                            listPageState.activeFilters || [],\n                            +(this.props.context.request.urlTokens.itemId || 0),\n                            this.props.context.request.query && this.props.context.request.query.q ? this.props.context.request.query.q : this.props.context.request.query?.productId,\n                            this.props && this.props.config && this.props.config.includeAttributes !== undefined && this.props.config.includeAttributes === true ? true : false,\n                            this.props.context.request.locale\n                            );\n\n                        getCollectionProducts(input, this.props.context.actionContext).then(productResults => {\n                            listPageState.activeProducts = productResults.products;\n                            listPageState.totalProductCount = productResults.count;\n                        });\n                    }\n                );\n\n            });\n        });\n\n        if (this.props.context.request.query?.productId) {\n            this.props.data.featureProduct.then((products) => {\n                this.props.data.listPageState.then((listPageStateFeature) => {\n                    listPageStateFeature.featureProduct = products;\n\n                });\n            });\n    }\n        this._updateViewport();\n    }\n\n    public componentDidMount(): void {\n        if (MsDyn365.isBrowser && window.addEventListener) {\n            window.addEventListener('resize', this._updateViewport);\n            this._updateViewport();\n        }\n    }\n\n    public componentWillUnmount(): void {\n        if (MsDyn365.isBrowser && window.removeEventListener) {\n            window.removeEventListener('resize', this._updateViewport);\n        }\n    }\n\n    public render(): JSX.Element {\n        const { imageSettings, className, allowBackNavigation } = this.props.config;\n        const { resources } = this.props;\n        const products = (this.props.data.listPageState.result && this.props.data.listPageState.result.activeProducts) || [];\n        const searchProduct = (this.props.data.listPageState.result && this.props.data.listPageState.result.featureProduct) || null;\n        let errorText = '';\n        const breaCrumbType = this.props.context.app.config.breadcrumbType;\n        const allowBack = allowBackNavigation && (breaCrumbType === 'back' || breaCrumbType === 'categoryAndBack');\n        if(!products || products.length === 0) {\n            errorText = this._pageType === 'Category'? resources.resultCategoryNotFoundText : resources.resultSearchNotFoundText;\n\n        }\n        const productsComponent = (\n            <ProductSearchResultItems\n                products={products}\n                context={this.props.context}\n                imageSettings={imageSettings}\n                resources={resources}\n                moduleType={this.props.typeName}\n                moduleId={this.props.id}\n                allowBackNavigation = {allowBack}\n                telemetryContent={this.telemetryContent}\n            />\n        );\n\n        const featureComponent = (\n            <FeatureSearchResultItem\n                product={searchProduct}\n                context={this.props.context}\n                imageSettings={imageSettings}\n                resources={resources}\n                moduleType={this.props.typeName}\n                moduleId={this.props.id}\n                telemetryContent={this.telemetryContent}\n            />\n        );\n\n        const searchResultContainerViewProps = {\n            ...this.props,\n            products: productsComponent,\n            TitleViewProps: this._getCollectionTitle(),\n            categoryHierarchy: !this.props.config.disableHierarchy && this._getCategoryHierarchy(),\n            refineMenu: this._getRefineMenu(),\n            className: classnames('ms-search-result-container', className),\n            SearchResultContainer: {\n                moduleProps: this.props,\n                className: classnames('ms-search-result-container', className)\n            },\n            sortByOptions: this.props.data.listPageState.result && this.props.data.listPageState.result.totalProductCount !== 0 ? this._getSortingDropDown(): null,\n            pagination: this._getPagination(),\n            ProductsContainer: { className: 'ms-search-result-container__Products' },\n            ProductSectionContainer: {className: 'ms-search-result-container__product-section'},\n            CategoryNavContainer: {className: 'ms-search-result-container__category-nav-section'},\n            RefineAndProductSectionContainer: {className: 'ms-search-result-container__refine-product-section'},\n            choiceSummary: this._getChoiceSummary(),\n            modalToggle: this.props.data.listPageState.result && this.props.data.listPageState.result.totalProductCount !== 0 ?\n                (\n                    <ModalToggle\n                        text={resources.modalTitle}\n                        ariaLabel={resources.modalTitle}\n                        innerRef={this._modalToggleRef}\n                        onClick={this._toggleModal}\n                        id='search-result-modal'\n                    />\n                ) : null,\n             searchResultModal: this._getSearchResultModal(),\n             isMobile: this.isMobile,\n             errorMessage: errorText && (\n                 <ErrorMessage text={errorText} />\n             ),\n             FeatureSearchContainer: { className: 'ms-feature-search-result' },\n             similarLookProduct: this.props.data.listPageState.result && (this.props.data.listPageState.result.featureProduct !== null && this.props.data.listPageState.result.featureProduct !== undefined) ? featureComponent : null\n        };\n        return this.props.renderView(searchResultContainerViewProps) as React.ReactElement;\n    }\n\n    private _getSearchResultModal = (): ISearchResultModalViewProps => {\n        const {resources} = this.props;\n        return SearchResultModal(\n            {\n           resources:{\n               modalCloseButtonText: resources.modalCloseButtonText,\n               modalTitle: resources.modalTitle\n           },\n           isOpen:this.state.modalIsOpen,\n           returnRef: this._modalToggleRef,\n           onModalToggle: this._toggleModal\n        });\n    }\n\n    private _getCollectionTitle = (): ITitleViewProps => {\n        const { data, context, resources } = this.props;\n\n        let collectionTitle: string | undefined = '';\n        if (context && context.request && context.request.query && context.request.query.q) {\n            collectionTitle = `\"${context.request.query.q}\"`;\n        } else {\n            collectionTitle = (data.category.result && SearchResultContainer.getFriendlyName(context.request.locale, data.category.result.NameTranslations)) ||\n                (data.category.result && data.category.result.Name);\n        }\n        let productCountText = '';\n        let productCountNumber: number | undefined;\n        if (data.listPageState && data.listPageState.result && data.listPageState.result.totalProductCount !== undefined) {\n            productCountNumber = data.listPageState.result.totalProductCount;\n        } else if (data.products && data.products.result) {\n            productCountNumber = data.products.result.count;\n        }\n\n        if (productCountNumber && productCountNumber !== 0) {\n            productCountText = productCountNumber !== 1 ? format(this.props.resources.numberOfProducts, productCountNumber) : this.props.resources.oneProduct;\n        } else {\n            productCountText = format(this.props.resources.numberOfProducts, 0);\n        }\n        const titlePrefix = <Title className='ms-search-result__collection-title-prefix' text={resources.searchTextPrefix} />;\n        const titleText = collectionTitle && <Title className='ms-search-result__collection-title-text' text={collectionTitle} />;\n        const titleCount = <Title className='ms-search-result__collection-title-count' text={productCountText} />;\n\n        return {\n            TitleContainer: { className: 'ms-search-result-container__title' },\n            title:{\n            titlePrefix: titlePrefix,\n            titleText: titleText,\n            titleCount: titleCount\n            }\n        };\n\n    }\n    private _getCategoryHierarchy = (): ICategoryHierarchyViewProps => {\n        const { data } = this.props;\n        const categoryHierarchy = data.categoryHierarchy.result;\n        const categoryLinks =\n            categoryHierarchy && categoryHierarchy.map((value: CategoryHierarchyData, index: number) => {\n\n                return (\n                    <Link\n                        key={index}\n                        text={value.Name}\n                        ariaLabel={`${this.props.resources.categoryLinkAriaLabel} ${value.Name}`}\n                        href={value.Url}\n                    />\n                );\n            });\n        const categoryLinkSeparator = <Separator separator='/' />;\n\n        return {\n            CategoryHierarchyContainer: { tag: 'nav', className: 'ms-search-result-container__category-hierarchy' },\n            categoryHierarchyList: categoryLinks,\n            categoryHierarchySeparator: categoryLinkSeparator\n        };\n\n    }\n\n    private _getSortingDropDown = (): ISortByViewProps => {\n        const { resources } = this.props;\n        const activeDropdown = this._getCurrentlySelectedOption() || this.state.sortingState.selectedSortByOption;\n        const dropdown = (\n        <LabeledDropdown\n            labelClassname='reviews-list-sort-by'\n            labelText={resources.sortByDropdownLabel}\n            dropdownId='categorySortByDropdown'\n            dropdownClassname='reviews-list-dropdown'\n            toggleColor='link'\n            dropdownOptions={this.sortByDropdownOptions}\n            selectedOption={activeDropdown}\n            onSelectOption={this._updateSortByDropdown}\n            ref={this._sortAndFilterContainerRef}\n        />);\n        return {\n            SortingContainer: { className: 'ms-search-result-container__Sort-by-category' },\n            sortByDropDown:dropdown\n        };\n    }\n\n    private _getPagination = (): React.ReactNode => {\n        const { config, context, data, resources } = this.props;\n        const listPageState = data && data.listPageState && data.listPageState.result;\n        const fullUrl = getCurrentUrl(context.request);\n        const itemsPerPage = config.itemsPerPage || 10;\n        const skipCount = listPageState && listPageState.currentPageNumber !== null ?\n            (listPageState.currentPageNumber * (this.props.config.itemsPerPage || 10)) :\n            ((this.props.context.request.query && +this.props.context.request.query.skip) || 0);\n        const totalItems = listPageState && listPageState.totalProductCount || 0;\n        const previousText = resources.flipperPrevious;\n        const nextText = resources.flipperNext;\n        if (totalItems <= itemsPerPage) {\n            return null;\n        }\n        return (\n        <UncontrolledPagination\n            className='ms-search-result-container__pagination'\n            role='navigation'\n            aria-label={resources.paginationAriaLabel}\n            url={fullUrl.href}\n            qsp={'skip'}\n            items={totalItems}\n            itemsPerPage={itemsPerPage}\n            startingItem={skipCount}\n            previousText={<div className='msc-pagination__prev'><span className='ms-search-result__pagination-left' aria-hidden='true'/><span className='prev-text'>{previousText}</span></div>}\n            nextText={<div className='msc-pagination__next'><span className='next-text'>{nextText}</span><span className='ms-search-result__pagination-right' aria-hidden='true'/></div>}\n            previousAriaLabel={previousText}\n            nextAriaLabel={nextText}\n            telemetryContent={this.telemetryContent}\n        />);\n    }\n\n    private _getRefineMenu = (): IRefineMenuViewProps => {\n        const { data, context, config } = this.props;\n        const tempRangeTypeTODO = context.request.query && context.request.query.inputRange ? 'input' : 'slider';\n        const validRefiners = data.refiners.result && data.refiners.result.filter(refiner => {\n            return refiner.Values.length > 0;\n        });\n\n        const activeRefiners = (data.listPageState.result && data.listPageState.result.activeFilters) || [];\n\n        this._getexpandRefinerCount(config.expandRefinersCount);\n        const refinelist = this.expandrefinerCount === undefined ? 0 :  this.expandrefinerCount;\n        const expandedRefiners = refinelist === 0 ? validRefiners && validRefiners.length: refinelist;\n        const subMenus = validRefiners && validRefiners.map((productRefinerHierarchy: IProductRefinerHierarchy, index: number) => {\n            return (data.listPageState.result!.totalProductCount !== 0 ?\n                (\n                <RefineSubmenu\n                    productRefinerHierarchy={productRefinerHierarchy}\n                    selectedRefinerValues={activeRefiners}\n                    refineItemCommonProps={this._refineItemCommonProps}\n                    minValueSliderThumbAriaLabel={this.props.resources.minValueSliderThumbAriaLabel}\n                    maxValueSliderThumbAriaLabel={this.props.resources.maxValueSliderThumbAriaLabel}\n                    key={index}\n                    onUpdateRefiners={this._onUpdateRefiners}\n                    urlBuilder={this._buildRefinerUrl}\n                    isDisabled={false}\n                    isExpandedOnInitialLoad={expandedRefiners && expandedRefiners > index ? true : false}\n                    tempRangeTypeTODO={tempRangeTypeTODO}\n                    context = {context}\n                    moduleId={this.props.id}\n                    moduleTypeName={this.props.typeName}\n                    telemetryContent={this.telemetryContent}\n                />) : null\n            );\n        });\n\n        return {\n            RefineMenuContainer:{className: 'ms-search-result-container__refine-menu' },\n            RefinerSectionContainer:{className: 'ms-search-result-container__refiner-section'},\n            refiners: subMenus\n        };\n\n    }\n\n    private _getChoiceSummary = (): React.ReactNode => {\n        const { resources, data, telemetry } = this.props;\n        const selectedRefiners = (data.listPageState.result && data.listPageState.result.activeFilters) || [];\n        return (\n            <ChoiceSummary\n                classNames='ms-choice-summary-by-category'\n                clearAllText={resources.clearAllText}\n                label={resources.choiceSummaryLabel}\n                selectedChoices={selectedRefiners}\n                // @ts-ignore: NOTE Type-unsafe line below, null refinersByCategoryHierarchy case not handled\n                refinerHierarchy={data.refiners.result}\n                choiceFormat={resources.choiceFormat}\n                choiceRangeValueFormat={resources.choiceRangeValueFormat}\n                telemetry={telemetry}\n                onChoiceClicked={this._onChoiceClicked}\n                urlBuilder={this._buildRefinerUrlForChoiceSummary}\n                choiceAriaLabel={resources.choiceAriaLabel}\n                telemetryContent={this.telemetryContent}\n            />\n        );\n\n    }\n\n    private _updateSortByDropdown = (notification: ILabeledDropdownOnChangeNotification): void => {\n        const { context } = this.props;\n        const requestContext = context && context.request;\n        const actionContext = context && context.actionContext;\n\n        if (!requestContext || !actionContext || !this.props.data.listPageState.result) {\n            const error = `[sort-by-category] cannot sort without context: ${!requestContext ? 'requestContext ' : ''} ${!actionContext ? 'actionContext ' : ''} could not be found`;\n            this.props.telemetry.warning(error);\n        }\n\n        window.history.pushState({}, '', buildListPageUrl(getCurrentUrl(this.props.context.request), undefined, [this._getSortColumnFromSelectedOption(notification.selectedOption)], undefined));\n        transaction(() => {\n            this.props.data.listPageState.result!.currentPageNumber = 0;\n            this.props.data.listPageState.result!.sortingCritera = { Columns: [this._getSortColumnFromSelectedOption(notification.selectedOption)] };\n        });\n    }\n\n    private _getSortColumnFromSelectedOption = (option: ILabeledDropdownOption): SortColumn => {\n        const { data } = this.props;\n\n        if (!data.searchConfiguration.result) {\n            return {};\n        }\n\n        const mappedConfiguration = data.searchConfiguration.result.find((searchConfiguration) => { return searchConfiguration.key === option.key; });\n\n        if (mappedConfiguration) {\n            return mappedConfiguration.sortColumn;\n        }\n\n        return {};\n    }\n\n    private _getCurrentlySelectedOption = (): ILabeledDropdownOption | undefined => {\n        const { data } = this.props;\n        const sortCriteria = data.listPageState.result && data.listPageState.result.sortingCritera;\n\n        const activeSortColumn =\n            (sortCriteria && sortCriteria.Columns && sortCriteria.Columns[0]) ||\n            (parseQueryParam<SortColumn[]>('sorting', this.props.context.request) || [])[0];\n\n        if (activeSortColumn && data.searchConfiguration.result) {\n            const activeMappedConfig = data.searchConfiguration.result.find((mappedSearchConfig) => {\n                return (mappedSearchConfig.sortColumn.ColumnName === activeSortColumn.ColumnName) &&\n                    (mappedSearchConfig.sortColumn.IsDescending === activeSortColumn.IsDescending);\n            });\n            if (activeMappedConfig) {\n                return this.sortByDropdownOptions.find((dropdownOption) => dropdownOption.key === activeMappedConfig.key);\n            }\n        }\n\n        return;\n    }\n\n    private _onUpdateRefiners = (itemToggleNotification: IRefineItemToggleNotification): void => {\n        const { context } = this.props;\n        const requestContext = context && context.request;\n        const actionContext = context && context.actionContext;\n\n        if (!requestContext || !actionContext || !this.props.data.listPageState.result) {\n            const error = `Refine menu cannot refine search criteria: ${!requestContext ? 'requestContext ' : ''} ${!actionContext ? 'actionContext ' : ''} could not be found`;\n            this.props.telemetry.warning(error);\n        }\n\n        const updatedRefinementCriteria = getUpdatedRefinementCriteria(itemToggleNotification, this.props.data.listPageState.result && this.props.data.listPageState.result.activeFilters || []);\n\n        window.history.pushState({}, '', buildListPageUrl(getCurrentUrl(this.props.context.request), updatedRefinementCriteria));\n        transaction(() => {\n            this.props.data.listPageState.result!.currentPageNumber = 0;\n            this.props.data.listPageState.result!.activeFilters = updatedRefinementCriteria;\n        });\n    }\n\n    private _buildRefinerUrl = (itemToggleNotification: IRefineItemToggleNotification): string => {\n        if (this.props.data.listPageState.result) {\n            const newRefinementCriteria = getUpdatedRefinementCriteria(itemToggleNotification, this.props.data.listPageState.result.activeFilters || []);\n\n            return buildListPageUrl(getCurrentUrl(this.props.context.request), newRefinementCriteria);\n        } else {\n            this.props.telemetry.warning(`[buildRefinerQueryString]List Page State Not available, unable to build refiner URL`);\n            return '';\n        }\n    }\n\n    private _onChoiceClicked = (notification: IChoiceSummaryClickNotification): void => {\n        const { data, telemetry } = this.props;\n\n        if (!data.listPageState.result) {\n            telemetry.warning('[choice-summary-by-category._onChoiceClicked]ListPageState unavailable, unable to update refiners.');\n            return;\n        }\n\n        let currentRefinementCriteria = (data.listPageState.result && data.listPageState.result.activeFilters) || [];\n\n        if (!notification.clearAll) {\n            const selectedChoice = notification.choiceClicked;\n            if (!selectedChoice) {\n                telemetry.warning('[choice-summary-by-category._onChoiceClicked] Choice could not be determined');\n                return;\n            }\n            currentRefinementCriteria = currentRefinementCriteria.filter(\n                (selectedCriterion: ProductRefinerValue) => !isMatchingRefinementCriterion(selectedChoice, selectedCriterion)\n            );\n        } else {\n            currentRefinementCriteria = [];\n\n            // set focus to sort and filter\n            const dropdownElementId = this._sortAndFilterContainerRef.current && this._sortAndFilterContainerRef.current.props.dropdownId;\n            const dropdownElement = dropdownElementId && document.getElementById(dropdownElementId);\n            setTimeout(() => {\n                dropdownElement && dropdownElement.focus();\n            },\n                       50);\n        }\n\n        const fullUrl = getCurrentUrl(this.props.context.request);\n        window.history.pushState({}, '', buildListPageUrl(fullUrl, currentRefinementCriteria));\n        data.listPageState.result.currentPageNumber = 0;\n        data.listPageState.result.activeFilters = currentRefinementCriteria;\n    }\n\n    private _buildRefinerUrlForChoiceSummary = (selectedRefiner: ProductRefinerValue, isClearAll: boolean): string => {\n        const { data, telemetry } = this.props;\n        const fullUrl = getCurrentUrl(this.props.context.request);\n\n        if (!data.listPageState.result) {\n            telemetry.warning('[choice-summary-by-category._buildRefinerUrl]ListPageState unavailable, unable to create refiner URL.');\n            return fullUrl.href;\n        }\n\n        let currentRefinementCriteria = (data.listPageState.result && data.listPageState.result.activeFilters) || [];\n\n        if (!isClearAll) {\n            if (!selectedRefiner) {\n                telemetry.warning('[choice-summary-by-category._buildRefinerUrl] URL for Choice could not be determined');\n                return fullUrl.href;\n            }\n            currentRefinementCriteria = currentRefinementCriteria.filter(\n                (selectedCriterion: ProductRefinerValue) => !isMatchingRefinementCriterion(selectedRefiner, selectedCriterion)\n            );\n        } else {\n            currentRefinementCriteria = [];\n        }\n\n        return buildListPageUrl(fullUrl, currentRefinementCriteria);\n    }\n\n    private _getViewport(): GridSize {\n        const { context } = this.props;\n\n        // always render in mobile viewport on a mobile device\n        if (context.request && context.request.device && context.request.device.Type === 'Mobile') {\n            return 'xs';\n        }\n\n        if (MsDyn365.isBrowser && window.innerWidth) {\n            const gridSettings = context.request.gridSettings;\n            if (gridSettings) {\n                if (gridSettings.xs && window.innerWidth <= gridSettings.xs.w) {\n                    return 'xs';\n                } else if (gridSettings.sm && window.innerWidth <= gridSettings.sm.w) {\n                    return 'sm';\n                } else if (gridSettings.md && window.innerWidth <= gridSettings.md.w) {\n                    return 'md';\n                } else if (gridSettings.lg && window.innerWidth <= gridSettings.lg.w) {\n                    return 'lg';\n                } else {\n                    return 'xl';\n                }\n            }\n        }\n\n        return 'lg';\n    }\n\n    private _toggleModal(): void {\n        this.setState({\n            modalIsOpen: !this.state.modalIsOpen\n        });\n    }\n\n    private _updateViewport(): void {\n        this._viewport = this._getViewport();\n\n        if (this.state.modalIsOpen && !this.isMobile) {\n            this._toggleModal();\n        }\n    }\n\n    private _getexpandRefinerCount = (refinerCount?: expandRefinersCount): void => {\n        switch(refinerCount) {\n            case expandRefinersCount.all:\n                this.expandrefinerCount = 0;\n                break;\n            case expandRefinersCount.one:\n                this.expandrefinerCount = 1;\n                break;\n            case expandRefinersCount.two:\n               this.expandrefinerCount = 2;\n               break;\n            case expandRefinersCount.three:\n                this.expandrefinerCount = 3;\n                break;\n            case expandRefinersCount.four:\n                this.expandrefinerCount = 4;\n                break;\n            default:\n                this.expandrefinerCount = 0;\n        }\n    }\n\n}\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}