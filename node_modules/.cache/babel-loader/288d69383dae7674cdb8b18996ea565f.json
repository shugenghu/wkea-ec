{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol===\"undefined\"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}import{createObservableDataAction}from'@msdyn365-commerce/core';import getSelectedVariant,{SelectedVariantInput}from'./get-selected-variant';import{getSelectedProductIdFromActionInput}from'./utilities/utils';import{getDimensionValuesAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';/**\r\n * Input class for the getDimensionsForSelectedVariant data action\r\n */export var GetDimensionsForSelectedVariantInput=function GetDimensionsForSelectedVariantInput(productId,channelId,matchingDimensionValues){_classCallCheck(this,GetDimensionsForSelectedVariantInput);this.getCacheKey=function(){return\"DimensionsForSelectedVariant\";};this.getCacheObjectType=function(){return'DimensionsForSelectedVariantInput';};this.dataCacheType=function(){return'none';};this.productId=productId;this.channelId=channelId;this.matchingDimensionValues=matchingDimensionValues||[];};/**\r\n * Create input method for the getDimensionsForSelectedVariant data action\r\n * @param inputData The input data passed to the createInput method\r\n */var createDimensionsForSelectedVariantInput=function createDimensionsForSelectedVariantInput(inputData){var productId=getSelectedProductIdFromActionInput(inputData);if(productId){return new GetDimensionsForSelectedVariantInput(+productId,+inputData.requestContext.apiSettings.channelId,[]);}else{throw new Error('Unable to create DimensionsForSelectedVariantInput, no productId found on module config or query');}};/**\r\n * Action Method for the getDimensionsForSelectedVariant Data Action\r\n */function getDimensionsForSelectedVariantAction(_x,_x2){return _getDimensionsForSelectedVariantAction.apply(this,arguments);}/**\r\n * The GetDimensionsForSelectedVariantDataAction\r\n * Get the currently selected Variant via the getSelectedVariant data action, and the gets the\r\n * available product dimensions for the variant via the getDimensionValues RetailServer API\r\n */function _getDimensionsForSelectedVariantAction(){_getDimensionsForSelectedVariantAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var selectedVariantInput,activeProduct,results,_iterator,_step,_loop;return _regeneratorRuntime.wrap(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:selectedVariantInput=new SelectedVariantInput(input.productId,input.channelId,input.matchingDimensionValues);_context2.next=3;return getSelectedVariant(selectedVariantInput,ctx);case 3:activeProduct=_context2.sent;if(!(activeProduct&&activeProduct.Dimensions&&activeProduct.Dimensions.length>0)){_context2.next=23;break;}results=[];_iterator=_createForOfIteratorHelper(activeProduct.Dimensions);_context2.prev=7;_loop=/*#__PURE__*/_regeneratorRuntime.mark(function _loop(){var dimension,dimensionValues,fullDimension;return _regeneratorRuntime.wrap(function _loop$(_context){while(1){switch(_context.prev=_context.next){case 0:dimension=_step.value;_context.next=3;return getDimensionValuesAsync({callerContext:ctx,queryResultSettings:{}},activeProduct.MasterProductId?activeProduct.MasterProductId:activeProduct.RecordId,input.channelId,dimension.DimensionTypeValue,input.matchingDimensionValues.filter(function(value){return value.DimensionTypeValue!==dimension.DimensionTypeValue;}),// @ts-ignore: KitVariantResolution context should be nullable\nnull);case 3:dimensionValues=_context.sent;fullDimension=_objectSpread(_objectSpread({},dimension),{},{DimensionValues:dimensionValues});results.push(fullDimension);case 6:case\"end\":return _context.stop();}}},_loop);});_iterator.s();case 10:if((_step=_iterator.n()).done){_context2.next=14;break;}return _context2.delegateYield(_loop(),\"t0\",12);case 12:_context2.next=10;break;case 14:_context2.next=19;break;case 16:_context2.prev=16;_context2.t1=_context2[\"catch\"](7);_iterator.e(_context2.t1);case 19:_context2.prev=19;_iterator.f();return _context2.finish(19);case 22:return _context2.abrupt(\"return\",results);case 23:return _context2.abrupt(\"return\",[]);case 24:case\"end\":return _context2.stop();}}},_callee,null,[[7,16,19,22]]);}));return _getDimensionsForSelectedVariantAction.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/get-dimensions/for-selected-variant',action:getDimensionsForSelectedVariantAction,input:createDimensionsForSelectedVariantInput});","map":{"version":3,"sources":["../../src/get-dimensions-for-selected-variant.ts"],"names":[],"mappings":"+5EAEA,OAAS,0BAAT,KAAiF,yBAAjF,CAEA,MAAO,CAAA,kBAAP,EAA6B,oBAA7B,KAAyD,wBAAzD,CACA,OAAS,mCAAT,KAAoD,mBAApD,CAEA,OAAS,uBAAT,KAAwC,wEAAxC,CAEA;;AAEG,GACH,UAAa,CAAA,oCAAb,CAKI,8CAAY,SAAZ,CAA+B,SAA/B,CAAkD,uBAAlD,CAA8F,4DAMvF,KAAA,WAAA,CAAc,iDAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,mCAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,MAAjB,EAAhB,CAPH,KAAK,SAAL,CAAiB,SAAjB,CACA,KAAK,SAAL,CAAiB,SAAjB,CACA,KAAK,uBAAL,CAA+B,uBAAuB,EAAI,EAA1D,CACH,CATL,CAgBA;;;AAGG,GACH,GAAM,CAAA,uCAAuC,CAAG,QAA1C,CAAA,uCAA0C,CAAC,SAAD,CAA0E,CACtH,GAAM,CAAA,SAAS,CAAG,mCAAmC,CAAC,SAAD,CAArD,CAEA,GAAI,SAAJ,CAAe,CACX,MAAO,IAAI,CAAA,oCAAJ,CAAyC,CAAC,SAA1C,CAAqD,CAAC,SAAS,CAAC,cAAV,CAAyB,WAAzB,CAAqC,SAA3F,CAAsG,EAAtG,CAAP,CACH,CAFD,IAEO,CACH,KAAM,IAAI,CAAA,KAAJ,CAAU,kGAAV,CAAN,CACH,CACJ,CARD,CAUA;;AAEG,G,QACY,CAAA,qC,8EAoCf;;;;AAIG,G,iJAxCH,iBACI,KADJ,CAEI,GAFJ,0LAIU,oBAJV,CAIiC,GAAI,CAAA,oBAAJ,CAAyB,KAAK,CAAC,SAA/B,CAA0C,KAAK,CAAC,SAAhD,CAA2D,KAAK,CAAC,uBAAjE,CAJjC,wBAMsD,CAAA,kBAAkB,CAAC,oBAAD,CAAuB,GAAvB,CANxE,QAMU,aANV,qBAQQ,aAAa,EAAI,aAAa,CAAC,UAA/B,EAA6C,aAAa,CAAC,UAAd,CAAyB,MAAzB,CAAkC,CARvF,4BASc,OATd,CASgD,EAThD,sCAWgC,aAAa,CAAC,UAX9C,0OAWmB,SAXnB,mCAY0C,CAAA,uBAAuB,CACjD,CAAE,aAAa,CAAE,GAAjB,CAAsB,mBAAmB,CAAE,EAA3C,CADiD,CAEjD,aAAa,CAAC,eAAd,CAAgC,aAAa,CAAC,eAA9C,CAAgE,aAAa,CAAC,QAF7B,CAGjD,KAAK,CAAC,SAH2C,CAIjD,SAAS,CAAC,kBAJuC,CAKjD,KAAK,CAAC,uBAAN,CAA8B,MAA9B,CAAqC,SAAA,KAAK,QAAI,CAAA,KAAK,CAAC,kBAAN,GAA6B,SAAS,CAAC,kBAA3C,EAA1C,CALiD,CAMjD;AACA,IAPiD,CAZjE,QAYkB,eAZlB,eAsBkB,aAtBlB,gCAuBmB,SAvBnB,MAwBgB,eAAe,CAAE,eAxBjC,GA2BY,OAAO,CAAC,IAAR,CAAa,aAAb,EA3BZ,wbA8Be,OA9Bf,2CAiCW,EAjCX,8E,wEAyCA,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,+EADkC,CAEtC,MAAM,CAAmC,qCAFH,CAGtC,KAAK,CAAE,uCAH+B,CAAD,CAAzC","sourcesContent":["import { ProductDimensionFull } from '@msdyn365-commerce/commerce-entities';\nimport { CacheType, IAction, IActionContext, IActionInput } from '@msdyn365-commerce/core';\nimport { createObservableDataAction, IAny, ICreateActionContext, IGeneric } from '@msdyn365-commerce/core';\nimport { ProductDimension, SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport getSelectedVariant, { SelectedVariantInput } from './get-selected-variant';\nimport { getSelectedProductIdFromActionInput } from './utilities/utils';\n\nimport { getDimensionValuesAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\n\n/**\n * Input class for the getDimensionsForSelectedVariant data action\n */\nexport class GetDimensionsForSelectedVariantInput implements IActionInput {\n    public productId: number;\n    public channelId: number;\n    public matchingDimensionValues: ProductDimension[];\n\n    constructor(productId: number, channelId: number, matchingDimensionValues?: ProductDimension[]) {\n        this.productId = productId;\n        this.channelId = channelId;\n        this.matchingDimensionValues = matchingDimensionValues || [];\n    }\n\n    public getCacheKey = () => `DimensionsForSelectedVariant`;\n    public getCacheObjectType = () => 'DimensionsForSelectedVariantInput';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * Create input method for the getDimensionsForSelectedVariant data action\n * @param inputData The input data passed to the createInput method\n */\nconst createDimensionsForSelectedVariantInput = (inputData: ICreateActionContext<IGeneric<IAny>>): SelectedVariantInput => {\n    const productId = getSelectedProductIdFromActionInput(inputData);\n\n    if (productId) {\n        return new GetDimensionsForSelectedVariantInput(+productId, +inputData.requestContext.apiSettings.channelId, []);\n    } else {\n        throw new Error('Unable to create DimensionsForSelectedVariantInput, no productId found on module config or query');\n    }\n};\n\n/**\n * Action Method for the getDimensionsForSelectedVariant Data Action\n */\nasync function getDimensionsForSelectedVariantAction(\n    input: GetDimensionsForSelectedVariantInput,\n    ctx: IActionContext\n): Promise<ProductDimensionFull[]> {\n    const selectedVariantInput = new SelectedVariantInput(input.productId, input.channelId, input.matchingDimensionValues);\n\n    const activeProduct: SimpleProduct | null = await getSelectedVariant(selectedVariantInput, ctx);\n\n    if (activeProduct && activeProduct.Dimensions && activeProduct.Dimensions.length > 0) {\n        const results: ProductDimensionFull[] = [];\n\n        for (const dimension of activeProduct.Dimensions) {\n            const dimensionValues = await getDimensionValuesAsync(\n                { callerContext: ctx, queryResultSettings: {} },\n                activeProduct.MasterProductId ? activeProduct.MasterProductId : activeProduct.RecordId,\n                input.channelId,\n                dimension.DimensionTypeValue,\n                input.matchingDimensionValues.filter(value => value.DimensionTypeValue !== dimension.DimensionTypeValue),\n                // @ts-ignore: KitVariantResolution context should be nullable\n                null\n            );\n\n            const fullDimension: ProductDimensionFull = {\n                ...dimension,\n                DimensionValues: dimensionValues,\n            };\n\n            results.push(fullDimension);\n        }\n\n        return results;\n    }\n\n    return [];\n}\n\n/**\n * The GetDimensionsForSelectedVariantDataAction\n * Get the currently selected Variant via the getSelectedVariant data action, and the gets the\n * available product dimensions for the variant via the getDimensionValues RetailServer API\n */\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-dimensions/for-selected-variant',\n    action: <IAction<ProductDimensionFull[]>>getDimensionsForSelectedVariantAction,\n    input: createDimensionsForSelectedVariantInput\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}