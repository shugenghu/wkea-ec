{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{getCategoriesUrlSync}from'@msdyn365-commerce/core';import{createObservableDataAction}from'@msdyn365-commerce/core';import{getCategoryPathsAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import{getSelectedProductIdFromActionInput,buildCacheKey}from'./utilities/utils';/**\r\n * Category path input\r\n */export var GetCategoryPathsInput=function GetCategoryPathsInput(context,categoryPathLooksups){var _this=this;_classCallCheck(this,GetCategoryPathsInput);this.getCacheKey=function(){return buildCacheKey(_this.constructedCacheKey,_this.apiSettings);};this.getCacheObjectType=function(){return'CategoryPath';};this.dataCacheType=function(){return'request';};this.ChannelId=context.apiSettings.channelId;this.CatalogId=context.apiSettings.catalogId|0;this.categoryPathLooksups=categoryPathLooksups;this.apiSettings=context.apiSettings;this.constructedCacheKey=\"\";categoryPathLooksups.forEach(function(categoryPath){_this.constructedCacheKey+=\"\".concat(categoryPath.ProductId&&categoryPath.ProductId.toString(),\"|\");});this.constructedCacheKey+=\"\".concat(this.ChannelId.toString(),\"|\");this.constructedCacheKey+=\"\".concat(this.CatalogId.toString(),\"|\");};/**\r\n * Creates the input required to make the getCategoryPath retail api call\r\n */export var createGetCategoryPathsInput=function createGetCategoryPathsInput(inputData){var productId=getSelectedProductIdFromActionInput(inputData);if(productId){return new GetCategoryPathsInput(inputData.requestContext,[{ProductId:+productId}]);}else{throw new Error('Unable to create SelectedVariantInput, no productId found on module config or query');}};/**\r\n * Calls the Retail API and returns the category path for a product\r\n */export function getCategoryPathsAction(_x,_x2){return _getCategoryPathsAction.apply(this,arguments);}function _getCategoryPathsAction(){_getCategoryPathsAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var categoryPathResults,categoryPath,categoryUrl;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getCategoryPathsAsync({callerContext:ctx},input.ChannelId,input.CatalogId,input.categoryPathLooksups);case 2:categoryPathResults=_context.sent;categoryPath=categoryPathResults[0].CategoryPath&&categoryPathResults[0].CategoryPath[0];categoryUrl=getCategoriesUrlSync(categoryPath,ctx);if(!categoryUrl){_context.next=7;break;}return _context.abrupt(\"return\",categoryUrl);case 7:return _context.abrupt(\"return\",[]);case 8:case\"end\":return _context.stop();}}},_callee);}));return _getCategoryPathsAction.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/get-category-paths',action:getCategoryPathsAction,input:createGetCategoryPathsInput});","map":{"version":3,"sources":["../../src/get-category-paths.ts"],"names":[],"mappings":"8MAAA,OAAkF,oBAAlF,KAA8G,yBAA9G,CACA,OAAS,0BAAT,KAAiG,yBAAjG,CACA,OAAS,qBAAT,KAAsC,wEAAtC,CAEA,OAAS,mCAAT,CAA8C,aAA9C,KAAmE,mBAAnE,CAGA;;AAEG,GACH,UAAa,CAAA,qBAAb,CAOI,+BAAY,OAAZ,CAAsC,oBAAtC,CAAgF,4DAczE,KAAA,WAAA,CAAc,iBAAM,CAAA,aAAa,CAAC,KAAI,CAAC,mBAAN,CAA2B,KAAI,CAAC,WAAhC,CAAnB,EAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,cAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,SAAjB,EAAhB,CAfH,KAAK,SAAL,CAAiB,OAAO,CAAC,WAAR,CAAoB,SAArC,CACA,KAAK,SAAL,CAAiB,OAAO,CAAC,WAAR,CAAoB,SAApB,CAAgC,CAAjD,CACA,KAAK,oBAAL,CAA4B,oBAA5B,CACA,KAAK,WAAL,CAAmB,OAAO,CAAC,WAA3B,CACA,KAAK,mBAAL,IACA,oBAAoB,CAAC,OAArB,CAA6B,SAAA,YAAY,CAAE,CAEnC,KAAI,CAAC,mBAAL,YAA6B,YAAY,CAAC,SAAb,EAA0B,YAAY,CAAC,SAAb,CAAuB,QAAvB,EAAvD,MACH,CAHL,EAIA,KAAK,mBAAL,YAA6B,KAAK,SAAL,CAAe,QAAf,EAA7B,MACA,KAAK,mBAAL,YAA6B,KAAK,SAAL,CAAe,QAAf,EAA7B,MACH,CAnBL,CA0BA;;AAEG,GACH,MAAO,IAAM,CAAA,2BAA2B,CAAG,QAA9B,CAAA,2BAA8B,CAAC,SAAD,CAAkE,CACzG,GAAM,CAAA,SAAS,CAAG,mCAAmC,CAAC,SAAD,CAArD,CACA,GAAI,SAAJ,CAAe,CACT,MAAO,IAAI,CAAA,qBAAJ,CAA0B,SAAS,CAAC,cAApC,CAAoD,CAAC,CAAC,SAAS,CAAC,CAAC,SAAZ,CAAD,CAApD,CAAP,CACL,CAFD,IAEO,CACH,KAAM,IAAI,CAAA,KAAJ,CAAU,qFAAV,CAAN,CACH,CAEJ,CARM,CAUP;;AAEG,GACH,eAAsB,CAAA,sBAAtB,+D,mHAAO,iBAAsC,KAAtC,CAAoE,GAApE,yLAC+B,CAAA,qBAAqB,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAwB,KAAK,CAAC,SAA9B,CAAyC,KAAK,CAAC,SAA/C,CAAyD,KAAK,CAAC,oBAA/D,CADpD,QACG,mBADH,eAEG,YAFH,CAEkB,mBAAmB,CAAC,CAAD,CAAnB,CAAuB,YAAvB,EAAuC,mBAAmB,CAAC,CAAD,CAAnB,CAAuB,YAAvB,CAAoC,CAApC,CAFzD,CAGG,WAHH,CAGiB,oBAAoB,CAAC,YAAD,CAAgC,GAAhC,CAHrC,KAIA,WAJA,yDAMQ,WANR,yCAQI,EARJ,wD,yDAWP,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,8DADkC,CAEtC,MAAM,CAA2B,sBAFK,CAGtC,KAAK,CAAE,2BAH+B,CAAD,CAAzC","sourcesContent":["import { CacheType, IAction, IActionInput, IRequestContext, ICommerceApiSettings, getCategoriesUrlSync } from '@msdyn365-commerce/core';\nimport { createObservableDataAction, IActionContext, IAny, ICreateActionContext, IGeneric } from '@msdyn365-commerce/core';\nimport { getCategoryPathsAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { CategoryPathLookup} from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { getSelectedProductIdFromActionInput, buildCacheKey } from './utilities/utils';\nimport { ICategoryPath, ICategoryUrl } from '@msdyn365-commerce/core-internal/dist/types/interfaces/ICategoryPathInterfaces';\n\n/**\n * Category path input\n */\nexport class GetCategoryPathsInput implements IActionInput {\n    public readonly ChannelId: number;\n    public readonly CatalogId: number;    \n    public readonly categoryPathLooksups: CategoryPathLookup[];\n    private constructedCacheKey: string;\n    public readonly apiSettings: ICommerceApiSettings;\n\n    constructor(context: IRequestContext, categoryPathLooksups: CategoryPathLookup[]) {\n        this.ChannelId = context.apiSettings.channelId;\n        this.CatalogId = context.apiSettings.catalogId | 0;\n        this.categoryPathLooksups = categoryPathLooksups;\n        this.apiSettings = context.apiSettings;\n        this.constructedCacheKey = ``;\n        categoryPathLooksups.forEach(categoryPath=>\n            {\n                this.constructedCacheKey+=`${categoryPath.ProductId && categoryPath.ProductId.toString()}|`;\n            })\n        this.constructedCacheKey+=`${this.ChannelId.toString()}|`\n        this.constructedCacheKey+=`${this.CatalogId.toString()}|`\n    }\n   \n    public getCacheKey = () => buildCacheKey(this.constructedCacheKey, this.apiSettings);;\n    public getCacheObjectType = () => 'CategoryPath';\n    public dataCacheType = (): CacheType => 'request';\n}\n\n/**\n * Creates the input required to make the getCategoryPath retail api call\n */\nexport const createGetCategoryPathsInput = (inputData: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    const productId = getSelectedProductIdFromActionInput(inputData);\n    if (productId) {\n          return new GetCategoryPathsInput(inputData.requestContext, [{ProductId:+productId}]);\n    } else {\n        throw new Error('Unable to create SelectedVariantInput, no productId found on module config or query');\n    }\n    \n};\n\n/**\n * Calls the Retail API and returns the category path for a product\n */\nexport async function getCategoryPathsAction(input: GetCategoryPathsInput, ctx: IActionContext): Promise<ICategoryUrl[]> {\n    const categoryPathResults = await getCategoryPathsAsync({ callerContext: ctx },input.ChannelId, input.CatalogId,input.categoryPathLooksups);    \n    const categoryPath = categoryPathResults[0].CategoryPath && categoryPathResults[0].CategoryPath[0];\n    const categoryUrl = getCategoriesUrlSync(categoryPath as ICategoryPath, ctx);\n    if(categoryUrl)\n    {\n        return categoryUrl;\n    }\n    return [];\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-category-paths',\n    action: <IAction<ICategoryUrl[]>>getCategoryPathsAction,\n    input: createGetCategoryPathsInput,\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}