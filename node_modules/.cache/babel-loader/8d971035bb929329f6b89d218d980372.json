{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/web.dom-collections.for-each.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import{Button,getPayloadObject,getTelemetryAttributes,getTelemetryObject,TelemetryConstant}from'@msdyn365-commerce-modules/utilities';import*as Msdyn365 from'@msdyn365-commerce/core';import classname from'classnames';import get from'lodash/get';import{computed}from'mobx';import*as React from'react';import{getGroups}from'../../common/get-groups';import{getOrderInfomationInput,getOrderInformation}from'../../common/get-order-information';import{getSalesLines,getSalesLinesInput}from'../../common/get-sales-lines';import LabelComponent from'../../common/label';import{getTenderIdOperationIdMap}from'../../common/utilities';import{getOrderConfirmationHelp}from'../order-confirmation/components/get-help';import{getOrderConfirmationOrderSummary}from'../order-confirmation/components/get-order-summary';import{getOrderConfirmationPaymentMethods}from'../order-confirmation/components/get-payment-methods';export*from'../../common/get-groups';export*from'../../common/get-order-information';export*from'../../common/get-sales-line';export*from'../../common/get-sales-lines';export*from'../../common/utilities';export*from'../order-confirmation/components/get-help';export*from'../order-confirmation/components/get-order-summary';export*from'../order-confirmation/components/get-payment-methods';class OrderConfirmation extends React.PureComponent{constructor(props){super(props);this.moduleName='ms-order-confirmation';this.handleCheckoutOrderConfirmationHeadingChange=event=>this.props.config.heading.text=event.target.value;this.telemetryContent=getTelemetryObject(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);const payLoad=getPayloadObject('click',this.telemetryContent,TelemetryConstant.BackToShopping);this.backToShoppingAttributes=getTelemetryAttributes(this.telemetryContent,payLoad);}get isCurrentChannel(){if(!this.order){return false;}return this.order.ChannelId===get(this.props,'context.request.apiSettings.channelId');}get isDataReady(){return get(this.props,'data.checkout.status')==='SUCCESS';}get hasError(){return get(this.props,'data.checkout.status')==='FAILED';}get order(){return get(this.props,'data.checkout.result.salesOrder');}get products(){return get(this.props,'data.checkout.result.orderedProducts')||[];}get priceContext(){const{id,typeName,context,telemetry,resources:{freePriceText}}=this.props;return{id,typeName,context,telemetry,freePriceText};}get earnedPoints(){const loyaltyCard=this.props.data.loyaltyCard.result;if(loyaltyCard&&loyaltyCard.RewardPoints&&this.order){const pointPrograms=loyaltyCard.RewardPoints.map(point=>point.RewardPointId);const rewardLines=this.order.LoyaltyRewardPointLines||[];let total=0;rewardLines.forEach(line=>{if((line.RewardPointAmountQuantity||0)>0&&pointPrograms.indexOf(line.RewardPointId)>-1){total+=line.RewardPointAmountQuantity;}});return total;}return 0;}get orderSummaryProps(){if(!this.order){return;}const{resources:{orderSummaryHeading,orderSummaryItemsTotalLabel,orderSummaryShippingFeeLabel,orderSummaryTaxLabel,orderSummaryGrandTotalLabel,pointsEarnedLabel}}=this.props;return{order:this.order,earnedPoints:this.earnedPoints,priceContext:this.priceContext,resource:{orderSummaryHeading,orderSummaryItemsTotalLabel,orderSummaryShippingFeeLabel,orderSummaryTaxLabel,pointsEarnedLabel,orderSummaryGrandTotalLabel}};}get paymentMethodsProps(){const tenderTypes=this.props.data.tenderTypes.result;if(!this.order||!this.order.TenderLines||!tenderTypes){return;}const locale=get(this.props,'context.request.locale')||'en-US';const{resources:{paymentMethodsTitle,creditCardEndingLabel,giftCardEndingLabel,amountCoveredLabel,cashUsedLabel,loyaltyCardUsedLabel,customerAccountUsedLabel}}=this.props;return{priceContext:this.priceContext,tenderLines:this.order.TenderLines,tenderIdOperationIdMap:getTenderIdOperationIdMap(tenderTypes),locale,resource:{paymentMethodsTitle,creditCardEndingLabel,giftCardEndingLabel,amountCoveredLabel,cashUsedLabel,loyaltyCardUsedLabel,customerAccountUsedLabel}};}render(){const{resources:{noSalesOrderText,genericErrorMessage,needHelpLabel,helpLineNumberLabel,loadingLabel,backToShopping,orderItemLabel,orderItemsLabel,helpLineContactAriaLabel},config:{heading,contactNumber}}=this.props;const moduleProps={moduleProps:this.props,className:classname('ms-order-confirmation',this.props.config.className)};const backToShoppingUrl=Msdyn365.getUrlSync('home',this.props.context.actionContext)||'';let viewProps=_objectSpread(_objectSpread({},this.props),{},{moduleProps,heading:heading&&heading.text&&/*#__PURE__*/React.createElement(Msdyn365.Text,Object.assign({},heading,{className:'ms-order-confirmation__heading',text:heading.text,tag:heading.tag||'h2',editProps:{onEdit:this.handleCheckoutOrderConfirmationHeadingChange,requestContext:this.props.context.request}})),backToShoppingLink:backToShoppingUrl&&/*#__PURE__*/React.createElement(Button,Object.assign({className:'ms-order-confirmation__btn-keep-shopping',href:backToShoppingUrl},this.backToShoppingAttributes),backToShopping),footerProps:{className:'ms-order-confirmation__footer'}});if(this.hasError){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-confirmation__alert',label:genericErrorMessage})});return this.props.renderView(viewProps);}if(!this.isDataReady){viewProps=_objectSpread(_objectSpread({},viewProps),{},{loading:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-confirmation__loading',label:loadingLabel})});return this.props.renderView(viewProps);}if(!this.order){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(LabelComponent,{className:'ms-order-confirmation__alert',label:noSalesOrderText})});return this.props.renderView(viewProps);}const salesLinesInput=getSalesLinesInput(this.props,this.moduleName,this.order,this.products,this.priceContext);const salesLines=salesLinesInput&&getSalesLines(salesLinesInput);const orderInfomationInput=this.order&&getOrderInfomationInput(this.props,this.moduleName,this.order,this.priceContext);const orderInfomation=orderInfomationInput&&getOrderInformation(orderInfomationInput);viewProps=_objectSpread(_objectSpread({},viewProps),{},{salesOrder:this.order,orderInfomation,salesLines,groups:salesLines?getGroups({moduleName:this.moduleName,salesLines,resources:{orderItemLabel,orderItemsLabel}}):undefined,orderSummary:this.orderSummaryProps?getOrderConfirmationOrderSummary(this.orderSummaryProps):undefined,payment:this.paymentMethodsProps?getOrderConfirmationPaymentMethods(this.paymentMethodsProps):undefined,help:contactNumber?getOrderConfirmationHelp({needHelpLabel,helpLineNumberLabel,contactNumber,helpLineContactAriaLabel,telemetryContent:this.telemetryContent}):undefined});return this.props.renderView(viewProps);}}__decorate([computed],OrderConfirmation.prototype,\"isCurrentChannel\",null);__decorate([computed],OrderConfirmation.prototype,\"isDataReady\",null);__decorate([computed],OrderConfirmation.prototype,\"hasError\",null);__decorate([computed],OrderConfirmation.prototype,\"order\",null);__decorate([computed],OrderConfirmation.prototype,\"products\",null);__decorate([computed],OrderConfirmation.prototype,\"priceContext\",null);__decorate([computed],OrderConfirmation.prototype,\"earnedPoints\",null);__decorate([computed],OrderConfirmation.prototype,\"orderSummaryProps\",null);__decorate([computed],OrderConfirmation.prototype,\"paymentMethodsProps\",null);export default OrderConfirmation;","map":{"version":3,"sources":["modules/checkout-order-confirmation/checkout-order-confirmation.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, TelemetryConstant } from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport { SalesOrder, SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport classname from 'classnames';\nimport get from 'lodash/get';\nimport { computed } from 'mobx';\nimport * as React from 'react';\nimport { IGetOrderSummaryInput, IHelp, IOrderSummary, IPaymentMethods, IPaymentMethodsInput  } from '../../common';\nimport { getGroups, IGroups } from '../../common/get-groups';\nimport { getOrderInfomationInput, getOrderInformation, IOrderInformation } from '../../common/get-order-information';\nimport { ISalesLine } from '../../common/get-sales-line';\nimport { getSalesLines, getSalesLinesInput } from '../../common/get-sales-lines';\nimport LabelComponent from '../../common/label';\nimport { getTenderIdOperationIdMap, IPriceContext } from '../../common/utilities';\nimport { getOrderConfirmationHelp } from '../order-confirmation/components/get-help';\nimport { getOrderConfirmationOrderSummary } from '../order-confirmation/components/get-order-summary';\nimport { getOrderConfirmationPaymentMethods } from '../order-confirmation/components/get-payment-methods';\nimport { ICheckoutOrderConfirmationData } from './checkout-order-confirmation.data';\nimport { ICheckoutOrderConfirmationProps } from './checkout-order-confirmation.props.autogenerated';\n\nexport * from '../../common/get-groups';\nexport * from '../../common/get-order-information';\nexport * from '../../common/get-sales-line';\nexport * from '../../common/get-sales-lines';\nexport * from '../../common/utilities';\nexport * from '../order-confirmation/components/get-help';\nexport * from '../order-confirmation/components/get-order-summary';\nexport * from '../order-confirmation/components/get-payment-methods';\n\nexport interface ICheckoutOrderConfirmationViewProps extends ICheckoutOrderConfirmationProps<ICheckoutOrderConfirmationData> {\n    moduleProps: IModuleProps;\n    salesOrder?: SalesOrder;\n    footerProps?: INodeProps;\n    alert?: React.ReactNode;\n    loading?: React.ReactNode;\n    heading: React.ReactNode;\n    backToShoppingLink?: React.ReactNode;\n    orderInfomation?: IOrderInformation;\n    salesLines?: ISalesLine[];\n    groups?: IGroups;\n    orderSummary?: IOrderSummary;\n    payment?: IPaymentMethods;\n    help?: IHelp;\n}\n\n/**\n *\n * OrderConfirmation component\n * @extends {React.PureComponent<IOrderConfirmationProps<IOrderConfirmationData>>}\n */\nclass OrderConfirmation extends React.PureComponent<ICheckoutOrderConfirmationProps<ICheckoutOrderConfirmationData>> {\n    private moduleName: string = 'ms-order-confirmation';\n    private telemetryContent?: ITelemetryContent;\n    private backToShoppingAttributes?: Msdyn365.IDictionary<string>;\n\n    constructor(props: ICheckoutOrderConfirmationProps<ICheckoutOrderConfirmationData>) {\n        super(props);\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n        const payLoad = getPayloadObject('click', this.telemetryContent, TelemetryConstant.BackToShopping);\n        this.backToShoppingAttributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n    }\n\n    @computed get isCurrentChannel(): boolean {\n        if (!this.order) {\n            return false;\n        }\n        return this.order.ChannelId === get(this.props, 'context.request.apiSettings.channelId');\n    }\n\n    @computed get isDataReady(): boolean {\n        return get(this.props, 'data.checkout.status') === 'SUCCESS';\n    }\n\n    @computed get hasError(): boolean {\n        return get(this.props, 'data.checkout.status') === 'FAILED';\n    }\n\n    @computed get order(): SalesOrder | undefined {\n        return get(this.props, 'data.checkout.result.salesOrder');\n    }\n\n    @computed get products(): SimpleProduct[] {\n        return get(this.props, 'data.checkout.result.orderedProducts') || [];\n    }\n\n    @computed get priceContext(): IPriceContext {\n        const {\n            id,\n            typeName,\n            context,\n            telemetry,\n            resources: { freePriceText }\n        } = this.props;\n        return {\n            id,\n            typeName,\n            context,\n            telemetry,\n            freePriceText\n        };\n    }\n\n    @computed get earnedPoints(): number {\n        const loyaltyCard = this.props.data.loyaltyCard.result;\n        if (loyaltyCard && loyaltyCard.RewardPoints && this.order) {\n            const pointPrograms = loyaltyCard.RewardPoints.map(point => point.RewardPointId);\n            const rewardLines = this.order.LoyaltyRewardPointLines || [];\n            let total = 0;\n            rewardLines.forEach(line => {\n                if ((line.RewardPointAmountQuantity || 0) > 0 && pointPrograms.indexOf(line.RewardPointId) > -1) {\n                    total += line.RewardPointAmountQuantity!;\n                }\n            });\n            return total;\n        }\n        return 0;\n    }\n\n    @computed get orderSummaryProps(): IGetOrderSummaryInput | undefined {\n        if (!this.order) {\n            return;\n        }\n\n        const {\n            resources: { orderSummaryHeading, orderSummaryItemsTotalLabel, orderSummaryShippingFeeLabel, orderSummaryTaxLabel, orderSummaryGrandTotalLabel, pointsEarnedLabel }\n        } = this.props;\n        return {\n            order: this.order,\n            earnedPoints: this.earnedPoints,\n            priceContext: this.priceContext,\n            resource: {\n                orderSummaryHeading,\n                orderSummaryItemsTotalLabel,\n                orderSummaryShippingFeeLabel,\n                orderSummaryTaxLabel,\n                pointsEarnedLabel,\n                orderSummaryGrandTotalLabel\n            }\n        };\n    }\n\n    @computed get paymentMethodsProps(): IPaymentMethodsInput | undefined {\n        const tenderTypes = this.props.data.tenderTypes.result;\n        if (!this.order || !this.order.TenderLines || !tenderTypes) {\n            return;\n        }\n\n        const locale = get(this.props, 'context.request.locale') || 'en-US';\n\n        const {\n            resources: {\n                paymentMethodsTitle,\n                creditCardEndingLabel,\n                giftCardEndingLabel,\n                amountCoveredLabel,\n                cashUsedLabel,\n                loyaltyCardUsedLabel,\n                customerAccountUsedLabel\n            }\n        } = this.props;\n\n        return {\n            priceContext: this.priceContext,\n            tenderLines: this.order.TenderLines,\n            tenderIdOperationIdMap: getTenderIdOperationIdMap(tenderTypes),\n            locale,\n            resource: {\n                paymentMethodsTitle,\n                creditCardEndingLabel,\n                giftCardEndingLabel,\n                amountCoveredLabel,\n                cashUsedLabel,\n                loyaltyCardUsedLabel,\n                customerAccountUsedLabel\n            }\n        };\n    }\n\n    public render(): JSX.Element {\n        const {\n            resources: {\n                noSalesOrderText,\n                genericErrorMessage,\n                needHelpLabel,\n                helpLineNumberLabel,\n                loadingLabel,\n                backToShopping,\n                orderItemLabel,\n                orderItemsLabel,\n                helpLineContactAriaLabel,\n            },\n            config: { heading, contactNumber }\n        } = this.props;\n\n        const moduleProps = { moduleProps: this.props, className: classname('ms-order-confirmation', this.props.config.className) };\n        const backToShoppingUrl = Msdyn365.getUrlSync('home', this.props.context.actionContext) || '';\n\n        let viewProps: ICheckoutOrderConfirmationViewProps = {\n            ...this.props,\n            moduleProps,\n            heading: heading && heading.text && (\n            <Msdyn365.Text\n                {...heading}\n                className='ms-order-confirmation__heading'\n                text={heading.text}\n                tag={heading.tag || 'h2'}\n                editProps={{ onEdit: this.handleCheckoutOrderConfirmationHeadingChange, requestContext: this.props.context.request }}\n            />\n            ),\n            backToShoppingLink: backToShoppingUrl && (\n                <Button className='ms-order-confirmation__btn-keep-shopping' href={backToShoppingUrl} {...this.backToShoppingAttributes}>\n                    {backToShopping}\n                </Button>\n            ),\n            footerProps: { className: 'ms-order-confirmation__footer' }\n        };\n\n        if (this.hasError) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-confirmation__alert' label={genericErrorMessage} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!this.isDataReady) {\n            viewProps = {\n                ...viewProps,\n                loading: <LabelComponent className='ms-order-confirmation__loading' label={loadingLabel} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!this.order) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-confirmation__alert' label={noSalesOrderText} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        const salesLinesInput = getSalesLinesInput(this.props, this.moduleName, this.order, this.products, this.priceContext);\n        const salesLines = salesLinesInput && getSalesLines(salesLinesInput);\n\n        const orderInfomationInput = this.order && getOrderInfomationInput(this.props, this.moduleName, this.order, this.priceContext);\n        const orderInfomation = orderInfomationInput && getOrderInformation(orderInfomationInput);\n\n        viewProps = {\n            ...viewProps,\n            salesOrder: this.order,\n            orderInfomation,\n            salesLines,\n            groups: salesLines\n                ? getGroups({\n                    moduleName: this.moduleName,\n                    salesLines,\n                    resources: { orderItemLabel, orderItemsLabel }\n                })\n                : undefined,\n            orderSummary: this.orderSummaryProps ? getOrderConfirmationOrderSummary(this.orderSummaryProps) : undefined,\n            payment: this.paymentMethodsProps ? getOrderConfirmationPaymentMethods(this.paymentMethodsProps) : undefined,\n            help: contactNumber ? getOrderConfirmationHelp({ needHelpLabel, helpLineNumberLabel, contactNumber, helpLineContactAriaLabel, telemetryContent: this.telemetryContent }) : undefined\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleCheckoutOrderConfirmationHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n\n}\n\nexport default OrderConfirmation;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}