{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import{getCategoryUrl}from'@msdyn365-commerce-modules/retail-actions';import{addThrottledEvent}from'@msdyn365-commerce-modules/utilities';import{isEmptyOrNullObject}from'@msdyn365-commerce/core';import classnames from'classnames';import{computed,observable}from'mobx';import*as React from'react';class NavigationMenu extends React.PureComponent{constructor(props){super(props);this.isRetail=true;this.isCMS=true;this._setNavigationSource=sourceType=>{switch(sourceType){case\"retailServerOnly\":this.isRetail=true;this.isCMS=false;break;case\"cmsOnly\":this.isRetail=false;this.isCMS=true;break;case\"all\":this.isRetail=true;this.isCMS=true;break;default:}};this._updateViewport=this._updateViewport.bind(this);this.viewport=props.context.request&&props.context.request.device&&props.context.request.device.Type==='Mobile'?'xs':'lg';this._setNavigationSource(this.props.config&&this.props.config.navigationMenuSource);this.state={isMobile:this.isMobile};this.menuItemList=[];}static getFriendlyName(locale,nameTranslations){let nameTranslation;if(locale&&nameTranslations&&nameTranslations.length>0){nameTranslation=nameTranslations.find(item=>item.Language.toLowerCase()===locale.toLowerCase());}return nameTranslation&&nameTranslation.Text;}get isMobile(){return this.viewport==='xs'||this.viewport==='sm';}componentDidMount(){this.resizeThrottledEventHandler=window&&addThrottledEvent(window,'resize',this._updateViewport);this._updateViewport();}componentWillUnmount(){window&&window.removeEventListener('resize',this.resizeThrottledEventHandler,false);}render(){this.menuItemList=this._mapData();if(isEmptyOrNullObject(this.props.data)){this.props.telemetry.error('Navigatiomenu returned null');return null;}const defaultImageSettings={viewports:{xs:{q:\"w=224&h=300&m=6\",w:0,h:0},xl:{q:\"w=224&h=300&m=6\",w:0,h:0}},lazyload:true};const viewProps=_objectSpread(_objectSpread(_objectSpread({},this.props),this.state),{},{imageSettings:defaultImageSettings,gridSettings:this.props.context.request.gridSettings,Navigation:{moduleProps:this.props,className:classnames('ms-nav',this.props.config.className,this.state.isMobile?'mobile-vp':'desktop-vp'),tag:'nav',role:'navigation','aria-label':this.props.resources.menuAriaLabel},MenuList:{className:'ms-nav__list',tag:'ul',role:'menu'},ListItem:{className:'ms-nav__list__item',role:'presentation',tag:'li'},showCategoryImage:this.props.config.displayCategoryImage||false,Link:{tag:'a',className:'ms-nav__list__item__link',role:'menuitem'},DivContainer:{tag:'div',className:'ms-nav__feature',role:'menu'},ImageDivContainer:{tag:'div',className:'category-image',role:'menu'},Button:{className:'ms-nav__list__item__button',tag:'button',role:'menuitem',onClick:this.props},ImageContainer:{className:'ms-nav__list__item__image'},Span:{className:'ms-nav__list__item__span',tag:'span'},MobileDescriptionContainer:{className:'ms-nav__list__mobile__container'},MobileBackButton:{className:'ms-nav__list__mobile__container__button',tag:'button','aria-label':this.props.resources.backButtonAriaLabel,onClick:this.props},MobileDescriptionLabel:{className:'ms-nav__list__mobile__container__span',tag:'span'},isMobileView:this.state.isMobile,menuItemData:this.menuItemList,className:classnames('ms-nav',this.props.config.className)});return this.props.renderView(viewProps);}_mapData(){const{data,config}=this.props;const mergedData=[];if(this.isRetail&&data&&data.categories&&data.categories.result&&data.categories.result.length>0){data.categories.result.map(item=>mergedData.push(this._constructMenuItemData(item,undefined,true)));}if(this.isCMS&&config.cmsNavItems&&config.cmsNavItems.length>0){config.cmsNavItems.map((item,idx)=>mergedData.push(this._constructMenuItemData(undefined,item,false,idx+1)));}return mergedData;}_constructMenuItemData(retailItem,cmsItem,isRetail,idx){const locale=this.props.context&&this.props.context.request&&this.props.context.request.locale?this.props.context.request.locale:'en-us';const imageSouce=retailItem&&retailItem.Images&&retailItem.Images[0].Uri?retailItem.Images[0].Uri:'empty';if(isRetail){return{id:NavigationMenu.RSItemIdInit++,linkText:NavigationMenu.getFriendlyName(locale,retailItem&&retailItem.NameTranslations)||'',linkURL:retailItem&&retailItem.Url,imageSource:imageSouce,subMenu:this._getNestedChildren(retailItem,imageSouce)};}else{return{id:NavigationMenu.CMSItemIdInit++,linkText:cmsItem&&cmsItem.linkText||'',linkURL:cmsItem&&cmsItem.linkUrl&&cmsItem.linkUrl.destinationUrl||'',imageDestinationURL:cmsItem&&cmsItem.imageLink&&cmsItem.imageLink.destinationUrl||'',imageSource:cmsItem&&cmsItem.image&&cmsItem.image.src||'',subMenu:this._getCMSNestedChildren(cmsItem)};}}_getNestedChildren(category,imageSourceUrl){const nestedChildren=[];if(!category||!category.Children||!category.Children.length){return[];}nestedChildren.push({linkText:this.props.resources.allCategoryMenuText,imageSource:imageSourceUrl,linkURL:getCategoryUrl(category,this.props.context,{})});category.Children.map(item=>{nestedChildren.push(this._constructMenuItemData(item,undefined,true));});return nestedChildren;}_getCMSNestedChildren(category){const nestedChildren=[];if(!category||!category.subMenus||!category.subMenus.length){return[];}category.subMenus.map((item,idx)=>{nestedChildren.push(this._constructMenuItemData(undefined,item,false,idx));});return nestedChildren;}_updateViewport(){this.viewport=this._getViewport();this.setState({isMobile:this.isMobile});}_getViewport(){const{context}=this.props;if(context.request&&context.request.device&&context.request.device.Type==='Mobile'){return'xs';}if(typeof window!==undefined&&window.innerWidth){const gridSettings=context.request.gridSettings;if(gridSettings){if(gridSettings.xs&&window.innerWidth<=gridSettings.xs.w){return'xs';}else if(gridSettings.sm&&window.innerWidth<=gridSettings.sm.w){return'sm';}else if(gridSettings.md&&window.innerWidth<=gridSettings.md.w){return'md';}else if(gridSettings.lg&&window.innerWidth<=gridSettings.lg.w){return'lg';}else{return'xl';}}}return'xs';}}NavigationMenu.CMSItemIdInit=1000;NavigationMenu.RSItemIdInit=5000;__decorate([observable],NavigationMenu.prototype,\"viewport\",void 0);__decorate([computed],NavigationMenu.prototype,\"isMobile\",null);export default NavigationMenu;","map":{"version":3,"sources":["modules/navigation-menu/navigation-menu.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getCategoryUrl } from '@msdyn365-commerce-modules/retail-actions';\nimport { addThrottledEvent, IModuleProps,  INodeProps } from '@msdyn365-commerce-modules/utilities';\nimport { CategoryHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { IActionContext, IGridSettings, IImageSettings, isEmptyOrNullObject} from '@msdyn365-commerce/core';\nimport { TextValueTranslation } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport { computed, observable } from 'mobx';\nimport * as React from 'react';\nimport { IMenuItemData, INavigationMenuData } from './navigation-menu.data';\nimport { ICmsNavItemsData, INavigationMenuProps, ISubMenusData, navigationMenuSource } from './navigation-menu.props.autogenerated';\n\nexport interface  INavigationMenuViewProps extends INavigationMenuProps<INavigationMenuData> {\n    className: string;\n    menuItemData: IMenuItemData[];\n    Navigation: IModuleProps;\n    MenuList: INodeProps;\n    ListItem: INodeProps;\n    Link: INodeProps;\n    Button: INodeProps;\n    Span: INodeProps;\n    ImageContainer:INodeProps;\n    MobileDescriptionContainer:INodeProps;\n    MobileBackButton:INodeProps;\n    MobileDescriptionLabel:INodeProps;\n    imageSettings: IImageSettings;\n    gridSettings: IGridSettings;\n    isMobileView: boolean;\n    DivContainer?:INodeProps;\n    ImageDivContainer?:INodeProps;\n    showCategoryImage?:boolean;\n}\n\nexport type GridSize = 'xs' | 'sm' | 'md' | 'lg' | 'xl';\n\nexport interface INavigationMenuState {\n    isMobile: boolean;\n}\n\n/**\n *\n * NavigationMenu component\n * @extends {React.PureComponent<INavigationMenuProps<INavigationMenuData>>}\n */\nclass NavigationMenu extends React.PureComponent<INavigationMenuProps<INavigationMenuData>, INavigationMenuState> {\n    private static CMSItemIdInit: number = 1000;\n    private static RSItemIdInit: number = 5000;\n    private resizeThrottledEventHandler?: (event: Event) => void;\n    private menuItemList: IMenuItemData[];\n    private isRetail: boolean = true;\n    private isCMS: boolean = true;\n    @observable\n    private viewport: GridSize;\n    public static getFriendlyName(locale: string, nameTranslations?: TextValueTranslation[]): string | undefined {\n        let nameTranslation: TextValueTranslation | undefined;\n        if (locale && nameTranslations && nameTranslations.length > 0) {\n            nameTranslation = nameTranslations.find(item => item.Language!.toLowerCase() === locale.toLowerCase());\n        }\n\n        return nameTranslation && nameTranslation.Text;\n    }\n\n    constructor(props: INavigationMenuProps<INavigationMenuData>) {\n        super(props);\n        this._updateViewport = this._updateViewport.bind(this);\n        this.viewport = props.context.request && props.context.request.device && props.context.request.device.Type === 'Mobile' ? 'xs' : 'lg';\n        this._setNavigationSource(this.props.config && this.props.config.navigationMenuSource);\n        this.state = {isMobile: this.isMobile};\n        this.menuItemList = [];\n    }\n\n    @computed get isMobile(): boolean {\n        return (this.viewport === 'xs' || this.viewport === 'sm');\n    }\n\n    public componentDidMount(): void {\n        this.resizeThrottledEventHandler =\n        window && addThrottledEvent(window, 'resize', this._updateViewport as EventListener);\n        this._updateViewport();\n    }\n\n    public componentWillUnmount(): void {\n        window && window.removeEventListener('resize', this.resizeThrottledEventHandler!, false);\n    }\n\n    public render(): JSX.Element | null {\n        this.menuItemList =  this._mapData();\n        if (isEmptyOrNullObject(this.props.data)) {\n            this.props.telemetry.error('Navigatiomenu returned null');\n            return null;\n        }\n\n        const defaultImageSettings: IImageSettings = {\n            viewports: {\n                xs: { q: `w=224&h=300&m=6`, w: 0, h: 0 },\n                xl: { q: `w=224&h=300&m=6`, w: 0, h: 0 }\n            },\n            lazyload: true\n        };\n\n        const viewProps = {\n            ...this.props,\n            ...this.state,\n            imageSettings: defaultImageSettings,\n            gridSettings: this.props.context.request.gridSettings,\n            Navigation: {\n                moduleProps: this.props,\n                className: classnames('ms-nav', this.props.config.className, this.state.isMobile ? 'mobile-vp' : 'desktop-vp'),\n                tag:'nav',\n                role:'navigation',\n                'aria-label': this.props.resources.menuAriaLabel\n            },\n            MenuList: {\n                className: 'ms-nav__list',\n                tag:'ul',\n                role: 'menu'\n            },\n            ListItem: {\n                className: 'ms-nav__list__item',\n                role: 'presentation',\n                tag:'li'\n            },\n            showCategoryImage:this.props.config.displayCategoryImage||false,\n            Link: {\n                tag: 'a',\n                className: 'ms-nav__list__item__link',\n                role: 'menuitem'\n            },\n            DivContainer:\n            {\n                tag: 'div',\n                className:'ms-nav__feature',\n                role:'menu'\n            },\n            ImageDivContainer:\n            {\n                tag:'div',\n                className:'category-image',\n                role:'menu'\n            },\n            Button: {\n                className: 'ms-nav__list__item__button',\n                tag:'button',\n                role:'menuitem',\n                onClick:this.props\n            },\n            ImageContainer: {\n                className: 'ms-nav__list__item__image'\n            },\n            Span: {\n                className: 'ms-nav__list__item__span',\n                tag:'span'\n            },\n            MobileDescriptionContainer: {\n                className: 'ms-nav__list__mobile__container'\n            },\n            MobileBackButton: {\n                className: 'ms-nav__list__mobile__container__button',\n                tag:'button',\n                'aria-label': this.props.resources.backButtonAriaLabel,\n                onClick:this.props\n            },\n            MobileDescriptionLabel: {\n                className: 'ms-nav__list__mobile__container__span',\n                tag:'span'\n            },\n            isMobileView: this.state.isMobile,\n            menuItemData: this.menuItemList,\n            className: classnames('ms-nav', this.props.config.className)\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private _mapData(): IMenuItemData[] {\n        const { data, config } = this.props;\n        const mergedData: IMenuItemData[] = [];\n        if (this.isRetail && data && data.categories && data.categories.result && data.categories.result.length > 0) {\n            data.categories.result.map((item: CategoryHierarchy) => (\n                mergedData.push(this._constructMenuItemData(item, undefined, true))\n            ));\n        }\n\n        if (this.isCMS && config.cmsNavItems &&  config.cmsNavItems.length > 0) {\n            config.cmsNavItems.map((item: ICmsNavItemsData, idx: number) => (\n                mergedData.push(this._constructMenuItemData(undefined, item, false, idx+1))\n            ));\n        }\n        return mergedData;\n    }\n\n    // tslint:disable-next-line: cyclomatic-complexity\n    private _constructMenuItemData(retailItem?: CategoryHierarchy, cmsItem?: ICmsNavItemsData, isRetail?: boolean, idx?: number): IMenuItemData {\n        const locale = this.props.context && this.props.context.request && this.props.context.request.locale ? this.props.context.request.locale : 'en-us';\n        const imageSouce  = retailItem && retailItem.Images && retailItem.Images[0].Uri ? retailItem.Images[0].Uri: 'empty';\n        if (isRetail) {\n            return {\n                id: NavigationMenu.RSItemIdInit++,\n                linkText: NavigationMenu.getFriendlyName(locale, retailItem && retailItem.NameTranslations) || '',\n                linkURL: retailItem && retailItem.Url,\n                imageSource: imageSouce,\n                subMenu: this._getNestedChildren(retailItem,imageSouce)\n            } as IMenuItemData;\n        } else {\n            return {\n                id: NavigationMenu.CMSItemIdInit++,\n                linkText: cmsItem && cmsItem.linkText || '',\n                linkURL: cmsItem && cmsItem.linkUrl && cmsItem.linkUrl.destinationUrl || '',\n                imageDestinationURL: cmsItem && cmsItem.imageLink && cmsItem.imageLink.destinationUrl || '',\n                imageSource: cmsItem && cmsItem.image && cmsItem.image.src || '',\n                subMenu: this._getCMSNestedChildren(cmsItem)\n            } as IMenuItemData;\n        }\n    }\n\n    private _getNestedChildren(category?: CategoryHierarchy,imageSourceUrl?:string): IMenuItemData[] {\n        const nestedChildren: IMenuItemData[] = [];\n        if (!category || !category.Children || !category.Children.length) {\n            return [];\n        }\n        nestedChildren.push({linkText: this.props.resources.allCategoryMenuText,imageSource:imageSourceUrl,linkURL: getCategoryUrl(category, this.props.context as unknown as IActionContext, {}) });\n        category.Children.map((item: CategoryHierarchy) => {\n            nestedChildren.push(this._constructMenuItemData(item, undefined, true));\n        });\n        return nestedChildren;\n    }\n\n    private _getCMSNestedChildren(category?: ICmsNavItemsData): IMenuItemData[] {\n        const nestedChildren: IMenuItemData[] = [];\n\n        if (!category || !category.subMenus || !category.subMenus.length) {\n            return [];\n        }\n\n        category.subMenus.map((item: ISubMenusData, idx: number) => {\n            nestedChildren.push(this._constructMenuItemData(undefined, item, false, idx));\n        });\n        return nestedChildren;\n    }\n\n    private _setNavigationSource = (sourceType?: navigationMenuSource): void => {\n        switch(sourceType) {\n            case navigationMenuSource.retailServerOnly:\n                this.isRetail = true;\n                this.isCMS = false;\n                break;\n            case navigationMenuSource.cmsOnly:\n                this.isRetail = false;\n                this.isCMS = true;\n                break;\n            case navigationMenuSource.all:\n                this.isRetail = true;\n                this.isCMS = true;\n                break;\n            default:\n        }\n    }\n\n    private _updateViewport(): void {\n        this.viewport = this._getViewport();\n        this.setState({ isMobile: this.isMobile });\n    }\n\n    private _getViewport(): GridSize {\n        const { context } = this.props;\n\n        // always render in mobile viewport on a mobile device\n        if (context.request && context.request.device && context.request.device.Type === 'Mobile') {\n            return 'xs';\n        }\n\n        if (typeof window !== undefined && window.innerWidth) {\n            const gridSettings = context.request.gridSettings;\n            if (gridSettings) {\n                if (gridSettings.xs && window.innerWidth <= gridSettings.xs.w) {\n                    return 'xs';\n                } else if (gridSettings.sm && window.innerWidth <= gridSettings.sm.w) {\n                    return 'sm';\n                } else if (gridSettings.md && window.innerWidth <= gridSettings.md.w) {\n                    return 'md';\n                } else if (gridSettings.lg && window.innerWidth <= gridSettings.lg.w) {\n                    return 'lg';\n                } else {\n                    return 'xl';\n                }\n            }\n        }\n\n        return 'xs';\n    }\n}\n\nexport default NavigationMenu;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}