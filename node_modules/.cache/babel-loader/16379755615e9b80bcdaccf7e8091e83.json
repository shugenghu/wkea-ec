{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import{withModuleState}from'@msdyn365-commerce-modules/checkout-utilities';import{getAvailabilitiesForCartLineItems,ProductAvailabilitiesForCartLineItems}from'@msdyn365-commerce-modules/retail-actions';import{Button,getPayloadObject,getTelemetryAttributes,getTelemetryObject,TelemetryConstant,Waiting}from'@msdyn365-commerce-modules/utilities';import*as Msdyn365 from'@msdyn365-commerce/core';import classnames from'classnames';import _get from'lodash/get';import isEmpty from'lodash/isEmpty';import{computed,reaction,when}from'mobx';import{observer}from'mobx-react';import*as React from'react';import AlertComponent from'./components/alert';import{getLineItems}from'./components/get-line-items';import{getOrderSummary}from'./components/get-order-summary';import GuidedFormComponent from'./components/guided-form';import PlaceOrderButtonComponent from'./components/place-order-button';import placeOrder from'./methods/place-order';export*from'./components/get-line-items';export*from'./components/get-order-summary';var Checkout=/*#__PURE__*/function(_React$Component){_inherits(Checkout,_React$Component);var _super=_createSuper(Checkout);function Checkout(){var _this;_classCallCheck(this,Checkout);_this=_super.apply(this,arguments);_this.state={errorMessage:''};_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);_this.handleCheckoutHeadingChange=function(event){return _this.props.config.checkoutHeading.text=event.target.value;};_this.isLoading=function(){return!_this.cartStatus||_this.cartStatus==='LOADING'||_this.isEmptyCart;};_this.getSlotItems=function(key){var slots=_this.props.slots;return slots&&slots[key]&&slots[key].length?slots[key]:undefined;};_this.onPlaceOrder=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$props,_this$props$resources,checkoutOutOfStockErrorMessage,genericErrorMessage,_this$props$context,actionContext,_this$props$context$a,enableStockCheck,orderConfirmation,checkout,hasOrderConfirmation;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props=_this.props,_this$props$resources=_this$props.resources,checkoutOutOfStockErrorMessage=_this$props$resources.checkoutOutOfStockErrorMessage,genericErrorMessage=_this$props$resources.genericErrorMessage,_this$props$context=_this$props.context,actionContext=_this$props$context.actionContext,_this$props$context$a=_this$props$context.app.config.enableStockCheck,enableStockCheck=_this$props$context$a===void 0?false:_this$props$context$a,orderConfirmation=_this$props.slots.orderConfirmation,checkout=_this$props.data.checkout;_context.t0=enableStockCheck;if(!_context.t0){_context.next=10;break;}_context.t1=_this;_context.next=6;return checkout;case 6:_context.t2=_context.sent.checkoutCart.cart;_context.next=9;return _context.t1.isOverMaxQuantity.call(_context.t1,_context.t2);case 9:_context.t0=_context.sent;case 10:if(!_context.t0){_context.next=15;break;}_this.setState({errorMessage:checkoutOutOfStockErrorMessage});_this.props.context.telemetry.error(checkoutOutOfStockErrorMessage);_context.next=18;break;case 15:hasOrderConfirmation=orderConfirmation&&orderConfirmation.length>0;_context.next=18;return placeOrder(actionContext,_this.props.data.checkout.result,_this.props.data.products.result,!hasOrderConfirmation)[\"catch\"](function(error){_this.setState({errorMessage:genericErrorMessage});_this.props.telemetry.exception(error);});case 18:case\"end\":return _context.stop();}}},_callee);}));_this.isOverMaxQuantity=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(cart){var isOverMaxQuantity;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:isOverMaxQuantity=false;_context2.next=3;return getAvailabilitiesForCartLineItems(new ProductAvailabilitiesForCartLineItems(_this.props.context.actionContext.requestContext.apiSettings),_this.props.context.actionContext).then(function(productInventoryInformation){var _cart$CartLines;(_cart$CartLines=cart.CartLines)===null||_cart$CartLines===void 0?void 0:_cart$CartLines.map(function(cartline){if(productInventoryInformation&&productInventoryInformation.length>0){var foundProductAvailability=productInventoryInformation.find(function(productInventory){var _productInventory$Pro;return((_productInventory$Pro=productInventory.ProductAvailableQuantity)===null||_productInventory$Pro===void 0?void 0:_productInventory$Pro.ProductId)===cartline.ProductId;});if(!(foundProductAvailability!==null&&foundProductAvailability!==void 0&&foundProductAvailability.IsProductAvailable&&foundProductAvailability.ProductAvailableQuantity.AvailableQuantity!==undefined&&cartline.Quantity&&cartline.Quantity<=foundProductAvailability.ProductAvailableQuantity.AvailableQuantity)){isOverMaxQuantity=true;}}});})[\"catch\"](function(error){_this.props.context.actionContext.telemetry.exception(error);throw new Error('[getAvailabilitiesForCartLineItems] Unable to get availabilities for products in checkout cart');});case 3:return _context2.abrupt(\"return\",isOverMaxQuantity);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.getActiveChildModuleStates=function(){var _this$props$moduleSta=_this.props.moduleState,childIds=_this$props$moduleSta.childIds,getModule=_this$props$moduleSta.getModule;return childIds.map(getModule).filter(function(state){return!!state&&!state.isDisabled&&state.hasModuleState;});};_this.onContainerReady=function(){_this.getActiveChildModuleStates().forEach(function(state){state.isReady&&state.onContainerReady&&state.onContainerReady();});};return _this;}_createClass(Checkout,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var genericErrorMessage=this.props.resources.genericErrorMessage;when(function(){return _this2.hasError;},function(){_this2.setState({errorMessage:genericErrorMessage});_this2.props.context.telemetry.error('Failed to get cart');});when(function(){return _this2.isEmptyCart;},function(){var editCartLink=Msdyn365.getUrlSync('cart',_this2.props.context.actionContext)||'';if(window&&editCartLink){window.location.assign(editCartLink);}else{_this2.setState({errorMessage:genericErrorMessage});_this2.props.context.telemetry.error('Cart is empty, but no editCartLink found');}});reaction(function(){return _this2.props.moduleState.isReady;},function(){_this2.onContainerReady();});}},{key:\"render\",value:function render(){var _this$props2=this.props,moduleState=_this$props2.moduleState,_this$props2$config=_this$props2.config,className=_this$props2$config.className,checkoutHeading=_this$props2$config.checkoutHeading,disableGuidedCheckoutFlow=_this$props2$config.disableGuidedCheckoutFlow,resources=_this$props2.resources;var errorMessage=this.state.errorMessage;var backToShopping=resources.backToShopping,placeOrderText=resources.placeOrderText,cookieConsentRequiredMessage=resources.cookieConsentRequiredMessage,genericErrorMessage=resources.genericErrorMessage;var checkoutClass=classnames('ms-checkout',className);var checkoutInformation=this.getSlotItems('checkoutInformation');var isConsentGiven=this.props.context.request&&this.props.context.request.cookies&&this.props.context.request.cookies.isConsentGiven&&this.props.context.request.cookies.isConsentGiven();var isMobile=this.props.context.request&&this.props.context.request.device&&this.props.context.request.device.Type==='Mobile';var backToShoppingUrl=Msdyn365.getUrlSync('home',this.props.context.actionContext)||'';var editCartLink=Msdyn365.getUrlSync('cart',this.props.context.actionContext)||'';var termsAndConditions=this.props.slots.termsAndConditions&&this.props.slots.termsAndConditions.length>0&&this.props.slots.termsAndConditions[0];var payLoad=getPayloadObject('click',this.telemetryContent,TelemetryConstant.BackToShopping);var backToShoppingAttributes=getTelemetryAttributes(this.telemetryContent,payLoad);var viewProps=_objectSpread(_objectSpread({},this.props),{},{className:checkoutClass,isEmptyCart:this.isEmptyCart,isConsentGiven:isConsentGiven,hasError:this.hasError,hasSalesOrder:this.props.data.checkout&&this.props.data.checkout.result!==undefined&&this.props.data.checkout.result.salesOrder!==undefined,cartStatus:this.cartStatus,isMobile:isMobile,backToShoppingUrl:backToShoppingUrl,editCartLink:editCartLink,isEditorialMode:this.isEditorialMode,orderConfirmation:this.props.slots.orderConfirmation&&this.props.slots.orderConfirmation.length>0?this.props.slots.orderConfirmation[0]:undefined,checkoutProps:{moduleProps:this.props,className:checkoutClass},headerProps:{className:'ms-checkout__head'},bodyProps:{className:'ms-checkout__body'},mainProps:{className:'ms-checkout__main'},mainControlProps:{className:'ms-checkout__main-control'},sideProps:{className:'ms-checkout__side'},sideControlFirstProps:{className:'ms-checkout__side-control-first'},sideControlSecondProps:{className:'ms-checkout__side-control-second'},termsAndConditionsProps:{className:'ms-checkout__terms-and-conditions'},title:checkoutHeading&&this.renderMsdyn365Text(checkoutHeading)});if(isConsentGiven===false){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(AlertComponent,Object.assign({},{message:cookieConsentRequiredMessage}))});}else if(this.isLoading()){viewProps=_objectSpread(_objectSpread({},viewProps),{},{loading:/*#__PURE__*/React.createElement(Waiting,{className:'msc-waiting-circular msc-waiting-lg'})});}else if(this.hasError){viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:/*#__PURE__*/React.createElement(AlertComponent,Object.assign({},{message:genericErrorMessage}))});}else{viewProps=_objectSpread(_objectSpread({},viewProps),{},{alert:errorMessage&&/*#__PURE__*/React.createElement(AlertComponent,Object.assign({},{message:errorMessage})),canShow:true,guidedForm:checkoutInformation?/*#__PURE__*/React.createElement(GuidedFormComponent,Object.assign({},{items:checkoutInformation,moduleState:moduleState,disableGuidedCheckoutFlow:disableGuidedCheckoutFlow,resource:resources,requestContext:this.props.context,isMobile:isMobile,isEditor:this.isEditorialMode,telemetryContent:this.telemetryContent})):undefined,orderSummary:getOrderSummary(this.props),lineItems:getLineItems(this.props,this.telemetryContent),placeOrderButton:/*#__PURE__*/React.createElement(PlaceOrderButtonComponent,Object.assign({},{placeOrderText:placeOrderText,placeOrder:this.onPlaceOrder,canPlaceOrder:this.canPlaceOrder,telemetryContent:this.telemetryContent})),termsAndConditions:termsAndConditions,keepShoppingButton:backToShoppingUrl&&/*#__PURE__*/React.createElement(Button,Object.assign({className:'ms-checkout__btn-keep-shopping msc-btn',title:backToShopping,color:'secondary',href:backToShoppingUrl},backToShoppingAttributes),backToShopping)});}return this.props.renderView(viewProps);}},{key:\"renderMsdyn365Text\",value:function renderMsdyn365Text(checkoutHeading){return/*#__PURE__*/React.createElement(Msdyn365.Text,Object.assign({},checkoutHeading,{tag:checkoutHeading.tag||'h2',className:'ms-checkout__title',text:checkoutHeading.text,editProps:{onEdit:this.handleCheckoutHeadingChange,requestContext:this.props.context.request}}));}},{key:\"cartStatus\",get:function get(){return _get(this.props,'data.checkout.status');}},{key:\"isEmptyCart\",get:function get(){if(this.isEditorialMode){return false;}var cart=_get(this.props,'data.checkout.result.checkoutCart.cart');return this.cartStatus==='SUCCESS'&&!!cart&&!isEmpty(cart)&&(!cart.CartLines||cart.CartLines.length===0);}},{key:\"hasError\",get:function get(){var cart=_get(this.props,'data.checkout.result.checkoutCart.cart');return this.cartStatus==='FAILED'||this.cartStatus==='SUCCESS'&&(!cart||isEmpty(cart));}},{key:\"isEditorialMode\",get:function get(){return _get(this.props,'context.request.params.isEditor');}},{key:\"canPlaceOrder\",get:function get(){var _this$props$data$chec;var isTermsAndConditionAccepted=this.props.data.checkout.result&&((_this$props$data$chec=this.props.data.checkout.result)===null||_this$props$data$chec===void 0?void 0:_this$props$data$chec.isTermsAndConditionAccepted);return this.props.moduleState.isReady&&(isTermsAndConditionAccepted===undefined||isTermsAndConditionAccepted)&&this.state.errorMessage==='';}}]);return Checkout;}(React.Component);__decorate([computed],Checkout.prototype,\"cartStatus\",null);__decorate([computed],Checkout.prototype,\"isEmptyCart\",null);__decorate([computed],Checkout.prototype,\"hasError\",null);__decorate([computed],Checkout.prototype,\"isEditorialMode\",null);__decorate([computed],Checkout.prototype,\"canPlaceOrder\",null);Checkout=__decorate([withModuleState,observer],Checkout);export default Checkout;","map":{"version":3,"sources":["modules/checkout/checkout.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/ //\nimport { IModuleStateManager, IModuleStateProps, withModuleState } from '@msdyn365-commerce-modules/checkout-utilities';\nimport { getAvailabilitiesForCartLineItems, ProductAvailabilitiesForCartLineItems } from '@msdyn365-commerce-modules/retail-actions';\nimport { Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, TelemetryConstant, Waiting } from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport { Cart } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport get from 'lodash/get';\nimport isEmpty from 'lodash/isEmpty';\nimport { computed, reaction, when } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { ICheckoutData } from './checkout.data';\nimport { ICheckoutHeadingData, ICheckoutProps } from './checkout.props.autogenerated';\nimport AlertComponent from './components/alert';\nimport { getLineItems, ILineItems } from './components/get-line-items';\nimport { getOrderSummary, IOrderSummary } from './components/get-order-summary';\nimport GuidedFormComponent from './components/guided-form';\nimport PlaceOrderButtonComponent from './components/place-order-button';\nimport placeOrder from './methods/place-order';\n\nexport * from './components/get-line-items';\nexport * from './components/get-order-summary';\n\ntype DeviceType = 'Mobile';\n\ninterface ICheckoutState {\n    errorMessage: string;\n}\n\nexport interface ICheckoutViewProps extends ICheckoutProps<ICheckoutData> {\n    className: string;\n    canShow?: boolean;\n    isEmptyCart?: boolean;\n    isConsentGiven?: boolean;\n    hasError?: boolean;\n    cartStatus?: string;\n    isMobile?: boolean;\n    isEditorialMode?: boolean;\n    backToShoppingUrl?: string;\n    editCartLink?: string;\n    hasSalesOrder: boolean;\n\n    checkoutProps: IModuleProps;\n    headerProps: INodeProps;\n    bodyProps: INodeProps;\n    mainProps: INodeProps;\n    mainControlProps: INodeProps;\n    sideProps: INodeProps;\n    sideControlFirstProps: INodeProps;\n    sideControlSecondProps: INodeProps;\n    termsAndConditionsProps: INodeProps;\n\n    guidedForm?: React.ReactNode;\n    title?: React.ReactNode;\n    loading?: React.ReactNode;\n    alert?: React.ReactNode;\n    orderSummary?: IOrderSummary;\n    lineItems?: ILineItems;\n    placeOrderButton?: React.ReactNode;\n    termsAndConditions?: React.ReactNode;\n    keepShoppingButton?: React.ReactNode;\n    orderConfirmation?: React.ReactNode;\n}\n\nexport interface ICheckoutModuleProps extends ICheckoutProps<ICheckoutData>, IModuleStateProps { }\n\n/**\n *\n * CheckoutContainer component\n * @extends {React.Component<ICheckoutModuleProps>}\n */\n// @ts-ignore\n@withModuleState\n@observer\nclass Checkout extends React.Component<ICheckoutModuleProps> {\n\n    @computed get cartStatus(): Msdyn365.AsyncResultStatus {\n        return get(this.props, 'data.checkout.status');\n    }\n\n    @computed get isEmptyCart(): boolean {\n        if (this.isEditorialMode) {\n            // Editorial mode: Ignore empty cart\n            return false;\n        }\n        const cart = get(this.props, 'data.checkout.result.checkoutCart.cart');\n        return this.cartStatus === 'SUCCESS' && !!cart && !isEmpty(cart) && (!cart.CartLines || cart.CartLines.length === 0);\n    }\n\n    @computed get hasError(): boolean {\n        const cart = get(this.props, 'data.checkout.result.checkoutCart.cart');\n        return this.cartStatus === 'FAILED' || (this.cartStatus === 'SUCCESS' && (!cart || isEmpty(cart)));\n    }\n\n    @computed get isEditorialMode(): boolean {\n        return get(this.props, 'context.request.params.isEditor');\n    }\n\n    @computed get canPlaceOrder(): boolean {\n        const isTermsAndConditionAccepted = this.props.data.checkout.result && this.props.data.checkout.result?.isTermsAndConditionAccepted;\n        // if isTermsAndConditionAccepted is undefined means TermsAndCondition module is not added to page and we should able to place order.\n        return this.props.moduleState.isReady && (isTermsAndConditionAccepted === undefined || isTermsAndConditionAccepted) && this.state.errorMessage === '';\n    }\n    public state: ICheckoutState = {\n        errorMessage: ''\n    };\n    private telemetryContent: ITelemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!,\n                                                                     this.props.friendlyName,\n                                                                     this.props.telemetry);\n\n    public componentDidMount(): void {\n        const {\n            resources: { genericErrorMessage }\n        } = this.props;\n        // @ts-ignore: Compiler not reconizing condition check for function params\n        when(\n            () => this.hasError,\n            () => {\n                this.setState({\n                    errorMessage: genericErrorMessage\n                });\n                this.props.context.telemetry.error('Failed to get cart');\n            }\n        );\n\n        // @ts-ignore: Compiler not reconizing condition check for function params\n        when(\n            () => {\n                return this.isEmptyCart;\n            },\n            () => {\n                const editCartLink = Msdyn365.getUrlSync('cart', this.props.context.actionContext) || '';\n                if (window && editCartLink) {\n                    // Redirect to cart page if cart is empty\n                    window.location.assign(editCartLink);\n                } else {\n                    this.setState({\n                        errorMessage: genericErrorMessage\n                    });\n                    this.props.context.telemetry.error('Cart is empty, but no editCartLink found');\n                }\n            }\n        );\n\n        reaction(\n            () => this.props.moduleState.isReady,\n            () => {\n                this.onContainerReady();\n            }\n        );\n    }\n\n    // tslint:disable-next-line:max-func-body-length cyclomatic-complexity\n    public render(): JSX.Element {\n        const {\n            moduleState,\n            config: { className, checkoutHeading, disableGuidedCheckoutFlow },\n            resources\n        } = this.props;\n        const { errorMessage } = this.state;\n        const { backToShopping, placeOrderText, cookieConsentRequiredMessage, genericErrorMessage } = resources;\n        const checkoutClass = classnames('ms-checkout', className);\n        const checkoutInformation = this.getSlotItems('checkoutInformation');\n\n        const isConsentGiven =\n            this.props.context.request &&\n            this.props.context.request.cookies &&\n            this.props.context.request.cookies.isConsentGiven &&\n            this.props.context.request.cookies.isConsentGiven();\n\n        const isMobile =\n            this.props.context.request &&\n            this.props.context.request.device &&\n            (this.props.context.request.device.Type as DeviceType) === 'Mobile';\n\n        const backToShoppingUrl = Msdyn365.getUrlSync('home', this.props.context.actionContext) || '';\n        const editCartLink = Msdyn365.getUrlSync('cart', this.props.context.actionContext) || '';\n\n        const termsAndConditions =\n            this.props.slots.termsAndConditions &&\n            this.props.slots.termsAndConditions.length > 0 &&\n            this.props.slots.termsAndConditions[0];\n\n        const payLoad = getPayloadObject('click', this.telemetryContent, TelemetryConstant.BackToShopping);\n        const backToShoppingAttributes =  getTelemetryAttributes(this.telemetryContent, payLoad);\n\n        let viewProps: ICheckoutViewProps = {\n            ...this.props,\n            className: checkoutClass,\n            isEmptyCart: this.isEmptyCart,\n            isConsentGiven,\n            hasError: this.hasError,\n            hasSalesOrder: this.props.data.checkout && this.props.data.checkout.result !== undefined && this.props.data.checkout.result.salesOrder !== undefined,\n            cartStatus: this.cartStatus,\n            isMobile,\n            backToShoppingUrl,\n            editCartLink,\n            isEditorialMode: this.isEditorialMode,\n            orderConfirmation: this.props.slots.orderConfirmation && this.props.slots.orderConfirmation.length > 0 ? this.props.slots.orderConfirmation[0] : undefined,\n            checkoutProps: { moduleProps: this.props, className: checkoutClass },\n            headerProps: { className: 'ms-checkout__head' },\n            bodyProps: { className: 'ms-checkout__body' },\n            mainProps: { className: 'ms-checkout__main' },\n            mainControlProps: { className: 'ms-checkout__main-control' },\n            sideProps: { className: 'ms-checkout__side' },\n            sideControlFirstProps: { className: 'ms-checkout__side-control-first' },\n            sideControlSecondProps: { className: 'ms-checkout__side-control-second' },\n            termsAndConditionsProps: { className: 'ms-checkout__terms-and-conditions' },\n            title: checkoutHeading && (\n                this.renderMsdyn365Text(checkoutHeading)\n            )\n        };\n\n        if (isConsentGiven === false) {\n            viewProps = {\n                ...viewProps,\n                alert: <AlertComponent {...{ message: cookieConsentRequiredMessage }} />\n            };\n        } else if (this.isLoading()) {\n            viewProps = {\n                ...viewProps,\n                loading: <Waiting className='msc-waiting-circular msc-waiting-lg' />\n            };\n        } else if (this.hasError) {\n            viewProps = {\n                ...viewProps,\n                alert: <AlertComponent {...{ message: genericErrorMessage }} />\n            };\n        } else {\n            viewProps = {\n                ...viewProps,\n                alert: errorMessage && <AlertComponent {...{ message: errorMessage }} />,\n                canShow: true,\n                guidedForm: checkoutInformation ? (\n                    <GuidedFormComponent\n                        {...{\n                            items: checkoutInformation,\n                            moduleState: moduleState,\n                            disableGuidedCheckoutFlow: disableGuidedCheckoutFlow,\n                            resource: resources,\n                            requestContext: this.props.context,\n                            isMobile: isMobile,\n                            isEditor: this.isEditorialMode,\n                            telemetryContent: this.telemetryContent\n                        }}\n                    />\n                ) : (\n                        undefined\n                    ),\n                orderSummary: getOrderSummary(this.props),\n                lineItems: getLineItems(this.props, this.telemetryContent),\n                placeOrderButton: (\n                    <PlaceOrderButtonComponent {...{ placeOrderText, placeOrder: this.onPlaceOrder, canPlaceOrder: this.canPlaceOrder, telemetryContent: this.telemetryContent }} />\n                ),\n                termsAndConditions: termsAndConditions,\n                keepShoppingButton: backToShoppingUrl && (\n                    <Button\n                        className='ms-checkout__btn-keep-shopping msc-btn'\n                        title={backToShopping}\n                        color='secondary'\n                        href={backToShoppingUrl}\n                        {...backToShoppingAttributes}\n                    >\n                        {backToShopping}\n                    </Button>\n                )\n            };\n        }\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public renderMsdyn365Text(checkoutHeading: ICheckoutHeadingData): React.ReactNode {\n        return (\n            <Msdyn365.Text\n                {...checkoutHeading}\n                tag={checkoutHeading.tag || 'h2'}\n                className='ms-checkout__title'\n                text={checkoutHeading.text}\n                editProps={{ onEdit: this.handleCheckoutHeadingChange, requestContext: this.props.context.request }}\n            />\n        );\n    }\n\n    public handleCheckoutHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.checkoutHeading!.text = event.target.value;\n\n    private isLoading = (): boolean => {\n        return !this.cartStatus || this.cartStatus === 'LOADING' || this.isEmptyCart;\n    }\n\n    private getSlotItems = (key: string): React.ReactNode[] | undefined => {\n        const { slots } = this.props;\n        return slots && slots[key] && slots[key].length ? slots[key] : undefined;\n    };\n\n    private onPlaceOrder = async (): Promise<void> => {\n         const {\n            resources: { checkoutOutOfStockErrorMessage, genericErrorMessage },\n            context: { actionContext, app: { config: { enableStockCheck = false } } },\n            slots: { orderConfirmation },\n            data: { checkout }\n         } = this.props;\n\n         if (enableStockCheck && await this.isOverMaxQuantity((await checkout).checkoutCart.cart)) {\n            this.setState({\n                errorMessage: checkoutOutOfStockErrorMessage\n            });\n            this.props.context.telemetry.error(checkoutOutOfStockErrorMessage);\n        } else {\n            const hasOrderConfirmation = orderConfirmation && orderConfirmation.length > 0;\n            await placeOrder(actionContext, this.props.data.checkout.result, this.props.data.products.result, !hasOrderConfirmation).catch(error => {\n                this.setState({\n                    errorMessage: genericErrorMessage\n                });\n                this.props.telemetry.exception(error);\n            });\n        }\n    };\n\n    // return true if any product in the cart is over its max quantity\n    private isOverMaxQuantity = async (cart: Cart): Promise<boolean> => {\n        let isOverMaxQuantity = false;\n\n        await getAvailabilitiesForCartLineItems(\n            new ProductAvailabilitiesForCartLineItems(this.props.context.actionContext.requestContext.apiSettings),\n            this.props.context.actionContext\n        ).then(productInventoryInformation => {\n            cart.CartLines?.map((cartline) => {\n                if (productInventoryInformation && productInventoryInformation.length > 0) {\n                    const foundProductAvailability = productInventoryInformation.find((productInventory) => {\n                        return productInventory.ProductAvailableQuantity?.ProductId! === cartline.ProductId;\n                    });\n\n                    if (!(foundProductAvailability?.IsProductAvailable && foundProductAvailability.ProductAvailableQuantity.AvailableQuantity !== undefined\n                        && cartline.Quantity && cartline.Quantity <= foundProductAvailability.ProductAvailableQuantity.AvailableQuantity)) {\n                        isOverMaxQuantity = true;\n                    }\n                }\n            });\n        })\n        .catch(error => {\n            this.props.context.actionContext.telemetry.exception(error);\n            throw new Error('[getAvailabilitiesForCartLineItems] Unable to get availabilities for products in checkout cart');\n        });\n\n        return isOverMaxQuantity;\n    }\n\n    private getActiveChildModuleStates = (): IModuleStateManager[] => {\n        const { childIds, getModule } = this.props.moduleState;\n        return childIds\n            .map(getModule)\n            .filter((state): state is IModuleStateManager => !!state && !state.isDisabled && state.hasModuleState);\n    };\n\n    private onContainerReady = (): void => {\n        this.getActiveChildModuleStates().forEach(state => {\n            state.isReady && state.onContainerReady && state.onContainerReady();\n        });\n    };\n}\n\nexport default Checkout;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}