{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";/*!\r\n * Copyright (c) Microsoft Corporation.\r\n * All rights reserved. See LICENSE in the project root for license information.\r\n */import{createObservableDataAction}from'@msdyn365-commerce/core';import{getByIdsAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import{getProductImageUrls}from'../utils/product-list-utils';var buildCacheKey=function buildCacheKey(base,apiSettings){return\"\".concat(base,\"-chanId:\").concat(apiSettings.channelId,\"-catId:\").concat(apiSettings.catalogId);};/**\r\n * Product Input\r\n */export var ProductInput=function ProductInput(productId,apiSettings){var _this=this;_classCallCheck(this,ProductInput);this.getCacheKey=function(){return buildCacheKey(\"RecordId-\".concat(_this.productId.toString()),_this.apiSettings);};this.getCacheObjectType=function(){return'SimpleProduct';};this.dataCacheType=function(){return'application';};this.apiSettings=apiSettings;this.productId=+productId;this.channelId=apiSettings.channelId;};/**\r\n * Calls the Retail API and returns the product based on the passed ProductInput\r\n */export function getSimpleProductsAction(_x,_x2){return _getSimpleProductsAction.apply(this,arguments);}function _getSimpleProductsAction(){_getSimpleProductsAction=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(inputs,ctx){var productIdMapping,productIds;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!inputs||!Array.isArray(inputs)||inputs.length===0)){_context.next=3;break;}ctx.trace('[getSimpleProductsAction] Invalid or empty inputs passed.');return _context.abrupt(\"return\",[]);case 3:productIdMapping={};productIds=inputs.map(function(input,idx){productIdMapping[input.productId]=idx;return input.productId;});return _context.abrupt(\"return\",getByIdsAsync({callerContext:ctx},inputs[0].channelId,productIds).then(function(products){if(!products){return[];}var mappedProducts=getProductImageUrls(products,ctx.requestContext.apiSettings).reduce(function(memo,product){if(!product){return memo;}var idx=productIdMapping[product.RecordId];memo[idx]=product;return memo;},[]);// NOTE: <ZAFINE> This is not an ideal fix, but will resolve all current issues\nreturn inputs.map(function(input){var foundProduct=mappedProducts.find(function(product){return product&&product.RecordId===input.productId;});return foundProduct||{};});}));case 6:case\"end\":return _context.stop();}}},_callee);}));return _getSimpleProductsAction.apply(this,arguments);}export default createObservableDataAction({action:getSimpleProductsAction,id:'@msdyn365-commerce/get-simple-products',isBatched:true});","map":{"version":3,"sources":["../../../src/hydrators/get-simple-products.ts"],"names":[],"mappings":"8MAAA;;;AAGG,GAEH,OAEI,0BAFJ,KAQO,yBARP,CASA,OAAS,aAAT,KAA8B,wEAA9B,CAGA,OAAS,mBAAT,KAAoC,6BAApC,CAEA,GAAM,CAAA,aAAa,CAAG,QAAhB,CAAA,aAAgB,CAAC,IAAD,CAAe,WAAf,CAA4D,CAC9E,gBAAU,IAAV,oBAAyB,WAAW,CAAC,SAArC,mBAAwD,WAAW,CAAC,SAApE,EACH,CAFD,CAIA;;AAEG,GACH,UAAa,CAAA,YAAb,CAKI,sBAAY,SAAZ,CAAwC,WAAxC,CAAyE,mDAMlE,KAAA,WAAA,CAAc,iBAAM,CAAA,aAAa,oBAAa,KAAI,CAAC,SAAL,CAAe,QAAf,EAAb,EAA0C,KAAI,CAAC,WAA/C,CAAnB,EAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,eAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,aAAjB,EAAhB,CAPH,KAAK,WAAL,CAAmB,WAAnB,CACA,KAAK,SAAL,CAAiB,CAAC,SAAlB,CACA,KAAK,SAAL,CAAiB,WAAW,CAAC,SAA7B,CACH,CATL,CAgBA;;AAEG,GACH,eAAsB,CAAA,uBAAtB,gE,qHAAO,iBAAuC,MAAvC,CAA+D,GAA/D,uJACC,CAAC,MAAD,EAAW,CAAC,KAAK,CAAC,OAAN,CAAc,MAAd,CAAZ,EAAqC,MAAM,CAAC,MAAP,GAAkB,CADxD,0BAEC,GAAG,CAAC,KAAJ,CAAU,2DAAV,EAFD,gCAGQ,EAHR,SAMG,gBANH,CAM2C,EAN3C,CAOG,UAPH,CAOgB,MAAM,CAAC,GAAP,CAAW,SAAC,KAAD,CAAQ,GAAR,CAAe,CACzC,gBAAgB,CAAC,KAAK,CAAC,SAAP,CAAhB,CAAoC,GAApC,CACA,MAAO,CAAA,KAAK,CAAC,SAAb,CACH,CAHkB,CAPhB,iCAYI,aAAa,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,MAAM,CAAC,CAAD,CAAN,CAAU,SAAnC,CAA8C,UAA9C,CAAb,CAAuE,IAAvE,CAA4E,SAAA,QAAQ,CAAG,CAC1F,GAAI,CAAC,QAAL,CAAe,CACX,MAAO,EAAP,CACH,CACD,GAAM,CAAA,cAAc,CAAqB,mBAAmB,CAAC,QAAD,CAAW,GAAG,CAAC,cAAJ,CAAmB,WAA9B,CAAnB,CAA+D,MAA/D,CACrC,SAAC,IAAD,CAAwB,OAAxB,CAA8D,CAC1D,GAAI,CAAC,OAAL,CAAc,CACV,MAAO,CAAA,IAAP,CACH,CACD,GAAM,CAAA,GAAG,CAAG,gBAAgB,CAAC,OAAO,CAAC,QAAT,CAA5B,CACA,IAAI,CAAC,GAAD,CAAJ,CAAY,OAAZ,CACA,MAAO,CAAA,IAAP,CACH,CARoC,CASrC,EATqC,CAAzC,CAYA;AACA,MAAO,CAAA,MAAM,CAAC,GAAP,CAAW,SAAA,KAAK,CAAG,CACtB,GAAM,CAAA,YAAY,CAAG,cAAc,CAAC,IAAf,CAAoB,SAAA,OAAO,QAAI,CAAA,OAAO,EAAI,OAAO,CAAC,QAAR,GAAqB,KAAK,CAAC,SAA1C,EAA3B,CAArB,CACA,MAAO,CAAA,YAAY,EAAmB,EAAtC,CACH,CAHM,CAAP,CAIH,CArBM,CAZJ,wD,0DAoCP,cAAe,CAAA,0BAA0B,CAAC,CACtC,MAAM,CAA4B,uBADI,CAEtC,EAAE,CAAE,wCAFkC,CAGtC,SAAS,CAAE,IAH2B,CAAD,CAAzC","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport {\n    CacheType,\n    createObservableDataAction,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICommerceApiSettings,\n    IDictionary\n} from '@msdyn365-commerce/core';\nimport { getByIdsAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { SimpleProduct } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\n\nimport { getProductImageUrls } from '../utils/product-list-utils';\n\nconst buildCacheKey = (base: string, apiSettings: ICommerceApiSettings): string => {\n    return `${base}-chanId:${apiSettings.channelId}-catId:${apiSettings.catalogId}`;\n};\n\n/**\n * Product Input\n */\nexport class ProductInput implements IActionInput {\n    public productId: number;\n    public channelId: number;\n    private apiSettings: ICommerceApiSettings;\n\n    constructor(productId: number | string, apiSettings: ICommerceApiSettings) {\n        this.apiSettings = apiSettings;\n        this.productId = +productId;\n        this.channelId = apiSettings.channelId;\n    }\n\n    public getCacheKey = () => buildCacheKey(`RecordId-${this.productId.toString()}`, this.apiSettings);\n    public getCacheObjectType = () => 'SimpleProduct';\n    public dataCacheType = (): CacheType => 'application';\n}\n\n/**\n * Calls the Retail API and returns the product based on the passed ProductInput\n */\nexport async function getSimpleProductsAction(inputs: ProductInput[], ctx: IActionContext): Promise<SimpleProduct[]> {\n    if (!inputs || !Array.isArray(inputs) || inputs.length === 0) {\n        ctx.trace('[getSimpleProductsAction] Invalid or empty inputs passed.');\n        return [];\n    }\n\n    const productIdMapping: IDictionary<number> = {};\n    const productIds = inputs.map((input, idx) => {\n        productIdMapping[input.productId] = idx;\n        return input.productId;\n    });\n\n    return getByIdsAsync({ callerContext: ctx }, inputs[0].channelId, productIds).then(products => {\n        if (!products) {\n            return [];\n        }\n        const mappedProducts = (<SimpleProduct[]>getProductImageUrls(products, ctx.requestContext.apiSettings)).reduce(\n            (memo: SimpleProduct[], product: SimpleProduct | undefined) => {\n                if (!product) {\n                    return memo;\n                }\n                const idx = productIdMapping[product.RecordId];\n                memo[idx] = product;\n                return memo;\n            },\n            []\n        );\n\n        // NOTE: <ZAFINE> This is not an ideal fix, but will resolve all current issues\n        return inputs.map(input => {\n            const foundProduct = mappedProducts.find(product => product && product.RecordId === input.productId);\n            return foundProduct || <SimpleProduct>{};\n        });\n    });\n}\n\nexport default createObservableDataAction({\n    action: <IAction<SimpleProduct[]>>getSimpleProductsAction,\n    id: '@msdyn365-commerce/get-simple-products',\n    isBatched: true\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}