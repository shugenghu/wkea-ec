{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import{Button,getPayloadObject,getTelemetryAttributes,getTelemetryObject,TelemetryConstant,UncontrolledTooltip}from'@msdyn365-commerce-modules/utilities';import{CartIconComponent}from'@msdyn365-commerce/components';import{getUrlSync,msdyn365Commerce,TelemetryEvent}from'@msdyn365-commerce/core';import classnames from'classnames';import{reaction}from'mobx';import{observer}from'mobx-react';import React from'react';import{FlyoutCartLineItems}from'./components/flyout-cart-line-items';import{getMiniCartData}from'./utils/get-products-in-mini-cart';var CartIcon=/*#__PURE__*/function(_React$Component){_inherits(CartIcon,_React$Component);var _super=_createSuper(CartIcon);function CartIcon(props){var _this;_classCallCheck(this,CartIcon);_this=_super.call(this,props);_this._getImageSettings=function(imageSettings){return imageSettings||{viewports:{xs:{q:\"w=80&h=94&m=6\",w:0,h:0},sm:{q:\"w=148&h=174&m=6\",w:0,h:0},lg:{q:\"w=148&h=174&m=6\",w:0,h:0}},lazyload:true};};_this._removeItemFromCartHandler=function(cartlineToRemove){if(_this.props.data.cart.result){var input={cartLineIds:[cartlineToRemove.LineId.toString()]};_this.props.data.cart.result.removeCartLines(input)[\"catch\"](function(error){_this.props.telemetry.warning(error);_this.props.telemetry.debug('Unable to Remove Cart Line');});}};_this.state={miniCartData:{}};_this.telemetryContent=getTelemetryObject(_this.props.context.request.telemetryPageName,_this.props.friendlyName,_this.props.telemetry);var payload=getPayloadObject(TelemetryEvent.CheckOut,_this.telemetryContent,TelemetryConstant.Checkout);_this.checkoutBySignInAttributes=getTelemetryAttributes(_this.telemetryContent,payload);payload.contentAction.etext=TelemetryConstant.GuestCheckout;_this.checkoutByGuestAttributes=getTelemetryAttributes(_this.telemetryContent,payload);payload.contentAction.etext=TelemetryConstant.ViewShoppingBag;_this.viewShoppingBagAttributes=getTelemetryAttributes(_this.telemetryContent,payload);return _this;}_createClass(CartIcon,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this2=this;var context;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:context=this.props.context.actionContext;if(!(this.props.data.cart&&this.props.data.cart.result&&this.props.data.cart.result.cart.CartLines)){_context2.next=8;break;}_context2.t0=this;_context2.next=5;return getMiniCartData(context);case 5:_context2.t1=_context2.sent;_context2.t2={miniCartData:_context2.t1};_context2.t0.setState.call(_context2.t0,_context2.t2);case 8:reaction(function(){var _this2$props$data$car;return(_this2$props$data$car=_this2.props.data.cart.result)===null||_this2$props$data$car===void 0?void 0:_this2$props$data$car.cart.CartLines;},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=_this2;_context.next=3;return getMiniCartData(context);case 3:_context.t1=_context.sent;_context.t2={miniCartData:_context.t1};_context.t0.setState.call(_context.t0,_context.t2);case 6:case\"end\":return _context.stop();}}},_callee);})));this.setState({orgUnitLocations:this.props.data.orgUnitLocations.result});case 10:case\"end\":return _context2.stop();}}},_callee2,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this$props=this.props,id=_this$props.id,typeName=_this$props.typeName,cart=_this$props.data.cart.result,enableHoverCart=_this$props.config.enableHoverCart,_this$props$context$r=_this$props.context.request.user,isAuthenticated=_this$props$context$r.isAuthenticated,signInUrl=_this$props$context$r.signInUrl,context=_this$props.context,resources=_this$props.resources;var guestCheckoutUrl=getUrlSync('checkout',this.props.context.actionContext)||'';var cartUrl=getUrlSync('cart',this.props.context.actionContext)||'';var checkoutURL=this._getCheckoutURL(isAuthenticated,guestCheckoutUrl,signInUrl||'');var isCartEmpty=cart&&cart.cart.CartLines&&cart.cart.CartLines.length===0;var cartLines=this._getCartLines();var hasErrors=cartLines?cartLines.some(function(cartline){return cartline.hasError;}):false;var includeFlyout=this.props.data.cart.status==='SUCCESS'&&enableHoverCart;var cartSize=cartLines?cartLines.length:0;var goToCartButtonText=resources.goToCartButtonTitle.replace('{count}',cartSize.toString());var flyoutTitle=resources.flyoutTitle;var price=cart&&cart.cart.TotalAmount||undefined;var priceString=price?resources.totalPriceFormatString.replace('{price}',context.cultureFormatter.formatCurrency(price)):'';var viewProps=_objectSpread(_objectSpread({},this.props),{},{cartIcon:cart&&/*#__PURE__*/React.createElement(CartIconComponent,{cartLabel:resources.cartLabel,context:context,id:id,typeName:typeName,data:{cart:cart},telemetryContent:this.telemetryContent}),cartlines:cartLines,FlyoutContainer:includeFlyout?{tag:UncontrolledTooltip,placement:'bottom-end',hideArrow:true,className:'ms-cart-icon__flyout-container',trigger:'hover focus',displayMode:'FLYOUT',target:id}:undefined,CartlinesWrapper:{className:'ms-cart-icon__cart-lines'},miniCartWrapper:{className:classnames('ms-cart-icon'),id:this.props.id},miniCartItemWrapper:{className:classnames('msc-cart-lines-item')},checkoutAsSignInUserButton:!isCartEmpty?/*#__PURE__*/React.createElement(Button,Object.assign({disabled:hasErrors,className:'ms-cart-icon__btn-checkout',href:checkoutURL,title:resources.checkoutButtonTitle},this.checkoutBySignInAttributes),resources.checkoutButtonTitle):null,checkoutAsGuestButton:!isCartEmpty&&!isAuthenticated?/*#__PURE__*/React.createElement(Button,Object.assign({disabled:hasErrors,className:'ms-cart-icon__btn-guestcheckout',href:guestCheckoutUrl,title:resources.guestCheckoutButtonTitle},this.checkoutByGuestAttributes),resources.guestCheckoutButtonTitle):null,goToCartButton:/*#__PURE__*/React.createElement(Button,Object.assign({className:'ms-cart-icon__btn-gotocart',href:cartUrl,title:goToCartButtonText},this.viewShoppingBagAttributes),goToCartButtonText),flyoutTitle:/*#__PURE__*/React.createElement(\"span\",{className:\"ms-cart-icon__flyout-title\"},flyoutTitle),totalPrice:/*#__PURE__*/React.createElement(\"div\",{className:\"ms-cart-icon__subtotal\"},priceString)});return this.props.renderView(viewProps);}},{key:\"_getCheckoutURL\",value:function _getCheckoutURL(isAuthenticated,guestCheckoutUrl,signInUrl){if(isAuthenticated){return guestCheckoutUrl;}var absoluteUrlRegExp=new RegExp('^(?:[a-z]+:)?//','i');var isAbsoluteUrl=absoluteUrlRegExp.test(guestCheckoutUrl);var returnURL=guestCheckoutUrl;if(msdyn365Commerce.isBrowser&&!isAbsoluteUrl){returnURL=\"\".concat(window.location.origin).concat(guestCheckoutUrl);}return\"\".concat(signInUrl).concat(signInUrl.indexOf('?')===-1?'?':'&',\"ru=\").concat(returnURL);}},{key:\"_getCartLines\",value:function _getCartLines(){var _this$props2=this.props,cart=_this$props2.data.cart.result,_this$props2$context$=_this$props2.context.request.channel;_this$props2$context$=_this$props2$context$===void 0?{PickupDeliveryModeCode:undefined}:_this$props2$context$;var PickupDeliveryModeCode=_this$props2$context$.PickupDeliveryModeCode,config=_this$props2.config,telemetry=_this$props2.telemetry,resources=_this$props2.resources;var imageSettings=this._getImageSettings(config.imageSettings);return this.state.miniCartData.products&&cart&&cart.cart.CartLines&&cart.cart.CartLines.length>0?FlyoutCartLineItems({cartlines:cart.cart.CartLines,products:this.state.miniCartData.products,productAvailabilites:this.state.miniCartData.productAvailabilites,productDeliveryOptions:this.state.miniCartData.deliveryOptions,imageSettings:imageSettings,outOfStockThreshold:this.props.context.app.config.outOfStockThreshold||0,isStockCheckEnabled:this.props.context.app.config.enableStockCheck||false,maxCartlineQuantity:this.props.context.app.config.maxQuantityForCartLineItem,gridSettings:this.props.context.request.gridSettings,context:this.props.context,typeName:this.props.typeName,id:this.props.id,resources:{sizeString:resources.productDimensionTypeSize,colorString:resources.productDimensionTypeColor,configString:resources.productDimensionTypeConfiguration,styleString:resources.productDimensionTypeStyle,quantityDisplayString:resources.quantityDisplayText,inputQuantityAriaLabel:'',discountStringText:'',originalPriceText:'',currentPriceText:'',shippingChargesText:''},telemetry:telemetry,removeButtonText:resources.removeCartButtonText,outOfStockText:'',outOfRangeOneText:'',outOfRangeFormatText:'',cartState:this.props.data.cart.result,orgUnitLocations:this.state.orgUnitLocations,removeItemClickHandler:this._removeItemFromCartHandler,pickupDeliveryModeCode:PickupDeliveryModeCode,telemetryContent:this.telemetryContent}):null;}}]);return CartIcon;}(React.Component);CartIcon=__decorate([observer],CartIcon);export default CartIcon;","map":{"version":3,"sources":["modules/cart-icon/cart-icon.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, INodeProps, ITelemetryContent, TelemetryConstant, UncontrolledTooltip } from '@msdyn365-commerce-modules/utilities';\nimport { CartIconComponent } from '@msdyn365-commerce/components';\nimport { getUrlSync, IDictionary, IImageSettings, msdyn365Commerce, TelemetryEvent } from '@msdyn365-commerce/core';\nimport { CartLine, OrgUnitLocation } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport { reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport React from 'react';\nimport { ICartIconData } from './cart-icon.data';\nimport { ICartIconProps } from './cart-icon.props.autogenerated';\nimport { FlyoutCartLineItems, IFlyoutCartLineItemViewProps } from './components/flyout-cart-line-items';\nimport { getMiniCartData, IMiniCartData } from './utils/get-products-in-mini-cart';\n\nexport interface IMiniCartState {\n    miniCartData: IMiniCartData;\n    orgUnitLocations?: OrgUnitLocation[];\n}\n\nexport interface ICartIconViewProps extends ICartIconProps<ICartIconData> {\n    className: string;\n    cartIcon: React.ReactNode;\n\n    FlyoutContainer?: INodeProps;\n\n    CartlinesWrapper: INodeProps;\n    miniCartWrapper: INodeProps;\n    miniCartItemWrapper: INodeProps;\n    cartlines?: IFlyoutCartLineItemViewProps[];\n    flyoutTitle: React.ReactNode;\n    totalPrice: React.ReactNode;\n\n    checkoutAsGuestButton?: React.ReactNode;\n    checkoutAsSignInUserButton?: React.ReactNode;\n    goToCartButton?: React.ReactNode;\n    waitingComponent?: React.ReactNode;\n\n    isCartLoading: boolean;\n\n    removeItemClickHandler(cartlineToRemove: CartLine): void;\n}\n\n/**\n *\n * Cart component\n * @extends {React.PureComponent<ICartProps<ICartData>>}\n */\n@observer\nclass CartIcon extends React.Component<ICartIconProps<ICartIconData>, IMiniCartState> {\n    private telemetryContent: ITelemetryContent;\n    private checkoutBySignInAttributes: IDictionary<string> | undefined;\n    private checkoutByGuestAttributes: IDictionary<string> | undefined;\n    private viewShoppingBagAttributes: IDictionary<string> | undefined;\n    constructor(props: ICartIconProps<ICartIconData>) {\n        super(props);\n        this.state = { miniCartData: {} };\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n        const payload = getPayloadObject(TelemetryEvent.CheckOut, this.telemetryContent, TelemetryConstant.Checkout);\n        this.checkoutBySignInAttributes = getTelemetryAttributes(this.telemetryContent, payload);\n\n        payload.contentAction.etext = TelemetryConstant.GuestCheckout;\n        this.checkoutByGuestAttributes = getTelemetryAttributes(this.telemetryContent, payload);\n\n        payload.contentAction.etext = TelemetryConstant.ViewShoppingBag;\n        this.viewShoppingBagAttributes = getTelemetryAttributes(this.telemetryContent, payload);\n    }\n\n    public async componentDidMount(): Promise<void> {\n        const context = this.props.context.actionContext;\n\n        if(this.props.data.cart && this.props.data.cart.result && this.props.data.cart.result.cart.CartLines) {\n            this.setState({\n                miniCartData: await getMiniCartData(context)\n            });\n        }\n\n        reaction(\n            () => this.props.data.cart.result?.cart.CartLines,\n            async () => {\n                this.setState({\n                    miniCartData: await getMiniCartData(context)\n                });\n            }\n        );\n\n        this.setState({\n            orgUnitLocations: this.props.data.orgUnitLocations.result\n        });\n    }\n\n    public render(): JSX.Element | null {\n        const {\n            id,\n            typeName,\n            data: {\n                cart: { result: cart }\n            },\n            config: {\n                enableHoverCart\n            },\n            context: {\n                request: {\n                    user: {\n                        isAuthenticated,\n                        signInUrl\n                    }\n                }\n            },\n            context,\n            resources\n        } = this.props;\n\n        const guestCheckoutUrl = getUrlSync('checkout', this.props.context.actionContext) || '';\n        const cartUrl = getUrlSync('cart', this.props.context.actionContext) || '';\n        const checkoutURL = this._getCheckoutURL(isAuthenticated, guestCheckoutUrl, signInUrl || '');\n        const isCartEmpty = cart && cart.cart.CartLines && cart.cart.CartLines.length === 0;\n        const cartLines = this._getCartLines();\n        const hasErrors = cartLines ? cartLines.some(cartline => cartline.hasError) : false;\n        const includeFlyout = this.props.data.cart.status === 'SUCCESS' && enableHoverCart;\n        const cartSize = cartLines ? cartLines.length : 0;\n        const goToCartButtonText = resources.goToCartButtonTitle.replace('{count}', cartSize.toString());\n        const flyoutTitle = resources.flyoutTitle;\n        const price = cart && cart.cart.TotalAmount || undefined;\n        const priceString = price ? resources.totalPriceFormatString.replace('{price}', context.cultureFormatter.formatCurrency(price)) : '';\n\n        const viewProps = {\n            ...this.props,\n            cartIcon: cart && (\n                <CartIconComponent\n                    cartLabel={resources.cartLabel}\n                    context={context}\n                    id={id}\n                    typeName={typeName}\n                    data={{cart: cart}}\n                    telemetryContent={this.telemetryContent}\n                />\n            ),\n            cartlines: cartLines,\n            FlyoutContainer: includeFlyout ? {\n                tag: UncontrolledTooltip,\n                placement: 'bottom-end',\n                hideArrow: true,\n                className: 'ms-cart-icon__flyout-container',\n                trigger: 'hover focus',\n                displayMode: 'FLYOUT',\n                target: id\n            } : undefined,\n            CartlinesWrapper: {\n                className: 'ms-cart-icon__cart-lines'\n            },\n            miniCartWrapper: {\n                className: classnames('ms-cart-icon'),\n                id: this.props.id\n            },\n            miniCartItemWrapper: {\n                className: classnames('msc-cart-lines-item')\n            },\n            checkoutAsSignInUserButton: (!isCartEmpty) ?\n            (\n                <Button disabled={hasErrors} className={'ms-cart-icon__btn-checkout'} href={checkoutURL} title={resources.checkoutButtonTitle}{...this.checkoutBySignInAttributes}>{resources.checkoutButtonTitle}</Button>\n            ) : null,\n            checkoutAsGuestButton: (!isCartEmpty && !isAuthenticated) ?\n            (\n                <Button disabled={hasErrors} className={'ms-cart-icon__btn-guestcheckout'} href={guestCheckoutUrl} title={resources.guestCheckoutButtonTitle}{...this.checkoutByGuestAttributes}>{resources.guestCheckoutButtonTitle}</Button>\n            ) : null,\n            goToCartButton:\n            (\n                <Button className={'ms-cart-icon__btn-gotocart'} href={cartUrl} title={goToCartButtonText} {...this.viewShoppingBagAttributes}>{goToCartButtonText}</Button>\n            ),\n            flyoutTitle:\n            (\n                <span className={`ms-cart-icon__flyout-title`}>{flyoutTitle}</span>\n            ),\n            totalPrice:\n            (\n                <div className={`ms-cart-icon__subtotal`}>{priceString}</div>\n            )\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private _getCheckoutURL(isAuthenticated: boolean, guestCheckoutUrl: string, signInUrl: string): string {\n        if (isAuthenticated) {\n            return guestCheckoutUrl;\n        }\n\n        const absoluteUrlRegExp = new RegExp('^(?:[a-z]+:)?//', 'i');\n        const isAbsoluteUrl = absoluteUrlRegExp.test(guestCheckoutUrl);\n        let returnURL = guestCheckoutUrl;\n        if (msdyn365Commerce.isBrowser && !isAbsoluteUrl) {\n            returnURL = `${window.location.origin}${guestCheckoutUrl}`;\n        }\n\n        return `${signInUrl}${signInUrl.indexOf('?') === -1 ? '?' : '&'}ru=${returnURL}`;\n    }\n\n    private _getCartLines(): IFlyoutCartLineItemViewProps[] | null {\n        const {\n            data: {\n                cart: { result: cart }\n            },\n            context: {\n                request: {\n                    channel: {\n                        PickupDeliveryModeCode\n                    } = { PickupDeliveryModeCode: undefined }\n                }\n            },\n            config: config,\n            telemetry,\n            resources\n        } = this.props;\n\n        const imageSettings = this._getImageSettings(config.imageSettings);\n\n        return this.state.miniCartData.products && cart && cart.cart.CartLines && cart.cart.CartLines.length > 0 ?\n        (\n            FlyoutCartLineItems({\n                cartlines: cart.cart.CartLines,\n                products: this.state.miniCartData.products,\n                productAvailabilites: this.state.miniCartData.productAvailabilites,\n                productDeliveryOptions: this.state.miniCartData.deliveryOptions,\n                imageSettings: imageSettings,\n                outOfStockThreshold: this.props.context.app.config.outOfStockThreshold || 0,\n                isStockCheckEnabled: this.props.context.app.config.enableStockCheck || false,\n                maxCartlineQuantity: this.props.context.app.config.maxQuantityForCartLineItem,\n                gridSettings: this.props.context.request.gridSettings!,\n                context: this.props.context,\n                typeName: this.props.typeName,\n                id: this.props.id,\n                resources: {\n                    sizeString: resources.productDimensionTypeSize,\n                    colorString: resources.productDimensionTypeColor,\n                    configString: resources.productDimensionTypeConfiguration,\n                    styleString: resources.productDimensionTypeStyle,\n                    quantityDisplayString: resources.quantityDisplayText,\n                    inputQuantityAriaLabel: '', // not used\n                    discountStringText: '', // not used\n                    originalPriceText: '',\n                    currentPriceText: '',\n                    shippingChargesText: ''\n                },\n                telemetry: telemetry,\n                removeButtonText: resources.removeCartButtonText,\n                outOfStockText: '', // not used\n                outOfRangeOneText: '', // not used\n                outOfRangeFormatText: '', // not used\n                cartState: this.props.data.cart.result,\n                orgUnitLocations: this.state.orgUnitLocations,\n                removeItemClickHandler: this._removeItemFromCartHandler,\n                pickupDeliveryModeCode: PickupDeliveryModeCode,\n                telemetryContent: this.telemetryContent\n            })\n        ) : null;\n    }\n\n    private _getImageSettings = (imageSettings: IImageSettings | undefined): IImageSettings => {\n        return imageSettings || {\n            viewports: {\n                xs: { q: `w=80&h=94&m=6`, w: 0, h: 0 },\n                sm: { q: `w=148&h=174&m=6`, w: 0, h: 0 },\n                lg: { q: `w=148&h=174&m=6`, w: 0, h: 0 }\n            },\n            lazyload: true\n        };\n    }\n\n    private _removeItemFromCartHandler = (cartlineToRemove: CartLine) => {\n        if (this.props.data.cart.result) {\n            const input = {\n                cartLineIds: [cartlineToRemove.LineId!.toString()]\n            };\n            this.props.data.cart.result.removeCartLines(input)\n                .catch((error) => {\n                    this.props.telemetry.warning(error);\n                    this.props.telemetry.debug('Unable to Remove Cart Line');\n                });\n        }\n    }\n}\n\nexport default CartIcon;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}