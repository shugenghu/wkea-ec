{"ast":null,"code":"import\"core-js/modules/es.object.assign.js\";import\"core-js/modules/es.string.replace.js\";import _get from\"lodash/get\";import{__decorate}from\"tslib\";import{getPayloadObject,getTelemetryAttributes}from'@msdyn365-commerce-modules/utilities';import classnames from'classnames';import{computed}from'mobx';import{observer}from'mobx-react';import*as React from'react';import{isMatchingRefinementCriterion}from'./utilities';let ChoiceSummary=class ChoiceSummary extends React.Component{constructor(props){super(props);this.closeButtonGlyph='msi-close-btn';this._onClick=e=>{e.preventDefault();e.stopPropagation();const target=e.currentTarget;const clearAll=target.getAttribute('class').indexOf('choice-summary__clear-all')>-1;const selectedRefiner=clearAll?undefined:this._getSelectedRefinerChoice(target);if(this.props.onChoiceClicked){this.props.onChoiceClicked({clearAll:clearAll,itemClicked:target,choiceClicked:selectedRefiner,nextItemToFocus:target.nextSibling});}};this.payLoad=getPayloadObject('click',this.props.telemetryContent,'');}get selectedRefinersMap(){const{selectedChoices}=this.props;return selectedChoices.map(selectedRefiner=>{return{key:this._getKeyForRefinerValue(selectedRefiner),value:selectedRefiner};});}render(){const{clearAllText,label,classNames,choiceAriaLabel}=this.props;const items=this.selectedRefinersMap;this.payLoad.contentAction.etext=clearAllText;const clearAllAttributes=getTelemetryAttributes(this.props.telemetryContent,this.payLoad);return/*#__PURE__*/React.createElement(\"div\",{className:'msc-choice-summary'},items.length>0&&label&&/*#__PURE__*/React.createElement(\"span\",{className:'msc-choice-summary__label'},label),/*#__PURE__*/React.createElement(\"ul\",{className:classnames(classNames,'msc-choice-summary__list','list-unstyled')},items.map((item,index)=>{const listItemProps={'aria-posinset':index,'aria-setsize':items.length};this.payLoad.contentAction.etext=item.key;const attribute=getTelemetryAttributes(this.props.telemetryContent,this.payLoad);return/*#__PURE__*/React.createElement(\"li\",Object.assign({className:'msc-choice-summary__list-item',key:item.key},listItemProps),/*#__PURE__*/React.createElement(\"a\",Object.assign({className:'msc-choice-summary__item',href:this.props.urlBuilder(item.value,false),\"aria-label\":\"\".concat(item.key,\" \").concat(choiceAriaLabel),onClick:this._onClick},attribute),item.key,/*#__PURE__*/React.createElement(\"span\",{className:\"\".concat(this.closeButtonGlyph,\" msc-choice-summary__glyph\")})));})),items.length>0&&clearAllText&&/*#__PURE__*/React.createElement(\"a\",Object.assign({href:this.props.urlBuilder({},true),className:'msc-choice-summary__clear-all'},clearAllAttributes,{onClick:this._onClick}),clearAllText));}_getKeyForRefinerValue(productRefinerValue){const{choiceFormat,choiceRangeValueFormat,refinerHierarchy,telemetry}=this.props;const overallFormat=choiceFormat||'{1}';const rangeFormat=choiceRangeValueFormat;let refinerName='';if(refinerHierarchy&&refinerHierarchy.find){const parent=refinerHierarchy.find(hierarchy=>!!hierarchy.Values.find(value=>isMatchingRefinementCriterion(value,productRefinerValue)));if(!parent){telemetry.warning('[choice-summary] could not find parent of selected refiner value');}else{refinerName=parent.KeyName||'';}}let refinerValueName;switch(productRefinerValue.DataTypeValue){case 1:case 4:refinerValueName=rangeFormat.replace('{0}',this._formatPrice(productRefinerValue.LeftValueBoundString,productRefinerValue.UnitText)).replace('{1}',this._formatPrice(productRefinerValue.RightValueBoundString,productRefinerValue.UnitText));break;default:refinerValueName=productRefinerValue.LeftValueBoundLocalizedString||productRefinerValue.LeftValueBoundString||'';}return overallFormat.replace('{0}',refinerName).replace('{1}',refinerValueName);}_formatPrice(amount,currency){if(!amount||!currency){this.props.telemetry.trace('[choice-summary] could not format price');return amount||'';}const priceAmount=amount&&Number(amount)||0;const locale=_get(this.props,'context.request.locale','en-US');let result;try{result=new Intl.NumberFormat(locale,{style:'currency',currencyDisplay:'symbol',currency:currency,minimumFractionDigits:0}).format(priceAmount);}catch(e){result=\"\".concat(priceAmount,\" \").concat(currency);this.props.telemetry.warning(\"Failed to format price for \".concat(result,\": \").concat(e));}return result;}_getSelectedRefinerChoice(itemClicked){const result=this.selectedRefinersMap.find(selected=>(itemClicked.innerText&&itemClicked.innerText.trim())===selected.key);return result&&result.value||undefined;}};__decorate([computed],ChoiceSummary.prototype,\"selectedRefinersMap\",null);ChoiceSummary=__decorate([observer],ChoiceSummary);export default ChoiceSummary;","map":{"version":3,"sources":["modules/search-result-container/components/choice-summary.tsx"],"names":[],"mappings":"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","sourcesContent":["import { getPayloadObject, getTelemetryAttributes, IPayLoad } from '@msdyn365-commerce-modules/utilities';\nimport { IProductRefinerHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { ProductRefinerValue } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport { get } from 'lodash';\nimport { computed } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { IChoiceSummaryProps } from './choice-summary.props';\nimport { isMatchingRefinementCriterion, ProductRefinerValueDataTypeValue } from './utilities';\n\ninterface IRefinerMap {\n    key: string;\n    value: ProductRefinerValue;\n}\n\n /**\n  * ChoiceSummary component\n  */\n@observer\nexport default class ChoiceSummary extends React.Component<IChoiceSummaryProps> {\n    private closeButtonGlyph: string = 'msi-close-btn';\n    private payLoad: IPayLoad;\n\n    @computed get selectedRefinersMap(): IRefinerMap[] {\n        const { selectedChoices } = this.props;\n        return selectedChoices.map((selectedRefiner: ProductRefinerValue) => {\n            return {\n                key: this._getKeyForRefinerValue(selectedRefiner),\n                value: selectedRefiner\n            } as IRefinerMap;\n        });\n    }\n\n    constructor(props: Readonly<IChoiceSummaryProps>) {\n        super(props);\n        this.payLoad = getPayloadObject('click', this.props.telemetryContent!, '');\n    }\n\n    public render(): JSX.Element {\n        const { clearAllText, label, classNames, choiceAriaLabel } = this.props;\n        const items = this.selectedRefinersMap;\n        this.payLoad.contentAction.etext = clearAllText;\n        const clearAllAttributes = getTelemetryAttributes(this.props.telemetryContent!, this.payLoad);\n        return (\n            <div className='msc-choice-summary'>\n                {items.length > 0 && label && <span className='msc-choice-summary__label'>{label}</span>}\n                <ul className={classnames(classNames, 'msc-choice-summary__list', 'list-unstyled')}>\n                    {items.map((item: IRefinerMap, index: number) => {\n                        const listItemProps = {\n                            'aria-posinset': index,\n                            'aria-setsize': items.length\n                        };\n\n                        this.payLoad.contentAction.etext = item.key;\n                        const attribute = getTelemetryAttributes(this.props.telemetryContent!, this.payLoad);\n\n                        return (\n                            <li className='msc-choice-summary__list-item' key={item.key} {...listItemProps}>\n                                <a\n                                    className='msc-choice-summary__item'\n                                    href={this.props.urlBuilder(item.value, false)}\n                                    aria-label={`${item.key} ${choiceAriaLabel}`}\n                                    onClick={this._onClick}\n                                    {...attribute}\n                                >\n                                    {item.key}\n                                    <span className={`${this.closeButtonGlyph} msc-choice-summary__glyph`} />\n                                </a>\n                            </li>\n                        );\n                    })}\n                </ul>\n                {items.length > 0 && clearAllText && <a href={this.props.urlBuilder({}, true)} className={'msc-choice-summary__clear-all'} {...clearAllAttributes} onClick={this._onClick}>{clearAllText}</a>}\n            </div>\n        );\n    }\n\n    private _getKeyForRefinerValue(productRefinerValue: ProductRefinerValue): string {\n        const { choiceFormat, choiceRangeValueFormat, refinerHierarchy, telemetry } = this.props;\n        const overallFormat = choiceFormat || '{1}';\n        const rangeFormat = choiceRangeValueFormat;\n        let refinerName = '';\n        if (refinerHierarchy && refinerHierarchy.find) {\n            const parent = refinerHierarchy.find(\n                (hierarchy: IProductRefinerHierarchy) =>\n                    !!hierarchy.Values.find((value: ProductRefinerValue) => isMatchingRefinementCriterion(value, productRefinerValue))\n            );\n\n            if (!parent) {\n                telemetry.warning('[choice-summary] could not find parent of selected refiner value');\n            } else {\n                refinerName = parent.KeyName || '';\n            }\n        }\n\n        let refinerValueName: string;\n        switch (productRefinerValue.DataTypeValue) {\n            case ProductRefinerValueDataTypeValue.Range:\n            case ProductRefinerValueDataTypeValue.RangeInput:\n                refinerValueName = rangeFormat\n                    .replace('{0}', this._formatPrice(productRefinerValue.LeftValueBoundString, productRefinerValue.UnitText))\n                    .replace('{1}', this._formatPrice(productRefinerValue.RightValueBoundString, productRefinerValue.UnitText));\n                break;\n            default:\n                refinerValueName = productRefinerValue.LeftValueBoundLocalizedString || productRefinerValue.LeftValueBoundString || '';\n        }\n\n        return overallFormat.replace('{0}', refinerName).replace('{1}', refinerValueName);\n    }\n\n    private _formatPrice(amount: string | undefined, currency: string | undefined): string {\n        if (!amount || !currency) {\n            this.props.telemetry.trace('[choice-summary] could not format price');\n            return amount || '';\n        }\n        const priceAmount = (amount && Number(amount)) || 0;\n        const locale = get(this.props, 'context.request.locale', 'en-US');\n        let result: string;\n\n        try {\n            result = new Intl.NumberFormat(locale, {\n                style: 'currency',\n                currencyDisplay: 'symbol',\n                currency: currency,\n                minimumFractionDigits: 0\n            }).format(priceAmount);\n        } catch (e) {\n            result = `${priceAmount} ${currency}`;\n            this.props.telemetry.warning(`Failed to format price for ${result}: ${e}`);\n        }\n\n        return result;\n    }\n\n    private _onClick = (e: React.MouseEvent<HTMLAnchorElement>): void => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const target = e.currentTarget as HTMLElement;\n        const clearAll = target.getAttribute('class')!.indexOf('choice-summary__clear-all') > -1;\n        const selectedRefiner = clearAll ? undefined : this._getSelectedRefinerChoice(target);\n\n        if (this.props.onChoiceClicked) {\n            this.props.onChoiceClicked({\n                clearAll: clearAll,\n                itemClicked: target,\n                choiceClicked: selectedRefiner,\n                nextItemToFocus: target.nextSibling as HTMLElement\n            });\n        }\n    }\n\n    private _getSelectedRefinerChoice(itemClicked: HTMLElement): ProductRefinerValue | undefined {\n        const result = this.selectedRefinersMap.find(selected => (itemClicked.innerText && itemClicked.innerText.trim()) === selected.key);\n        return (result && result.value) || undefined;\n    }\n}\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}