{"ast":null,"code":"import\"core-js/modules/web.dom-collections.for-each.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}export function findMatchingRefinementCriterion(productRefinerValue,refinementCriteria){return refinementCriteria.find(refinementCriterion=>isMatchingRefinementCriterion(productRefinerValue,refinementCriterion));}export function isMatchingRefinementCriterion(productRefinerValue,refinementCriterion){return refinementCriterion.RefinerRecordId===productRefinerValue.RefinerRecordId&&refinementCriterion.RefinerSourceValue===productRefinerValue.RefinerSourceValue&&refinementCriterion.DataTypeValue===productRefinerValue.DataTypeValue&&(refinementCriterion.DataTypeValue===1||refinementCriterion.LeftValueBoundString===productRefinerValue.LeftValueBoundString);}export function getUpdatedRefinementCriteria(itemToggleNotification,currentRefinementCriteria){const updatedRefinementCriteria=[];let toggledItemFound=false;currentRefinementCriteria.forEach(selectedCriterion=>{if(isMatchingRefinementCriterion(itemToggleNotification.productRefinerValue,selectedCriterion)){toggledItemFound=true;if(itemToggleNotification.isSelecting){const next=_objectSpread(_objectSpread({},selectedCriterion),{},{LeftValueBoundString:itemToggleNotification.rangeStart!==undefined&&\"\".concat(itemToggleNotification.rangeStart)||selectedCriterion.LeftValueBoundString,RightValueBoundString:itemToggleNotification.rangeEnd!==undefined&&\"\".concat(itemToggleNotification.rangeEnd)||selectedCriterion.RightValueBoundString});updatedRefinementCriteria.push(next);}}else{updatedRefinementCriteria.push(selectedCriterion);}});if(!toggledItemFound){const next=_objectSpread(_objectSpread({},itemToggleNotification.productRefinerValue),{},{LeftValueBoundString:itemToggleNotification.rangeStart!==undefined&&\"\".concat(itemToggleNotification.rangeStart)||itemToggleNotification.productRefinerValue.LeftValueBoundString,RightValueBoundString:itemToggleNotification.rangeEnd!==undefined&&\"\".concat(itemToggleNotification.rangeEnd)||itemToggleNotification.productRefinerValue.RightValueBoundString});updatedRefinementCriteria.push(next);if((itemToggleNotification.productRefinerValue.DataTypeValue===5||itemToggleNotification.productRefinerValue.DataTypeValue===6)&&itemToggleNotification.parentProductRefinerHierarchy.RefinerTypeValue===0){itemToggleNotification.parentProductRefinerHierarchy.Values.forEach(child=>{if(child.RefinerRecordId===next.RefinerRecordId&&child.LeftValueBoundString===next.LeftValueBoundString){}else{const matchingIndex=updatedRefinementCriteria.findIndex(criterion=>isMatchingRefinementCriterion(child,criterion));if(matchingIndex>-1){updatedRefinementCriteria.splice(matchingIndex,1);}}});}}return updatedRefinementCriteria;}export function formatPrice(amount,currency,locale,telemetry){if(!amount||!currency){telemetry.trace(\"[refine-menu.utilities.formatPrice] could not format price for \".concat(amount,\" \").concat(currency));return amount||'';}const priceAmount=amount&&Number(amount)||0;let result;try{result=new Intl.NumberFormat(locale,{style:'currency',currencyDisplay:'symbol',currency:currency,minimumFractionDigits:0}).format(priceAmount);}catch(e){result=\"\".concat(priceAmount,\" \").concat(currency);telemetry.warning(\"[refine-menu.utilities.formatPrice] Failed to format price for \".concat(result,\": \").concat(e));}return result;}","map":{"version":3,"sources":["modules/search-result-container/components/utilities.ts"],"names":[],"mappings":"25BA4EA,MAAM,SAAU,CAAA,+BAAV,CACF,mBADE,CAEF,kBAFE,CAEuC,CAGzC,MAAO,CAAA,kBAAkB,CAAC,IAAnB,CACF,mBAAD,EAA8C,6BAA6B,CAAC,mBAAD,CAAsB,mBAAtB,CADxE,CAAP,CAGH,CAOD,MAAM,SAAU,CAAA,6BAAV,CACF,mBADE,CAEF,mBAFE,CAEsC,CAGxC,MACI,CAAA,mBAAmB,CAAC,eAApB,GAAwC,mBAAmB,CAAC,eAA5D,EACA,mBAAmB,CAAC,kBAApB,GAA2C,mBAAmB,CAAC,kBAD/D,EAEA,mBAAmB,CAAC,aAApB,GAAsC,mBAAmB,CAAC,aAF1D,GAGC,mBAAmB,CAAC,aAApB,GAAiC,CAAjC,EACG,mBAAmB,CAAC,oBAApB,GAA6C,mBAAmB,CAAC,oBAJrE,CADJ,CAOH,CAED,MAAM,SAAU,CAAA,4BAAV,CACF,sBADE,CAEF,yBAFE,CAE8C,CAChD,KAAM,CAAA,yBAAyB,CAA0B,EAAzD,CACA,GAAI,CAAA,gBAAgB,CAAG,KAAvB,CACA,yBAAyB,CAAC,OAA1B,CAAmC,iBAAD,EAA2C,CACzE,GAAI,6BAA6B,CAAC,sBAAsB,CAAC,mBAAxB,CAA6C,iBAA7C,CAAjC,CAAkG,CAC9F,gBAAgB,CAAG,IAAnB,CACA,GAAI,sBAAsB,CAAC,WAA3B,CAAwC,CACpC,KAAM,CAAA,IAAI,gCACH,iBADG,MAEN,oBAAoB,CAAE,sBAAsB,CAAC,UAAvB,GAAsC,SAAtC,YAAsD,sBAAsB,CAAC,UAA7E,GAA6F,iBAAiB,CAAC,oBAF/H,CAGN,qBAAqB,CAAE,sBAAsB,CAAC,QAAvB,GAAoC,SAApC,YAAoD,sBAAsB,CAAC,QAA3E,GAAyF,iBAAiB,CAAC,qBAH5H,EAAV,CAKA,yBAAyB,CAAC,IAA1B,CAA+B,IAA/B,EAEH,CACJ,CAXD,IAWO,CAEH,yBAAyB,CAAC,IAA1B,CAA+B,iBAA/B,EACH,CACJ,CAhBD,EAkBA,GAAI,CAAC,gBAAL,CAAuB,CACnB,KAAM,CAAA,IAAI,gCACH,sBAAsB,CAAC,mBADpB,MAEN,oBAAoB,CAAE,sBAAsB,CAAC,UAAvB,GAAsC,SAAtC,YAAsD,sBAAsB,CAAC,UAA7E,GAA6F,sBAAsB,CAAC,mBAAvB,CAA2C,oBAFxJ,CAGN,qBAAqB,CAAE,sBAAsB,CAAC,QAAvB,GAAoC,SAApC,YAAoD,sBAAsB,CAAC,QAA3E,GAAyF,sBAAsB,CAAC,mBAAvB,CAA2C,qBAHrJ,EAAV,CAKA,yBAAyB,CAAC,IAA1B,CAA+B,IAA/B,EAGA,GAAI,CAAC,sBAAsB,CAAC,mBAAvB,CAA2C,aAA3C,GAAwD,CAAxD,EAAsG,sBAAsB,CAAC,mBAAvB,CAA2C,aAA3C,GAAwD,CAA/J,GACA,sBAAsB,CAAC,6BAAvB,CAAqD,gBAArD,GAAqE,CADzE,CAC8G,CAC1G,sBAAsB,CAAC,6BAAvB,CAAqD,MAArD,CAA4D,OAA5D,CAAqE,KAAD,EAA+B,CAC/F,GAAI,KAAK,CAAC,eAAN,GAA0B,IAAI,CAAC,eAA/B,EAAkD,KAAK,CAAC,oBAAN,GAA+B,IAAI,CAAC,oBAA1F,CAAgH,CAE/G,CAFD,IAEO,CACH,KAAM,CAAA,aAAa,CAAG,yBAAyB,CAAC,SAA1B,CAAqC,SAAD,EAAoC,6BAA6B,CAAC,KAAD,CAAQ,SAAR,CAArG,CAAtB,CACA,GAAI,aAAa,CAAG,CAAC,CAArB,CAAwB,CACpB,yBAAyB,CAAC,MAA1B,CAAiC,aAAjC,CAAgD,CAAhD,EACH,CACJ,CACJ,CATD,EAUH,CACJ,CAED,MAAO,CAAA,yBAAP,CACH,CAED,MAAM,SAAU,CAAA,WAAV,CACF,MADE,CAEF,QAFE,CAGF,MAHE,CAIF,SAJE,CAImB,CACrB,GAAI,CAAC,MAAD,EAAW,CAAC,QAAhB,CAA0B,CACtB,SAAS,CAAC,KAAV,0EAAkF,MAAlF,aAA4F,QAA5F,GACA,MAAO,CAAA,MAAM,EAAI,EAAjB,CACH,CACD,KAAM,CAAA,WAAW,CAAI,MAAM,EAAI,MAAM,CAAC,MAAD,CAAjB,EAA8B,CAAlD,CACA,GAAI,CAAA,MAAJ,CAEA,GAAI,CACA,MAAM,CAAG,GAAI,CAAA,IAAI,CAAC,YAAT,CAAsB,MAAtB,CAA8B,CACnC,KAAK,CAAE,UAD4B,CAEnC,eAAe,CAAE,QAFkB,CAGnC,QAAQ,CAAE,QAHyB,CAInC,qBAAqB,CAAE,CAJY,CAA9B,EAKN,MALM,CAKC,WALD,CAAT,CAMH,CAAC,MAAO,CAAP,CAAU,CACR,MAAM,WAAM,WAAN,aAAqB,QAArB,CAAN,CACA,SAAS,CAAC,OAAV,0EAAoF,MAApF,cAA+F,CAA/F,GACH,CAED,MAAO,CAAA,MAAP,CACH","sourcesContent":["import { ITelemetry } from '@msdyn365-commerce/core';\nimport { ProductRefinerValue } from '@msdyn365-commerce/retail-proxy';\nimport { IRefineItemToggleNotification } from './refine-item-toggle-notification';\n\n/**\n * Types of product refiner values\n */\nexport const enum ProductRefinerValueDataTypeValue {\n    /**\n     * Range slider is used for selections like price\n     */\n    Range = 1,\n\n    /**\n     * Range input is a different way to specify ranges and can be expressed with input boxes\n     * as well as a set of discrete single-select type values\n     */\n    RangeInput = 4,\n\n    /**\n     * This is a discrete list item, either multi-select or single-select\n     */\n    List = 5,\n\n    /**\n     * Boolean types allows only single-select\n     */\n    Boolean = 6\n}\n\n/**\n * Types of product refiners\n */\nexport const enum ProductRefinerTypeValue {\n    /**\n     * Refiner values are single-select\n     */\n    Single = 0,\n\n    /**\n     * Refiner values are multi-select\n     */\n    Multi = 1\n}\n\n/**\n * ProductRefinerSource enum type.\n */\nexport const enum ProductRefinerSource {\n    /**\n     * The None member.\n     */\n    None = 0,\n    /**\n     * The Attribute member.\n     */\n    Attribute = 1,\n    /**\n     * The Category member.\n     */\n    Category = 2,\n    /**\n     * The Price member.\n     */\n    Price = 3,\n    /**\n     * The Rating member.\n     */\n    Rating = 4\n}\n\n/**\n * Find the refinement criterion associated with this product refiner value\n * @param productRefinerValue product refiner value to match\n * @param refinementCriteria selected refinement criteria\n */\nexport function findMatchingRefinementCriterion(\n    productRefinerValue: ProductRefinerValue,\n    refinementCriteria: ProductRefinerValue[]\n): ProductRefinerValue | undefined {\n    // if the value is a range, then match only on data type value; otherwise match on item string\n    return refinementCriteria.find(\n        (refinementCriterion: ProductRefinerValue) => isMatchingRefinementCriterion(productRefinerValue, refinementCriterion)\n    );\n}\n\n/**\n * Find the refinement criterion associated with this product refiner value\n * @param productRefinerValue product refiner value to match\n * @param refinementCriteria selected refinement criteria\n */\nexport function isMatchingRefinementCriterion(\n    productRefinerValue: ProductRefinerValue,\n    refinementCriterion: ProductRefinerValue\n): boolean {\n    // if the value is a range, then match only on data type value; otherwise match on item string\n    return (\n        refinementCriterion.RefinerRecordId === productRefinerValue.RefinerRecordId &&\n        refinementCriterion.RefinerSourceValue === productRefinerValue.RefinerSourceValue &&\n        refinementCriterion.DataTypeValue === productRefinerValue.DataTypeValue &&\n        (refinementCriterion.DataTypeValue === ProductRefinerValueDataTypeValue.Range ||\n            refinementCriterion.LeftValueBoundString === productRefinerValue.LeftValueBoundString)\n    );\n}\n\nexport function getUpdatedRefinementCriteria(\n    itemToggleNotification: IRefineItemToggleNotification,\n    currentRefinementCriteria: ProductRefinerValue[]): ProductRefinerValue[] {\n    const updatedRefinementCriteria: ProductRefinerValue[] = [];\n    let toggledItemFound = false;\n    currentRefinementCriteria.forEach((selectedCriterion: ProductRefinerValue) => {\n        if (isMatchingRefinementCriterion(itemToggleNotification.productRefinerValue, selectedCriterion)) {\n            toggledItemFound = true;\n            if (itemToggleNotification.isSelecting) {\n                const next = {\n                    ...selectedCriterion,\n                    LeftValueBoundString: itemToggleNotification.rangeStart !== undefined && `${itemToggleNotification.rangeStart}` || selectedCriterion.LeftValueBoundString,\n                    RightValueBoundString: itemToggleNotification.rangeEnd !== undefined && `${itemToggleNotification.rangeEnd}` || selectedCriterion.RightValueBoundString,\n                };\n                updatedRefinementCriteria.push(next);\n\n            } // else the item is being de-selected, so omit it from the refinement criteria\n        } else {\n            // keep existing criterion because it is not in the item toggle notification\n            updatedRefinementCriteria.push(selectedCriterion);\n        }\n    });\n\n    if (!toggledItemFound) {\n        const next = {\n            ...itemToggleNotification.productRefinerValue,\n            LeftValueBoundString: itemToggleNotification.rangeStart !== undefined && `${itemToggleNotification.rangeStart}` || itemToggleNotification.productRefinerValue.LeftValueBoundString,\n            RightValueBoundString: itemToggleNotification.rangeEnd !== undefined && `${itemToggleNotification.rangeEnd}` || itemToggleNotification.productRefinerValue.RightValueBoundString,\n        };\n        updatedRefinementCriteria.push(next);\n\n        // If single select, then deselect any others in the parent refiner group\n        if ((itemToggleNotification.productRefinerValue.DataTypeValue === ProductRefinerValueDataTypeValue.List || itemToggleNotification.productRefinerValue.DataTypeValue === ProductRefinerValueDataTypeValue.Boolean)  &&\n            itemToggleNotification.parentProductRefinerHierarchy.RefinerTypeValue === ProductRefinerTypeValue.Single) {\n            itemToggleNotification.parentProductRefinerHierarchy.Values.forEach((child: ProductRefinerValue) => {\n                if (child.RefinerRecordId === next.RefinerRecordId && child.LeftValueBoundString === next.LeftValueBoundString) {\n                    // do nothing\n                } else {\n                    const matchingIndex = updatedRefinementCriteria.findIndex((criterion: ProductRefinerValue) => isMatchingRefinementCriterion(child, criterion));\n                    if (matchingIndex > -1) {\n                        updatedRefinementCriteria.splice(matchingIndex, 1);\n                    }\n                }\n            });\n        }\n    }\n\n    return updatedRefinementCriteria;\n}\n\nexport function formatPrice(\n    amount: string | undefined,\n    currency: string | undefined,\n    locale: string | undefined,\n    telemetry: ITelemetry): string {\n    if (!amount || !currency) {\n        telemetry.trace(`[refine-menu.utilities.formatPrice] could not format price for ${amount} ${currency}`);\n        return amount || '';\n    }\n    const priceAmount = (amount && Number(amount)) || 0;\n    let result: string;\n\n    try {\n        result = new Intl.NumberFormat(locale, {\n            style: 'currency',\n            currencyDisplay: 'symbol',\n            currency: currency,\n            minimumFractionDigits: 0\n        }).format(priceAmount);\n    } catch (e) {\n        result = `${priceAmount} ${currency}`;\n        telemetry.warning(`[refine-menu.utilities.formatPrice] Failed to format price for ${result}: ${e}`);\n    }\n\n    return result;\n}"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}