{"ast":null,"code":"import\"core-js/modules/web.dom-collections.iterator.js\";import{__decorate}from\"tslib\";import get from'lodash/get';import{observer}from'mobx-react';import*as React from'react';import GuidedCard from'../components/guided-card';let CheckoutGuidedForm=class CheckoutGuidedForm extends React.Component{constructor(){super(...arguments);this.state={currentStep:0};this.getEnabledModules=()=>{const{moduleState:{childIds,getModule}}=this.props;return childIds.filter(childId=>{const state=getModule(childId);return!!state&&!state.isDisabled;});};this.getStep=id=>{return this.getEnabledModules().indexOf(id);};this.getId=item=>{return get(item,'props.id')||'';};this.getHeading=item=>{return get(item,'props.config.heading')||'';};this.isExpanded=step=>{if(this.props.isEditor){return true;}return step>-1&&step<=this.state.currentStep;};this.isActive=step=>{return step===this.state.currentStep;};this.isVisted=step=>{return step>-1&&step<this.state.currentStep;};this.onNext=()=>{this.setState({currentStep:this.state.currentStep+1});};}componentDidMount(){const childIds=this.props.items.map(item=>get(item,'props.id'));this.props.moduleState.init({childIds});}render(){const{moduleState,items,resource}=this.props;if(!items||!moduleState){return null;}return/*#__PURE__*/React.createElement(\"div\",{className:'ms-checkout__guided-form'},items.map(item=>{const childId=this.getId(item);const step=this.getStep(childId);const title=this.getHeading(item);const state=this.props.moduleState.getModule(childId);const{isReady,isPending,isUpdating,isDisabled,isCancelAllowed,onEdit,onCancel,onSubmit,hasModuleState,hasInitialized}=state||{};return/*#__PURE__*/React.createElement(GuidedCard,{key:childId,step:step,title:title,resource:resource,disabled:!hasModuleState||isDisabled,isActive:this.isActive(step),isVisted:this.isVisted(step),isExpanded:this.isExpanded(step),isSubmitting:isPending,isMobile:this.props.isMobile,isPending:isPending,isUpdating:isUpdating,hasInitialized:hasInitialized,isReady:isReady,isCancelAllowed:isCancelAllowed,onSubmit:onSubmit,onCancel:onCancel,onEdit:onEdit,onNext:this.onNext,hasControlGroup:!this.props.disableGuidedCheckoutFlow&&hasInitialized,telemetryContent:this.props.telemetryContent},/*#__PURE__*/React.cloneElement(item,{enableControl:true}));}));}};CheckoutGuidedForm=__decorate([observer],CheckoutGuidedForm);export default CheckoutGuidedForm;","map":{"version":3,"sources":["modules/checkout/components/guided-form.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/ //\nimport { IModuleStateManager } from '@msdyn365-commerce-modules/checkout-utilities';\nimport { Heading } from '@msdyn365-commerce-modules/data-types';\nimport { ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport get from 'lodash/get';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport GuidedCard from '../components/guided-card';\n\nexport interface ICheckoutGuidedFormProps {\n    items: React.ReactNode[];\n    moduleState: IModuleStateManager;\n    disableGuidedCheckoutFlow?: boolean;\n    isMobile?: boolean;\n    isEditor?: boolean;\n    resource: {\n        checkoutStepTitleFormat: string;\n        saveBtnLabel: string;\n        changeBtnLabel: string;\n        cancelBtnLabel: string;\n        saveAndContinueBtnLabel: string;\n    };\n    telemetryContent?: ITelemetryContent;\n}\n\ninterface ICheckoutGuidedFormState {\n    currentStep: number;\n}\n\n/**\n *\n * CheckoutGuidedForm component\n * @extends {React.Component<ICheckoutGuidedFormProps>}\n */\n@observer\nclass CheckoutGuidedForm extends React.Component<ICheckoutGuidedFormProps> {\n    public state: ICheckoutGuidedFormState = {\n        currentStep: 0\n    };\n\n    public componentDidMount(): void {\n        /**\n         * Append child modules\n         */\n        const childIds = this.props.items.map((item: React.ReactNode) => get(item, 'props.id'));\n        this.props.moduleState.init({ childIds });\n    }\n\n    public render(): JSX.Element | null {\n        const { moduleState, items, resource } = this.props;\n        if (!items || !moduleState) {\n            return null;\n        }\n\n        return (\n            <div className='ms-checkout__guided-form'>\n                {items.map((item: React.ReactNode) => {\n                    const childId = this.getId(item);\n                    const step = this.getStep(childId);\n                    const title = this.getHeading(item);\n                    const state = this.props.moduleState.getModule(childId);\n                    const { isReady, isPending, isUpdating, isDisabled, isCancelAllowed, onEdit, onCancel, onSubmit, hasModuleState, hasInitialized } =\n                        state || ({} as IModuleStateManager);\n                    return (\n\n                        <GuidedCard\n                            key={childId}\n                            step={step}\n                            title={title}\n                            resource={resource}\n                            disabled={!hasModuleState || isDisabled}\n                            isActive={this.isActive(step)}\n                            isVisted={this.isVisted(step)}\n                            isExpanded={this.isExpanded(step)}\n                            isSubmitting={isPending}\n                            isMobile={this.props.isMobile}\n                            isPending={isPending}\n                            isUpdating={isUpdating}\n                            hasInitialized={hasInitialized}\n                            isReady={isReady}\n                            isCancelAllowed={isCancelAllowed}\n                            onSubmit={onSubmit}\n                            onCancel={onCancel}\n                            onEdit={onEdit}\n                            onNext={this.onNext}\n                            hasControlGroup={!this.props.disableGuidedCheckoutFlow && hasInitialized}\n                            telemetryContent= {this.props.telemetryContent}\n                        >\n                            {React.cloneElement(item as React.ReactElement, { enableControl: true })}\n                        </GuidedCard>\n                    );\n                })}\n            </div>\n        );\n    }\n\n    private getEnabledModules = (): string[] => {\n        const {\n            moduleState: { childIds, getModule }\n        } = this.props;\n        return childIds.filter((childId: string) => {\n            const state = getModule(childId);\n            return !!state && !state.isDisabled;\n        });\n    };\n\n    private getStep = (id: string): number => {\n        return this.getEnabledModules().indexOf(id);\n    };\n\n    private getId = (item: React.ReactNode): string => {\n        return get(item, 'props.id') || '';\n    };\n\n    private getHeading = (item: React.ReactNode): Heading => {\n        return get(item, 'props.config.heading') || '';\n    };\n\n    private isExpanded = (step: number): boolean => {\n        if (this.props.isEditor) {\n            // Editorial mode: Expand all the drawers\n            return true;\n        }\n        return step > -1 && step <= this.state.currentStep;\n    };\n\n    private isActive = (step: number): boolean => {\n        return step === this.state.currentStep;\n    };\n\n    private isVisted = (step: number): boolean => {\n        return step > -1 && step < this.state.currentStep;\n    };\n\n    private onNext = (): void => {\n        this.setState({\n            currentStep: this.state.currentStep + 1\n        });\n    };\n}\n\nexport default CheckoutGuidedForm;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}