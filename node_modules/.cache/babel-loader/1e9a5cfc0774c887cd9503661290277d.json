{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import classnames from'classnames';import*as React from'react';export var POST_MESSAGE_NAME='message';var getHostName=function getHostName(){var url=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';return(url.indexOf('//')>-1?url.split('/')[2]:url.split('/')[0]).toLowerCase();};var IPaymentFrameElement=/*#__PURE__*/function(_React$PureComponent){_inherits(IPaymentFrameElement,_React$PureComponent);var _super=_createSuper(IPaymentFrameElement);function IPaymentFrameElement(props){var _this;_classCallCheck(this,IPaymentFrameElement);_this=_super.call(this,props);_this.postMessage=function(params){if(_this.iframeRef&&_this.iframeRef.current&&_this.iframeRef.current.contentWindow&&_this.iframeRef.current.contentWindow.postMessage){_this.iframeRef.current.contentWindow.postMessage(params.message,params.targetOrigin);}};_this.onEvent=function(event){var _this$props=_this.props,sourceUrl=_this$props.sourceUrl,onIFrameMessage=_this$props.onIFrameMessage,requestUrlOrigin=_this$props.requestUrlOrigin,messageOrigin=_this$props.messageOrigin;var sourceHost=getHostName(sourceUrl);var eventHost=getHostName(event.origin);var requestHost=getHostName(requestUrlOrigin);var messageHost=getHostName(messageOrigin);if(!onIFrameMessage||sourceUrl&&!(sourceHost===eventHost||requestHost===eventHost||messageHost===eventHost)||!sourceUrl&&!(requestHost===eventHost||messageHost===eventHost)){return;}return onIFrameMessage(event);};_this.updateContentDocument=function(){var _this$props2=_this.props,displayContent=_this$props2.displayContent,sourceUrl=_this$props2.sourceUrl,css=_this$props2.css;if(!sourceUrl&&displayContent&&_this.iframeRef&&_this.iframeRef.current){var innerDocument=_this.iframeRef.current.contentDocument;if(innerDocument){innerDocument.open();innerDocument.write(displayContent);if(css){var style=document.createElement('style');var cssNote=document.createTextNode(css);style.type='text/css';style.appendChild(cssNote);innerDocument.head.appendChild(style);}innerDocument.close();}}};_this.iframeRef=/*#__PURE__*/React.createRef();return _this;}_createClass(IPaymentFrameElement,[{key:\"componentDidMount\",value:function componentDidMount(){window.addEventListener(POST_MESSAGE_NAME,this.onEvent);this.updateContentDocument();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(prevProps.displayContent!==this.props.displayContent){this.updateContentDocument();}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){window.removeEventListener(POST_MESSAGE_NAME,this.onEvent);}},{key:\"render\",value:function render(){var _this$props3=this.props,sourceUrl=_this$props3.sourceUrl,className=_this$props3.className,iframeAriaLabel=_this$props3.iframeAriaLabel,height=_this$props3.height;return/*#__PURE__*/React.createElement(\"iframe\",{className:classnames('checkout-payment-instrument__iframe',className),\"aria-label\":iframeAriaLabel,src:sourceUrl,ref:this.iframeRef,height:height,sandbox:'allow-scripts allow-forms allow-same-origin allow-popups'});}}]);return IPaymentFrameElement;}(React.PureComponent);export default IPaymentFrameElement;","map":{"version":3,"sources":["modules/checkout-payment-instrument/components/iframe.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport { IPaymentConnectorPostMessage } from '../payment-instrument-message';\n\nexport interface IPaymentFrameElementProps {\n    className?: string;\n    iframeAriaLabel: string;\n    displayContent?: string;\n    sourceUrl?: string;\n    requestUrlOrigin?: string;\n    messageOrigin?: string;\n    css?: string;\n    height?: number;\n    onIFrameMessage?(event: MessageEvent): void;\n}\n\nexport const POST_MESSAGE_NAME = 'message';\n\nconst getHostName = (url: string = ''): string => {\n    return (url.indexOf('//') > -1 ? url.split('/')[2] : url.split('/')[0]).toLowerCase();\n};\n\n/**\n *\n * IFrameElement component\n * @extends {React.PureComponent<IPaymentFrameElementProps>}\n */\nclass IPaymentFrameElement extends React.PureComponent<IPaymentFrameElementProps> {\n    private iframeRef: React.RefObject<HTMLIFrameElement>;\n\n    constructor(props: IPaymentFrameElementProps) {\n        super(props);\n        this.iframeRef = React.createRef();\n    }\n\n    public componentDidMount(): void {\n        window.addEventListener(POST_MESSAGE_NAME, this.onEvent);\n\n        this.updateContentDocument();\n    }\n\n    public componentDidUpdate(prevProps: IPaymentFrameElementProps): void {\n        if (prevProps.displayContent !== this.props.displayContent) {\n            this.updateContentDocument();\n        }\n    }\n\n    public componentWillUnmount(): void {\n        window.removeEventListener(POST_MESSAGE_NAME, this.onEvent);\n    }\n\n    public render(): JSX.Element | null {\n        const { sourceUrl, className, iframeAriaLabel, height } = this.props;\n        return (\n            <iframe\n                className={classnames('checkout-payment-instrument__iframe', className)}\n                aria-label={iframeAriaLabel}\n                src={sourceUrl}\n                ref={this.iframeRef}\n                height={height}\n                // tslint:disable-next-line:react-iframe-missing-sandbox\n                sandbox='allow-scripts allow-forms allow-same-origin allow-popups'\n            />\n        );\n    }\n\n    public postMessage = (params: IPaymentConnectorPostMessage): void => {\n        if (\n            this.iframeRef &&\n            this.iframeRef.current &&\n            this.iframeRef.current.contentWindow &&\n            this.iframeRef.current.contentWindow.postMessage\n        ) {\n            this.iframeRef.current.contentWindow.postMessage(params.message, params.targetOrigin);\n        }\n    };\n\n    private onEvent = (event: MessageEvent) => {\n        const { sourceUrl, onIFrameMessage, requestUrlOrigin, messageOrigin } = this.props;\n        const sourceHost = getHostName(sourceUrl);\n        const eventHost = getHostName(event.origin);\n        const requestHost = getHostName(requestUrlOrigin);\n        const messageHost = getHostName(messageOrigin);\n\n        // Important: security check\n        // check actual origin matches with expected origin\n        if (\n            !onIFrameMessage ||\n            (sourceUrl && !(sourceHost === eventHost || requestHost === eventHost || messageHost === eventHost)) ||\n            (!sourceUrl && !(requestHost === eventHost || messageHost === eventHost))\n        ) {\n            return;\n        }\n\n        return onIFrameMessage(event);\n    };\n\n    private updateContentDocument = (): void => {\n        const { displayContent, sourceUrl, css } = this.props;\n        if (!sourceUrl && displayContent && this.iframeRef && this.iframeRef.current) {\n            const innerDocument = this.iframeRef.current.contentDocument;\n\n            if (innerDocument) {\n                innerDocument.open();\n                innerDocument.write(displayContent);\n                if (css) {\n                    // Append custom style\n                    const style = document.createElement('style');\n                    const cssNote = document.createTextNode(css);\n                    style.type = 'text/css';\n                    style.appendChild(cssNote);\n                    innerDocument.head.appendChild(style);\n                }\n\n                innerDocument.close();\n            }\n        }\n    };\n}\n\nexport default IPaymentFrameElement;"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}