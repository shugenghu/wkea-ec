{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import{__decorate}from\"tslib\";import*as MsDyn365 from'@msdyn365-commerce/core';import classnames from'classnames';import{observer}from'mobx-react';import*as React from'react';import{createTabStateInput}from'../../data-actions/tab-state-data-action';import{getContentID,TabItemType}from'../tab-item/tab-item';var Tab=/*#__PURE__*/function(_React$Component){_inherits(Tab,_React$Component);var _super=_createSuper(Tab);function Tab(props){var _this;_classCallCheck(this,Tab);_this=_super.call(this,props);_this.tabIndexQuery='activeTab';_this.handleHeadingChange=function(event){return _this.props.config.heading.text=event.target.value;};_this._onClick=function(index,id){return function(e){var activeTabState={activeContentIndex:index,tabId:id};_this.props.context.actionContext.update(createTabStateInput(activeTabState),activeTabState);_this.setState({currentTabIndex:index});var requestContext=_this.props.context.request;var newUrl=_this._setGetParameter(requestContext,_this.tabIndexQuery,\"\".concat(_this.props.id,\":\").concat(String(index+1)));requestContext&&window.history.pushState({path:newUrl},'',newUrl);};};_this._onKeyDown=function(index,id){return function(e){debugger;if(e.keyCode===13){var activeTabState={activeContentIndex:index,tabId:id};_this.props.context.actionContext.update(createTabStateInput(activeTabState),activeTabState);_this.setState({currentTabIndex:index});var requestContext=_this.props.context.request;var newUrl=_this._setGetParameter(requestContext,_this.tabIndexQuery,\"\".concat(_this.props.id,\":\").concat(String(index+1)));requestContext&&window.history.pushState({path:newUrl},'',newUrl);}if(e.keyCode===39||e.keyCode===37){var _slots=_this.props.slots;var _slotLength=_slots&&_slots.tabItems&&_slots.tabItems.length||0;if(e.keyCode===39){if(index+1===_slotLength){index=-1;}var _activeTabState={activeContentIndex:index+1,tabId:id};_this.props.context.actionContext.update(createTabStateInput(_activeTabState),_activeTabState);_this.setState({currentTabIndex:index+1});var _requestContext=_this.props.context.request;var _newUrl=_this._setGetParameter(_requestContext,_this.tabIndexQuery,\"\".concat(_this.props.id,\":\").concat(String(index+2)));_requestContext&&window.history.pushState({path:_newUrl},'',_newUrl);}else if(e.keyCode===37){if(index===0){index=_slotLength;}var _activeTabState2={activeContentIndex:index-1,tabId:id};_this.props.context.actionContext.update(createTabStateInput(_activeTabState2),_activeTabState2);_this.setState({currentTabIndex:index-1});var _requestContext2=_this.props.context.request;var _newUrl2=_this._setGetParameter(_requestContext2,_this.tabIndexQuery,\"\".concat(_this.props.id,\":\").concat(String(index)));_requestContext2&&window.history.pushState({path:_newUrl2},'',_newUrl2);}}};};var defaultTabIndex=_this.props.config.defaultTabIndex;var slots=_this.props.slots;var slotLength=slots&&slots.tabItems&&slots.tabItems.length||0;var initialIndex=defaultTabIndex&&defaultTabIndex<=slotLength&&defaultTabIndex>0?defaultTabIndex-1:0;var queryString=_this.props.context&&_this.props.context.request&&_this.props.context.request.query&&_this.props.context.request.query.activeTab||'';var queryTabIndex=0;if(queryString.indexOf(':')>0){var arr=queryString.split(':');var moduleId=arr[0];if(moduleId===_this.props.id){queryTabIndex=parseInt(arr[1],10);}}initialIndex=queryTabIndex>0&&queryTabIndex<=slotLength?queryTabIndex-1:initialIndex;_this.state={currentTabIndex:initialIndex};_this._getTabHeader=_this._getTabHeader.bind(_assertThisInitialized(_this));_this._getTabContent=_this._getTabContent.bind(_assertThisInitialized(_this));_this._onClick=_this._onClick.bind(_assertThisInitialized(_this));_this._onKeyDown=_this._onKeyDown.bind(_assertThisInitialized(_this));_this._setGetParameter=_this._setGetParameter.bind(_assertThisInitialized(_this));_this.activeLink=null;return _this;}_createClass(Tab,[{key:\"render\",value:function render(){var _this2=this;var slots=this.props.slots;var _this$props$config=this.props.config,heading=_this$props$config.heading,className=_this$props$config.className;var headingComponent=heading&&/*#__PURE__*/React.createElement(MsDyn365.Text,{className:'ms-tab-header-section__heading',tag:heading.tag||'h2',text:heading.text,editProps:{onEdit:this.handleHeadingChange,requestContext:this.props.context.request}});var slotLength=slots&&slots.tabItems&&slots.tabItems.length||0;var tabViewProps=_objectSpread(_objectSpread({},this.props),{},{TabContainer:{moduleProps:this.props,className:classnames('ms-tab',className)},headerSection:{className:'ms-tab-header-section'},tabsSection:{className:'ms-tab-tabs-section',tag:'ul',role:'tablist'},heading:headingComponent,config:this.props&&this.props.config,tabItemContainer:{tag:'div',className:'ms-tab-content-section'},tabContents:slotLength>0&&slots.tabItems.map(function(item,index){return _this2._getTabContent(item,index);}),tabHeaders:slotLength>0&&slots.tabItems.map(function(item,index){return _this2._getTabHeader(item,index);})});return this.props.renderView(tabViewProps);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){var data=this.props.data;var dataActionTabId=data&&data.activeTabState&&data.activeTabState.result&&data.activeTabState.result.tabId;if(dataActionTabId){if(this.props.id===dataActionTabId){this.activeLink&&this.activeLink.focus();}}else{var queryString=this.props.context&&this.props.context.request&&this.props.context.request.query&&this.props.context.request.query.activeTab||'';if(queryString.indexOf(':')>0){var arr=queryString.split(':');var moduleId=arr[0];if(moduleId===this.props.id){this.activeLink&&this.activeLink.focus();}}}}},{key:\"_getTabHeader\",value:function _getTabHeader(item,index){var _this3=this;var data=this.props.data;var activeContentIndex=data&&data.activeTabState&&data.activeTabState.result&&data.activeTabState.result.activeContentIndex;var dataActionTabId=data&&data.activeTabState&&data.activeTabState.result&&data.activeTabState.result.tabId;var selected=activeContentIndex!==undefined&&dataActionTabId===this.props.id?activeContentIndex===index:this.state.currentTabIndex===index;var contentID=getContentID(index,this.props.id);return/*#__PURE__*/React.createElement(\"li\",{key:index,className:'ms-tab-tabs-section-li',tabIndex:selected?0:-1,onClick:this._onClick(index,this.props.id),onKeyDown:this._onKeyDown(index,this.props.id),ref:function ref(link){if(index===_this3.state.currentTabIndex){_this3.activeLink=link;}},\"aria-controls\":contentID,\"aria-selected\":selected,role:'tab'},/*#__PURE__*/React.createElement(React.Fragment,{key:index},/*#__PURE__*/React.cloneElement(item,{tabItemType:TabItemType.TabHeader,isSelected:index===this.state.currentTabIndex,itemIndex:index,tabId:this.props.id})));}},{key:\"_getTabContent\",value:function _getTabContent(item,index){return/*#__PURE__*/React.createElement(React.Fragment,{key:index},/*#__PURE__*/React.cloneElement(item,{tabItemType:TabItemType.TabContent,isSelected:index===this.state.currentTabIndex,itemIndex:index,tabId:this.props.id}));}},{key:\"_setGetParameter\",value:function _setGetParameter(requestContext,paramName,paramValue){var url;if(MsDyn365.msdyn365Commerce.isBrowser){url=new URL(window.location.href);}else{url=new URL(requestContext.url.requestUrl.href);}var params=new window.URLSearchParams(url.search);params.set(paramName,paramValue);url.search=decodeURIComponent(params.toString());return url.toString();}}]);return Tab;}(React.Component);Tab=__decorate([observer],Tab);export default Tab;","map":{"version":3,"sources":["modules/tab/tab.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IModuleProps, INodeProps, NodeTag } from '@msdyn365-commerce-modules/utilities';\nimport * as MsDyn365 from '@msdyn365-commerce/core';\nimport classnames from 'classnames';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { createTabStateInput } from '../../data-actions/tab-state-data-action';\nimport { getContentID, TabItemType } from '../tab-item/tab-item';\nimport { ITabData } from './tab.data';\nimport { ITabProps } from './tab.props.autogenerated';\n\n/**\n *\n * Tab component\n * @extends {React.PureComponent<ITabProps<ITabData>>}\n */\n\nexport interface ICallToActionProps {\n  link: INodeProps[];\n}\n\nexport interface ITabViewProps extends ITabProps<{}> {\n  heading?: React.ReactNode;\n  TabContainer: IModuleProps;\n  headerSection: INodeProps;\n  tabHeaderSection: INodeProps;\n  tabsSection: INodeProps;\n  tabItemContainer: INodeProps;\n  tabHeaders: React.ReactNode;\n  tabContents: React.ReactNode;\n}\n\nexport interface ITabViewStates {\n  currentTabIndex: number;\n}\n/**\n *\n * Tab component\n * @extends {React.Component<ITabProps<ITabData>>}\n */\n@observer\nclass Tab extends React.Component<ITabProps<ITabData>, ITabViewStates> {\n  public readonly tabIndexQuery: string = 'activeTab';\n  private activeLink: HTMLLIElement | null;\n\n  constructor(props: ITabProps<ITabData>) {\n    super(props);\n    const { defaultTabIndex } = this.props.config;\n    const { slots } = this.props;\n    const slotLength = slots && slots.tabItems && slots.tabItems.length || 0;\n    let initialIndex = defaultTabIndex && defaultTabIndex <= slotLength && defaultTabIndex > 0 ? defaultTabIndex - 1 : 0;\n    const queryString: string = this.props.context && this.props.context.request && this.props.context.request.query && this.props.context.request.query.activeTab || '';\n    let queryTabIndex: number = 0;\n    if (queryString.indexOf(':') > 0) {\n      const arr = queryString.split(':');\n      const moduleId = arr[0];\n      if (moduleId === this.props.id) {\n        queryTabIndex = parseInt(arr[1], 10);\n      }\n    }\n    initialIndex = queryTabIndex > 0 && queryTabIndex <= slotLength ? queryTabIndex - 1 : initialIndex;\n    this.state = { currentTabIndex: initialIndex };\n\n    this._getTabHeader = this._getTabHeader.bind(this);\n    this._getTabContent = this._getTabContent.bind(this);\n    this._onClick = this._onClick.bind(this);\n    this._onKeyDown = this._onKeyDown.bind(this);\n    this._setGetParameter = this._setGetParameter.bind(this);\n    this.activeLink = null;\n  }\n  public render(): JSX.Element {\n    const { slots } = this.props;\n    const { heading, className } = this.props.config;\n\n    const headingComponent = heading && (\n      <MsDyn365.Text\n        className='ms-tab-header-section__heading'\n        tag={heading.tag || 'h2'}\n        text={heading.text}\n        editProps={{ onEdit: this.handleHeadingChange, requestContext: this.props.context.request }}\n      />\n    );\n    const slotLength = slots && slots.tabItems && slots.tabItems.length || 0;\n    // const queryTabIndex = this.props.context && this.props.context.request && this.props.context.request.query && +this.props.context.request.query.activeTabIndex || 0;\n    // let activeIndex = defaultTabIndex && defaultTabIndex <= slotLength && defaultTabIndex > 0 ? defaultTabIndex - 1 : 0;\n    // activeIndex = queryTabIndex > 0 && queryTabIndex <= slotLength ? queryTabIndex - 1 : activeIndex;\n\n    const tabViewProps = {\n      ...this.props,\n      TabContainer: {\n        moduleProps: this.props,\n        className: classnames('ms-tab', className)\n      },\n      headerSection: { className: 'ms-tab-header-section' },\n      tabsSection: { className: 'ms-tab-tabs-section', tag: 'ul' as NodeTag, role: 'tablist' },\n      heading: headingComponent,\n      config: this.props && this.props.config,\n      tabItemContainer: {\n        tag: 'div' as NodeTag,\n        className: 'ms-tab-content-section',\n      },\n      tabContents: slotLength > 0 && slots.tabItems.map((item: React.ReactNode, index: number) => this._getTabContent(item, index)),\n      tabHeaders: slotLength > 0 && slots.tabItems.map((item: React.ReactNode, index: number) => this._getTabHeader(item, index)),\n    };\n    return this.props.renderView(tabViewProps) as React.ReactElement;\n  }\n\n  public handleHeadingChange = (event: MsDyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n\n  public componentDidUpdate(): void {\n    const { data } = this.props;\n    const dataActionTabId = data && data.activeTabState && data.activeTabState.result && data.activeTabState.result.tabId;\n    if (dataActionTabId) {\n      if (this.props.id === dataActionTabId) {\n        this.activeLink && this.activeLink.focus();\n      }\n    } else {\n      const queryString: string = this.props.context && this.props.context.request && this.props.context.request.query && this.props.context.request.query.activeTab || '';\n      if (queryString.indexOf(':') > 0) {\n        const arr = queryString.split(':');\n        const moduleId = arr[0];\n        if (moduleId === this.props.id) {\n          this.activeLink && this.activeLink.focus();\n        }\n      }\n    }\n  }\n\n  private _getTabHeader(item: React.ReactNode, index: number): React.ReactNode {\n    const { data } = this.props;\n    const activeContentIndex = data && data.activeTabState && data.activeTabState.result && data.activeTabState.result.activeContentIndex;\n    const dataActionTabId = data && data.activeTabState && data.activeTabState.result && data.activeTabState.result.tabId;\n    const selected = activeContentIndex !== undefined && dataActionTabId === this.props.id ? activeContentIndex === index : this.state.currentTabIndex === index;\n    const contentID = getContentID(index, this.props.id);\n\n    return (\n      <li\n        key={index}\n        className='ms-tab-tabs-section-li'\n        tabIndex={selected ? 0 : -1}\n        onClick={this._onClick(index, this.props.id)}\n        onKeyDown={this._onKeyDown(index, this.props.id)}\n        // tslint:disable-next-line:react-this-binding-issue\n        ref={link => { if (index === this.state.currentTabIndex) { this.activeLink = link; } }}\n        aria-controls={contentID}\n        aria-selected={selected}\n        role='tab'\n      >\n        <React.Fragment key={index}>\n          {React.cloneElement(item as React.ReactElement, { tabItemType: TabItemType.TabHeader, isSelected: index === this.state.currentTabIndex, itemIndex: index, tabId: this.props.id })}\n        </React.Fragment>\n      </li>\n    );\n  }\n\n  private _onClick = (index: number, id: string) => (e: React.MouseEvent<HTMLLIElement>) => {\n    const activeTabState = { activeContentIndex: index, tabId: id };\n    this.props.context.actionContext.update(createTabStateInput(activeTabState), activeTabState);\n    this.setState({ currentTabIndex: index });\n    // Update query paramter\n    const requestContext = this.props.context.request;\n    const newUrl = this._setGetParameter(requestContext, this.tabIndexQuery, `${this.props.id}:${String(index + 1)}`);\n    requestContext && window.history.pushState({ path: newUrl }, '', newUrl);\n  }\n\n  private _onKeyDown = (index: number, id: string) => (e: React.KeyboardEvent<HTMLLIElement>) => {\n    debugger;\n    if (e.keyCode === 13) {\n      const activeTabState = { activeContentIndex: index, tabId: id };\n      this.props.context.actionContext.update(createTabStateInput(activeTabState), activeTabState);\n      this.setState({ currentTabIndex: index });\n      // Update query paramter\n      const requestContext = this.props.context.request;\n      const newUrl = this._setGetParameter(requestContext, this.tabIndexQuery, `${this.props.id}:${String(index + 1)}`);\n      requestContext && window.history.pushState({ path: newUrl }, '', newUrl);\n    }\n\n    if (e.keyCode === 39 || e.keyCode === 37) {\n      const { slots } = this.props;\n      const slotLength = slots && slots.tabItems && slots.tabItems.length || 0;\n\n      if (e.keyCode === 39) {\n\n        // If we're at the end, go to the start\n        if (index + 1 === slotLength) {\n          index = -1;\n        }\n        const activeTabState = { activeContentIndex: index + 1, tabId: id };\n        this.props.context.actionContext.update(createTabStateInput(activeTabState), activeTabState);\n        this.setState({ currentTabIndex: index + 1 });\n        // Update query paramter\n        const requestContext = this.props.context.request;\n        const newUrl = this._setGetParameter(requestContext, this.tabIndexQuery, `${this.props.id}:${String(index + 2)}`);\n        requestContext && window.history.pushState({ path: newUrl }, '', newUrl);\n\n        // Move left\n      } else if (e.keyCode === 37) {\n        // If we're at the start, move to the end\n        if (index === 0) {\n          index = slotLength;\n        }\n        const activeTabState = { activeContentIndex: index - 1, tabId: id };\n        this.props.context.actionContext.update(createTabStateInput(activeTabState), activeTabState);\n        this.setState({ currentTabIndex: index - 1 });\n        // Update query paramter\n        const requestContext = this.props.context.request;\n        const newUrl = this._setGetParameter(requestContext, this.tabIndexQuery, `${this.props.id}:${String(index)}`);\n        requestContext && window.history.pushState({ path: newUrl }, '', newUrl);\n      }\n    }\n  }\n\n  private _getTabContent(item: React.ReactNode, index: number): React.ReactNode {\n    return (\n      <React.Fragment key={index}>\n        {React.cloneElement(item as React.ReactElement, { tabItemType: TabItemType.TabContent, isSelected: index === this.state.currentTabIndex, itemIndex: index, tabId: this.props.id })}\n      </React.Fragment>\n    );\n  }\n\n  private _setGetParameter(requestContext: MsDyn365.IRequestContext, paramName: string, paramValue: string): string {\n    let url;\n\n    if (MsDyn365.msdyn365Commerce.isBrowser) {\n      url = new URL(window.location.href);\n    } else {\n      url = new URL(requestContext.url.requestUrl.href);\n    }\n\n    const params = new window.URLSearchParams(url.search);\n    params.set(paramName, paramValue);\n    url.search = decodeURIComponent(params.toString());\n    return url.toString();\n  }\n}\n\nexport default Tab;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}