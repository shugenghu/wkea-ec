{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*!\r\n * Copyright (c) Microsoft Corporation.\r\n * All rights reserved. See LICENSE in the project root for license information.\r\n */import msdyn365Commerce from'@msdyn365-commerce/core-internal';import Cookies from'universal-cookie';import{USER_CONSENT_GIVEN_EVENT}from'../consts';var UserConsentCookieName='_msdyn365___ucc_';/**\r\n * Context for cookie handling\r\n *\r\n * @export\r\n * @class CookieContext\r\n */export var CookieContext=/*#__PURE__*/function(){/**\r\n     * Returns a cookies class from the selected cookie store. If the express server\r\n     * is passed the cookie header will be used otherwise the global cookie store will be used.\r\n     * @param options Optional ICookieContextOptions.\r\n     */function CookieContext(options){var _this=this;_classCallCheck(this,CookieContext);this._setCookieList=[];this._serverCookieList=[];this._clientCookieList=[];/**\r\n         * Get Cookie Value\r\n         *\r\n         * @param {string} cookieName - A string cookie name\r\n         * @return {ICookieValue} cookie value with status\r\n         */this.get=function(cookieName,isEssential){if(isEssential||_this.isConsentGiven()){var cookieValue=_this._cookies.get(cookieName);return{name:cookieName,value:cookieValue,status:cookieValue?'FOUND':'NOT_FOUND'};}return{name:cookieName,value:undefined,status:'NO_CONSENT'};};/**\r\n         * Set Cookie\r\n         *\r\n         * @param {string} cookieName - A string cookie name\r\n         * @param {T} cookieValue - A cookie value\r\n         * @param {ICookieSetOptions} options cookie options same as document.cookie\r\n         */this.set=function(cookieName,cookieValue,options){var sameSiteRequiredFlag=_this._options.sameSiteRequired;var cookieOptionsWithDefaults;cookieOptionsWithDefaults={path:'/',secure:true,isEssential:false};if(sameSiteRequiredFlag===true){cookieOptionsWithDefaults=_objectSpread({path:'/',secure:true,isEssential:false,sameSite:'none'},options);}else{if(options){var filteredOptions={};for(var _i=0,_Object$entries=Object.entries(options);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];if(key.toLowerCase()!=='samesite'){filteredOptions[key]=value;}}cookieOptionsWithDefaults=_objectSpread({path:'/',secure:true,isEssential:false},filteredOptions);}}if(cookieOptionsWithDefaults.isEssential||_this.isConsentGiven()){// Set the cookie if client side\nif(msdyn365Commerce.isBrowser){_this._cookies.set(cookieName,cookieValue,cookieOptionsWithDefaults);var clientCookieString=_this.createCookieString(cookieName,cookieValue,cookieOptionsWithDefaults);_this._clientCookieList.push(clientCookieString);return;}// If server side, convert the cookie into a header string and push it onto an array\nvar serverCookieString=_this.createCookieString(cookieName,cookieValue,cookieOptionsWithDefaults);_this._serverCookieList.push(serverCookieString);}else{_this._setCookieList.push(function(){_this._cookies.set(cookieName,cookieValue,cookieOptionsWithDefaults);});}};/**\r\n         * Gets the value stored in the cart cookie that contains the\r\n         * cart context and information. Returns an empty string if no such value exists.\r\n         *\r\n         */this.getCartCookie=function(){return _this.get(msdyn365Commerce.CartCookie,true).value||'';};/**\r\n         * Sets the cart cookie with a new expiry time time of one year\r\n         * from the current date\r\n         *\r\n         * @param cart The object containing the current cart information\r\n         * @param isAuthenticated Boolean representing whether current user is authenticated or not\r\n         */this.setCartCookie=function(cart,isAuthenticated){var prefix=isAuthenticated?\"t\"/* Auth */:\"p\"/* Anon */;var cartCookieOptions={isEssential:true,secure:true,sameSite:'none'};if(_this._options.cartExpirationInDays){// 86400000 is 1 day in ms\ncartCookieOptions.expires=new Date(Date.now()+_this._options.cartExpirationInDays*86400000);}_this.set(msdyn365Commerce.CartCookie,\"\".concat(prefix,\":\").concat(cart.Id),cartCookieOptions);};/**\r\n         * Gets the value stored in the checkout cart cookie that contains the\r\n         * checkout cart context and information. Returns an empty string if no such value exists.\r\n         */this.getCheckoutCartCookie=function(){return _this.get(msdyn365Commerce.checkoutCartCookie,true).value||'';};/**\r\n         * Sets the checkout cart cookie with a new expiry time time of one year\r\n         * from the current date\r\n         *\r\n         * @param cart The object containing the current checkout cart information\r\n         * @param isAuthenticated Boolean representing whether current user is authenticated or not\r\n         */this.setCheckoutCartCookie=function(cart,isAuthenticated){var prefix=isAuthenticated?\"t\"/* Auth */:\"p\"/* Anon */;var checkoutCartCookieOptions={isEssential:true,secure:true,sameSite:'none'};if(_this._options.cartExpirationInDays){// 86400000 is 1 day in ms\ncheckoutCartCookieOptions.expires=new Date(Date.now()+_this._options.cartExpirationInDays*86400000);}_this.set(msdyn365Commerce.checkoutCartCookie,\"\".concat(prefix,\":\").concat(cart.Id),checkoutCartCookieOptions);};/**\r\n         * Remove checkout cart cookie.\r\n         */this.removeCheckoutCartCookie=function(){_this.remove(msdyn365Commerce.checkoutCartCookie);};/**\r\n         * Remove cookie\r\n         *\r\n         */this.remove=function(cookieName){return _this._cookies.remove(cookieName,{path:'/'});};/**\r\n         * Get whether consent is given or not\r\n         *\r\n         */this.isConsentGiven=function(){return _this._options.isConsentRequired?!!_this._cookies.get(UserConsentCookieName):true;};/**\r\n         * Set consent cookie\r\n         *\r\n         */this.setConsentCookie=function(){var sameSiteRequiredFlag=_this._options.sameSiteRequired;var cookieOptionsWithDefaults={path:'/',maxAge:31536000,secure:true};if(sameSiteRequiredFlag){cookieOptionsWithDefaults.sameSite='none';}_this._cookies.set(UserConsentCookieName,Date.now(),cookieOptionsWithDefaults);var clientCookieString=_this.createCookieString(UserConsentCookieName,'now',cookieOptionsWithDefaults);_this._clientCookieList.push(clientCookieString);_this._setCookieList.forEach(function(setCookieFunction){return setCookieFunction();});if(process.env.CURRENT_ENVIRONMENT==='web'){document.dispatchEvent(new Event(USER_CONSENT_GIVEN_EVENT));}};/**\r\n         * Remove consent cookie\r\n         *\r\n         */this.deleteConsentCookie=function(){return _this._cookies.remove(UserConsentCookieName);};this.createCookieString=function(cookieName,cookieValue,cookieOptionsWithDefaults){var cookieString=\"\".concat(cookieName,\"=\").concat(cookieValue);if(cookieOptionsWithDefaults){var optionsString=_this._appendCookieOptions(cookieOptionsWithDefaults);if(optionsString){cookieString=\"\".concat(cookieString,\"; \").concat(optionsString);}}return cookieString;};this._appendCookieOptions=function(options){var cookieOptions=[];if(options.path){cookieOptions.push(\"Path=\".concat(options.path));}if(options.expires){cookieOptions.push(\"Expires=\".concat(options.expires));}if(options.maxAge){cookieOptions.push(\"Max-Age=\".concat(options.maxAge));}if(options.domain){cookieOptions.push(\"Domain=\".concat(options.domain));}if(options.secure){cookieOptions.push(\"Secure\");}if(options.httpOnly){cookieOptions.push(\"HttpOnly\");}if(options.sameSite){cookieOptions.push(\"SameSite=\".concat(options.sameSite));}return cookieOptions.length!==0?cookieOptions.join('; '):'';};this._options=_objectSpread({isConsentRequired:true},options);this._cookies=new Cookies(this._options.req&&this._options.req.headers&&(this._options.req.headers['x-msdyn365-cookie']||this._options.req.headers.cookie));}/**\r\n     * Returns the list of server side cookies to set\r\n     * only if currently executing server side\r\n     */_createClass(CookieContext,[{key:\"serverCookies\",get:function get(){// tslint:disable-next-line: prefer-object-spread\nreturn msdyn365Commerce.isBrowser?[]:Object.assign([],this._serverCookieList);}/**\r\n     * Returns the list of client side cookies to set\r\n     */},{key:\"clientCookie\",get:function get(){// tslint:disable-next-line: prefer-object-spread\nreturn msdyn365Commerce.isBrowser?Object.assign([],this._clientCookieList):[];}}]);return CookieContext;}();","map":{"version":3,"sources":["../../../src/utils/cookie-utils.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport msdyn365Commerce, { ICookieContext, ICookieContextOptions, ICookieValue } from '@msdyn365-commerce/core-internal';\nimport { Cart } from '@msdyn365-commerce/retail-proxy';\nimport Cookies, { CookieSetOptions } from 'universal-cookie';\nimport { USER_CONSENT_GIVEN_EVENT } from '../consts';\n\nexport interface ICookieSetOptions extends CookieSetOptions {\n    isEssential?: boolean;\n}\n\nexport const enum CartTokenPrefix {\n    Auth = 't',\n    Anon = 'p'\n}\n\nconst UserConsentCookieName: string = '_msdyn365___ucc_';\n\n/**\n * Context for cookie handling\n *\n * @export\n * @class CookieContext\n */\nexport class CookieContext implements ICookieContext {\n    private _cookies: Cookies;\n    private _setCookieList: (() => void)[] = [];\n    private _serverCookieList: string[] = [];\n    private _clientCookieList: string[] = [];\n    private _options: ICookieContextOptions;\n\n    /**\n     * Returns a cookies class from the selected cookie store. If the express server\n     * is passed the cookie header will be used otherwise the global cookie store will be used.\n     * @param options Optional ICookieContextOptions.\n     */\n    constructor(options?: ICookieContextOptions) {\n        this._options = { isConsentRequired: true, ...options };\n        this._cookies = new Cookies(\n            this._options.req &&\n                this._options.req.headers &&\n                (this._options.req.headers['x-msdyn365-cookie'] || this._options.req.headers.cookie)\n        );\n    }\n\n    /**\n     * Get Cookie Value\n     *\n     * @param {string} cookieName - A string cookie name\n     * @return {ICookieValue} cookie value with status\n     */\n    public get = <T>(cookieName: string, isEssential?: boolean): ICookieValue<T> => {\n        if (isEssential || this.isConsentGiven()) {\n            const cookieValue = this._cookies.get(cookieName);\n            return { name: cookieName, value: <T>cookieValue, status: cookieValue ? 'FOUND' : 'NOT_FOUND' };\n        }\n\n        return { name: cookieName, value: undefined, status: 'NO_CONSENT' };\n    };\n\n    /**\n     * Set Cookie\n     *\n     * @param {string} cookieName - A string cookie name\n     * @param {T} cookieValue - A cookie value\n     * @param {ICookieSetOptions} options cookie options same as document.cookie\n     */\n    public set = <T>(cookieName: string, cookieValue: T, options?: ICookieSetOptions): void => {\n        const sameSiteRequiredFlag = this._options.sameSiteRequired;\n        let cookieOptionsWithDefaults: ICookieSetOptions;\n\n        cookieOptionsWithDefaults = { path: '/', secure: true, isEssential: false };\n\n        if (sameSiteRequiredFlag === true) {\n            cookieOptionsWithDefaults = { path: '/', secure: true, isEssential: false, sameSite: 'none', ...options };\n        } else {\n            if (options) {\n                const filteredOptions: ICookieSetOptions = {};\n                for (const [key, value] of Object.entries(options)) {\n                    if (key.toLowerCase() !== 'samesite') {\n                        filteredOptions[key] = value;\n                    }\n                }\n                cookieOptionsWithDefaults = { path: '/', secure: true, isEssential: false, ...filteredOptions };\n            }\n        }\n\n        if (cookieOptionsWithDefaults.isEssential || this.isConsentGiven()) {\n            // Set the cookie if client side\n            if (msdyn365Commerce.isBrowser) {\n                this._cookies.set(cookieName, cookieValue, cookieOptionsWithDefaults);\n                const clientCookieString = this.createCookieString(cookieName, cookieValue, cookieOptionsWithDefaults);\n                this._clientCookieList.push(clientCookieString);\n                return;\n            }\n            // If server side, convert the cookie into a header string and push it onto an array\n            const serverCookieString = this.createCookieString(cookieName, cookieValue, cookieOptionsWithDefaults);\n            this._serverCookieList.push(serverCookieString);\n        } else {\n            this._setCookieList.push(() => {\n                this._cookies.set(cookieName, cookieValue, cookieOptionsWithDefaults);\n            });\n        }\n    };\n\n    /**\n     * Gets the value stored in the cart cookie that contains the\n     * cart context and information. Returns an empty string if no such value exists.\n     *\n     */\n    public getCartCookie = (): string => {\n        return this.get<string>(msdyn365Commerce.CartCookie, true).value || '';\n    };\n\n    /**\n     * Sets the cart cookie with a new expiry time time of one year\n     * from the current date\n     *\n     * @param cart The object containing the current cart information\n     * @param isAuthenticated Boolean representing whether current user is authenticated or not\n     */\n    public setCartCookie = (cart: Cart, isAuthenticated: boolean): void => {\n        const prefix = isAuthenticated ? CartTokenPrefix.Auth : CartTokenPrefix.Anon;\n        const cartCookieOptions: ICookieSetOptions = { isEssential: true, secure: true, sameSite: 'none' };\n        if (this._options.cartExpirationInDays) {\n            // 86400000 is 1 day in ms\n            cartCookieOptions.expires = new Date(Date.now() + this._options.cartExpirationInDays * 86400000);\n        }\n        this.set<string>(msdyn365Commerce.CartCookie, `${prefix}:${cart.Id}`, cartCookieOptions);\n    };\n\n    /**\n     * Gets the value stored in the checkout cart cookie that contains the\n     * checkout cart context and information. Returns an empty string if no such value exists.\n     */\n    public getCheckoutCartCookie = (): string => {\n        return this.get<string>(msdyn365Commerce.checkoutCartCookie, true).value || '';\n    };\n\n    /**\n     * Sets the checkout cart cookie with a new expiry time time of one year\n     * from the current date\n     *\n     * @param cart The object containing the current checkout cart information\n     * @param isAuthenticated Boolean representing whether current user is authenticated or not\n     */\n    public setCheckoutCartCookie = (cart: Cart, isAuthenticated: boolean): void => {\n        const prefix = isAuthenticated ? CartTokenPrefix.Auth : CartTokenPrefix.Anon;\n        const checkoutCartCookieOptions: ICookieSetOptions = { isEssential: true, secure: true, sameSite: 'none' };\n        if (this._options.cartExpirationInDays) {\n            // 86400000 is 1 day in ms\n            checkoutCartCookieOptions.expires = new Date(Date.now() + this._options.cartExpirationInDays * 86400000);\n        }\n        this.set<string>(msdyn365Commerce.checkoutCartCookie, `${prefix}:${cart.Id}`, checkoutCartCookieOptions);\n    };\n\n    /**\n     * Remove checkout cart cookie.\n     */\n    public removeCheckoutCartCookie = (): void => {\n        this.remove(msdyn365Commerce.checkoutCartCookie);\n    };\n\n    /**\n     * Remove cookie\n     *\n     */\n    public remove = (cookieName: string): void => {\n        return this._cookies.remove(cookieName, { path: '/' });\n    };\n\n    /**\n     * Get whether consent is given or not\n     *\n     */\n    public isConsentGiven = (): boolean => {\n        return this._options.isConsentRequired ? !!this._cookies.get(UserConsentCookieName) : true;\n    };\n\n    /**\n     * Set consent cookie\n     *\n     */\n    public setConsentCookie = (): void => {\n        const sameSiteRequiredFlag = this._options.sameSiteRequired;\n        const cookieOptionsWithDefaults: ICookieSetOptions = { path: '/', maxAge: 31536000, secure: true };\n\n        if (sameSiteRequiredFlag) {\n            cookieOptionsWithDefaults.sameSite = 'none';\n        }\n\n        this._cookies.set(UserConsentCookieName, Date.now(), cookieOptionsWithDefaults);\n        const clientCookieString = this.createCookieString(UserConsentCookieName, 'now', cookieOptionsWithDefaults);\n        this._clientCookieList.push(clientCookieString);\n\n        this._setCookieList.forEach(setCookieFunction => setCookieFunction());\n        if (process.env.CURRENT_ENVIRONMENT === 'web') {\n            document.dispatchEvent(new Event(USER_CONSENT_GIVEN_EVENT));\n        }\n    };\n\n    /**\n     * Remove consent cookie\n     *\n     */\n    public deleteConsentCookie = (): void => {\n        return this._cookies.remove(UserConsentCookieName);\n    };\n\n    /**\n     * Returns the list of server side cookies to set\n     * only if currently executing server side\n     */\n    get serverCookies(): string[] {\n        // tslint:disable-next-line: prefer-object-spread\n        return msdyn365Commerce.isBrowser ? [] : Object.assign([], this._serverCookieList);\n    }\n\n    /**\n     * Returns the list of client side cookies to set\n     */\n    get clientCookie(): string[] {\n        // tslint:disable-next-line: prefer-object-spread\n        return msdyn365Commerce.isBrowser ? Object.assign([], this._clientCookieList) : [];\n    }\n\n    private createCookieString = <T>(cookieName: string, cookieValue: T, cookieOptionsWithDefaults: ICookieSetOptions): string => {\n        let cookieString = `${cookieName}=${cookieValue}`;\n        if (cookieOptionsWithDefaults) {\n            const optionsString = this._appendCookieOptions(cookieOptionsWithDefaults);\n            if (optionsString) {\n                cookieString = `${cookieString}; ${optionsString}`;\n            }\n        }\n        return cookieString;\n    };\n\n    private _appendCookieOptions = (options: ICookieSetOptions): string => {\n        const cookieOptions: string[] = [];\n        if (options.path) {\n            cookieOptions.push(`Path=${options.path}`);\n        }\n        if (options.expires) {\n            cookieOptions.push(`Expires=${options.expires}`);\n        }\n        if (options.maxAge) {\n            cookieOptions.push(`Max-Age=${options.maxAge}`);\n        }\n        if (options.domain) {\n            cookieOptions.push(`Domain=${options.domain}`);\n        }\n        if (options.secure) {\n            cookieOptions.push(`Secure`);\n        }\n        if (options.httpOnly) {\n            cookieOptions.push(`HttpOnly`);\n        }\n        if (options.sameSite) {\n            cookieOptions.push(`SameSite=${options.sameSite}`);\n        }\n        return cookieOptions.length !== 0 ? cookieOptions.join('; ') : '';\n    };\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}