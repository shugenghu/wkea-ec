{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import{msdyn365Commerce}from'@msdyn365-commerce/core';import{createObservableDataAction}from'@msdyn365-commerce/core';import Cookie from'js-cookie';import{copyAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';import{buildCacheKey}from'./utilities/utils';import{getCartState}from'@msdyn365-commerce/global-state';/**\r\n * Input class for getCheckoutCart data action\r\n */export var GetCheckoutCartInput=function GetCheckoutCartInput(apiSettings){var _this=this;_classCallCheck(this,GetCheckoutCartInput);this.getCacheKey=function(){return buildCacheKey(\"ActiveCheckoutCart\",_this.apiSettings);};this.getCacheObjectType=function(){return'ActiveCheckoutCart';};this.dataCacheType=function(){return'request';};this.apiSettings=apiSettings;};var createInput=function createInput(inputData){return new GetCheckoutCartInput(inputData.requestContext.apiSettings);};// @ts-ignore\nvar CartCookieName=msdyn365Commerce.CartCookie||'cart';/**\r\n * Data action to copy the cart for checkout actions\r\n */export function getCheckoutCart(_x,_x2){return _getCheckoutCart.apply(this,arguments);}function _getCheckoutCart(){_getCheckoutCart=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var cartId,currentCartState,activeCart,checkoutCart;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:cartId=Cookie.get(CartCookieName)||'';if(!cartId){_context.next=15;break;}_context.next=4;return getCartState(ctx);case 4:currentCartState=_context.sent;activeCart=currentCartState.cart;// check if there is an active cart and it isn't empty\nif(!(activeCart&&Object.keys(activeCart).length>0)){_context.next=14;break;}_context.next=9;return copyAsync({callerContext:ctx},activeCart.Id,2);case 9:checkoutCart=_context.sent;if(!checkoutCart){_context.next=12;break;}return _context.abrupt(\"return\",Array.isArray(checkoutCart)?checkoutCart[0]:checkoutCart);case 12:_context.next=15;break;case 14:ctx.trace(\"[get-checkout-cart] Can't create a checkout cart since active cart is empty\");case 15:return _context.abrupt(\"return\",{});case 16:case\"end\":return _context.stop();}}},_callee);}));return _getCheckoutCart.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/retail-actions/get-checkout-cart',action:getCheckoutCart,input:createInput});","map":{"version":3,"sources":["../../src/get-checkout-cart.ts"],"names":[],"mappings":"8MAAA,OAAiF,gBAAjF,KAAyG,yBAAzG,CACA,OAAS,0BAAT,KAAiE,yBAAjE,CAEA,MAAO,CAAA,MAAP,KAAmB,WAAnB,CAEA,OAAS,SAAT,KAA0B,qEAA1B,CACA,OAAS,aAAT,KAA8B,mBAA9B,CAEA,OAAS,YAAT,KAA6B,iCAA7B,CAEA;;AAEG,GACH,UAAa,CAAA,oBAAb,CAGI,8BAAY,WAAZ,CAA6C,2DAItC,KAAA,WAAA,CAAc,iBAAM,CAAA,aAAa,sBAAuB,KAAI,CAAC,WAA5B,CAAnB,EAAd,CACA,KAAA,kBAAA,CAAqB,iBAAM,oBAAN,EAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,SAAjB,EAAhB,CALH,KAAK,WAAL,CAAmB,WAAnB,CACH,CALL,CAYA,GAAM,CAAA,WAAW,CAAG,QAAd,CAAA,WAAc,CAAC,SAAD,CAAoC,CACpD,MAAO,IAAI,CAAA,oBAAJ,CAAyB,SAAS,CAAC,cAAV,CAAyB,WAAlD,CAAP,CACH,CAFD,CAIA;AACA,GAAM,CAAA,cAAc,CAAW,gBAAgB,CAAC,UAAjB,EAA+B,MAA9D,CAEA;;AAEG,GACH,eAAsB,CAAA,eAAtB,wD,qGAAO,iBAA+B,KAA/B,CAA4D,GAA5D,sKACG,MADH,CACY,MAAM,CAAC,GAAP,CAAW,cAAX,GAA8B,EAD1C,KAEC,MAFD,gDAGgC,CAAA,YAAY,CAAC,GAAD,CAH5C,QAGO,gBAHP,eAIO,UAJP,CAIoB,gBAAgB,CAAC,IAJrC,CAMC;AAND,KAOK,UAAU,EAAI,MAAM,CAAC,IAAP,CAAY,UAAZ,EAAwB,MAAxB,CAAiC,CAPpD,iDAQgC,CAAA,SAAS,CAAC,CAAE,aAAa,CAAE,GAAjB,CAAD,CAAyB,UAAU,CAAC,EAApC,CAAwC,CAAxC,CARzC,QAQW,YARX,mBAUS,YAVT,0DAWgB,KAAK,CAAC,OAAN,CAAc,YAAd,EAA8B,YAAY,CAAC,CAAD,CAA1C,CAAgD,YAXhE,yCAcK,GAAG,CAAC,KAAJ,gFAdL,wCAkBU,EAlBV,yD,kDAqBP,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,6DADkC,CAEtC,MAAM,CAAiB,eAFe,CAGtC,KAAK,CAAE,WAH+B,CAAD,CAAzC","sourcesContent":["import { CacheType, IAction, IActionContext, IActionInput, ICommerceApiSettings, msdyn365Commerce } from '@msdyn365-commerce/core';\nimport { createObservableDataAction, ICreateActionContext } from '@msdyn365-commerce/core';\nimport { Cart } from '@msdyn365-commerce/retail-proxy';\nimport Cookie from 'js-cookie';\n\nimport { copyAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';\nimport { buildCacheKey } from './utilities/utils';\n\nimport { getCartState } from '@msdyn365-commerce/global-state';\n\n/**\n * Input class for getCheckoutCart data action\n */\nexport class GetCheckoutCartInput implements IActionInput {\n    private apiSettings: ICommerceApiSettings;\n\n    constructor(apiSettings: ICommerceApiSettings) {\n        this.apiSettings = apiSettings;\n    }\n\n    public getCacheKey = () => buildCacheKey(`ActiveCheckoutCart`, this.apiSettings);\n    public getCacheObjectType = () => 'ActiveCheckoutCart';\n    public dataCacheType = (): CacheType => 'request';\n}\n\nconst createInput = (inputData: ICreateActionContext) => {\n    return new GetCheckoutCartInput(inputData.requestContext.apiSettings);\n};\n\n// @ts-ignore\nconst CartCookieName: string = msdyn365Commerce.CartCookie || 'cart';\n\n/**\n * Data action to copy the cart for checkout actions\n */\nexport async function getCheckoutCart(input: GetCheckoutCartInput, ctx: IActionContext): Promise<Cart> {\n    const cartId = Cookie.get(CartCookieName) || '';\n    if (cartId) {\n        const currentCartState = await getCartState(ctx);\n        const activeCart = currentCartState.cart;\n\n        // check if there is an active cart and it isn't empty\n        if (activeCart && Object.keys(activeCart).length > 0) {\n            const checkoutCart = await copyAsync({ callerContext: ctx }, activeCart.Id, 2);\n\n            if (checkoutCart) {\n                return Array.isArray(checkoutCart) ? checkoutCart[0] : checkoutCart;\n            }\n        } else {\n            ctx.trace(`[get-checkout-cart] Can't create a checkout cart since active cart is empty`);\n        }\n    }\n\n    return <Cart>{};\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-checkout-cart',\n    action: <IAction<Cart>>getCheckoutCart,\n    input: createInput\n});\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}