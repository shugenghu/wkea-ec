{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/es.regexp.constructor.js\";import\"core-js/modules/es.regexp.to-string.js\";import\"core-js/modules/es.string.replace.js\";import\"core-js/modules/web.dom-collections.iterator.js\";import _defineProperty from\"@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{__decorate}from\"tslib\";import*as React from'react';import{getTelemetryObject}from'@msdyn365-commerce-modules/utilities';import classnames from'classnames';import{observable,set}from'mobx';import{AddressCommon}from'../../common/address-common';import{AddressFormat}from'../../common/address-format';import{AddressItemDisplayType,AddressItemType,AddressValidationRuleType}from'../../common/address-format.data';import{AddressMetaData}from'../../common/address-meta-data';import{AddressType}from'../../common/address-module.data';import{AddressAddUpdate}from'../../common/components/address-add';class BusinessAccountAddress extends React.Component{constructor(props){super(props);this.countryRegionId='USA';this.defaultAddressType=8;this.excludedList=[AddressItemType.Name,AddressItemType.AddressTypeValue,AddressItemType.IsPrimary];this._resetAddressFields=()=>{const addressFormat=this.addressFormat.getAddressFormat(this.countryRegionId);addressFormat.map(addressFormatItem=>{switch(addressFormatItem.displayType){case AddressItemDisplayType.Input:this.addUpdateAddress[addressFormatItem.name]='';break;case AddressItemDisplayType.Checkbox:this.addUpdateAddress[addressFormatItem.name]=false;break;default:switch(addressFormatItem.type){case AddressItemType.ThreeLetterISORegionName:this.addUpdateAddress[addressFormatItem.name]=this.countryRegionId;break;case AddressItemType.AddressTypeValue:this.addUpdateAddress[addressFormatItem.name]=this.defaultAddressType;break;case AddressItemType.State:this.addUpdateAddress[addressFormatItem.name]='';break;default:this.addUpdateAddress[addressFormatItem.name]=undefined;}}});};this._renderAddOrUpdateAddress=()=>{return AddressAddUpdate({isUpdating:this.isUpdating,resources:this.resources,addressType:AddressType.Company,addressFormat:this.addressFormat.getAddressFormat(this.countryRegionId),defaultCountryRegionId:this.countryRegionId,defaultAddressType:this.defaultAddressType,selectedAddress:this.addUpdateAddress,validationError:this.validationError,hasError:this.props.hasError,addressActionResponse:this.addressActionResponse,telemetryContent:this.telemetryContent,dropdownDisplayData:this.addressFormat.getPrefilledAddressDropdownData(this.resources.addressStateDefaultSelectionText,this.stateProvinceInfo),onInputChange:this._onAddressAddUpdateInputChange,onDropdownChange:this._onAddressAddUpdateDropdownChange});};this._onAddressAddUpdateInputChange=event=>{this._updateAddress(event.target.name,event.target.value);};this._onAddressAddUpdateDropdownChange=async event=>{if(event.target.name===AddressItemType[AddressItemType.ThreeLetterISORegionName]){await this._updateCountryRegionId(event.target.value);}else{this._updateAddress(event.target.name,event.target.value);}};this._updateAddress=(name,value)=>{const{updateForm,isRequired,resources}=this.props;let cleanValue=value;if(typeof value==='string'){cleanValue=(value||'').replace(new RegExp('[<>]','gi'),'');}set(this.addUpdateAddress,{[name]:cleanValue});if(this._isEmpty()){if(isRequired){updateForm(true,undefined);}else{this.addressFormat=new AddressFormat(this.countryRegions,new AddressMetaData(_objectSpread({},resources),this.excludedList,[]),this.addressPurposes);updateForm(false,this.addUpdateAddress);}}else{this.addressFormat=new AddressFormat(this.countryRegions,new AddressMetaData(_objectSpread({},resources),this.excludedList,undefined),this.addressPurposes);if(this.addressFormat.validateAddressFormat(this.addUpdateAddress,this.validationError,this.countryRegionId)){updateForm(false,this.addUpdateAddress);}else{updateForm(true,undefined);}}};this._isEmpty=()=>{const addressFormat=this.addressFormat.getAddressFormat(this.countryRegionId);for(let i=0;i<addressFormat.length;i++){const addressFormatItem=addressFormat[i];if(addressFormatItem.type!==AddressItemType.ThreeLetterISORegionName||this._isInputRequired(addressFormatItem)){const addressItemValue=this.addUpdateAddress[addressFormatItem.name];if(addressItemValue||addressItemValue&&addressItemValue!==''){return false;}}}return true;};this._isInputRequired=addressFormatItem=>{if(addressFormatItem===null||!addressFormatItem.validationRules||addressFormatItem.validationRules.length===0){return false;}for(const validationRule of addressFormatItem.validationRules){if(validationRule.type===AddressValidationRuleType.Required){return false;}}return true;};this._updateCountryRegionId=async value=>{this.countryRegionId=value;await this.addressCommon.getStateProvinces(this.countryRegionId).then(result=>{const stateInfo=result.some(state=>state.StateId===this.addUpdateAddress.State);if(!stateInfo){this._updateAddress('State','');}this.stateProvinceInfo=result;});this._updateAddress('ThreeLetterISORegionName',this.countryRegionId);};const{context,data,resources,telemetry}=this.props;this.addUpdateAddress={};this.resources=resources;this.countryRegions=data.countryRegions.result||[];this.addressPurposes=data.addressPurposes.result||[];this.stateProvinceInfo=data.countryStates.result||[];this.addressFormat=new AddressFormat(this.countryRegions,new AddressMetaData(_objectSpread({},resources),this.excludedList,props.isRequired?undefined:[]),this.addressPurposes);this.addressCommon=new AddressCommon(context,resources,telemetry);this.validationError={};this.telemetryContent=getTelemetryObject(this.props.context.request.telemetryPageName,this.props.friendlyName,this.props.telemetry);}componentDidMount(){this._setDefaultCountryRegionId();}render(){const{renderView,config,hasError,resetAddress}=this.props;if(resetAddress){this._resetAddressFields();}const viewProps=_objectSpread(_objectSpread({},this.props),{},{countryRegionId:this.countryRegionId,stateProvinceInfo:this.stateProvinceInfo,validationError:this.validationError,addressActionResponse:this.addressActionResponse,hasError:hasError,className:config.className,BusinessAccountAddress:{moduleProps:this.props,className:classnames('ms-business-account-address',config.className)},showAddOrUpdateAddress:this._renderAddOrUpdateAddress()});return renderView(viewProps);}_setDefaultCountryRegionId(){const{request}=this.props.context;const market=request&&request.channel&&request.channel.ChannelCountryRegionISOCode;this._updateCountryRegionId(this.addressCommon.getDefaultCountryRegionId(this.countryRegionId,this.countryRegions,market));set(this.addUpdateAddress,{AddressTypeValue:this.defaultAddressType});}}__decorate([observable],BusinessAccountAddress.prototype,\"addUpdateAddress\",void 0);__decorate([observable],BusinessAccountAddress.prototype,\"countryRegionId\",void 0);__decorate([observable],BusinessAccountAddress.prototype,\"stateProvinceInfo\",void 0);__decorate([observable],BusinessAccountAddress.prototype,\"validationError\",void 0);export default BusinessAccountAddress;","map":{"version":3,"sources":["modules/business-account-address/business-account-address.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as React from 'react';\n\nimport { getTelemetryObject, IModuleProps, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport { Address, AddressPurpose, CountryRegionInfo, StateProvinceInfo } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport { observable, set } from 'mobx';\nimport { AddressCommon } from '../../common/address-common';\nimport { AddressFormat } from '../../common/address-format';\nimport { AddressItemDisplayType, AddressItemType, AddressValidationRuleType, IAddressItem } from '../../common/address-format.data';\nimport { AddressMetaData } from '../../common/address-meta-data';\nimport { AddressOperation, AddressType, IAddressResource, IAddressResponse } from '../../common/address-module.data';\nimport { AddressAddUpdate, IAddressAddUpdateProps } from '../../common/components/address-add';\nimport { IBusinessAccountAddressData } from './business-account-address.data';\nimport { IBusinessAccountAddressProps } from './business-account-address.props.autogenerated';\n\nexport interface IBusinessAccountAddressExtendedProps extends IBusinessAccountAddressProps<IBusinessAccountAddressData> {\n    hasError: boolean;\n    isRequired: boolean;\n    resetAddress: boolean;\n    updateForm(errors: boolean, currentAddress?: Address): void;\n}\n\nexport interface IBusinessAccountAddressState {\n    countryId?: string;\n    states?: StateProvinceInfo[];\n}\n\nexport interface IBusinessAccountAddressViewProps {\n    className: string;\n    currentOperation: AddressOperation;\n    selectedAddress?: Address;\n    addUpdateAddress: Address;\n    addressListSelectedAddress: Address;\n    countryRegionId: string;\n    stateProvinceInfo?: StateProvinceInfo[];\n    customerAddresses: Address[];\n    validationError: object;\n    addressActionResponse?: IAddressResponse;\n    BusinessAccountAddress: IModuleProps;\n    isUpdating: boolean;\n    hasError: boolean;\n    showAddOrUpdateAddress: IAddressAddUpdateProps;\n}\n\n/**\n *\n * Address component\n * @extends {React.Component<IBusinessAccountAddressProps<IBusinessAccountAddressData>, IBusinessAccountAddressState>}\n */\nclass BusinessAccountAddress extends React.Component<IBusinessAccountAddressExtendedProps, IBusinessAccountAddressState> {\n    @observable private addUpdateAddress: Address;\n    @observable private countryRegionId: string = 'USA';\n    @observable private stateProvinceInfo?: StateProvinceInfo[];\n    @observable private validationError: object;\n\n    private addressActionResponse?: IAddressResponse;\n    private isUpdating?: boolean;\n    private addressCommon: AddressCommon;\n    private addressFormat: AddressFormat;\n    private countryRegions: CountryRegionInfo[];\n    private addressPurposes: AddressPurpose[];\n    private resources: IAddressResource;\n    private defaultAddressType: number = 8; // Default to Business\n    private excludedList: AddressItemType[] = [AddressItemType.Name, AddressItemType.AddressTypeValue, AddressItemType.IsPrimary]; // Default to hiding Name and AddressType inputs\n    private telemetryContent: ITelemetryContent;\n\n    constructor(props: IBusinessAccountAddressExtendedProps) {\n        super(props);\n\n        const { context, data, resources, telemetry } = this.props;\n        this.addUpdateAddress = {};\n        this.resources = resources;\n        this.countryRegions = data.countryRegions.result || [];\n        this.addressPurposes = data.addressPurposes.result || [];\n        this.stateProvinceInfo = data.countryStates.result || [];\n        this.addressFormat = new AddressFormat(this.countryRegions, new AddressMetaData({ ...resources }, this.excludedList, props.isRequired ? undefined : []), this.addressPurposes);\n        this.addressCommon = new AddressCommon(context, resources, telemetry);\n        this.validationError = {};\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n    }\n\n    public componentDidMount(): void {\n        this._setDefaultCountryRegionId();\n    }\n\n    public render(): JSX.Element | null {\n        const { renderView, config, hasError, resetAddress } = this.props;\n\n        // business-sign-up will pass this flag when cancel button is clicked\n        if (resetAddress) {\n            this._resetAddressFields();\n        }\n\n        const viewProps = {\n            ...this.props,\n            countryRegionId: this.countryRegionId,\n            stateProvinceInfo: this.stateProvinceInfo,\n            validationError: this.validationError,\n            addressActionResponse: this.addressActionResponse,\n            hasError: hasError,\n            className: config.className,\n            BusinessAccountAddress: {\n                moduleProps: this.props,\n                className: classnames('ms-business-account-address', config.className)\n            },\n            showAddOrUpdateAddress: this._renderAddOrUpdateAddress()\n        };\n\n        return renderView(viewProps) as React.ReactElement;\n    }\n\n    public _resetAddressFields = () => {\n        const addressFormat = this.addressFormat.getAddressFormat(this.countryRegionId);\n\n        addressFormat.map(addressFormatItem => {\n            switch (addressFormatItem.displayType) {\n                case AddressItemDisplayType.Input:\n                    this.addUpdateAddress[addressFormatItem.name] = '';\n                    break;\n                case AddressItemDisplayType.Checkbox:\n                    this.addUpdateAddress[addressFormatItem.name] = false;\n                    break;\n                default:\n                    switch(addressFormatItem.type) {\n                        case AddressItemType.ThreeLetterISORegionName:\n                            this.addUpdateAddress[addressFormatItem.name] = this.countryRegionId;\n                            break;\n                        case AddressItemType.AddressTypeValue:\n                            this.addUpdateAddress[addressFormatItem.name] = this.defaultAddressType;\n                            break;\n                        case AddressItemType.State:\n                            this.addUpdateAddress[addressFormatItem.name] = '';\n                            break;\n                        default:\n                            this.addUpdateAddress[addressFormatItem.name] = undefined;\n                    }\n            }\n        });\n    }\n\n    // set validationError and hasError to hide error messages since in the B2B\n    // request form, no errors would visually show since user wont be able to submit\n    // until form is filled and correct\n    private _renderAddOrUpdateAddress = (): IAddressAddUpdateProps => {\n        return AddressAddUpdate({\n            isUpdating: this.isUpdating,\n            resources: this.resources,\n            addressType: AddressType.Company,\n            addressFormat: this.addressFormat.getAddressFormat(this.countryRegionId),\n            defaultCountryRegionId: this.countryRegionId,\n            defaultAddressType: this.defaultAddressType,\n            selectedAddress: this.addUpdateAddress,\n            validationError: this.validationError,\n            hasError: this.props.hasError,\n            addressActionResponse: this.addressActionResponse,\n            telemetryContent: this.telemetryContent,\n            dropdownDisplayData: this.addressFormat.getPrefilledAddressDropdownData(\n                this.resources.addressStateDefaultSelectionText,\n                this.stateProvinceInfo\n            ),\n            onInputChange: this._onAddressAddUpdateInputChange,\n            onDropdownChange: this._onAddressAddUpdateDropdownChange\n        });\n    };\n    private _onAddressAddUpdateInputChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n        this._updateAddress(event.target.name, event.target.value);\n    };\n\n    private _onAddressAddUpdateDropdownChange = async (event: React.ChangeEvent<HTMLSelectElement>): Promise<void> => {\n        if (event.target.name === AddressItemType[AddressItemType.ThreeLetterISORegionName]) {\n            await this._updateCountryRegionId(event.target.value);\n        } else {\n            this._updateAddress(event.target.name, event.target.value);\n        }\n    };\n\n    private _updateAddress = (name: string, value: string | number) => {\n        const { updateForm, isRequired, resources } = this.props;\n        let cleanValue = value;\n        if (typeof(value) === 'string') {\n            cleanValue = (value || '').replace(new RegExp('[<>]', 'gi'), '');\n        }\n        set(this.addUpdateAddress, { [name]: cleanValue });\n\n        if (this._isEmpty()) {\n            if (isRequired) {\n                updateForm(true, undefined);\n            } else {\n                // reset addressFormat as if address was NOT a required field\n                this.addressFormat = new AddressFormat(this.countryRegions, new AddressMetaData({ ...resources }, this.excludedList, []), this.addressPurposes);\n                updateForm(false, this.addUpdateAddress);\n            }\n        } else {\n            // get new addressFormat as if address was a required field\n            this.addressFormat = new AddressFormat(this.countryRegions, new AddressMetaData({ ...resources }, this.excludedList, undefined), this.addressPurposes);\n            // verify with new rules\n            if (this.addressFormat.validateAddressFormat(this.addUpdateAddress, this.validationError, this.countryRegionId)) {\n                updateForm(false, this.addUpdateAddress);\n            } else {\n                updateForm(true, undefined);\n            }\n        }\n    };\n\n    // walk through array and check if valued is defined or value is not an empty string\n    private _isEmpty = () => {\n        const addressFormat = this.addressFormat.getAddressFormat(this.countryRegionId);\n        for (let i = 0; i < addressFormat.length; i ++) {\n            const addressFormatItem = addressFormat[i];\n            if (addressFormatItem.type !== AddressItemType.ThreeLetterISORegionName || this._isInputRequired(addressFormatItem)) {\n                const addressItemValue = this.addUpdateAddress[addressFormatItem.name];\n\n                // check each input field, if value is defined and not an empty string --> address is not empty\n                if (addressItemValue || (addressItemValue && addressItemValue !== '')) {\n                    return false;\n                }\n            }\n        }\n\n        return true;\n    }\n\n    private _isInputRequired = (addressFormatItem: IAddressItem): boolean => {\n        if (addressFormatItem === null || !addressFormatItem.validationRules || addressFormatItem.validationRules.length === 0) {\n            return false;\n        }\n\n        for (const validationRule of addressFormatItem.validationRules) {\n            if (validationRule.type === AddressValidationRuleType.Required) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    private _setDefaultCountryRegionId(): void {\n        const { request } = this.props.context;\n        const market = request && request.channel && request.channel.ChannelCountryRegionISOCode;\n\n        // tslint:disable: no-floating-promises\n        this._updateCountryRegionId(this.addressCommon.getDefaultCountryRegionId(this.countryRegionId, this.countryRegions, market));\n\n        // set default AddressType\n        set(this.addUpdateAddress, { AddressTypeValue: this.defaultAddressType });\n    }\n\n    private _updateCountryRegionId = async (value: string) => {\n        this.countryRegionId = value;\n\n        await this.addressCommon.getStateProvinces(this.countryRegionId).then((result: StateProvinceInfo[]) => {\n            const stateInfo = result.some(state => state.StateId === this.addUpdateAddress.State);\n            // Reset state if selected state not found in the list.\n            if (!stateInfo) {\n                this._updateAddress('State', '');\n            }\n\n            this.stateProvinceInfo = result;\n        });\n\n        this._updateAddress('ThreeLetterISORegionName', this.countryRegionId);\n    }\n}\n\nexport default BusinessAccountAddress;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}