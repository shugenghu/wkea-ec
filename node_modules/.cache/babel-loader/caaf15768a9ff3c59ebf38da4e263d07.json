{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _asyncToGenerator from\"@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol===\"undefined\"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}import{buildCacheKey,mapProductInventoryInformation}from'@msdyn365-commerce-modules/retail-actions';import{createObservableDataAction}from'@msdyn365-commerce/core';import{getEstimatedAvailabilityAsync}from'@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';import{ActiveWishlistInput,getActiveWishlistItems}from'./get-items-in-wishlists';export var ProductAvailabilitiesForWishlistItems=function ProductAvailabilitiesForWishlistItems(apiSettings){var _this=this;_classCallCheck(this,ProductAvailabilitiesForWishlistItems);this.getCacheKey=function(){return buildCacheKey(\"ActiveWishlistItemsAvailability\",_this.apiSettings);};this.getCacheObjectType=function(){return\"ActiveWishlistItemsAvailability\";};this.dataCacheType=function(){return'request';};this.apiSettings=apiSettings;};var createInput=function createInput(inputData){return new ProductAvailabilitiesForWishlistItems(inputData.requestContext.apiSettings);};export function getAvailabilitiesForWishlistItems(_x,_x2){return _getAvailabilitiesForWishlistItems.apply(this,arguments);}function _getAvailabilitiesForWishlistItems(){_getAvailabilitiesForWishlistItems=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(input,ctx){var products,validProducts,_iterator,_step,product,productAvailabilites;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(input){_context.next=2;break;}throw new Error('[getAvailabilitiesForWishlistItems]No valid Input was provided, failing');case 2:_context.next=4;return getActiveWishlistItems(new ActiveWishlistInput(),ctx);case 4:products=_context.sent;if(products){_context.next=8;break;}ctx.trace('[getAvailabilitiesForWishlistItems] Not able to get products in wishlist');return _context.abrupt(\"return\",[]);case 8:validProducts=[];_iterator=_createForOfIteratorHelper(products);try{for(_iterator.s();!(_step=_iterator.n()).done;){product=_step.value;if(product.ProductDetails&&product.ProductDetails.RecordId){validProducts.push(product.ProductDetails.RecordId);}}}catch(err){_iterator.e(err);}finally{_iterator.f();}if(!(validProducts.length===0)){_context.next=14;break;}ctx.trace('[getAvailabilitiesForWishlistItems] No products in wishlist');return _context.abrupt(\"return\",[]);case 14:_context.next=16;return getEstimatedAvailabilityAsync({callerContext:ctx},{ProductIds:validProducts,DefaultWarehouseOnly:true});case 16:productAvailabilites=_context.sent;if(!(productAvailabilites&&productAvailabilites)){_context.next=21;break;}return _context.abrupt(\"return\",mapProductInventoryInformation(ctx,productAvailabilites===null||productAvailabilites===void 0?void 0:productAvailabilites.ProductWarehouseInventoryAvailabilities));case 21:ctx.trace('[getAvailabilitiesForWishlistItems] unable to get availabilites for product');return _context.abrupt(\"return\",[]);case 23:case\"end\":return _context.stop();}}},_callee);}));return _getAvailabilitiesForWishlistItems.apply(this,arguments);}export default createObservableDataAction({id:'@msdyn365-commerce-modules/wishlist/wishlist-items/get-product-availabilities-wishlist-items',action:getAvailabilitiesForWishlistItems,input:createInput});","map":{"version":3,"sources":["modules/wishlist-items/actions/get-product-availabilities-wishlist-items.ts"],"names":[],"mappings":"4jDAAA,OAAS,aAAT,CAAsD,8BAAtD,KAA4F,2CAA5F,CACA,OAAoB,0BAApB,KAAyJ,yBAAzJ,CACA,OAAS,6BAAT,KAA8C,wEAA9C,CACA,OAAS,mBAAT,CAA8B,sBAA9B,KAA4D,0BAA5D,CAKA,UAAa,CAAA,qCAAb,CAGI,+CAAY,WAAZ,CAA6C,4EAItC,KAAA,WAAA,CAAc,iBAAM,CAAA,aAAa,mCAAoC,KAAI,CAAC,WAAzC,CAAnB,EAAd,CACA,KAAA,kBAAA,CAAqB,oDAArB,CACA,KAAA,aAAA,CAAgB,iBAAiB,SAAjB,EAAhB,CALH,KAAK,WAAL,CAAmB,WAAnB,CACH,CALL,CAYA,GAAM,CAAA,WAAW,CAAG,QAAd,CAAA,WAAc,CAAC,SAAD,CAAoD,CACpE,MAAO,IAAI,CAAA,qCAAJ,CAA0C,SAAS,CAAC,cAAV,CAAyB,WAAnE,CAAP,CACH,CAFD,CAOA,eAAsB,CAAA,iCAAtB,0E,yIAAO,iBAAiD,KAAjD,CAA+F,GAA/F,6LAEE,KAFF,8BAGO,IAAI,CAAA,KAAJ,CAAU,yEAAV,CAHP,8BAMoB,CAAA,sBAAsB,CAAC,GAAI,CAAA,mBAAJ,EAAD,CAA4B,GAA5B,CAN1C,QAMG,QANH,kBAQC,QARD,yBASC,GAAG,CAAC,KAAJ,CAAU,0EAAV,EATD,gCAUwC,EAVxC,SAaG,aAbH,CAa6B,EAb7B,sCAekB,QAflB,MAeH,+CAA+B,CAArB,OAAqB,aAC3B,GAAG,OAAO,CAAC,cAAR,EAA0B,OAAO,CAAC,cAAR,CAAuB,QAApD,CAA8D,CAC1D,aAAa,CAAC,IAAd,CAAmB,OAAO,CAAC,cAAR,CAAuB,QAA1C,EACH,CACJ,CAnBE,0DAqBC,aAAa,CAAC,MAAd,GAAyB,CArB1B,2BAsBC,GAAG,CAAC,KAAJ,CAAU,6DAAV,EAtBD,gCAuBwC,EAvBxC,iCA0BgC,CAAA,6BAA6B,CAAC,CAAC,aAAa,CAAC,GAAf,CAAD,CAAsB,CAAC,UAAU,CAAE,aAAb,CAA4B,oBAAoB,CAAC,IAAjD,CAAtB,CA1B7D,SA0BG,oBA1BH,oBA4BA,oBAAoB,EAAI,oBA5BxB,2DA6BQ,8BAA8B,CAAC,GAAD,CAAM,oBAAN,SAAM,oBAAN,iBAAM,oBAAoB,CAAE,uCAA5B,CA7BtC,UA+BC,GAAG,CAAC,KAAJ,CAAU,6EAAV,EA/BD,gCAgCwC,EAhCxC,yD,oEAoCP,cAAe,CAAA,0BAA0B,CAAC,CACtC,EAAE,CAAE,8FADkC,CAEtC,MAAM,CAA2C,iCAFX,CAGtC,KAAK,CAAE,WAH+B,CAAD,CAAzC","sourcesContent":["import { buildCacheKey, IProductInventoryInformation, mapProductInventoryInformation } from '@msdyn365-commerce-modules/retail-actions';\nimport { CacheType, createObservableDataAction, IAction, IActionContext, IActionInput, IAny, ICommerceApiSettings, ICreateActionContext, IGeneric } from '@msdyn365-commerce/core';\nimport { getEstimatedAvailabilityAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { ActiveWishlistInput, getActiveWishlistItems } from './get-items-in-wishlists';\n\n/**\n * Input class for availabilites for items in wishlist\n */\nexport class ProductAvailabilitiesForWishlistItems implements IActionInput {\n    private apiSettings: ICommerceApiSettings;\n\n    constructor(apiSettings: ICommerceApiSettings) {\n        this.apiSettings = apiSettings;\n    }\n\n    public getCacheKey = () => buildCacheKey(`ActiveWishlistItemsAvailability`, this.apiSettings);\n    public getCacheObjectType = () => `ActiveWishlistItemsAvailability`;\n    public dataCacheType = (): CacheType => 'request';\n}\n\nconst createInput = (inputData: ICreateActionContext<IGeneric<IAny>>) => {\n    return new ProductAvailabilitiesForWishlistItems(inputData.requestContext.apiSettings);\n};\n\n/**\n * Calls the Retail API to get wishlist which will be cached the then finds the quantities for each item\n */\nexport async function getAvailabilitiesForWishlistItems(input: ProductAvailabilitiesForWishlistItems, ctx: IActionContext): Promise<IProductInventoryInformation[]> {\n    // If no input is provided fail out\n    if (!input) {\n        throw new Error('[getAvailabilitiesForWishlistItems]No valid Input was provided, failing');\n    }\n\n    const products = await getActiveWishlistItems(new ActiveWishlistInput(), ctx);\n\n    if(!products) {\n        ctx.trace('[getAvailabilitiesForWishlistItems] Not able to get products in wishlist');\n        return <IProductInventoryInformation[]>[];\n    }\n\n    const validProducts: number[] = [];\n\n    for(const product of products) {\n        if(product.ProductDetails && product.ProductDetails.RecordId) {\n            validProducts.push(product.ProductDetails.RecordId);\n        }\n    }\n\n    if (validProducts.length === 0) {\n        ctx.trace('[getAvailabilitiesForWishlistItems] No products in wishlist');\n        return <IProductInventoryInformation[]>[];\n    }\n\n    const productAvailabilites = await getEstimatedAvailabilityAsync({callerContext:ctx}, {ProductIds: validProducts, DefaultWarehouseOnly:true});\n\n    if(productAvailabilites && productAvailabilites) {\n        return mapProductInventoryInformation(ctx, productAvailabilites?.ProductWarehouseInventoryAvailabilities);\n    } else {\n        ctx.trace('[getAvailabilitiesForWishlistItems] unable to get availabilites for product');\n        return <IProductInventoryInformation[]>[];\n    }\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/wishlist/wishlist-items/get-product-availabilities-wishlist-items',\n    action: <IAction<IProductInventoryInformation[]>>getAvailabilitiesForWishlistItems,\n    input: createInput\n});"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}