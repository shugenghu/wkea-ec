{"ast":null,"code":"import\"core-js/modules/es.promise.js\";import\"core-js/modules/es.regexp.to-string.js\";import\"core-js/modules/web.dom-collections.for-each.js\";/*!\r\n * Copyright (c) Microsoft Corporation.\r\n * All rights reserved. See LICENSE in the project root for license information.\r\n */import{createDataActionHook}from'@msdyn365-commerce/core';import{TelemetryEvent}from'@msdyn365-commerce/telemetry-internal';const beforeCopyCart=async inputs=>{};const afterCopyCart=async(_inputs,cart,actionContext)=>{if(window&&window._msdyn365&&window._msdyn365.telemetry){const cartObject=Array.isArray(cart)?cart[0]:cart;const cartLineProductUnits=[];if(cartObject&&cartObject.CartLines&&Array.isArray(cartObject.CartLines)&&cartObject.CartLines.length>0){cartObject.CartLines.forEach(cartLineitem=>{if(cartLineitem.ProductId){cartLineProductUnits.push({productChannelId:cartObject.ChannelId?cartObject.ChannelId.toString():'',productChannelName:'',productCategoryId:'',productCategoryName:'',productId:cartLineitem.ProductId.toString(),productName:'',productSku:'',productPrice:cartLineitem.Price?cartLineitem.Price.toString():'',productQuantity:cartLineitem.Quantity?cartLineitem.Quantity.toString():'',productCurrency:actionContext.requestContext.channel?actionContext.requestContext.channel.Currency||'':''});}});}window._msdyn365.telemetry.logEvent(TelemetryEvent.CheckOut,{cartId:cartObject.Id,cartVersion:cartObject.Version?cartObject.Version.toString():'',products:cartLineProductUnits,orderId:cartObject.OrderNumber?cartObject.OrderNumber.toString():''});}};createDataActionHook({actionId:'@msdyn365-commerce/retail-proxy/Carts/Copy',postReaderHook:afterCopyCart,preReaderHook:beforeCopyCart});","map":{"version":3,"sources":["actions/copyCart-checkOut-telemetry.action.ts"],"names":[],"mappings":"6IAAA;;;AAGG,GAEH,OAAS,oBAAT,KAAoF,yBAApF,CAEA,OAAuB,cAAvB,KAA6C,uCAA7C,CAIA,KAAM,CAAA,cAAc,CAAG,KAAO,CAAA,MAAP,EAAgD,CAEtE,CAFD,CAIA,KAAM,CAAA,aAAa,CAAG,MAAO,OAAP,CAA+C,IAA/C,CAAoE,aAApE,GAAqG,CACvH,GAAI,MAAM,EAAI,MAAM,CAAC,SAAjB,EAA8B,MAAM,CAAC,SAAP,CAAiB,SAAnD,CAA8D,CAE1D,KAAM,CAAA,UAAU,CAAG,KAAK,CAAC,OAAN,CAAc,IAAd,EAAsB,IAAI,CAAC,CAAD,CAA1B,CAAgC,IAAnD,CACA,KAAM,CAAA,oBAAoB,CAAmB,EAA7C,CACA,GAAI,UAAU,EAAI,UAAU,CAAC,SAAzB,EAAsC,KAAK,CAAC,OAAN,CAAc,UAAU,CAAC,SAAzB,CAAtC,EAA6E,UAAU,CAAC,SAAX,CAAqB,MAArB,CAA8B,CAA/G,CAAkH,CAC9G,UAAU,CAAC,SAAX,CAAqB,OAArB,CAA8B,YAAD,EAA2B,CACpD,GAAI,YAAY,CAAC,SAAjB,CAA4B,CACxB,oBAAoB,CAAC,IAArB,CAA0B,CACtB,gBAAgB,CAAE,UAAU,CAAC,SAAX,CAAuB,UAAU,CAAC,SAAX,CAAqB,QAArB,EAAvB,CAAyD,EADrD,CAEtB,kBAAkB,CAAE,EAFE,CAGtB,iBAAiB,CAAE,EAHG,CAItB,mBAAmB,CAAE,EAJC,CAKtB,SAAS,CAAE,YAAY,CAAC,SAAb,CAAuB,QAAvB,EALW,CAMtB,WAAW,CAAE,EANS,CAOtB,UAAU,CAAE,EAPU,CAQtB,YAAY,CAAE,YAAY,CAAC,KAAb,CAAqB,YAAY,CAAC,KAAb,CAAmB,QAAnB,EAArB,CAAqD,EAR7C,CAStB,eAAe,CAAE,YAAY,CAAC,QAAb,CAAwB,YAAY,CAAC,QAAb,CAAsB,QAAtB,EAAxB,CAA2D,EATtD,CAUtB,eAAe,CAAE,aAAa,CAAC,cAAd,CAA6B,OAA7B,CAAuC,aAAa,CAAC,cAAd,CAA6B,OAA7B,CAAqC,QAArC,EAAiD,EAAxF,CAA6F,EAVxF,CAA1B,EAYH,CACJ,CAfD,EAgBH,CAED,MAAM,CAAC,SAAP,CAAiB,SAAjB,CAA2B,QAA3B,CAAoC,cAAc,CAAC,QAAnD,CAA6D,CACzD,MAAM,CAAE,UAAU,CAAC,EADsC,CAEzD,WAAW,CAAE,UAAU,CAAC,OAAX,CAAqB,UAAU,CAAC,OAAX,CAAmB,QAAnB,EAArB,CAAqD,EAFT,CAGzD,QAAQ,CAAE,oBAH+C,CAIzD,OAAO,CAAE,UAAU,CAAC,WAAX,CAAyB,UAAU,CAAC,WAAX,CAAuB,QAAvB,EAAzB,CAA6D,EAJb,CAA7D,EAMH,CACJ,CA/BD,CAiCA,oBAAoB,CAAC,CACjB,QAAQ,CAAE,4CADO,CAEjB,cAAc,CAAE,aAFC,CAGjB,aAAa,CAAE,cAHE,CAAD,CAApB","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport { createDataActionHook, IActionContext, IActionInput, IMSDyn365Window } from '@msdyn365-commerce/core';\nimport { Cart, CartLine } from '@msdyn365-commerce/retail-proxy';\nimport { IProductInfo, TelemetryEvent } from '@msdyn365-commerce/telemetry-internal';\n\ndeclare var window: IMSDyn365Window;\n\nconst beforeCopyCart = async (inputs: IActionInput | IActionInput[]) => {\n    // placeholder\n};\n\nconst afterCopyCart = async (_inputs: IActionInput | IActionInput[], cart: Cart | Cart[], actionContext: IActionContext) => {\n    if (window && window._msdyn365 && window._msdyn365.telemetry) {\n        // TODO (Matt D 4/8/20): Adding product conversion here as workaround for CheckOut bug. Will revisit in user story 6963863\n        const cartObject = Array.isArray(cart) ? cart[0] : cart;\n        const cartLineProductUnits: IProductInfo[] = [];\n        if (cartObject && cartObject.CartLines && Array.isArray(cartObject.CartLines) && cartObject.CartLines.length > 0) {\n            cartObject.CartLines.forEach((cartLineitem: CartLine) => {\n                if (cartLineitem.ProductId) {\n                    cartLineProductUnits.push({\n                        productChannelId: cartObject.ChannelId ? cartObject.ChannelId.toString() : '',\n                        productChannelName: '',\n                        productCategoryId: '',\n                        productCategoryName: '',\n                        productId: cartLineitem.ProductId.toString(),\n                        productName: '',\n                        productSku: '',\n                        productPrice: cartLineitem.Price ? cartLineitem.Price.toString() : '',\n                        productQuantity: cartLineitem.Quantity ? cartLineitem.Quantity.toString() : '',\n                        productCurrency: actionContext.requestContext.channel ? actionContext.requestContext.channel.Currency || '' : ''\n                    });\n                }\n            });\n        }\n\n        window._msdyn365.telemetry.logEvent(TelemetryEvent.CheckOut, {\n            cartId: cartObject.Id,\n            cartVersion: cartObject.Version ? cartObject.Version.toString() : '',\n            products: cartLineProductUnits,\n            orderId: cartObject.OrderNumber ? cartObject.OrderNumber.toString() : ''\n        });\n    }\n};\n\ncreateDataActionHook({\n    actionId: '@msdyn365-commerce/retail-proxy/Carts/Copy',\n    postReaderHook: afterCopyCart,\n    preReaderHook: beforeCopyCart\n});\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}