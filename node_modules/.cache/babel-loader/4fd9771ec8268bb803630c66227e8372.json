{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"@babel/runtime/helpers/esm/createClass\";import _inherits from\"@babel/runtime/helpers/esm/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/esm/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}import*as React from'react';var withVisibilyObserver=function withVisibilyObserver(WrappedComponent){var VisibilyObserver=/*#__PURE__*/function(_React$Component){_inherits(VisibilyObserver,_React$Component);var _super=_createSuper(VisibilyObserver);function VisibilyObserver(){var _this;_classCallCheck(this,VisibilyObserver);_this=_super.apply(this,arguments);_this.state={isVisible:false,errorMessage:'',observer:undefined};_this.selfRef=/*#__PURE__*/React.createRef();_this.initMutationObserver=function(){var targetNode=document.getElementsByTagName('body')&&document.getElementsByTagName('body')[0];if(!targetNode){_this.setState({errorMessage:'No body element found'});return;}if(!MutationObserver){_this.setState({errorMessage:'MutationObserver is not supported'});return;}var config={attributes:true,childList:true,subtree:true};var _observer=new MutationObserver(function(){return _this.handleVisibilityChange();});_observer.observe(targetNode,config);_this.setState({observer:_observer});};_this.stopMutationObserver=function(){_this.state.observer&&_this.state.observer.disconnect();};_this.handleVisibilityChange=function(){var isVisible=!!_this.selfRef.current&&_this.selfRef.current.offsetWidth>0&&_this.selfRef.current.offsetHeight>0;if(!_this.state.isVisible&&isVisible){_this.setState({isVisible:isVisible});_this.stopMutationObserver();}};return _this;}_createClass(VisibilyObserver,[{key:\"componentDidMount\",value:function componentDidMount(){this.initMutationObserver();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.stopMutationObserver();}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",{className:'ms-checkout-payment-instrument__mutation-observer',ref:this.selfRef},/*#__PURE__*/React.createElement(WrappedComponent,Object.assign({},this.props,{visibilityObserver:this.state})));}}]);return VisibilyObserver;}(React.Component);return VisibilyObserver;};export default withVisibilyObserver;","map":{"version":3,"sources":["modules/checkout-payment-instrument/components/with-visibility-observer.tsx"],"names":[],"mappings":"ohCAIA,MAAO,GAAK,CAAA,KAAZ,KAAuB,OAAvB,CAYA,GAAM,CAAA,oBAAoB,CAAG,QAAvB,CAAA,oBAAuB,CAAmC,gBAAnC,CAAuG,IAM1H,CAAA,gBAN0H,gIAMhI,2BAAA,kD,mCACW,MAAA,KAAA,CAAgC,CACnC,SAAS,CAAE,KADwB,CAEnC,YAAY,CAAE,EAFqB,CAGnC,QAAQ,CAAE,SAHyB,CAAhC,CAMC,MAAA,OAAA,cAA2C,KAAK,CAAC,SAAN,EAA3C,CAkBA,MAAA,oBAAA,CAAuB,UAAW,CAEtC,GAAM,CAAA,UAAU,CAAG,QAAQ,CAAC,oBAAT,CAA8B,MAA9B,GAAyC,QAAQ,CAAC,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,CAA5D,CACA,GAAI,CAAC,UAAL,CAAiB,CACb,MAAK,QAAL,CAAc,CACV,YAAY,CAAE,uBADJ,CAAd,EAGA,OACH,CAED,GAAI,CAAC,gBAAL,CAAuB,CACnB,MAAK,QAAL,CAAc,CACV,YAAY,CAAE,mCADJ,CAAd,EAGA,OACH,CAGD,GAAM,CAAA,MAAM,CAAG,CAAE,UAAU,CAAE,IAAd,CAAoB,SAAS,CAAE,IAA/B,CAAqC,OAAO,CAAE,IAA9C,CAAf,CAGA,GAAM,CAAA,SAAS,CAAG,GAAI,CAAA,gBAAJ,CAAqB,iBAAM,OAAK,sBAAL,EAAN,EAArB,CAAlB,CACA,SAAS,CAAC,OAAV,CAAkB,UAAlB,CAA8B,MAA9B,EAEA,MAAK,QAAL,CAAc,CACV,QAAQ,CAAE,SADA,CAAd,EAGH,CA3BO,CA6BA,MAAA,oBAAA,CAAuB,UAAW,CACtC,MAAK,KAAL,CAAW,QAAX,EAAuB,MAAK,KAAL,CAAW,QAAX,CAAoB,UAApB,EAAvB,CACH,CAFO,CAIA,MAAA,sBAAA,CAAyB,UAAW,CAExC,GAAM,CAAA,SAAS,CAAG,CAAC,CAAC,MAAK,OAAL,CAAa,OAAf,EAA0B,MAAK,OAAL,CAAa,OAAb,CAAqB,WAArB,CAAmC,CAA7D,EAAkE,MAAK,OAAL,CAAa,OAAb,CAAqB,YAArB,CAAoC,CAAxH,CACA,GAAI,CAAC,MAAK,KAAL,CAAW,SAAZ,EAAyB,SAA7B,CAAwC,CACpC,MAAK,QAAL,CAAc,CACV,SAAS,CAAT,SADU,CAAd,EAGA,MAAK,oBAAL,GACH,CACJ,CATO,CA1DZ,aAoEC,CA1E+H,0FAepG,CACpB,KAAK,oBAAL,GACH,CAjB2H,mEAmBjG,CACvB,KAAK,oBAAL,GACH,CArB2H,uCAuB/G,CACT,mBACI,KAAA,CAAA,aAAA,CAAA,KAAA,CAAA,CAAK,SAAS,CAAC,mDAAf,CAAmE,GAAG,CAAE,KAAK,OAA7E,CAAA,cACI,KAAA,CAAA,aAAA,CAAC,gBAAD,CAAiB,MAAA,CAAA,MAAA,CAAA,EAAA,CAAK,KAAK,KAAV,CAAe,CAAE,kBAAkB,CAAE,KAAK,KAA3B,CAAf,CAAjB,CADJ,CADJ,CAKH,CA7B2H,8BAMjG,KAAK,CAAC,SAN2F,EA4EhI,MAAO,CAAA,gBAAP,CACH,CA7ED,CA+EA,cAAe,CAAA,oBAAf","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as React from 'react';\n\ninterface IVisibilyObserverState {\n    isVisible?: boolean;\n    errorMessage?: string;\n    observer?: MutationObserver;\n}\n\nexport interface IVisibilyObserverProps {\n    visibilityObserver?: IVisibilyObserverState;\n}\n\nconst withVisibilyObserver = <P extends IVisibilyObserverProps>(WrappedComponent: React.ComponentType<P>): React.ComponentType<P> => {\n    /**\n     *\n     * VisibilyObserver component\n     * @extends {React.Component<P>}\n     */\n    class VisibilyObserver extends React.Component<P> {\n        public state: IVisibilyObserverState = {\n            isVisible: false,\n            errorMessage: '',\n            observer: undefined\n        };\n\n        private selfRef: React.RefObject<HTMLDivElement> = React.createRef();\n\n        public componentDidMount(): void {\n            this.initMutationObserver();\n        }\n\n        public componentWillUnmount(): void {\n            this.stopMutationObserver();\n        }\n\n        public render(): JSX.Element | null {\n            return (\n                <div className='ms-checkout-payment-instrument__mutation-observer' ref={this.selfRef}>\n                    <WrappedComponent {...this.props} visibilityObserver={this.state} />\n                </div>\n            );\n        }\n\n        private initMutationObserver = (): void => {\n            // Select the node that will be observed for mutations\n            const targetNode = document.getElementsByTagName('body') && document.getElementsByTagName('body')[0];\n            if (!targetNode) {\n                this.setState({\n                    errorMessage: 'No body element found'\n                });\n                return;\n            }\n\n            if (!MutationObserver) {\n                this.setState({\n                    errorMessage: 'MutationObserver is not supported'\n                });\n                return;\n            }\n\n            // Options for the observer (which mutations to observe)\n            const config = { attributes: true, childList: true, subtree: true };\n\n            // Create an observer instance linked to the callback function\n            const _observer = new MutationObserver(() => this.handleVisibilityChange());\n            _observer.observe(targetNode, config);\n\n            this.setState({\n                observer: _observer\n            });\n        };\n\n        private stopMutationObserver = (): void => {\n            this.state.observer && this.state.observer.disconnect();\n        };\n\n        private handleVisibilityChange = (): void => {\n            // If module is visible or not\n            const isVisible = !!this.selfRef.current && this.selfRef.current.offsetWidth > 0 && this.selfRef.current.offsetHeight > 0;\n            if (!this.state.isVisible && isVisible) {\n                this.setState({\n                    isVisible\n                });\n                this.stopMutationObserver();\n            }\n        };\n    }\n\n    return VisibilyObserver;\n};\n\nexport default withVisibilyObserver;\n"],"sourceRoot":"./src/"},"metadata":{},"sourceType":"module"}