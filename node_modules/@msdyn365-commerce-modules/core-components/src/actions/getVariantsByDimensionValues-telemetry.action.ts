/*!
 * Copyright (c) Microsoft Corporation.
 * All rights reserved. See LICENSE in the project root for license information.
 */

import { createDataActionHook, IActionContext, IActionInput } from '@msdyn365-commerce/core';
import { SimpleProduct } from '@msdyn365-commerce/retail-proxy';
import { getProductInfoFromSimpleProduct } from './telemetry.action.helper';

const beforeGetVariantsByDimensionValues = async (inputs: IActionInput | IActionInput[]) => {
    // placeholder
};

const afterGetVariantsByDimensionValues = async (
    _inputs: IActionInput | IActionInput[],
    simpleProduct: SimpleProduct | SimpleProduct[],
    actionContext: IActionContext
) => {
    if (Array.isArray(simpleProduct)) {
        simpleProduct.forEach(product => {
            const productInfo = getProductInfoFromSimpleProduct(product, actionContext.requestContext);
            actionContext.requestContext.telemetryData[productInfo.productSku] = productInfo;
        });
    } else {
        const productInfo = getProductInfoFromSimpleProduct(simpleProduct, actionContext.requestContext);
        actionContext.requestContext.telemetryData[productInfo.productSku] = productInfo;
    }
};

createDataActionHook({
    actionId: '@msdyn365-commerce/retail-proxy/Products/GetVariantsByDimensionValues',
    postReaderHook: afterGetVariantsByDimensionValues,
    preReaderHook: beforeGetVariantsByDimensionValues
});
