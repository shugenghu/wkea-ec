{"version":3,"file":"purchase-telemetry.action.js","sourceRoot":"./src/","sources":["actions/purchase-telemetry.action.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAEH,OAAO,EAAE,oBAAoB,EAAgC,MAAM,yBAAyB,CAAC;AAE7F,OAAO,EAAE,cAAc,EAAE,MAAM,uCAAuC,CAAC;AACvE,OAAO,EAAE,uCAAuC,EAAE,MAAM,2BAA2B,CAAC;AAEpF,MAAM,cAAc,GAAG,KAAK,EAAE,MAAqC,EAAE,EAAE;AAEvE,CAAC,CAAC;AAEF,MAAM,aAAa,GAAG,KAAK,EACvB,OAAsC,EACtC,UAAqC,EACrC,aAA6B,EAC/B,EAAE;IAEA,IAAI,MAAM,IAAI,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE;QAE1D,aAAa,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc,CAAC,QAAQ,CAAC,GAAG,uCAAuC,CACzG,UAAU,EACV,aAAa,CAAC,cAAc,CAAC,aAAa,CAC7C,CAAC;QAGF,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,QAAQ,EAAE,aAAa,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,CAAC;KACrI;AACL,CAAC,CAAC;AAEF,oBAAoB,CAAC;IACjB,QAAQ,EAAE,gDAAgD;IAC1D,cAAc,EAAE,aAAa;IAC7B,aAAa,EAAE,cAAc;CAChC,CAAC,CAAC","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport { createDataActionHook, IActionContext, IActionInput } from '@msdyn365-commerce/core';\nimport { SalesOrder } from '@msdyn365-commerce/retail-proxy';\nimport { TelemetryEvent } from '@msdyn365-commerce/telemetry-internal';\nimport { getProductTransactionInfoFromSalesOrder } from './telemetry.action.helper';\n\nconst beforePurchase = async (inputs: IActionInput | IActionInput[]) => {\n    // placeholder\n};\n\nconst afterPurchase = async (\n    _inputs: IActionInput | IActionInput[],\n    salesOrder: SalesOrder | SalesOrder[],\n    actionContext: IActionContext\n) => {\n    // @ts-ignore\n    if (window && window._msdyn365 && window._msdyn365.telemetry) {\n        // store the purchased product information so that we can avoid \"code triggered\" remove from cart telemetry event.\n        actionContext.requestContext.telemetryData[TelemetryEvent.Purchase] = getProductTransactionInfoFromSalesOrder(\n            salesOrder,\n            actionContext.requestContext.telemetryData\n        );\n\n        // @ts-ignore\n        window._msdyn365.telemetry.logEvent(TelemetryEvent.Purchase, actionContext.requestContext.telemetryData[TelemetryEvent.Purchase]);\n    }\n};\n\ncreateDataActionHook({\n    actionId: '@msdyn365-commerce/retail-proxy/Carts/Checkout',\n    postReaderHook: afterPurchase,\n    preReaderHook: beforePurchase\n});\n"]}