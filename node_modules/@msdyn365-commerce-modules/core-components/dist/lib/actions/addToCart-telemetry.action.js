/*!
 * Copyright (c) Microsoft Corporation.
 * All rights reserved. See LICENSE in the project root for license information.
 */
import { createDataActionHook } from '@msdyn365-commerce/core';
import { TelemetryEvent } from '@msdyn365-commerce/telemetry-internal';
import { getProductInfoFromCart } from './telemetry.action.helper';
const beforeAddToCart = async (inputs, actionContext) => {
    try {
        const actionInput = Array.isArray(inputs) ? inputs[0] : inputs;
        if (actionInput.queryParams && typeof actionInput.queryParams === 'function') {
            const addCartLinesParams = actionInput.queryParams();
            if (addCartLinesParams && addCartLinesParams.cartLines) {
                actionContext.requestContext.telemetryData[`addedCartLines`] = addCartLinesParams.cartLines;
                return;
            }
        }
        actionContext.telemetry.debug('AddToCart pre-data action hook failed - No added cart lines found');
    }
    catch (e) {
        actionContext.telemetry.debug('AddToCart pre-data action hook failed.', e);
    }
};
const afterAddToCart = async (_inputs, cart, actionContext) => {
    if (window && window._msdyn365 && window._msdyn365.telemetry) {
        const addedProducts = {};
        const addedCartLines = actionContext.requestContext.telemetryData[`addedCartLines`];
        if (addedCartLines) {
            addedCartLines.forEach((cartLine) => {
                if (cartLine && cartLine.ProductId) {
                    const addedProduct = actionContext.requestContext.telemetryData[cartLine.ProductId];
                    if (addedProduct) {
                        addedProducts[cartLine.ProductId] = addedProduct;
                    }
                }
            });
        }
        window._msdyn365.telemetry.logEvent(TelemetryEvent.AddToCart, getProductInfoFromCart(cart, addedProducts, actionContext.requestContext));
    }
};
createDataActionHook({
    actionId: '@msdyn365-commerce/retail-proxy/Carts/AddCartLines',
    postReaderHook: afterAddToCart,
    preReaderHook: beforeAddToCart
});
//# sourceMappingURL=addToCart-telemetry.action.js.map