{"version":3,"file":"copyCart-checkOut-telemetry.action.js","sourceRoot":"./src/","sources":["actions/copyCart-checkOut-telemetry.action.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAEH,OAAO,EAAE,oBAAoB,EAAiD,MAAM,yBAAyB,CAAC;AAE9G,OAAO,EAAgB,cAAc,EAAE,MAAM,uCAAuC,CAAC;AAIrF,MAAM,cAAc,GAAG,KAAK,EAAE,MAAqC,EAAE,EAAE;AAEvE,CAAC,CAAC;AAEF,MAAM,aAAa,GAAG,KAAK,EAAE,OAAsC,EAAE,IAAmB,EAAE,aAA6B,EAAE,EAAE;IACvH,IAAI,MAAM,IAAI,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE;QAE1D,MAAM,UAAU,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACxD,MAAM,oBAAoB,GAAmB,EAAE,CAAC;QAChD,IAAI,UAAU,IAAI,UAAU,CAAC,SAAS,IAAI,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,UAAU,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE;YAC9G,UAAU,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,YAAsB,EAAE,EAAE;gBACpD,IAAI,YAAY,CAAC,SAAS,EAAE;oBACxB,oBAAoB,CAAC,IAAI,CAAC;wBACtB,gBAAgB,EAAE,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,EAAE;wBAC7E,kBAAkB,EAAE,EAAE;wBACtB,iBAAiB,EAAE,EAAE;wBACrB,mBAAmB,EAAE,EAAE;wBACvB,SAAS,EAAE,YAAY,CAAC,SAAS,CAAC,QAAQ,EAAE;wBAC5C,WAAW,EAAE,EAAE;wBACf,UAAU,EAAE,EAAE;wBACd,YAAY,EAAE,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,EAAE;wBACrE,eAAe,EAAE,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,YAAY,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,EAAE;wBAC9E,eAAe,EAAE,aAAa,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC,aAAa,CAAC,cAAc,CAAC,OAAO,CAAC,QAAQ,IAAI,EAAE,CAAC,CAAC,CAAC,EAAE;qBACnH,CAAC,CAAC;iBACN;YACL,CAAC,CAAC,CAAC;SACN;QAED,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,cAAc,CAAC,QAAQ,EAAE;YACzD,MAAM,EAAE,UAAU,CAAC,EAAE;YACrB,WAAW,EAAE,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,EAAE;YACpE,QAAQ,EAAE,oBAAoB;YAC9B,OAAO,EAAE,UAAU,CAAC,WAAW,CAAC,CAAC,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,EAAE;SAC3E,CAAC,CAAC;KACN;AACL,CAAC,CAAC;AAEF,oBAAoB,CAAC;IACjB,QAAQ,EAAE,4CAA4C;IACtD,cAAc,EAAE,aAAa;IAC7B,aAAa,EAAE,cAAc;CAChC,CAAC,CAAC","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation.\n * All rights reserved. See LICENSE in the project root for license information.\n */\n\nimport { createDataActionHook, IActionContext, IActionInput, IMSDyn365Window } from '@msdyn365-commerce/core';\nimport { Cart, CartLine } from '@msdyn365-commerce/retail-proxy';\nimport { IProductInfo, TelemetryEvent } from '@msdyn365-commerce/telemetry-internal';\n\ndeclare var window: IMSDyn365Window;\n\nconst beforeCopyCart = async (inputs: IActionInput | IActionInput[]) => {\n    // placeholder\n};\n\nconst afterCopyCart = async (_inputs: IActionInput | IActionInput[], cart: Cart | Cart[], actionContext: IActionContext) => {\n    if (window && window._msdyn365 && window._msdyn365.telemetry) {\n        // TODO (Matt D 4/8/20): Adding product conversion here as workaround for CheckOut bug. Will revisit in user story 6963863\n        const cartObject = Array.isArray(cart) ? cart[0] : cart;\n        const cartLineProductUnits: IProductInfo[] = [];\n        if (cartObject && cartObject.CartLines && Array.isArray(cartObject.CartLines) && cartObject.CartLines.length > 0) {\n            cartObject.CartLines.forEach((cartLineitem: CartLine) => {\n                if (cartLineitem.ProductId) {\n                    cartLineProductUnits.push({\n                        productChannelId: cartObject.ChannelId ? cartObject.ChannelId.toString() : '',\n                        productChannelName: '',\n                        productCategoryId: '',\n                        productCategoryName: '',\n                        productId: cartLineitem.ProductId.toString(),\n                        productName: '',\n                        productSku: '',\n                        productPrice: cartLineitem.Price ? cartLineitem.Price.toString() : '',\n                        productQuantity: cartLineitem.Quantity ? cartLineitem.Quantity.toString() : '',\n                        productCurrency: actionContext.requestContext.channel ? actionContext.requestContext.channel.Currency || '' : ''\n                    });\n                }\n            });\n        }\n\n        window._msdyn365.telemetry.logEvent(TelemetryEvent.CheckOut, {\n            cartId: cartObject.Id,\n            cartVersion: cartObject.Version ? cartObject.Version.toString() : '',\n            products: cartLineProductUnits,\n            orderId: cartObject.OrderNumber ? cartObject.OrderNumber.toString() : ''\n        });\n    }\n};\n\ncreateDataActionHook({\n    actionId: '@msdyn365-commerce/retail-proxy/Carts/Copy',\n    postReaderHook: afterCopyCart,\n    preReaderHook: beforeCopyCart\n});\n"]}