/*!
 * Copyright (c) Microsoft Corporation.
 * All rights reserved. See LICENSE in the project root for license information.
 */
import { createDataActionHook, TelemetryEvent } from '@msdyn365-commerce/core';
import { getProductInfoFromCart } from './telemetry.action.helper';
const beforeUpdateCart = async (inputs, actionContext) => {
    try {
        const actionInput = Array.isArray(inputs) ? inputs[0] : inputs;
        if (actionInput.queryParams && typeof actionInput.queryParams === 'function') {
            const updateCartLinesParams = actionInput.queryParams();
            if (updateCartLinesParams && updateCartLinesParams.cartLines) {
                actionContext.requestContext.telemetryData[`updatedCartLines`] = updateCartLinesParams.cartLines;
                return;
            }
        }
        actionContext.telemetry.debug('UpdateCart pre-data action hook failed - No updated cart lines found');
    }
    catch (e) {
        actionContext.telemetry.debug('UpdateCart pre-data action hook failed.', e);
    }
};
const afterUpdateCart = async (_inputs, cart, actionContext) => {
    if (window && window._msdyn365 && window._msdyn365.telemetry) {
        const updatedProducts = {};
        const updatedCartLines = actionContext.requestContext.telemetryData[`updatedCartLines`];
        if (updatedCartLines) {
            updatedCartLines.forEach((cartLine) => {
                if (cartLine && cartLine.ProductId) {
                    const updatedProduct = actionContext.requestContext.telemetryData[cartLine.ProductId];
                    if (updatedProduct) {
                        updatedProducts[cartLine.ProductId] = updatedProduct;
                    }
                }
            });
        }
        window._msdyn365.telemetry.logEvent(TelemetryEvent.UpdateInCart, getProductInfoFromCart(cart, updatedProducts, actionContext.requestContext));
    }
};
createDataActionHook({
    actionId: '@msdyn365-commerce/retail-proxy/Carts/UpdateCartLines',
    postReaderHook: afterUpdateCart,
    preReaderHook: beforeUpdateCart
});
//# sourceMappingURL=updateCart-telemetry.action.js.map