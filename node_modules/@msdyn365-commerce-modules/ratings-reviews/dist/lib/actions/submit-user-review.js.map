{"version":3,"file":"submit-user-review.js","sourceRoot":"./src/","sources":["actions/submit-user-review.ts"],"names":[],"mappings":"AAKA,OAAO,EAAE,0BAA0B,EAA2B,WAAW,EAAE,MAAM,yBAAyB,CAAC;AAQ3G,KAAK,UAAU,YAAY,CAAC,KAA2B,EAAE,GAAmB;IACxE,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE;QACtB,GAAG,CAAC,KAAK,CAAC,4EAA4E,KAAK,EAAE,CAAC,CAAC;QAC/F,OAAO,EAAE,CAAC;KACb;IAED,MAAM,UAAU,GAAG,GAAG,KAAK,CAAC,eAAe,yBAAyB,KAAK,CAAC,SAAS,QAAQ;QACvF,YAAY,KAAK,CAAC,QAAQ,GAAG;QAC7B,aAAa,KAAK,CAAC,SAAS,GAAG;QAC/B,UAAU,KAAK,CAAC,MAAM,EAAE,CAAC;IAE7B,OAAO,WAAW,CAAS,UAAU,EAAE,MAAM,EAAE,KAAK,CAAC,cAAc,EAAE,EAAC,OAAO,EAAE,EAAC,aAAa,EAAE,YAAY,KAAK,CAAC,aAAa,EAAE,EAAC,EAAC,CAAC,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,EAAE;QAClJ,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;YACpD,GAAG,CAAC,KAAK,CAAC,yDAAyD,CAAC,CAAC;YACrE,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YACzB,OAAO,EAAE,CAAC;SACb;QACD,OAAQ,QAAQ,CAAC,IAAI,CAAC;IAC1B,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,EAAE;QACf,GAAG,CAAC,KAAK,CAAC,yDAAyD,CAAC,CAAC;QACrE,GAAG,CAAC,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QAC/B,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,yDAAyD,CAAC,CAAC;QAC/E,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACjB,OAAO,EAAE,CAAC;IACd,CAAC,CAAC,CAAC;AACP,CAAC;AAED,SAAS,YAAY,CAAC,KAA4B;IAC9C,OAAO,KAAK,IAAI,CAAC,CAAC,KAAK,CAAC,SAAS,IAAI,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC;AAC1D,CAAC;AAED,MAAM,CAAC,MAAM,sBAAsB,GAAG,0BAA0B,CAAC;IAC7D,EAAE,EAAE,+DAA+D;IACnE,MAAM,EAAmB,YAAY;CACxC,CAAC,CAAC;AAEH,eAAe,sBAAsB,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createObservableDataAction, IAction, IActionContext, sendRequest } from '@msdyn365-commerce/core';\nimport { SubmitUserReviewInput } from './inputs/submit-user-review-input';\n\n/**\n * This data action allows submitting review to the reviews service\n * @param input This user review submission text\n * @param ctx The data action context\n */\nasync function submitReview(input:SubmitUserReviewInput, ctx: IActionContext):Promise<string> {\n    if (!inputIsValid(input)) {\n        ctx.trace(`[SubmitUserReview] Failed to submit reviews for product due to bad input ${input}`);\n        return '';\n    }\n\n    const requestUrl = `${input.serviceEndpoint}/v2.0/reviews/product/${input.productId}/user?` +\n        `tenantId=${input.tenantId}&` +\n        `channelId=${input.channelId}&` +\n        `locale=${input.locale}`;\n\n    return sendRequest<string>(requestUrl, 'post', input.userReviewData, {headers: {Authorization: `id_token ${input.authorization}`}}).then((response) => {\n        if (response.status !== 200 && response.status !== 201) {\n            ctx.trace(`[SubmitUserReview] Failed to submit reviews for product`);\n            ctx.trace(response.data);\n            return '';\n        }\n        return  response.data;\n    }).catch((error) => {\n        ctx.trace(`[SubmitUserReview] Failed to submit reviews for product`);\n        ctx.telemetry.exception(error);\n        ctx.telemetry.debug(`[SubmitUserReview] Failed to submit reviews for product`);\n        ctx.trace(error);\n        return '';\n    });\n}\n\nfunction inputIsValid(input: SubmitUserReviewInput): Boolean {\n    return input && !!input.productId && !!input.tenantId;\n}\n\nexport const submitReviewDataAction = createObservableDataAction({\n    id: '@msdyn365-commerce-modules/ratings-reviews/submit-user-review',\n    action: <IAction<string>>submitReview\n});\n\nexport default submitReviewDataAction;\n"]}