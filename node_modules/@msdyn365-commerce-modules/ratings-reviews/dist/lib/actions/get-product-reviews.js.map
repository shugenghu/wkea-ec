{"version":3,"file":"get-product-reviews.js","sourceRoot":"./src/","sources":["actions/get-product-reviews.ts"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getRnrEndpointId, getRnrPartnerId, getSelectedProductIdFromActionInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { Reviews } from '@msdyn365-commerce/commerce-entities';\nimport { createObservableDataAction, IAction, IActionContext, IActionInput, IAny, ICreateActionContext, IGeneric, sendRequest } from '@msdyn365-commerce/core';\nimport { GetProductReviewsInput } from './inputs/get-product-reviews-input';\n\n/**\n * TODO: Use this function to create the input required to make the API call\n */\nexport const createInputForProductReviews = (input: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    const productId = getSelectedProductIdFromActionInput(input);\n    if (productId) {\n        // Task #211227597 Remove these hardcoded values.\n        return new GetProductReviewsInput(productId, getRnrPartnerId(input), input.requestContext.locale, getRnrEndpointId(input));\n    }\n    throw new Error('[GetProductReviews] Not all necessary parameters found while creating Input for GetProductReviewsApi');\n};\n\nexport async function getReviewsForGivenProduct(input: GetProductReviewsInput, ctx: IActionContext): Promise<Reviews> {\n    if (!inputIsValid(input)) {\n        throw new Error(\n            `[GetProductReviews] Invalid input. ProductId = ${input.productId}, TenantId = ${input.tenantId}, localeListFilter = ${input.localeListFilter}`\n        );\n    }\n    let requestUrl =\n        `${input.serviceEndpoint}/v2.0/reviews/product/${input.productId}` +\n        `?tenantId=${input.tenantId}` +\n        `&localeListFilter=${input.localeListFilter}` +\n        `&pageSize=${input.pageSize}` +\n        `&orderBy=${input.orderBy}` +\n        `&skipItems=${input.skipItems}`;\n\n    if (input.starFilters !== undefined && input.starFilters.length > 0) {\n        requestUrl = `${requestUrl}&starFilters=${input.starFilters}`;\n    }\n\n    if (input.pageToken !== null) {\n        requestUrl = `${requestUrl}&pageToken=${input.pageToken}`;\n    }\n    return sendRequest<Reviews>(requestUrl, 'get')\n        .then(response => {\n            if (response.data && response.data.items && response.data.items.length > 0) {\n                return {\n                    items: response.data.items.filter(i => !i.isTakenDown),\n                    pagingInfo: response.data.pagingInfo\n                };\n            }\n            ctx.trace(`[GetProductReviews] No reviews found for this product.`);\n            return response.data;\n        })\n        .catch(error => {\n            ctx.trace(`[GetProductReviews] Failed to get reviews for product`);\n            ctx.telemetry.exception(error);\n            ctx.telemetry.debug(`[GetProductReviews] Failed to get reviews for product`);\n            throw error;\n        });\n}\n\nfunction inputIsValid(input: GetProductReviewsInput): boolean {\n    return input && input.productId.length > 0 && input.tenantId.length > 0 && input.localeListFilter.length > 0 && input.pageSize > 0;\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/ratings-reviews/get-product-reviews',\n    action: <IAction<Reviews>>getReviewsForGivenProduct,\n    input: createInputForProductReviews\n});\n"]}