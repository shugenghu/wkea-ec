/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
import { wrapInResolvedAsyncResult } from '@msdyn365-commerce-modules/retail-actions';
import { RatingsSummary } from '@msdyn365-commerce/commerce-entities';
import { buildMockModuleProps } from '@msdyn365-commerce/core';

import { render } from 'enzyme';
import * as React from 'react';
import { IRatingsReviewsState } from '../../../actions/ratings-reviews-state-data-action';
import { IRatingsHistogramViewProps } from '../ratings-histogram';
import {IRatingsHistogramData} from '../ratings-histogram.data';
import { IRatingsHistogramProps } from '../ratings-histogram.props.autogenerated';
import RatingsHistogramView from '../ratings-histogram.view';

const mockData: IRatingsHistogramData = {
    ratingsSummary: wrapInResolvedAsyncResult<RatingsSummary>({} as RatingsSummary),
    ratingsReviewsState: wrapInResolvedAsyncResult<IRatingsReviewsState>({} as IRatingsReviewsState)
};

const createItem = (stars: number) => {
    return {
    starLabel: <div>{stars} stars</div>,
        bar: <div>{stars} stars</div>,
        percentage: <div>{stars} stars</div>,
        buttonProps: {className: 'foo'}
    };
};

const items = [
    createItem(5),
    createItem(4),
    createItem(3),
    createItem(2),
    createItem(1)
];

let mockProps: IRatingsHistogramViewProps;

describe('Write Review unit tests - View', () => {
    it('renders correctly', () => {
        const moduleProps: IRatingsHistogramProps<{}>  = buildMockModuleProps({}, {}) as IRatingsHistogramProps<{}>;
        const selectFilterBy = (stars: number):void => {
            stars = stars + 1;
        };
        mockProps = {
            ...moduleProps,
            className: 'className',
            data: mockData,
            moduleProps: {
                moduleProps: moduleProps,
                className: 'className'
            },
            histogramItems: items,
            averageRating: <div>ratings</div>,
            heading: <h2>heading</h2>,
            averageNumber: <p>3</p>,
            totalReviews: <p>30</p>,
            ratingsSummaryProps: {className: 'ms-ratings-histogram__summary'},
            histogramProps: {className: 'ms-ratings-histogram__histogram'},
            callbacks: {
                selectFilterBy: selectFilterBy
            }
        };
        const component = render(<RatingsHistogramView {...mockProps} />);
        expect(component).toMatchSnapshot();
    });
});