{"version":3,"file":"search.categorysuggest.js","sourceRoot":"./src/","sources":["modules/search/components/search.categorysuggest.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as React from 'react';\n\nimport { getRichTextHtml } from '@msdyn365-commerce/core';\nimport { ProductRefiner, ProductRefinerValue, SearchSuggestion } from '@msdyn365-commerce/retail-proxy';\n\nimport { format, getPayloadObject, getTelemetryAttributes, IPayLoad, ITelemetryContent } from '@msdyn365-commerce-modules/utilities';\nimport { ISearchData } from '../search.data';\nimport { ISearchProps } from '../search.props.autogenerated';\n\nexport interface ISearchCategorySuggestProps {\n    searchCategorySuggestClass: string;\n    searchPageURL: string;\n    searchQsp: string | undefined;\n    hitPrefix: string;\n    hitSuffix: string;\n    autoSuggestProps: ISearchProps<ISearchData>;\n    searchText: string;\n    searchRefiners: ProductRefiner[] | undefined;\n    suggestions: SearchSuggestion[] | undefined;\n    telemetryContent?: ITelemetryContent;\n}\n\nexport interface ISearchCategoryViewProps {\n    title: React.ReactNode;\n    text: React.ReactNode[];\n}\n\nlet payLoad: IPayLoad;\n\n/**\n *\n * CategorySuggestionsComponent\n */\nexport const CategorySuggestionsComponent = (props: ISearchCategorySuggestProps): ISearchCategoryViewProps | undefined => {\n    const {\n        suggestions,\n        searchText,\n        autoSuggestProps: {\n            resources: { categorySuggestionHeading }\n        }\n    } = props;\n\n    if (!suggestions) {\n        return undefined;\n    }\n\n    const reactNodes: React.ReactNode[] = [];\n    payLoad = getPayloadObject('click', props.telemetryContent!, '');\n\n    suggestions.map(item => {\n        reactNodes.push(_assembleNode(item, props));\n    });\n\n    const titleNode = _renderTitle(categorySuggestionHeading, searchText);\n\n    return { title: titleNode, text: reactNodes };\n};\n\nconst _renderTitle = (categorySuggestionHeading: string, searchText: string) => {\n    const categoryAutoSuggestionHeading = categorySuggestionHeading\n        ? format(categorySuggestionHeading, searchText)\n        : `Search \"${searchText}\" in categories`;\n\n    return <li className='msc-autoSuggest__categoryResults-title'>{categoryAutoSuggestionHeading}</li>;\n};\n\nconst _assembleNode = (item: SearchSuggestion, props: ISearchCategorySuggestProps) => {\n    const { searchText, hitPrefix, hitSuffix } = props;\n\n    const splitValue = item.Value && item.Value.split('|').pop();\n    const ariaLabel = splitValue\n        ? splitValue.replace(new RegExp(`[${hitPrefix}]`, 'gi'), '').replace(new RegExp(`[${hitSuffix}]`, 'gi'), '')\n        : item.Value && item.Value.replace(new RegExp(`[${hitPrefix}]`, 'gi'), '').replace(new RegExp(`[${hitSuffix}]`, 'gi'), '');\n    payLoad.contentAction.etext = item.Value;\n    const attribute = getTelemetryAttributes(props.telemetryContent!, payLoad);\n    return (\n        <li className='msc-autoSuggest__categoryResults-item' key={item.Id}>\n            <a aria-label={ariaLabel} href={_generateLink(item, searchText, props)} {...attribute}>\n                {_generateLink(item, searchText, props) && _getHighlightedText(item.Value ? item.Value : '', hitPrefix, hitSuffix)}\n            </a>\n        </li>\n    );\n};\n\nconst _generateLink = (suggestion: SearchSuggestion, searchText: string, props: ISearchCategorySuggestProps): string => {\n    return suggestion && suggestion.Id ? _getCategoryLink(suggestion.Id, searchText, props) : '';\n};\n\nconst _getCategoryLink = (id: string, searchText: string, props: ISearchCategorySuggestProps): string => {\n    const { searchPageURL, searchQsp, searchRefiners } = props;\n\n    const route = searchPageURL || '';\n    const urlPath = `${route}${route.indexOf('?') === -1 ? '?' : '&'}${searchQsp}=${searchText}`;\n    const categoryRefiners =\n        searchRefiners &&\n        searchRefiners.find(refiners => {\n            return refiners.KeyName === 'Category';\n        });\n    const refiner =\n        categoryRefiners &&\n        categoryRefiners.Values &&\n        categoryRefiners.Values.find(item => {\n            return item.RefinerRecordId === parseInt(id, 10);\n        });\n\n    const encodedRefiner = refiner && encodeURIComponent(JSON.stringify(compressRefiners([refiner])));\n\n    return encodedRefiner ? `${urlPath}&refiners=${encodedRefiner}` : urlPath;\n};\n\nconst _getHighlightedText = (suggestion: string, hitPrefix: string, hitSuffix: string): JSX.Element => {\n    let formattedText = suggestion\n        .replace(new RegExp(`[${hitPrefix}]`, 'gi'), '<strong>')\n        .replace(new RegExp(`[${hitSuffix}]`, 'gi'), '</strong>');\n    formattedText = formattedText.split('|').pop() || '';\n\n    // tslint:disable:react-no-dangerous-html\n    return <span dangerouslySetInnerHTML={getRichTextHtml(formattedText)} />;\n};\n\n// TODO: This code is currently duplicated in categoryautosuggest need to either remove one of these files\n// or move this code to a common place\nconst compressedRefinerKeys = ['DataTypeValue', 'LeftValueBoundString', 'RefinerRecordId', 'RefinerSourceValue', 'RightValueBoundString', 'UnitText'];\n\n/**\n * Compressed a list of refiners for use in URLs\n * @param refiners The uncompressed refiners\n */\nconst compressRefiners = (refiners: ProductRefinerValue[]) => {\n    const compressedRefiners: (string | number)[][] = [];\n\n    refiners.forEach((refiner) => {\n        const compressedRefiner: (string | number)[] = [];\n        compressedRefinerKeys.forEach((refinerKey) => {\n            // @ts-ignore: This line is intentionally not typesafe\n            compressedRefiner.push(refiner[refinerKey]);\n        });\n        compressedRefiners.push(compressedRefiner);\n    });\n\n    return compressedRefiners;\n};\n"]}