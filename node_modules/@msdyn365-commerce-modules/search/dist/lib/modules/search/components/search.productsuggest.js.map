{"version":3,"file":"search.productsuggest.js","sourceRoot":"./src/","sources":["modules/search/components/search.productsuggest.tsx"],"names":[],"mappings":"AAKA,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAE/B,OAAO,EAAE,cAAc,EAAE,MAAM,+BAA+B,CAAC;AAC/D,OAAO,EAAE,eAAe,EAAkC,KAAK,EAAc,MAAM,yBAAyB,CAAC;AAG7G,OAAO,EAAE,qBAAqB,EAAE,MAAM,2CAA2C,CAAC;AAClF,OAAO,EAAE,gBAAgB,EAAE,sBAAsB,EAAoD,MAAM,sCAAsC,CAAC;AAiClJ,IAAI,OAAiB,CAAC;AACtB,IAAI,gBAA+C,CAAC;AAMpD,MAAM,CAAC,MAAM,2BAA2B,GAAG,CAAC,KAAiC,EAAuC,EAAE;IAClH,MAAM,EACF,WAAW,EACX,SAAS,EACT,SAAS,EACT,gBAAgB,EAAE,EACd,OAAO,EAAE,EAAE,aAAa,EAAE,EAC1B,SAAS,EAAE,EAAE,wBAAwB,EAAE,EAC1C,EACD,UAAU,EACV,QAAQ,EACX,GAAG,KAAK,CAAC;IACV,MAAM,UAAU,GAAkC,EAAE,CAAC;IACrD,gBAAgB,GAAG,KAAK,CAAC,gBAAgB,CAAC;IAC1C,OAAO,GAAG,gBAAgB,CAAC,OAAO,EAAE,KAAK,CAAC,gBAAiB,EAAE,EAAE,CAAC,CAAC;IAEjE,IAAI,CAAC,WAAW,EAAE;QACd,OAAO,SAAS,CAAC;KACpB;IAED,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;QACnB,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,aAAa,EAAE,KAAK,EAAE,UAAU,EAAE,QAAQ,CAAC,CAAC,CAAC;IAC3G,CAAC,CAAC,CAAC;IAEH,MAAM,SAAS,GAAG,YAAY,CAAC,wBAAwB,CAAC,CAAC;IAEzD,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC;AACnD,CAAC,CAAC;AAEF,MAAM,YAAY,GAAG,CAAC,wBAAgC,EAAE,EAAE;IACtD,MAAM,4BAA4B,GAAG,wBAAwB,CAAC,CAAC,CAAC,wBAAwB,CAAC,CAAC,CAAC,gBAAgB,CAAC;IAE5G,OAAO,4BAAI,SAAS,EAAC,uCAAuC,IAAE,4BAA4B,CAAM,CAAC;AACrG,CAAC,CAAC;AAEF,MAAM,aAAa,GAAG,CAClB,IAAsB,EACtB,SAAiB,EACjB,SAAiB,EACjB,aAA6B,EAC7B,KAAiC,EACjC,UAAkB,EAClB,QAAgB,EACW,EAAE;IAC7B,MAAM,OAAO,GACT,IAAI,CAAC,KAAK;QACV,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,SAAS,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,SAAS,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;IAEjH,OAAO;QACH,IAAI,EAAE,mBAAmB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,SAAS,EAAE,SAAS,CAAC;QAC7E,SAAS,EAAE,gBAAgB,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,KAAK,CAAC;QAChE,KAAK,EACD,IAAI,CAAC,EAAE;YACP,IAAI,CAAC,MAAM;YACX,IAAI,CAAC,MAAM,CAAC,KAAK;YACjB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,YAAY;YAC9B,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,YAAY,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,YAAY,EAAE,QAAQ,EAAE,UAAU,EAAE,KAAK,CAAC;QAC7G,SAAS,EAAE,aAAa,EAAE;QAC1B,QAAQ,EAAE,YAAY,CAAC,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,aAAa,CAAC;QACjE,EAAE,EAAE,IAAI,CAAC,EAAE;KACd,CAAC;AACN,CAAC,CAAC;AAEF,MAAM,aAAa,GAAG,GAAG,EAAE;IACvB,OAAO;QACH,SAAS,EAAE,sCAAsC;QACjD,GAAG,EAAE,IAAe;KACvB,CAAC;AACN,CAAC,CAAC;AAEF,MAAM,YAAY,GAAG,CAAC,IAAsB,EAAE,SAAiB,EAAE,SAAiB,EAAE,aAA6B,EAAE,EAAE;IACjH,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK;QACxB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,SAAS,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,SAAS,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;IAEjH,OAAO,CAAC,aAAa,CAAC,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC;IACtC,MAAM,SAAS,GAAG,sBAAsB,CAAC,gBAAiB,EAAE,OAAO,CAAC,CAAC;IAErE,OAAO;QACH,SAAS,EAAE,sCAAsC;QACjD,GAAG,EAAE,GAAc;QACnB,YAAY,EAAE,SAAS;QACvB,IAAI,EAAE,aAAa,CAAC,IAAI,EAAE,SAAS,EAAE,SAAS,EAAE,aAAa,CAAC;QAC9D,GAAG,SAAS;KACf,CAAC;AACN,CAAC,CAAC;AAEF,MAAM,aAAa,GAAG,CAAC,UAA4B,EAAE,SAAiB,EAAE,SAAiB,EAAE,aAA6B,EAAE,EAAE;IACxH,MAAM,aAAa,GAAI,UAAU,CAAC,KAAgB,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,SAAS,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,SAAS,GAAG,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;IACnJ,OAAO,UAAU,CAAC,KAAK,IAAI,UAAU,CAAC,EAAE,CAAC,CAAC;QACtC,qBAAqB,CAAC,aAAa,EAAC,UAAU,CAAC,EAAuB,EAAE,aAAa,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;AAC/G,CAAC,CAAC;AAEF,MAAM,mBAAmB,GAAG,CAAC,UAAkB,EAAE,SAAiB,EAAE,SAAiB,EAAe,EAAE;IAClG,MAAM,aAAa,GAAG,UAAU;SAC3B,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,SAAS,GAAG,EAAE,IAAI,CAAC,EAAE,UAAU,CAAC;SACvD,OAAO,CAAC,IAAI,MAAM,CAAC,IAAI,SAAS,GAAG,EAAE,IAAI,CAAC,EAAE,WAAW,CAAC,CAAC;IAG9D,OAAO,8BAAM,SAAS,EAAC,qDAAqD,EAAE,uBAAuB,EAAE,eAAe,CAAC,aAAa,CAAC,GAAI,CAAC;AAC9I,CAAC,CAAC;AAEF,MAAM,YAAY,GAAG,CAAC,aAAqB,EAAE,SAAiB,EAAE,QAAgB,EAAE,UAAkB,EAAE,KAAiC,EAAsB,EAAE;IAC3J,MAAM,EACF,gBAAgB,EAAE,EAAE,OAAO,EAAE,EAChC,GAAG,KAAK,CAAC;IAEV,OAAO,CACH,oBAAC,cAAc,IACX,EAAE,EAAE,QAAQ,EACZ,QAAQ,EAAE,UAAU,EACpB,OAAO,EAAE,OAAO,EAChB,IAAI,EAAE;YACF,KAAK,EAAE;gBACH,uBAAuB,EAAE,aAAa;gBACtC,SAAS,EAAE,SAAS;aACvB;SACJ,EACD,SAAS,EAAC,4CAA4C,GACxD,CACL,CAAC;AACN,CAAC,CAAC;AAEF,MAAM,gBAAgB,GAAG,CAAC,UAA4B,EAAE,OAAe,EAAE,KAAiC,EAAsB,EAAE;IAC9H,MAAM,EACF,gBAAgB,EAAE,EACd,OAAO,EAAE,EACL,OAAO,EAAE,EAAE,YAAY,EAAE,EAC5B,EACD,MAAM,EAAE,EAAE,aAAa,EAAE,EAC5B,EACJ,GAAG,KAAK,CAAC;IAEV,IAAI,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,QAAQ,EAAE;QACrC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,yDAAyD,CAAC,CAAC;QACjF,OAAO,IAAI,CAAC;KACf;IAED,MAAM,oBAAoB,GAAmB;QACzC,SAAS,EAAE;YACP,EAAE,EAAE,EAAE,CAAC,EAAE,eAAe,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;YACtC,EAAE,EAAE,EAAE,CAAC,EAAE,eAAe,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;YACtC,EAAE,EAAE,EAAE,CAAC,EAAE,eAAe,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE;SACzC;QACD,QAAQ,EAAE,IAAI;KACjB,CAAC;IAEF,OAAO,CACH,oBAAC,KAAK,IACF,OAAO,EAAE,OAAO,EAChB,SAAS,EAAC,0CAA0C,EACpD,GAAG,EAAE,UAAU,CAAC,QAAQ,EACxB,YAAY,EAAE,YAAa,EAC3B,aAAa,EAAE,aAAa,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,oBAAoB,EACnE,mBAAmB,EAAC,MAAM,GAC5B,CACL,CAAC;AACN,CAAC,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as React from 'react';\n\nimport { PriceComponent } from '@msdyn365-commerce/components';\nimport { getRichTextHtml, IActionContext, IImageSettings, Image, ITelemetry } from '@msdyn365-commerce/core';\nimport { SearchSuggestion } from '@msdyn365-commerce/retail-proxy';\n\nimport { getProductPageUrlSync } from '@msdyn365-commerce-modules/retail-actions';\nimport { getPayloadObject, getTelemetryAttributes, INodeProps, IPayLoad, ITelemetryContent, NodeTag } from '@msdyn365-commerce-modules/utilities';\nimport { ISearchData } from '../search.data';\nimport { ISearchProps } from '../search.props.autogenerated';\n\nexport interface ISearchProductSuggestProps {\n    searchProductSuggestClass: string;\n    searchPageURL: string;\n    searchQsp: string | undefined;\n    hitPrefix: string;\n    hitSuffix: string;\n    autoSuggestProps: ISearchProps<ISearchData>;\n    searchText: string;\n    suggestions: SearchSuggestion[] | undefined;\n    telemetry: ITelemetry;\n    moduleType: string;\n    moduleId: string;\n    telemetryContent?: ITelemetryContent;\n}\n\nexport interface ISearchProductViewProps {\n    title: React.ReactNode;\n    items: ISearchProductItemViewProps[];\n}\n\nexport interface ISearchProductItemViewProps {\n    text: React.ReactNode;\n    thumbnail: React.ReactNode;\n    price: React.ReactNode;\n    LiProduct: INodeProps;\n    AProduct: INodeProps;\n    id: string | undefined;\n}\n\nlet payLoad: IPayLoad;\nlet telemetryContent: ITelemetryContent | undefined;\n\n/**\n *\n * ProductSuggestionsComponent\n */\nexport const ProductSuggestionsComponent = (props: ISearchProductSuggestProps): ISearchProductViewProps | undefined => {\n    const {\n        suggestions,\n        hitSuffix,\n        hitPrefix,\n        autoSuggestProps: {\n            context: { actionContext },\n            resources: { productSuggestionHeading }\n        },\n        moduleType,\n        moduleId\n    } = props;\n    const reactNodes: ISearchProductItemViewProps[] = [];\n    telemetryContent = props.telemetryContent;\n    payLoad = getPayloadObject('click', props.telemetryContent!, '');\n\n    if (!suggestions) {\n        return undefined;\n    }\n\n    suggestions.map(item => {\n        reactNodes.push(_assembleNode(item, hitPrefix, hitSuffix, actionContext, props, moduleType, moduleId));\n    });\n\n    const titleNode = _renderTitle(productSuggestionHeading);\n\n    return { title: titleNode, items: reactNodes };\n};\n\nconst _renderTitle = (productSuggestionHeading: string) => {\n    const productAutoSuggestionHeading = productSuggestionHeading ? productSuggestionHeading : 'Go to products';\n\n    return <li className='msc-autoSuggest__productResults-title'>{productAutoSuggestionHeading}</li>;\n};\n\nconst _assembleNode = (\n    item: SearchSuggestion,\n    hitPrefix: string,\n    hitSuffix: string,\n    actionContext: IActionContext,\n    props: ISearchProductSuggestProps,\n    moduleType: string,\n    moduleId: string\n): ISearchProductItemViewProps => {\n    const altText =\n        item.Value &&\n        (item.Value).replace(new RegExp(`[${hitPrefix}]`, 'gi'), '').replace(new RegExp(`[${hitSuffix}]`, 'gi'), '');\n\n    return {\n        text: _getHighlightedText(item.Value ? item.Value : '', hitPrefix, hitSuffix),\n        thumbnail: _renderThumbnail(item, altText ? altText : '', props),\n        price:\n            item.Id &&\n            item.Value3 &&\n            item.Value3.Value &&\n            item.Value3.Value.DecimalValue &&\n            _renderPrice(item.Value3.Value.DecimalValue, item.Value3.Value.DecimalValue, moduleId, moduleType, props),\n        LiProduct: _getLiWrapper(),\n        AProduct: _getAWrapper(item, hitPrefix, hitSuffix, actionContext),\n        id: item.Id\n    };\n};\n\nconst _getLiWrapper = () => {\n    return {\n        className: 'msc-autoSuggest__productResults-item',\n        tag: 'li' as NodeTag\n    };\n};\n\nconst _getAWrapper = (item: SearchSuggestion, hitPrefix: string, hitSuffix: string, actionContext: IActionContext) => {\n    const ariaLabel = item.Value &&\n        (item.Value).replace(new RegExp(`[${hitPrefix}]`, 'gi'), '').replace(new RegExp(`[${hitSuffix}]`, 'gi'), '');\n\n    payLoad.contentAction.recid = item.Id;\n    const attribute = getTelemetryAttributes(telemetryContent!, payLoad);\n\n    return {\n        className: 'msc-autoSuggest__productResults-item',\n        tag: 'a' as NodeTag,\n        'aria-label': ariaLabel,\n        href: _generateLink(item, hitPrefix, hitSuffix, actionContext),\n        ...attribute\n    };\n};\n\nconst _generateLink = (suggestion: SearchSuggestion, hitPrefix: string, hitSuffix: string, actionContext: IActionContext) => {\n    const formattedLink = (suggestion.Value as string).replace(new RegExp(`[${hitPrefix}]`, 'gi'), '').replace(new RegExp(`[${hitSuffix}]`, 'gi'), '');\n    return suggestion.Value && suggestion.Id ?\n        getProductPageUrlSync(formattedLink,suggestion.Id as unknown as number, actionContext, undefined) : '';\n};\n\nconst _getHighlightedText = (suggestion: string, hitPrefix: string, hitSuffix: string): JSX.Element => {\n    const formattedText = suggestion\n        .replace(new RegExp(`[${hitPrefix}]`, 'gi'), '<strong>')\n        .replace(new RegExp(`[${hitSuffix}]`, 'gi'), '</strong>');\n\n    // tslint:disable:react-no-dangerous-html\n    return <span className='msc-price msc-autoSuggest__productResults-item-text'  dangerouslySetInnerHTML={getRichTextHtml(formattedText)} />;\n};\n\nconst _renderPrice = (adjustedPrice: number, basePrice: number, moduleId: string, moduleType: string, props: ISearchProductSuggestProps): JSX.Element | null => {\n    const {\n        autoSuggestProps: { context }\n    } = props;\n\n    return (\n        <PriceComponent\n            id={moduleId}\n            typeName={moduleType}\n            context={context}\n            data={{\n                price: {\n                    CustomerContextualPrice: adjustedPrice,\n                    BasePrice: basePrice\n                }\n            }}\n            className='msc-autoSuggest__productResults-item-price'\n        />\n    );\n};\n\nconst _renderThumbnail = (suggestion: SearchSuggestion, altText: string, props: ISearchProductSuggestProps): JSX.Element | null => {\n    const {\n        autoSuggestProps: {\n            context: {\n                request: { gridSettings }\n            },\n            config: { imageSettings }\n        }\n    } = props;\n\n    if (!suggestion || !suggestion.ImageUrl) {\n        props.telemetry.error('Search suggestion content is empty, module wont render.');\n        return null;\n    }\n\n    const defaultImageSettings: IImageSettings = {\n        viewports: {\n            xs: { q: `w=40&h=40&m=6`, w: 0, h: 0 },\n            lg: { q: `w=40&h=40&m=6`, w: 0, h: 0 },\n            xl: { q: `w=40&h=40&m=6`, w: 0, h: 0 }\n        },\n        lazyload: true\n    };\n\n    return (\n        <Image\n            altText={altText}\n            className='msc-autoSuggest__productResults-item-img'\n            src={suggestion.ImageUrl}\n            gridSettings={gridSettings!}\n            imageSettings={imageSettings ? imageSettings : defaultImageSettings}\n            loadFailureBehavior='hide'\n        />\n    );\n};\n"]}