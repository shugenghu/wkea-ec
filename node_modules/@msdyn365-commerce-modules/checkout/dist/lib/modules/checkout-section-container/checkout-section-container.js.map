{"version":3,"file":"checkout-section-container.js","sourceRoot":"./src/","sources":["modules/checkout-section-container/checkout-section-container.tsx"],"names":[],"mappings":";AAKA,OAAO,EAA0C,eAAe,EAAE,MAAM,+CAA+C,CAAC;AAExH,OAAO,SAAS,MAAM,YAAY,CAAC;AACnC,OAAO,GAAG,MAAM,YAAY,CAAC;AAC7B,OAAO,EAAE,QAAQ,EAAE,MAAM,MAAM,CAAC;AAChC,OAAO,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAC;AACtC,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAE/B,OAAO,gBAAgB,MAAM,sBAAsB,CAAC;AAyBpD,IAAa,sBAAsB,GAAnC,MAAa,sBAAuB,SAAQ,KAAK,CAAC,SAA+C;IAAjG;;QAuGY,aAAQ,GAAG,GAAsB,EAAE;YACvC,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;YAC7B,OAAO,CAAC,KAAK,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;QACnF,CAAC,CAAC;QAEM,+BAA0B,GAAG,GAA0B,EAAE;YAC7D,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;YACvD,OAAO,QAAQ;iBACV,GAAG,CAAC,SAAS,CAAC;iBACd,MAAM,CAAC,CAAC,KAAK,EAAgC,EAAE,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,UAAU,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC;QAC/G,CAAC,CAAC;QAEM,eAAU,GAAG,GAAS,EAAE;YAE5B,IAAI,CAAC,0BAA0B,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBAC9C,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;YAC/C,CAAC,CAAC,CAAC;QACP,CAAC,CAAC;QAEM,aAAQ,GAAG,GAAS,EAAE;YAC1B,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,IAAI,CAAC,0BAA0B,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBAC9C,CAAC,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,QAAQ,EAAE,CAAC;YACzD,CAAC,CAAC,CAAC;QACP,CAAC,CAAC;QAEM,aAAQ,GAAG,GAAS,EAAE;YAC1B,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,IAAI,CAAC,0BAA0B,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBAC9C,CAAC,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,QAAQ,EAAE,CAAC;YACzD,CAAC,CAAC,CAAC;QACP,CAAC,CAAC;QAEM,WAAM,GAAG,GAAS,EAAE;YACxB,IAAI,CAAC,0BAA0B,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBAC9C,CAAC,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,SAAS,CAAC,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,MAAM,EAAE,CAAC;YACzE,CAAC,CAAC,CAAC;QACP,CAAC,CAAC;QAEM,qBAAgB,GAAG,GAAS,EAAE;YAClC,IAAI,CAAC,0BAA0B,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBAC9C,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,gBAAgB,IAAI,KAAK,CAAC,gBAAgB,EAAE,CAAC;YACxE,CAAC,CAAC,CAAC;QACP,CAAC,CAAC;IACN,CAAC;IAlJU,iBAAiB;QACpB,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9B,MAAM,QAAQ,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,IAAqB,EAAE,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC,CAAC;QAC7E,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC;YACxB,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,QAAQ;SACX,CAAC,CAAC;QAEH,QAAQ,CACJ,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,EACpC,GAAG,EAAE;YACD,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC5B,CAAC,CACJ,CAAC;QAEF,QAAQ,CACJ,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,qBAAqB,EAClD,GAAG,EAAE;YACD,IAAI,CAAC,QAAQ,EAAE,CAAC;QACpB,CAAC,CACJ,CAAC;IACN,CAAC;IAEM,kBAAkB;QACrB,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,sBAAsB,EAAE;YAChD,OAAO;SACV;QAID,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC;QACjE,MAAM,aAAa,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAe,EAAE,EAAE;YACpD,MAAM,KAAK,GAAG,SAAS,CAAC,OAAO,CAAC,CAAC;YACjC,OAAO,CAAC,CAAC,KAAK,IAAI,KAAK,CAAC,OAAO,CAAC;QACpC,CAAC,CAAC,CAAC;QACH,IAAI,aAAa,IAAI,QAAQ,EAAE;YAC3B,IAAI,CAAC,MAAM,EAAE,CAAC;SACjB;IACL,CAAC;IAEM,MAAM;QACT,MAAM,EACF,aAAa,EACb,WAAW,EACX,MAAM,EAAE,EAAE,KAAK,EAAE,EACpB,GAAG,IAAI,CAAC,KAAK,CAAC;QAEf,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC9B,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;YACf,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,uDAAuD,CAAC,CAAC;YAC5F,OAAO,IAAI,CAAC;SACf;QAED,MAAM,eAAe,GAAG,SAAS,CAC7B,+BAA+B,EAC/B;YACI,iBAAiB,EAAE,WAAW,CAAC,cAAc;YAC7C,UAAU,EAAE,WAAW,CAAC,OAAO;YAC/B,aAAa,EAAE,CAAC,WAAW,CAAC,OAAO;YACnC,SAAS,EAAE,KAAK,KAAK,WAAW;YAChC,kBAAkB,EAAE,KAAK,KAAK,OAAO;SACxC,EACD,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAC9B,CAAC;QAEF,MAAM,SAAS,GAAuC;YAClD,GAAG,IAAI,CAAC,KAAK;YAEb,SAAS,EAAE,eAAe;YAC1B,2BAA2B,EAAE;gBACzB,WAAW,EAAE,IAAI,CAAC,KAAK;gBACvB,SAAS,EAAE,eAAe;aAC7B;YACD,KAAK,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,IAAqB,EAAE,EAAE;gBACvC,MAAM,OAAO,GAAG,GAAG,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;gBACtC,MAAM,KAAK,GAAG,WAAW,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;gBAE7C,MAAM,MAAM,GAAG,KAAK,CAAC,cAAc,IAAI,CAAC,CAAC,KAAK,CAAC,cAAc,IAAI,KAAK,CAAC,UAAU,IAAI,KAAK,CAAC,SAAS,CAAC,CAAC;gBACtG,OAAO;oBACH,EAAE,EAAE,OAAO;oBACX,OAAO,EAAE,KAAK,CAAC,cAAc,IAAI,CAAC,KAAK,CAAC,cAAc,IAAI,oBAAC,gBAAgB,OAAG;oBAC9E,SAAS,EAAE;wBACP,gBAAgB,EAAE,KAAK,CAAC,QAAQ;wBAChC,SAAS,EAAE,SAAS,CAAC,qCAAqC,EAAE;4BACxD,MAAM,EAAE,MAAM;4BACd,WAAW,EAAE,KAAK,CAAC,cAAc;4BACjC,QAAQ,EAAE,KAAK,CAAC,UAAU;4BAC1B,OAAO,EAAE,KAAK,CAAC,SAAS;4BACxB,KAAK,EAAE,KAAK,CAAC,OAAO;4BACpB,QAAQ,EAAE,KAAK,CAAC,UAAU;4BAC1B,OAAO,EAAE,KAAK,CAAC,SAAS;yBAC3B,CAAC;qBACL;oBACD,IAAI,EAAE,KAAK,CAAC,YAAY,CAAC,IAA0B,EAAE,EAAE,aAAa,EAAE,CAAC;iBAC1E,CAAC;YACN,CAAC,CAAC;SACL,CAAC;QACF,OAAO,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,SAAS,CAAuB,CAAC;IAClE,CAAC;CA8CJ,CAAA;AAnJY,sBAAsB;IADlC,QAAQ;GACI,sBAAsB,CAmJlC;SAnJY,sBAAsB;AAqJnC,eAAe,eAAe,CAAC,sBAAsB,CAAC,CAAC","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IModuleStateManager, IModuleStateProps, withModuleState } from '@msdyn365-commerce-modules/checkout-utilities';\nimport { IModuleProps, INodeProps } from '@msdyn365-commerce-modules/utilities';\nimport classname from 'classnames';\nimport get from 'lodash/get';\nimport { reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\nimport { ICheckoutSectionContainerProps } from './checkout-section-container.props.autogenerated';\nimport LoadingComponent from './components/loading';\n\nexport interface ICheckoutSectionContainerModuleProps extends ICheckoutSectionContainerProps<{}>, IModuleStateProps {\n    enableControl: boolean;\n}\n\nexport interface ICheckoutSectionContainerItem {\n    id: string;\n    loading?: React.ReactNode;\n    itemProps: INodeProps;\n    item: React.ReactNode;\n}\n\nexport interface ICheckoutSectionContainerViewProps extends ICheckoutSectionContainerProps<{}> {\n    className: string;\n    checkoutPlainContainerProps: IModuleProps;\n    items: ICheckoutSectionContainerItem[];\n}\n\n/**\n *\n * CheckoutPlainContainer component\n * @extends {React.Component<ICheckoutSectionContainerModuleProps>}\n */\n@observer\nexport class CheckoutPlainContainer extends React.Component<ICheckoutSectionContainerModuleProps> {\n    public componentDidMount(): void {\n        const items = this.getItems();\n        const childIds = items.map((item: React.ReactNode) => get(item, 'props.id'));\n        this.props.moduleState.init({\n            onEdit: this.onEdit,\n            onCancel: this.onCancel,\n            onSubmit: this.onSubmit,\n            childIds\n        });\n\n        reaction(\n            () => this.props.moduleState.isReady,\n            () => {\n                this.onContainerReady();\n            }\n        );\n\n        reaction(\n            () => this.props.moduleState.shouldSubmitContainer,\n            () => {\n                this.onSubmit();\n            }\n        );\n    }\n\n    public componentDidUpdate(): void {\n        if (!this.props.moduleState.hasExternalSubmitGroup) {\n            return;\n        }\n        /**\n         * Review all modules to updating status if one of the modules has error\n         */\n        const { childIds, hasError, getModule } = this.props.moduleState;\n        const hasReadyItems = childIds.some((childId: string) => {\n            const state = getModule(childId);\n            return !!state && state.isReady;\n        });\n        if (hasReadyItems && hasError) {\n            this.onEdit();\n        }\n    }\n\n    public render(): JSX.Element | null {\n        const {\n            enableControl,\n            moduleState,\n            config: { width }\n        } = this.props;\n\n        const items = this.getItems();\n        if (!items.length) {\n            this.props.context.telemetry.error('Checkout section content is empty, module wont render');\n            return null;\n        }\n\n        const moduleClassName = classname(\n            'ms-checkout-section-container',\n            {\n                'has-initialized': moduleState.hasInitialized,\n                'is-ready': moduleState.isReady,\n                'is-updating': !moduleState.isReady,\n                container: width === 'container',\n                'col-12 fullwidth': width === 'fluid'\n            },\n            this.props.config.className\n        );\n\n        const viewProps: ICheckoutSectionContainerViewProps = {\n            ...this.props,\n\n            className: moduleClassName,\n            checkoutPlainContainerProps: {\n                moduleProps: this.props,\n                className: moduleClassName\n            },\n            items: items.map((item: React.ReactNode) => {\n                const childId = get(item, 'props.id');\n                const state = moduleState.getModule(childId);\n                // Modules has not completed initializing or it's disable\n                const hidden = state.hasModuleState && (!state.hasInitialized || state.isDisabled || state.isSkipped);\n                return {\n                    id: childId,\n                    loading: state.hasModuleState && !state.hasInitialized && <LoadingComponent />,\n                    itemProps: {\n                        'data-type-name': state.typeName,\n                        className: classname('ms-checkout-section-container__item', {\n                            hidden: hidden,\n                            initialized: state.hasInitialized,\n                            disabled: state.isDisabled,\n                            skipped: state.isSkipped,\n                            ready: state.isReady,\n                            updating: state.isUpdating,\n                            pending: state.isPending\n                        })\n                    },\n                    item: React.cloneElement(item as React.ReactElement, { enableControl })\n                };\n            })\n        };\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private getItems = (): React.ReactNode[] => {\n        const { slots } = this.props;\n        return (slots && slots.primary && slots.primary.length && slots.primary) || [];\n    };\n\n    private getActiveChildModuleStates = (): IModuleStateManager[] => {\n        const { childIds, getModule } = this.props.moduleState;\n        return childIds\n            .map(getModule)\n            .filter((state): state is IModuleStateManager => !!state && !state.isDisabled && state.hasModuleState);\n    };\n\n    private clearError = (): void => {\n        // Clear error before action, otherwise it will rise conflict;\n        this.getActiveChildModuleStates().forEach(state => {\n            state.hasError && state.setHasError(false);\n        });\n    };\n\n    private onSubmit = (): void => {\n        this.clearError();\n        this.getActiveChildModuleStates().forEach(state => {\n            !state.isReady && state.onSubmit && state.onSubmit();\n        });\n    };\n\n    private onCancel = (): void => {\n        this.clearError();\n        this.getActiveChildModuleStates().forEach(state => {\n            !state.isReady && state.onCancel && state.onCancel();\n        });\n    };\n\n    private onEdit = (): void => {\n        this.getActiveChildModuleStates().forEach(state => {\n            (state.isReady || state.isSkipped) && state.onEdit && state.onEdit();\n        });\n    };\n\n    private onContainerReady = (): void => {\n        this.getActiveChildModuleStates().forEach(state => {\n            state.isReady && state.onContainerReady && state.onContainerReady();\n        });\n    };\n}\n\nexport default withModuleState(CheckoutPlainContainer);\n"]}