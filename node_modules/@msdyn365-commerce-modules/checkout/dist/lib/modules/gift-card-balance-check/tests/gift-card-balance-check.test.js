import { mount, render, shallow } from 'enzyme';
import * as React from 'react';
import { buildHydratedMockActionContext, buildMockModuleProps } from '@msdyn365-commerce/core';
import GiftCardBalanceCheck from '../gift-card-balance-check';
import * as StoreOperationsDataActions from '@msdyn365-commerce/retail-proxy/dist/DataActions/StoreOperationsDataActions.g';
import View from '../gift-card-balance-check.view';
jest.mock('@msdyn365-commerce/retail-proxy/dist/DataActions/StoreOperationsDataActions.g');
let mockInternalGiftCardTypes;
let mockExternalGiftCardTypes;
let mockGiftCard;
let mockGiftCardEmpty;
let mockConfig;
let mockContext;
let mockActions;
let actionContext;
let mockResources;
let mockTenderTypes;
describe('GiftCardBalanceCheck', () => {
    beforeEach(() => {
        mockInternalGiftCardTypes = [
            {
                IsPinRequired: false,
                IsExpirationDateRequired: false,
                PaymentMethodId: '13'
            }
        ];
        mockExternalGiftCardTypes = [
            {
                IsPinRequired: true,
                IsExpirationDateRequired: false,
                PaymentMethodId: '12'
            }
        ];
        mockGiftCard = {
            Id: 'abc',
            Balance: 100,
            BalanceCurrencyCode: 'USD',
            BalanceInCardCurrency: 100,
            CardCurrencyCode: 'USD'
        };
        mockGiftCardEmpty = {
            Id: 'empty',
            Balance: 0,
            BalanceCurrencyCode: 'USD',
            BalanceInCardCurrency: 0,
            CardCurrencyCode: 'USD'
        };
        mockActions = {};
        actionContext = buildHydratedMockActionContext();
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'internal'
                }
            }
        };
        mockConfig = {
            showAdditionalFields: "pinAndExpirationDate"
        };
        mockResources = {
            emptyInputError: 'Please enterd a gift card number',
            invalidCodeError: 'Invalid gift card code entered',
            invalidCardInfoError: 'Invalid gift card information entered',
            invalidCardTypeError: 'The gift card type is not suported',
            noCardPinError: 'Gift card PIN is required',
            noCardExpError: 'Gift card expiration date is required',
            noBalanceError: 'Gift card has no balance left',
            giftCardFormLabel: 'Gift card',
            giftCardNumberLabel: 'Gift card number',
            giftCardPinLabel: 'PIN',
            giftCardExpLabel: 'Expiration date',
            giftCardAlertLabel: 'You gift card may or may not include these fields',
            balanceCheckButton: 'Balance check',
            giftCardAvailableBalanceLabel: 'Available balance',
            giftCardPinPlaceholderText: 'PIN',
            giftCardExpPlaceholderText: 'MM/YYYY',
            enteredGiftCardLabel: 'Gift card ending in'
        };
        mockTenderTypes = [
            {
                OperationId: 214,
                ConnectorId: 'Adyen',
                TenderTypeId: '12'
            },
            {
                OperationId: 214,
                ConnectorId: '',
                TenderTypeId: '13'
            },
            {
                OperationId: 214,
                ConnectorId: '',
                TenderTypeId: '8'
            },
        ];
        StoreOperationsDataActions.resolveCardTypesAsync.mockImplementation((context, id) => {
            return Promise.resolve(mockInternalGiftCardTypes);
        });
        StoreOperationsDataActions.getGiftCardAsync.mockImplementation((context, id, typeId, pin, month, year) => {
            if (id === 'abc') {
                return Promise.resolve(mockGiftCard);
            }
            else if (id === 'empty') {
                return Promise.resolve(mockGiftCardEmpty);
            }
            return Promise.reject(new Error('Not found'));
        });
        StoreOperationsDataActions.getTenderTypesAsync.mockImplementation(async () => mockTenderTypes);
    });
    it('renders correctly for auth user when support internal gift card', () => {
        let moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = render(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(component).toMatchSnapshot();
        let wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper.find('.ms-gift-card-balance-check__input-pin-fields').exists()).toBe(false);
        expect(wrapper.find('.ms-gift-card-balance-check__input-exp-fields').exists()).toBe(false);
        mockConfig = {
            showAdditionalFields: "pin"
        };
        moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper.find('.ms-gift-card-balance-check__input-pin-fields').exists()).toBe(false);
        expect(wrapper.find('.ms-gift-card-balance-check__input-exp-fields').exists()).toBe(false);
    });
    it('renders correctly for auth user when support external gift card', () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'external'
                }
            }
        };
        let moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = render(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(component).toMatchSnapshot();
        let wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper.find('.ms-gift-card-balance-check__input-pin-fields').exists()).toBe(true);
        expect(wrapper.find('.ms-gift-card-balance-check__input-exp-fields').exists()).toBe(true);
        mockConfig = {
            showAdditionalFields: "pin"
        };
        moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper.find('.ms-gift-card-balance-check__input-pin-fields').exists()).toBe(true);
        expect(wrapper.find('.ms-gift-card-balance-check__input-exp-fields').exists()).toBe(false);
    });
    it('renders correctly for auth user when support both gift card', () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'both'
                }
            }
        };
        let moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = render(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(component).toMatchSnapshot();
        let wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper.find('.ms-gift-card-balance-check__input-pin-fields').exists()).toBe(true);
        expect(wrapper.find('.ms-gift-card-balance-check__input-exp-fields').exists()).toBe(true);
        mockConfig = {
            showAdditionalFields: "pin"
        };
        moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper.find('.ms-gift-card-balance-check__input-pin-fields').exists()).toBe(true);
        expect(wrapper.find('.ms-gift-card-balance-check__input-exp-fields').exists()).toBe(false);
    });
    it('renders correctly for guest when support internal gift card', () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: false,
                    token: ''
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'internal'
                }
            }
        };
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = render(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(component).toMatchSnapshot();
        const wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper).toEqual({});
    });
    it('renders correctly for guest when support external gift card', () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: false,
                    token: ''
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'external'
                }
            }
        };
        let moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = render(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(component).toMatchSnapshot();
        let wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper.find('.ms-gift-card-balance-check__input-pin-fields').exists()).toBe(true);
        expect(wrapper.find('.ms-gift-card-balance-check__input-exp-fields').exists()).toBe(true);
        mockConfig = {
            showAdditionalFields: "pin"
        };
        moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper.find('.ms-gift-card-balance-check__input-pin-fields').exists()).toBe(true);
        expect(wrapper.find('.ms-gift-card-balance-check__input-exp-fields').exists()).toBe(false);
    });
    it('renders correctly for guest when support both gift card', () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: false,
                    token: ''
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'both'
                }
            }
        };
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = render(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(component).toMatchSnapshot();
        const wrapper = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        expect(wrapper).toEqual({});
    });
    it('disables the apply button when input is empty', () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'both'
                }
            }
        };
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = mount(shallow(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps))).get(0));
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        expect(button.is('[disabled]')).toBe(true);
    });
    it('shows error when apply an invalid gift card number', async () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'both'
                }
            }
        };
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const giftCardNumber = 'xxx';
        const component = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        const input = component.find('input.ms-gift-card-balance-check__input-text');
        input.simulate('change', {
            target: {
                value: giftCardNumber
            }
        });
        expect(component.state('errorMessage')).toBe('');
        expect(component.state('giftCardNumber')).toBe(giftCardNumber);
        button.simulate('click');
        return Promise.resolve(component)
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => {
            expect(StoreOperationsDataActions.getTenderTypesAsync).toBeCalled();
            expect(component.state('errorMessage')).toBe(mockResources.invalidCardInfoError);
            component.unmount();
        });
    });
    it('shows error for empty input', async () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'both'
                }
            }
        };
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = shallow(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        const instance = component.instance();
        instance._applyGiftCard();
        expect(component.state('errorMessage')).toBe('Please enterd a gift card number');
    });
    it('handles empty gift card', async () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'both'
                }
            }
        };
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const component = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        const input = component.find('input.ms-gift-card-balance-check__input-text');
        input.simulate('change', {
            target: {
                value: 'empty'
            }
        });
        button.simulate('click');
        return Promise.resolve(component)
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => {
            expect(StoreOperationsDataActions.getTenderTypesAsync).toBeCalled();
            expect(component.state('errorMessage')).toBe('Gift card has no balance left');
            component.unmount();
        });
    });
    it('handle if resolveCardTypes return empty', async () => {
        StoreOperationsDataActions.resolveCardTypesAsync.mockImplementation((context, id) => {
            return Promise.resolve([]);
        });
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const giftCardNumber = 'abc';
        const component = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        const input = component.find('input.ms-gift-card-balance-check__input-text');
        input.simulate('change', {
            target: {
                value: giftCardNumber
            }
        });
        expect(component.state('errorMessage')).toBe('');
        expect(component.state('isFetchingGiftCard')).toBe(false);
        expect(component.state('giftCardNumber')).toBe(giftCardNumber);
        button.simulate('click');
        expect(component.state('errorMessage')).toBe('');
        return Promise.resolve(component)
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => {
            component.update();
            expect(StoreOperationsDataActions.getTenderTypesAsync).not.toBeCalled();
            expect(component.state('errorMessage')).toBe('Invalid gift card code entered');
        });
    });
    it('handle config support external when add an internal gift card', async () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'external'
                }
            }
        };
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const giftCardNumber = 'abc';
        const component = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        const input = component.find('input.ms-gift-card-balance-check__input-text');
        input.simulate('change', {
            target: {
                value: giftCardNumber
            }
        });
        expect(component.state('errorMessage')).toBe('');
        expect(component.state('isFetchingGiftCard')).toBe(false);
        expect(component.state('giftCardNumber')).toBe(giftCardNumber);
        button.simulate('click');
        expect(component.state('errorMessage')).toBe('');
        return Promise.resolve(component)
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => {
            component.update();
            expect(StoreOperationsDataActions.getTenderTypesAsync).toBeCalled();
            expect(component.state('errorMessage')).toBe('The gift card type is not suported');
        });
    });
    it('handle config support internal when add an external gift card', async () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'internal'
                }
            }
        };
        StoreOperationsDataActions.resolveCardTypesAsync.mockImplementation((context, id) => {
            return Promise.resolve(mockExternalGiftCardTypes);
        });
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const giftCardNumber = 'abc';
        const component = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        const input = component.find('input.ms-gift-card-balance-check__input-text');
        input.simulate('change', {
            target: {
                value: giftCardNumber
            }
        });
        expect(component.state('errorMessage')).toBe('');
        expect(component.state('isFetchingGiftCard')).toBe(false);
        expect(component.state('giftCardNumber')).toBe(giftCardNumber);
        button.simulate('click');
        expect(component.state('errorMessage')).toBe('');
        return Promise.resolve(component)
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => {
            component.update();
            expect(StoreOperationsDataActions.getTenderTypesAsync).toBeCalled();
            expect(component.state('errorMessage')).toBe('The gift card type is not suported');
        });
    });
    it('handle config support both when add an external gift card', async () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'both'
                }
            }
        };
        StoreOperationsDataActions.resolveCardTypesAsync.mockImplementation((context, id) => {
            return Promise.resolve(mockExternalGiftCardTypes);
        });
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const giftCardNumber = 'abc';
        const component = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        const input = component.find('input.ms-gift-card-balance-check__input-text');
        input.simulate('change', {
            target: {
                value: giftCardNumber
            }
        });
        expect(component.state('errorMessage')).toBe('');
        expect(component.state('isFetchingGiftCard')).toBe(false);
        expect(component.state('giftCardNumber')).toBe(giftCardNumber);
        button.simulate('click');
        expect(component.state('errorMessage')).toBe('');
        return Promise.resolve(component)
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => {
            component.update();
            expect(StoreOperationsDataActions.getTenderTypesAsync).toBeCalled();
            expect(component.state('errorMessage')).toBe('Gift card PIN is required');
        });
    });
    it('handle config support both when add an external gift card with pin and date', async () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: true,
                    token: 'xxx'
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'both'
                }
            }
        };
        StoreOperationsDataActions.resolveCardTypesAsync.mockImplementation((context, id) => {
            return Promise.resolve(mockExternalGiftCardTypes);
        });
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const giftCardNumber = 'abc';
        const component = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        const input = component.find('input.ms-gift-card-balance-check__input-text');
        const pinInput = component.find('input.ms-gift-card-balance-check__input-pin-text');
        const expInput = component.find('input.ms-gift-card-balance-check__input-exp-text');
        button.simulate('click');
        input.simulate('change', {
            target: {
                value: giftCardNumber
            }
        });
        pinInput.simulate('change', {
            target: {
                value: '1111'
            }
        });
        expInput.simulate('change', {
            target: {
                value: '10/20'
            }
        });
        expect(component.state('errorMessage')).toBe('');
        expect(component.state('isFetchingGiftCard')).toBe(false);
        expect(component.state('giftCardNumber')).toBe(giftCardNumber);
        expect(component.state('giftCardPin')).toBe('1111');
        expect(component.state('giftCardExp')).toBe('10/20');
        button.simulate('click');
        expect(component.state('errorMessage')).toBe('');
        return Promise.resolve(component)
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => {
            component.update();
            expect(StoreOperationsDataActions.getTenderTypesAsync).toBeCalled();
            expect(component.state('errorMessage')).toBe('');
        });
    });
    it('handle config support external when guest add an internal gift card', async () => {
        mockContext = {
            actionContext,
            request: {
                market: 'AB',
                user: {
                    isAuthenticated: false,
                    token: ''
                }
            },
            cultureFormatter: {
                formatCurrency: jest.fn(price => `$${price}`)
            },
            app: {
                config: {
                    giftCardSupported: 'external'
                }
            }
        };
        StoreOperationsDataActions.resolveCardTypesAsync.mockImplementation((context, id) => {
            return Promise.resolve(mockInternalGiftCardTypes);
        });
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig, mockContext),
            resources: mockResources,
            renderView: View
        };
        const giftCardNumber = 'abc';
        const component = mount(React.createElement(GiftCardBalanceCheck, Object.assign({}, moduleProps)));
        debugger;
        const button = component.find('button.ms-gift-card-balance-check__btn-apply');
        const input = component.find('input.ms-gift-card-balance-check__input-text');
        input.simulate('change', {
            target: {
                value: giftCardNumber
            }
        });
        expect(component.state('errorMessage')).toBe('');
        expect(component.state('isFetchingGiftCard')).toBe(false);
        expect(component.state('giftCardNumber')).toBe(giftCardNumber);
        button.simulate('click');
        expect(component.state('errorMessage')).toBe('');
        return Promise.resolve(component)
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => Promise.resolve(component))
            .then(() => {
            component.update();
            expect(StoreOperationsDataActions.getTenderTypesAsync).toBeCalled();
            expect(component.state('errorMessage')).toBe('The gift card type is not suported');
        });
    });
    afterEach(() => {
        StoreOperationsDataActions.getGiftCardAsync.mockReset();
        StoreOperationsDataActions.getTenderTypesAsync.mockReset();
        StoreOperationsDataActions.resolveCardTypesAsync.mockReset();
    });
    afterAll(() => {
        jest.unmock('@msdyn365-commerce/retail-proxy/dist/DataActions/StoreOperationsDataActions.g');
    });
});
//# sourceMappingURL=gift-card-balance-check.test.js.map