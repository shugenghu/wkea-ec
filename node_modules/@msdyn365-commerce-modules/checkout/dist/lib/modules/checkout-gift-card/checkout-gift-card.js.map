{"version":3,"file":"checkout-gift-card.js","sourceRoot":"./src/","sources":["modules/checkout-gift-card/checkout-gift-card.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IModuleStateProps, withModuleState } from '@msdyn365-commerce-modules/checkout-utilities';\nimport { IModuleProps } from '@msdyn365-commerce-modules/utilities';\nimport {\n    getGiftCardAsync, getTenderTypesAsync, resolveCardTypesAsync\n} from '@msdyn365-commerce/retail-proxy/dist/DataActions/StoreOperationsDataActions.g';\nimport {\n    CardType, CardTypeInfo, GiftCard, RetailOperation, TenderType\n} from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport classname from 'classnames';\nimport { computed, when } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport { OPERATIONS } from '../checkout';\nimport { ICheckoutGiftCardData } from './checkout-gift-card.data';\nimport { ICheckoutGiftCardProps } from './checkout-gift-card.props.autogenerated';\nimport { getForm, IForm } from './components/get-form';\nimport { getList, IList } from './components/get-list';\nimport TitleCompoent from './components/title';\n\nexport * from './components/get-form';\nexport * from './components/get-item';\nexport * from './components/get-list';\n\ninterface ICheckoutGiftCardState {\n    isFetchingGiftCard: boolean;\n    errorMessage: string;\n    giftCardNumber: string;\n    giftCardPin: string;\n    giftCardExp: string;\n}\n\nconst enum SupportedGiftCardType {\n    Internal = 'internal',\n    External = 'external',\n    Both = 'both'\n}\n\nexport interface ICheckoutGiftCardModuleProps extends ICheckoutGiftCardProps<ICheckoutGiftCardData>, IModuleStateProps { }\n\nexport interface IShowResource {\n    title: React.ReactNode;\n    list?: IList;\n}\n\nexport interface IAddResource {\n    form: IForm;\n    list?: IList;\n}\n\nexport interface ICheckoutGiftCardViewProps extends ICheckoutGiftCardProps<{}>, ICheckoutGiftCardState {\n    className?: string;\n\n    showGiftCard?: IShowResource;\n    addGiftCard?: IAddResource;\n\n    checkoutGiftCardProps: IModuleProps;\n    couldPaidByGiftCard?: boolean;\n    isEnabled?: boolean;\n    onEdit?(): void;\n    onCancel?(): void;\n    onSubmit?(): void;\n    enterGiftCardNumber?(giftCardNumber: string): void;\n    enterGiftCardPin?(giftCardNumber: string): void;\n    enterGiftCardExp?(giftCardNumber: string): void;\n    removeGiftCard?(giftCardNumber: string): void;\n    applyGiftCard?(): void;\n}\n\n/**\n *\n * CheckoutGiftCard component\n * @extends {React.Component<ICheckoutGiftCardProps<ICheckoutGiftCardData>, ICheckoutGiftCardState>}\n */\n@observer\nexport class CheckoutGiftCard extends React.Component<ICheckoutGiftCardModuleProps, ICheckoutGiftCardState> {\n    public state: ICheckoutGiftCardState = {\n        isFetchingGiftCard: false,\n        errorMessage: '',\n        giftCardNumber: '',\n        giftCardPin: '',\n        giftCardExp: ''\n    };\n\n    private inputRef: React.RefObject<HTMLInputElement> = React.createRef();\n\n    private inputPinRef: React.RefObject<HTMLInputElement> = React.createRef();\n\n    private inputExpRef: React.RefObject<HTMLInputElement> = React.createRef();\n\n    @computed get isDataReady(): boolean {\n        return (this.props.data.checkout.result && this.props.data.checkout.status) === 'SUCCESS';\n    }\n\n    @computed get getLoyaltyAmount(): number {\n        const checkoutState = this.props.data.checkout.result;\n        if (!checkoutState || !checkoutState.loyaltyAmount) {\n            return 0;\n        }\n        return checkoutState.loyaltyAmount;\n    }\n\n    @computed get shouldPayGiftCard(): boolean {\n        const cart = this.props.data.checkout.result ? this.props.data.checkout.result.checkoutCart.cart : undefined;\n        if (!cart) {\n            return false;\n        }\n        // Use gift card card when loyalty points do not cover the total amount\n        const amountDue = (cart.TotalAmount || 0) - this.getLoyaltyAmount;\n        return amountDue > 0;\n    }\n\n    @computed get hasSelectedItem(): boolean {\n        const {\n            data: { checkout }\n        } = this.props;\n        const giftCards = checkout.result && checkout.result.giftCardExtends;\n        return !!giftCards && giftCards.length > 0;\n    }\n\n    @computed get isPaymentVerificationRedirection(): boolean {\n        const { requestFormData, query } = this.props.context.request;\n        return (requestFormData && query && query.pv === '1') ? true : false;\n    }\n\n    public componentDidMount(): void {\n        // @ts-ignore: Compiler not reconizing condition check for function params\n        when(\n            () => this.isDataReady,\n            () => {\n                this.init();\n            }\n        );\n    }\n\n    public render(): JSX.Element | null {\n        const {\n            moduleState: { isReady },\n            data: { checkout },\n            config: { className, showAdditionalFields },\n            resources\n        } = this.props;\n        const { errorMessage, giftCardNumber, giftCardPin, giftCardExp } = this.state;\n        const giftCards = checkout.result && checkout.result.giftCardExtends;\n        const additionalFields = showAdditionalFields;\n        const supportedGiftCardType = this.props.context.app.config.giftCardSupported;\n\n        if (!this.isEnabled() || (!this.shouldPayGiftCard && !isReady)) {\n            this.props.context.telemetry.error('Checkout giftcard content is empty, module wont render');\n            return null;\n        }\n\n        const supportExternalGiftCard = supportedGiftCardType === SupportedGiftCardType.Internal ? false : true;\n\n        const moduleClassName = classname('ms-checkout-gift-card', className, isReady ? 'show' : 'add');\n\n        const viewProps: ICheckoutGiftCardViewProps = {\n            ...this.props,\n            ...this.state,\n            className: moduleClassName,\n\n            checkoutGiftCardProps: { moduleProps: this.props, className: moduleClassName },\n            couldPaidByGiftCard: this.couldPaidByGiftCard(),\n            isEnabled: this.isEnabled(),\n            onEdit: this.onEdit,\n            onCancel: this.onCancel,\n            onSubmit: this.onSubmit,\n            enterGiftCardNumber: this.enterGiftCardNumber,\n            enterGiftCardPin: this.enterGiftCardPin,\n            enterGiftCardExp: this.enterGiftCardExp,\n            removeGiftCard: this.removeGiftCard,\n            applyGiftCard: this.applyGiftCard,\n            showGiftCard: isReady\n                ? {\n                    title: <TitleCompoent title={resources.giftCardFormLabel} />,\n                    list: getList({\n                        canRemove: false,\n                        getFormattedPrice: this.getFormattedPrice,\n                        giftCards: giftCards && [...giftCards], // Note: ReadOnly Checkout State GiftCard[] is not assignable to GiftCard[] type\n                        onRemoveGiftCard: this.removeGiftCard,\n                        resources\n                    })\n                }\n                : undefined,\n            addGiftCard: !isReady\n                ? {\n                    form: getForm({\n                        errorMessage,\n                        giftCardNumber,\n                        giftCardPin,\n                        giftCardExp,\n                        inputRef: this.inputRef,\n                        inputPinRef: this.inputPinRef,\n                        inputExpRef: this.inputExpRef,\n                        resources,\n                        onEnterGiftCardNumber: this.enterGiftCardNumber,\n                        onEnterGiftCardPin: this.enterGiftCardPin,\n                        onEnterGiftCardExp: this.enterGiftCardExp,\n                        onApplyGiftCard: this.applyGiftCard,\n                        supportExternalGiftCard,\n                        additionalFields\n                    }),\n                    list: getList({\n                        canRemove: true,\n                        getFormattedPrice: this.getFormattedPrice,\n                        giftCards: giftCards && [...giftCards], // Note: ReadOnly Checkout State GiftCard[] is not assignable to GiftCard[] type\n                        onRemoveGiftCard: this.removeGiftCard,\n                        resources\n                    })\n                }\n                : undefined\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private init = (): void => {\n        this.props.moduleState.init({\n            onEdit: this.onEdit,\n            onCancel: this.onCancel,\n            onSubmit: this.onSubmit,\n            isRequired: false,\n            ...(!this.isEnabled() && { status: 'disabled' })\n        });\n\n        const giftCards = this.props.data.checkout.result?.giftCardExtends;\n        if (giftCards && giftCards.length > 0) {\n            this.props.moduleState.onReady();\n        } else if (this.isPaymentVerificationRedirection) {\n            this.props.moduleState.onSkip();\n        }\n\n    };\n\n    private couldPaidByGiftCard = (): boolean => {\n        const cart = this.props.data.checkout.result ? this.props.data.checkout.result.checkoutCart.cart : undefined;\n        if (!cart) {\n            return false;\n        }\n        // Use gift card when it is not free\n        return (cart.TotalAmount || 0) > 0;\n    };\n\n    private isEnabled = (): boolean => {\n        if (!this.props.context.request.user.isAuthenticated && this.props.context.app.config.giftCardSupported !== 'external') {\n            return false;\n        }\n        return this.couldPaidByGiftCard();\n    };\n\n    private onEdit = (): void => {\n        // Show add gift card form\n        this.props.moduleState.onUpdating();\n    };\n\n    private onCancel = (): void => {\n        this.handleCancelOrSubmit();\n    };\n\n    private onSubmit = (): void => {\n        this.handleCancelOrSubmit();\n    };\n\n    private handleCancelOrSubmit = () => {\n        if (this.hasSelectedItem) {\n            // Show summary screen\n            this.props.moduleState.onReady();\n        } else {\n            // Skip the module\n            this.props.moduleState.onSkip();\n        }\n    };\n\n    private getFormattedPrice = (price: number = 0, currencyCode: string = 'USD'): string => {\n        return this.props.context.cultureFormatter.formatCurrency(price, currencyCode);\n    };\n\n    private enterGiftCardNumber = (giftCardNumber: string): void => {\n        this.setState({\n            giftCardNumber\n        });\n        this.clearError();\n    };\n\n    private enterGiftCardPin = (giftCardPin: string): void => {\n        this.setState({\n            giftCardPin\n        });\n        this.clearError();\n    };\n\n    private enterGiftCardExp = (giftCardExp: string): void => {\n        this.setState({\n            giftCardExp\n        });\n        this.clearError();\n    };\n\n    private setError = (errorMessage: string): void => {\n        this.props.telemetry.error('Error', errorMessage);\n        this.props.telemetry.debug('Error', errorMessage);\n        this.props.moduleState.setHasError(true);\n        this.setState({\n            errorMessage\n        });\n    };\n\n    private clearError = (): void => {\n        this.props.moduleState.setHasError(false);\n        this.setState({\n            errorMessage: ''\n        });\n    };\n\n    private removeGiftCard = async (giftCardNumber: string): Promise<void> => {\n        const checkoutState = this.props.data.checkout.result;\n        if (!checkoutState) {\n            return;\n        }\n\n        await checkoutState.removeGiftCard({ giftCardNumber });\n    };\n\n    private applyGiftCard = async (): Promise<void> => {\n        if (this.state.isFetchingGiftCard) {\n            return;\n        }\n        this.setState({\n            isFetchingGiftCard: true\n        });\n\n        const checkoutState = this.props.data.checkout.result;\n        const giftCardNumber = this.state.giftCardNumber.trim();\n        const giftCardPin = this.state.giftCardPin.trim();\n        const giftCardExp = this.state.giftCardExp.trim();\n\n        const giftCardTypes = await this.getGiftCardTypes(giftCardNumber);\n        const giftCardType = giftCardTypes && giftCardTypes[0];\n        const isPinRequired = giftCardType && giftCardType.IsPinRequired;\n        const isExpRequired = giftCardType && giftCardType.IsExpirationDateRequired;\n        const tenderTypeId = giftCardType && giftCardType.PaymentMethodId;\n        const giftCard = await this.getGiftCard(giftCardNumber, giftCardPin, giftCardExp, isPinRequired, isExpRequired, tenderTypeId);\n\n        if (checkoutState && giftCard) {\n            await checkoutState.addGiftCard({ giftCard: giftCard, additionalProperties: { Pin: giftCardPin, ExpirationDate: giftCardExp, TenderTypeId: tenderTypeId } });\n            this.clearError();\n            this.setState({\n                giftCardNumber: '',\n                giftCardPin: '',\n                giftCardExp: '',\n                isFetchingGiftCard: false\n            });\n            return Promise.resolve();\n        } else {\n            const input =\n                this.inputRef && this.inputRef.current && this.inputRef.current.focus && (this.inputRef.current as HTMLElement);\n            input && input.focus();\n            this.setState({\n                isFetchingGiftCard: false\n            });\n        }\n    };\n\n    private findGiftcardTenderTypes = (tenderTypes: TenderType[], operationId: RetailOperation, giftcardType: string): string[] | undefined => {\n        let matchedTenderTypes: TenderType[] | undefined;\n\n        switch (giftcardType) {\n            case SupportedGiftCardType.Internal:\n                matchedTenderTypes = tenderTypes.filter(tenderType => (tenderType.OperationId === operationId && tenderType.ConnectorId === ''));\n                break;\n            case SupportedGiftCardType.External:\n                matchedTenderTypes = tenderTypes.filter(tenderType => (tenderType.OperationId === operationId && tenderType.ConnectorId !== ''));\n                break;\n            default:\n                throw new Error('Invalid gift card type');\n        }\n\n        if (matchedTenderTypes) {\n            return matchedTenderTypes.map(tenderType => tenderType.TenderTypeId || '');\n        }\n        return;\n    };\n\n    private getGiftCard = async (giftCardNumber: string, giftCardPin: string, giftCardExp: string, isPinRequired: boolean | undefined, isExpRequired: boolean | undefined, tenderTypeId: string | undefined): Promise<GiftCard | undefined> => {\n        const {\n            resources: { noBalanceError, invalidCardInfoError, invalidCardTypeError, noCardPinError, noCardExpError }\n        } = this.props;\n\n        const supportedGiftCardType = this.props.context.app.config.giftCardSupported;\n\n        if (!tenderTypeId) {\n            return undefined;\n        }\n\n        const tenderTypes = await getTenderTypesAsync({ callerContext: this.props.context.actionContext, queryResultSettings: {} }).catch(error => {\n            throw error;\n        });\n\n        if (!tenderTypes) {\n            throw new Error('Fail to get gift card tender line');\n        }\n        const internalGiftcardTenderTypes = this.findGiftcardTenderTypes(tenderTypes, OPERATIONS.PayGiftCertificate, SupportedGiftCardType.Internal);\n        const externalGiftcardTenderTypes = this.findGiftcardTenderTypes(tenderTypes, OPERATIONS.PayGiftCertificate, SupportedGiftCardType.External);\n\n        switch (supportedGiftCardType) {\n            case undefined:\n            case SupportedGiftCardType.Internal:\n                if (!internalGiftcardTenderTypes?.includes(tenderTypeId)) {\n                    this.setError(invalidCardTypeError);\n                    return undefined;\n                }\n                break;\n            case SupportedGiftCardType.External:\n                if (!externalGiftcardTenderTypes?.includes(tenderTypeId)) {\n                    this.setError(invalidCardTypeError);\n                    return undefined;\n                }\n                break;\n            case SupportedGiftCardType.Both:\n                if (!internalGiftcardTenderTypes?.includes(tenderTypeId) && !externalGiftcardTenderTypes?.includes(tenderTypeId)) {\n                    this.setError(invalidCardTypeError);\n                    return undefined;\n                }\n                break;\n            default:\n                throw new Error('Unsupported gift card type');\n        }\n\n        if (isPinRequired && giftCardPin === '') {\n            this.setError(noCardPinError);\n            return undefined;\n        }\n\n        if (isExpRequired && giftCardExp === '') {\n            this.setError(noCardExpError);\n            return undefined;\n        }\n\n        const month = parseInt(giftCardExp.split('/')[0], 10);\n        const year = parseInt(giftCardExp.split('/')[1], 10);\n\n        return getGiftCardAsync({ callerContext: this.props.context.actionContext }, giftCardNumber, tenderTypeId, giftCardPin, month, year)\n            .then(activeGiftCard => {\n                if (!activeGiftCard.Balance || activeGiftCard.Balance === 0) {\n                    this.setError(noBalanceError);\n                    return;\n                }\n                return activeGiftCard;\n            })\n            .catch(error => {\n                this.setError(invalidCardInfoError);\n                return undefined;\n            });\n    };\n\n    private getGiftCardTypes = async (giftCardNumber: string): Promise<CardTypeInfo[] | undefined> => {\n        const {\n            resources: { emptyInputError, duplicatedCodeError, invalidCodeError },\n            data: { checkout }\n        } = this.props;\n\n        if (!giftCardNumber) {\n            this.setError(emptyInputError);\n            return undefined;\n        }\n\n        const isDuplicated = checkout.result && checkout.result.giftCardExtends.some((card: GiftCard) => card.Id === giftCardNumber);\n        if (isDuplicated) {\n            this.setError(duplicatedCodeError);\n            return undefined;\n        }\n\n        const GIFTCARDTYPE =  7 as CardType.GiftCard; // This is a workaround. ts-jest doesn't support 'const enum'\n\n        return resolveCardTypesAsync({ callerContext: this.props.context.actionContext }, giftCardNumber, GIFTCARDTYPE)\n            .then(giftCardTypes => {\n                if (!giftCardTypes || giftCardTypes.length === 0 || giftCardTypes[0] === undefined) {\n                    this.setError(invalidCodeError);\n                    return;\n                }\n                return giftCardTypes;\n            })\n            .catch(error => {\n                this.setError(invalidCodeError);\n                return undefined;\n            });\n    };\n}\n\nexport default withModuleState(CheckoutGiftCard);"]}