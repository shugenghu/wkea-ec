{"version":3,"file":"checkout-loyalty.js","sourceRoot":"./src/","sources":["modules/checkout-loyalty/checkout-loyalty.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classnames from 'classnames';\nimport { computed, reaction, when } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport { IModuleStateProps, withModuleState } from '@msdyn365-commerce-modules/checkout-utilities';\nimport { GetLoyaltyTransactionEstimationInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { Button, Drawer, Heading, IModuleProps, INodeProps } from '@msdyn365-commerce-modules/utilities';\nimport { PriceComponent } from '@msdyn365-commerce/components';\nimport { callActionOrExecute } from '@msdyn365-commerce/retail-proxy';\nimport { createGetMaxLoyaltyPointsToRedeemForTransactionBalanceInput } from '@msdyn365-commerce/retail-proxy/dist/DataActions/CartsDataActions.g';\nimport { LoyaltyPointRedemptionEstimate, LoyaltyRewardPoint } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\n\nimport { ICheckoutLoyaltyData } from './checkout-loyalty.data';\nimport { ICheckoutLoyaltyProps } from './checkout-loyalty.props.autogenerated';\nimport InputComponent from './components/checkout-loyalty-input';\nimport LabelComponent from './components/checkout-loyalty-label';\nimport TextComponent from './components/checkout-loyalty-text';\n\nexport interface ICheckoutLoyaltyState {\n    dollarsApplied: number;\n    isFetchingLoyaltyCard: boolean;\n}\n\nexport interface ICheckoutLoyaltyModuleProps extends ICheckoutLoyaltyProps<ICheckoutLoyaltyData>, IModuleStateProps {}\n\nexport interface ICheckoutLoyaltyViewState {\n    isShowLoyalty: boolean;\n    isShowAddLoyalty: boolean;\n}\n\nexport interface ICheckoutLoyaltyShow {\n    heading: React.ReactNode;\n    coveredAmountText: React.ReactNode;\n    amount: React.ReactNode;\n}\n\nexport interface ICheckoutLoyaltyRewardPoint {\n    checkoutLoyaltyRewardPoint: INodeProps;\n    key: string;\n    title: React.ReactNode;\n    availablePointsText: React.ReactNode;\n    activePoints: React.ReactNode;\n    expiringPointsText: React.ReactNode;\n    expiringPoints: React.ReactNode;\n}\n\nexport interface ICheckoutLoyaltyAdd {\n    heading: React.ReactNode;\n    cardNumber: React.ReactNode;\n    drawer: INodeProps;\n    rewardPoints: ICheckoutLoyaltyRewardPoint[];\n    loyaltyAmountContainer: INodeProps;\n    appliedLoyaltyAmountContainer: INodeProps;\n    loyaltyAmountLabel: React.ReactNode;\n    loyaltyAmountInput: React.ReactNode;\n    loyaltyAmountApplyButton: React.ReactNode;\n    showAppliedAmount: boolean;\n    loyaltyAmountAppliedText: React.ReactNode;\n    loyaltyAmountAppliedPrice: React.ReactNode;\n    loyaltyAmountRemoveButton: React.ReactNode;\n}\n\nexport interface ICheckoutLoyaltyViewProps extends ICheckoutLoyaltyModuleProps {\n    checkoutLoyalty: IModuleProps;\n    viewState: ICheckoutLoyaltyViewState;\n    showLoyalty: ICheckoutLoyaltyShow;\n    addLoyalty: ICheckoutLoyaltyAdd;\n}\n\n/**\n *\n * CheckoutLoyalty component\n * @extends {React.Component<ICheckoutLoyaltyProps<ICheckoutLoyaltyData>>}\n */\n// @ts-ignore\n@withModuleState\n@observer\nclass CheckoutLoyalty extends React.Component<ICheckoutLoyaltyModuleProps, ICheckoutLoyaltyState> {\n    private _dialogToggleRef: React.RefObject<HTMLButtonElement> | undefined;\n    private moduleClassName: string = 'ms-checkout-loyalty';\n\n    constructor(props: ICheckoutLoyaltyModuleProps) {\n        super(props);\n        this._dialogToggleRef = React.createRef();\n        this._applyLoyaltyPoints = this._applyLoyaltyPoints.bind(this);\n        this._removeLoyaltyPoints = this._removeLoyaltyPoints.bind(this);\n        this._onInputChange = this._onInputChange.bind(this);\n        this._onBlur = this._onBlur.bind(this);\n        this.state = { dollarsApplied: this.maxDollars, isFetchingLoyaltyCard: false };\n    }\n\n    @computed get shouldPayLoyalty(): boolean {\n        const cart = this.props.data.checkout.result ? this.props.data.checkout.result.checkoutCart.cart : undefined;\n        if (!cart) {\n            return false;\n        }\n        // Use loyalty when cart is not full of free items\n        const amountDue = cart.TotalAmount || 0;\n        return amountDue > 0;\n    }\n\n    @computed get isDataReady(): boolean {\n        return (\n            (this.props.data.checkout.result && this.props.data.checkout.status) === 'SUCCESS' &&\n            (this.props.data.loyaltyCard && this.props.data.loyaltyCard.status) !== 'LOADING' &&\n            (this.props.data.loyaltyTransactionEstimation && this.props.data.loyaltyTransactionEstimation.status) !== 'LOADING'\n        );\n    }\n\n    @computed get maxDollars(): number {\n        return this.props.data.loyaltyTransactionEstimation.result &&\n            this.props.data.loyaltyTransactionEstimation.result.MaxCurrencyValueOfLoyaltyPoints\n            ? this.props.data.loyaltyTransactionEstimation.result.MaxCurrencyValueOfLoyaltyPoints\n            : 0;\n    }\n\n    @computed get isPaymentVerificationRedirection(): boolean {\n        const { requestFormData, query } = this.props.context.request;\n        return requestFormData && query && query.pv === '1' ? true : false;\n    }\n\n    public async componentDidMount(): Promise<void> {\n        when(\n            () => this.isDataReady,\n            async () => {\n                await this.init();\n            }\n        );\n\n        reaction(\n            () => this.props.data.checkout.result && this.props.data.checkout.result.checkoutCart.cart,\n            async () => {\n                this._updateEstimate();\n            }\n        );\n\n        reaction(\n            () => this.props.data.loyaltyCard.result,\n            async () => {\n                this._updateLoyalty();\n            }\n        );\n    }\n\n    // tslint:disable-next-line:max-func-body-length\n    public render(): JSX.Element | null {\n        const {\n            resources,\n            renderView,\n            moduleState: { isReady }\n        } = this.props;\n\n        if (\n            this.props.data.loyaltyCard &&\n            this.props.data.loyaltyCard.result &&\n            this.props.data.loyaltyCard.result.CardNumber &&\n            this.shouldPayLoyalty\n        ) {\n            const loyaltyCard = this.props.data.loyaltyCard.result;\n            const checkoutState = this.props.data.checkout.result;\n            let isShowLoyalty = false;\n\n            if (isReady) {\n                if (!checkoutState || checkoutState.loyaltyAmount === 0) {\n                    return null;\n                } else {\n                    isShowLoyalty = true;\n                }\n            }\n\n            const viewProps = {\n                ...this.props,\n                viewState: {\n                    isShowLoyalty: isShowLoyalty,\n                    isShowAddLoyalty: !isReady\n                },\n                checkoutLoyalty: {\n                    moduleProps: this.props,\n                    className: classnames(\n                        this.moduleClassName,\n                        { [`${this.moduleClassName}__applied`]: isShowLoyalty },\n                        this.props.config.className\n                    )\n                },\n                showLoyalty: {\n                    heading: <Heading headingTag='h3' className={`${this.moduleClassName}__heading`} text={resources.loyaltyHeadingText} />,\n                    coveredAmountText: (\n                        <TextComponent className={`${this.moduleClassName}__text`} text={resources.loyaltyCoveredAmountText} />\n                    ),\n                    amount: (\n                        <PriceComponent\n                            className={`${this.moduleClassName}__applied-value`}\n                            id={this.props.id}\n                            typeName={this.props.typeName}\n                            context={this.props.context}\n                            data={{ price: { CustomerContextualPrice: checkoutState && checkoutState.loyaltyAmount } }}\n                        />\n                    )\n                },\n                addLoyalty: {\n                    heading: <Heading headingTag='h3' className={`${this.moduleClassName}__heading`} text={resources.loyaltyHeadingText} />,\n                    drawer: {\n                        tag: Drawer,\n                        className: `${this.moduleClassName}__drawer`,\n                        toggleButtonText: this._drawerHeader(),\n                        openGlyph: `${this.moduleClassName}__drawer-open`,\n                        closeGlyph: `${this.moduleClassName}__drawer-close`,\n                        glyphPlacement: 'end'\n                    },\n                    cardNumber: <TextComponent className={`${this.moduleClassName}__card-number`} text={loyaltyCard.CardNumber || ''} />,\n                    rewardPoints:\n                        loyaltyCard.RewardPoints &&\n                        loyaltyCard.RewardPoints.map((points, index) => {\n                            return this._renderPointSection(points, resources.availablePointsLabel, resources.expiringLoyaltyPointsLabel);\n                        }),\n                    loyaltyAmountContainer: {\n                        className: `${this.moduleClassName}__amount`\n                    },\n                    appliedLoyaltyAmountContainer: {\n                        className: `${this.moduleClassName}__applied-amount`\n                    },\n                    loyaltyAmountLabel: (\n                        <LabelComponent\n                            className={`${this.moduleClassName}__amount-label`}\n                            text={resources.payWithLoyaltyAmountLabel}\n                            htmlFor={`${this.props.id}-label`}\n                        />\n                    ),\n                    loyaltyAmountInput: (\n                        <InputComponent\n                            className={`${this.moduleClassName}__amount-input`}\n                            onChange={this._onInputChange}\n                            onBlur={this._onBlur}\n                            type='number'\n                            step='.01'\n                            value={this.state.dollarsApplied}\n                            min={0}\n                            max={this.maxDollars}\n                            ariaValueMax={this.maxDollars}\n                            ariaValueMin={0}\n                            ariaValueNow={this.state.dollarsApplied}\n                            id={`${this.props.id}-label`}\n                        />\n                    ),\n                    loyaltyAmountApplyButton: (\n                        <Button\n                            className={`${this.moduleClassName}__amount-button`}\n                            title={this.props.resources.applyCheckoutLoyaltyPaymentText}\n                            onClick={this._applyLoyaltyPoints}\n                            disabled={\n                                this.state.dollarsApplied > this.maxDollars ||\n                                this.state.dollarsApplied <= 0 ||\n                                this.state.isFetchingLoyaltyCard\n                            }\n                        >\n                            {this.props.resources.applyCheckoutLoyaltyPaymentText}\n                        </Button>\n                    ),\n                    showAppliedAmount: checkoutState && checkoutState.loyaltyAmount > 0,\n                    loyaltyAmountAppliedText: (\n                        <TextComponent className={`${this.moduleClassName}__applied-text`} text={resources.loyaltyCoveredAmountText} />\n                    ),\n                    loyaltyAmountAppliedPrice: (\n                        <PriceComponent\n                            className={`${this.moduleClassName}__applied-value`}\n                            id={this.props.id}\n                            typeName={this.props.typeName}\n                            context={this.props.context}\n                            data={{ price: { CustomerContextualPrice: checkoutState && checkoutState.loyaltyAmount } }}\n                        />\n                    ),\n                    loyaltyAmountRemoveButton: (\n                        <Button\n                            className='ms-checkout-loyalty-remove-btn'\n                            title={this.props.resources.removeCheckoutLoyaltyPaymentText}\n                            onClick={this._removeLoyaltyPoints}\n                            innerRef={this._dialogToggleRef}\n                        >\n                            {this.props.resources.removeCheckoutLoyaltyPaymentText}\n                        </Button>\n                    )\n                }\n            };\n\n            return renderView(viewProps) as React.ReactElement;\n        }\n        this.props.context.telemetry.error('Checkout loyalty content is empty, module wont render');\n        return null;\n    }\n\n    private _drawerHeader(): JSX.Element {\n        return (\n            <React.Fragment>\n                <p className={`${this.moduleClassName}__covered-text`}>{this.props.resources.loyaltyCoveredAmountText}</p>\n                <PriceComponent\n                    className={`${this.moduleClassName}__applied-value`}\n                    id={this.props.id}\n                    typeName={this.props.typeName}\n                    context={this.props.context}\n                    data={{ price: { CustomerContextualPrice: this.maxDollars } }}\n                />\n            </React.Fragment>\n        );\n    }\n\n    private _renderPointSection(\n        point: LoyaltyRewardPoint,\n        loyaltyCoveredAmountText: string,\n        expiringLoyaltyPointsLabel: string\n    ): ICheckoutLoyaltyRewardPoint {\n        return {\n            key: point.RewardPointId || '',\n            checkoutLoyaltyRewardPoint: {\n                className: `${this.moduleClassName}__program`\n            },\n            title: <TextComponent className={`${this.moduleClassName}__program-title`} text={point.Description} />,\n            availablePointsText: <TextComponent className={`${this.moduleClassName}__program-available`} text={loyaltyCoveredAmountText} />,\n            activePoints: (\n                <TextComponent className={`${this.moduleClassName}__program-points`} text={(point && point.ActivePoints!).toString()} />\n            ),\n            expiringPointsText: <TextComponent className={`${this.moduleClassName}__program-expiring`} text={expiringLoyaltyPointsLabel} />,\n            expiringPoints: (\n                <TextComponent\n                    className={`${this.moduleClassName}__program-points`}\n                    text={(point && point.PointsExpiringSoon!).toString()}\n                />\n            )\n        };\n    }\n\n    private init = async (): Promise<void> => {\n        this.props.moduleState.init({\n            onEdit: this.onEdit,\n            onCancel: this.onCancel,\n            onSubmit: this.onSubmit,\n            isRequired: false,\n            ...(!this.isEnabled() && { status: 'disabled' })\n        });\n\n        const savedLoyaltyAmount = this.props.data.checkout.result?.loyaltyAmount;\n        if (savedLoyaltyAmount) {\n            this.props.moduleState.onReady();\n        } else if (this.isPaymentVerificationRedirection) {\n            this.props.moduleState.onSkip();\n        } else if (\n            this.props.data.loyaltyCard.result &&\n            this.props.data.checkout.result &&\n            this.props.data.loyaltyCard.result.CardNumber !== this.props.data.checkout.result.checkoutCart.cart.LoyaltyCardId\n        ) {\n            this.props.data.checkout.result.checkoutCart\n                .updateLoyaltyCardId({ loyaltyCardNumber: this.props.data.loyaltyCard.result.CardNumber })\n                .catch(error => {\n                    if (this.context.telemetry) {\n                        this.context.telemetry.warning(error);\n                        this.context.telemetry.debug('Unable to update the loyalty card');\n                    }\n                });\n        }\n    };\n\n    private onEdit = () => {\n        this.props.moduleState.onUpdating();\n    };\n\n    private onCancel = () => {\n        this.handleCancelOrSubmit();\n    };\n\n    private onSubmit = () => {\n        this.handleCancelOrSubmit();\n    };\n\n    private handleCancelOrSubmit = () => {\n        const checkoutState = this.props.data.checkout.result;\n        if (checkoutState && checkoutState.loyaltyAmount > 0) {\n            // Show summary screen\n            this.props.moduleState.onReady();\n        } else {\n            // Skip the module\n            this.props.moduleState.onSkip();\n        }\n    };\n\n    private isEnabled = () => {\n        return (\n            this.props.context.request.user.isAuthenticated &&\n            this.props.data.loyaltyCard.result &&\n            this.props.data.loyaltyCard.result.CardNumber &&\n            this.shouldPayLoyalty\n        );\n    };\n\n    private async _applyLoyaltyPoints(): Promise<void> {\n        const checkoutState = this.props.data.checkout.result;\n\n        if (!checkoutState) {\n            return;\n        }\n\n        await checkoutState.updateLoyaltyAmount({ newAmount: parseFloat(this.state.dollarsApplied.toString()) });\n        this.setState({\n            isFetchingLoyaltyCard: true\n        });\n    }\n\n    private async _removeLoyaltyPoints(): Promise<void> {\n        const checkoutState = this.props.data.checkout.result;\n\n        if (!checkoutState) {\n            return;\n        }\n\n        await checkoutState.updateLoyaltyAmount({ newAmount: 0 });\n        this.setState({\n            dollarsApplied: 0\n        });\n    }\n\n    private _onInputChange(event: React.ChangeEvent<HTMLInputElement>): void {\n        const value = event.currentTarget.value;\n        this.setState({ dollarsApplied: value.length ? Number(value) : parseFloat(value), isFetchingLoyaltyCard: false });\n    }\n\n    private _onBlur(event: React.FocusEvent<HTMLInputElement>): void {\n        const num = parseFloat(event.currentTarget.value).toFixed(2);\n        const element = document.getElementById(`${this.props.id}-label`) as HTMLInputElement;\n        if (element && num) {\n            element.value = num;\n            this.setState({ dollarsApplied: parseFloat(num) });\n        }\n    }\n\n    private _updateLoyalty(): void {\n        if (this.props.moduleState.isDisabled && this.isEnabled()) {\n            this._updateEstimate();\n            this.props.moduleState.onUpdating();\n        }\n    }\n\n    private _updateEstimate(): void {\n        const card = this.props.data.loyaltyCard.result;\n        const cart = this.props.data.checkout.result ? this.props.data.checkout.result.checkoutCart.cart : undefined;\n        const channelConfig = this.props.context.request.channel;\n        if (card && cart && channelConfig) {\n            const currencyCode = channelConfig.Currency || '';\n            const loyalPointsRequest = createGetMaxLoyaltyPointsToRedeemForTransactionBalanceInput(cart.Id, card.CardNumber!, currencyCode);\n\n            // @ts-ignore\n            // Due to bug 23214358, this is getting improperly cached. Need to turn on cache bypass for now to work around issue\n            loyalPointsRequest._query.options.bypassCache = 'get';\n\n            callActionOrExecute<LoyaltyPointRedemptionEstimate>(loyalPointsRequest, this.props.context.actionContext)\n                .then(async points => {\n                    this.props.context.actionContext.update(\n                        new GetLoyaltyTransactionEstimationInput(this.props.context.request.apiSettings),\n                        points\n                    );\n                    const newMaxPoints = (points && points.MaxCurrencyValueOfLoyaltyPoints) || 0;\n\n                    // If points are already applied, ensure you don't apply more points than max\n                    if (this.props.data.checkout.result && this.props.data.checkout.result.loyaltyAmount > newMaxPoints) {\n                        await this.props.data.checkout.result.updateLoyaltyAmount({ newAmount: newMaxPoints });\n                    }\n\n                    // If input amount is already equal to max, keep it at new max. Also if input amount would be more than new max, set it to new max\n                    if (this.state.dollarsApplied > newMaxPoints) {\n                        this.setState({ dollarsApplied: newMaxPoints });\n                    }\n                })\n                .catch(error => {\n                    this.props.context.actionContext.telemetry.exception(error);\n                    this.props.context.actionContext.telemetry.debug('Error getting Loyalty Point Redemption Estimate');\n                });\n        }\n    }\n}\n\nexport default CheckoutLoyalty;\n"]}