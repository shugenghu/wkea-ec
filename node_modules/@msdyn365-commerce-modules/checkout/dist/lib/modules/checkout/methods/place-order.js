import { getUrlSync } from '@msdyn365-commerce/core';
import checkout from './checkout';
import emptyActiveCart from './empty-active-cart';
export default async (ctx, checkoutState, orderedProducts, redirect) => {
    let salesOrder;
    try {
        salesOrder = await checkout(ctx);
    }
    catch (error) {
        throw error;
    }
    try {
        await emptyActiveCart(ctx);
    }
    catch (error) {
        throw error;
    }
    if (redirect) {
        const orderConfirmationUrl = getUrlSync('orderConfirmation', ctx) || '';
        if (!orderConfirmationUrl) {
            throw new Error('Error: No orderConfirmationUrl');
        }
        const separator = orderConfirmationUrl.includes('?') ? '&' : '?';
        const url = `${orderConfirmationUrl}${separator}transactionId=${salesOrder.Id}`;
        window.location.assign(url);
    }
    else {
        if (checkoutState) {
            const result = await checkoutState.updateSalesOrder({ newSalesOrder: salesOrder, newOrderedProducts: orderedProducts || [] });
            if (result.status === 'FAILED') {
                throw new Error('Error: Updating error state failed');
            }
        }
        else {
            throw new Error('Error: No checkout state');
        }
    }
};
//# sourceMappingURL=place-order.js.map