{"version":3,"file":"loyalty-terms.test.js","sourceRoot":"./src/","sources":["modules/loyalty-terms/tests/loyalty-terms.test.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n// <reference types=jest />\n// tslint:disable-next-line:no-unused-variable\nimport { mount, render } from 'enzyme';\nimport React, {ReactNode} from 'react';\n\nimport * as RetailActions from '@msdyn365-commerce-modules/retail-actions';\nimport { buildMockModuleProps } from '@msdyn365-commerce/core';\nimport { LoyaltyCard } from '@msdyn365-commerce/retail-proxy';\nimport * as StoreActions from '@msdyn365-commerce/retail-proxy/dist/DataActions/StoreOperationsDataActions.g';\n\nimport LoyaltyTerms, { ILoyaltyTermsViewProps } from '../loyalty-terms';\nimport { ILoyaltyTermsData } from '../loyalty-terms.data';\nimport {\n     ILoyaltyTermsConfig, ILoyaltyTermsProps, ILoyaltyTermsResources\n} from '../loyalty-terms.props.autogenerated';\n\nlet mockData: ILoyaltyTermsData;\n\nconst mockConfig: ILoyaltyTermsConfig = {\n    redirectToLoyalty: false,\n    hideToggle: false\n};\n\n// @ts-ignore empty mock\nlet mockContext: ICoreContext;\n\nconst mockResources: ILoyaltyTermsResources = {\n    loyaltyTermsHeading: 'Loyalty program terms of service',\n    loyaltyAgreeToTerms: 'I have read and agree to the terms of service listed above',\n    joinLoyaltytermsToggleText: 'Sign up for Fabrikam loyalty',\n    joinLoyaltyTermsText: 'Join now',\n    cancelLoyaltyTermsText: 'Cancel',\n    loyaltyHeadingText: 'Loyalty card'\n};\n\nconst mockActions = {};\nconst flushPromises = () => new Promise(setImmediate);\n\ndescribe('LoyaltyTerms', () => {\n  let moduleProps: ILoyaltyTermsProps<ILoyaltyTermsData>;\n  beforeEach(() => {\n        mockData = { loyaltyCard: RetailActions.wrapInResolvedAsyncResult<LoyaltyCard>({ CardNumber: undefined })};\n        mockContext = { request: {locale: 'en-us', user: {isAuthenticated: true, customerAccountNumber: 'foo'}, url: {requestUrl: {search: ''}}}};\n        // @ts-ignore\n        moduleProps = {...buildMockModuleProps(mockData, mockActions, mockConfig, mockContext) as ILoyaltyTermsProps<ILoyaltyTermsData>, resources: mockResources, renderView: jest.fn(props => { return <div props={props} />;})};\n        const myReactNodeChild1: ReactNode = `whatever child module 1`;\n        moduleProps.slots = {serviceTerms: [myReactNodeChild1]};\n  });\n\n  it('Renders modal if card present and user authenticated', () => {\n    const component = mount(<LoyaltyTerms {...moduleProps} />);\n    expect(moduleProps.renderView).toBeCalled();\n    const viewProps: ILoyaltyTermsViewProps = component.childAt(0).props().props;\n    const { modal, modalToggle } = viewProps;\n\n    expect(modal).toBeTruthy();\n    expect(modalToggle).toBeTruthy();\n    expect(render(modalToggle)).toMatchSnapshot();\n    component.unmount();\n  });\n\n  it('Does not render module if already have card', () => {\n    moduleProps.data.loyaltyCard = RetailActions.wrapInResolvedAsyncResult<LoyaltyCard>({ CardNumber: '1' });\n\n    const component = mount(<LoyaltyTerms {...moduleProps} />);\n    expect(moduleProps.renderView).toBeCalled();\n    const viewProps: ILoyaltyTermsViewProps = component.childAt(0).props().props;\n    const { modal, modalToggle } = viewProps;\n\n    expect(modal).not.toBeTruthy();\n    expect(modalToggle).toBeTruthy();\n    component.unmount();\n  });\n\n  it('Does not render modal if user not authed', () => {\n    moduleProps.context.request.user.isAuthenticated = false;\n\n    const component = mount(<LoyaltyTerms {...moduleProps} />);\n    expect(moduleProps.renderView).toBeCalled();\n    const viewProps: ILoyaltyTermsViewProps = component.childAt(0).props().props;\n    const { modal, modalToggle } = viewProps;\n\n    expect(modal).not.toBeTruthy();\n    expect(modalToggle).toBeTruthy();\n    component.unmount();\n  });\n\n  it('toggles modal', () => {\n    const component = mount(<LoyaltyTerms {...moduleProps} />);\n    expect(moduleProps.renderView).toBeCalled();\n    const viewProps: ILoyaltyTermsViewProps = component.childAt(0).props().props;\n    const { modalToggle } = viewProps;\n    const toggle = mount(modalToggle);\n    toggle.simulate('click');\n    expect(component.state('isModalOpen')).toBe(true);\n    toggle.unmount();\n    component.unmount();\n  });\n\n  it('toggles check', () => {\n    const component = mount(<LoyaltyTerms {...moduleProps} />);\n    expect(moduleProps.renderView).toBeCalled();\n    const viewProps: ILoyaltyTermsViewProps = component.childAt(0).props().props;\n    const { modal } = viewProps;\n    const checkbox = mount(modal.checkbox);\n    checkbox.simulate('change');\n    expect(component.state('checked')).toBe(true);\n    checkbox.unmount();\n    component.unmount();\n  });\n\n  it('submit not submit when checked is false', async () => {\n    const component = mount(<LoyaltyTerms {...moduleProps} />);\n    expect(moduleProps.renderView).toBeCalled();\n    const viewProps: ILoyaltyTermsViewProps = component.childAt(0).props().props;\n    const { modal } = viewProps;\n    // @ts-ignore\n    jest.spyOn(RetailActions, 'issueLoyalty').mockImplementation(() => Promise.resolve({}));\n    const submit = mount(modal.submitButton);\n    submit.simulate('click');\n    await flushPromises();\n    expect(RetailActions.issueLoyalty).not.toHaveBeenCalled();\n    submit.unmount();\n    component.unmount();\n  });\n\n  it('submits when checked is true and redirects when config  is set to true', async () => {\n    moduleProps.config.redirectToLoyalty = true;\n    const component = mount(<LoyaltyTerms {...moduleProps} />);\n    expect(moduleProps.renderView).toBeCalled();\n    jest.spyOn(window.location, 'assign');\n    // @ts-ignore\n    jest.spyOn(RetailActions, 'issueLoyalty').mockImplementation(() => Promise.resolve({}));\n\n    component.setState({checked: true});\n    component.update();\n    const viewProps: ILoyaltyTermsViewProps = component.childAt(0).props().props;\n    const { modal } = viewProps;\n    const submit = mount(modal.submitButton);\n    submit.simulate('click');\n    await flushPromises();\n    expect(RetailActions.issueLoyalty).toHaveBeenCalled();\n    expect(window.location.assign).toHaveBeenCalled();\n    submit.unmount();\n    component.unmount();\n  });\n\n  it('Refreshes the loyalty card when users dont navigate', async () => {\n    moduleProps.config.redirectToLoyalty = false;\n    const component = mount(<LoyaltyTerms {...moduleProps} />);\n    expect(moduleProps.renderView).toBeCalled();\n    jest.spyOn(window.location, 'assign');\n    // @ts-ignore\n    jest.spyOn(RetailActions, 'issueLoyalty').mockImplementation(() => Promise.resolve({}));\n    // @ts-ignore\n    jest.spyOn(StoreActions, 'getLoyaltyCardAsync').mockImplementation(() => Promise.resolve({}));\n\n    component.setState({checked: true});\n    component.update();\n    const viewProps: ILoyaltyTermsViewProps = component.childAt(0).props().props;\n    const { modal } = viewProps;\n    const submit = mount(modal.submitButton);\n    submit.simulate('click');\n    await flushPromises();\n    expect(RetailActions.issueLoyalty).toHaveBeenCalled();\n    expect(StoreActions.getLoyaltyCardAsync).toHaveBeenCalled();\n    submit.unmount();\n    component.unmount();\n  });\n});\n"]}