{"version":3,"file":"loyalty-sign-up.js","sourceRoot":"./src/","sources":["modules/loyalty-sign-up/loyalty-sign-up.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classname from 'classnames';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport { issueLoyalty, IssueLoyaltyInput } from '@msdyn365-commerce-modules/retail-actions';\nimport { Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, IModuleProps, ITelemetryContent, TelemetryConstant } from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\nimport {SignUpText} from './components/loyalty-sign-up-small-components';\nimport { ILoyaltySignUpData } from './loyalty-sign-up.data';\nimport { ILoyaltySignUpProps } from './loyalty-sign-up.props.autogenerated';\n\nexport interface IAccountLoyaltyJoinState {\n    clicked: boolean;\n}\nexport interface ILoyaltySignUpViewProps extends ILoyaltySignUpProps<ILoyaltySignUpData> {\n    LoyaltySignUp: IModuleProps;\n    heading: React.ReactNode;\n    memberHeading: React.ReactNode;\n    signInLink: React.ReactElement;\n    signUpText: React.ReactElement;\n    signUpButton: React.ReactElement;\n    detailsLink: React.ReactElement;\n    termsLink: React.ReactElement;\n    loading: boolean;\n}\n\n/**\n *\n * LoyaltySignUp component\n * @extends {React.Component<ILoyaltySignUpProps<ILoyaltySignUpData>>}\n */\n@observer\nclass LoyaltySignUp extends React.Component<ILoyaltySignUpProps<ILoyaltySignUpData>, IAccountLoyaltyJoinState> {\n    private telemetryContent?: ITelemetryContent;\n    private loyaltySignInAttributes: Msdyn365.IDictionary<string> | undefined;\n    private loyaltySignUpAttributes: Msdyn365.IDictionary<string> | undefined;\n    private loyaltyDetailsLinkAttributes: Msdyn365.IDictionary<string> | undefined;\n    private loyaltyTermsLinkAttributes: Msdyn365.IDictionary<string> | undefined;\n\n    constructor(props: ILoyaltySignUpProps<ILoyaltySignUpData>) {\n        super(props);\n        this.state = { clicked: false };\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n        const payLoad = getPayloadObject('click', this.telemetryContent, TelemetryConstant.SignIn);\n        this.loyaltySignInAttributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n        payLoad.contentAction.etext = TelemetryConstant.SignUp;\n        this.loyaltySignUpAttributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n        payLoad.contentAction.etext = TelemetryConstant.LoyaltyDetailLink;\n        this.loyaltyDetailsLinkAttributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n        payLoad.contentAction.etext = TelemetryConstant.LoyaltyTermsLink;\n        this.loyaltyTermsLinkAttributes = getTelemetryAttributes(this.telemetryContent, payLoad);\n    }\n\n    public render(): JSX.Element | null {\n        const {\n            config: {className, heading, memberHeading},\n            resources,\n            context: {\n                actionContext,\n                request: {\n                    user: {\n                        signInUrl,\n                        isAuthenticated\n                    }\n                }\n            },\n            data: { loyaltyCard }\n        } = this.props;\n\n        const termsUrl = Msdyn365.getUrlSync('loyaltyTerms', actionContext);\n        let loyaltyJoinUrl = `${Msdyn365.getUrlSync('loyaltyJoin', actionContext)}?joiningLoyalty=true`;\n        if (window) {\n            loyaltyJoinUrl = `${window.location.origin}${loyaltyJoinUrl}`;\n        }\n        const signInurl = `${signInUrl}?ru=${loyaltyJoinUrl}`;\n        const completeClass = classname('ms-loyalty-signup', className);\n\n        const hasLoyaltyAccount = loyaltyCard.result && loyaltyCard.result.CardTenderTypeValue !== undefined;\n\n        const viewProps = {\n            ...this.props,\n            className: completeClass,\n            LoyaltySignUp: {\n                moduleProps: this.props,\n                className: completeClass\n            },\n            loading: loyaltyCard.status === 'LOADING',\n            heading: !hasLoyaltyAccount && heading && heading.text && (\n            <Msdyn365.Text\n                className='ms-loyalty-signup__heading'\n                tag={heading.tag}\n                text={heading.text}\n                editProps = {{onEdit: this.handleHeadingChange, requestContext: this.props.context.request}}\n            />\n            ),\n            memberHeading: hasLoyaltyAccount && memberHeading && memberHeading.text && (\n            <Msdyn365.Text\n                className='ms-loyalty-signup__heading'\n                tag={memberHeading.tag}\n                text={memberHeading.text}\n                editProps = {{onEdit: this.handleMemberHeadingChange, requestContext: this.props.context.request}}\n            />\n            ),\n            signInLink: !isAuthenticated && <Button className='ms-loyalty-signup__signin' href={signInurl} {...this.loyaltySignInAttributes}>{this.props.resources.joinLoyaltyButtonText}</Button>,\n            signUpText: !hasLoyaltyAccount && <SignUpText text={resources.loyaltyProgramText}/>,\n            signUpButton: !hasLoyaltyAccount &&  isAuthenticated && <Button className='ms-loyalty-signup__btn' onClick={this._issueLoyalty} {...this.loyaltySignUpAttributes} >{this.props.resources.joinLoyaltyButtonText}</Button>,\n            detailsLink: hasLoyaltyAccount &&\n                <Button className='ms-loyalty-signup__details' href={Msdyn365.getUrlSync('loyalty', this.props.context.actionContext)} {...this.loyaltyDetailsLinkAttributes} >{this.props.resources.viewLoyaltyPageText}</Button>,\n            termsLink: !hasLoyaltyAccount && <Button className='ms-loyalty-signup__terms' href={termsUrl} {...this.loyaltyTermsLinkAttributes} >{this.props.resources.loyaltyTermsLinkText}</Button>\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text= event.target.value;\n    public handleMemberHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.memberHeading!.text= event.target.value;\n\n    private _issueLoyalty = () => {\n        if (this.props.context.request.user.isAuthenticated && !this.state.clicked) {\n            this.setState({ clicked: true });\n            const input = new IssueLoyaltyInput(this.props.context.request.apiSettings);\n\n            issueLoyalty(input, this.props.context.actionContext)\n                .then(() => {\n                    window.location.assign(Msdyn365.getUrlSync('loyalty', this.props.context.actionContext) || '');\n                })\n                .catch((error: Error) => {\n                    this.setState({ clicked: false });\n                    this.props.telemetry.error(error.message);\n                    this.props.telemetry.debug('Unable to issue loyalty card');\n                });\n        }\n    }\n}\n\nexport default LoyaltySignUp;\n"]}