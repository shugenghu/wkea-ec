{"version":3,"file":"cart-icon.js","sourceRoot":"./src/","sources":["modules/cart-icon/cart-icon.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, INodeProps, ITelemetryContent, TelemetryConstant, UncontrolledTooltip } from '@msdyn365-commerce-modules/utilities';\nimport { CartIconComponent } from '@msdyn365-commerce/components';\nimport { getUrlSync, IDictionary, IImageSettings, msdyn365Commerce, TelemetryEvent } from '@msdyn365-commerce/core';\nimport { CartLine, OrgUnitLocation } from '@msdyn365-commerce/retail-proxy';\nimport classnames from 'classnames';\nimport { reaction } from 'mobx';\nimport { observer } from 'mobx-react';\nimport React from 'react';\nimport { ICartIconData } from './cart-icon.data';\nimport { ICartIconProps } from './cart-icon.props.autogenerated';\nimport { FlyoutCartLineItems, IFlyoutCartLineItemViewProps } from './components/flyout-cart-line-items';\nimport { getMiniCartData, IMiniCartData } from './utils/get-products-in-mini-cart';\n\nexport interface IMiniCartState {\n    miniCartData: IMiniCartData;\n    orgUnitLocations?: OrgUnitLocation[];\n}\n\nexport interface ICartIconViewProps extends ICartIconProps<ICartIconData> {\n    className: string;\n    cartIcon: React.ReactNode;\n\n    FlyoutContainer?: INodeProps;\n\n    CartlinesWrapper: INodeProps;\n    miniCartWrapper: INodeProps;\n    miniCartItemWrapper: INodeProps;\n    cartlines?: IFlyoutCartLineItemViewProps[];\n    flyoutTitle: React.ReactNode;\n    totalPrice: React.ReactNode;\n\n    checkoutAsGuestButton?: React.ReactNode;\n    checkoutAsSignInUserButton?: React.ReactNode;\n    goToCartButton?: React.ReactNode;\n    waitingComponent?: React.ReactNode;\n\n    isCartLoading: boolean;\n\n    removeItemClickHandler(cartlineToRemove: CartLine): void;\n}\n\n/**\n *\n * Cart component\n * @extends {React.PureComponent<ICartProps<ICartData>>}\n */\n@observer\nclass CartIcon extends React.Component<ICartIconProps<ICartIconData>, IMiniCartState> {\n    private telemetryContent: ITelemetryContent;\n    private checkoutBySignInAttributes: IDictionary<string> | undefined;\n    private checkoutByGuestAttributes: IDictionary<string> | undefined;\n    private viewShoppingBagAttributes: IDictionary<string> | undefined;\n    constructor(props: ICartIconProps<ICartIconData>) {\n        super(props);\n        this.state = { miniCartData: {} };\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n        const payload = getPayloadObject(TelemetryEvent.CheckOut, this.telemetryContent, TelemetryConstant.Checkout);\n        this.checkoutBySignInAttributes = getTelemetryAttributes(this.telemetryContent, payload);\n\n        payload.contentAction.etext = TelemetryConstant.GuestCheckout;\n        this.checkoutByGuestAttributes = getTelemetryAttributes(this.telemetryContent, payload);\n\n        payload.contentAction.etext = TelemetryConstant.ViewShoppingBag;\n        this.viewShoppingBagAttributes = getTelemetryAttributes(this.telemetryContent, payload);\n    }\n\n    public async componentDidMount(): Promise<void> {\n        const context = this.props.context.actionContext;\n\n        if(this.props.data.cart && this.props.data.cart.result && this.props.data.cart.result.cart.CartLines) {\n            this.setState({\n                miniCartData: await getMiniCartData(context)\n            });\n        }\n\n        reaction(\n            () => this.props.data.cart.result?.cart.CartLines,\n            async () => {\n                this.setState({\n                    miniCartData: await getMiniCartData(context)\n                });\n            }\n        );\n\n        this.setState({\n            orgUnitLocations: this.props.data.orgUnitLocations.result\n        });\n    }\n\n    public render(): JSX.Element | null {\n        const {\n            id,\n            typeName,\n            data: {\n                cart: { result: cart }\n            },\n            config: {\n                enableHoverCart\n            },\n            context: {\n                request: {\n                    user: {\n                        isAuthenticated,\n                        signInUrl\n                    }\n                }\n            },\n            context,\n            resources\n        } = this.props;\n\n        const guestCheckoutUrl = getUrlSync('checkout', this.props.context.actionContext) || '';\n        const cartUrl = getUrlSync('cart', this.props.context.actionContext) || '';\n        const checkoutURL = this._getCheckoutURL(isAuthenticated, guestCheckoutUrl, signInUrl || '');\n        const isCartEmpty = cart && cart.cart.CartLines && cart.cart.CartLines.length === 0;\n        const cartLines = this._getCartLines();\n        const hasErrors = cartLines ? cartLines.some(cartline => cartline.hasError) : false;\n        const includeFlyout = this.props.data.cart.status === 'SUCCESS' && enableHoverCart;\n        const cartSize = cartLines ? cartLines.length : 0;\n        const goToCartButtonText = resources.goToCartButtonTitle.replace('{count}', cartSize.toString());\n        const flyoutTitle = resources.flyoutTitle;\n        const price = cart && cart.cart.TotalAmount || undefined;\n        const priceString = price ? resources.totalPriceFormatString.replace('{price}', context.cultureFormatter.formatCurrency(price)) : '';\n\n        const viewProps = {\n            ...this.props,\n            cartIcon: cart && (\n                <CartIconComponent\n                    cartLabel={resources.cartLabel}\n                    context={context}\n                    id={id}\n                    typeName={typeName}\n                    data={{cart: cart}}\n                    telemetryContent={this.telemetryContent}\n                />\n            ),\n            cartlines: cartLines,\n            FlyoutContainer: includeFlyout ? {\n                tag: UncontrolledTooltip,\n                placement: 'bottom-end',\n                hideArrow: true,\n                className: 'ms-cart-icon__flyout-container',\n                trigger: 'hover focus',\n                displayMode: 'FLYOUT',\n                target: id\n            } : undefined,\n            CartlinesWrapper: {\n                className: 'ms-cart-icon__cart-lines'\n            },\n            miniCartWrapper: {\n                className: classnames('ms-cart-icon'),\n                id: this.props.id\n            },\n            miniCartItemWrapper: {\n                className: classnames('msc-cart-lines-item')\n            },\n            checkoutAsSignInUserButton: (!isCartEmpty) ?\n            (\n                <Button disabled={hasErrors} className={'ms-cart-icon__btn-checkout'} href={checkoutURL} title={resources.checkoutButtonTitle}{...this.checkoutBySignInAttributes}>{resources.checkoutButtonTitle}</Button>\n            ) : null,\n            checkoutAsGuestButton: (!isCartEmpty && !isAuthenticated) ?\n            (\n                <Button disabled={hasErrors} className={'ms-cart-icon__btn-guestcheckout'} href={guestCheckoutUrl} title={resources.guestCheckoutButtonTitle}{...this.checkoutByGuestAttributes}>{resources.guestCheckoutButtonTitle}</Button>\n            ) : null,\n            goToCartButton:\n            (\n                <Button className={'ms-cart-icon__btn-gotocart'} href={cartUrl} title={goToCartButtonText} {...this.viewShoppingBagAttributes}>{goToCartButtonText}</Button>\n            ),\n            flyoutTitle:\n            (\n                <span className={`ms-cart-icon__flyout-title`}>{flyoutTitle}</span>\n            ),\n            totalPrice:\n            (\n                <div className={`ms-cart-icon__subtotal`}>{priceString}</div>\n            )\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private _getCheckoutURL(isAuthenticated: boolean, guestCheckoutUrl: string, signInUrl: string): string {\n        if (isAuthenticated) {\n            return guestCheckoutUrl;\n        }\n\n        const absoluteUrlRegExp = new RegExp('^(?:[a-z]+:)?//', 'i');\n        const isAbsoluteUrl = absoluteUrlRegExp.test(guestCheckoutUrl);\n        let returnURL = guestCheckoutUrl;\n        if (msdyn365Commerce.isBrowser && !isAbsoluteUrl) {\n            returnURL = `${window.location.origin}${guestCheckoutUrl}`;\n        }\n\n        return `${signInUrl}${signInUrl.indexOf('?') === -1 ? '?' : '&'}ru=${returnURL}`;\n    }\n\n    private _getCartLines(): IFlyoutCartLineItemViewProps[] | null {\n        const {\n            data: {\n                cart: { result: cart }\n            },\n            context: {\n                request: {\n                    channel: {\n                        PickupDeliveryModeCode\n                    } = { PickupDeliveryModeCode: undefined }\n                }\n            },\n            config: config,\n            telemetry,\n            resources\n        } = this.props;\n\n        const imageSettings = this._getImageSettings(config.imageSettings);\n\n        return this.state.miniCartData.products && cart && cart.cart.CartLines && cart.cart.CartLines.length > 0 ?\n        (\n            FlyoutCartLineItems({\n                cartlines: cart.cart.CartLines,\n                products: this.state.miniCartData.products,\n                productAvailabilites: this.state.miniCartData.productAvailabilites,\n                productDeliveryOptions: this.state.miniCartData.deliveryOptions,\n                imageSettings: imageSettings,\n                outOfStockThreshold: this.props.context.app.config.outOfStockThreshold || 0,\n                isStockCheckEnabled: this.props.context.app.config.enableStockCheck || false,\n                maxCartlineQuantity: this.props.context.app.config.maxQuantityForCartLineItem,\n                gridSettings: this.props.context.request.gridSettings!,\n                context: this.props.context,\n                typeName: this.props.typeName,\n                id: this.props.id,\n                resources: {\n                    sizeString: resources.productDimensionTypeSize,\n                    colorString: resources.productDimensionTypeColor,\n                    configString: resources.productDimensionTypeConfiguration,\n                    styleString: resources.productDimensionTypeStyle,\n                    quantityDisplayString: resources.quantityDisplayText,\n                    inputQuantityAriaLabel: '', // not used\n                    discountStringText: '', // not used\n                    originalPriceText: '',\n                    currentPriceText: '',\n                    shippingChargesText: ''\n                },\n                telemetry: telemetry,\n                removeButtonText: resources.removeCartButtonText,\n                outOfStockText: '', // not used\n                outOfRangeOneText: '', // not used\n                outOfRangeFormatText: '', // not used\n                cartState: this.props.data.cart.result,\n                orgUnitLocations: this.state.orgUnitLocations,\n                removeItemClickHandler: this._removeItemFromCartHandler,\n                pickupDeliveryModeCode: PickupDeliveryModeCode,\n                telemetryContent: this.telemetryContent\n            })\n        ) : null;\n    }\n\n    private _getImageSettings = (imageSettings: IImageSettings | undefined): IImageSettings => {\n        return imageSettings || {\n            viewports: {\n                xs: { q: `w=80&h=94&m=6`, w: 0, h: 0 },\n                sm: { q: `w=148&h=174&m=6`, w: 0, h: 0 },\n                lg: { q: `w=148&h=174&m=6`, w: 0, h: 0 }\n            },\n            lazyload: true\n        };\n    }\n\n    private _removeItemFromCartHandler = (cartlineToRemove: CartLine) => {\n        if (this.props.data.cart.result) {\n            const input = {\n                cartLineIds: [cartlineToRemove.LineId!.toString()]\n            };\n            this.props.data.cart.result.removeCartLines(input)\n                .catch((error) => {\n                    this.props.telemetry.warning(error);\n                    this.props.telemetry.debug('Unable to Remove Cart Line');\n                });\n        }\n    }\n}\n\nexport default CartIcon;\n"]}