import { ActiveCartProductsInput, getActiveCartProductsAction, getAvailabilitiesForCartLineItems, getDeliveryOptionsForCartLineItems, ProductAvailabilitiesForCartLineItems, ProductDeliveryOptionsForCartLineItems } from '@msdyn365-commerce-modules/retail-actions';
import { getCartState } from '@msdyn365-commerce/global-state';
export const createInput = () => {
    return new ActiveCartProductsInput();
};
export async function getMiniCartData(ctx) {
    const miniCartData = {};
    const cartState = await getCartState(ctx);
    const cart = cartState.cart;
    if (cart && cart.CartLines && cart.CartLines.length) {
        await getActiveCartProductsAction(new ActiveCartProductsInput(), ctx)
            .then(products => {
            if (products) {
                miniCartData.products = products;
            }
        })
            .catch(error => {
            ctx.telemetry.exception(error);
            throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');
        });
        await getAvailabilitiesForCartLineItems(new ProductAvailabilitiesForCartLineItems(ctx.requestContext.apiSettings), ctx)
            .then(availableQuantity => {
            if (availableQuantity) {
                miniCartData.productAvailabilites = availableQuantity;
            }
        })
            .catch(error => {
            ctx.telemetry.exception(error);
            throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');
        });
        await getDeliveryOptionsForCartLineItems(new ProductDeliveryOptionsForCartLineItems(ctx.requestContext.apiSettings), ctx)
            .then(deliveryOptions => {
            if (deliveryOptions) {
                miniCartData.deliveryOptions = deliveryOptions;
            }
        })
            .catch(error => {
            ctx.telemetry.exception(error);
            throw new Error('[getActiveCartWithProdcuts]Unable to hydrate cart with product information');
        });
    }
    return miniCartData;
}
//# sourceMappingURL=get-products-in-mini-cart.js.map