{"version":3,"file":"breadcrumb.js","sourceRoot":"./src/","sources":["modules/breadcrumb/breadcrumb.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getTelemetryObject, IModuleProps, INodeProps, ITelemetryContent, NodeTag } from '@msdyn365-commerce-modules/utilities';\nimport { CategoryHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport MsDyn365 from '@msdyn365-commerce/core';\nimport { ICategoryUrl } from '@msdyn365-commerce/core-internal/dist/types/interfaces/ICategoryPathInterfaces';\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport { IBreadcrumbData } from './breadcrumb.data';\nimport { IBreadcrumbProps, ILinksData } from './breadcrumb.props.autogenerated';\nimport { Link } from './components/link';\nimport { Separator } from './components/separator';\n\nexport interface IBreadcrumbViewProps extends IBreadcrumbProps<IBreadcrumbData> {\n    root?: React.ReactNode;\n    links?: React.ReactNode[];\n    backButton?: React.ReactNode;\n    separator?: React.ReactNode;\n    BreadcrumbContainer: IModuleProps;\n    BreadcrumbList: INodeProps;\n    BreadcrumbListItem: INodeProps;\n}\n\n/**\n *\n * Breadcrumb component\n * @extends {React.PureComponent<IBreadcrumbProps<IBreadcrumbData>>}\n */\nclass Breadcrumb extends React.PureComponent<IBreadcrumbProps<IBreadcrumbData>> {\n    private _pageType: string | undefined = this.props.context.request.urlTokens.pageType;\n    private telemetryContent: ITelemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!,\n                                                                     this.props.friendlyName,\n                                                                     this.props.telemetry);\n    public render(): JSX.Element | null {\n\n        const { className } = this.props.config;\n        let rootLink = null;\n        let breadcrumbLinks = null;\n        let backButtonComponent = null;\n        rootLink = this._getRootLink();\n        const itemPosition = rootLink ? 1 : 0;\n        if (this._pageType === 'Category') {\n            breadcrumbLinks = this._getCustomBreadcrumbLinks(itemPosition);\n            if (!breadcrumbLinks) {\n                breadcrumbLinks = this._getCategoryHierarchy(itemPosition);\n            }\n        } else if (this._pageType === 'Product') {\n            breadcrumbLinks = this._getCustomBreadcrumbLinks(itemPosition);\n            if (!breadcrumbLinks) {\n                const breaCrumbType = this.props.context.app.config.breadcrumbType;\n                if (breaCrumbType === 'category') {\n                    breadcrumbLinks = this._getPDPLinks(itemPosition);\n                }\n                if (breaCrumbType === 'categoryAndBack') {\n                    backButtonComponent = this._getPDPBackButton();\n                    breadcrumbLinks = this._getPDPLinks(itemPosition);\n                }\n                if (breaCrumbType === 'back') {\n                    backButtonComponent = this._getPDPBackButton();\n                    if(backButtonComponent === null) {\n                        breadcrumbLinks = this._getPDPLinks(itemPosition);\n                    }\n                }\n            }\n\n        } else {\n            breadcrumbLinks = this._getCustomBreadcrumbLinks(itemPosition);\n        }\n        const linkSeparator = <Separator separator='/' />;\n\n        const breadcrumbViewProps = {\n            ...this.props,\n            BreadcrumbContainer: {\n                moduleProps: this.props,\n                className: classnames('ms-breadcrumb', className),\n                tag: 'nav',\n                role: 'navigation',\n            },\n            BreadcrumbList: {\n                tag: 'ol' as NodeTag,\n                className: 'ms-breadcrumb_list'\n            },\n            BreadcrumbListItem: {\n                tag: 'li',\n                className: 'ms-breadcrumb_item'\n            },\n            root: rootLink,\n            links: breadcrumbLinks,\n            backButton: backButtonComponent,\n            separator: linkSeparator\n        };\n        return this.props.renderView(breadcrumbViewProps) as React.ReactElement;\n    }\n    private _getRootLink = (): JSX.Element | null => {\n        const { root } = this.props.config;\n        if (!root || !root.linkUrl || !root.linkUrl.destinationUrl) {\n            this.props.context.telemetry.error('BreadCrumb link url content is empty, link wont render');\n            return null;\n        }\n        return (\n            <Link\n                text={root.linkText}\n                ariaLabel={root.ariaLabel || root.linkText}\n                href={root.linkUrl && root.linkUrl.destinationUrl}\n                index='1'\n                className='ms-breadcrumb_link'\n                telemetryContent={this.telemetryContent}\n            />);\n\n    }\n\n    private _getCustomBreadcrumbLinks = (itemPosition: number): JSX.Element[] | null => {\n        const { links } = this.props.config;\n\n        if (!links || !(links.length > 0)) {\n            this.props.context.telemetry.error('BreadCrumb links content is empty, links wont render');\n            return null;\n        }\n        return (\n            links.map((value: ILinksData, index: number) => {\n                itemPosition++;\n                return (\n                    <Link\n                        key={index}\n                        text={value.linkText}\n                        ariaLabel={value.ariaLabel || value.linkText}\n                        href={value.linkUrl && value.linkUrl.destinationUrl}\n                        index={{ itemPosition }.toString()}\n                        className='ms-breadcrumb_link'\n                        telemetryContent={this.telemetryContent}\n                    />\n                );\n            }));\n    }\n\n    private _getCategoryHierarchy = (itemPosition: number): JSX.Element[] | null => {\n        const { data } = this.props;\n        const categoryHierarchy = data.categoryHierarchy.result;\n        if (!categoryHierarchy) {\n            this.props.context.telemetry.error('Category Hierarchy content is empty, module wont render');\n            return null;\n        }\n        return (\n            categoryHierarchy.map((value: CategoryHierarchy, index: number) => {\n                itemPosition++;\n                return (\n                    <Link\n                        key={index}\n                        text={value.Name}\n                        ariaLabel={value.Name}\n                        href={value.Url}\n                        index={itemPosition.toString()}\n                        className='ms-breadcrumb_link'\n                        noclick={index === categoryHierarchy.length -1}\n                        telemetryContent={this.telemetryContent}\n                    />\n                );\n            }));\n\n    }\n\n    private _getPDPLinks = (itemPosition: number): JSX.Element[] | null => {\n        const { data, config } = this.props;\n        const categoryHierarchy = data.categoryPaths.result;\n        const product = data.product.result;\n        const url = this.props.context.request.url.requestUrl.href;\n        if (!categoryHierarchy) {\n            this.props.context.telemetry.error('Category path content is empty for the product');\n            return null;\n        }\n        const links: JSX.Element[] = [];\n\n        categoryHierarchy.map((value: ICategoryUrl, index: number) => {\n            itemPosition++;\n            links.push(\n                <Link\n                    key={index}\n                    text={value.Name}\n                    ariaLabel={value.Name}\n                    href={value.Url}\n                    index={itemPosition.toString()}\n                    className='ms-breadcrumb_link'\n                    telemetryContent={this.telemetryContent}\n                />\n            );\n        });\n        if (product && !config.hideProductName) {\n            itemPosition++;\n            links.push(\n                <Link\n                    text={product.Name}\n                    ariaLabel={product.Name}\n                    href= {url}\n                    index={itemPosition.toString()}\n                    noclick={true}\n                    className='ms-breadcrumb_link'\n                    telemetryContent={this.telemetryContent}\n                />\n            );\n        }\n        return links;\n\n    }\n\n    private _goBack = (): void => {\n        window.history.back();\n    }\n\n    private _getPDPBackButton = (): JSX.Element | null => {\n        const isBackAllowed = this.props.context && this.props.context.request && this.props.context.request.query && this.props.context.request.query.back;\n        if (MsDyn365.isBrowser && (!isBackAllowed || document.referrer === '' || window.history.length < 2)) {\n            return null;\n        }\n        return (\n            <a\n                className='ms-breadcrumb-back-button'\n                role='button'\n                href='javascript:void(0);'\n                onClick={this._goBack}\n                aria-label={this.props.resources.backToResultsText}\n            >\n                {this.props.resources.backToResultsText}\n            </a>\n        );\n\n    }\n}\n\nexport default Breadcrumb;\n"]}