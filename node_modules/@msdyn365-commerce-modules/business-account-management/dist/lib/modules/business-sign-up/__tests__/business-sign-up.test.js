import * as React from 'react';
import { buildMockModuleProps } from '@msdyn365-commerce/core';
import { mount, render } from 'enzyme';
import BusinessSignUp, { InputID, InputType } from '../business-sign-up';
import BusinesSignUpView from '../business-sign-up.view';
const mockConfig = {
    heading: {
        tag: "h2",
        text: 'Business Sign up Form'
    },
    disclaimer: '<p>This is a test disclaimer...</p>',
    confirmationLink: {
        linkText: 'See details.',
        linkUrl: {
            destinationUrl: '#'
        },
        ariaLabel: 'See details',
        openInNewTab: false
    }
};
const mockAddress = {
    AddressTypeValue: 8,
    State: 'WA',
    ThreeLetterISORegionName: 'USA',
    Street: '91900 Jefferson St',
    City: 'Seattle',
    ZipCode: '98122'
};
const mockAddressInput = {
    id: InputID.Address,
    type: InputType.Address,
    label: 'Company Address',
    value: '',
    isRequired: false,
    customClass: 'width-100',
    address: mockAddress
};
const mockResources = {
    firstNameLabel: 'First Name',
    firstNameMaxLength: '20',
    lastNameLabel: 'Last Name',
    lastNameMaxLength: '20',
    emailAddressLabel: 'Email Address',
    signUpButtonText: 'Sign up',
    signUpButtonArialabel: 'Sign up',
    cancelButtonText: 'Cancel',
    cancelButtonArialabel: 'Cancel',
    requiredFieldMissingSummaryError: 'A required field is missing. Please fill out all required fields and try again.',
    requiredFieldMissingError: 'This information is required.',
    fieldIncorrectError: 'One or more fields are filled out incorrectly. Please check your entries and try again.',
    partialAddressErrorMessage: 'Please complete the rest of the address fields as we do not accept a partial address.'
};
const mockFormItems = [
    {
        id: InputID.FirstName,
        type: InputType.Text,
        label: mockResources.firstNameLabel,
        value: '',
        isRequired: true,
        customClass: 'width-25'
    },
    {
        id: InputID.LastName,
        type: InputType.Text,
        label: mockResources.lastNameLabel,
        value: '',
        isRequired: true,
        customClass: 'width-25'
    },
    {
        id: InputID.Email,
        type: InputType.Email,
        label: mockResources.emailAddressLabel,
        value: '',
        isRequired: true,
        pattern: '^[a-zA-Z0-9.!#$%&\'^_`{}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$',
        customClass: 'width-50'
    },
    {
        id: InputID.CompanyName,
        type: InputType.Text,
        label: mockResources.companyLabel,
        value: '',
        isRequired: true,
        customClass: 'width-50'
    },
    {
        id: InputID.Department,
        type: InputType.Text,
        label: mockResources.departmentLabel,
        value: '',
        isRequired: false,
        customClass: 'width-50'
    },
    {
        id: InputID.JobTitle,
        type: InputType.Text,
        label: mockResources.jobTitleLabel,
        value: '',
        isRequired: false,
        customClass: 'width-50'
    },
    {
        id: InputID.Size,
        type: InputType.Text,
        label: mockResources.companySizeLabel,
        value: '',
        isRequired: false,
        customClass: 'width-50'
    }
];
const mockSlots = {
    addressSlot: [(React.createElement("div", null, "Mock Address Component"))]
};
const mockActions = {};
describe('BusinessSignUp', () => {
    it('renders correctly', () => {
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig),
            resources: mockResources,
            slots: mockSlots,
            renderView: BusinesSignUpView
        };
        const component = render(React.createElement(BusinessSignUp, Object.assign({}, moduleProps)));
        expect(component).toMatchSnapshot();
    });
    it('renders correctly without address slot', () => {
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig),
            resources: mockResources,
            BusinesSignUpView
        };
        const component = render(React.createElement(BusinessSignUp, Object.assign({}, moduleProps)));
        expect(component).toMatchSnapshot();
    });
    it('testing onInputChange', () => {
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig),
            resources: mockResources,
            renderView: BusinesSignUpView
        };
        const component = mount(React.createElement(BusinessSignUp, Object.assign({}, moduleProps)));
        const inputFields = component.find('input');
        const textInputField = inputFields.first();
        const elementId = textInputField.props().id;
        textInputField.simulate('change', { target: { value: 'foo', id: `${elementId}` } });
    });
    it('testing isFormReady', () => {
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig),
            resources: mockResources,
            renderView: BusinesSignUpView
        };
        const component = mount(React.createElement(BusinessSignUp, Object.assign({}, moduleProps)));
        const inputFields = component.find('input');
        inputFields.forEach(input => {
            const elementId = input.props().id;
            switch (elementId) {
                case 'CompanyEmail':
                    input.simulate('change', { target: { value: 'test@email.com', id: `${elementId}` } });
                    break;
                case 'CompanySize':
                    input.simulate('change', { target: { value: '10', id: `${elementId}` } });
                    break;
                case 'CompanyAddress':
                    input.simulate('change', { target: { address: mockAddress, id: `${elementId}` } });
                    break;
                default:
                    input.simulate('change', { target: { value: 'test value', id: `${elementId}` } });
            }
        });
        expect(component.state('isReady')).toBeTruthy();
        inputFields.forEach(input => {
            const elementId = input.props().id;
            switch (elementId) {
                case 'CompanyEmail':
                    input.simulate('change', { target: { value: 'test', id: `${elementId}` } });
                    break;
                case 'CompanySize':
                    input.simulate('change', { target: { value: 'abc', id: `${elementId}` } });
                    break;
                default:
                    input.simulate('change', { target: { value: 'test value', id: `${elementId}` } });
            }
        });
        expect(component.state('isReady')).toBeFalsy();
    });
    it('testing onSubmit', () => {
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig),
            resources: mockResources,
            renderView: BusinesSignUpView
        };
        const component = mount(React.createElement(BusinessSignUp, Object.assign({}, moduleProps)));
        const inputFields = component.find('input');
        inputFields.forEach(input => {
            const elementId = input.props().id;
            switch (elementId) {
                case 'CompanyEmail':
                    input.simulate('change', { target: { value: 'test@email.com', id: `${elementId}` } });
                    break;
                case 'ComapanySize':
                    input.simulate('change', { target: { value: '10', id: `${elementId}` } });
                    break;
                default:
                    input.simulate('change', { target: { value: 'test value', id: `${elementId}` } });
            }
        });
        expect(component.state('isReady')).toBeTruthy();
        const newFormItems = component.state('formItems');
        newFormItems.push(mockAddressInput);
        component.setState({
            formItems: newFormItems
        });
        expect(newFormItems).toMatchSnapshot();
        const submitButton = component.find('a.ms-business-sign-up__create-button').first();
        submitButton.simulate('click');
    });
    it('testing onCancel', () => {
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig),
            resources: mockResources,
            renderView: BusinesSignUpView
        };
        const component = mount(React.createElement(BusinessSignUp, Object.assign({}, moduleProps, { formItems: mockFormItems })));
        const inputFields = component.find('input');
        inputFields.forEach(input => {
            input.simulate('change', { target: { value: 'test', id: `${input.props().id}` } });
        });
        const beforeFormItems = component.state('formItems');
        beforeFormItems.forEach(formItem => {
            try {
                expect(formItem.value).toBe('test');
            }
            catch {
                throw new Error(`${formItem.id} IS THROWING THE ERROR`);
            }
        });
        component.setState({
            formItems: beforeFormItems
        });
        const cancelButton = component.find('button.ms-business-sign-up__cancel-button').first();
        cancelButton.simulate('click');
        const afterFormItems = component.state('formItems');
        afterFormItems.forEach(formItem => {
            try {
                expect(formItem.value).toBe('');
            }
            catch {
                throw new Error(`${formItem.id} IS THROWING THE ERROR`);
            }
        });
    });
    it('testing errors render', () => {
        const moduleProps = {
            ...buildMockModuleProps({}, mockActions, mockConfig),
            resources: mockResources,
            renderView: BusinesSignUpView
        };
        const wrapper = mount(React.createElement(BusinessSignUp, Object.assign({}, moduleProps)));
        const component = wrapper.instance();
        component.setState({
            hasSubmitErrors: true
        });
        const formComponent = component._renderForm();
        expect(formComponent.errorMessage[0]).not.toBeFalsy();
    });
});
//# sourceMappingURL=business-sign-up.test.js.map