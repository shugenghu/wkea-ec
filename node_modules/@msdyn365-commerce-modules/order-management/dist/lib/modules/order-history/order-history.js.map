{"version":3,"file":"order-history.js","sourceRoot":"./src/","sources":["modules/order-history/order-history.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport classname from 'classnames';\nimport { observable } from 'mobx';\nimport { observer } from 'mobx-react';\nimport * as React from 'react';\n\nimport { Button, getPayloadObject, getTelemetryAttributes, getTelemetryObject, IModuleProps, INodeProps, IPayLoad, ITelemetryContent, TelemetryConstant } from '@msdyn365-commerce-modules/utilities';\nimport * as Msdyn365 from '@msdyn365-commerce/core';\n\nimport LabelComponent from '../../common/label';\nimport {\n    getSalesOrderHistoryWithHydrationsAction, GetSalesOrderHistoryWithHydrationsInput,\n    IOrderHistory, IPaging\n} from './actions/get-order-shipment-history';\nimport { getSalesOrder, ISalesOrder } from './components/get-sales-order';\nimport { IOrderHistoryData } from './order-history.data';\nimport { IOrderHistoryProps } from './order-history.props.autogenerated';\n\nexport * from '../../common/get-groups';\nexport * from '../../common/get-order-information';\nexport * from '../../common/get-sales-line';\nexport * from '../../common/get-sales-lines';\nexport * from '../../common/utilities';\nexport * from './components/get-sales-order';\n\nexport * from '../../common/get-order-information';\nexport * from './components/get-sales-order';\n\nexport interface IHeader {\n    headerProps: INodeProps;\n    heading: React.ReactNode;\n    orderCountLabel?: React.ReactNode;\n}\n\nexport interface IList {\n    listProps: INodeProps;\n    salesOrders: ISalesOrder[];\n}\n\nexport interface IOrderHistoryViewState {\n    isDataReady: boolean;\n    hasError: boolean;\n    isLoading: boolean;\n    isShowMoreButton: boolean;\n}\n\nexport interface IOrderHistoryViewProps extends IOrderHistoryProps<IOrderHistoryData> {\n    orderHistory: IOrderHistory;\n    orderHistoryProps: IModuleProps;\n    alert?: React.ReactNode;\n    loading?: React.ReactNode;\n    emptyMessage?: React.ReactNode;\n    header: IHeader;\n    backToShoppingLink?: React.ReactNode;\n    list?: IList;\n    moreButton?: React.ReactNode;\n    viewState: IOrderHistoryViewState;\n}\n\n/**\n *\n * OrderHistory component\n * @extends {React.Component<IOrderHistoryProps<IOrderHistoryData>>}\n */\n@observer\nclass OrderHistory extends React.Component<IOrderHistoryProps<IOrderHistoryData>> {\n    @observable private orderHistory: IOrderHistory;\n    @observable private viewState: IOrderHistoryViewState;\n    private pageSize: number;\n    private paging: IPaging;\n    private telemetryContent?: ITelemetryContent;\n    private payLoad: IPayLoad;\n\n    constructor(props: IOrderHistoryProps<IOrderHistoryData>) {\n        super(props);\n        this.orderHistory = {\n            salesOrders: [],\n            products: []\n        };\n        this.viewState = {\n            isDataReady: false,\n            hasError: false,\n            isShowMoreButton: (this.props.config.pageSize || 0) > 0,\n            isLoading: false\n        };\n        this.pageSize = this.props.config.pageSize || 10;\n        this.paging = {\n            top: this.pageSize,\n            skip: 0\n        };\n        this.telemetryContent = getTelemetryObject(this.props.context.request.telemetryPageName!, this.props.friendlyName, this.props.telemetry);\n        this.payLoad = getPayloadObject('click', this.telemetryContent, '');\n    }\n\n    public componentDidMount(): void {\n        this.getOrderHistory()\n            .then(() => {\n                this.viewState.isDataReady = true;\n            })\n            .catch(ex => {\n                this.viewState.hasError = true;\n            });\n    }\n\n    public render(): JSX.Element {\n        const {\n            config: { heading, className, showChannelInfo },\n            resources: { genericErrorMessage, noOrderHistoryLable, moreButtonText, backToShopping, orderCountLabel, ordersCountLabel, loadingLabel }\n        } = this.props;\n        const { salesOrders, products } = this.orderHistory;\n        const { isDataReady, hasError, isShowMoreButton, isLoading } = this.viewState;\n        const backToShoppingUrl = Msdyn365.getUrlSync('home', this.props.context.actionContext) || '';\n        const channelIdentities = this.props.data.channels.result && this.props.data.channels.result.channelIdentities;\n        const orgUnitLocations = this.props.data.orgUnitLocations.result && this.props.data.orgUnitLocations.result.orgUnitLocations;\n\n        let viewProps: IOrderHistoryViewProps = {\n            ...this.props,\n            orderHistory: this.orderHistory,\n            viewState: this.viewState,\n            orderHistoryProps: {\n                moduleProps: this.props,\n                className: classname('ms-order-history', className)\n            },\n            header: {\n                headerProps: { className: 'ms-order-history__header' },\n                heading: heading && heading.text && (\n                <Msdyn365.Text\n                    {...heading}\n                    className='ms-order-history__heading'\n                    text={heading.text}\n                    tag={heading.tag || 'h2'}\n                    editProps={{ onEdit: this.handleOrderHistoryHeadingChange, requestContext: this.props.context.request }}\n                />\n                )\n            },\n            backToShoppingLink: backToShoppingUrl && (\n                <Button className='ms-order-history__btn-keep-shopping' href={backToShoppingUrl}>\n                    {backToShopping}\n                </Button>\n            )\n        };\n\n        if (hasError) {\n            viewProps = {\n                ...viewProps,\n                alert: <LabelComponent className='ms-order-history__alert' label={genericErrorMessage} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!isDataReady) {\n            viewProps = {\n                ...viewProps,\n                loading: <LabelComponent className='ms-order-history__loading' label={loadingLabel} />\n            };\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        if (!salesOrders || salesOrders.length === 0) {\n            viewProps = {\n                ...viewProps,\n                emptyMessage: <p className='ms-order-history__empty-message'>{noOrderHistoryLable}</p>\n            };\n\n            return this.props.renderView(viewProps) as React.ReactElement;\n        }\n\n        const _orderCountLabel = salesOrders.length === 1 ? orderCountLabel : ordersCountLabel;\n        this.payLoad.contentAction.etext = TelemetryConstant.ViewMore;\n        const viewMoreAttributes = getTelemetryAttributes(this.telemetryContent!,this.payLoad);\n\n        viewProps = {\n            ...viewProps,\n            header: {\n                ...viewProps.header,\n                orderCountLabel: <span className='ms-order-history__order-count'>{`(${salesOrders.length} ${_orderCountLabel})`}</span>\n            },\n            list: {\n                listProps: { className: 'ms-order-history__sales-order-list' },\n                salesOrders: salesOrders.map(salesOrder =>\n                    getSalesOrder({\n                        ...this.props,\n                        products,\n                        salesOrder,\n                        channelIdentities,\n                        orgUnitLocations,\n                        showChannelInfo,\n                        telemetryContent: this.telemetryContent\n                    })\n                )\n            },\n            moreButton: isShowMoreButton && (\n                <Button className={`ms-order-history__btn-more ${isLoading ? 'is-busy' : ''}`} {...viewMoreAttributes} disabled={isLoading} onClick={this.onMoreButtonClick}>\n                    {moreButtonText}\n                </Button>\n            )\n        };\n\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    public handleOrderHistoryHeadingChange = (event: Msdyn365.ContentEditableEvent) => this.props.config.heading!.text = event.target.value;\n\n    private onMoreButtonClick = () => {\n        // tslint:disable-next-line:no-floating-promises\n        this.getOrderHistory();\n    }\n\n    private getOrderHistory = async (): Promise<void> => {\n        const actionContext = this.props.context.actionContext;\n        const input = new GetSalesOrderHistoryWithHydrationsInput(this.paging, this.props.context.request.apiSettings);\n\n        try {\n            this.viewState.isLoading = true;\n            const response = await getSalesOrderHistoryWithHydrationsAction(input, actionContext);\n            if (response) {\n                const { products, salesOrders } = response;\n                this.orderHistory.products.push(...products);\n                this.orderHistory.salesOrders.push(...salesOrders);\n                this.viewState.isShowMoreButton = this.viewState.isShowMoreButton && response.salesOrders.length > 0 && response.salesOrders.length === this.pageSize;\n                this.paging.skip += this.pageSize;\n            }\n            this.viewState.isLoading = false;\n            return Promise.resolve();\n        } catch (error) {\n            return Promise.reject();\n        }\n    }\n}\n\nexport default OrderHistory;\n"]}