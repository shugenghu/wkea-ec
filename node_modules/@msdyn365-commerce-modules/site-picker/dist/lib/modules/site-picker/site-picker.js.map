{"version":3,"file":"site-picker.js","sourceRoot":"./src/","sources":["modules/site-picker/site-picker.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IModuleProps, INodeProps, KeyCodes, NodeTag } from '@msdyn365-commerce-modules/utilities';\nimport { IImageSettings, Image } from '@msdyn365-commerce/core';\nimport classnames from 'classnames';\nimport React from 'react';\nimport { ISitePickerConfig,ISitePickerProps } from './site-picker.props.autogenerated';\n\nexport interface ISitePickerViewProps extends ISitePickerProps<ISitePickerConfig> {\n    SitePicker:IModuleProps;\n    SitePickerMenu:INodeProps;\n    SitePickerMenuSpan:INodeProps;\n    SitePickerMenuList:INodeProps;\n    SitePickerMenuListItem:INodeProps;\n    SitePickerMenuListItemArray:React.ReactNode[] | undefined;\n    siteOptionsState:boolean;\n    renderSiteOptions():void;\n    resetSiteOptionsState():void;\n}\ninterface ISitePickerState {\n    expandSiteOptions: boolean;\n}\n\n/**\n *\n * SitePicker component\n * @extends {React.PureComponent<ISitePickerProps<ISitePickerConfig>>}\n */\nclass SitePicker extends React.PureComponent<ISitePickerProps<ISitePickerConfig>,ISitePickerState> {\n    private _cookieName: string = '_msdyn365___site_';\n    private _cookieExpirationInSeconds: number = 5184000;\n    private _sitePickerMenuNode: React.RefObject<HTMLUListElement>;\n    private _sitePickerMenuButton: React.RefObject<HTMLButtonElement>;\n\n    public constructor(props:ISitePickerViewProps) {\n        super(props);\n        this._handleChange = this._handleChange.bind(this);\n        this._sitePickerMenuNode = React.createRef();\n        this._sitePickerMenuButton = React.createRef();\n        this._renderSiteOptions=this._renderSiteOptions.bind(this);\n        this._resetSiteOptionsState=this._resetSiteOptionsState.bind(this);\n        this._escFunction=this._escFunction.bind(this);\n        this._handleOutsideClick=this._handleOutsideClick.bind(this);\n        this.state= {\n            expandSiteOptions:false\n        };\n    }\n    public componentDidMount(): void {\n        document?.addEventListener('keydown', (this._escFunction as unknown) as EventListener, false);\n        document?.body?.addEventListener('mousedown',  this._handleOutsideClick);\n    }\n    public componentWillUnmount(): void {\n        document?.removeEventListener('keydown', (this._escFunction as unknown) as EventListener, false);\n        document?.body?.removeEventListener('mousedown', this._handleOutsideClick, false);\n    }\n    public render(): JSX.Element | null {\n        const viewProps: ISitePickerViewProps = {\n                ...this.props as ISitePickerProps<ISitePickerConfig>,\n                SitePicker:{\n                    moduleProps: this.props,\n                    className: classnames('ms-site-picker',this.props.config.className),\n                    tag:'div'\n                },\n                SitePickerMenu:{\n                    tag: 'button' as NodeTag,\n                className: 'ms-site-picker__button',\n                'aria-label': this.props.config.heading?.text,\n                'aria-expanded' : this.state.expandSiteOptions ? true : false,\n                onClick:this.props,\n                ref :this._sitePickerMenuButton\n                },\n                SitePickerMenuSpan:{\n                    className:'ms-site-picker__span',\n                    tag:'span'\n                },\n                SitePickerMenuList: {\n                    className:'ms-site-picker__list',\n                    role:'menu',\n                    tag:'ul',\n                    ref:this._sitePickerMenuNode\n                },\n                SitePickerMenuListItem: {\n                    className:'ms-site-picker__list__item',\n                    role:'presentation',\n                    tag:'li',\n                },\n                SitePickerMenuListItemArray:this._renderSitePickerImage(),\n                renderSiteOptions:this._renderSiteOptions,\n                resetSiteOptionsState:this._resetSiteOptionsState,\n                siteOptionsState:this.state.expandSiteOptions,\n                };\n        return this.props.renderView(viewProps);\n    }\n    private _renderSiteOptions():void {\n        const expandSiteOptionsState=this.state.expandSiteOptions;\n        this.setState({\n            expandSiteOptions: !expandSiteOptionsState\n          });\n    }\n    private _resetSiteOptionsState():void {\n        this.setState({\n            expandSiteOptions: false\n          });\n    }\n    // tslint:disable-next-line: no-any\n    private _escFunction = (event: any) => {\n        const key = event.keyCode;\n        if(this.state.expandSiteOptions) {\n            switch (key) {\n                case KeyCodes.Escape: {\n                    setTimeout(() => {\n                        const nextFocus = document && document.activeElement;\n                        if ((this._sitePickerMenuButton?.current?.contains(nextFocus) || this._sitePickerMenuNode?.current?.contains(nextFocus))) {\n                            this._resetSiteOptionsState();\n                            this._sitePickerMenuButton?.current?.focus();\n                        }\n                    },         50);\n                    break;\n                }\n                case KeyCodes.Tab: {\n                    setTimeout(() => {\n                    const nextFocus = document && document.activeElement;\n                    if ((!this._sitePickerMenuButton?.current?.contains(nextFocus) && !this._sitePickerMenuNode?.current?.contains(nextFocus))) {\n                        this._resetSiteOptionsState();\n                    }\n                },             50);\n                    break;\n                }\n                default:\n                    return;\n            }\n        }\n    }\n\n    // tslint:disable-next-line: no-any\n    private _handleOutsideClick = (event:any) => {\n        if((this._sitePickerMenuButton.current?.contains(event.target) && this.state.expandSiteOptions) ||\n            (this._sitePickerMenuNode.current?.contains(event.target) && this.state.expandSiteOptions)) {\n        return;\n        } else {\n            this._resetSiteOptionsState();\n        }\n    };\n    private _handleChange(e: React.MouseEvent<HTMLAnchorElement, MouseEvent>): void {\n       e.preventDefault();\n       if(e.currentTarget.href && e.currentTarget.href.length > 0 && window) {\n           if (this.props.context.request.cookies.isConsentGiven()) {\n            const cookieConfig =  {maxAge:this._cookieExpirationInSeconds};\n            this.props.context.request.cookies.set(this._cookieName,e.currentTarget.href,cookieConfig);\n           }\n           window.location.assign(e.currentTarget.href);\n       }\n    }\n    private  _renderSitePickerImage():React.ReactNode[] | undefined {\n        const defaultImageSettings: IImageSettings = {\n            viewports: {\n                xs: { q: `w=48&h=48&m=6`, w: 0, h: 0 },\n                lg: { q: `w=48&h=48&m=6`, w: 0, h: 0 },\n                xl: { q: `w=48&h=48&m=6`, w: 0, h: 0 }\n            },\n            lazyload: true\n        };\n        const siteOptions=this.props.config.siteOptions && this.props.config.siteOptions ;\n        return siteOptions && siteOptions.map((item, index) => {\n            const image = item?.siteImage;\n            const imageProps = {\n            gridSettings: this.props.context.request.gridSettings!,\n            imageSettings: image?.imageSettings || defaultImageSettings\n        };\n            return (\n        <a\n            key={index}\n            className='ms-site-picker__list__item__link'\n            tabIndex={0}\n            href={item?.siteRedirectUrl?.destinationUrl}\n            aria-label={item?.siteName}\n            onClick={this._handleChange}\n            role='menuitem'\n        >\n            <span className='ms-site-picker__list__item__text'>\n                {item?.siteName}\n            </span>\n            <Image\n                className='ms-site-picker__list__item__img'\n\n                key={index}\n                src={image?.src || ''}\n                gridSettings={imageProps.gridSettings}\n                imageSettings={imageProps.imageSettings}\n                altText={image?.altText}\n                loadFailureBehavior='hide'\n            />\n        </a>\n        );\n        }\n        );\n    }\n}\n\nexport default SitePicker;"]}