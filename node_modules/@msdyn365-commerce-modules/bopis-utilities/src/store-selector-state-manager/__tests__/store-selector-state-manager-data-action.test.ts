import 'jest';

import * as core from '@msdyn365-commerce/core';
import { MapStoreSelectorStateManager } from '../map-store-selector-state-manager';
import { IStoreSelectorStateManager } from '../i-store-selection-state-manager';
import dataAction, { createStoreSelectorStateInput } from '../store-selector-state-manager-data-action';

describe('Tests for Store Selector State Manager Data Action', () => {
    const mockRequestContext: core.IRequestContext = {
        // @ts-ignore partial mock
        channel: {
            BingMapsApiKey: '1001',
            BingMapsEnabled: true
        }
    };

    it('Properly creates input when calling createMapStoreSelectorStateInput', () => {
        const state: IStoreSelectorStateManager = new MapStoreSelectorStateManager();

        const input = createStoreSelectorStateInput(state);

        expect(input.result).toBe(state);
        expect(input.getCacheKey()).toBe('Generic-mapSSSM');
    });

    it('Properly creates input when calling data action directly', () => {
        const actionContext = core.buildMockActionContext({ requestContext: <core.IRequestContext>(<unknown>mockRequestContext) });

        const input = dataAction.prototype.inputFunc({requestContext: actionContext.requestContext});

        expect(input).toBeDefined();
        expect(input.result).toBeDefined();
        expect(input.getCacheKey()).toBe('Generic-mapSSSM');
    });
});
