{"version":3,"file":"iframe.js","sourceRoot":"./src/","sources":["modules/iframe/iframe.tsx"],"names":[],"mappings":"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","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Heading, IModuleProps } from '@msdyn365-commerce-modules/utilities';\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport { IHeadingData, IIframeConfig, IIframeProps } from './iframe.props.autogenerated';\n\nexport interface IIframeViewProps extends IIframeProps<IIframeConfig> {\n    Heading: React.ReactNode;\n    IframeContainer: IModuleProps;\n    IFrame: React.ReactNode;\n    alert?: React.ReactNode;\n    cookieConsentAccepted?: boolean;\n}\n\n/**\n *\n * Iframe component\n * @extends {React.PureComponent<IIframeProps>}\n */\nclass Iframe extends React.PureComponent<IIframeProps<IIframeConfig>> {\n    private iframeRef: React.RefObject<HTMLIFrameElement>;\n    constructor(props: IIframeProps<IIframeConfig>) {\n        super(props);\n        this.iframeRef = React.createRef();\n    }\n    public render(): JSX.Element | null {\n        const { config, resources } = this.props;\n        const isConsentGiven =\n            this.props.context.request &&\n            this.props.context.request.cookies &&\n            this.props.context.request.cookies.isConsentGiven &&\n            this.props.context.request.cookies.isConsentGiven();\n\n        if (!(config && config.target && config.target.destinationUrl)) {\n            return null;\n        }\n\n        let srcURL;\n        try {\n            srcURL = new URL(config.target.destinationUrl);\n        } catch (error) {\n            this.props.telemetry.exception(error);\n            return null;\n        }\n\n        if (srcURL && srcURL.protocol && srcURL.protocol.toLocaleLowerCase() !== 'https:') {\n            return null;\n        }\n        const iframeClassName = classnames('ms-iframe', config.className);\n\n        let viewProps: IIframeViewProps = {\n            ...(this.props as IIframeProps<IIframeConfig>),\n            Heading: this._createHeading(config.heading!),\n            IframeContainer: {\n                moduleProps: this.props,\n                className: iframeClassName\n            },\n            IFrame: this._createIframe()\n        };\n\n        if (isConsentGiven === false) {\n            viewProps = {\n                ...viewProps,\n                alert: this._renderAlert(resources.cookieConsentRequiredMessage)\n            };\n        } else {\n            viewProps = {\n                ...viewProps,\n                cookieConsentAccepted : true\n            };\n        }\n        return this.props.renderView(viewProps) as React.ReactElement;\n    }\n\n    private _createHeading(heading: IHeadingData): React.ReactNode | null {\n        if (!heading || !heading.text || !heading.text.length) {\n            return null;\n        }\n\n        return (\n            <Heading {...heading} className='ms-iframe__heading' />\n        );\n    }\n\n    private _renderAlert(message: string): React.ReactNode | null {\n        return (\n            <p className='ms-iframe__error-message' role='alert' aria-live='assertive'>\n                {message}\n            </p>);\n    }\n\n    private _createIframe(): React.ReactNode | null {\n        const { config } = this.props;\n        const targetURL = config.target.destinationUrl;\n\n        return (\n            // tslint:disable-next-line: react-iframe-missing-sandbox\n            <iframe\n                className={classnames('ms-iframe__content')}\n                src={targetURL}\n                height={config.height}\n                aria-label={config.iframeAriaLabel}\n                ref={this.iframeRef}\n            />\n        );\n    }\n\n}\n\nexport default Iframe;\n"]}