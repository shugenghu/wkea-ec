/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
import * as React from 'react';

import { buildMockModuleProps, ICoreContext } from '@msdyn365-commerce/core';
import { mount } from 'enzyme';
import { INavigationMenuConfig, INavigationMenuData, INavigationMenuProps, INavigationMenuViewProps, NavigationMenu, navigationMenuSource } from '../../../../';

const mockResources = {
    allCategoryMenuText: '',
    menuAriaLabel:'Menu',
    backButtonAriaLabel:'Back'
};

const mockMenu = [
    {
        linkText: 'Contact',
        linkUrl: {
            destinationUrl: '/fedev',
            type: 'externalLink'
        },
        ariaLabel: 'Contact',
        subMenus:[
            {
                linkText: 'sub menu1',
                linkUrl: {
                    destinationUrl: '/fedev',
                    type: 'externalLink'
                },
                ariaLabel: 'Contact',
            },
            {
                linkText: 'sub menu1',
                linkUrl: {
                    destinationUrl: '/fedev',
                    type: 'externalLink'
                },
                ariaLabel: 'Contact',
            }
        ]
    }
];

const mockData: INavigationMenuData = {
    // @ts-ignore partial mock
    categories: {
        status: 'SUCCESS',
        result: [
            {
               Name: 'Link1',
               RecordId: 1,
               NameTranslations: [
                  {
                     Language: 'en-us',
                     Text: 'Fashion Accessories'
                  }
               ],
               Children: [
                  {
                     RecordId: 1,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'E2E'
                        }
                     ]
                  },
                  {
                     RecordId: 2,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Fashion Sunglasses'
                        }
                     ]
                  }
               ]
            },
            {
                RecordId: 2,
               NameTranslations: [
                  {
                     Language: 'en-us',
                     Text: 'Mens Wear'
                  }
               ],
               Children: [
                  {
                     RecordId: 1,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Casual Shirts'
                        }
                     ]
                  },
                  {
                     RecordId: 2,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Coats & Jackets'
                        }
                     ]
                  },
                  {
                     RecordId: 3,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Dress Shirts'
                        }
                     ]
                  },
                  {
                     RecordId: 4,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Hats'
                        }
                     ]
                  },
                  {
                     RecordId: 5,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Mens Jeans'
                        }
                     ]
                  }
               ]
            },
            {
                RecordId: 3,
               NameTranslations: [
                  {
                     Language: 'en-us',
                     Text: 'Womenswear'
                  }
               ],
               Children: [
                  {
                     RecordId: 1,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Coats'
                        }
                     ]
                  },
                  {
                     RecordId: 2,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Dresses'
                        }
                     ]
                  },
                  {
                     RecordId: 3,
                     Children: [],
                     NameTranslations: [
                        {
                           Language: 'en-us',
                           Text: 'Skirts'
                        }
                     ]
                  }
               ]
            }
        ]
    }
};

const mockConfigAll: INavigationMenuConfig = {
    navigationMenuSource: 'all' as navigationMenuSource,
    cmsNavItems: mockMenu
};

const mockConfigRS: INavigationMenuConfig = {
    navigationMenuSource: 'retailServerOnly' as navigationMenuSource,
};

const mockConfigCMS: INavigationMenuConfig = {
    navigationMenuSource: 'cmsOnly' as navigationMenuSource,
    cmsNavItems: mockMenu
};

const mockMobileContext: ICoreContext = {
    // @ts-ignore partial mock
    request: {
        device: {
            Type: 'Mobile'
        }
    }
};

describe('NavigationMenu', () => {
    it('render navigation source for all', () => {
        const moduleProps = {
            ...(buildMockModuleProps(mockData, {}, mockConfigAll) as INavigationMenuProps<INavigationMenuData>),
            resources: mockResources,
            // @ts-ignore
            renderView: jest.fn(props => { return <div props={props} />;})
        };

        const wrapper = mount(<NavigationMenu {...moduleProps}  />);
        expect(moduleProps.renderView).toBeCalled();
        const viewProps: INavigationMenuViewProps = wrapper.childAt(0).props().props;
        expect(viewProps.menuItemData).toBeDefined();
        expect(viewProps.menuItemData).toMatchSnapshot();
    });

    it('render navigation source for RetailServer only.', () => {
        const moduleProps = {
            ...(buildMockModuleProps(mockData, {}, mockConfigRS) as INavigationMenuProps<INavigationMenuData>),
            resources: mockResources,
            // @ts-ignore
            renderView: jest.fn(props => { return <div props={props} />;})
        };

        const wrapper = mount(<NavigationMenu {...moduleProps}  />);
        expect(moduleProps.renderView).toBeCalled();
        const viewProps: INavigationMenuViewProps = wrapper.childAt(0).props().props;
        expect(viewProps.menuItemData).toBeDefined();
        expect(viewProps.menuItemData).toMatchSnapshot();
    });

    it('render navigation source for CMS only.', () => {
        const moduleProps = {
            ...(buildMockModuleProps(mockData, {}, mockConfigCMS) as INavigationMenuProps<INavigationMenuData>),
            resources: mockResources,
            // @ts-ignore
            renderView: jest.fn(props => { return <div props={props} />;})
        };

        const wrapper = mount(<NavigationMenu {...moduleProps}  />);
        expect(moduleProps.renderView).toBeCalled();
        const viewProps: INavigationMenuViewProps = wrapper.childAt(0).props().props;
        expect(viewProps.menuItemData).toBeDefined();
        expect(viewProps.menuItemData).toMatchSnapshot();
    });

    it('adds "mobile-vp" class in mobile viewport', () => {
        const moduleProps = {
            ...(buildMockModuleProps(mockData, {}, mockConfigCMS, mockMobileContext) as INavigationMenuProps<INavigationMenuData>),
            resources: mockResources,
            // @ts-ignore
            renderView: jest.fn(props => { return <div props={props} />;})
        };

        const wrapper = mount(<NavigationMenu {...moduleProps}  />);
        expect(moduleProps.renderView).toBeCalled();
        const viewProps: INavigationMenuViewProps = wrapper.childAt(0).props().props;
        expect(viewProps.Navigation.className).toEqual('ms-nav mobile-vp');
    });
});
