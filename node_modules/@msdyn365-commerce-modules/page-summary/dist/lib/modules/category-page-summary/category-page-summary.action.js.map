{"version":3,"file":"category-page-summary.action.js","sourceRoot":"./src/","sources":["modules/category-page-summary/category-page-summary.action.ts"],"names":[],"mappings":"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","sourcesContent":["import { buildCacheKeyWithUrlTokens, CurrentCategoryInput, getCategoryUrl, getCurrentCategory } from '@msdyn365-commerce-modules/retail-actions';\nimport {\n    CacheType,\n    createObservableDataAction,\n    getFriendlyName,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICreateActionContext,\n    IRequestContext\n} from '@msdyn365-commerce/core';\nimport { IDefaultPageSummaryConfig } from '../default-page-summary/default-page-summary.props.autogenerated';\nimport { IPageSummaryData } from '../IPageSummaryData';\n\n/** Category Page Summary Input */\nexport class CategoryPageSummaryInput implements IActionInput {\n    public requestContext: IRequestContext;\n    public config: IDefaultPageSummaryConfig;\n\n    constructor(config: IDefaultPageSummaryConfig, requestContext: IRequestContext) {\n        this.config = config || {};\n        this.requestContext = requestContext;\n    }\n\n    public getCacheObjectType = (): string => 'CategoryPageSummary';\n    public getCacheKey = (): string => buildCacheKeyWithUrlTokens('CategoryPageSummary', this.requestContext);\n    public dataCacheType = (): CacheType => 'request';\n}\n\nconst createGetCurrentCategoryInput = (inputData: IActionContext): CurrentCategoryInput => {\n    if (inputData && inputData.requestContext) {\n        return new CurrentCategoryInput(inputData.requestContext);\n    }\n\n    throw new Error('Please specify categoryId query string in request.');\n};\n\nconst action = async (input: CategoryPageSummaryInput, context: IActionContext): Promise<IPageSummaryData> => {\n    const { config } = input;\n    let currentCategory;\n    try {\n        currentCategory = await getCurrentCategory(createGetCurrentCategoryInput(context), context);\n    } catch (e) {\n        // Do nothing, if the action fails fallback to values defined in data\n    }\n    if (currentCategory) {\n        let categoryUrl: string | undefined;\n        try {\n            // reset category's name neutralizedName\n            const localName = getFriendlyName(context.requestContext.locale, currentCategory.NameTranslations);\n            const neutralizedName = currentCategory.NeutralizedName || currentCategory.Name;\n            currentCategory.Name = localName;\n            currentCategory.NeutralizedName = neutralizedName;\n            categoryUrl = getCategoryUrl(currentCategory);\n            // @ts-ignore - TODO: property exits in new version of SDK. Remove once released.\n            const canonicalDomain = context.requestContext.canonicalDomain;\n            if (categoryUrl && canonicalDomain) {\n                categoryUrl = `https://${canonicalDomain}${categoryUrl}`;\n            } else {\n                categoryUrl = undefined;\n            }\n        } catch (e) {\n            categoryUrl = undefined;\n        }\n        return {\n            title: currentCategory.Name,\n            sharingImageUrl: currentCategory.OfflineImage,\n            canonicalUrl: categoryUrl,\n            faviconUrl: config && config.faviconUrl\n        };\n        // If the action fails fallback to values defined from data\n    } else if (config) {\n        return {\n            title: config.title,\n            sharingImageUrl: config.sharingImage && config.sharingImage.src,\n            faviconUrl: config && config.faviconUrl\n        };\n    } else {\n        return {};\n    }\n};\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/page-summary/category-page-summary',\n    action: <IAction<IPageSummaryData>>action,\n    input: (args: ICreateActionContext) => {\n        return new CategoryPageSummaryInput(<IDefaultPageSummaryConfig>args.config, args.requestContext);\n    }\n});\n"]}