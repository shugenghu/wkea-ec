{"version":3,"file":"get-current-category-hierarchy.js","sourceRoot":"","sources":["../../src/get-current-category-hierarchy.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,0BAA0B,EAAgG,MAAM,yBAAyB,CAAC;AACnK,OAAO,sBAAsB,EAAE,EAAE,eAAe,EAAE,MAAM,4BAA4B,CAAC;AAErF;;GAEG;AACH,MAAM,OAAO,6BAA8B,SAAQ,eAAe;IAG9D,YAAY,OAAwB,EAAE,iBAA0B,EAAE,QAAiB,EAAE,gBAAyB;QAC1G,KAAK,CAAC,OAAO,EAAE,iBAAiB,EAAE,QAAQ,CAAC,CAAC;QAIhD,2CAA2C;QACpC,uBAAkB,GAAG,GAAG,EAAE,CAAC,0BAA0B,CAAC;QACtD,gBAAW,GAAG,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;QALpE,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,IAAI,CAAC,CAAC;IAClD,CAAC;CAKJ;AAED;;GAEG;AACH,MAAM,CAAC,MAAM,8BAA8B,GAAG,CAAC,SAA+C,EAAgB,EAAE;IAC5G,MAAM,QAAQ,GAAG,SAAS,CAAC,MAAM,IAAI,SAAS,CAAC,MAAM,CAAC,aAAa,IAAI,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;IACpH,MAAM,gBAAgB,GAClB,CAAC,SAAS,CAAC,cAAc,CAAC,SAAS,IAAI,SAAS,CAAC,cAAc,CAAC,SAAS,CAAC,QAAQ,KAAK,UAAU,IAAI,SAAS,CAAC,cAAc,CAAC,SAAS,CAAC,MAAM,CAAC;QAC/I,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,IAAI,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,UAAU,CAAC;QAC7E,CAAC,CAAC;IAEN,OAAO,IAAI,6BAA6B,CAAC,SAAS,CAAC,cAAc,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,gBAAgB,CAAC,CAAC;AAC1G,CAAC,CAAC;AAEF;;;GAGG;AACH,MAAM,CAAC,KAAK,UAAU,iCAAiC,CAAC,KAAoC,EAAE,GAAmB;IAE7G,MAAM,qBAAqB,GAAG,MAAM,sBAAsB,CACtD,IAAI,eAAe,CACf,GAAG,CAAC,cAAc,EAClB,IAAI,EACJ,KAAK,CAAC,QAAQ,CAAC,EACnB,GAAG,CAAC,CAAC;IACT,MAAM,aAAa,GAAwB,EAAE,CAAC;IAE9C,MAAM,YAAY,GAAG,CAAC,QAA2B,EAAE,EAAE;QACjD,IAAG,QAAQ,CAAC,QAAQ,KAAK,KAAK,CAAC,gBAAgB,EAAE;YAC7C,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC7B,OAAO,IAAI,CAAC;SACf;aAAM,IAAI,QAAQ,CAAC,QAAQ,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,EAAE;YACtD,QAAQ,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,aAAa,EAAE,EAAE;gBACxC,IAAG,YAAY,CAAC,aAAa,CAAC,EAAE;oBAC5B,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;iBAChC;YACL,CAAC,CAAC,CAAC;SACN;aAAM;YACH,OAAO,KAAK,CAAC;SAChB;IACL,CAAC,CAAC;IAEF,qBAAqB,CAAC,OAAO,CAAC,CAAC,iBAAoC,EAAE,EAAE;QACnE,YAAY,CAAC,iBAAiB,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,OAAO,aAAa,CAAC,OAAO,EAAE,CAAC;AACnC,CAAC;AAED,eAAe,0BAA0B,CAAC;IACtC,EAAE,EAAE,0EAA0E;IAC9E,MAAM,EAAgC,iCAAiC;IACvE,KAAK,EAAE,8BAA8B;CACxC,CAAC,CAAC","sourcesContent":["import { CategoryHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { createObservableDataAction, IAction, IActionContext, IActionInput, IAny, ICreateActionContext, IGeneric, IRequestContext } from '@msdyn365-commerce/core';\nimport getCategoriesHierarchy, { CategoriesInput } from './get-categories-hierarchy';\n\n/**\n * Action Input Class for get-current-category-hierarchy\n */\nexport class CurrentCategoryHierarchyInput extends CategoriesInput {\n    public activeCategoryId: number;\n\n    constructor(context: IRequestContext, mappedToHierarchy: boolean, maxItems?: number, activeCategoryId?: number) {\n        super(context, mappedToHierarchy, maxItems);\n        this.activeCategoryId = activeCategoryId || 0;\n    }\n\n    // @ts-ignore: Overriding cache object type\n    public getCacheObjectType = () => 'CurrentCategoryHierarchy';\n    public getCacheKey = () => `${this.activeCategoryId}-${this.channelId}`;\n}\n\n/**\n * Creates the input required for the data action\n */\nexport const createCategoriesHierarchyInput = (inputData: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    const topItems = inputData.config && inputData.config.topCategories && parseInt(inputData.config.topCategories, 10);\n    const activeCategoryId =\n        (inputData.requestContext.urlTokens && inputData.requestContext.urlTokens.pageType === 'Category' && inputData.requestContext.urlTokens.itemId) ||\n        (inputData.requestContext.query && inputData.requestContext.query.categoryId) ||\n        0;\n\n    return new CurrentCategoryHierarchyInput(inputData.requestContext, true, topItems, +activeCategoryId);\n};\n\n/**\n * Get the hierarchy of categories that are currently active as a parent -> child array.\n * Return will be as follows: [ParentCategory, Child, SubChild, SubSubChild]\n */\nexport async function getCurrentCategoryHierarchyAction(input: CurrentCategoryHierarchyInput, ctx: IActionContext): Promise<CategoryHierarchy[]> {\n\n    const fullCategoryHierarchy = await getCategoriesHierarchy(\n        new CategoriesInput(\n            ctx.requestContext,\n            true,\n            input.maxItems),\n        ctx);\n    const categoryArray: CategoryHierarchy[] = [];\n\n    const findCategory = (category: CategoryHierarchy) => {\n        if(category.RecordId === input.activeCategoryId) {\n            categoryArray.push(category);\n            return true;\n        } else if (category.Children && category.Children.length) {\n            category.Children.forEach((childCategory) => {\n                if(findCategory(childCategory)) {\n                    categoryArray.push(category);\n                }\n            });\n        } else {\n            return false;\n        }\n    };\n\n    fullCategoryHierarchy.forEach((categoryHierarchy: CategoryHierarchy) => {\n        findCategory(categoryHierarchy);\n    });\n\n    return categoryArray.reverse();\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-current-category-hierarchy',\n    action: <IAction<CategoryHierarchy[]>>getCurrentCategoryHierarchyAction,\n    input: createCategoriesHierarchyInput\n});\n"]}