{"version":3,"file":"get-customer-balance.js","sourceRoot":"","sources":["../../src/get-customer-balance.ts"],"names":[],"mappings":"AAAA,OAAO,EACQ,0BAA0B,EAExC,MAAM,yBAAyB,CAAC;AAEjC,OAAO,EACH,uBAAuB,EAC1B,MAAM,+EAA+E,CAAC;AAEvF,OAAO,WAAW,EAAE,EAAE,gBAAgB,EAAE,MAAM,gBAAgB,CAAC;AAC/D,OAAO,EAAE,aAAa,EAAE,MAAM,SAAS,CAAC;AAExC;;GAEG;AACH,MAAM,OAAO,uBAAuB;IAIhC,YAAY,WAAiC,EAAE,qBAA8B;QAKtE,gBAAW,GAAG,GAAG,EAAE,CAAC,aAAa,CAAC,mBAAmB,IAAI,CAAC,qBAAqB,EAAE,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QACrG,uBAAkB,GAAG,GAAG,EAAE,CAAC,oBAAoB,CAAC;QAChD,kBAAa,GAAG,GAAc,EAAE,CAAC,SAAS,CAAC;QAN9C,IAAI,CAAC,qBAAqB,GAAG,qBAAqB,CAAC;QACnD,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IACnC,CAAC;CAKJ;AAED;;;GAGG;AAEH,MAAM,CAAC,MAAM,6BAA6B,GAAG,CAAC,SAA+B,EAA2B,EAAE;IACtG,MAAM,EAAE,cAAc,EAAE,GAAG,SAAS,CAAC;IACrC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,eAAe,EAAE;QACtC,MAAM,IAAI,KAAK,CAAC,yEAAyE,CAAC,CAAC;KAC9F;IAED,OAAO,IAAI,uBAAuB,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;AACnE,CAAC,CAAC;AAEF;;;;GAIG;AACH,MAAM,CAAC,KAAK,UAAU,wBAAwB,CAAC,KAA8B,EAAE,GAAmB;IAC9F,MAAM,aAAa,GAAG,IAAI,gBAAgB,CAAC,KAAK,CAAC,WAAW,EAAE,KAAK,CAAC,qBAAqB,CAAC,CAAC;IAC3F,MAAM,QAAQ,GAAG,MAAM,WAAW,CAAC,aAAa,EAAE,GAAG,CAAC,CAAC;IAEvD,IAAI,CAAC,QAAQ,EAAE;QACX,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,0BAA0B,EAAE,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC,CAAC;KAC1F;IAED,OAAO,uBAAuB,CAC1B;QACI,aAAa,EAAE,GAAG;QAClB,mBAAmB,EAAE,EAAE;KAC1B,EACD,QAAQ,CAAC,aAAa,EACtB,QAAQ,CAAC,cAAe,CAC3B,CAAC;AACN,CAAC;AAED;;;GAGG;AACH,eAAe,0BAA0B,CAAmB;IACxD,EAAE,EAAE,gEAAgE;IACpE,MAAM,EAA6B,wBAAwB;IAC3D,KAAK,EAAgD,6BAA6B;CACrF,CAAC,CAAC","sourcesContent":["import {\n    CacheType, createObservableDataAction, IAction, IActionContext, IActionInput,\n    ICommerceApiSettings, ICreateActionContext\n} from '@msdyn365-commerce/core';\nimport { CustomerBalances } from '@msdyn365-commerce/retail-proxy';\nimport {\n    getCustomerBalanceAsync\n} from '@msdyn365-commerce/retail-proxy/dist/DataActions/StoreOperationsDataActions.g';\n\nimport getCustomer, { GetCustomerInput } from './get-customer';\nimport { buildCacheKey } from './index';\n\n/**\n *  Input class for the GetCustomerBalance data action\n */\nexport class GetCustomerBalanceInput implements IActionInput {\n    public customerAccountNumber?: string;\n    public apiSettings: ICommerceApiSettings;\n\n    constructor(apiSettings: ICommerceApiSettings, customerAccountNumber?: string) {\n        this.customerAccountNumber = customerAccountNumber;\n        this.apiSettings = apiSettings;\n    }\n\n    public getCacheKey = () => buildCacheKey(`CustomerBalance-${this.customerAccountNumber}`, this.apiSettings);\n    public getCacheObjectType = () => 'GetCustomerBalance';\n    public dataCacheType = (): CacheType => 'request';\n}\n\n/**\n * createInput method for the GetCustomerBalance method\n * @param inputData The input data passed to the createInput method\n */\n\nexport const createGetCustomerBalanceInput = (inputData: ICreateActionContext): GetCustomerBalanceInput => {\n    const { requestContext } = inputData;\n    if (!requestContext.user.isAuthenticated) {\n        throw new Error('Unable to create get customer balance input. User is not authenticated.');\n    }\n\n    return new GetCustomerBalanceInput(requestContext.apiSettings);\n};\n\n/**\n * The action method for the GetCustomerBalance data action\n * @param input The action input\n * @param ctx The action context\n */\nexport async function getCustomerBalanceAction(input: GetCustomerBalanceInput, ctx: IActionContext): Promise<CustomerBalances> {\n    const customerInput = new GetCustomerInput(input.apiSettings, input.customerAccountNumber);\n    const customer = await getCustomer(customerInput, ctx);\n\n    if (!customer) {\n        ctx.telemetry.error('Not able to get customer', new Error('Not able to get customer'));\n    }\n\n    return getCustomerBalanceAsync(\n        {\n            callerContext: ctx,\n            queryResultSettings: {}\n        },\n        customer.AccountNumber,\n        customer.InvoiceAccount!\n    );\n}\n\n/**\n * The GetCustomerBalance data action\n * Returns the customer's balance\n */\nexport default createObservableDataAction<CustomerBalances>({\n    id: '@msdyn365-commerce-modules/retail-actions/get-customer-balance',\n    action: <IAction<CustomerBalances>>getCustomerBalanceAction,\n    input: <(args: ICreateActionContext) => IActionInput>createGetCustomerBalanceInput\n});\n"]}