{"version":3,"file":"get-full-order-templates.js","sourceRoot":"","sources":["../../../src/order-templates/get-full-order-templates.ts"],"names":[],"mappings":"AAAA,OAAO,EACH,0BAA0B,EAIJ,MAAM,yBAAyB,CAAC;AAG1D,OAAO,EAAE,iBAAiB,EAAE,sBAAsB,EAAE,wBAAwB,EAAE,MAAM,IAAI,CAAC;AACzF,OAAO,EAAE,oCAAoC,EAAE,mCAAmC,EAAE,MAAM,IAAI,CAAC;AAC/F,OAAO,EAAE,aAAa,EAAE,MAAM,8BAA8B,CAAC;AAE7D;;GAEG;AACH,MAAM,OAAO,0BAA0B;IAGnC,YAAY,mBAAyC;QAI9C,gBAAW,GAAG,GAAG,EAAE,CAAC,uBAAuB,CAAC;QAC5C,uBAAkB,GAAG,GAAG,EAAE,CAAC,uBAAuB,CAAC;QACnD,kBAAa,GAAG,GAAc,EAAE,CAAC,MAAM,CAAC;QAL3C,IAAI,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;IACnD,CAAC;CAKJ;AAED;;;GAGG;AACH,MAAM,CAAC,MAAM,gCAAgC,GAAG,CAAC,SAA+B,EAA8B,EAAE;IAC5G,MAAM,EAAE,cAAc,EAAE,GAAG,SAAS,CAAC;IACrC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,eAAe,EAAE;QACtC,MAAM,IAAI,KAAK,CAAC,gEAAgE,CAAC,CAAC;KACrF;IACD,MAAM,mBAAmB,GAAyB,wBAAwB,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC,mBAAmB,CAAC;IACxH,mBAAmB,CAAC,KAAK,GAAG,IAAI,CAAC;IAEjC,OAAO,IAAI,0BAA0B,CAAC,mBAAmB,CAAC,CAAC;AAC/D,CAAC,CAAC;AAEF;;;;GAIG;AACH,MAAM,CAAC,KAAK,UAAU,2BAA2B,CAAC,KAAiC,EAAE,GAAmB;IACpG,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,CAAC,eAAe,EAAE;QAC1C,MAAM,IAAI,KAAK,CAAC,gEAAgE,CAAC,CAAC;KACrF;IAED,MAAM,cAAc,GAAoB,EAAE,CAAC;IAE3C,MAAM,WAAW,GAAG,IAAI,sBAAsB,EAAE,CAAC;IACjD,MAAM,YAAY,GAAkB,MAAM,iBAAiB,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC;IAE9E,IAAI,CAAC,YAAY,IAAI,YAAY,CAAC,MAAM,KAAK,CAAC,EAAE;QAC5C,OAAO,cAAc,CAAC;KACzB;IAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;QAC1C,MAAM,IAAI,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC;QAC7B,MAAM,UAAU,GAAG,IAAI,mCAAmC,CAAC,IAAI,CAAC,EAAE,EAAE,KAAK,CAAC,mBAAmB,CAAC,CAAC;QAC/F,MAAM,UAAU,GAAG,MAAM,oCAAoC,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC;QAC/E,cAAc,CAAC,IAAI,CAAC,IAAI,aAAa,CAAC,IAAI,EAAE,UAAU,CAAC,KAAK,EAAE,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC;KACzF;IAED,GAAG,CAAC,KAAK,CAAC,cAAc,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC5C,OAAO,cAAc,CAAC;AAC1B,CAAC;AAED;;;GAGG;AACH,eAAe,0BAA0B,CAAkB;IACvD,EAAE,EAAE,oFAAoF;IACxF,MAAM,EAA4B,2BAA2B;IAC7D,KAAK,EAAE,gCAAgC;CAC1C,CAAC,CAAC","sourcesContent":["import { CacheType,\n    createObservableDataAction,\n    IAction,\n    IActionContext,\n    IActionInput,\n    ICreateActionContext } from '@msdyn365-commerce/core';\nimport { IQueryResultSettings } from '@msdyn365-commerce/retail-proxy';\nimport { ProductList } from '@msdyn365-commerce/retail-proxy/dist/Entities/CommerceTypes.g';\nimport { getOrderTemplates, GetOrderTemplatesInput, QueryResultSettingsProxy } from '..';\nimport { getPaginatedOrderTemplateLinesAction, GetPaginatedOrderTemplateLinesInput } from '..';\nimport { OrderTemplate } from '../utilities/order-templates';\n\n/**\n *  Input class for the GetOrderTemplates data action\n */\nexport class GetFullOrderTemplatesInput implements IActionInput {\n    public queryResultSettings: IQueryResultSettings;\n\n    constructor(queryResultSettings: IQueryResultSettings) {\n        this.queryResultSettings = queryResultSettings;\n    }\n\n    public getCacheKey = () => `GetFullOrderTemplates`;\n    public getCacheObjectType = () => 'GetFullOrderTemplates';\n    public dataCacheType = (): CacheType => 'none';\n}\n\n/**\n * createInput method for the GetOrderTemplate method\n * @param inputData The input data passed to the createInput method.\n */\nexport const createGetFullOrderTemplatesInput = (inputData: ICreateActionContext): GetFullOrderTemplatesInput => {\n    const { requestContext } = inputData;\n    if (!requestContext.user.isAuthenticated) {\n        throw new Error('Unable to get full order templates. User is not authenticated.');\n    }\n    const queryResultSettings: IQueryResultSettings = QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings;\n    queryResultSettings.count = true;\n\n    return new GetFullOrderTemplatesInput(queryResultSettings);\n};\n\n/**\n * The action method for the GetFullOrderTemplates data action\n * @param input The action input\n * @param ctx The action context\n */\nexport async function getFullOrderTemplatesAction(input: GetFullOrderTemplatesInput, ctx: IActionContext): Promise<OrderTemplate[]> {\n    if (!ctx.requestContext.user.isAuthenticated) {\n        throw new Error('Unable to get full order templates. User is not authenticated.');\n    }\n\n    const orderTemplates: OrderTemplate[] = [];\n\n    const inputParams = new GetOrderTemplatesInput();\n    const productLists: ProductList[] = await getOrderTemplates(inputParams, ctx);\n\n    if (!productLists || productLists.length === 0) {\n        return orderTemplates;\n    }\n\n    for (let i = 0; i < productLists.length; ++i) {\n        const list = productLists[i];\n        const inputLines = new GetPaginatedOrderTemplateLinesInput(list.Id, input.queryResultSettings);\n        const linesState = await getPaginatedOrderTemplateLinesAction(inputLines, ctx);\n        orderTemplates.push(new OrderTemplate(list, linesState.lines, linesState.totalCount));\n    }\n\n    ctx.trace(orderTemplates.length.toString());\n    return orderTemplates;\n}\n\n/**\n * The GetFullOrderTemplates Data Action\n * Returns order templates\n */\nexport default createObservableDataAction<OrderTemplate[]>({\n    id: '@msdyn365-commerce-modules/retail-actions/order-templates/get-full-order-templates',\n    action: <IAction<OrderTemplate[]>>getFullOrderTemplatesAction,\n    input: createGetFullOrderTemplatesInput\n});"]}