{"version":3,"file":"refine-search-by-category.js","sourceRoot":"","sources":["../../src/refine-search-by-category.ts"],"names":[],"mappings":"AACA,OAAO,EACH,0BAA0B,EAI7B,MAAM,yBAAyB,CAAC;AAGjC,OAAO,EAAE,iCAAiC,EAAE,MAAM,wEAAwE,CAAC;AAC3H,OAAO,EAAE,YAAY,EAAE,MAAM,oDAAoD,CAAC;AAClF,OAAO,EAAE,wBAAwB,EAAE,MAAM,sCAAsC,CAAC;AAChF,OAAO,EAAE,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAElD;;GAEG;AACH,MAAM,OAAO,2BAA2B;IAQpC,YACI,wBAAkD,EAClD,WAAiC,EACjC,UAAmB,EACnB,SAAkB,EAClB,kBAA0C,EAC1C,SAAkB;QAUf,gBAAW,GAAG,GAAG,EAAE,CAAC,aAAa,CAAC,kCAAkC,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QACxF,uBAAkB,GAAG,GAAG,EAAE,CAAC,6BAA6B,CAAC;QACzD,kBAAa,GAAG,GAAc,EAAE,CAAC,SAAS,CAAC;QAV9C,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,kBAAkB,GAAG,kBAAkB,IAAI,EAAE,CAAC;QACnD,IAAI,CAAC,wBAAwB,GAAG,wBAAwB,CAAC;QACzD,IAAI,CAAC,SAAS,GAAG,SAAS,IAAI,CAAC,CAAC;QAChC,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;IACnC,CAAC;CAKJ;AAED;;GAEG;AACH,MAAM,CAAC,MAAM,WAAW,GAAG,CAAC,SAA+C,EAAgB,EAAE;IACzF,MAAM,kBAAkB,GAAG,SAAS,CAAC,MAAM,IAAI,SAAS,CAAC,MAAM,CAAC,kBAAkB,CAAC;IAEnF,IAAI,SAAS,IAAI,SAAS,CAAC,cAAc,IAAI,SAAS,CAAC,cAAc,CAAC,KAAK,IAAI,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,UAAU,EAAE;QACtH,OAAO,iCAAiC,CACpC,wBAAwB,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC,mBAAmB,EACrE,CAAC,SAAS,CAAC,cAAc,CAAC,WAAW,CAAC,SAAS,EAC/C,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,EACzD,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,CAAC,UAAU,EAC1C,CAAC,KAAK,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,mBAAwC,EAAE,EAAE,CAAC,mBAAmB,CAAC,CACtI,CAAC;KACL;IAED,MAAM,IAAI,KAAK,CAAC,uFAAuF,CAAC,CAAC;AAC7G,CAAC,CAAC;AAEF;;;;GAIG;AACH,eAAe,0BAA0B,CAAC;IACtC,EAAE,EAAE,oEAAoE;IACxE,MAAM,EAAkC,YAAY;IACpD,KAAK,EAAE,WAAW;CACrB,CAAC,CAAC","sourcesContent":["import { CacheType, IAction, IActionInput, ICommerceApiSettings } from '@msdyn365-commerce/core';\nimport {\n    createObservableDataAction,\n    IAny,\n    ICreateActionContext,\n    IGeneric\n} from '@msdyn365-commerce/core';\nimport { ProductRefinerValue, ProductSearchResult } from '@msdyn365-commerce/retail-proxy';\n\nimport { createRefineSearchByCategoryInput } from '@msdyn365-commerce/retail-proxy/dist/DataActions/ProductsDataActions.g';\nimport { retailAction } from '@msdyn365-commerce/retail-proxy/dist/retail-action';\nimport { QueryResultSettingsProxy } from './utilities/QueryResultSettingsProxy';\nimport { buildCacheKey } from './utilities/utils';\n\n/**\n * Action Input class for the refineSearchByCategory data action\n */\nexport class RefineSearchByCriteriaInput implements IActionInput {\n    public readonly categoryId?: number;\n    public readonly channelId?: number;\n    public readonly refinementCriteria: ProductRefinerValue[];\n    public readonly catalogId: number;\n    public readonly queryResultSettingsProxy: QueryResultSettingsProxy;\n    private apiSettings: ICommerceApiSettings;\n\n    constructor(\n        queryResultSettingsProxy: QueryResultSettingsProxy,\n        apiSettings: ICommerceApiSettings,\n        categoryId?: number,\n        channelId?: number,\n        refinementCriteria?: ProductRefinerValue[],\n        catalogId?: number\n    ) {\n        this.categoryId = categoryId;\n        this.channelId = channelId;\n        this.refinementCriteria = refinementCriteria || [];\n        this.queryResultSettingsProxy = queryResultSettingsProxy;\n        this.catalogId = catalogId || 0;\n        this.apiSettings = apiSettings;\n    }\n\n    public getCacheKey = () => buildCacheKey(`RefineSearchByCriteriaInputCache`, this.apiSettings);\n    public getCacheObjectType = () => 'RefineSearchByCriteriaInput';\n    public dataCacheType = (): CacheType => 'request';\n}\n\n/**\n * createInput method for the refineSearchByCategory data action\n */\nexport const createInput = (inputData: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    const refinementCriteria = inputData.config && inputData.config.refinementCriteria;\n\n    if (inputData && inputData.requestContext && inputData.requestContext.query && inputData.requestContext.query.categoryId) {\n        return createRefineSearchByCategoryInput(\n            QueryResultSettingsProxy.fromInputData(inputData).QueryResultSettings,\n            +inputData.requestContext.apiSettings.channelId,\n            inputData.config ? Number(inputData.config.catalogId) : 0,\n            +inputData.requestContext.query.categoryId,\n            !Array.isArray(refinementCriteria) ? [] : refinementCriteria.map((refinementCriterion: ProductRefinerValue) => refinementCriterion)\n        );\n    }\n\n    throw new Error('Please specify categoryId, refinerId, and refinerSourceValue query string in request.');\n};\n\n/**\n * The RefineSearchByCategory data action\n * Uses categoryId query string parameter to call the RefinerSearchByCategory\n * RetailServer API to get information about products\n */\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/regin-search-by-category',\n    action: <IAction<ProductSearchResult[]>>retailAction,\n    input: createInput\n});\n"]}