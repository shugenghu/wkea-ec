{"version":3,"file":"get-categories.js","sourceRoot":"","sources":["../../src/get-categories.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,0BAA0B,EAAyD,MAAM,yBAAyB,CAAC;AAC5H,OAAO,EAAE,kBAAkB,EAAE,MAAM,0EAA0E,CAAC;AAE9G;;GAEG;AACH,MAAM,OAAO,eAAe;IAIxB,YAAY,OAAwB,EAAE,iBAA0B,EAAE,QAAiB;QAM5E,gBAAW,GAAG,GAAG,EAAE,CAAC,GAAG,IAAI,CAAC,SAAS,QAAQ,IAAI,CAAC,QAAQ,IAAI,GAAG,EAAE,CAAC;QACpE,uBAAkB,GAAG,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC;QACxF,kBAAa,GAAG,GAAc,EAAE,CAAC,aAAa,CAAC;QAPlD,IAAI,CAAC,kBAAkB,GAAG,iBAAiB,CAAC;QAC5C,IAAI,CAAC,QAAQ,GAAG,QAAQ,IAAI,GAAG,CAAC;QAChC,IAAI,CAAC,SAAS,GAAG,OAAO,IAAI,OAAO,CAAC,WAAW,IAAI,OAAO,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACjI,CAAC;CAKJ;AAED;;GAEG;AACH,MAAM,CAAC,MAAM,qBAAqB,GAAG,CAAC,SAA+C,EAAgB,EAAE;IACnG,MAAM,QAAQ,GAAG,SAAS,CAAC,MAAM,IAAI,SAAS,CAAC,MAAM,CAAC,aAAa,IAAI,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;IACpH,OAAO,IAAI,eAAe,CAAC,SAAS,CAAC,cAAc,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;AAC1E,CAAC,CAAC;AAEF;;GAEG;AACH,MAAM,CAAC,KAAK,UAAU,iBAAiB,CAAC,KAAsB,EAAE,GAAmB;IAC/E,OAAqC,CAAC,kBAAkB,CAAC,EAAE,aAAa,EAAE,GAAG,EAAE,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;AACvG,CAAC;AAED,eAAe,0BAA0B,CAAC;IACtC,EAAE,EAAE,0DAA0D;IAC9D,MAAM,EAAgC,iBAAiB;IACvD,KAAK,EAAE,qBAAqB;CAC/B,CAAC,CAAC","sourcesContent":["import { CategoryHierarchy } from '@msdyn365-commerce/commerce-entities';\nimport { CacheType, IAction, IActionContext, IActionInput } from '@msdyn365-commerce/core';\nimport { createObservableDataAction, IAny, ICreateActionContext, IGeneric, IRequestContext } from '@msdyn365-commerce/core';\nimport { getCategoriesAsync } from '@msdyn365-commerce/retail-proxy/dist/DataActions/CategoriesDataActions.g';\n\n/**\n * Input for get-categories data action\n */\nexport class CategoriesInput implements IActionInput {\n    public readonly maxItems: number;\n    public readonly channelId: number;\n    private _mappedToHierarchy: boolean;\n    constructor(context: IRequestContext, mappedToHierarchy: boolean, maxItems?: number) {\n        this._mappedToHierarchy = mappedToHierarchy;\n        this.maxItems = maxItems || 250;\n        this.channelId = context && context.apiSettings && context.apiSettings.channelId ? Number(context.apiSettings.channelId) : 0;\n    }\n\n    public getCacheKey = () => `${this.channelId}|top-${this.maxItems || 250}`;\n    public getCacheObjectType = () => (this._mappedToHierarchy ? 'CategoryHierarchy' : 'Category');\n    public dataCacheType = (): CacheType => 'application';\n}\n\n/**\n * Creates the input required to make the retail api call\n */\nexport const createCategoriesInput = (inputData: ICreateActionContext<IGeneric<IAny>>): IActionInput => {\n    const topItems = inputData.config && inputData.config.topCategories && parseInt(inputData.config.topCategories, 10);\n    return new CategoriesInput(inputData.requestContext, false, topItems);\n};\n\n/**\n * Calls the Retail API and returns all the categories as a flat list\n */\nexport async function getCategoryAction(input: CategoriesInput, ctx: IActionContext): Promise<CategoryHierarchy[]> {\n    return <CategoryHierarchy[]><unknown>(getCategoriesAsync({ callerContext: ctx }, input.channelId));\n}\n\nexport default createObservableDataAction({\n    id: '@msdyn365-commerce-modules/retail-actions/get-categories',\n    action: <IAction<CategoryHierarchy[]>>getCategoryAction,\n    input: createCategoriesInput\n});\n"]}